/**
 * Created by Saladin on 18.07.2017.
 */

webpackJsonp([24],[,,,,,function(e,t,i){"use strict";var r=i(31),n=i(495),a=i.n(n),o=i(316);i.i(o.a)(),i.i(r.a)().webgl2&&(a.a.osg.Options.getOptionsURL().webgl2=!0),i(1055),i(1054),i(1053),t.a=a.a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2),n=i.n(r),a=i(396),o=i.n(a),s=i(305),u=i.n(s),l=i(0),c=(i.n(l),i(141)),h=i(289),d=i(7),p=i(158),f=i(21),g=i(408),m=i(152),v=u.a.Loader.extend({getSource:function(e){return{src:{type:"code",obj:window.nunjucksPrecompiled[e]},path:e}}}),_=new u.a.Environment([new v],{autoescape:!0});_.addFilter("log",function(e){return console.log("[Nunjucks] : ",e),e}),_.addFilter("urlize",m.b),_.addFilter("best_fit",p.a),_.addFilter("iterable",function(e){return Array.isArray(e)?e:[e]}),_.addFilter("slugify",m.a),_.addFilter("call_macro_by_name",function(e){var t=this.ctx[e],i=Array.prototype.slice.call(arguments,1);if(!t)throw new Error('Missing macro "'+e+'"');return t.apply(this,i)}),_.addFilter("user_profile_filled",function(e){return"avatar-blue"!==e.avatars.name&&"avatar-orange"!==e.avatars.name&&"avatar-grey"!==e.avatars.name&&(e.biography||e.tagline||e.city||e.country)&&(e.website||e.twitterUsername||e.linkedinUsername||e.facebookUsername)}),_.addFilter("print_suggestion_verb",function(e,t){var i="";return 0===e&&(i=t.displayName+" is a <b>popular</b> user"),10===e&&(i="You <b>liked</b> their models :"),20===e&&(i="You share a common <b>skill</b> :"),30===e&&(i="You share a common <b>interest</b> :"),40===e&&(i="Your profiles are similar."),u.a.runtime.markSafe(i)}),_.addFilter("print_suggestion_target",function(e,t){if(0===t)return"";if(10===t){var i=[];return e.forEach(function(e){var t=n()('<a href="/models/'+e.uid+'">'+e.name+"</a>");i.push(n()("<div>").append(t).html())}),u.a.runtime.markSafe(i.join(", "))}return 20===t?e.name:30===t?e.name:40===t?"":void 0});var b;_.addFilter("skill_slug_to_name",function(e){return b||(b=new h.a,b.fetch({immediate:!0})),b.findWhere({slug:e}).get("name")});var x;_.addFilter("category_uid_to_name",function(e){x||(x=new c.a,x.fetch({immediate:!0}));var t=x.findWhere({uid:e}),i=t.get("name");return t.get("parent")&&(i=x.findWhere({uid:t.get("parent")}).get("name ")+"/"+i),i}),_.addFilter("underscorify",m.c),_.addFilter("image_container",function(e,t,i,r,a,o){var s=_.getFilter("best_fit")(e,t,i),l=s?{backgroundImage:"url("+s+")"}:{},c=n()("<div/>").attr("class","image-container").css({width:r?"100%":t});return o?c.attr("data-background",s):c.css(l),u.a.runtime.markSafe(c.append(n()("<div/>").css({paddingTop:i/t*100+"%"}))[0].outerHTML)}),_.addFilter("query_string",function(e,t){var i=document.createElement("a");return i.href=e,Object.keys(t).length&&(i.search="?"+f.a.craft(f.a.reset(i.search,t))),i.href}),_.addFilter("first_n",function(e,t){return e.slice(0,t)}),_.addFilter("fill_null",function(e,t){for(var i=e.slice();i.length<t;)i.push(null);return i}),_.addFilter("prettify_text",function(e,t){var i=_.getFilter("striptags")(e);return _.getFilter("urlize")(i,t)}),_.addFilter("paragraphy",m.d),_.addFilter("striptags",m.e),_.addFilter("humanize_number",function(e){var t=parseFloat(e),i=[3,6,9,12,15],r=["k","M","B","T","P"];if(!t)return e;var n=t<0?"-":"",a=Math.abs(t);if(a<1e3)return t;for(var o=0,s=i.length;o<s;++o){var u=function(e,t){if(t<=0)return e;var i=Math.pow(10,t),r=e*i;return Math.round(r)/i}(a/Math.pow(10,i[o]),1);if(u<1e3){var l=Math.floor(u);return u!==l?n+u+r[o]:n+l+r[o]}}return t<0?"1000- P":"1000+ P"}),_.addFilter("comma_formatted_number",function(e){return String(e).split("").reduce(function(e,t,i,r){var n=r.length-i;return e+(!i||n%3?t:","+t)},"")}),_.addFilter("pluralize",m.f),_.addFilter("merge",function(e,t){return i.i(l.extend)({},e,t)}),_.addFilter("json_data",function(e){return JSON.stringify(e).replace(/<\//g,"<\\/")}),_.addFilter("format_date",function(e,t){var i;return i="full"===t?"YYYY/MM/DD HH:mm":"L",o.a.utc(e).format(i)}),_.addFilter("max",function(e){return Math.max.apply(Math,e)}),_.addFilter("min",function(e){return Math.min.apply(Math,e)}),_.addFilter("time_ago",function(e){return g.a.timeAgo(o.a.utc(e).toDate())}),_.addFilter("seconds_to_duration",function(e){return o.a.utc(1e3*parseFloat(e)).format("mm:ss")}),_.addFilter("can_upgrade_to_pro",function(e){return new d.a(e).canUpgradeToPro()}),_.addFilter("can_protect_models",function(e){return new d.a(e).canProtectModels()});var S=_.getFilter("trim");_.addFilter("trim",function(e){return null===e?"":S(e)}),_.addFilter("map",function(e,t){return e.map(function(e){return e[t]})}),t.default={get:i.i(l.curry)(function(e,t){return _.render(e+".jinja",t)}),getFromString:i.i(l.curry)(function(e,t){return _.renderString(e,t)}),getFromMacro:function(e,t,i){Array.isArray(e)&&(i=t,t=e[1],e=e[0]);var r=function(i){return _.renderString(["{%- from source import "+t+" -%}","{{ "+t+"("+i.map(function(e,t){return"parameters[ "+t+" ]"}).join(",")+") }}"].join("\n"),{source:e+".jinja",parameters:i})};return i?r(i):r},equal:function(){var e,t,i;return"object"==typeof arguments[1]?(e=arguments[0],t=arguments[1],i=Array.prototype.slice.call(arguments,2)):(e=arguments[0],t={},i=Array.prototype.slice.call(arguments,1)),equal.apply(void 0,[this.getFromString(e,t)].concat(i))}}},,function(e,t,i){"use strict";var r=i(426),n=i(879),a=i(886);n.glMatrix.setMatrixArrayType(a.ArrayType),n.glMatrix.EPSILON=1e-9;var o=n.vec2,s=n.vec3,u=n.vec4,l=n.mat4,c=n.mat3,h=n.quat;s.create32=function(){return new Float32Array(3)},s.create64=function(){return new Float64Array(3)},s.fromValues32=function(e,t,i){var r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r},s.fromValues64=function(e,t,i){var r=new Float64Array(3);return r[0]=e,r[1]=t,r[2]=i,r},s.init=function(e){return s.set(e,0,0,0)},s.transformMat4Rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2];return e[0]=i[0]*r+i[1]*n+i[2]*a,e[1]=i[4]*r+i[5]*n+i[6]*a,e[2]=i[8]*r+i[9]*n+i[10]*a,e},s.valid=function(e){return!r.isNaN(e[0])&&(!r.isNaN(e[1])&&!r.isNaN(e[2]))},s.neg=s.negate,s.ZERO=s.create(),s.ONE=s.fromValues(1,1,1),s.INFINITY=s.fromValues(1/0,1/0,1/0),s.NEGATIVE_INFINITY=s.fromValues(-1/0,-1/0,-1/0),o.create32=function(){return new Float32Array(2)},o.create64=function(){return new Float64Array(2)},o.fromValues32=function(e,t){var i=new Float32Array(2);return i[0]=e,i[1]=t,i},o.fromValues64=function(e,t){var i=new Float64Array(2);return i[0]=e,i[1]=t,i},o.init=function(e){return o.set(e,0,0)},o.valid=function(e){return!r.isNaN(e[0])&&!r.isNaN(e[1])},o.ZERO=o.create(),o.ONE=o.fromValues(1,1),o.INFINITY=o.fromValues(1/0,1/0),o.NEGATIVE_INFINITY=o.fromValues(-1/0,-1/0),u.create32=function(){return new Float32Array(4)},u.create64=function(){return new Float64Array(4)},u.fromValues32=function(e,t,i,r){var n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},u.fromValues64=function(e,t,i,r){var n=new Float64Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},u.init=function(e){return u.set(e,0,0,0,0)},u.valid=function(e){return!r.isNaN(e[0])&&(!r.isNaN(e[1])&&(!r.isNaN(e[2])&&!r.isNaN(e[3])))},u.neg=u.negate,u.ZERO=u.create(),u.ONE=u.fromValues(1,1,1,1),u.INFINITY=u.fromValues(1/0,1/0,1/0,1/0),u.NEGATIVE_INFINITY=u.fromValues(-1/0,-1/0,-1/0,-1/0),h.IDENTITY=h.create(),h.zeroRotation=function(e){return 0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]},h.create32=function(){var e=new Float32Array(4);return e[3]=1,e},h.create64=function(){var e=new Float64Array(4);return e[3]=1,e},h.fromValues32=u.fromValues32,h.fromValues64=u.fromValues64,h.init=h.identity,h.nlerp=function(e,t,i,r){var n,a,o,s,u=t[0],l=t[1],c=t[2],h=t[3],d=i[0],p=i[1],f=i[2],g=i[3],m=u*d+l*p+c*f+h*g,v=1-r;m<0?(n=u*v-d*r,a=l*v-p*r,o=c*v-f*r,s=h*v-g*r):(n=u*v+d*r,a=l*v+p*r,o=c*v+f*r,s=h*v+g*r);var _=1/Math.sqrt(n*n+a*a+o*o+s*s);return e[0]=n*_,e[1]=a*_,e[2]=o*_,e[3]=s*_,e},c.IDENTITY=c.create(),c.create32=function(){var e=new Float32Array(9);return e[0]=e[4]=e[8]=1,e},c.create64=function(){var e=new Float64Array(9);return e[0]=e[4]=e[8]=1,e},l.IDENTITY=l.create(),l.create32=function(){var e=new Float32Array(16);return e[0]=e[5]=e[10]=e[15]=1,e},l.create64=function(){var e=new Float64Array(16);return e[0]=e[5]=e[10]=e[15]=1,e},l.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},l.getFrustum=function(e,t){var i,r,n=0,a=0,o=0,s=0;if(0!==t[3]||0!==t[7]||-1!==t[11]||0!==t[15])return!1;var u=t[14]/(t[10]-1),l=t[14]/(1+t[10]);return a=u*(t[8]-1)/t[0],n=u*(1+t[8])/t[0],o=u*(1+t[9])/t[5],s=u*(t[9]-1)/t[5],i=u,r=l,e.left=a,e.right=n,e.top=o,e.bottom=s,e.zNear=i,e.zFar=r,!0},l.getPerspective=function(){var e={right:0,left:0,top:0,bottom:0,zNear:0,zFar:0};return function(t,i){return l.getFrustum(e,i)&&(t.fovy=180/Math.PI*(Math.atan(e.top/e.zNear)-Math.atan(e.bottom/e.zNear)),t.aspectRatio=(e.right-e.left)/(e.top-e.bottom)),t.zNear=e.zNear,t.zFar=e.zFar,t}}(),l.getLookAt=function(){var e=l.create(),t=s.create(),i=s.fromValues(0,1,0),r=s.fromValues(0,0,-1);return function(n,a,o,u,c){var h=void 0!==c?c:1;l.invert(e,u),l.getTranslation(n,e),s.transformMat4Rotate(o,i,u),s.transformMat4Rotate(a,r,u),s.normalize(a,a),s.add(a,s.scale(t,a,h),n)}}(),l.getFrustumPlanes=function(){var e=l.create();return function(t,i,r,n){l.mul(e,i,r);var a=!!n,o=t[0];o[0]=e[3]-e[0],o[1]=e[7]-e[4],o[2]=e[11]-e[8],o[3]=e[15]-e[12];var s=t[1];s[0]=e[3]+e[0],s[1]=e[7]+e[4],s[2]=e[11]+e[8],s[3]=e[15]+e[12];var u=t[2];u[0]=e[3]+e[1],u[1]=e[7]+e[5],u[2]=e[11]+e[9],u[3]=e[15]+e[13];var c=t[3];c[0]=e[3]-e[1],c[1]=e[7]-e[5],c[2]=e[11]-e[9],c[3]=e[15]-e[13];var h=4;if(a){h=6;var d=t[4];d[0]=e[3]-e[2],d[1]=e[7]-e[6],d[2]=e[11]-e[10],d[3]=e[15]-e[14];var p=t[5];p[0]=e[3]+e[2],p[1]=e[7]+e[6],p[2]=e[11]+e[10],p[3]=e[15]+e[14]}for(var f=0;f<h;f++){var g=t[f],m=1/Math.sqrt(g[0]*g[0]+g[1]*g[1]+g[2]*g[2]);g[0]*=m,g[1]*=m,g[2]*=m,g[3]*=m}}}(),l.infiniteFrustum=function(e,t,i,r,n,a){var o=2*a/(i-t),s=2*a/(n-r),u=(i+t)/(i-t),l=(n+r)/(n-r);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=u,e[9]=l,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=-2*a,e[15]=0,e},l.lookAtDirection=function(){var e=s.create(),t=s.create(),i=s.create();return function(r,n,a,o){var u=a;return s.cross(e,u,o),s.normalize(e,e),s.cross(t,e,u),s.normalize(t,t),r[0]=e[0],r[1]=t[0],r[2]=-u[0],r[3]=0,r[4]=e[1],r[5]=t[1],r[6]=-u[1],r[7]=0,r[8]=e[2],r[9]=t[2],r[10]=-u[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,l.translate(r,r,s.neg(i,n))}}(),l.getScale=function(){var e=s.create(),t=s.create(),i=s.create();return function(r,n){return e[0]=n[0],e[1]=n[4],e[2]=n[8],t[0]=n[1],t[1]=n[5],t[2]=n[9],i[0]=n[2],i[1]=n[6],i[2]=n[10],r[0]=s.length(e),r[1]=s.length(t),r[2]=s.length(i),r}}(),l.getSqrScale=function(){var e=s.create(),t=s.create(),i=s.create();return function(r,n){return e[0]=n[0],e[1]=n[4],e[2]=n[8],t[0]=n[1],t[1]=n[5],t[2]=n[9],i[0]=n[2],i[1]=n[6],i[2]=n[10],r[0]=s.sqrLen(e),r[1]=s.sqrLen(t),r[2]=s.sqrLen(i),r}}();var d=l.rotate;l.rotate=function(e,t,i,r){return d(e,t,i,r)||l.identity(e)};var p=l.fromRotation;l.fromRotation=function(e,t,i){return p(e,t,i)||l.identity(e)},e.exports=n},,,,,,function(e,t,i){"use strict";var r=i(505);i(454);var n=i(331),a=i(30),o={};o.init=function(){var e=i(454);r.memoryPools.stateGraph=new r.OsgObjectMemoryPool(e).grow(50)},o.extend=function(){var e,t,i,r,n=window.Object.prototype.toString,a=window.Object.prototype.hasOwnProperty,s=o.isArray,u=function(e){if(!e||"[object Object]"!==n.call(e)||e.nodeType||e.setInterval)return!1;if(e.constructor&&!a.call(e,"constructor")&&!a.call(e.constructor.prototype,"isPrototypeOf"))return!1;var t;for(t in e);return void 0===t||a.call(e,t)},l=arguments[0]||{},c=1,h=arguments.length,d=!1;for("boolean"==typeof l&&(d=l,l=arguments[1]||{},c=2),"object"==typeof l||function(e){return"[object Function]"===n.call(e)}(l)||(l={}),h===c&&(l=this,--c);c<h;c++)if(null!==(e=arguments[c]))for(t in e)if(i=l[t],r=e[t],l!==r)if(d&&r&&(u(r)||s(r))){var p=i&&(u(i)||s(i))?i:s(r)?[]:{};l[t]=o.extend(d,p,r)}else void 0!==r&&(l[t]=r);return l},o.objectInherit=function(e){function t(){}t.prototype=e;for(var i=new t,r=1;r<arguments.length;r++)o.objectMix(i,arguments[r],!1);return i},o.objectMix=function(e,t,i){for(var r in t)i&&e[r]||(e[r]=t[r]);return e},o.objectType={},o.objectType.type=0,o.objectLibraryClass=function(e,t,i){e.className=function(){return i},e.libraryName=function(){return t};var r=t+"::"+i;return e.libraryClassName=function(){return r},e},o.setTypeID=function(e){var t=e.prototype.libraryClassName(),i=o.generateId(o.objectType,t),r=function(){return i};e.typeID=e.prototype.typeID=i,e.getTypeID=e.prototype.getTypeID=r},o.createPrototypeObject=function(e,t,i,r){t.hasOwnProperty("getTypeID")&&(t=o.objectInherit(t,{})),e.prototype=t,t.constructor=e,i&&r&&(o.objectLibraryClass(t,i,r),o.setTypeID(e))},o.generateId=function(e,t){if(void 0!==e[t])return a.error(t+" is already defined, change class name or library name"),-1;var i=e.type;return e[i]=t,e[t]=i,e.type+=1,i},o.objectNodeType={},o.objectNodeType.type=0,o.setNodeTypeID=function(e){var t=e.prototype.libraryClassName(),i=o.generateId(o.objectNodeType,t),r=function(){return i};e.nodeTypeID=e.prototype.nodeTypeID=i,e.getNodeTypeID=e.prototype.getNodeTypeID=r},o.createPrototypeNode=function(e,t,r,n){var a=i(665),s=t.nodeTypeID;if(o.createPrototypeObject(e,t,r,n),r&&n){o.setNodeTypeID(e);var u=e.nodeTypeID;a.registerApplyFunction(u,a.getApplyFunction(s))}};var s=0,u=0,l={},c={},h=0,d={};o.getStateAttributeTypeNameToTypeId=function(){return d},o.createPrototypeStateAttribute=function(e,t,i,r){o.createPrototypeObject(e,t,i,r);var n=o.getOrCreateStateAttributeTypeId(e);e.prototype.attributeTypeId=n},o.getMaxStateAttributeTypeID=function(){return h},o.getOrCreateStateAttributeTypeId=function(e){var t=e.prototype.getType();if(d[t])return d[t];var i=h++;return d[t]=i,i},o.getOrCreateStateAttributeTypeMemberIndex=function(e){if(void 0!==e._attributeTypeIndex)return e._attributeTypeIndex;var t=e.getTypeMember();return e._attributeTypeIndex=o.getOrCreateStateAttributeTypeMemberIndexFromName(t),e._attributeTypeIndex},o.getOrCreateStateAttributeTypeMemberIndexFromName=function(e){var t=l[e];return void 0!==t?t:(t=s++,l[e]=t,t)},o.getOrCreateTextureStateAttributeTypeMemberIndex=function(e){if(void 0!==e._attributeTypeIndex)return e._attributeTypeIndex;var t=e.getTypeMember();return e._attributeTypeIndex=o.getOrCreateTextureStateAttributeTypeMemberIndexFromName(t),e._attributeTypeIndex},o.getOrCreateTextureStateAttributeTypeMemberIndexFromName=function(e){var t=c[e];return void 0!==t?t:(t=u++,c[e]=t,t)},o.getIdFromTypeMember=function(e){return l[e]},o.getTextureIdFromTypeMember=function(e){return c[e]},o.Float32Array="undefined"!=typeof Float32Array?Float32Array:null,o.Int32Array="undefined"!=typeof Int32Array?Int32Array:null,o.Uint8Array="undefined"!=typeof Uint8Array?Uint8Array:null,o.Uint16Array="undefined"!=typeof Uint16Array?Uint16Array:null,o.Uint32Array="undefined"!=typeof Uint32Array?Uint32Array:null;var p={};o.time=(a.console.time||function(e){p[e]=n.instance().tick()}).bind(a.console),o.timeEnd=(a.console.timeEnd||function(e){if(void 0!==p[e]){var t=n.instance().deltaM(p[e],n.instance().tick());a.debug(e+": "+t+"ms"),p[e]=void 0}}).bind(a.console),o.timeStamp=(a.console.timeStamp||a.console.markTimeline||function(){}).bind(a.console),o.profile=(a.console.profile||function(){}).bind(a.console),o.profileEnd=(a.console.profileEnd||function(){}).bind(a.console),e.exports=o},,,,,,function(e,t){!function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/layouts/popup.jinja"]=function(){function e(e,t,i,r,n){var a="";try{var o=null;a+='<div class="popup-container',r.contextOrFrameLookup(t,i,"popupNeedsLoading")&&(a+=" popup-loading"),a+=" ",a+=r.suppressValue(r.contextOrFrameLookup(t,i,"popupClass"),e.opts.autoescape),a+='">\n\n    <div class="popup-overlay">\n    </div>\n\n    <form class="popup" method="post"',r.contextOrFrameLookup(t,i,"allowAutocomplete")||(a+=' autocomplete="off"'),a+=" ",r.contextOrFrameLookup(t,i,"popupAction")&&(a+='action="',a+=r.suppressValue(r.contextOrFrameLookup(t,i,"popupAction"),e.opts.autoescape),a+='"'),a+=">\n\n        ",r.contextOrFrameLookup(t,i,"allowAutocomplete")||(a+="\n            ",a+='\n            <input type="text" style="display:none" />\n            <input type="password" style="display:none" />\n        '),a+='\n\n        <input type="hidden" name="csrfmiddlewaretoken" value="',a+=r.suppressValue(r.contextOrFrameLookup(t,i,"csrf_token"),e.opts.autoescape),a+='" />\n\n        <header class="popup-header">\n\n            ',(o?function(e,t,i,r,n){n("")}:t.getBlock("popup_header"))(e,t,i,r,function(s,u){if(s)return void n(s);a+=u,a+='\n\n            <div class="popup-actions">\n                ',r.contextOrFrameLookup(t,i,"popupClosable")&&(a+='\n                    <a class="popup-close" data-action="close">\n                        <i class="fa fa-times"></i>\n                    </a>\n                '),a+='\n            </div>\n\n        </header>\n\n        <div class="popup-content">\n\n            <div class="popup-content-overlay"></div>\n\n            ',(o?function(e,t,i,r,n){n("")}:t.getBlock("popup_content"))(e,t,i,r,function(s,u){if(s)return void n(s);a+=u,a+='\n        </div>\n\n        <footer class="popup-footer">\n            ',(o?function(e,t,i,r,n){n("")}:t.getBlock("popup_footer"))(e,t,i,r,function(s,u){if(s)return void n(s);a+=u,a+="\n        </footer>\n\n    </form>\n\n</div>\n",o?o.rootRenderFunc(e,t,i,r,n):n(null,a)})})})}catch(e){n(r.handleError(e,null,null))}}function t(e,t,i,r,n){var a="";try{var i=i.push(!0);a+='\n                <div class="popup-title">\n                    ',a+=r.suppressValue(r.contextOrFrameLookup(t,i,"popupTitle"),e.opts.autoescape),a+="\n                </div>\n            ",n(null,a)}catch(e){n(r.handleError(e,null,null))}}function i(e,t,i,r,n){var a="";try{var i=i.push(!0);a+="\n            ",n(null,a)}catch(e){n(r.handleError(e,null,null))}}function r(e,t,i,r,n){var a="";try{var i=i.push(!0);a+="\n            ",n(null,a)}catch(e){n(r.handleError(e,null,null))}}return{b_popup_header:t,b_popup_content:i,b_popup_footer:r,root:e}}()}()},,,function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(2),n=i.n(r),a=i(6),o=i(28),s=i(127);i.n(s);t.default=o.a.extend({template:function(){return a.default.get("skfb_front/popups/message",{title:this.options.title,text:this.options.text,buttons:this.options.buttons,safe:this.options.safe,popupClass:this.options.popupClass,popupClosable:this.options.popupClosable})},events:{"reset form":"cancel","submit form":"continue"},initialize:function(){o.a.prototype.initialize.apply(this,arguments),this.deferred=n.a.Deferred(),this.promise=this.deferred.promise()},continue:function(){this.deferred.resolve()},cancel:function(){this.deferred.reject()},then:function(){return this.promise.then.apply(this,arguments)}})},,,,,function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(0),o=(i.n(a),i(4)),s=i(94),u=[];t.a=o.a.extend({parent:"body",events:{"click .popup-overlay":"_close",'click [data-action="close"]':"_close"},constructor:function(){this.onKeyDown=this.onKeyDown.bind(this),this.lazyResize=i.i(a.debounce)(this.center,50),this.resizeHandler=function(){n.a.each(u,function(e,t){t.lazyResize()})}.bind(this),o.a.apply(this,arguments)},initialize:function(){if(o.a.prototype.initialize.apply(this,arguments),this.options=i.i(a.defaults)(this.options||{},{cleanOnClose:!0}),n()(this.options.el)[0]!==n()(this.el)[0]){if(!this.template)throw new Error("You cannot use this class without specifying an element during instanciation");this.setElement(i.i(a.result)(this,"template"))}},delegateEvents:function(){o.a.prototype.delegateEvents.apply(this,arguments),n()(window).on("resize",this.resizeHandler),document.addEventListener("keydown",this.onKeyDown,!0)},undelegateEvents:function(){o.a.prototype.undelegateEvents.apply(this,arguments),n()(window).off("resize",this.resizeHandler),document.removeEventListener("keydown",this.onKeyDown,!0)},open:function(e){return-1!==u.indexOf(this)?(this.show(),this.setElement(this.$el),this):(u.unshift(this),n()(i.i(a.result)(this,"parent")).append(this.$el),this.setElement(this.$el),e?this:(this.hide(),this.center(),window.requestAnimationFrame(function(){this.show()}.bind(this)),this.autofocus(),this.center(),this))},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},isHidden:function(){return this.$el.hasClass("hidden")},onKeyDown:function(e){27===e.keyCode&&0!==u.length&&(u[0].close(),e.stopImmediatePropagation(),e.stopPropagation())},_close:function(e,t){return-1===u.indexOf(this)?this:this.$el.closest(".inline-popup").length>0?this:((this.options.cleanOnClose||t)&&(i.i(s.a)(this.$el,this.remove.bind(this)),-1!==u.indexOf(this)&&u.splice(u.indexOf(this),1)),this.hide(),this)},close:function(e){return this._close(null,e)},replaceWith:function(e){return this.close(),e.open(),e},center:function(){var e=this.$(".popup"),t=this.$(".popup-overlay"),i=n()(window).width(),r=n()(window).height(),a=n()(document).height(),o=e.width(),s=e.height(),u=n()(document).scrollTop(),l=r/2-s/2+u,c=i/2-o/2;s>r&&(l+=(s-r)/2),t.width(i),t.height(a),e.css({left:c,top:l});var h=c+o/2+"px",d=l+s/2+"px",p=h+" "+d;document.getElementsByClassName("popup-container")[0].style.perspectiveOrigin=p},resize:function(e){var t=this.$(".popup");return e.width&&t.width(e.width),e.height&&t.height(e.height),this},autofocus:function(){var e=window.scrollX,t=window.scrollY;this.$el.find(".form-input:visible").length>0?(this.$el.find(".form-input").eq(0).focus(),window.scrollTo(e,t)):(this.$el.find(".btn-primary, .submit").focus(),window.scrollTo(e,t))},remove:function(){return this.undelegateEvents(),o.a.prototype.remove.apply(this,arguments)}})},,function(e,t,i){"use strict";function r(e,t){u.console&&(u.console[e](t),u.traceLogCall&&"error"!==e&&console.trace())}function n(e,t,i){u.console&&(u.console.groupCollapsed&&u.console.groupCollapsed(t),u.console[e](i),u.traceLogCall&&"error"!==e&&console.trace(),u.console.groupEnd&&u.console.groupEnd())}function a(e,t){return t?[e.slice(0,4),e.slice(4,8),e.slice(8,12),e.slice(12,16)]:[[e[0],e[4],e[8],e[12]],[e[1],e[5],e[9],e[13]],[e[2],e[6],e[10],e[14]],[e[3],e[7],e[11],e[15]]]}function o(e,t){u.console.table&&r("table",a(e,t))}function s(e,t,i){u.console.table&&n("table",e,a(t,i))}var u={};u.DEBUG=0,u.INFO=1,u.NOTICE=u.LOG=2,u.WARN=3,u.ERROR=4,u.console=window.console;for(var l=["log","info","warn","error","debug"],c={},h=0;h<l.length;++h){var d=l[h];c[d]=r.bind(u,d),c[d+"Fold"]=n.bind(u,d),c[d+"Matrix"]=o.bind(u),c[d+"MatrixFold"]=s.bind(u)}var p=function(e,t){void 0===this.console||e||this.console.assert(e,t)};u.assert=p,u.setNotifyLevel=function(e){for(var t=function(){},i=0;i<l.length;++i){var r=l[i],n=e>u[r.toUpperCase()];u[r]=n?t:c[r],u[r+"Fold"]=n?t:c[r+"Fold"],u[r+"Matrix"]=n?t:c[r+"Matrix"],u[r+"MatrixFold"]=n?t:c[r+"MatrixFold"]}u.notice=u.log,u.noticeFold=u.logFold,u.noticeMatrix=u.logMatrix,u.noticeMatrixFold=u.logMatrixFold},u.setNotifyLevel(u.NOTICE),u.reportWebGLError=!1,u.setConsole=function(e){u.console=e},e.exports=u},function(e,t,i){"use strict";var r,n=i(0),a=(i.n(n),i(1141)),o=i.n(a),s=i(21),u=i(729),l=i(90),c=i(299),h=i(7),d=function(e){if(null!==e&&void 0!==e)return"+Infinity"===e||"Infinity"===e?1/0:"-Infinity"===e?-1/0:e},p=function(){var e={};for(var t in o.a){var r=o.a[t],a=d(r.defaultValue),u=void 0;if(void 0!==r.alias)for(var l in r.alias)if(void 0!==(u=s.a[r.type](l)))break;e[i.i(n.camelCase)(t)]=void 0!==u?u:s.a[r.type](t,a)}return e},f=function(){if(r)return r;if(window.prefetchedData.embedOptions){r=window.prefetchedData.embedOptions;for(var e in r)r[e]=d(r[e])}else r=p();try{h.a.me().get("isStaff")&&void 0===r.webgl2&&(r.webgl2=!0)}catch(e){console.warn("Prefetching failure while trying to reach User.me(). This is probably because this code has been run in a non web context where prefetchdata are unusable.")}r.annotationCycleAutostart=void 0!==r.annotationCycle,r.annotationCycleDuration=void 0===r.annotationCycle?5e3:1e3*r.annotationCycle,delete r.annotationCycle,(r.cardboard||r.annotation)&&(r.camera=!1),r.stats&&(r.continuousRender=!0),r.processOptions&&i.i(c.a)(!0),r.processOptions&&(r.processMaterial=!0);var t=!i.i(c.a)()&&!i.i(l.a)()&&"1.0.0"!==r.apiVersion&&!r.materialShowcase;return void 0===r.mergeMaterials&&(r.mergeMaterials=t),void 0===r.graphOptimizer&&(r.graphOptimizer=t),void 0===r.materialPacking&&(r.materialPacking="1.0.0"!==r.apiVersion&&!r.materialShowcase),i.i(u.a)(r),r};t.a=f},,,,,,,,function(e,t,i){"use strict";t.a=function(e){var t=Array.prototype.slice.call(arguments,1),i=e.bind.apply(e,t);return i(),i}},function(e,t,i){i(348),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/buttons.jinja"]=function(){function e(e,t,i,r,n){var a=null,o=null,s="";try{var u=null;e.getTemplate("skfb_front/macros/popovers.jinja",!1,"skfb_front/macros/buttons.jinja",!1,function(l,c){if(l)return void n(l);c.getExported(function(l,c){if(l)return void n(l);if(!c.hasOwnProperty("share_popover"))return void n(new Error("cannot import 'share_popover'"));var h=c.share_popover;t.setVariable("share_popover",h),s+="\n\n";var d=r.makeMacro(["authUser","user"],["options"],function(t,n,a){var o=i;i=new r.Frame,a=a||{},a.hasOwnProperty("caller")&&i.set("caller",a.caller),i.set("authUser",t),i.set("user",n),i.set("options",a.hasOwnProperty("options")?a.options:{});var s="";return s+='\n\n    <span class="toggle-button follow-user-button btn-loading" data-action="follow" data-user="',s+=r.suppressValue(r.memberLookup(n,"uid"),e.opts.autoescape),s+='">\n        <a class="button btn-primary toggle btn-disabled">\n            <i class="icon fa fa-plus"></i>\n            Follow\n        </a>\n        <a class="button btn-important untoggle">\n            <span class="toggled">\n                Following\n            </span>\n            <span class="untoggled">\n                Unfollow\n            </span>\n        </a>\n    </span>\n\n',i=o,new r.SafeString(s)});t.addExport("follow_button"),t.setVariable("follow_button",d),s+="\n\n";var p=r.makeMacro(["authUser"],["options"],function(n,s){var u=i;i=new r.Frame,s=s||{},s.hasOwnProperty("caller")&&i.set("caller",s.caller),i.set("authUser",n),i.set("options",s.hasOwnProperty("options")?s.options:{});var l="";return l+='\n\n    <div class="button btn-medium btn-secondary btn-loading like like-button popover-container btn-disabled" data-action="like-model">\n        <i class="icon fa fa-star"></i>\n        Like\n        ',r.memberLookup(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"popover"),"display")&&(l+="\n            ",l+=r.suppressValue((a=27,o=26,r.callWrap(r.contextOrFrameLookup(t,i,"share_popover"),"share_popover",t,[{class:r.memberLookup(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"popover"),"arrow")}])),e.opts.autoescape),l+="\n        "),l+="\n    </div>\n\n",i=u,new r.SafeString(l)});t.addExport("like_button"),t.setVariable("like_button",p),s+="\n\n";var f=r.makeMacro(["authUser"],["options"],function(n,s){var u=i;i=new r.Frame,s=s||{},s.hasOwnProperty("caller")&&i.set("caller",s.caller),i.set("authUser",n),i.set("options",s.hasOwnProperty("options")?s.options:{});var l="";return l+='\n\n    <div class="help like-button star-like-button btn-loading popover-container',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"buttonClass")&&(l+=" ",l+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"buttonClass"),e.opts.autoescape)),l+='" data-action="like-model">\n        ',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"count")&&r.memberLookup(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"count"),"display")&&(l+='\n            <span class="count">',l+=r.suppressValue(r.memberLookup(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"count"),"like"),e.opts.autoescape),l+="</span>\n        "),l+='\n        <span class="tooltip liked-content',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"tooltipClass")?(l+=" ",l+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"tooltipClass"),e.opts.autoescape)):l+=" tooltip-down",l+='">Like</span>\n        <span class="tooltip unliked-content',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"tooltipClass")?(l+=" ",l+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"tooltipClass"),e.opts.autoescape)):l+=" tooltip-down",l+='">Unlike</span>\n        ',r.memberLookup(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"popover"),"display")&&(l+="\n            ",l+=r.suppressValue((a=42,o=26,r.callWrap(r.contextOrFrameLookup(t,i,"share_popover"),"share_popover",t,[{class:r.memberLookup(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"popover"),"arrow")}])),e.opts.autoescape),l+="\n        "),l+="\n    </div>\n\n",i=u,new r.SafeString(l)});t.addExport("star_like_button"),t.setVariable("star_like_button",f),s+="\n\n";var g=r.makeMacro(["model"],["options"],function(n,a){var o=i;i=new r.Frame,a=a||{},a.hasOwnProperty("caller")&&i.set("caller",a.caller),i.set("model",n),i.set("options",a.hasOwnProperty("options")?a.options:{});var s="";return s+='\n\n    <a class="',s+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"className"),e.opts.autoescape),s+=' help" itemprop="discussionUrl" href="',s+=r.suppressValue(r.memberLookup(n,"viewerUrl"),e.opts.autoescape),s+='#comments" data-action="go-to-comments">\n        <span class="count">\n            ',s+=r.suppressValue(e.getFilter("humanize_number").call(t,r.memberLookup(n,"commentCount")),e.opts.autoescape),s+='\n        </span>\n        <span class="tooltip tooltip-up">Comment</span>\n    </a>\n\n',i=o,new r.SafeString(s)});t.addExport("comments_button"),t.setVariable("comments_button",g),s+="\n\n";var m=r.makeMacro(["authUser"],["options"],function(n,s){var u=i;i=new r.Frame,s=s||{},s.hasOwnProperty("caller")&&i.set("caller",s.caller),i.set("authUser",n),i.set("options",s.hasOwnProperty("options")?s.options:{});var l="";return l+='\n\n    <div class="help subscribe-button count-subscribe-button btn-loading popover-container',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"buttonClass")&&(l+=" ",l+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"buttonClass"),e.opts.autoescape)),l+='" data-action="subscribe-collection">\n        ',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"count")&&r.memberLookup(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"count"),"display")&&(l+='\n            <span class="count">',l+=r.suppressValue(r.memberLookup(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"count"),"subscribe"),e.opts.autoescape),l+="</span>\n        "),l+='\n        <span class="tooltip subscribed-content',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"tooltipClass")?(l+=" ",l+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"tooltipClass"),e.opts.autoescape)):l+=" tooltip-down",l+='">Subscribe</span>\n        <span class="tooltip unsubscribed-content',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"tooltipClass")?(l+=" ",l+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"tooltipClass"),e.opts.autoescape)):l+=" tooltip-down",l+='">Unsubscribe</span>\n        ',r.memberLookup(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"popover"),"display")&&(l+="\n            ",l+=r.suppressValue((a=68,o=26,r.callWrap(r.contextOrFrameLookup(t,i,"share_popover"),"share_popover",t,[{class:r.memberLookup(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"popover"),"arrow")}])),e.opts.autoescape),l+="\n        "),l+="\n    </div>\n\n",i=u,new r.SafeString(l)});t.addExport("subscribe_button_count"),t.setVariable("subscribe_button_count",m),s+="\n\n";var v=r.makeMacro(["collection"],[],function(t,n){var a=i;i=new r.Frame,n=n||{},n.hasOwnProperty("caller")&&i.set("caller",n.caller),i.set("collection",t);var o="";return o+='\n\n    <span class="toggle-button addto-button" data-collection="',o+=r.suppressValue(r.memberLookup(t,"uid"),e.opts.autoescape),o+='">\n        <a class="button btn-small btn-primary toggle">\n            Add\n        </a>\n        <a class="button btn-small btn-important untoggle">\n            <span class="toggled">\n                Added\n            </span>\n            <span class="untoggled">\n                Remove\n            </span>\n        </a>\n    </span>\n\n',i=a,new r.SafeString(o)});t.addExport("add_to_collection_button"),t.setVariable("add_to_collection_button",v),s+="\n\n";var _=r.makeMacro(["collection"],[],function(t,n){var a=i;i=new r.Frame,n=n||{},n.hasOwnProperty("caller")&&i.set("caller",n.caller),i.set("collection",t);var o="";return o+='\n\n    <span class="toggle-button subscribe-collection-button btn-loading" data-action="subscribe-collection" data-collection="',o+=r.suppressValue(r.memberLookup(t,"uid"),e.opts.autoescape),o+='">\n        <div class="subscribe">\n            <a class="button btn-medium btn-primary btn-disabled toggle">\n                <i class="icon fa fa-rss"></i>\n                Subscribe\n            </a>\n            <a class="button btn-medium btn-important untoggle">\n                <i class="icon icon-fixed-left fa fa-rss"></i>\n                <span class="toggled">\n                    Subscribed\n                </span>\n                <span class="untoggled">\n                    Unsubscribe\n                </span>\n            </a>\n        </div>\n    </span>\n\n',i=a,new r.SafeString(o)});t.addExport("subscribe_button"),t.setVariable("subscribe_button",_),s+="\n\n";var b=r.makeMacro([],[],function(e){var t=i;i=new r.Frame,e=e||{},e.hasOwnProperty("caller")&&i.set("caller",e.caller);var n="";return n+='\n\n    <a class="button btn-medium btn-secondary" data-action="open-collection-popup">\n        <div class="add-to">\n            <i class="icon fa fa-plus"></i>\n            Add to\n        </div>\n    </a>\n\n',i=t,new r.SafeString(n)});t.addExport("add_to_open_popup"),t.setVariable("add_to_open_popup",b),s+="\n\n";var x=r.makeMacro([],[],function(e){var t=i;i=new r.Frame,e=e||{},e.hasOwnProperty("caller")&&i.set("caller",e.caller);var n="";return n+='\n\n    <li class="item create-collection">\n        <div class="collection-addcard" data-action="open-create-collection-popup">\n            <div class="thumbnail create-new-collection">\n                <i class="icon fa fa-plus"></i>\n            </div>\n            <div class="js-title">\n                Create new collection\n            </div>\n        </div>\n    </li>\n\n',i=t,new r.SafeString(n)});t.addExport("open_create_collection"),t.setVariable("open_create_collection",x),s+="\n",u?u.rootRenderFunc(e,t,i,r,n):n(null,s)})})}catch(e){n(r.handleError(e,a,o))}}return{root:e}}()}()},function(e,t,i){i(40),i(47),i(71),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/model.jinja"]=function(){function e(e,t,r,n,a){var o=null,s=null,u="";try{var l=null;e.getTemplate("skfb_front/macros/buttons.jinja",!1,"skfb_front/macros/model.jinja",!1,function(c,h){if(c)return void a(c);h.getExported(function(c,h){if(c)return void a(c);if(!h.hasOwnProperty("star_like_button"))return void a(new Error("cannot import 'star_like_button'"));var d=h.star_like_button;t.setVariable("star_like_button",d),u+="\n",e.getTemplate("skfb_front/macros/user.jinja",!1,"skfb_front/macros/model.jinja",!1,function(c,h){if(c)return void a(c);h.getExported(function(c,h){if(c)return void a(c);if(!h.hasOwnProperty("user_name"))return void a(new Error("cannot import 'user_name'"));var d=h.user_name;if(t.setVariable("user_name",d),!h.hasOwnProperty("user_avatar"))return void a(new Error("cannot import 'user_avatar'"));var p=h.user_avatar;t.setVariable("user_avatar",p),u+="\n",e.getTemplate("skfb_front/macros/utils.jinja",!1,"skfb_front/macros/model.jinja",!1,function(c,h){if(c)return void a(c);h.getExported(function(c,h){if(c)return void a(c);if(!h.hasOwnProperty("humanize_count"))return void a(new Error("cannot import 'humanize_count'"));var d=h.humanize_count;t.setVariable("humanize_count",d),u+="\n\n";var p=n.makeMacro(["model"],["options"],function(i,a){var o=r;r=new n.Frame,a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("model",i),r.set("options",a.hasOwnProperty("options")?a.options:{});var s="";s+="\n    ";var u;u=e.getFilter("merge").call(t,{withStaffpickFlag:!0,withStaffpickLink:!1,withRestrictedFlag:!0},n.contextOrFrameLookup(t,r,"options")),r.set("options",u,!0),r.topLevel&&t.setVariable("options",u),r.topLevel&&t.addExport("options",u),s+="\n    ";var l;return l=n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"displayJustStaffPicked")&&n.memberLookup(i,"justStaffPicked"),r.set("justStaffPicked",l,!0),r.topLevel&&t.setVariable("justStaffPicked",l),r.topLevel&&t.addExport("justStaffPicked",l),s+="\n\n    ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"withStaffpickLink")&&n.memberLookup(i,"staffpickedAt")?s+='\n        <meta itemprop="award" content="Staff Pick" />\n        <a href="/models/staffpicks" class="flag --staffpicked" title="See all staff picks"></a>\n    ':n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"withStaffpickFlag")&&n.memberLookup(i,"staffpickedAt")&&(s+='\n        <meta itemprop="award" content="Staff Pick" />\n        <span class="flag --staffpicked ',n.contextOrFrameLookup(t,r,"justStaffPicked")&&(s+="--with-text"),s+='" title="Staff Picks"></span>\n    '),s+="\n\n    ",(n.memberLookup(i,"isRestricted")||n.memberLookup(i,"isAdult"))&&(s+="\n        ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"withRestrictedFlag")&&(s+='\n            <a\n                href="https://help.sketchfab.com/hc/en-us/articles/214867883-Age-Restricted-Content"\n                class="flag --restricted"\n                title="Age-restricted content"></a>\n        '),s+="\n    "),s+="\n",r=o,new n.SafeString(s)});t.addExport("model_labels"),t.setVariable("model_labels",p),u+="\n\n";var f=n.makeMacro(["authUser","model"],["options"],function(i,a,u){var l=r;r=new n.Frame,u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var c="";c+="\x3c!--\n\n    ";var h;return h=e.getFilter("merge").call(t,{clickable:!0},n.contextOrFrameLookup(t,r,"options")),r.set("options",h,!0),r.topLevel&&t.setVariable("options",h),r.topLevel&&t.addExport("options",h),c+='\n\n    --\x3e<span class="model-name">\n\n        ',n.memberLookup(a,"isProtected")?c+='\n            <i class="model-name__icon fa fa-lock --protected"></i>\n        ':n.memberLookup(a,"isPrivate")&&(c+='\n            <i class="model-name__icon custom-icons icon-private --private"></i>\n        '),c+="\n\n        ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"clickable")?(c+='\n            <a class="model-name__label" href="',c+=n.suppressValue(n.memberLookup(a,"viewerUrl"),e.opts.autoescape),c+='"',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"target")&&(c+=' target="',c+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"target"),e.opts.autoescape),c+='"'),c+=' title="',c+=n.suppressValue(n.memberLookup(a,"name"),e.opts.autoescape),c+='">',c+=n.suppressValue(n.memberLookup(a,"name"),e.opts.autoescape),c+="</a>\n        "):(c+='\n            <span class="model-name__label">',c+=n.suppressValue(n.memberLookup(a,"name"),e.opts.autoescape),c+="</span>\n        "),c+="\n\n        ",c+=n.suppressValue((o=44,s=21,n.callWrap(n.contextOrFrameLookup(t,r,"model_labels"),"model_labels",t,[a,n.contextOrFrameLookup(t,r,"options")])),e.opts.autoescape),c+="\n\n    </span>\x3c!--\n\n--\x3e",r=l,new n.SafeString(c)});t.addExport("model_name"),t.setVariable("model_name",f),u+="\n\n";var g=n.makeMacro(["authUser","list"],["options"],function(i,a,u){var l=r;r=new n.Frame,u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("list",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var c="";c+="\x3c!--\n    ";var h;h=e.getFilter("merge").call(t,{maxDisplayed:3},n.contextOrFrameLookup(t,r,"options")),r.set("options",h,!0),r.topLevel&&t.setVariable("options",h),r.topLevel&&t.addExport("options",h),c+="\n    ";var d;d=e.getFilter("first_n").call(t,a,n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"maxDisplayed")),r.set("shortList",d,!0),r.topLevel&&t.setVariable("shortList",d),r.topLevel&&t.addExport("shortList",d),c+="\n    ";var p;p=e.getFilter("length").call(t,a)-e.getFilter("length").call(t,n.contextOrFrameLookup(t,r,"shortList")),r.set("otherCount",p,!0),r.topLevel&&t.setVariable("otherCount",p),r.topLevel&&t.addExport("otherCount",p),c+="\n\n\n    ",r=r.push();var f=n.contextOrFrameLookup(t,r,"shortList");if(f)for(var g=f.length,m=0;m<f.length;m++){var v=f[m];r.set("model",v),r.set("loop.index",m+1),r.set("loop.index0",m),r.set("loop.revindex",g-m),r.set("loop.revindex0",g-m-1),r.set("loop.first",0===m),r.set("loop.last",m===g-1),r.set("loop.length",g),c+="\n        ",n.memberLookup(n.contextOrFrameLookup(t,r,"loop"),"first")||(c+="\n            ",n.memberLookup(n.contextOrFrameLookup(t,r,"loop"),"last")&&n.contextOrFrameLookup(t,r,"otherCount")<1?c+="\n            --\x3e<span> and </span>\x3c!--\n            ":c+="\n        --\x3e<span>, </span>\x3c!--\n        ",c+="\n        "),c+="\n        --\x3e",c+=n.suppressValue((o=66,s=22,n.callWrap(n.contextOrFrameLookup(t,r,"model_name"),"model_name",t,[i,v,{withStaffpickFlag:!1,withStaffpickLink:!1,withRestrictedFlag:!1}])),e.opts.autoescape),c+="\x3c!--\n    "}return r=r.pop(),c+="\n\n    ",n.contextOrFrameLookup(t,r,"otherCount")>0&&(c+='\n--\x3e<span class="others"> and ',c+=n.suppressValue(n.contextOrFrameLookup(t,r,"otherCount"),e.opts.autoescape),c+=" other",c+=n.suppressValue(e.getFilter("pluralize").call(t,n.contextOrFrameLookup(t,r,"otherCount")),e.opts.autoescape),c+="</span>\x3c!--\n    "),c+="\n--\x3e",r=l,new n.SafeString(c)});t.addExport("model_name_list"),t.setVariable("model_name_list",g),u+="\n\n";var m=n.makeMacro(["authUser","model"],["options"],function(i,a,o){var s=r;r=new n.Frame,o=o||{},o.hasOwnProperty("caller")&&r.set("caller",o.caller),r.set("authUser",i),r.set("model",a),r.set("options",o.hasOwnProperty("options")?o.options:{});var u="";u+="\n\n    ";var l;return l=e.getFilter("merge").call(t,{withPublish:!0,with3DSettings:!0},n.contextOrFrameLookup(t,r,"options")),r.set("options",l,!0),r.topLevel&&t.setVariable("options",l),r.topLevel&&t.addExport("options",l),u+='\n\n    <ul class="hover-menu quicksettings corner',"up"==n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"direction")&&(u+=" hover-menu-up"),"left"==n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"direction")&&(u+=" hover-menu-left"),u+='">\n\n        ',2==n.memberLookup(a,"processingStatus")&&(u+="\n            ",!n.memberLookup(a,"publishedAt")&&n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"withPublish")&&(u+='\n                <li><a data-action="publish">Publish</a></li>\n                <li class="separator"></li>\n            '),u+='\n\n            <li><a data-action="open-settings-popup">Properties</a></li>\n\n            ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"with3DSettings")&&(u+='\n            <li><a href="',u+=n.suppressValue(n.memberLookup(a,"editorUrl"),e.opts.autoescape),u+='" data-action="settings3d-button">3D settings</a></li>\n            '),u+="\n\n            ",n.memberLookup(a,"publishedAt")&&(u+='\n                <li><a data-action="open-collection-popup">Add to collection</a></li>\n            '),u+='\n\n            <li class="separator"></li>\n\n        '),u+="\n\n        ",n.memberLookup(a,"processingStatus")>1&&(u+='\n            <li><a data-action="open-reupload-popup">Re-upload</a></li>\n            <li><a class="--red" data-action="delete-model">Delete</a></li>\n        '),u+='\n        <li><a data-action="report-issue">Report an issue</a></li>\n\n    </ul>\n\n',r=s,new n.SafeString(u)});t.addExport("model_quicksettings"),t.setVariable("model_quicksettings",m),u+="\n\n";var v=n.makeMacro([],[],function(e){var t=r;r=new n.Frame,e=e||{},e.hasOwnProperty("caller")&&r.set("caller",e.caller);var i="";return i+='\n\n    <div class="card-preview" data-action="open-preview">\n        <i class="card-preview__icon fa fa-search" title="see preview"></i>\n    </div>\n\n',r=t,new n.SafeString(i)});t.addExport("preview_link"),t.setVariable("preview_link",v),u+="\n\n";var _=n.makeMacro(["authUser","model"],["options"],function(e,i,a){var o=r;r=new n.Frame,a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("authUser",e),r.set("model",i),r.set("options",a.hasOwnProperty("options")?a.options:{});var s="";return s+='\n\n    <ul class="hover-menu quicksettings corner',"up"==n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"direction")&&(s+=" hover-menu-up"),"left"==n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"direction")&&(s+=" hover-menu-left"),s+='">\n        <li><a data-action="remove-model">Remove</a></li>\n    </ul>\n\n',r=o,new n.SafeString(s)});t.addExport("collection_item_quicksettings"),t.setVariable("collection_item_quicksettings",_),u+="\n\n";var b=n.makeMacro(["authUser","model"],["options"],function(i,a,u){var l=r;r=new n.Frame,u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var c="";return c+='\n\n    <meta itemprop="commentCount" content="',c+=n.suppressValue(n.memberLookup(a,"commentCount"),e.opts.autoescape),c+='" />\n    <meta itemprop="contentSize" content="',c+=n.suppressValue(e.getFilter("humanize_number").call(t,e.getFilter("default").call(t,n.memberLookup(a,"archiveSize"),0)),e.opts.autoescape),c+='B" />\n    <meta itemprop="discussionUrl" content="',c+=n.suppressValue(n.memberLookup(a,"viewerUrl"),e.opts.autoescape),c+='#comments" />\n    <meta itemprop="isBasedOnUrl" content="',c+=n.suppressValue(n.memberLookup(a,"viewerUrl"),e.opts.autoescape),c+='/editor" />\n\n    <div class="model-smallcard" data-link="',c+=n.suppressValue(n.memberLookup(a,"viewerUrl"),e.opts.autoescape),c+='">\n\n        <a class="thumbnail" itemprop="url" href="',c+=n.suppressValue(n.memberLookup(a,"viewerUrl"),e.opts.autoescape),c+='">\n            ',c+=n.suppressValue(e.getFilter("image_container").call(t,n.memberLookup(a,"thumbnails"),125,80),e.opts.autoescape),c+='\n        </a>\n\n        <div class="meta">\n            <div class="name" itemprop="name">\n                ',c+=n.suppressValue((o=145,s=27,n.callWrap(n.contextOrFrameLookup(t,r,"model_name"),"model_name",t,[i,a])),e.opts.autoescape),c+='\n            </div>\n\n            <div class="stats">\n                ',n.memberLookup(a,"commentCount")>0&&(c+='\n                    <a class="model-card-comments" href="',c+=n.suppressValue(n.memberLookup(a,"viewerUrl"),e.opts.autoescape),c+='#comments">\n                        ',c+=n.suppressValue(e.getFilter("humanize_number").call(t,n.memberLookup(a,"commentCount")),e.opts.autoescape),c+="\n                    </a>\n                "),c+='\n                <div class="views">\n                    ',c+=n.suppressValue(e.getFilter("humanize_number").call(t,n.memberLookup(a,"viewCount")),e.opts.autoescape),c+="\n                </div>\n\n                ",c+=n.suppressValue((o=158,s=33,n.callWrap(n.contextOrFrameLookup(t,r,"star_like_button"),"star_like_button",t,[i,n.makeKeywordArgs({options:{count:{display:!0,like:(o=161,s=46,n.callWrap(n.contextOrFrameLookup(t,r,"humanize_count"),"humanize_count",t,[n.memberLookup(a,"likeCount")]))},popover:{display:!0,arrow:"down-arrow middle-arrow"},buttonClass:"card__footer__stats --likes",tooltipClass:"tooltip-up"}})])),e.opts.autoescape),c+="\n\n            </div>\n        </div>\n\n    </div>\n\n",r=l,new n.SafeString(c)});t.addExport("model_smallcard"),t.setVariable("model_smallcard",b),u+="\n\n\n";var x=n.makeMacro(["authUser","model"],["options"],function(i,a,u){var l=r;r=new n.Frame,u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var c="";return c+='\n\n    <div class="model-uploadcard">\n\n        <h3 class="filename">\n            <a href="',c+=n.suppressValue(n.memberLookup(a,"viewerUrl"),e.opts.autoescape),c+='">',n.memberLookup(a,"name")?c+=n.suppressValue((o=187,s=31,n.callWrap(n.contextOrFrameLookup(t,r,"model_name"),"model_name",t,[i,a,{withStaffpickFlag:!1}])),e.opts.autoescape):c+=n.suppressValue(e.getFilter("default").call(t,n.memberLookup(a,"originalFileName"),"No file name"),e.opts.autoescape),c+='</a>\n        </h3>\n        <div class="meta">',n.memberLookup(a,"name")&&(c+='<span class="original-filename">\n                    ',c+=n.suppressValue(e.getFilter("default").call(t,n.memberLookup(a,"originalFileName"),"No file name"),e.opts.autoescape),c+="\n                </span>"),n.memberLookup(a,"processedAt")?(c+='\n                <span class="date" title="',c+=n.suppressValue(n.memberLookup(a,"processedAt"),e.opts.autoescape),c+='">',c+=n.suppressValue(e.getFilter("time_ago").call(t,n.memberLookup(a,"processedAt")),e.opts.autoescape),c+="</span>\n            "):(c+='\n                <span class="date" title="',c+=n.suppressValue(n.memberLookup(a,"createdAt"),e.opts.autoescape),c+='">',c+=n.suppressValue(e.getFilter("time_ago").call(t,n.memberLookup(a,"createdAt")),e.opts.autoescape),c+="</span>\n            "),c+='\n        </div>\n\n        <div class="status">',0==n.memberLookup(a,"processingStatus")?c+='<div class="help">\n                    <i class="icon spinner-small-slow"></i>\n                    <div class="tooltip tooltip-down">Pending</div>\n                </div>':1==n.memberLookup(a,"processingStatus")?c+='<div class="help">\n                    <i class="icon spinner-small"></i>\n                    <div class="tooltip tooltip-down">Processing</div>\n                </div>':2==n.memberLookup(a,"processingStatus")?n.memberLookup(a,"isPublished")?c+='<div class="help">\n                        <i class="icon fa fa-check"></i>\n                        <div class="tooltip tooltip-down">Published</div>\n                    </div>':(c+='<button type="button" class="button btn-important btn-medium" data-action="publish">\n                        Publish\n                    </button>\n\n                    <a href="/models/',c+=n.suppressValue(n.memberLookup(a,"uid"),e.opts.autoescape),c+='/edit" class="button btn-tertiary btn-medium btn-edit" data-action="edit">\n                        3D Settings\n                    </a>'):3==n.memberLookup(a,"processingStatus")&&(c+='<div class="help">\n                    <i class="icon fa fa-times"></i>\n                    <div class="tooltip tooltip-down">Error</div>\n                </div>'),c+='</div>\n\n        <div class="model-uploadcard-settings">\n            <div class="button btn-medium btn-tertiary"',n.memberLookup(a,"processingStatus")<2&&(c+=" disabled"),c+='>\n                <i class="fa fa-cog"></i>\n                ',c+=n.suppressValue((o=255,s=36,n.callWrap(n.contextOrFrameLookup(t,r,"model_quicksettings"),"model_quicksettings",t,[i,a,{direction:"left",withPublish:!1}])),e.opts.autoescape),c+="\n            </div>\n        </div>\n\n    </div>\n\n",r=l,new n.SafeString(c)});t.addExport("model_uploadcard"),t.setVariable("model_uploadcard",x),u+="\n\n\n";var S=n.makeMacro(["authUser"],["options"],function(i,a){var o=r;r=new n.Frame,a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("authUser",i),r.set("options",a.hasOwnProperty("options")?a.options:{});var s="";return s+='\n\n    <div class="annotation" data-hotspot="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"hotspotIndex"),e.opts.autoescape),s+='">\n\n        <div class="tooltip">\n\n            ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"editMode")?s+='\n                <form class="tooltip-content padded">\n                    <div class="edition">\n                            <input class="title" placeholder="Title *" maxlength="64" required>\n                            <textarea class="description" placeholder="Description" maxlength="1024" rows="2"></textarea>\n                    </div>\n                    <div class="render tooltip-content padded">\n                        <div class="title"></div>\n                        <div class="description markdown-rendered-content inversed"></div>\n                    </div>\n                    <div class="meta">\n                        <button type="submit" class="submit button btn-small">OK</button>\n                        <i class="fa fa-eye activate-render"></i>\n                        <i class="fa fa-pencil activate-edition selected"></i>\n                    </div>\n                </form>\n            ':s+='\n\n                <div class="tooltip-content">\n                    <div class="tooltip-content-minimal">\n                        <div class="title"></div>\n                        <a href="#" class="more">+ more info</a>\n                    </div>\n                    <div class="title"></div>\n                    <div class="description markdown-rendered-content inversed"></div>\n                </div>\n\n            ',s+="\n\n        </div>\n\n    </div>\n\n",r=o,new n.SafeString(s)});t.addExport("model_hotspot"),t.setVariable("model_hotspot",S),u+="\n\n\n";var y=n.makeMacro([],["options"],function(i){var a=r;r=new n.Frame,i=i||{},i.hasOwnProperty("caller")&&r.set("caller",i.caller),r.set("options",i.hasOwnProperty("options")?i.options:{});var u="";u+="\n\n";var l;l=30,r.set("width_before",l,!0),r.topLevel&&t.setVariable("width_before",l),r.topLevel&&t.addExport("width_before",l),u+="\n";var c;c=960,r.set("width_next",c,!0),r.topLevel&&t.setVariable("width_next",c),r.topLevel&&t.addExport("width_next",c),u+='\n\n<div class="annotation vr visible" data-hotspot="',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"hotspotIndex"),e.opts.autoescape),u+='" style="width:',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"widthContent"),e.opts.autoescape),u+='px;height:576px;position:absolute;top:30px;left:30px;">\n\n    <div class="tooltip visible" style="width:',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"widthContent"),e.opts.autoescape),u+='px;border-radius:30px;left:0;">\n        <div class="tooltip-content" style="width:',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"widthContent"),e.opts.autoescape),u+='px;height:576px;border-radius:30px;display:flex;flex-direction:column;">\n\n            <div class="title" style="font-size:48px;line-height:1.5;padding:10px 80px 0 80px;">',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"title"),e.opts.autoescape),u+="</div>",r=r.push();var h=(o=318,s=32,n.callWrap(n.contextOrFrameLookup(t,r,"range"),"range",t,[0,n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"column")]));if(h)for(var d=h.length,p=0;p<h.length;p++){var f=h[p];r.set("column",f),r.set("loop.index",p+1),r.set("loop.index0",p),r.set("loop.revindex",d-p),r.set("loop.revindex0",d-p-1),r.set("loop.first",0===p),r.set("loop.last",p===d-1),r.set("loop.length",d),n.contextOrFrameLookup(t,r,"width_before")>30&&(u+='<div class="fa fa-arrow-left" style="font-size:40px;position:absolute;top:250px;left:',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"width_before"),e.opts.autoescape),u+='px"></div>');var g;g=n.contextOrFrameLookup(t,r,"width_before")+1024,r.set("width_before",g,!0),r.topLevel&&t.setVariable("width_before",g),r.topLevel&&t.addExport("width_before",g)}r=r.pop(),u+='<div class="description" style="column-gap:180px;column-count:',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"column"),e.opts.autoescape),u+=';font-size:36px;width:100%;line-height:1.5;padding:10px 80px 0 80px;">',u+=n.suppressValue(e.getFilter("safe").call(t,n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"description")),e.opts.autoescape),u+="</div>",r=r.push();var m=(o=327,s=32,n.callWrap(n.contextOrFrameLookup(t,r,"range"),"range",t,[1,n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"column")]));if(m)for(var v=m.length,_=0;_<m.length;_++){var b=m[_];r.set("column",b),r.set("loop.index",_+1),r.set("loop.index0",_),r.set("loop.revindex",v-_),r.set("loop.revindex0",v-_-1),r.set("loop.first",0===_),r.set("loop.last",_===v-1),r.set("loop.length",v),u+='<div class="fa fa-arrow-right" style="font-size:40px;position:absolute;top:250px;left:',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"width_next"),e.opts.autoescape),u+='px"></div>\n                ';var x;x=n.contextOrFrameLookup(t,r,"width_next")+1024,r.set("width_next",x,!0),r.topLevel&&t.setVariable("width_next",x),r.topLevel&&t.addExport("width_next",x)}r=r.pop(),u+='<div class="footer" style="text-align:left;font-size:36px;justify-content:space-around;bottom:15px;left:0;position:absolute;margin:20px 0 20px 0;">',r=r.push();var S=(o=333,s=40,n.callWrap(n.contextOrFrameLookup(t,r,"range"),"range",t,[0,n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"column")]));if(S)for(var y=S.length,C=0;C<S.length;C++){var T=S[C];r.set("column",T),r.set("loop.index",C+1),r.set("loop.index0",C),r.set("loop.revindex",y-C),r.set("loop.revindex0",y-C-1),r.set("loop.first",0===C),r.set("loop.last",C===y-1),r.set("loop.length",y),u+='<div class="containter-button" style="width:1024px;display:inline-block;text-align:center;">',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"displayNavigation")?u+='<button id="prevButton" class="button" style="background:#444444;">Prev</button>\n                                <button id="closeButton" class="button" style="background:#444444;">Close annotation</button>\n                                <button id="nextButton" class="button" style="background:#444444;">Next</button>':u+='<button id="closeButton" class="button" style="background:#444444;">Close annotation</button>',u+="</div>"}return r=r.pop(),u+="</div>\n\n        </div>\n    </div>\n</div>\n\n",r=a,new n.SafeString(u)});t.addExport("model_hotspot_vr"),t.setVariable("model_hotspot_vr",y),u+="\n\n";var C=n.makeMacro(["src"],["options"],function(i,a){var o=r;r=new n.Frame,a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("src",i),r.set("options",a.hasOwnProperty("options")?a.options:{});var s="";return s+="<iframe",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"class")&&(s+=' class="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"class"),e.opts.autoescape),s+='"'),n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"width")&&(s+=' width="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"width"),e.opts.autoescape),s+='"'),n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"height")&&(s+=' height="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"height"),e.opts.autoescape),s+='"'),s+=' src="',s+=n.suppressValue(i,e.opts.autoescape),s+='" frameborder="0" allowvr allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" onmousewheel=""></iframe>',r=o,new n.SafeString(s)});t.addExport("model_iframe"),t.setVariable("model_iframe",C),u+="\n\n";var T=n.makeMacro(["relatedByAlgo"],[],function(i,a){var u=r;r=new n.Frame,a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("relatedByAlgo",i);var l="";l+='\n    <h5 class="sidebar-title">Suggested models</h5>\n    <ul class="related-algo ',i||(l+="spinner"),l+='">',r=r.push();var c=i;if(c)for(var h=c.length,d=0;d<c.length;d++){var p=c[d];r.set("model",p),r.set("loop.index",d+1),r.set("loop.index0",d),r.set("loop.revindex",h-d),r.set("loop.revindex0",h-d-1),r.set("loop.first",0===d),r.set("loop.last",d===h-1),r.set("loop.length",h),l+=n.suppressValue((o=358,s=36,n.callWrap(n.contextOrFrameLookup(t,r,"model_related_algo_item"),"model_related_algo_item",t,[p])),e.opts.autoescape)}return r=r.pop(),l+="</ul>\n",r=u,new n.SafeString(l)});t.addExport("model_related_algo"),t.setVariable("model_related_algo",T),u+="\n\n";var M=n.makeMacro(["item"],[],function(i,a){var u=r;r=new n.Frame,a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("item",i);var l="";return l+='\n    <li itemprop="workExample" itemscope itemtype="http://schema.org/MediaObject" data-uid="',l+=n.suppressValue(n.memberLookup(i,"uid"),e.opts.autoescape),l+='">',l+=n.suppressValue((o=364,s=120,n.callWrap(n.contextOrFrameLookup(t,r,"model_smallcard"),"model_smallcard",t,[n.contextOrFrameLookup(t,r,"authUser"),i])),e.opts.autoescape),l+="</li>\n",r=u,new n.SafeString(l)});t.addExport("model_related_algo_item"),t.setVariable("model_related_algo_item",M),u+="\n\n";var w=n.makeMacro(["license"],["options"],function(a,o){var s=r;r=new n.Frame,o=o||{},o.hasOwnProperty("caller")&&r.set("caller",o.caller),r.set("license",a),r.set("options",o.hasOwnProperty("options")?o.options:{});var u="";u+="\n\n    ";var l;l=e.getFilter("default").call(t,n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"icon_size"),20),r.set("icon_size",l,!0),r.topLevel&&t.setVariable("icon_size",l),r.topLevel&&t.addExport("icon_size",l),u+="\n\n    ";var c;if(c={"http://creativecommons.org/licenses/by/4.0/":{clauses:["by"],label:"Some rights reserved"},"http://creativecommons.org/licenses/by-sa/4.0/":{clauses:["by","sa"],label:"Some rights reserved"},"http://creativecommons.org/licenses/by-nd/4.0/":{clauses:["by","nd"],label:"Some rights reserved"},"http://creativecommons.org/licenses/by-nc/4.0/":{clauses:["by","nc"],label:"Some rights reserved"},"http://creativecommons.org/licenses/by-nc-sa/4.0/":{clauses:["by","nc","sa"],label:"Some rights reserved"},"http://creativecommons.org/licenses/by-nc-nd/4.0/":{clauses:["by","nc","nd"],label:"Some rights reserved"},"http://creativecommons.org/publicdomain/zero/1.0/":{clauses:["zero"],label:"Public Domain"}},r.set("all_licenses",c,!0),r.topLevel&&t.setVariable("all_licenses",c),r.topLevel&&t.addExport("all_licenses",c),u+="\n\n    ",n.memberLookup(n.contextOrFrameLookup(t,r,"all_licenses"),n.memberLookup(a,"url"))){u+='\n\n        <a href="',u+=n.suppressValue(n.memberLookup(a,"url"),e.opts.autoescape),u+='" rel="license" itemprop="license" class="help" target="_blank">\n            ',r=r.push();var h=n.memberLookup(n.memberLookup(n.contextOrFrameLookup(t,r,"all_licenses"),n.memberLookup(a,"url")),"clauses");if(h)for(var d=h.length,p=0;p<h.length;p++){var f=h[p];r.set("clause",f),r.set("loop.index",p+1),r.set("loop.index0",p),r.set("loop.revindex",d-p),r.set("loop.revindex0",d-p-1),r.set("loop.first",0===p),r.set("loop.last",p===d-1),r.set("loop.length",d),u+="\n                ","by"==f?(u+='\n                    <img src="',u+=n.suppressValue(i(398),e.opts.autoescape),u+='" width="',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"icon_size"),e.opts.autoescape),u+='" height="',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"icon_size"),e.opts.autoescape),u+='" class="icon" />\n                '):"nc"==f?(u+='\n                    <img src="',u+=n.suppressValue(i(399),e.opts.autoescape),u+='" width="',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"icon_size"),e.opts.autoescape),u+='" height="',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"icon_size"),e.opts.autoescape),u+='" class="icon" />\n                '):"sa"==f?(u+='\n                    <img src="',u+=n.suppressValue(i(401),e.opts.autoescape),u+='" width="',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"icon_size"),e.opts.autoescape),u+='" height="',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"icon_size"),e.opts.autoescape),u+='" class="icon" />\n                '):"nd"==f&&(u+='\n                    <img src="',u+=n.suppressValue(i(400),e.opts.autoescape),u+='" width="',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"icon_size"),e.opts.autoescape),u+='" height="',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"icon_size"),e.opts.autoescape),u+='" class="icon" />\n                '),u+="\n            "}r=r.pop(),u+="\n\n            ",u+=n.suppressValue(n.memberLookup(n.memberLookup(n.contextOrFrameLookup(t,r,"all_licenses"),n.memberLookup(a,"url")),"label"),e.opts.autoescape),u+='\n\n            <span class="tooltip tooltip-right">',u+=n.suppressValue(n.memberLookup(a,"fullname"),e.opts.autoescape),u+="</span>\n        </a>\n\n    "}else u+="\n\n        <span>All rights reserved</span>\n\n    ";return u+="\n\n",r=s,new n.SafeString(u)});t.addExport("model_license"),t.setVariable("model_license",w);var A=n.makeMacro(["model"],["options"],function(e,i){var a=r;r=new n.Frame,i=i||{},i.hasOwnProperty("caller")&&r.set("caller",i.caller),r.set("model",e),r.set("options",i.hasOwnProperty("options")?i.options:{});var o="";return n.memberLookup(e,"isProtected")?(o+="\n        ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"withIcons")&&(o+='<i class="icon fa fa-lock protected"></i> '),o+='\n        <span class="label">Only people with password and link will have access</span>\n    '):n.memberLookup(e,"isPrivate")?(o+="\n        ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"withIcons")&&(o+='<i class="icon fa fa-lock private"></i> '),o+='\n        <span class="label">Only people with link will have access</span>\n    '):(o+="\n        ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"withIcons")&&(o+='<i class="icon fa fa-globe"></i> '),o+='\n        <span class="label">Everyone will have access</span>\n    '),r=a,new n.SafeString(o)});t.addExport("model_draft_privacy_description"),t.setVariable("model_draft_privacy_description",A),l?l.rootRenderFunc(e,t,r,n,a):a(null,u)})})})})})})}catch(e){a(n.handleError(e,o,s))}}return{root:e}}()}()},,,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(19)),a=i.n(n),o=i(10),s=i.n(o),u=i(160),l=i(393),c=i(410),h=i(409),d=i(21),p=i(407),f=i(406),g=i(12),m=i.i(u.a)(["initialize"]),v=m(a.a.Collection);t.a=v.extend({mixins:[g.a],optionsTypes:{pageSize:g.b.number,lastPage:g.b.number,firstPage:g.b.number,minOffset:g.b.number,maxOffset:g.b.number,cursor:g.b.shape({previous:g.b.string,next:g.b.string})},defaultOptions:{pageSize:24,minOffset:0,maxOffset:1/0,cursor:{previous:null}},backend:l.a,constructor:function(){this.options=i.i(r.extend)({},this.defaultOptions,i.i(r.pickBy)(arguments[1]||{},function(e){return void 0!==e})),v.apply(this,arguments)},initialize:function(){this.options.backend&&(this.backend=this.options.backend),i.i(p.a)(this,this.backend),i.i(f.a)(this),v.prototype.initialize.apply(this,arguments)},at:function(e){return e<0?void 0:v.prototype.at.call(this,e)},queryParams:function(){return this.isCursorPagination()?{cursor:this._currentCursor,count:i.i(r.result)(this.options,"pageSize")}:{offset:this.options.offset,count:i.i(r.result)(this.options,"pageSize")}},url:function(){var e=i.i(r.result)(this,"domain"),t=i.i(r.result)(this,"endpoint"),n=e+t,a=n+d.a.craft("?",this.queryParams());return a=a.replace(/(?!^)\/{2,}/g,"/")},fetch:function(){return this.previousPromise&&this.previousPromise.cancel(),this.trigger("beforeRequest"),this.previousPromise=s.a.resolve(v.prototype.fetch.apply(this,arguments)).cancellable().catch(function(e){if(!(e instanceof s.a.CancellationError))return s.a.reject(e)}),this.previousPromise.then(function(e){return this.previousPromise=null,this.trigger("afterRequest"),e}.bind(this))},isCursorPagination:function(){return this.pagination&&"cursor"===this.pagination.type},initializePagination:function(e){"offset"===e?this._initializeOffsetPagination():this._initializeCursorPagination()},_initializeCursorPagination:function(){var e=this.options.cursor;this.pagination=i.i(h.a)(e,function(e,t){return this._currentCursor=e,this.fetch(i.i(r.extend)({},t,{reset:!1,add:!1,remove:!1}))}.bind(this))},_initializeOffsetPagination:function(){var e={lastPage:this.options.lastPage,firstPage:this.options.firstPage};this.pagination=i.i(c.a)(e,function(e,t){return this.options.offset=this.options.minOffset+i.i(r.result)(this.options,"pageSize")*e,this.fetch(i.i(r.extend)({},t,{reset:!1,add:!1,remove:!1}))}.bind(this))},loadPreviousPage:function(){return this.pagination.loadPrevious({}).then(function(e){this.add(this.parse(e),{at:0})}.bind(this))},loadNextPage:function(){return this.pagination.loadNext({}).then(function(e){this.add(this.parse(e))}.bind(this))},loadFirstPage:function(e){return this.pagination.loadFirst(e||{}).then(function(e){this.set(this.parse(e))}.bind(this))},loadLatestItems:function(){return this.pagination.loadFirst({allowPrefetching:!1}).then(function(e){this.add(this.parse(e),{at:0})}.bind(this))},prefetchNextPage:function(){return this.pagination.hasNext()?this.pagination.loadNext({isPrefetching:!0}):s.a.resolve()},hasPreviousPage:function(){return this.pagination.hasPrevious()},hasNextPage:function(){return this.pagination.hasNext()}},{extend:function(e,t){var n=i.i(r.extend)({},e,{defaultOptions:i.i(r.extend)({},this.prototype.defaultOptions||{},e.defaultOptions||{}),optionTypes:i.i(r.extend)({},this.prototype.optionTypes||{},e.optionTypes||{})});return v.extend.call(this,n,t)}})},,function(e,t,i){"use strict";var r=i(10),n=i.n(r),a={};a.OSG_VERSION=-1;var o=function(e){var t=n.a.defer(),i=t.promise;a["get"+e]=function(){return i},a["resolve"+e]=function(){!1===i.isFulfilled()&&t.resolve.apply(t,arguments)}};o("Polygon"),o("Wireframe"),o("ModelDisplayed"),o("FirstAnimation"),o("AllAnimations"),o("HasAnimation"),o("FirstCameraAnimation"),o("Material"),o("HasSound"),o("SoundsCanPlayTrough"),o("VrDisplayReady"),o("LowResLoaded"),o("HighResLoaded"),o("LowResBound"),o("HighResBound"),t.a=a},function(e,t,i){i(40),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/user.jinja"]=function(){function e(e,t,i,r,n){var a=null,o=null,s="";try{var u=null;e.getTemplate("skfb_front/macros/buttons.jinja",!1,"skfb_front/macros/user.jinja",!1,function(l,c){if(l)return void n(l);c.getExported(function(l,c){if(l)return void n(l);if(!c.hasOwnProperty("follow_button"))return void n(new Error("cannot import 'follow_button'"));var h=c.follow_button;t.setVariable("follow_button",h),s+="\n\n";var d=r.makeMacro(["authUser","user"],["options"],function(n,a,o){var s=i;i=new r.Frame,o=o||{},o.hasOwnProperty("caller")&&i.set("caller",o.caller),i.set("authUser",n),i.set("user",a),i.set("options",o.hasOwnProperty("options")?o.options:{});var u="";if(u+='\x3c!--\n\n    --\x3e<a class="user-name" href="',u+=r.suppressValue(r.memberLookup(a,"profileUrl"),e.opts.autoescape),u+='"',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"target")&&(u+=' target="',u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"target"),e.opts.autoescape),u+='"'),u+='>\n\n        <div\n            class="wrapper"\n            ',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"withSummary")&&(u+='\n                data-action="show-user-summary"\n            '),u+='\n            data-user="',u+=r.suppressValue(r.memberLookup(a,"uid"),e.opts.autoescape),u+='">\n\n            <data itemprop="url" value="',u+=r.suppressValue(r.memberLookup(a,"profileUrl"),e.opts.autoescape),u+='"></data>\n            ',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"withAvatar")){if(u+='\n                <div\n                    class="avatar"\n                    data-user-summary-anchor="true"\n                    data-user="',u+=r.suppressValue(r.memberLookup(a,"uid"),e.opts.autoescape),u+='">\n                    ',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"avatarWidth")){u+="\n                        ";var l;l=r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"avatarWidth"),i.set("avatarWidth",l,!0),i.topLevel&&t.setVariable("avatarWidth",l),i.topLevel&&t.addExport("avatarWidth",l),u+="\n                    "}else{u+="\n                        ";var c;c=20,i.set("avatarWidth",c,!0),i.topLevel&&t.setVariable("avatarWidth",c),i.topLevel&&t.addExport("avatarWidth",c),u+="\n                    "}if(u+="\n                    ",r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"avatarHeight")){u+="\n                        ";var h;h=r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"avatarHeight"),i.set("avatarHeight",h,!0),i.topLevel&&t.setVariable("avatarHeight",h),i.topLevel&&t.addExport("avatarHeight",h),u+="\n                    "}else{u+="\n                        ";var d;d=r.contextOrFrameLookup(t,i,"avatarWidth"),i.set("avatarHeight",d,!0),i.topLevel&&t.setVariable("avatarHeight",d),i.topLevel&&t.addExport("avatarHeight",d),u+="\n                    "}u+="\n                    ",u+=r.suppressValue(e.getFilter("image_container").call(t,r.memberLookup(a,"avatars"),r.contextOrFrameLookup(t,i,"avatarWidth"),r.contextOrFrameLookup(t,i,"avatarHeight")),e.opts.autoescape),u+="\n                </div>\n            "}return u+='\n\n            <div class="text">\n                ',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"by")&&(u+="by"),u+='\n                <div\n                    class="username-wrapper"\n                    itemprop="name"\n                    title="',u+=r.suppressValue(r.memberLookup(a,"displayName"),e.opts.autoescape),u+='">\n                    ',u+=r.suppressValue(r.memberLookup(a,"displayName"),e.opts.autoescape),u+="\n                </div>\n            </div>\n            ",r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"withoutBadge")||(u+="\n                ",r.memberLookup(a,"accountType")?(u+='\n                    <span class="flag --',u+=r.suppressValue(r.memberLookup(r.memberLookup(a,"accountType"),"badge"),e.opts.autoescape),u+='">',u+=r.suppressValue(r.memberLookup(r.memberLookup(a,"accountType"),"title"),e.opts.autoescape),u+="</span>\n                "):(u+="\n                    ","pro"==r.memberLookup(a,"account")?u+='\n                        <span class="flag --pro">Pro</span>\n                    ':"biz"==r.memberLookup(a,"account")&&(u+='\n                        <span class="flag --biz">Pro</span>\n                    '),u+="\n                "),u+="\n            "),u+="\n\n        </div>\n\n    </a>\x3c!--\n--\x3e",i=s,new r.SafeString(u)});t.addExport("user_name"),t.setVariable("user_name",d),s+="\n\n";var p=r.makeMacro(["authUser","list"],["options"],function(n,s,u){var l=i;i=new r.Frame,u=u||{},u.hasOwnProperty("caller")&&i.set("caller",u.caller),i.set("authUser",n),i.set("list",s),i.set("options",u.hasOwnProperty("options")?u.options:{});var c="";c+="\x3c!--\n\n    ";var h;h=e.getFilter("merge").call(t,{maxDisplayed:3},r.contextOrFrameLookup(t,i,"options")),i.set("options",h,!0),i.topLevel&&t.setVariable("options",h),i.topLevel&&t.addExport("options",h),c+="\n    ";var d;d=e.getFilter("first_n").call(t,s,r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"maxDisplayed")),i.set("shortList",d,!0),i.topLevel&&t.setVariable("shortList",d),i.topLevel&&t.addExport("shortList",d),c+="\n    ";var p;p=e.getFilter("length").call(t,s)-e.getFilter("length").call(t,r.contextOrFrameLookup(t,i,"shortList")),i.set("otherCount",p,!0),i.topLevel&&t.setVariable("otherCount",p),i.topLevel&&t.addExport("otherCount",p),c+="\n\n\n    ",i=i.push();var f=r.contextOrFrameLookup(t,i,"shortList");if(f)for(var g=f.length,m=0;m<f.length;m++){var v=f[m];i.set("user",v),i.set("loop.index",m+1),i.set("loop.index0",m),i.set("loop.revindex",g-m),i.set("loop.revindex0",g-m-1),i.set("loop.first",0===m),i.set("loop.last",m===g-1),i.set("loop.length",g),c+="\n        ",r.memberLookup(r.contextOrFrameLookup(t,i,"loop"),"first")||(c+="\n            ",r.memberLookup(r.contextOrFrameLookup(t,i,"loop"),"last")&&r.contextOrFrameLookup(t,i,"otherCount")<1?c+="\n            --\x3e<span> and </span>\x3c!--\n            ":c+="\n        --\x3e<span>, </span>\x3c!--\n        ",c+="\n        "),c+="\n        --\x3e",c+=r.suppressValue((a=76,o=21,r.callWrap(r.contextOrFrameLookup(t,i,"user_name"),"user_name",t,[n,v,{withoutBadge:!0}])),e.opts.autoescape),c+="\x3c!--\n    "}return i=i.pop(),c+="\n\n    ",r.contextOrFrameLookup(t,i,"otherCount")>0&&(c+='\n--\x3e<span class="others"> and ',c+=r.suppressValue(r.contextOrFrameLookup(t,i,"otherCount"),e.opts.autoescape),c+=" other",c+=r.suppressValue(e.getFilter("pluralize").call(t,r.contextOrFrameLookup(t,i,"otherCount")),e.opts.autoescape),c+="</span>\x3c!--\n    "),c+="\n--\x3e",i=l,new r.SafeString(c)});t.addExport("user_name_list"),t.setVariable("user_name_list",p),s+="\n\n";var f=r.makeMacro(["avatars"],["options"],function(n,a){var o=i;i=new r.Frame,a=a||{},a.hasOwnProperty("caller")&&i.set("caller",a.caller),i.set("avatars",n),i.set("options",a.hasOwnProperty("options")?a.options:{});var s="";s+="\n\n    ";var u;return u=e.getFilter("merge").call(t,{size:32,expand:!1},r.contextOrFrameLookup(t,i,"options")),i.set("options",u,!0),i.topLevel&&t.setVariable("options",u),i.topLevel&&t.addExport("options",u),s+="\n    ",s+=r.suppressValue(e.getFilter("image_container").call(t,n,r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"size"),r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"size"),r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"expand")),e.opts.autoescape),s+="\n\n",i=o,new r.SafeString(s)});t.addExport("user_avatar"),t.setVariable("user_avatar",f),s+="\n\n\n",s+="\n";var g=r.makeMacro(["authUser","user"],["options"],function(n,a,o){var s=i;i=new r.Frame,o=o||{},o.hasOwnProperty("caller")&&i.set("caller",o.caller),i.set("authUser",n),i.set("user",a),i.set("options",o.hasOwnProperty("options")?o.options:{});var u="";return(r.memberLookup(a,"city")||r.memberLookup(a,"country"))&&(r.memberLookup(a,"city")&&(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"microData")&&(u+='<data itemprop="addressLocality">'),u+=r.suppressValue(r.memberLookup(a,"city"),e.opts.autoescape),r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"microData")&&(u+="</data>"),r.memberLookup(a,"country")&&(u+=",")),u+=" ",r.memberLookup(a,"country")&&(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"microData")&&(u+='<data itemprop="addressCountry">'),u+=r.suppressValue(r.memberLookup(a,"country"),e.opts.autoescape),r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"microData")&&(u+="</data>"))),i=s,new r.SafeString(u)});t.addExport("user_location_plaintext"),t.setVariable("user_location_plaintext",g),s+="\n\n";var m=r.makeMacro(["authUser","user"],["options"],function(n,s,u){var l=i;i=new r.Frame,u=u||{},u.hasOwnProperty("caller")&&i.set("caller",u.caller),i.set("authUser",n),i.set("user",s),i.set("options",u.hasOwnProperty("options")?u.options:{});var c="";if(c+="\n\n    ",""!=(a=99,o=31,r.callWrap(r.contextOrFrameLookup(t,i,"user_location_plaintext"),"user_location_plaintext",t,[n,s,r.contextOrFrameLookup(t,i,"options")]))){c+="\n\n        ";var h;h=e.getFilter("merge").call(t,{microData:!0},r.contextOrFrameLookup(t,i,"options")),i.set("options",h,!0),i.topLevel&&t.setVariable("options",h),i.topLevel&&t.addExport("options",h),c+='\n\n        <i class="fa fa-map-marker"></i>\n        <data itemprop="homeLocation" itemscope itemtype="http://schema.org/Place">\n            <data itemprop="address" itemscope itemtype="http://schema.org/PostalAddress">\n            ',c+=r.suppressValue((a=106,o=36,r.callWrap(r.contextOrFrameLookup(t,i,"user_location_plaintext"),"user_location_plaintext",t,[n,s,r.contextOrFrameLookup(t,i,"options")])),e.opts.autoescape),c+="\n            </data>\n        </data>\n    "}return c+="\n\n",i=l,new r.SafeString(c)});t.addExport("user_location"),t.setVariable("user_location",m),s+="\n\n";var v=r.makeMacro(["authUser","user"],["options"],function(n,s,u){var l=i;i=new r.Frame,u=u||{},u.hasOwnProperty("caller")&&i.set("caller",u.caller),i.set("authUser",n),i.set("user",s),i.set("options",u.hasOwnProperty("options")?u.options:{});var c="";return c+='\n\n    <div class="user-smallcard" data-link="',c+=r.suppressValue(r.memberLookup(s,"profileUrl"),e.opts.autoescape),c+='">\n\n        <div\n            class="card-user-avatar"\n            ',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"withSummary")&&(c+='\n                data-action="show-user-summary"\n            '),c+='\n            data-user="',c+=r.suppressValue(r.memberLookup(s,"uid"),e.opts.autoescape),c+='">\n            ',c+=r.suppressValue(e.getFilter("image_container").call(t,r.memberLookup(s,"avatars"),60,60),e.opts.autoescape),c+='\n        </div>\n\n        <div class="card-user-meta">\n            <div class="card-user-name">\n                ',c+=r.suppressValue((a=128,o=26,r.callWrap(r.contextOrFrameLookup(t,i,"user_name"),"user_name",t,[n,s])),e.opts.autoescape),c+='\n            </div>\n            <div class="card-user-stats">\n                <div class="smallcard-user-follower-count">\n                    ',c+=r.suppressValue(e.getFilter("default").call(t,r.memberLookup(s,"followerCount"),0),e.opts.autoescape),c+=' Followers\n                </div>\n                <div class="smallcard-user-model-count">\n                    ',c+=r.suppressValue(e.getFilter("default").call(t,r.memberLookup(s,"modelCount"),0),e.opts.autoescape),c+=" Models\n                </div>\n            </div>\n        </div>\n\n    </div>\n\n",i=l,new r.SafeString(c)});t.addExport("user_smallcard"),t.setVariable("user_smallcard",v),s+="\n\n";var _=r.makeMacro(["authUser","user"],["options"],function(n,s,u){var l=i;i=new r.Frame,u=u||{},u.hasOwnProperty("caller")&&i.set("caller",u.caller),i.set("authUser",n),i.set("user",s),i.set("options",u.hasOwnProperty("options")?u.options:{});var c="";c+='\n\n    <div class="user">\n        <a href="/',c+=r.suppressValue(r.memberLookup(s,"username"),e.opts.autoescape),c+='">\n        ',c+=r.suppressValue((a=148,o=20,r.callWrap(r.contextOrFrameLookup(t,i,"user_avatar"),"user_avatar",t,[r.memberLookup(s,"avatars"),{size:104}])),e.opts.autoescape),c+='\n        </a>\n        <div class="info">\n            <p class="name" title="',c+=r.suppressValue(r.memberLookup(s,"displayName"),e.opts.autoescape),c+='"><a href="/',c+=r.suppressValue(r.memberLookup(s,"username"),e.opts.autoescape),c+='">',c+=r.suppressValue(r.memberLookup(s,"displayName"),e.opts.autoescape),c+='</a></p>\n            <p class="tagline" title="',c+=r.suppressValue(r.memberLookup(s,"tagline"),e.opts.autoescape),c+='"><a href="/',c+=r.suppressValue(r.memberLookup(s,"username"),e.opts.autoescape),c+='">',c+=r.suppressValue(r.memberLookup(s,"tagline"),e.opts.autoescape),c+="</a></p>\n            ",0!=r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"followButton")&&r.memberLookup(n,"uid")!=r.memberLookup(s,"uid")&&(c+='\n                <div class="follow-wrapper">\n                    ',c+=r.suppressValue((a=155,o=34,r.callWrap(r.contextOrFrameLookup(t,i,"follow_button"),"follow_button",t,[n,s])),e.opts.autoescape),c+='\n                    <p class="follow-count"><a href="/',c+=r.suppressValue(r.memberLookup(s,"username"),e.opts.autoescape),c+='/followers"><span>',c+=r.suppressValue(r.memberLookup(s,"followerCount"),e.opts.autoescape),c+="</span> followers</a></p>\n                </div>\n            "),c+='\n        </div>\n    </div>\n    <div class="models">',i=i.push();var h=e.getFilter("first_n").call(t,r.memberLookup(s,"thumbnails"),3);if(h)for(var d=h.length,p=0;p<h.length;p++){var f=h[p];i.set("thumb",f),i.set("loop.index",p+1),i.set("loop.index0",p),i.set("loop.revindex",d-p),i.set("loop.revindex0",d-p-1),i.set("loop.first",0===p),i.set("loop.last",p===d-1),i.set("loop.length",d),c+='\n            <a href="',c+=r.suppressValue(r.memberLookup(f,"viewerUrl"),e.opts.autoescape),c+='">\n                ',c+=r.suppressValue(e.getFilter("image_container").call(t,r.memberLookup(f,"thumbnail"),133,88,!1),e.opts.autoescape),c+="\n            </a>\n        "}return i=i.pop(),c+='\n    </div>\n    <div class="stats">\n        <p class="model-count">',c+=r.suppressValue(r.memberLookup(s,"modelCount"),e.opts.autoescape),c+=" model",c+=r.suppressValue(e.getFilter("pluralize").call(t,r.memberLookup(s,"modelCount")),e.opts.autoescape),c+='</p>\n        <p class="view-count">',c+=r.suppressValue(e.getFilter("humanize_number").call(t,r.memberLookup(r.memberLookup(s,"stats"),"view_count")),e.opts.autoescape),c+=" view",c+=r.suppressValue(e.getFilter("pluralize").call(t,r.memberLookup(r.memberLookup(s,"stats"),"view_count")),e.opts.autoescape),c+='</p>\n        <p class="like-count">',c+=r.suppressValue(e.getFilter("humanize_number").call(t,r.memberLookup(r.memberLookup(s,"stats"),"like_count")),e.opts.autoescape),c+=" like",c+=r.suppressValue(e.getFilter("pluralize").call(t,r.memberLookup(r.memberLookup(s,"stats"),"like_count")),e.opts.autoescape),c+="</p>\n    </div>\n\n",i=l,new r.SafeString(c)});t.addExport("user_summary"),t.setVariable("user_summary",_),s+="\n\n";var b=r.makeMacro(["authUser","followSuggestion","cloaked"],["options"],function(n,s,u,l){var c=i;i=new r.Frame,l=l||{},l.hasOwnProperty("caller")&&i.set("caller",l.caller),i.set("authUser",n),i.set("followSuggestion",s),i.set("cloaked",u),i.set("options",l.hasOwnProperty("options")?l.options:{});var h="";return h+="\n\n\n    ",h+=r.suppressValue(e.getFilter("image_container").call(t,r.memberLookup(s,"avatars"),64,64),e.opts.autoescape),h+='\n\n    <div class="info">\n        <p class="name">',h+=r.suppressValue(r.memberLookup(s,"displayName"),e.opts.autoescape),h+='</p>\n        <p class="stats">',h+=r.suppressValue(e.getFilter("humanize_number").call(t,r.memberLookup(s,"followerCount")),e.opts.autoescape),h+=" follower",h+=r.suppressValue(e.getFilter("pluralize").call(t,r.memberLookup(s,"followerCount")),e.opts.autoescape),h+=", ",h+=r.suppressValue(e.getFilter("humanize_number").call(t,r.memberLookup(s,"modelCount")),e.opts.autoescape),h+=" model",h+=r.suppressValue(e.getFilter("pluralize").call(t,r.memberLookup(s,"modelCount")),e.opts.autoescape),h+=" </p>\n    </div>\n\n    ",r.memberLookup(n,"uid")!=r.memberLookup(s,"uid")&&(h+="\n        ",h+=r.suppressValue((a=187,o=22,r.callWrap(r.contextOrFrameLookup(t,i,"follow_button"),"follow_button",t,[n,s])),e.opts.autoescape),h+="\n    "),h+="\n\n",i=c,new r.SafeString(h)});t.addExport("follow_suggestion_large"),t.setVariable("follow_suggestion_large",b),s+="\n\n";var x=r.makeMacro(["authUser","followSuggestion","cloaked"],["options"],function(n,s,u,l){var c=i;i=new r.Frame,l=l||{},l.hasOwnProperty("caller")&&i.set("caller",l.caller),i.set("authUser",n),i.set("followSuggestion",s),i.set("cloaked",u),i.set("options",l.hasOwnProperty("options")?l.options:{});var h="";return h+='\n\n    <span\n        class="avatar-container"\n        data-action="show-user-summary"\n        data-user="',h+=r.suppressValue(r.memberLookup(r.memberLookup(s,"user"),"uid"),e.opts.autoescape),h+='">\n        ',h+=r.suppressValue(e.getFilter("image_container").call(t,r.memberLookup(r.memberLookup(s,"user"),"avatars"),64,64),e.opts.autoescape),h+='\n    </span>\n\n    <div class="info">\n        <p\n            class="name"\n            data-action="show-user-summary"\n            data-user="',h+=r.suppressValue(r.memberLookup(r.memberLookup(s,"user"),"uid"),e.opts.autoescape),h+='"\n            data-user-summary-anchor-class=".avatar-container[data-user=\'',h+=r.suppressValue(r.memberLookup(r.memberLookup(s,"user"),"uid"),e.opts.autoescape),h+="']\">\n            ",h+=r.suppressValue(r.memberLookup(r.memberLookup(s,"user"),"displayName"),e.opts.autoescape),h+='\n        </p>\n        <p class="stats">',h+=r.suppressValue(e.getFilter("humanize_number").call(t,r.memberLookup(r.memberLookup(s,"user"),"followerCount")),e.opts.autoescape),h+=" follower",h+=r.suppressValue(e.getFilter("pluralize").call(t,r.memberLookup(r.memberLookup(s,"user"),"followerCount")),e.opts.autoescape),h+=", ",h+=r.suppressValue(e.getFilter("humanize_number").call(t,r.memberLookup(r.memberLookup(s,"user"),"modelCount")),e.opts.autoescape),h+=" model",h+=r.suppressValue(e.getFilter("pluralize").call(t,r.memberLookup(r.memberLookup(s,"user"),"modelCount")),e.opts.autoescape),h+=" </p>\n    </div>\n\n    ",r.memberLookup(n,"uid")!=r.memberLookup(r.memberLookup(s,"user"),"uid")&&(h+="\n        ",h+=r.suppressValue((a=213,o=22,r.callWrap(r.contextOrFrameLookup(t,i,"follow_button"),"follow_button",t,[n,r.memberLookup(s,"user")])),e.opts.autoescape),h+="\n    "),h+='\n\n    <div class="reason">\n        <p>',h+=r.suppressValue(e.getFilter("print_suggestion_verb").call(t,r.memberLookup(s,"verb"),r.memberLookup(s,"user")),e.opts.autoescape),h+=" ",h+=r.suppressValue(e.getFilter("print_suggestion_target").call(t,r.memberLookup(s,"target"),r.memberLookup(s,"verb")),e.opts.autoescape),h+="</p>\n    </div>\n\n",i=c,new r.SafeString(h)});t.addExport("follow_suggestion_reason"),t.setVariable("follow_suggestion_reason",x),s+="\n\n";var S=r.makeMacro(["authUser","followSuggestion","cloaked"],["options"],function(n,s,u,l){var c=i;i=new r.Frame,l=l||{},l.hasOwnProperty("caller")&&i.set("caller",l.caller),i.set("authUser",n),i.set("followSuggestion",s),i.set("cloaked",u),i.set("options",l.hasOwnProperty("options")?l.options:{});var h="";return h+='\n\n    <li class="follow-item',u&&(h+=" cloaked"),h+='" data-user="',h+=r.suppressValue(r.memberLookup(s,"uid"),e.opts.autoescape),h+='">\n\n        ',h+=r.suppressValue((a=226,o=18,r.callWrap(r.contextOrFrameLookup(t,i,"user_name"),"user_name",t,[n,s,r.makeKeywordArgs({options:{withAvatar:!0,withSummary:r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"withSummary"),avatarHeight:32,avatarWidth:32}})])),e.opts.autoescape),h+="\n\n        ",r.memberLookup(n,"uid")!=r.memberLookup(s,"uid")&&(h+="\n\n            ",h+=r.suppressValue((a=235,o=26,r.callWrap(r.contextOrFrameLookup(t,i,"follow_button"),"follow_button",t,[r.contextOrFrameLookup(t,i,"user"),s])),e.opts.autoescape),h+="\n\n        "),h+="\n\n    </li>\n\n",i=c,new r.SafeString(h)});t.addExport("follow_suggestion"),t.setVariable("follow_suggestion",S),s+="\n\n";var y=r.makeMacro(["authUser","followSuggestions"],["options"],function(n,s,u){var l=i;i=new r.Frame,u=u||{},u.hasOwnProperty("caller")&&i.set("caller",u.caller),i.set("authUser",n),i.set("followSuggestions",s),i.set("options",u.hasOwnProperty("options")?u.options:{});var c="";c+='\n\n    <div class="sidebar-box suggested-follow',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"container_class")&&(c+=" ",c+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"container_class"),e.opts.autoescape)),c+='">\n        <h5 class="sidebar-title">',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"title")?c+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"title"),e.opts.autoescape):c+="Who to follow ",c+="</h5>\n        <ul>\n\n            ";var h;if(h=e.getFilter("length").call(t,s),i.set("suggestionsCount",h,!0),i.topLevel&&t.setVariable("suggestionsCount",h),i.topLevel&&t.addExport("suggestionsCount",h),c+="\n\n            ",r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"maxSuggestions")){c+="\n                ";var d;d=r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"maxSuggestions"),i.set("max",d,!0),i.topLevel&&t.setVariable("max",d),i.topLevel&&t.addExport("max",d),c+="\n            "}else{c+="\n                ";var p;p=r.contextOrFrameLookup(t,i,"suggestionsCount"),i.set("max",p,!0),i.topLevel&&t.setVariable("max",p),i.topLevel&&t.addExport("max",p),c+="\n            "}c+="\n\n            ",i=i.push();var f=s;if(f)for(var g=f.length,m=0;m<f.length;m++){var v=f[m];i.set("following",v),i.set("loop.index",m+1),i.set("loop.index0",m),i.set("loop.revindex",g-m),i.set("loop.revindex0",g-m-1),i.set("loop.first",0===m),i.set("loop.last",m===g-1),i.set("loop.length",g),c+="\n\n                ",c+=r.suppressValue((a=259,o=34,r.callWrap(r.contextOrFrameLookup(t,i,"follow_suggestion"),"follow_suggestion",t,[n,v,r.memberLookup(r.contextOrFrameLookup(t,i,"loop"),"index")>r.contextOrFrameLookup(t,i,"max"),r.contextOrFrameLookup(t,i,"options")])),e.opts.autoescape),c+="\n\n            "}return i=i.pop(),c+='\n        </ul>\n\n        <a href="#" class="show-more" data-action="show-more"><i class="icon fa fa-plus"></i> Show More</i></a>\n\n    </div>\n\n',i=l,new r.SafeString(c)});t.addExport("follow_suggestions"),t.setVariable("follow_suggestions",y),s+="\n",u?u.rootRenderFunc(e,t,i,r,n):n(null,s)})})}catch(e){n(r.handleError(e,a,o))}}return{root:e}}()}()},,,,,,function(e,t,i){"use strict";var r,n,a,o=i(5),s=i(367),u=i(46),l=o.a.osg,c={},h=-1,d=0,p=40,f=l.Timer.instance().tick(),g=!1,m=!1;u.a.getModelDisplayed().then(function(){m=!0});var v,_;["hidden","mozHidden","msHidden","webkitHidden"].forEach(function(e){document&&document[e]&&(v=e,_=e.toLowerCase().split("hidden").shift()+"visibilitychange")});var b=function(){if(a=window.setTimeout(b,p),r&&!g&&!c.isDrawAlreadyQueued()&&n&&n.canBeEnabled()){l.Timer.instance().tick()-f-p<=p||(n.enable(),h=-1)}};i.i(s.a)()||(a=window.setTimeout(b,p));var x=function(e){if(r&&!g&&(!m||!document[v])){var t=c.isDrawAlreadyQueued();if(t||r.requestRedraw(),n&&!e&&(n.reset(),!t)){var i=l.Timer.instance().tick();d+=i-f,h++,0===h?(h=0,d=0):4===h&&(p=Math.min(200,Math.max(16,d/h)),h=0,d=0),f=i}}};c.setPoseForScreenshot=function(e){g=e},c.isDrawAlreadyQueued=function(){return r._requestRedraw},c.draw=function(){x()},c.drawNoJitter=function(){this._doJitter=!1,x()},c.drawSameFrame=function(){x(!0)},c.setViewer=function(e){r=e},c.setSuperSample=function(e){n=e},c.getSuperSample=function(){return n},_&&document.addEventListener(_,c.draw),t.a=c},,,,,,,,,,,,function(e,t,i){"use strict";var r=i(19),n=i.n(r),a=i(2),o=i.n(a),s=i(0),u=(i.n(s),i(10)),l=i.n(u),c=i(7),h=i(15),d=i(335),p=i(432);t.a=h.a.extend(i.i(s.extend)({},p.a,{defaults:{collections:{}},initialize:function(){h.a.prototype.initialize.apply(this,arguments),this.on("change:isPrivate",function(){this.get("isPrivate")||this.set("password","")}.bind(this)),this.maxFailCount=5},url:function(){return this.isNew()?"/i/models":"/i/models/"+this.get("uid")},like:function(){return c.a.authenticate(function(e){return this.set({likeCount:this.get("likeCount")+1}),e.addLike(this.get("uid"),!0),n.a.ajax({type:"POST",url:i.i(s.result)(this,"url")+"/likes",cacheBusting:!1})}.bind(this))},unlike:function(){return c.a.authenticate(function(e){return this.set({likeCount:this.get("likeCount")-1}),e.addLike(this.get("uid"),!1),n.a.ajax({type:"DELETE",url:i.i(s.result)(this,"url")+"/likes"})}.bind(this))},hit:function(){var e=c.a.me();if(e.isAuthenticated()){var t=this.get("user")&&e.get("uid")===this.get("user").uid,r=e.get("isStaff");if(t||r)return l.a.resolve()}return this.get("isPublished")?n.a.ajax({type:"POST",url:i.i(s.result)(this,"url")+"/views",cacheBusting:!1}):l.a.resolve()},hitDownload:function(){return n.a.ajax({type:"POST",url:i.i(s.result)(this,"url")+"/download",cacheBusting:!1})},isPublished:function(){return(this.get("isPublished")||!!this.get("publishedAt"))&&!this.get("isDeleted")},publish:function(){return this.set("isPublished",!0),this.set("publishedAt",new Date),n.a.ajax({type:"PATCH",url:i.i(s.result)(this,"url"),data:{isPublished:!0},cacheBusting:!1})},getDownloadStatus:function(){return n.a.ajax({type:"GET",url:i.i(s.result)(this,"url")+"/download",allowPrefetching:!1}).then(function(e,t,i){return o.a.Deferred().resolve(e,t,i)})},getRelatedContent:function(){return n.a.ajax({type:"GET",url:i.i(s.result)(this,"url")+"/related",allowPrefetching:!1}).then(function(e,t,i){return o.a.Deferred().resolve(e,t,i)})},pollRelatedContent:function(){var e=!0;return d.a.while(function(){return e},function(){return new l.a(function(t){this.getRelatedContent().then(function(i,r,n){return 202===n.status?l.a.delay(5e3).then(t):(e=!1,t(i))})}.bind(this))}.bind(this)).catch(function(){e=!1})},getLikeUsers:function(){return n.a.ajax({type:"GET",url:i.i(s.result)(this,"url")+"/liked_by",allowPrefetching:!0}).then(function(e){return e})},sharing:function(){return n.a.ajax({type:"GET",url:i.i(s.result)(this,"url")+"/sharing"}).then(function(e){return this.set("sharing",e),l.a.resolve(e)}.bind(this))},toJSON:function(){var e=h.a.prototype.toJSON.apply(this,arguments);return e.categories&&(e.categories=e.categories.map(function(e){return"object"==typeof e?e.uid:e})),e},addCollection:function(e,t){var i={};i[e]=t,this.addCollections(i)},addCollections:function(e){var t=i.i(s.clone)(this.get("collections"));i.i(s.extend)(t,e),this.set("collections",t)},isInflated:function(){var e=Object.keys(this.attributes);return e.indexOf("description")>-1&&e.indexOf("tags")>-1},isInCollection:function(e){return!!this.get("collections")[e]},getCollections:function(e){var t=[];return i.i(s.each)(e,function(e){e in this.get("collections")||t.push(e)}.bind(this)),new l.a(function(e,i){t.length>0?n.a.ajax({type:"GET",url:"/i/models/"+this.id+"/collections?uid="+t.join("&uid=")}).then(function(t){this.addCollections(t.results),e()}.bind(this),i):(this.trigger("change:collections"),e())}.bind(this))}}))},,function(e,t,i){"use strict";var r=function(e){this.traversalMask=-1,this.nodeMaskOverride=0,this.traversalMode=e,void 0===e&&(this.traversalMode=r.TRAVERSE_ALL_CHILDREN),this.nodePath=[],this.visitorType=r.NODE_VISITOR,this._databaseRequestHandler=void 0,this._frameStamp=void 0,this.traverse=r._traversalFunctions[this.traversalMode],this.pushOntoNodePath=r._pushOntoNodePath[this.traversalMode],this.popFromNodePath=r._popFromNodePath[this.traversalMode]};r.TRAVERSE_PARENTS=1,r.TRAVERSE_ALL_CHILDREN=2,r.TRAVERSE_ACTIVE_CHILDREN=3,r.NODE_VISITOR=0,r.UPDATE_VISITOR=1,r.CULL_VISITOR=2;var n=function(e){e.ascend(this)},a=function(e){e.traverse(this)};r._traversalFunctions=[void 0,n,a,a];var o=function(e){this.nodePath.unshift(e)},s=function(e){this.nodePath.push(e)};r._pushOntoNodePath=[void 0,o,s,s];var u=function(){return this.nodePath.shift()},l=function(){this.nodePath.pop()};r._popFromNodePath=[void 0,u,l,l],r.prototype={reset:function(){this.nodePath.length=0},setFrameStamp:function(e){this._frameStamp=e},getFrameStamp:function(){return this._frameStamp},setNodeMaskOverride:function(e){this.nodeMaskOverride=e},getNodeMaskOverride:function(){return this.nodeMaskOverride},setTraversalMask:function(e){this.traversalMask=e},getTraversalMask:function(){return this.traversalMask},getNodePath:function(){return this.nodePath},pushOntoNodePath:function(e){r._pushOntoNodePath[this.traversalMode].call(this,e)},popFromNodePath:function(){r._popFromNodePath[this.traversalMode].call(this)},validNodeMask:function(e){var t=e.getNodeMask();return 0!=(this.traversalMask&(this.nodeMaskOverride|t))},apply:function(e){this.traverse(e)},traverse:function(e){r._traversalFunctions[this.traversalMode].call(this,e)},getVisitorType:function(){return this.visitorType},setDatabaseRequestHandler:function(e){this._databaseRequestHandler=e},getDatabaseRequestHandler:function(){return this._databaseRequestHandler}},e.exports=r},function(e,t,i){"use strict";var r=i(14),n=i(91),a=function(){n.call(this)};r.createPrototypeStateAttribute(a,r.objectInherit(n.prototype,{_attributeTypeIndex:void 0,getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},apply:function(){},getHash:function(){return this.getType()}}),"osg","StateAttribute"),a.OFF=0,a.ON=1,a.OVERRIDE=2,a.PROTECTED=4,a.INHERIT=8,e.exports=a},function(e,t,i){"use strict";var r={};r.PICK_GEOMETRY_FIXED=1,r.PICK_GEOMETRY_ANIMATED=2,r.PICK_GEOMETRY_RIG_BOX=4,r.PICK_GIZMO_LIGHT=8,r.SHADOW_CAST=16,r.SHADOW_BOUNDS=32,r.PICK_GEOMETRY_SLOW=r.PICK_GEOMETRY_FIXED|r.PICK_GEOMETRY_ANIMATED,r.PICK_GEOMETRY_FAST=r.PICK_GEOMETRY_FIXED|r.PICK_GEOMETRY_RIG_BOX,r.PICK_GEOMETRY=r.PICK_GEOMETRY_FIXED|r.PICK_GEOMETRY_ANIMATED|r.PICK_GEOMETRY_RIG_BOX,r.PICK=r.PICK_GEOMETRY|r.PICK_GIZMO_LIGHT,r.SHADOW=r.SHADOW_BOUNDS|r.SHADOW_CAST,r.PICK_GEOMETRY_SHADOW=r.PICK_GEOMETRY|r.SHADOW,r.NO_SHADOW=~r.SHADOW,r.NO_PICK=~r.PICK,r.NO_PICK_NO_SHADOW_CAST=~(r.PICK|r.SHADOW_CAST),r.NO_PICK_NO_SHADOW_BOUNDS=~(r.PICK|r.SHADOW_BOUNDS),r.NO_PICK_NO_SHADOW=~(r.PICK|r.SHADOW),t.a=r},function(e,t,i){var r,n,a;/**
 * isMobile.js v0.4.1
 *
 * A simple library to detect Apple phones and tablets,
 * Android phones and tablets, other mobile devices (like blackberry, mini-opera and windows phone),
 * and any kind of seven inch device, via user agent sniffing.
 *
 * @author: Kai Mallea (kmallea@gmail.com)
 *
 * @license: http://creativecommons.org/publicdomain/zero/1.0/
 */
!function(i){var o=/iPhone/i,s=/iPod/i,u=/iPad/i,l=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,c=/Android/i,h=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,d=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,p=/Windows Phone/i,f=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,g=/BlackBerry/i,m=/BB10/i,v=/Opera Mini/i,_=/(CriOS|Chrome)(?=.*\bMobile\b)/i,b=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,x=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),S=function(e,t){return e.test(t)},y=function(e){var t=e||navigator.userAgent,i=t.split("[FBAN");if(void 0!==i[1]&&(t=i[0]),i=t.split("Twitter"),void 0!==i[1]&&(t=i[0]),this.apple={phone:S(o,t),ipod:S(s,t),tablet:!S(o,t)&&S(u,t),device:S(o,t)||S(s,t)||S(u,t)},this.amazon={phone:S(h,t),tablet:!S(h,t)&&S(d,t),device:S(h,t)||S(d,t)},this.android={phone:S(h,t)||S(l,t),tablet:!S(h,t)&&!S(l,t)&&(S(d,t)||S(c,t)),device:S(h,t)||S(d,t)||S(l,t)||S(c,t)},this.windows={phone:S(p,t),tablet:S(f,t),device:S(p,t)||S(f,t)},this.other={blackberry:S(g,t),blackberry10:S(m,t),opera:S(v,t),firefox:S(b,t),chrome:S(_,t),device:S(g,t)||S(m,t)||S(v,t)||S(b,t)||S(_,t)},this.seven_inch=S(x,t),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},C=function(){var e=new y;return e.Class=y,e};void 0!==e&&e.exports&&"undefined"==typeof window?e.exports=y:void 0!==e&&e.exports&&"undefined"!=typeof window?e.exports=C():(n=[],r=i.isMobile=C(),void 0!==(a="function"==typeof r?r.apply(t,n):r)&&(e.exports=a))}(this)},function(e,t){!function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/utils.jinja"]=function(){function e(e,t,i,r,n){var a="";try{var o=null,s=r.makeMacro(["number"],[],function(n,a){var o=i;i=new r.Frame,a=a||{},a.hasOwnProperty("caller")&&i.set("caller",a.caller),i.set("number",n);var s="";return s+="\n    ",s+=r.suppressValue(e.getFilter("humanize_number").call(t,n),e.opts.autoescape),s+="\n",i=o,new r.SafeString(s)});t.addExport("humanize_count"),t.setVariable("humanize_count",s),a+="\n\n";var u=r.makeMacro(["host","type","uid"],["options"],function(n,a,o,s){var u=i;i=new r.Frame,s=s||{},s.hasOwnProperty("caller")&&i.set("caller",s.caller),i.set("host",n),i.set("type",a),i.set("uid",o),i.set("options",s.hasOwnProperty("options")?s.options:{});var l="";l+="\n    ";var c;if(c=n+"/requests/new?type=report_abuse&utm_campaign=report_abuse&utm_source=website&"+a+"="+o,i.set("link",c,!0),i.topLevel&&t.setVariable("link",c),i.topLevel&&t.addExport("link",c),l+="\n\n    ",r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"subject")){l+="\n        ";var h;h="&report_string="+e.getFilter("urlencode").call(t,r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"subject")),i.set("label",h,!0),i.topLevel&&t.setVariable("label",h),i.topLevel&&t.addExport("label",h),l+="\n    "}return l+='\n\n    <a href="',l+=r.suppressValue(r.contextOrFrameLookup(t,i,"link"),e.opts.autoescape),l+=r.suppressValue(r.contextOrFrameLookup(t,i,"label"),e.opts.autoescape),l+='" class="report-link" target="_blank">\n        ',l+=r.suppressValue(e.getFilter("default").call(t,r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"text"),"Report abuse"),e.opts.autoescape),l+="\n    </a>\n",i=u,new r.SafeString(l)});t.addExport("report_link"),t.setVariable("report_link",u),a+="\n",o?o.rootRenderFunc(e,t,i,r,n):n(null,a)}catch(e){n(r.handleError(e,null,null))}}return{root:e}}()}()},,,,,,,,,,,,,,,function(e,t,i){"use strict";var r={};r.OPAQUE_BIN=0,r.BACKGROUND=1,r.TRANSPARENT_BIN_NO_EARLYZ_PRE=9,r.TRANSPARENT_BIN=10,r.TRANSPARENT_BIN_NO_EARLYZ_POST=11,r.EXTRA=19,r.EDITOR_GIZMO=r.HOTSPOT=20,r.GRID=r.TOOLTIP=r.VR_MENU=21,r.WIREFRAME=r.VR_CURSOR=22,r.OUTLINE=23,r.DEBUG=24,r.DEBUG_2=25,t.a=r},function(e,t,i){"use strict";var r=i(4),n=i(0),a=(i.n(n),i(2)),o=i.n(a),s=i(6),u=i(94),l=i(12),c=i(134);i.n(c);t.a=r.a.extend({displayName:"Notification",optionTypes:{class:l.b.string,content:l.b.string,delay:l.b.number},parent:"body",className:"flashmessage-container notification",events:{'click [data-action="close"]':"onClickClose"},template:function(){return s.default.getFromMacro("skfb_front/macros/notification","flashmessage",[this.options.class,this.options.content,{safecontent:"True"}])},initialize:function(){r.a.prototype.initialize.apply(this,arguments),this.render(),this.options.delay&&this.close(this.options.delay)},render:function(){this.$el.html(i.i(n.result)(this,"template")),o()(i.i(n.result)(this,"parent")).append(this.$el),this.$el.addClass("hidden"),i.i(n.defer)(this.$el.removeClass.bind(this.$el,"hidden"))},onClickClose:function(e){e&&e.preventDefault&&e.preventDefault(),this.close(0)},close:function(e){return e=e||0,setTimeout(function(){this.$el.addClass("hidden"),i.i(u.a)(this.$el,function(){this.$el.parent()[0].removeChild(this.el)}.bind(this))}.bind(this),e),this}})},function(e,t,i){"use strict";var r=i(30),n=function(e){this._data=void 0,this._transpose=!1,this._glCall="",this._cache=void 0,this._name=e,this._type=void 0,this._isMatrix=!1};n.isUniform=function(e){return"object"==typeof e&&window.Object.getPrototypeOf(e)===n.prototype},n.prototype={getName:function(){return this._name},getType:function(){return this._type},apply:function(e,t){this._cache||(this._cache=e[this._glCall]),this._isMatrix?this._cache.call(e,t,this._transpose,this._data):this._cache.call(e,t,this._data)},setInternalArray:function(e){r.warn("setInternalArray deprecated, please use getInternalArray instead: "+e.length),this._data=e},getInternalArray:function(){return this._data},setFloat:function(e){this._data[0]=e},setFloat1:function(e){this._data[0]=e[0]},setFloat2:function(e){this._data[0]=e[0],this._data[1]=e[1]},setFloat3:function(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]},setFloat4:function(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2],this._data[3]=e[3]},setFloat9:function(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2],this._data[3]=e[3],this._data[4]=e[4],this._data[5]=e[5],this._data[6]=e[6],this._data[7]=e[7],this._data[8]=e[8]},setFloat16:function(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2],this._data[3]=e[3],this._data[4]=e[4],this._data[5]=e[5],this._data[6]=e[6],this._data[7]=e[7],this._data[8]=e[8],this._data[9]=e[9],this._data[10]=e[10],this._data[11]=e[11],this._data[12]=e[12],this._data[13]=e[13],this._data[14]=e[14],this._data[15]=e[15]}},n.prototype.setVec2=n.prototype.setFloat2,n.prototype.setVec3=n.prototype.setFloat3,n.prototype.setVec4=n.prototype.setFloat4,n.prototype.setMatrix4=n.prototype.setFloat16,n.prototype.setMatrix3=n.prototype.setFloat9,n.prototype.setInt=n.prototype.setFloat,n.prototype.setInt1=n.prototype.setFloat1,n.prototype.setInt2=n.prototype.setFloat2,n.prototype.setInt3=n.prototype.setFloat3,n.prototype.setInt4=n.prototype.setFloat4;var a=function(e,t,i,r,a,o){var s=t&&t.length?e:void 0,u=new n(void 0!==s?t:e);if(u._data=i,void 0!==s)if(s.length)for(var l=0,c=s.length;l<c;++l)u._data[l]=s[l];else u._data[0]=s;return u._glCall=r,u._type=a,u._isMatrix=!!o,u},o=function(e){for(var t=new Float32Array(4*e),i=0;i<t.length;i+=4)t[i]=t[i+3]=1;return t},s=function(e){for(var t=new Float32Array(9*e),i=0;i<t.length;i+=9)t[i]=t[i+4]=t[i+8]=1;return t},u=function(e){for(var t=new Float32Array(16*e),i=0;i<t.length;i+=16)t[i]=t[i+5]=t[i+10]=t[i+15]=1;return t},l=function(e,t,i){return i&&!i.length?i:"string"!=typeof t?(t.length||1)/e:1};n.createFloat1=function(e,t){return a(e,t,new Float32Array(1*l(1,e,t)),"uniform1fv","float")},n.createFloat2=function(e,t){return a(e,t,new Float32Array(2*l(2,e,t)),"uniform2fv","vec2")},n.createFloat3=function(e,t){return a(e,t,new Float32Array(3*l(3,e,t)),"uniform3fv","vec3")},n.createFloat4=function(e,t){return a(e,t,new Float32Array(4*l(4,e,t)),"uniform4fv","vec4")},n.createInt1=function(e,t){return a(e,t,new Int32Array(1*l(1,e,t)),"uniform1iv","int")},n.createInt2=function(e,t){return a(e,t,new Int32Array(2*l(2,e,t)),"uniform2iv","vec2i")},n.createInt3=function(e,t){return a(e,t,new Int32Array(3*l(3,e,t)),"uniform3iv","vec3i")},n.createInt4=function(e,t){return a(e,t,new Int32Array(4*l(4,e,t)),"uniform4iv","vec4i")},n.createMatrix2=function(e,t){return a(e,t,o(l(4,e,t)),"uniformMatrix2fv","mat2",!0)},n.createMatrix3=function(e,t){return a(e,t,s(l(9,e,t)),"uniformMatrix3fv","mat3",!0)},n.createMatrix4=function(e,t){return a(e,t,u(l(16,e,t)),"uniformMatrix4fv","mat4",!0)},n.float=n.createFloatArray=n.createFloat=n.createFloat1,n.vec2=n.createFloat2Array=n.createFloat2,n.vec3=n.createFloat3Array=n.createFloat3,n.vec4=n.createFloat4Array=n.createFloat4,n.int=n.createIntArray=n.createInt=n.createInt1,n.vec2i=n.createInt2Array=n.createInt2,n.vec3i=n.createInt3Array=n.createInt3,n.vec4i=n.createInt4Array=n.createInt4,n.mat2=n.createMat2Array=n.createMat2=n.createMatrix2,n.mat3=n.createMat3Array=n.createMat3=n.createMatrix3,n.mat4=n.createMat4Array=n.createMat4=n.createMatrix4,e.exports=n},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),function(e){this._views=[],e&&(this._name=e.FeatureName,this._modelName=e.ModelName,this._modelType=e.ModelType,this._viewListType=e.ViewListType.slice(0))});n.prototype={getName:function(){return this._name},getModel:function(){return this._model},addView:function(e){e&&this._views.push(e)},init:function(e){if(this._model||(this._model=e.getModelByName(this._modelName)),!this._model){var t=this._modelType;this._model=new t,this._model.init&&this._model.init(e)}var i=function(t){var i=new t({model:this._model,context:e});this.addView(i)};this._viewListType.forEach(function(e){i.call(this,e)},this),e.addFeature(this)},prepareForScreenShot:function(){var e=this.getWidgetNode();return!(!e||!e.getNodeMask())&&(this._oldMaskEditorWidget=e.getNodeMask(),e.setNodeMask(0),!0)},resetAfterScreenShot:function(){var e=this.getWidgetNode();e&&e.setNodeMask(this._oldMaskEditorWidget)},getWidgetNode:function(){}},n.create=function(e){var t=function(){n.call(this,t)};return t.prototype=i.i(r.extend)({},n.prototype),i.i(r.extend)(t,e),t.getName=function(){return e.FeatureName},t},t.a=n},function(e,t,i){"use strict";var r=!1,n=function(e){return void 0!==e&&(r=e),r};t.a=n},function(e,t,i){"use strict";var r=i(14),n=function(){this._name=void 0,this._userdata=void 0,this._instanceID=n.getInstanceID()};r.createPrototypeObject(n,{cloneType:function(){return new(0,this.constructor)},getInstanceID:function(){return this._instanceID},setName:function(e){this._name=e},getName:function(){return this._name},setUserData:function(e){this._userdata=e},getUserData:function(){return this._userdata}},"osg","Object");var a=0;n.getInstanceID=function(){return a+=1},e.exports=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(19),n=i.n(r),a=i(10),o=i.n(a),s=i(5),u=i(0),l=(i.n(u),i(979)),c=i(599),h=i(973),d=i(964),p=i(972),f=i(168),g=i(978),m=i(388),v=i(298),_=i(735),b=i(969),x=i(958),S=i(962),y=s.a.osg,C=function(e){e=this.computeURL(e);var t=new y.Image;return t.setURL(e),o.a.resolve(t)},T=[],M=function(e){return function(){var t=this.getJSON(),i=t.UniqueID,r=new y.BufferArray(y.BufferArray[t.Type]);r.setItemSize(t.ItemSize),r.setElements(T);var n=r.getInstanceID();if(e[n]={},t.Array){var a=Object.keys(t.Array)[0],s=t.Array[a];s.Elements?e[n].inlined=s.Elements:(e[n].vb=s,e[n].type=a)}else e[n].inlined=t.Elements;var u=o.a.defer();return void 0!==i&&(this._identifierMap[i]=u.promise),u.resolve(r),u.promise}},w=function(e){return function(t,i){return t=i.currentAnimationUID?i.currentAnimationUID:this.computeURL(t),e.getBinaryArray(t,i).getPromise()}},A=function(e,t){this.resource=e,this.promise=t},E=function(e){if(!e){if(E.instance)return E.instance;E.instance=this}return this._maps={},this._resourceLoader=new l.a,this};E.Entry=A,E.prototype={setModelUID:function(e){this._modelUID=e},setUserUID:function(e){this._userUID=e},setStateContextOSG:function(e){this._state=e},getInstance:function(){return E.instance},register:function(e,t){this._maps[e]=t},exist:function(e){return this._maps[e]},hashTextureOptions:function(e){for(var t="",i=c.a.getValidOptions(),r=i.length,n=0;n<r;++n)t+=e[i[n]];return t},getOrCreateAnimationCollection:function(){var e="animationCollection",t=this.exist(e);if(t)return t;var i=new x.a([],{filters:new b.a({modelUID:this._modelUID})});return t=new A(i,o.a.resolve(i.fetch())),this.register(e,t),t},getOrCreateHotspotCollection:function(){var e="hotspotCollection",t=this.exist(e);if(t)return t;var i=new f.a([],{filters:new p.a({modelUID:this._modelUID})});return t=new A(i,o.a.resolve(i.fetch())),this.register(e,t),t},getOrCreateMatcapCollection:function(){var e="matcapCollection",t=this.exist(e);if(t)return t;var i=new S.a([],{filters:new n.a.Model({userUID:this._userUID})});return t=new A(i,o.a.resolve(i.fetch())),this.register(e,t),t},getOrCreateImageCollection:function(){var e="imageCollection",t=this.exist(e);if(t)return t;var i=new d.a([],{filters:new h.a({modelUID:this._modelUID})});return t=new A(i,o.a.resolve(i.fetch())),this.register(e,t),t.promise.then(function(){i.forEach(function(e){0===e.getImages().length&&i.remove(e)})}),t.resource.isValid(),t},getOrCreateMultiresTexture:function(e,t){var i=this.hashTextureOptions(t),r=[e,i].join(""),n=this.exist(r);if(n)return n;var a=this.getOrCreateImageCollection().resource.get(e)||this.getOrCreateMatcapCollection().resource.get(e);if(a){var s=new v.a;return c.a.setOptions(t,s),s.setImageModel(a),n=new A(s,o.a.resolve(s)),this.register(r,n),n}},getOrCreateImage:function(e,t){var i=this._resourceLoader.getImage(e,t),r=i.getPromise(),n=["image",e].join(""),a=this.exist(n);return a||(a=new A(null,r),r.then(function(e){a.image=e}),this.register(n,a),a)},getOrCreateTexture:function(e,t){var i=function(e){!this._state||e._textureObject&&!e.isDirty()||this._state.applyTextureAttribute(0,e)}.bind(this),r=c.a.createValidOptions(t),n=this.hashTextureOptions(r),a=[e,n].join(""),s=this.exist(a),u=!!(t&&t.transferToGPU&&this._state);if(s)return u&&(s.promise.isFulfilled()?i(s.texture):s._bindToGPU=!0),s;r.cubemap=t&&t.cubemap;var l=r.cubemap?new _.a:new v.a;l.setTextureSize(1,1),c.a.setOptions(r,l),t&&void 0!==t.convertNPOT&&(l._convertNPOT=t.convertNPOT);var h=this._resourceLoader.getImage(e,t),d=h.getPromise(),p=o.a.defer(),f=p.promise;s=new A(l,f),s.texture=l,s._bindToGPU=u;var g=this;return d.then(function(e){if(r.cubemap)for(var t=0;t<6;t++){var n=y.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+t;l.setImage(n,e[n],"RGBA")}else l.setImage(e);l.dirty(),s._bindToGPU&&i(l),p.resolve(l)}).catch(function(){g.register(a,void 0),p.reject(l)}).done(),this.register(a,s),s},getOrCreateModel:function(e,t){var r=e,n=this.exist(r);if(n)return n;var a=t&&t.node?t.node:new y.Node,s={};s.readImageURL=C,s.readBinaryArrayURL=w(this._resourceLoader),s.bufferMap={},s.readBufferArray=M(s.bufferMap);var l=i.i(u.extend)({},s,t);y.time("Download "+e.split("/").pop()+" (Async)");var c=this._resourceLoader.getModel(e,l),h=c.getPromise(),d=o.a.defer(),p=d.promise;n=new A(a,p),n.node=a;var f=o.a.defer();n.texturesReadyToload=f.promise;var g=e.split("/");g.length=g.length-1,g.length<=0&&y.error("getOrCreateModel: can't find prefix to load subdata");var m=g.join("/")+"/";return l.prefixURL=m,this._loadModel(h,e,l,d,a,f),this.register(r,n),n},_loadModel:function(e,t,i,r,n,a){var o=function(e){y.error("getOrCreateModel error : "+e),y.error(e.stack)},s=t.split("/").pop();e.then(function(e){y.timeEnd("Download "+s+" (Async)"),y.time("JSONparse "+s);var t=JSON.parse(e);return y.timeEnd("JSONparse "+s),y.time("parseSceneGraph "+s+" (Async)"),m.a.parse(t,i,r.promise)}).then(function(e){y.timeEnd("parseSceneGraph "+s+" (Async)"),y.time("DownloadAndLoadBuffer "+s+" (Async)");var t=g.a.postParse(e,this._resourceLoader,i);a.resolve(),t.then(function(){y.timeEnd("DownloadAndLoadBuffer "+s+" (Async)"),n.addChild(e),r.resolve(n)}).catch(o)}.bind(this)).catch(o)},run:function(){this._resourceLoader.run()}},new E,t.default=E},,function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(0),o=(i.n(a),i.i(a.find)({WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},function(e,t){return t in document.body.style}));t.a=function(e,t){setTimeout(function(){n()(e).one(o,t)})}},,,function(e,t,i){"use strict";var r=i(30),n=i(14),a=i(68),o=i(88),s=i(452),u=i(422),l=i(896),c=i(333),h=window.ImageBitmap||function(){},d=function(e){return 0!==e&&(e&1+~e)===e},p=function(){a.call(this),u.call(this),this.setDefaultParameters(),this._dirty=!0,this._dirtyMipmap=!0,this._applyTexImage2DCallbacks=[],this._textureObject=void 0,this._textureNull=!0},f=function(e,t){var i=p[e];return void 0===i?(r.warn("bad Texture enum argument "+e+"\nfallback to "+t),t):i};p.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,p.UNPACK_FLIP_Y_WEBGL=37440,p.BROWSER_DEFAULT_WEBGL=37444,p.NONE=0,p.DEPTH_COMPONENT=6402,p.DEPTH_COMPONENT16=33189,p.DEPTH_STENCIL=34041,p.DEPTH24_STENCIL8=35056,p.DEPTH_COMPONENT24=33190,p.DEPTH_COMPONENT32F=36012,p.COMPRESSED_RGB_S3TC_DXT1_EXT=33776,p.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777,p.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778,p.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779,p.COMPRESSED_RGB_ATC_WEBGL=35986,p.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987,p.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798,p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,p.COMPRESSED_RGB_ETC1_WEBGL=36196,p.LINEAR=9729,p.NEAREST=9728,p.NEAREST_MIPMAP_NEAREST=9984,p.LINEAR_MIPMAP_NEAREST=9985,p.NEAREST_MIPMAP_LINEAR=9986,p.LINEAR_MIPMAP_LINEAR=9987,p.TEXTURE_MAX_ANISOTROPY_EXT=34046,p.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047,p.CLAMP_TO_EDGE=33071,p.REPEAT=10497,p.MIRRORED_REPEAT=33648,p.TEXTURE_2D=3553,p.TEXTURE_CUBE_MAP=34067,p.TEXTURE_BINDING_CUBE_MAP=34068,p.TEXTURE_CUBE_MAP_POSITIVE_X=34069,p.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,p.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,p.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,p.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,p.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,p.MAX_CUBE_MAP_TEXTURE_SIZE=34076,p.UNSIGNED_BYTE=5121,p.UNSIGNED_SHORT=5123,p.UNSIGNED_SHORT_4_4_4_4=32819,p.UNSIGNED_SHORT_5_5_5_1=32820,p.UNSIGNED_SHORT_5_6_5=33635,p.FLOAT=5126,p.HALF_FLOAT_OES=36193,p.HALF_FLOAT=5131,p.UNSIGNED_INT_10F_11F_11F_REV=35899,p.UNSIGNED_INT_24_8=34042,p.ALPHA=6406,p.RGB=6407,p.RGBA=6408,p.LUMINANCE=6409,p.LUMINANCE_ALPHA=6410,p.RED_INTEGER=36244,p.RGB_INTEGER=36248,p.RGBA_INTEGER=36249,p.RG_INTEGER=33320,p.RED=6403,p.R8=33321,p.R8UI=33330,p.RG8=33323,p.RG8UI=33336,p.RGB8=36758,p.RGB565=36194,p.RGB9_E5=35901,p.RGB8UI=36221,p.RGBA8=32856,p.RGB5_A1=32855,p.RGBA4=32854,p.RGBA8UI=36220,p.SRGB8_ALPHA8=35907,p.SRGB8=35905,p.R16F=33325,p.RG16F=33327,p.RGB16F=34843,p.RGBA16F=34842,p.R11F_G11F_B10F=35898,p.R32F=33326,p.RG32F=33328,p.RGB32F=34837,p.RGBA32F=34836;var g=function(){var e={};return e[p.R8]=p.LUMINANCE,e[p.R8UI]=p.LUMINANCE,e[p.R16F]=p.LUMINANCE,e[p.R32F]=p.LUMINANCE,e[p.SRGB8]=p.LUMINANCE,e[p.RG8]=p.RGB,e[p.RG8UI]=p.RGB,e[p.RG16F]=p.RGB,e[p.RG32F]=p.RGB,e[p.RGB8]=p.RGB,e[p.RGB565]=p.RGB,e[p.RGB9_E5]=p.RGB,e[p.RGB8UI]=p.RGB,e[p.RGB5_A1]=p.RGB,e[p.RGB16F]=p.RGB,e[p.RGB32F]=p.RGB,e[p.RGBA8]=p.RGBA,e[p.R11F_G11F_B10F]=p.RGBA,e[p.RGBA16F]=p.RGBA,e[p.RGBA32F]=p.RGBA,e[p.SRGB8_ALPHA8]=p.RGBA,e}(),m=function(){var e={},t={},i={},r={},n={},a={};return e[p.FLOAT]=t,e[p.HALF_FLOAT]=e[p.HALF_FLOAT_OES]=i,e[p.UNSIGNED_SHORT]=r,e[p.UNSIGNED_INT]=n,e[p.UNSIGNED_INT_24_8]=a,i[p.LUMINANCE]=p.R16F,i[p.RGB]=p.RGB16F,i[p.RGBA]=p.RGBA16F,t[p.LUMINANCE]=p.R32F,t[p.RGB]=p.RGB32F,t[p.RGBA]=p.RGBA32F,r[p.DEPTH_COMPONENT]=p.DEPTH_COMPONENT16,n[p.DEPTH_COMPONENT]=p.DEPTH_COMPONENT32F,a[p.DEPTH_STENCIL]=p.DEPTH24_STENCIL8,e}();p._sTextureManager=new window.Map,p.getTextureManager=function(e){return p._sTextureManager.has(e)||p._sTextureManager.set(e,new l),p._sTextureManager.get(e)},p.getEnumFromString=function(e){var t=e;return"string"==typeof t&&(t=f(t,e)),t},n.createPrototypeStateAttribute(p,n.objectInherit(u.prototype,n.objectInherit(a.prototype,{attributeType:"Texture",cloneType:function(){return new p},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},isTextureNull:function(){return this._textureNull},getOrCreateUniforms:function(e){if(void 0===p.uniforms&&(p.uniforms=[]),void 0===p.uniforms[e]){var t=this.getType()+e;p.uniforms[e]={texture:o.createInt1(e,t)}}return p.uniforms[e]},setDefaultParameters:function(){this._image=void 0,this._magFilter=p.LINEAR,this._minFilter=p.LINEAR,this._maxAnisotropy=1,this._wrapS=p.CLAMP_TO_EDGE,this._wrapT=p.CLAMP_TO_EDGE,this._textureWidth=0,this._textureHeight=0,this._unrefImageDataAfterApply=!1,this._internalFormat=void 0,this._dirtyMipmap=!0,this._textureTarget=p.TEXTURE_2D,this._type=p.UNSIGNED_BYTE,this._isCompressed=!1,this._flipY=!0,this._colorSpaceConversion=p.NONE},setColorSpaceConversion:function(e){this._colorSpaceConversion=e},setFlipY:function(e){this._flipY=e},getTextureTarget:function(){return this._textureTarget},getTextureObject:function(){return this._textureObject},setTextureSize:function(e,t){var i=c.instance().getWebGLParameter("MAX_TEXTURE_SIZE");e===this._textureWidth&&t===this._textureHeight||this.dirty(),void 0!==e&&(e>i?(r.error("width ("+e+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureWidth=i):this._textureWidth=e),void 0!==t&&(t>i?(r.error("height ("+t+') too big for GPU. Max Texture Size is "'+i+'"'),this._textureHeight=i):this._textureHeight=t),this._textureNull=!1},init:function(e){this._gl||this.setGraphicContext(e.getGraphicContext()),this._textureObject||(this._textureObject=p.getTextureManager(this._gl).generateTextureObject(this._gl,this,this._textureTarget,this._internalFormat,this._textureWidth,this._textureHeight),this.dirty(),this._dirtyTextureObject=!1,this._textureNull=!1)},addApplyTexImage2DCallback:function(e){this._applyTexImage2DCallbacks.indexOf(e)<0&&this._applyTexImage2DCallbacks.push(e)},removeApplyTexImage2DCallback:function(e){var t=this._applyTexImage2DCallbacks.indexOf(e);t>=0&&this._applyTexImage2DCallbacks.splice(t,1)},getWidth:function(){return this._textureWidth},getHeight:function(){return this._textureHeight},releaseGLObjects:function(){void 0!==this._textureObject&&null!==this._textureObject&&void 0!==this._gl&&p.getTextureManager(this._gl).releaseTextureObject(this._textureObject),this._textureObject=void 0},getWrapT:function(){return this._wrapT},getWrapS:function(){return this._wrapS},setWrapS:function(e){this._wrapS="string"==typeof e?f(e,p.CLAMP_TO_EDGE):e,this.dirtyTextureParameters()},setWrapT:function(e){this._wrapT="string"==typeof e?f(e,p.CLAMP_TO_EDGE):e,this.dirtyTextureParameters()},dirtyTextureParameters:function(){this.dirty(),this.dirtyMipmap(),this.dirtyTextureObject()},dirtyTextureObject:function(){this._dirtyTextureObject=!0,this.dirtyMipmap(),this.dirty()},getMinFilter:function(){return this._minFilter},getMagFilter:function(){return this._magFilter},setMaxAnisotropy:function(e){this._maxAnisotropy=e,this.dirtyTextureParameters()},getMaxAnisotropy:function(){return this._maxAnisotropy},setMinFilter:function(e){this._minFilter="string"==typeof e?f(e,p.LINEAR):e,this.dirtyTextureParameters()},setMagFilter:function(e){this._magFilter="string"==typeof e?f(e,p.LINEAR):e,this.dirtyTextureParameters()},setImage:function(e,t){var i=e;(e instanceof window.Image||e instanceof HTMLCanvasElement||e instanceof h||e instanceof Uint8Array)&&(i=new s(e)),this._image=i,this.setImageFormat(t),i&&(i.getWidth&&i.getHeight?this.setTextureSize(i.getWidth(),i.getHeight()):i.width&&i.height&&this.setTextureSize(i.width,i.height)),this._textureNull=!1,this.dirty()},getImage:function(){return this._image},setImageFormat:function(e){var t=e;t?("string"==typeof t&&(t=p[t]),this._imageFormat=t):this._imageFormat=p.RGBA},setInternalFormatType:function(e){this._type="string"==typeof e?p[e]:e},getInternalFormatType:function(){return this._type},setUnrefImageDataAfterApply:function(e){this._unrefImageDataAfterApply=e},checkIsCompressed:function(e){switch(e||this._internalFormat){case p.COMPRESSED_RGB_S3TC_DXT1_EXT:case p.COMPRESSED_RGBA_S3TC_DXT1_EXT:case p.COMPRESSED_RGBA_S3TC_DXT3_EXT:case p.COMPRESSED_RGBA_S3TC_DXT5_EXT:case p.COMPRESSED_RGB_ATC_WEBGL:case p.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:case p.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:case p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:case p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:case p.COMPRESSED_RGB_ETC1_WEBGL:return!0;default:return!1}},setInternalFormat:function(e){var t=e;t?("string"==typeof t&&(t=p[t]),this._isCompressed=this.checkIsCompressed(t)):(this._isCompressed=!1,t=p.RGBA),this._internalFormat=t},getInternalFormat:function(){return this._internalFormat},isDirtyMipmap:function(){return this._dirtyMipmap},dirtyMipmap:function(){this._dirtyMipmap=!0},applyFilterParameter:function(e,t){if(d(this._textureWidth)&&d(this._textureHeight)||(this._wrapT=p.CLAMP_TO_EDGE,this._wrapS=p.CLAMP_TO_EDGE,this._minFilter!==p.LINEAR_MIPMAP_LINEAR&&this._minFilter!==p.LINEAR_MIPMAP_NEAREST||(this._minFilter=p.LINEAR)),e.texParameteri(t,e.TEXTURE_MAG_FILTER,this._magFilter),e.texParameteri(t,e.TEXTURE_MIN_FILTER,this._minFilter),this._maxAnisotropy>1&&p.ANISOTROPIC_SUPPORT_EXT){var i=this._maxAnisotropy<p.ANISOTROPIC_SUPPORT_MAX?this._maxAnisotropy:p.ANISOTROPIC_SUPPORT_MAX;e.texParameterf(t,p.TEXTURE_MAX_ANISOTROPY_EXT,i)}e.texParameteri(t,e.TEXTURE_WRAP_S,this._wrapS),e.texParameteri(t,e.TEXTURE_WRAP_T,this._wrapT)},generateMipmap:function(e,t){if(this._dirtyMipmap=!1,this.hasMipmapFilter()){var i=this._image;if(i&&i.hasMipmap())for(var r=this._getInternalFormatGL(),n=i.getMipmap(),a=1,o=n.length;a<o;a++){var s=n[a];this._isCompressed?this.applyTexImage2D(e,this._textureTarget,a,r,s.getWidth(),s.getHeight(),0,s.getImage()):this.applyTexImage2D(e,this._textureTarget,a,r,s.getWidth(),s.getHeight(),0,this._internalFormat,this._type,s.getImage())}else e.generateMipmap(t)}},hasMipmapFilter:function(){return this._minFilter===p.NEAREST_MIPMAP_NEAREST||this._minFilter===p.LINEAR_MIPMAP_NEAREST||this._minFilter===p.NEAREST_MIPMAP_LINEAR||this._minFilter===p.LINEAR_MIPMAP_LINEAR},applyTexImage2D:function(e){var t=Array.prototype.slice.call(arguments,1);n.timeStamp("osgjs.metrics:Texture.texImage2d"),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,this._flipY),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._colorSpaceConversion),this._isCompressed?e.compressedTexImage2D.apply(e,t):e.texImage2D.apply(e,t);var i=this._applyTexImage2DCallbacks.length;if(i>0)for(var r=0,a=i;r<a;r++)this._applyTexImage2DCallbacks[r].call(this)},computeTextureFormat:function(){this._internalFormat?this._imageFormat=this._internalFormat:(this._internalFormat=this._imageFormat||p.RGBA,this._imageFormat=this._internalFormat)},applyImage:function(e){var t=this._getInternalFormatGL(),i=this._image||null,r=i&&this._image.getImage(),n=this._getTypeGL();this._isCompressed?this.applyTexImage2D(e,this._textureTarget,0,t,this._textureWidth,this._textureHeight,0,r):!r||i.isTypedArray()?this.applyTexImage2D(e,this._textureTarget,0,t,this._textureWidth,this._textureHeight,0,this._internalFormat,n,r):this.applyTexImage2D(e,this._textureTarget,0,t,this._internalFormat,n,r),i&&i.setDirty(!1)},apply:function(e){var t=e.getGraphicContext();if(this._dirtyTextureObject&&(this.releaseGLObjects(),this._dirtyTextureObject=!1),void 0===this._textureObject||this.isDirty())if(this._textureNull)t.bindTexture(this._textureTarget,null);else{var i=this._image;if(void 0!==i)if(i.isReady()){this.computeTextureFormat();var r=i.getWidth()||this._textureWidth,n=i.getHeight()||this._textureHeight;this.setTextureSize(r,n),this._textureObject||this.init(e),this._textureObject.bind(t),this.applyImage(t),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget),this._unrefImageDataAfterApply&&(this._image=void 0),this._dirty=!1}else t.bindTexture(this._textureTarget,null);else 0!==this._textureHeight&&0!==this._textureWidth&&(this.computeTextureFormat(),this._textureObject||this.init(e),this._textureObject.bind(t),this.applyImage(t),this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget),this._dirty=!1)}else this._textureObject.bind(t),this.isDirtyMipmap()&&this.generateMipmap(t,this._textureTarget),void 0!==this._image&&this._image.isDirty()&&this.applyImage(t)},_getInternalFormatGL:function(){var e=this._internalFormat;if(!c.instance().isWebGL2())return g[e]||e;var t=m[this._type];return t&&t[e]||e},_getTypeGL:function(){return this._type!==p.HALF_FLOAT||c.instance().isWebGL2()?this._type:p.HALF_FLOAT_OES}})),"osg","Texture"),p.textureNull=new p,p.createFromImage=function(e,t){var i=new p;return i.setImage(e,t),i},p.createFromCanvas=function(e,t){return p.createFromImage(e,t)},e.exports=p},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){i(20),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/popups/message.jinja"]=function(){function e(e,t,i,r,n){var a="";try{var o=null;e.getTemplate("skfb_front/layouts/popup.jinja",!0,"skfb_front/popups/message.jinja",!1,function(s,u){if(s)return void n(s);o=u;for(var l in o.blocks)t.addBlock(l,o.blocks[l]);a+="\n\n";var c;if(c=r.contextOrFrameLookup(t,i,"title"),i.set("popupTitle",c,!0),i.topLevel&&t.setVariable("popupTitle",c),i.topLevel&&t.addExport("popupTitle",c),a+="\n\n",!r.contextOrFrameLookup(t,i,"popupClass")){a+="\n    ";var h;h="popup-message",i.set("popupClass",h,!0),i.topLevel&&t.setVariable("popupClass",h),i.topLevel&&t.addExport("popupClass",h),a+="\n"}a+="\n\n",(o?function(e,t,i,r,n){n("")}:t.getBlock("popup_content"))(e,t,i,r,function(s,u){if(s)return void n(s);a+=u,a+="\n\n",(o?function(e,t,i,r,n){n("")}:t.getBlock("popup_footer"))(e,t,i,r,function(s,u){if(s)return void n(s);a+=u,a+="\n",o?o.rootRenderFunc(e,t,i,r,n):n(null,a)})})})}catch(e){n(r.handleError(e,null,null))}}function t(e,t,i,r,n){var a="";try{var i=i.push(!0);a+="\n\n    ",r.contextOrFrameLookup(t,i,"safe")?(a+="\n        ",a+=r.suppressValue(e.getFilter("safe").call(t,r.contextOrFrameLookup(t,i,"text")),e.opts.autoescape),a+="\n    "):(a+="\n        ",a+=r.suppressValue(r.contextOrFrameLookup(t,i,"text"),e.opts.autoescape),a+="\n    "),a+="\n\n",n(null,a)}catch(e){n(r.handleError(e,null,null))}}function i(e,t,i,r,n){var a="";try{var i=i.push(!0);a+='\n    <div class="actions">\n\n        ',a+="\n        ",a+="\n\n        ",r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"cancel")&&(a+='\n            <button class="button btn-medium btn-tertiary cancel',r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"cancelClass")&&(a+=" ",a+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"cancelClass"),e.opts.autoescape)),a+='" type="reset">',a+=r.suppressValue(e.getFilter("default").call(t,r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"cancelLabel"),"Cancel"),e.opts.autoescape),a+="</button>\n        "),a+="\n\n        ",r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"close")&&(a+='\n            <button class="button btn-medium btn-tertiary',r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"cancelClass")&&(a+=" ",a+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"closeClass"),e.opts.autoescape)),a+='" type="reset" data-action="close">',a+=r.suppressValue(e.getFilter("default").call(t,r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"closeLabel"),"Close"),e.opts.autoescape),a+="</button>\n        "),a+="\n\n        ",r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"continue")&&(a+='\n            <button class="button btn-medium btn-primary submit',r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"continueClass")&&(a+=" ",a+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"continueClass"),e.opts.autoescape)),a+='" type="submit">',a+=r.suppressValue(e.getFilter("default").call(t,r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"continueLabel"),"Continue"),e.opts.autoescape),a+="</button>\n        "),a+="\n\n        ",r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"ok")&&(a+='\n            <button class="button btn-medium btn-primary submit',r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"okClass")&&(a+=" ",a+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"okClass"),e.opts.autoescape)),a+='" type="submit">',a+=r.suppressValue(e.getFilter("default").call(t,r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"okLabel"),"OK"),e.opts.autoescape),a+="</button>\n        "),a+="\n\n        ",r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"delete")&&(a+='\n            <button class="button btn-medium btn-danger submit',r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"deleteClass")&&(a+=" ",a+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"deleteClass"),e.opts.autoescape)),a+='" type="submit">',a+=r.suppressValue(e.getFilter("default").call(t,r.memberLookup(r.contextOrFrameLookup(t,i,"buttons"),"deleteLabel"),"Delete"),e.opts.autoescape),a+="</button>\n        "),a+="\n\n    </div>\n",n(null,a)}catch(e){n(r.handleError(e,null,null))}}return{b_popup_content:t,b_popup_footer:i,root:e}}()}()},,function(e,t,i){"use strict";var r=i(5),n=i(858),a=i.n(n),o=i(859),s=i.n(o),u=i(855),l=i.n(u),c=i(857),h=i.n(c),d=i(856),p=i.n(d),f=i(853),g=i.n(f),m=i(854),v=i.n(m),_=r.a.osg,b=new r.a.osgShader.ShaderProcessor,x={"sketchfabFunctions.glsl":a.a,"sketchfabTextures.glsl":s.a,"lightsPBR.glsl":l.a,"pbrUE4.glsl":h.a,"panoramaSampler.glsl":p.a,"cubemapSampler.glsl":g.a,"curvature.glsl":v.a};b.addShaders(x);var S=function(){this._shaderCache={}};S.prototype={getShaderProcessor:function(){return b},getOrCreateShader:function(e,t,i,r,n){var a="";n&&(a=n.toString());var o=i+a,s=this._shaderCache[o];return s||(s=this.createShader(e,t,i,r,n),this._shaderCache[o]=s),s},createShader:function(e,t,i,r,n){var a="#define SHADER_NAME "+r+"\n";if(n)if(Array.isArray(n))for(var o=0;o<n.length;o++)a+="#define "+n[o]+"\n";else a+="#define "+n+"\n";var s={};return s[i+"-vert"]=a+e,s[i+"-frag"]=a+t,b.addShaders(s),new _.Program(new _.Shader(_.Shader.VERTEX_SHADER,b.getShader(i+"-vert")),new _.Shader(_.Shader.FRAGMENT_SHADER,b.getShader(i+"-frag")))}},t.a=new S},,,,,function(e,t){!function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/notification.jinja"]=function(){function e(e,t,i,r,n){var a="";try{var o=null;a+="\n\n";var s=r.makeMacro(["type","content"],["options"],function(n,a,o){var s=i;i=new r.Frame,o=o||{},o.hasOwnProperty("caller")&&i.set("caller",o.caller),i.set("type",n),i.set("content",a),i.set("options",o.hasOwnProperty("options")?o.options:{});var u="";u+="\n\n    ";var l;return l=e.getFilter("merge").call(t,{safecontent:!1},r.contextOrFrameLookup(t,i,"options")),i.set("options",l,!0),i.topLevel&&t.setVariable("options",l),i.topLevel&&t.addExport("options",l),u+='\n\n    <div class="flashmessage ',u+=r.suppressValue(n,e.opts.autoescape),u+='">\n        <div class="inner">\n            <button class="flashmessage-close" data-action="close" title="Close"></button>\n            <div class="message">\n                ',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"safecontent")?(u+="\n                    ",u+=r.suppressValue(e.getFilter("safe").call(t,a),e.opts.autoescape),u+="\n                "):(u+="\n                    ",u+=r.suppressValue(a,e.opts.autoescape),u+="\n                "),u+="\n            </div>\n        </div>\n    </div>\n\n",i=s,new r.SafeString(u)});t.addExport("flashmessage"),t.setVariable("flashmessage",s),a+="\n",o?o.rootRenderFunc(e,t,i,r,n):n(null,a)}catch(e){n(r.handleError(e,null,null))}}return{root:e}}()}()},function(e,t,i){"use strict";var r=i(14),n=i(91),a=i(363),o=i(421),s=i(293),u=i(67),l=i(8).mat4,c=i(423),h=i(455),d=i(146),p=function(){n.call(this),this.children=[],this._parents=[],this.nodeMask=-1,this._boundingSphere=new o,this._boundingSphereComputed=!1,this._boundingBox=new a,this._boundingBoxComputed=!1,this._updateCallbacks=[],this._cullCallback=void 0,this._cullingActive=!0,this._numChildrenWithCullingDisabled=0,this._numChildrenRequiringUpdateTraversal=0,this._tmpBox=new a};p._reservedMatrixStack=new c;var f=function(){var e=p._reservedMatrixStack.get.bind(p._reservedMatrixStack);return l.identity(e)};r.createPrototypeNode(p,r.objectInherit(n.prototype,{getOrCreateStateSet:function(){return this.stateset||this.setStateSet(new s),this.stateset},getStateSet:function(){return this.stateset},accept:function(e){e.validNodeMask(this)&&(e.pushOntoNodePath(this),e.apply(this),e.popFromNodePath())},dirtyBound:function(){if(!0===this._boundingSphereComputed||!0===this._boundingBoxComputed){this._boundingSphereComputed=!1,this._boundingBoxComputed=!1;for(var e=this._parents,t=0,i=e.length;t<i;t++)e[t].dirtyBound()}},setNodeMask:function(e){this.nodeMask=e},getNodeMask:function(){return this.nodeMask},setStateSet:function(e){if(this.stateset!==e){var t=0;this.stateset&&(this.stateset.requiresUpdateTraversal()&&t--,this.stateset.removeParent(this)),e&&(e.addParent(this),e.requiresUpdateTraversal()&&++t),0!==t&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+t),this.stateset=e}},_updateNumChildrenRequeringUpdateTraversal:function(e){if(0===this._numChildrenRequiringUpdateTraversal&&this._parents.length)for(var t=0,i=this._parents.length;t<i;t++){var r=this._parents[t],n=r.getNumChildrenRequiringUpdateTraversal();r.setNumChildrenRequiringUpdateTraversal(n+e)}},setNumChildrenRequiringUpdateTraversal:function(e){if(this._numChildrenRequiringUpdateTraversal!==e){if(!this._updateCallbacks.length&&this._parents.length){var t=0;if(this._numChildrenRequiringUpdateTraversal>0&&--t,e>0&&++t,0!==t)for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r],o=a.getNumChildrenRequiringUpdateTraversal();a.setNumChildrenRequiringUpdateTraversal(o+t)}}this._numChildrenRequiringUpdateTraversal=e}},getNumChildrenRequiringUpdateTraversal:function(){return this._numChildrenRequiringUpdateTraversal},getUpdateCallback:function(){return this._updateCallbacks[0]},addUpdateCallback:function(e){var t=Boolean(this._updateCallbacks.length);this._updateCallbacks.push(e),t||this._updateNumChildrenRequeringUpdateTraversal(1)},removeUpdateCallback:function(e){var t=this._updateCallbacks.indexOf(e);-1!==t&&(this._updateCallbacks.splice(t,1),this._updateCallbacks.length||this._updateNumChildrenRequeringUpdateTraversal(-1))},getUpdateCallbackList:function(){return this._updateCallbacks},setCullCallback:function(e){this._cullCallback=e},getCullCallback:function(){return this._cullCallback},hasChild:function(e){for(var t=0,i=this.children.length;t<i;t++)if(this.children[t]===e)return!0;return!1},addChild:function(e){if(-1===this.children.indexOf(e))return this.children.push(e),e.addParent(this),this.dirtyBound(),(e.getNumChildrenRequiringUpdateTraversal()>0||e.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()+1),(e.getNumChildrenWithCullingDisabled()>0||!1===e.getCullingActive())&&this.setNumChildrenWithCullingDisabled(this.getNumChildrenWithCullingDisabled()+1),e},getChildren:function(){return this.children},getNumChildren:function(){return this.children.length},getChild:function(e){return this.children[e]},getParents:function(){return this._parents},addParent:function(e){this._parents.push(e)},removeParent:function(e){var t=this._parents.indexOf(e);-1!==t&&this._parents.splice(t,1)},removeChildren:function(){var e=this.children,t=e.length;if(t){for(var i=0,r=0;r<t;r++){var n=e[r];n.removeParent(this),(n.getNumChildrenRequiringUpdateTraversal()>0||n.getUpdateCallbackList().length)&&++i}e.length=0,i&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-i),this.dirtyBound()}},removeChild:function(e){var t=this.children,i=t.indexOf(e);-1!==i&&(e.removeParent(this),t.splice(i,1),(e.getNumChildrenRequiringUpdateTraversal()>0||e.getUpdateCallbackList().length)&&this.setNumChildrenRequiringUpdateTraversal(this.getNumChildrenRequiringUpdateTraversal()-1))},traverse:function(e){for(var t=this.children,i=0,r=t.length;i<r;i++){t[i].accept(e)}},ascend:function(e){for(var t=this._parents,i=0,r=t.length;i<r;i++){t[i].accept(e)}},getBoundingBox:function(){return this._boundingBoxComputed||(this.computeBoundingBox(this._boundingBox),this._boundingBoxComputed=!0),this._boundingBox},computeBoundingBox:function(e){var t=i(496),r=t.instance=t.instance||new t;return r.setNodeMaskOverride(-1),r.reset(),r.apply(this),e.copy(r.getBoundingBox()),e},getBoundingSphere:function(){return this.getBound()},getBound:function(){return this._boundingSphereComputed||(this.computeBoundingSphere(this._boundingSphere),this._boundingSphereComputed=!0),this._boundingSphere},computeBoundingSphere:function(e){var t=this.children,i=t.length;if(e.init(),0===i)return e;var r,n,a=this._tmpBox;for(a.init(),n=0;n<i;n++)r=t[n],r.referenceFrame!==d.ABSOLUTE_RF&&a.expandByBoundingSphere(r.getBound());if(!a.valid())return e;for(e.set(a.center(e.center()),0),n=0;n<i;n++)r=t[n],r.referenceFrame!==d.ABSOLUTE_RF&&e.expandRadiusBySphere(r.getBound());return e},getWorldMatrices:function(){var e=function(){this.nodePaths=[],this.halt=void 0,u.call(this,u.TRAVERSE_PARENTS)};e.prototype=r.objectInherit(u.prototype,{reset:function(){this.nodePath.length=0,this.nodePaths.length=0},apply:function(e){0===e._parents.length||e===this.halt||e.referenceFrame===d.ABSOLUTE_RF?this.nodePaths.push(this.nodePath.slice(0)):this.traverse(e)}});var t=new e;return t.setNodeMaskOverride(-1),function(e,i){t.reset(),t.halt=e,this.accept(t);for(var r=[],n=i||l.create,a=0,o=t.nodePaths.length;a<o;a++){var s=t.nodePaths[a],u=n();0!==s.length&&h.computeLocalToWorld(s,!0,u),r.push(u)}return r}}(),getWorldMatrix:function(e,t){var i=this.getWorldMatrices(e,f);return 0===i.length?l.identity(t):l.copy(t,i[0]),p._reservedMatrixStack.reset(),t},setCullingActive:function(e){if(this._cullingActive!==e){if(0===this._numChildrenWithCullingDisabled&&this._parents.length>0){var t=0;if(this._cullingActive||--t,e||++t,0!==t)for(var i=0,r=this._parents.length;i<r;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+t)}this._cullingActive=e}},getCullingActive:function(){return this._cullingActive},isCullingActive:function(){return 0===this._numChildrenWithCullingDisabled&&this._cullingActive&&this.getBound().valid()},setNumChildrenWithCullingDisabled:function(e){if(this._numChildrenWithCullingDisabled!==e){if(this._cullingActive&&this._parents.length>0){var t=0;if(this._numChildrenWithCullingDisabled>0&&--t,e>0&&++t,0!==t)for(var i=0,r=this._parents.length;i<r;i++)this._parents[i].setNumChildrenWithCullingDisabled(this._parents[i].getNumChildrenWithCullingDisabled()+t)}this._numChildrenWithCullingDisabled=e}},getNumChildrenWithCullingDisabled:function(){return this._numChildrenWithCullingDisabled},releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects()}}),"osg","Node"),e.exports=p},function(e,t,i){"use strict";var r={};r.POINTS=0,r.LINES=1,r.LINE_LOOP=2,r.LINE_STRIP=3,r.TRIANGLES=4,r.TRIANGLE_STRIP=5,r.TRIANGLE_FAN=6,e.exports=r},function(e,t,i){"use strict";var r,n=i(280),a=[{type:"VERTEX_SHADER",text:["attribute vec3 aPosition;","void main() {","gl_Position = vec4(aPosition, 1.0);","}"].join("\n")},{type:"FRAGMENT_SHADER",text:["precision mediump float;","varying vec3 vColor;","void main() {","gl_FragColor = vec4(vColor, 1.0);","}"].join("\n")},{type:"FRAGMENT_SHADER",text:["precision mediump float;","varying vec3 vColor;","void f(in vec3 a, out vec3 b) {","b = 2.0 * a;","}","void main() {","vec3 color;","f(vColor, color);","gl_FragColor = vec4(color, 1.0);","}"].join("\n")}],o=function(e,t,i){var r=t;"string"==typeof r&&(r=e[t]);var n=e.createShader(r);return e.shaderSource(n,i),e.compileShader(n),!(!e.getShaderParameter(n,e.COMPILE_STATUS)&&!e.isContextLost())||(console.warn("Could't compile shader "+i),console.warn(e.getShaderInfoLog(n)),console.warn("You may want to consider a browser that fully supports WebGL."),!1)};t.a=function(){if(void 0!==r)return r;if(r=!1,i.i(n.a)())return!1;for(var e=["webgl","experimental-webgl"],t={antialias:!1},s=null,u=0;u<e.length&&!(s=document.createElement("canvas").getContext(e[u],t));u++);return!!s&&(r=a.every(function(e){return o(s,e.type,e.text)}))}},,function(e,t,i){"use strict";var r,n,a=i(10),o=i.n(a),s=i(5),u=i(1115),l=s.a.osg,c=0,h=o.a.defer(),d={BIAS_MIN:.9,BIAS_MAX:1.1,getBoxReady:function(){return h.promise},updateMaxWorldDisplacement:function(e){e<=c||(c=e,this._updateModelBoxes())},getModelBoxWithDisplacement:function(){return r},getModelBoxWithoutDisplacement:function(){return n},_updateModelBoxes:function(){if(r){var e=r.getMin(),t=r.getMax(),i=l.vec3.fromValues(c,c,c);l.vec3.add(t,t,i),l.vec3.sub(e,e,i)}},computePreciseBox:function(e){var t=new u.a;e.accept(t),n=t.getPreciseBox(),r=new l.BoundingBox,r.copy(n),this._updateModelBoxes(),h.resolve()}};t.a=d},,function(e,t,i){"use strict";var r,n=i(0),a=(i.n(n),i(394)),o=i(167);r=o.a.extend({model:a.a,endpoint:"/categories",_immutableCollectionName:"categories",defaultOptions:{pageSize:""},getTree:function(){var e=this.toJSON(),t=[];return i.i(n.each)(e,function(e){e.children.length&&t.push({children:e.children,value:e.uid,label:e.name})}),i.i(n.each)(t,function(e){var t=e.children.slice();i.i(n.each)(t,function(t,i){if("string"==typeof t){var r=this.get(t).toJSON(),n={value:r.uid,label:r.name};r.children.length&&(n.children=r.children),e.children.splice(i,1,n)}}.bind(this))}.bind(this)),t}}),t.a=r},,,,function(e,t,i){"use strict";var r=i(14),n=i(135),a=i(333),o=i(292),s=i(649),u=function(){n.call(this),this._attributes={},this._primitives=[],this._cacheDrawCall={},this._useVAO=void 0,this._vao={},this._cacheVertexAttributeBufferList={},this._shape=void 0};u.enableVAO=!0,r.createPrototypeNode(u,r.objectInherit(n.prototype,{releaseGLObjects:function(){void 0!==this.stateset&&this.stateset.releaseGLObjects();for(var e in this._attributes){this._attributes[e].releaseGLObjects()}for(var t=0,i=this._primitives.length;t<i;t++){var r=this._primitives[t];void 0!==r.getIndices&&void 0!==r.getIndices()&&null!==r.getIndices()&&r.indices.releaseGLObjects()}this.releaseVAO()},releaseVAO:function(){if(this._useVAO&&this._glContext)for(var e in this._vao)this._vao[e]&&(this._glContext.deleteVertexArray(this._vao[e]),this._vao[e]=void 0)},dirty:function(){this._cacheDrawCall={},this.releaseVAO()},getPrimitives:function(){return this.getPrimitiveSetList()},getAttributes:function(){return this.getVertexAttributeList()},getShape:function(){return this._shape},setShape:function(e){this._shape=e},getVertexAttributeList:function(){return this._attributes},getPrimitiveSetList:function(){return this._primitives},setVertexAttribArray:function(e,t){this._attributes[e]!==t&&(this._attributes[e]=t,this.dirty())},_generateVertexSetup:function(e,t,i){for(var r=["//generated by Geometry::implementation","state.lazyDisablingOfVertexAttributes();","var attr;"],n=0,a=e.length;n<a;n++)r.push("attr = this._attributes['"+e[n]+"'];"),r.push("if ( attr.BufferArrayProxy ) attr = attr.getBufferArray();"),r.push("if ( !attr.isValid() ) return;"),r.push("state.setVertexAttribArray("+t[n]+", attr, attr.getNormalize() );");return r.push("state.applyDisablingOfVertexAttributes();"),i&&r.push("state.setIndexArray( this._primitives[ 0 ].getIndices() );"),r},_generatePrimitive:function(e,t,i){var r=[t?"state.enableVertexColor();":"state.disableVertexColor();"];if(i)return r.concat(["var primitive = this._primitives[ 0 ];","var indexes = primitive.getIndices();","if ( indexes.isDirty() ) {;","  indexes.bind( gl );","  indexes.compile( gl );","};","primitive.drawElements( state );"]);r.push("var primitives = this._primitives;");for(var n=0,a=e.length;n<a;n++)r.push("primitives["+n+"].draw(state);");return r},generateDrawCommand:function(){var e=[],t=[];return function(i,r,n){var a=r._attributesCache,u=this.getVertexAttributeList();t.length=0,e.length=0;var l,c,h,d=this._useVAO,p=d?[]:void 0,f=!1;for(var g in a)if(l=a[g],void 0!==u[g]){var m=this._attributes[g];if(m instanceof s&&(m=m.getBufferArray(),d=!1),!m.isValid())return;d&&p.push(m),f||"Color"!==g||(f=!0),t.push(g),e.push(l)}var v,_;if(d){this._cacheVertexAttributeBufferList[n]=p;var b=1===this._primitives.length&&this._primitives[0]instanceof o,x=this._generateVertexSetup(t,e,b);i.clearVertexAttribCache();var S=i.getGraphicContext(),y=S.createVertexArray();i.setVertexArrayObject(y),this._vao[n]=y;new Function("state",x.join("\n")).call(this,i);var C=["var gl = state.getGraphicContext();","var vao = this._vao[ "+n+" ] ","var hasChanged = state.setVertexArrayObject( vao );","if ( hasChanged ) {","  var vaList = this._cacheVertexAttributeBufferList[ "+n+" ];","  var va;"];for(c=0,h=p.length;c<h;c++)C.push("  va = vaList[ "+c+"];"),C.push("  if ( va.isDirty() ) {;"),C.push("    va.bind( gl );"),C.push("    va.compile( gl );"),C.push("  };");C.push("}"),v=C.concat(this._generatePrimitive(this._primitives,f,b)).join("\n"),_="GeometryDrawImplementationCacheVAO"}else v=this._generateVertexSetup(t,e,!1).concat(this._generatePrimitive(this._primitives,f,!1)).join("\n"),_="GeometryDrawImplementationCache";var T=new Function("state","return function "+_+"( state ) { "+v+"}")();return this._cacheDrawCall[n]=T,T}}(),drawImplementation:function(e){var t=e.getLastProgramApplied(),i=t.getInstanceID(),r=this._cacheDrawCall[i];if(this._useVAO&&!this._vao[i]&&e.setVertexArrayObject(null),r)return void r.call(this,e);this._primitives.length&&(void 0===this._useVAO&&u.enableVAO&&(this._useVAO=a.instance().hasVAO(),this._glContext=e.getGraphicContext()),r=this.generateDrawCommand(e,t,i),r.call(this,e),e.setVertexArrayObject(null))},setBound:function(e){this._boundingBox=e,this._boundingBoxComputed=!0},computeBoundingBox:function(e){e.init();var t=this.getVertexAttributeList().Vertex;if(t&&t.getElements()&&t.getItemSize()>2){for(var i=t.getElements(),r=t.getItemSize(),n=e.getMin(),a=e.getMax(),o=n[0],s=n[1],u=n[2],l=a[0],c=a[1],h=a[2],d=0,p=i.length;d<p;d+=r){var f=i[d],g=i[d+1],m=i[d+2];f<o&&(o=f),f>l&&(l=f),g<s&&(s=g),g>c&&(c=g),m<u&&(u=m),m>h&&(h=m)}n[0]=o,n[1]=s,n[2]=u,a[0]=l,a[1]=c,a[2]=h}return e},computeBoundingSphere:function(e){e.init();var t=this.getBoundingBox();return e.expandByBoundingBox(t),e}}),"osg","Geometry"),u.appendVertexAttributeToList=function(e,t,i){for(var r in e){var n=r;void 0!==i&&(n+="_"+i),t[n]=e[r]}},e.exports=u},function(e,t,i){"use strict";e.exports={RELATIVE_RF:0,ABSOLUTE_RF:1}},,,function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(0),o=(i.n(a),i(395)),s=i(12);t.a=o.a.extend({mixins:[s.a],el:'<div class="widget"/>',constructor:function(e,t){this.environment=i.i(a.extend)({},e?e.environment:{},(t||{}).environment),this.options=t||{},this.collection=this.options.collection,this.model=this.options.model,o.a.call(this,t)},initialize:function(e){o.a.prototype.initialize.call(this,e),this.render(),void 0!==this.options.id&&(this.id=this.options.id,this.$el.attr("id",this.id)),void 0!==this.options.className&&(this.className=this.options.className,this.$el.addClass(this.className)),void 0!==this.options.title&&this.$el.attr("title",this.options.title)},$:function(e){var t=this.$el;return this.$el.find(e).filter(function(){return n()(this).parent().closest(".widget").is(t)})},delegateEvents:function(e){e||(e=i.i(a.result)(this,"events")||{});var t=this.$el;return o.a.prototype.delegateEvents.call(this,Object.keys(e).reduce(function(r,o){var s=e[o];return i.i(a.isFunction)(s)||(s=this[e[o]]),s?(r[o]=function(e){e&&e.currentTarget&&!n()(e.currentTarget).closest(".widget").is(t)||s.apply(this,arguments)}.bind(this),r):r}.bind(this),{})),this.model&&this.model.on("change",this.modelChangeEvent,this),this},undelegateEvents:function(){return o.a.prototype.undelegateEvents.apply(this,arguments),this.model&&this.model.off("change",this.modelChangeEvent,this),this},modelChangeEvent:function(){var e=this.options.name,t=e+".",i=!e,r=Object.keys(this.model.changedAttributes()||{}),n=r.some(function(i){return i===e||0===i.indexOf(t)});(i||n)&&this.render()},change:function(e,t){1===arguments.length&&(t=e,e=void 0);var i=!0,r=function(){i=!1},n={target:this,which:e,value:t,preventDefault:r};return this.trigger("change.before",n),!!i&&(this.defaultAction(e,t),this.trigger("change"),!0)},defaultAction:function(e,t){this.set(t)},field:function(e){return this.options.name+(e?"."+e:"")},get:function(e){return this.model.get(this.field(e))},set:function(e,t){return 1===arguments.length&&(t=e,e=void 0),this.model.set(this.field(e),t)},disable:function(){this._disabled=!0,this.$el.addClass("disabled")},enable:function(){this._disabled=!1,this.$el.removeClass("disabled")}},{reify:function(){var e=arguments,t=this,i=function(){t.apply(this,e)};return i.prototype=this.prototype,new i}})},,,function(e,t,i){"use strict";function r(e){return e.replace(/([A-Z])/g,"_$1").toLowerCase()}function n(e){return e.replace(/[^\w\s-]+/g,"").trim().toLowerCase().replace(/[-\s]+/g,"-")}function a(e,t,i,r){var n=Array.prototype.slice.call(arguments,0);if(n.length&&n[n.length-1].__keywords){var a=n.pop(),o=n[1],s=n[2],u=n[3];t=o||a.trim_url_limit,i=s||a.nofollow,r=u||a.target}null==i&&(i=!0);var l=function(e){return e=e.replace(/^(https?:\/\/)?(www\.)?/,""),null==t?e:e.length<=t?e:e.substr(0,t)+"..."};"string"==typeof e&&(e=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}(e));var c=e.split(f),d=["noopener","noreferrer"],p=r?' target="'+r+'"':"";return i&&d.push("nofollow"),h.a.runtime.markSafe(c.map(function(e){var t=e.match(g);if(null===t)return e;t=t.slice(1);var i=t[0],r=t[1],n=t[2],a=d.join(" ");return r.match(m)?i+'<a href="'+r+'" rel="'+a+'"'+p+">"+l(r)+"</a>"+n:r.match(v)&&-1===r.indexOf(":")?i+'<a href="mailto:'+r+'">'+r+"</a>"+n:r.match(_)?i+'<a href="http://'+r+'" rel="'+a+'"'+p+">"+l(r)+"</a>"+n:r.match(b)?i+'<a href="https://'+window.location.host+"/"+r.substring(1)+'" rel="'+a+'">'+l(r)+"</a>"+n:e}).join(""))}function o(e){return h.a.runtime.markSafe(p.a.sanitize(e,{ALLOWED_TAGS:[]}))}function s(e){var t=e.match(/.+/g);return t?h.a.runtime.markSafe(t.map(function(e){return"<p>"+e+"</p>"}).join("")):e}function u(e,t,i){return void 0===t&&(t=""),void 0===i&&(i="s"),1===e?t:i}function l(e,t,i){return e.split(t).pop().split(i)[0]}t.c=r,t.a=n,t.b=a,t.e=o,t.d=s,t.f=u,t.g=l;var c=i(305),h=i.n(c),d=i(172),p=i.n(d),f=new RegExp("(\\s+|')","g"),g=/^([^\\w@]*)((?:.|\r|\n)*?)((?:[^\\w._-]|&gt;|&lt;|&amp|&quot)*)$/,m=new RegExp("^https?://"),v=new RegExp("^\\S+@[a-zA-Z0-9._-]+\\.[a-zA-Z0-9._-]+$"),_=new RegExp("(^www\\.)|(\\.(com|net|org)$)"),b=new RegExp("(@[a-zA-Z0-9._-]+)")},,,,function(e,t,i){"use strict";var r=i(5),n=i(346),a=r.a.osg,o=["Matcap","Displacement","Opacity","DiffuseColor","DiffusePBR","AlbedoPBR","SpecularColor","DiffuseIntensity","SpecularPBR","MetalnessPBR","GlossinessPBR","RoughnessPBR","NormalMap","BumpMap","AOPBR","EmitColor","CavityPBR","SpecularHardness","SpecularF0"],s=function(e){switch(e){case"Matcap":return n.a.MATCAP;case"Opacity":case"Displacement":return n.a.LIT|n.a.SHADELESS|n.a.MATCAP;case"EmitColor":return n.a.LIT|n.a.SHADELESS;case"NormalMap":case"BumpMap":return n.a.LIT|n.a.MATCAP;case"DiffusePBR":case"AlbedoPBR":case"AOPBR":case"CavityPBR":return n.a.PBR;case"SpecularPBR":case"MetalnessPBR":case"GlossinessPBR":case"RoughnessPBR":case"SpecularF0":return n.a.PBR_LIT;case"DiffuseColor":case"DiffuseIntensity":return n.a.CLASSIC;case"SpecularColor":case"SpecularHardness":return n.a.CLASSIC_LIT}},u=function(e){switch(e){case"DiffuseColor":case"DiffusePBR":case"AlbedoPBR":case"EmitColor":case"SpecularColor":case"SpecularPBR":case"Matcap":return!0;default:return!1}},l=function(e){switch(e){case"DiffuseColor":case"DiffuseIntensity":case"SpecularColor":case"NormalMap":case"EmitColor":case"DiffusePBR":case"AlbedoPBR":case"SpecularPBR":case"Matcap":return a.Texture.RGB;case"SpecularHardness":case"BumpMap":case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SpecularF0":case"AOPBR":case"CavityPBR":case"Displacement":return a.Texture.LUMINANCE;default:case"Opacity":return a.Texture.ALPHA}},c=function(e){switch(l(e)){case a.Texture.RGB:return"rgb";case a.Texture.LUMINANCE:return"r";default:case a.Texture.ALPHA:return"a"}},h=function(e){var t={};switch(e){case"NormalMap":case"SpecularPBR":break;case"SpecularHardness":case"BumpMap":case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SpecularF0":case"AOPBR":case"CavityPBR":case"Displacement":break;case"DiffuseColor":case"DiffuseIntensity":case"SpecularColor":case"EmitColor":case"DiffusePBR":case"AlbedoPBR":case"Matcap":t.LUMINANCE="Luminance",t.RGB="RGB";break;default:case"Opacity":t.ALPHA="Alpha",t.LUMINANCE="Luminance"}return t},d=function(e){switch(e){case"DiffuseColor":case"DiffusePBR":case"AlbedoPBR":return 0;case"EmitColor":return 1;case"SpecularColor":case"SpecularPBR":return 2;case"DiffuseIntensity":return 3;default:return-1}},p=function(e){var t={};return"Displacement"!==e&&(t.LINEAR_MIPMAP_LINEAR="Trilinear (best)"),t.LINEAR="Bilinear",t.NEAREST="Nearest",t},f=function(e){for(var t={},i=0,r=o.length;i<r;++i){var n=o[i];t[n]=e(n)}return function(e){return t[e]}};o.getShadingMask=f(s),o.isSRGB=f(u),o.getDefaultFormat=f(l),o.getDefaultStringFormat=f(c),o.getPossibleFormat=f(h),o.getPossibleFiltering=f(p),o.getColorPacking=f(d),t.a=o},,function(e,t,i){"use strict";t.a=function(e,t,i){if(!e)return"";var r;return r=e.images?e.images:e,0===r.length?"":1===r.length?r[0].url:r.reduce(function(e,r){var n=Math.abs(t-e.width),a=Math.abs(i-e.height),o=n+a,s=Math.abs(t-r.width),u=Math.abs(i-r.height),l=s+u;return(e.width<t||e.height<i)&&(o+=t*i),(r.width<t||r.height<i)&&(l+=t*i),o<l?e:r}).url}},,,function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(0);i.n(a);t.a={name:"LazyLoading",handleLazyLoading:function(e){e=e||{},i.i(a.defaults)(e,{onBeforeLoad:function(){},onAfterLoad:function(){}});var t=function(){this.$(".lazyload").each(function(){var t=n()(this),i=t.attr("data-uri"),r=new Image;r.classList.add("lazyloaded"),r.onload=r.onerror=function(){var i,n=t.width();if(i=r.naturalWidth>n?r.naturalHeight*(n/r.naturalWidth):r.naturalHeight,e.onBeforeLoad(i),t.is(":visible")){var a=function(){t.append(r),t.addClass("loaded").one("transitionend webkittransitionend moztransitionend",function(){t.replaceWith(r),e.onAfterLoad()})}.bind(this);i!==t.outerHeight()?t.css("min-height",i).one("transitionend webkittransitionend moztransitionend",a):a()}else t.replaceWith(r),e.onAfterLoad()},r.src=i})}.bind(this);"complete"===document.readyState?t():n()(window).load(t)}}},,function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(19),o=i.n(a),s=i(2),u=i.n(s),l=i(15),c="/i/hotspots";t.a=l.a.extend({defaults:function(){return{name:"",content:"",position:[0,0,0],eye:[0,0,0],target:[0,0,0],uidImage:void 0,imageFile:void 0,preview:"",hovered:!0,lastComputedScenePosition:[0,0,0],geometryUid:-1,indices:[-1,-1,-1],barycentricWeights:[0,0,0],localPosition:[0,0,0]}},url:function(){return this.isNew()?c:c+"/"+this.get("uid")},remove:function(){return n.a.resolve(o.a.ajax({type:"DELETE",url:this.url()}))},appendArray:function(e,t,i){for(var r=0,n=i.length;r<n;++r)e.append(t,i[r])},save:function(e,t){null!=e&&"object"!=typeof e||(t=e);var i=this.isNew(),r=new FormData,a=this.get("imageFile");void 0===this.get("uidImage")&&a&&r.append("imageFile",a),r.append("model",t.modelUID),r.append("name",this.get("name"));var o=this.get("content").raw;r.append("content",null!==o?o:""),this.appendArray(r,"eye",this.get("eye")),this.appendArray(r,"target",this.get("target")),this.appendArray(r,"position",this.get("position"));var s=this,l=u.a.ajax({type:i?"POST":"PATCH",url:this.url(),data:r,cache:!1,contentType:!1,processData:!1,success:function(e){i&&(s.set("uid",e.uid),e.images.length>0&&s.set("uidImage",e.images[0].uid))},error:function(e){console.error(e.stack)}});return n.a.resolve(l)},_validate:function(e,t){return t=t||{},t.validate=!0,l.a.prototype._validate.call(this,e,t)},validate:function(e){var t=e.eye,i=e.target,r=i[0]-t[0],n=i[1]-t[1],a=i[2]-t[2],o=Math.sqrt(r*r+n*n+a*a);if(o<=1e-8)return i[0]=e.position[0],i[1]=e.position[1],i[2]=e.position[2],!1;if(o<=.001){var s=.01/o;i[0]=t[0]+r*s,i[1]=t[1]+n*s,i[2]=t[2]+a*s}return!1}})},function(e,t,i){"use strict";var r=i(14),n=i(91),a=i(422),o=i(331),s=function(e){var t;return e instanceof r.Float32Array&&(t=5126),e instanceof r.Uint32Array&&(t=5125),e instanceof r.Uint16Array&&(t=5123),e instanceof r.Uint8Array&&(t=5121),t},u=function(e,t,i,o){if(a.call(this),this._instanceID=n.getInstanceID(),this.dirty(),this._itemSize=i,this._target="string"==typeof e?u[e]:e,this._type=void 0,this._normalize=!1,void 0!==t){var s=t;o||(s=this._target===u.ELEMENT_ARRAY_BUFFER?t instanceof r.Uint16Array?t:new r.Uint16Array(t):t instanceof r.Float32Array?t:new r.Float32Array(t)),this.setElements(s)}};u.ELEMENT_ARRAY_BUFFER=34963,u.ARRAY_BUFFER=34962,u._sDeletedGLBufferArrayCache=new window.Map,u.deleteGLBufferArray=function(e,t){u._sDeletedGLBufferArrayCache.has(e)||u._sDeletedGLBufferArrayCache.set(e,[]),u._sDeletedGLBufferArrayCache.get(e).push(t)},u.flushDeletedGLBufferArrays=function(e,t){if(t<=0)return t;if(!u._sDeletedGLBufferArrayCache.has(e))return t;for(var i=0,r=o.instance().tick(),n=u._sDeletedGLBufferArrayCache.get(e),a=n.length,s=a-1;s>=0&&i<t;s--)e.deleteBuffer(n[s]),n.splice(s,1),i=o.instance().deltaS(r,o.instance().tick());return t-i},u.flushAllDeletedGLBufferArrays=function(e){if(u._sDeletedGLBufferArrayCache.has(e))for(var t=u._sDeletedGLBufferArrayCache.get(e),i=t.length,r=i-1;r>=0;r--)e.deleteBuffer(t[r]),t.splice(r,1)},r.createPrototypeObject(u,r.objectInherit(a.prototype,{getInstanceID:function(){return this._instanceID},setItemSize:function(e){this._itemSize=e},isValid:function(){return void 0!==this._buffer||void 0!==this._elements},releaseGLObjects:function(){void 0!==this._buffer&&null!==this._buffer&&void 0!==this._gl&&u.deleteGLBufferArray(this._gl,this._buffer),this._buffer=void 0},setNormalize:function(e){this._normalize=e},getNormalize:function(){return this._normalize},bind:function(e){this._gl||this.setGraphicContext(e);var t=this._target,i=this._buffer;if(i)return void e.bindBuffer(t,i);!i&&this._elements.length>0&&(this._buffer=e.createBuffer(),this._numItems=this._elements.length/this._itemSize,e.bindBuffer(t,this._buffer))},getItemSize:function(){return this._itemSize},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},compile:function(e){this._dirty&&(r.timeStamp("osgjs.metrics:bufferData"),e.bufferData(this._target,this._elements,e.STATIC_DRAW),this._dirty=!1)},getElements:function(){return this._elements},setElements:function(e){this._elements=e,this._type=s(e),this._dirty=!0},getType:function(){return this._type}}),"osg","BufferArray"),e.exports=u},function(e,t,i){"use strict";var r=i(14),n=i(8).mat4,a=i(332),o=i(146),s=function(){a.call(this),this.matrix=n.create()};r.createPrototypeNode(s,r.objectInherit(a.prototype,{getMatrix:function(){return this.matrix},setMatrix:function(e){this.matrix=e,this.dirtyBound()},computeLocalToWorldMatrix:function(e){return this.referenceFrame===o.RELATIVE_RF?n.mul(e,e,this.matrix):n.copy(e,this.matrix),!0},computeWorldToLocalMatrix:function(){var e=n.create();return function(t){return n.invert(e,this.matrix),this.referenceFrame===o.RELATIVE_RF?n.mul(t,e,t):n.copy(t,e),!0}}()}),"osg","MatrixTransform"),e.exports=s},,function(e,t,i){"use strict";var r,n=i(0),a=(i.n(n),i(44));r=a.a.extend({},{get:function(e){e=i.i(n.extend)({},e);var t=this,r=new t;return!1!==e.allowPrefetching?(void 0===this[this._immutableCollectionName]&&(this[this._immutableCollectionName]=r),this[this._immutableCollectionName].fetch(e),this[this._immmutableCollectionName]):r.fetch(e)}}),t.a=r},function(e,t,i){"use strict";var r=i(163),n=i(44),a=i(21);t.a=n.a.extend({comparator:"order",model:r.a,url:function(){var e=this.options.filters.get("modelUID");return(e?"/i/models/"+e+"/hotspots":"/i/hotspots")+a.a.craft("?",{offset:this.options.offset})}})},,,,function(e,t,i){var r,n;!function(a,o){"use strict";r=o,void 0!==(n="function"==typeof r?r.call(t,i,t,e):r)&&(e.exports=n)}(0,function(){"use strict";var e={};return e.sanitize=function(e,t){var i=["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr","svg","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","switch","symbol","text","textpath","title","tref","tspan","view","vkern","math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmuliscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mpspace","msqrt","mystyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","#text"],r=!0,n=["accept","action","align","alt","autocomplete","bgcolor","border","checked","cite","class","color","cols","colspan","coords","datetime","default","dir","disabled","download","enctype","for","headers","height","hidden","high","href","hreflang","id","ismap","label","lang","list","loop","low","max","maxlength","media","method","min","multiple","name","novalidate","open","optimum","pattern","placeholder","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","rows","rowspan","spellcheck","scope","selected","shape","size","span","srclang","start","src","step","style","summary","tabindex","title","type","usemap","valign","value","width","xmlns","accent-height","accumulate","additivive","alignment-baseline","ascent","azimuth","baseline-shift","bias","clip","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dy","dy","direction","display","divisor","dur","elevation","end","fill","fill-opacity","fill-rule","filter","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","front-weight","image-rendering","in","in2","k1","k2","k3","k4","kerning","letter-spacing","lighting-color","local","marker-end","marker-mid","marker-start","max","mask","mode","min","operator","opacity","order","overflow","paint-order","path","points","r","rx","ry","radius","restart","scale","seed","shape-rendering","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","transform","text-anchor","text-decoration","text-rendering","u1","u2","viewbox","visibility","word-spacing","wrap","writing-mode","x","x1","x2","y","y1","y2","z","accent","accentunder","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","display","displaystyle","fence","frame","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","xlink:href","xml:id","xlink:title","xml:space"],a=!1,o=!1,s=!1,u=!0,l=!0,c=["a","abbr","acronym","address","article","aside","b","bdi","bdo","big","blink","blockquote","caption","center","cite","code","col","dd","del","details","dfn","dir","div","dl","dt","em","figcaption","figure","footer","h1","h2","h3","h4","h5","h6","header","i","ins","kbd","label","legend","li","main","mark","marquee","nav","ol","output","p","pre","q","rp","rt","ruby","s","samp","section","small","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","time","tr","tt","u","ul","var"],h=function(e){return document.createNodeIterator(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT|NodeFilter.SHOW_TEXT,function(){return NodeFilter.FILTER_ACCEPT},!1)},d=function(e){return!(e instanceof Text)&&!!(e.children&&!(e.children instanceof HTMLCollection)||e.attributes instanceof NodeList||"string"!=typeof e.nodeName||"string"!=typeof e.textContent||"number"!=typeof e.nodeType||"number"!=typeof e.COMMENT_NODE||"function"!=typeof e.setAttribute||"function"!=typeof e.cloneNode||"function"!=typeof e.removeAttributeNode||"function"!=typeof e.insertAdjacentHTML||"function"!=typeof e.attributes.item)},p=function(e){if(d(e)){try{e.parentNode.removeChild(e)}catch(t){e.outerHTML=""}return!0}if(e.nodeType===e.COMMENT_NODE||-1===i.indexOf(e.nodeName.toLowerCase())){if(l&&e.insertAdjacentHTML&&e.nodeName.toLowerCase&&-1!==c.indexOf(e.nodeName.toLowerCase()))try{e.insertAdjacentHTML("AfterEnd",e.innerHTML)}catch(e){}return e.parentNode.removeChild(e),!0}return s&&!e.firstElementChild&&(e.textContent=e.textContent.replace(/</g,"&lt;")),!1},f=function(e){var t,i,a=/^(\w+script|data):/gi,o=e.cloneNode(!0);if(e.attributes)for(var s=e.attributes.length-1;s>=0;s--)t=o.attributes[s],i=!1,e.removeAttribute(e.attributes[s].name),t instanceof Attr&&(u&&("id"===t.name&&window[t.value]&&(i=!0),"name"===t.name&&document[t.value]&&(i=!0)),!(n.indexOf(t.name.toLowerCase())>-1||r&&t.name.match(/^data-[\w-]+/i))||t.value.replace(/[\x00-\x20]/g,"").match(a)&&("src"!==t.name||0!==t.value.indexOf("data:")||"IMG"!==t.ownerElement.nodeName)||i||e.setAttribute(t.name,t.value))},g=function(e){for(var t,i=h(e);t=i.nextNode();)p(t)||(t.content instanceof DocumentFragment&&g(t.content),f(t))};t&&function(e){e.ALLOWED_ATTR&&(n=e.ALLOWED_ATTR),e.ALLOWED_TAGS&&(i=e.ALLOWED_TAGS),e.ALLOW_DATA_ATTR&&(r=e.ALLOW_DATA_ATTR),e.SAFE_FOR_JQUERY&&(s=e.SAFE_FOR_JQUERY),e.WHOLE_DOCUMENT&&(a=e.WHOLE_DOCUMENT),e.RETURN_DOM&&(o=e.RETURN_DOM),e.SANITIZE_DOM&&(u=e.SANITIZE_DOM),e.KEEP_CONTENT&&(l=e.KEEP_CONTENT),e.ADD_ATTR&&(n=n.concat(e.ADD_ATTR)),e.ADD_TAGS&&(i=i.concat(e.ADD_TAGS)),l&&i.push("#text")}(t);var m=function(e){var t=document.implementation.createHTMLDocument("");t.body.parentNode.removeChild(t.body.parentNode.firstElementChild),t.body.outerHTML=e,null===t.body&&(t.body.innerHTML=e);var i=a?t.body.parentNode:t.body;if(!(t.body instanceof HTMLBodyElement&&t.body instanceof HTMLHtmlElement)){var r=document.implementation.createHTMLDocument("");i=a?r.getElementsByTagName.call(t,"html")[0]:r.getElementsByTagName.call(t,"body")[0]}return i}(e);if(void 0===m)return"";for(var v,_=h(m);v=_.nextNode();)p(v)||(v.content instanceof DocumentFragment&&g(v.content),f(v));return o?m:a?m.outerHTML:m.innerHTML},e})},,function(e,t,i){"use strict";var r=i(4);t.a=r.a.extend({constructor:function(e){this.viewer=e.viewer,this.widgets=e.widgets,r.a.apply(this,arguments)},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.$el.addClass("disabled")},isEnabled:function(){return this.$el.hasClass("disabled")}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var r=i(14),n=i(332),a=i(450),o=i(8).mat4,s=i(97),u=i(146),l=i(8).vec4,c=function(){n.call(this),a.call(this),this.viewport=void 0,this._graphicContext=void 0,this.setClearColor(l.fromValues(0,0,0,1)),this.setClearDepth(1),this.setClearMask(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),this.setViewMatrix(o.create()),this.setProjectionMatrix(o.create()),this.renderOrder=c.NESTED_RENDER,this.renderOrderNum=0,this._view=void 0,this._renderer=void 0,this._attachments={}};c.PRE_RENDER=0,c.NESTED_RENDER=1,c.POST_RENDER=2,c.COLOR_BUFFER_BIT=16384,c.DEPTH_BUFFER_BIT=256,c.STENCIL_BUFFER_BIT=1024,r.createPrototypeNode(c,r.objectInherit(a.prototype,r.objectInherit(n.prototype,{getView:function(){return this._view},setView:function(e){this._view=e},getRenderer:function(){return this._renderer},setRenderer:function(e){this._renderer=e},setFinalDrawCallback:function(e){this._finalDrawCallback=e},getFinalDrawCallback:function(){return this._finalDrawCallback},setInitialDrawCallback:function(e){this._initialDrawCallback=e},getInitialDrawCallback:function(){return this._initialDrawCallback},getAttachments:function(){return this._attachments},setGraphicContext:function(e){this._graphicContext=e},getGraphicContext:function(){return this._graphicContext},setClearDepth:function(e){this.clearDepth=e},getClearDepth:function(){return this.clearDepth},setClearMask:function(e){this.clearMask=e},getClearMask:function(){return this.clearMask},setClearColor:function(e){this.clearColor=e},getClearColor:function(){return this.clearColor},setViewport:function(e){this.viewport=e,this.getOrCreateStateSet().setAttributeAndModes(e)},getViewport:function(){return this.viewport},setViewMatrix:function(e){this.modelviewMatrix=e},setViewMatrixAsLookAt:function(e,t,i){o.lookAt(this.getViewMatrix(),e,t,i)},setProjectionMatrix:function(e){this.projectionMatrix=e},setProjectionMatrixAsOrtho:function(e,t,i,r,n,a){o.ortho(this.getProjectionMatrix(),e,t,i,r,n,a)},isRenderToTextureCamera:function(){return window.Object.keys(this._attachments).length>0},getViewMatrix:function(){return this.modelviewMatrix},getProjectionMatrix:function(){return this.projectionMatrix},getRenderOrder:function(){return this.renderOrder},setRenderOrder:function(e,t){this.renderOrder=e,this.renderOrderNum=t},detachAll:function(){this._attachments={},this.frameBufferObject&&this.frameBufferObject.dirty()},resetAttachments:function(){this.frameBufferObject&&(this.frameBufferObject.reset(),this.frameBufferObject=0),this._attachments={}},attachTexture:function(e,t,i){this.frameBufferObject&&this.frameBufferObject.dirty(),i||(i=s.TEXTURE_2D),this._attachments[e]={attachment:e,texture:t,textureTarget:i}},attachRenderBuffer:function(e,t){this.frameBufferObject&&this.frameBufferObject.dirty(),this._attachments[e]={format:t,attachment:e}},computeLocalToWorldMatrix:function(e){return this.referenceFrame===u.RELATIVE_RF?o.mul(e,e,this.modelviewMatrix):o.copy(e,this.modelviewMatrix),!0},computeWorldToLocalMatrix:function(){var e=o.create();return function(t){return o.invert(e,this.modelviewMatrix),this.referenceFrame===u.RELATIVE_RF?o.mul(t,e,t):o.copy(t,e),!0}}()})),"osg","Camera"),e.exports=c},,,,,,function(e,t,i){"use strict";t.a=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),i=e.indexOf("Trident/");return(t>=0||i>=0)&&(document.all&&!window.atob)}},,,,,,,,,function(e,t,i){"use strict";var r,n=i(405),a=i(167);r=a.a.extend({model:n.a,_immutableCollectionName:"skills",url:"/i/skills"}),t.a=r},,function(e,t,i){"use strict";var r=i(136),n=function(e,t,i){this.mode=e,void 0!==e&&("string"==typeof e&&(e=r[e]),this.mode=e),this.first=t,this.count=i};n.prototype={draw:function(e){if(0!==this.count){e.getGraphicContext().drawArrays(this.mode,this.first,this.count)}},getMode:function(){return this.mode},setCount:function(e){this.count=e},getCount:function(){return this.count},setFirst:function(e){this.first=e},getFirst:function(){return this.first},getNumIndices:function(){return this.count},index:function(e){return this.first+e}},e.exports=n},function(e,t,i){"use strict";var r=i(136),n=function(e,t){this.mode=r.POINTS,void 0!==e&&("string"==typeof e&&(e=r[e]),this.mode=e),this.count=0,this.offset=0,this.indices=t,this.uType=n.UNSIGNED_SHORT,void 0!==t&&this.setIndices(t)};n.UNSIGNED_BYTE=5121,n.UNSIGNED_SHORT=5123,n.UNSIGNED_INT=5125,n.prototype={getMode:function(){return this.mode},draw:function(e){0!==this.count&&(e.setIndexArray(this.indices),this.drawElements(e))},drawElements:function(e){e.getGraphicContext().drawElements(this.mode,this.count,this.uType,this.offset)},setIndices:function(e){this.indices=e;var t=e.getElements();this.count=t.length;var i=t.BYTES_PER_ELEMENT;1===i?this.uType=n.UNSIGNED_BYTE:2===i?this.uType=n.UNSIGNED_SHORT:4===i&&(this.uType=n.UNSIGNED_INT)},getIndices:function(){return this.indices},setFirst:function(e){this.offset=e},getFirst:function(){return this.offset},setCount:function(e){this.count=e},getCount:function(){return this.count},getNumIndices:function(){return this.indices.getElements().length},index:function(e){return this.indices.getElements()[e]}},e.exports=n},function(e,t,i){"use strict";var r=i(91),n=i(68),a=i(14),o=function(){r.call(this),this._parents=[],this._attributeArray=[],this._textureAttributeArrayList=[],this._activeTextureAttributeUnit=[],this._activeAttribute=[],this._activeTextureAttribute=[],this._binName=void 0,this._binNumber=0,this._shaderGeneratorPair=null,this._updateCallbackList=[],this.uniforms={},this._hasUniform=!1,this._drawID=-1};o.AttributePair=function(e,t){this._object=e,this._value=t},o.AttributePair.prototype={getShaderGeneratorName:function(){return this._object},getAttribute:function(){return this._object},getUniform:function(){return this._object},getValue:function(){return this._value}},a.createPrototypeObject(o,a.objectInherit(r.prototype,{setDrawID:function(e){this._drawID=e},getDrawID:function(){return this._drawID},getAttributePair:function(e,t){return new o.AttributePair(e,t)},addUniform:function(e,t){var i=void 0!==t?t:n.ON,r=e.getName();this.uniforms[r]=this.getAttributePair(e,i),this._hasUniform=!0},addParent:function(e){this._parents.push(e)},removeParent:function(e){var t=this._parents.indexOf(e);-1!==t&&this._parents.splice(t,1)},removeUniform:function(e){this.removeUniformByName(e.getName())},removeUniformByName:function(e){delete this.uniforms[e],this._hasUniform=!!r.keys(this.uniforms).length},hasUniform:function(){return this._hasUniform},getUniform:function(e){var t=this.uniforms;if(t[e])return t[e].getAttribute()},getUniformList:function(){return this.uniforms},setTextureAttributeAndModes:function(e,t,i){this._setTextureAttribute(e,this.getAttributePair(t,void 0!==i?i:n.ON))},getNumTextureAttributeLists:function(){return this._textureAttributeArrayList.length},getTextureAttribute:function(e,t){if(void 0!==this._textureAttributeArrayList[e]){var i=a.getTextureIdFromTypeMember(t);if(void 0!==i){var r=this._textureAttributeArrayList[e];return r[i]?r[i].getAttribute():void 0}}},removeTextureAttribute:function(e,t){if(void 0!==this._textureAttributeArrayList[e]){var i=a.getTextureIdFromTypeMember(t);if(void 0!==i){var r=this._textureAttributeArrayList[e];void 0!==r[i]&&(r[i]=void 0,this._computeValidTextureUnit())}}},getAttribute:function(e){var t=a.getIdFromTypeMember(e);if(void 0!==t&&this._attributeArray[t])return this._attributeArray[t].getAttribute()},setAttributeAndModes:function(e,t){this._setAttribute(this.getAttributePair(e,void 0!==t?t:n.ON))},setAttribute:function(e,t){this.setAttributeAndModes(e,t)},removeAttribute:function(e){var t=a.getIdFromTypeMember(e);this._attributeArray[t]=void 0,this._computeValidAttribute()},setRenderingHint:function(e){"OPAQUE_BIN"===e?this.setRenderBinDetails(0,"RenderBin"):"TRANSPARENT_BIN"===e?this.setRenderBinDetails(10,"DepthSortedBin"):this.setRenderBinDetails(0,"")},getUpdateCallbackList:function(){return this._updateCallbackList},removeUpdateCallback:function(e){var t=this._updateCallbackList.indexOf(e);if(-1!==t&&(this._updateCallbackList.splice(t,1),0===this._updateCallbackList.length))for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()-1)}},requiresUpdateTraversal:function(){return!!this._updateCallbackList.length},addUpdateCallback:function(e){var t=Boolean(this._updateCallbackList.length);if(this._updateCallbackList.push(e),!t)for(var i=this._parents,r=0,n=i.length;r<n;r++){var a=i[r];a.setNumChildrenRequiringUpdateTraversal(a.getNumChildrenRequiringUpdateTraversal()+1)}},hasUpdateCallback:function(e){return-1!==this._updateCallbackList.indexOf(e)},setRenderBinDetails:function(e,t){this._binNumber=e,this._binName=t},getAttributeMap:function(){for(var e={},t=0,i=this._attributeArray.length;t<i;t++){var r=this._attributeArray[t];if(r){e[r.getAttribute().getTypeMember()]=r}}return e},getBinNumber:function(){return this._binNumber},getBinName:function(){return this._binName},setBinNumber:function(e){this._binNumber=e},setBinName:function(e){this._binName=e},getAttributeList:function(){for(var e=this._attributeArray,t=[],i=0,r=e.length;i<r;i++)e[i]&&t.push(e[i]);return t},setShaderGeneratorName:function(e,t){this._shaderGeneratorPair=this.getAttributePair(e,void 0!==t?t:n.ON)},getShaderGeneratorPair:function(){return this._shaderGeneratorPair},getShaderGeneratorName:function(){return this._shaderGeneratorPair?this._shaderGeneratorPair.getShaderGeneratorName():void 0},releaseGLObjects:function(){for(var e=0,t=this._textureAttributeArrayList.length;e<t;e++){var i=this.getTextureAttribute(e,"Texture");i&&i.releaseGLObjects()}for(var r=this.getAttributeList(),n=0,a=r.length;n<a;n++)r[n]._object.releaseGLObjects&&r[n]._object.releaseGLObjects()},_setTextureAttribute:function(e,t){var i=this._textureAttributeArrayList;void 0===i[e]&&(i[e]=[]);var r=a.getOrCreateTextureStateAttributeTypeMemberIndex(t.getAttribute());i[e][r]=t,this._computeValidTextureUnit()},_computeValidTextureUnit:function(){this._activeTextureAttributeUnit.length=0,this._activeTextureAttribute.length=0;for(var e=this._textureAttributeArrayList,t=0,i=e.length;t<i;t++){var r=e[t];if(r&&r.length){for(var n=!1,a=0,o=r.length;a<o;a++)r[a]&&(n=!0,-1===this._activeTextureAttribute.indexOf(a)&&this._activeTextureAttribute.push(a));n&&this._activeTextureAttributeUnit.push(t)}}},_computeValidAttribute:function(){this._activeAttribute.length=0;for(var e=this._attributeArray,t=0,i=e.length;t<i;t++)e[t]&&this._activeAttribute.push(t)},_setAttribute:function(e){var t=a.getOrCreateStateAttributeTypeMemberIndex(e.getAttribute());this._attributeArray[t]=e,this._computeValidAttribute()}}),"osg","StateSet"),e.exports=o},function(e,t,i){"use strict";var r=function(e,t){if(!e||!t)return"";var i;for(var r in t)void 0!==(i=t[r])&&(i.getVariable&&(i=i.getVariable()),e=e.replace("%s",i));return e},n=function(e,t){var i=e,r=[],n=t;void 0===t&&(n="");for(var a=0,o=i.length;a<o;a++){var s,u=i[a];s=void 0===u?"undefined":"string"==typeof u?u:u.getType?u.getType()+" "+u.getVariable():u.getVariable(),r.push(n+s)}return r},a=function(e,t,r){var a=i(581),o=[],s="";if(a.debugShaderNode&&(o.push("\n// output"),Array.prototype.push.apply(o,n([t],"// "))),t&&(t.getVariable&&(t=t.getVariable()),s=t+" = "),s=s+e+"( ",r&&r.length>0){a.debugShaderNode&&(o.push("// inputs"),Array.prototype.push.apply(o,n(r,"// ")));for(var u=0,l=r.length;u<l;u++)r[u].getVariable?s+=r[u].getVariable():s+=r[u],u!==l-1&&(s+=", ")}return s+=" );\n",a.debugShaderNode?o.join("\n")+"\n"+s:s};e.exports={callFunction:a,checkVariableType:n,sprintf:r}},,,function(e,t,i){"use strict";var r=i(5),n=i(336),a=i(387),o=r.a.osg,s=r.a.osgShader,u=s.ShaderGenerator,l=function(){u.apply(this,arguments),this.setShaderCompiler(a.a),this._idCompiler=n.a.SHADING_COMPILER};o.createPrototypeObject(l,o.objectInherit(u.prototype,{getOrCreateProgram:function(e){return n.a.CURRENT_COMPILER=this._idCompiler,u.prototype.getOrCreateProgram.call(this,e)}})),t.a=l},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(5),o=i(602),s=i(46),u=i(53),l=a.a.osg,c=function(e){return 0!==e&&(e&1+~e)===e},h=function(e){return 1<<Math.floor(Math.log2(e))},d=function(){l.Texture.call(this),this._isVideo=!1,this._requireOriginalCompression=!1,this._imageModel=void 0,this._convertNPOT=!0,this._truePackingRead=void 0};d.WAIT_ANIMATION=!0;var p=l.ImageStream.prototype.play;l.ImageStream.prototype.play=function(){this._status!==l.ImageStream.PLAYING&&(u.a.draw(),p.call(this))};var f=-1===navigator.userAgent.indexOf("Firefox/46");l.createPrototypeStateAttribute(d,l.objectInherit(l.Texture.prototype,{isVideo:function(){return this._isVideo},getOriginalFormat:function(){return this._truePackingRead||this.getInternalFormat()},_resizeToNearestPowerOf2:function(e){var t=document.createElement("canvas"),i=t.width=h(e.getWidth()),r=t.height=h(e.getHeight()),n=t.getContext("2d");n.drawImage(e.getImage(),0,0,i,r);var a=this._internalFormat;if(a===l.Texture.RGB||a===l.Texture.RGBA)return t;for(var o=n.getImageData(0,0,i,r).data,s=a===l.Texture.ALPHA?3:0,u=i*r,c=new Uint8Array(u),d=0;d<u;++d)c[d]=o[4*d+s];return this.setTextureSize(i,r),c},setImage:function(e,t){var i=e instanceof l.Image;if(!i||e.isDirty()||e!==this.getImage()){var r=e instanceof l.ImageStream;this._convertNPOT&&i&&!r&&(c(e.getWidth())&&c(e.getHeight())||(e=this._resizeToNearestPowerOf2(e))),!f&&this.hasMipmapFilter()&&this.setMinFilter(this.getMagFilter()),l.Texture.prototype.setImage.call(this,e,t),u.a.draw()}},applyTexImage2D:function(){l.Texture.prototype.applyTexImage2D.apply(this,arguments),u.a.draw()},getResourceManager:function(){return this._resourceManager||i(92).default.instance},setImageModel:function(e){this._imageModel=e,this._isVideo=e.isVideo(),this.updateRequireOriginalCompression();var t=this.getImageJSONMaxSupported();t.options&&"A"===t.options.format?(this._truePackingRead=l.Texture.ALPHA,this.setInternalFormat(l.Texture.LUMINANCE)):this._truePackingRead=void 0},getImageModel:function(){return this._imageModel},getImageCount:function(){var e=this._imageModel;return e&&e.getImages?e.getImages().length:this._image?1:0},setImageSmallest:function(){var e=this.getImageSmallest();if(e)return!0===e.promise.isFulfilled()&&e.image?this.setImage(e.image):this._setEntryImage(e,e.promise),e},setImageMaxSupported:function(){var e=this.getImageMaxSupported();if(e){var t=d.WAIT_ANIMATION?s.a.getFirstCameraAnimation():n.a.resolve(),i=n.a.settle([t,e.promise,s.a.getLowResBound()]);return this._setEntryImage(e,i),e}},_setEntryImage:function(e,t){this._lastEntry=e,e.promise=t.then(function(){return this._lastEntry!==e?this._lastEntry.promise:(this.setImage(e.image),e.image)}.bind(this))},getImageSmallest:function(){if(this._imageModel){var e=this._requireOriginalCompression?void 0:this.getOriginalFormat(),t=this._imageModel.findImageNearestToResolution(128,128,e);return this.getResourceImage(t)}},updateRequireOriginalCompression:function(){var e=i.i(o.a)(),t=this._imageModel.findImageNearestPowerOfTwoUpToResolution(e,e,this.getOriginalFormat()),r=this._imageModel.findImageNearestPowerOfTwoUpToResolution(e,e),n=Math.min(e,h(r.width)),a=Math.min(e,h(r.height));return this._requireOriginalCompression=t.width<n||t.height<a,this._requireOriginalCompression},getImageJSONMaxSupported:function(e){e=i.i(o.a)(e);var t=this._requireOriginalCompression?void 0:this.getOriginalFormat();return this._imageModel.findImageNearestPowerOfTwoUpToResolution(e,e,t)},getImageMaxSupported:function(){if(this._imageModel)return this.getResourceImage(this.getImageJSONMaxSupported())},getImageWidget:function(){if(this._imageModel)return this.getResourceImage(this._imageModel.findImageWidget(),!0)},getResourceImage:function(e,t){return!t&&e.url&&e.width*e.height>1048576&&(e.options=e.options||{},e.options.decodeAsync=!0),this.getResourceManager().getOrCreateImage(e.url,e.options)},getHash:function(){return"osgSketchfabTexture"}}),"osgSketchfab","MultiresTexture"),d.dummyTexture=new d,d.dummyTexture.setTextureSize(1,1),t.a=d},function(e,t,i){"use strict";var r=!1,n=function(e){return void 0!==e&&(r=e),r};t.a=n},,,,,,function(e,t,i){(function(t,i){/*! Browser bundle of nunjucks 3.0.1  */
    !function(t,i){e.exports=i()}(0,function(){return function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";var r=i(1),n=i(2),a=i(16),o=i(15),s=i(3);e.exports={},e.exports.Environment=n.Environment,e.exports.Template=n.Template,e.exports.Loader=a,e.exports.FileSystemLoader=o.FileSystemLoader,e.exports.PrecompiledLoader=o.PrecompiledLoader,e.exports.WebLoader=o.WebLoader,e.exports.compiler=i(7),e.exports.parser=i(8),e.exports.lexer=i(9),e.exports.runtime=i(13),e.exports.lib=r,e.exports.nodes=i(10),e.exports.installJinjaCompat=i(22);var u;e.exports.configure=function(e,t){t=t||{},r.isObject(e)&&(t=e,e=null);var i;return o.FileSystemLoader?i=new o.FileSystemLoader(e,{watch:t.watch,noCache:t.noCache}):o.WebLoader&&(i=new o.WebLoader(e,{useCache:t.web&&t.web.useCache,async:t.web&&t.web.async})),u=new n.Environment(i,t),t&&t.express&&u.express(t.express),u},e.exports.compile=function(t,i,r,n){return u||e.exports.configure(),new e.exports.Template(t,i,r,n)},e.exports.render=function(t,i,r){return u||e.exports.configure(),u.render(t,i,r)},e.exports.renderString=function(t,i,r){return u||e.exports.configure(),u.renderString(t,i,r)},s&&(e.exports.precompile=s.precompile,e.exports.precompileString=s.precompileString)},function(e,t){"use strict";var i=Array.prototype,r=Object.prototype,n={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"},a=/[&"'<>]/g,o=function(e){return n[e]},t=e.exports={};t.prettifyError=function(e,i,r){if(r.Update||(r=new t.TemplateError(r)),r.Update(e),!i){var n=r;r=new Error(n.message),r.name=n.name}return r},t.TemplateError=function(e,t,i){var r=this;if(e instanceof Error){r=e,e=e.name+": "+e.message;try{r.name=""}catch(e){r=this}}else Error.captureStackTrace&&Error.captureStackTrace(r);return r.name="Template render error",r.message=e,r.lineno=t,r.colno=i,r.firstUpdate=!0,r.Update=function(e){var t="("+(e||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?t+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(t+=" [Line "+this.lineno+"]")),t+="\n ",this.firstUpdate&&(t+=" "),this.message=t+(this.message||""),this.firstUpdate=!1,this},r},t.TemplateError.prototype=Error.prototype,t.escape=function(e){return e.replace(a,o)},t.isFunction=function(e){return"[object Function]"===r.toString.call(e)},t.isArray=Array.isArray||function(e){return"[object Array]"===r.toString.call(e)},t.isString=function(e){return"[object String]"===r.toString.call(e)},t.isObject=function(e){return"[object Object]"===r.toString.call(e)},t.groupBy=function(e,i){for(var r={},n=t.isFunction(i)?i:function(e){return e[i]},a=0;a<e.length;a++){var o=e[a],s=n(o,a);(r[s]||(r[s]=[])).push(o)}return r},t.toArray=function(e){return Array.prototype.slice.call(e)},t.without=function(e){var i=[];if(!e)return i;for(var r=-1,n=e.length,a=t.toArray(arguments).slice(1);++r<n;)-1===t.indexOf(a,e[r])&&i.push(e[r]);return i},t.extend=function(e,t){for(var i in t)e[i]=t[i];return e},t.repeat=function(e,t){for(var i="",r=0;r<t;r++)i+=e;return i},t.each=function(e,t,r){if(null!=e)if(i.each&&e.each===i.each)e.forEach(t,r);else if(e.length===+e.length)for(var n=0,a=e.length;n<a;n++)t.call(r,e[n],n,e)},t.map=function(e,t){var r=[];if(null==e)return r;if(i.map&&e.map===i.map)return e.map(t);for(var n=0;n<e.length;n++)r[r.length]=t(e[n],n);return e.length===+e.length&&(r.length=e.length),r},t.asyncIter=function(e,t,i){function r(){n++,n<e.length?t(e[n],n,r,i):i()}var n=-1;r()},t.asyncFor=function(e,i,r){function n(){s++;var t=a[s];s<o?i(t,e[t],s,o,n):r()}var a=t.keys(e),o=a.length,s=-1;n()},t.indexOf=Array.prototype.indexOf?function(e,t,i){return Array.prototype.indexOf.call(e,t,i)}:function(e,t,i){var r=this.length>>>0;for(i=+i||0,Math.abs(i)===1/0&&(i=0),i<0&&(i+=r)<0&&(i=0);i<r;i++)if(e[i]===t)return i;return-1},Array.prototype.map||(Array.prototype.map=function(){throw new Error("map is unimplemented for this js engine")}),t.keys=function(e){if(Object.prototype.keys)return e.keys();var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t},t.inOperator=function(e,i){if(t.isArray(i))return-1!==t.indexOf(i,e);if(t.isObject(i))return e in i;if(t.isString(i))return-1!==i.indexOf(e);throw new Error('Cannot use "in" operator to search for "'+e+'" in unexpected types.')}},function(e,t,i){"use strict";function r(e,t,i){o(function(){e(t,i)})}var n,a=i(3),o=i(4),s=i(1),u=i(6),l=i(7),c=i(14),h=i(15),d=i(13),p=i(18),f=i(19),g=d.Frame;h.PrecompiledLoader=i(17);var m=u.extend({init:function(e,t){t=this.opts=t||{},this.opts.dev=!!t.dev,this.opts.autoescape=null==t.autoescape||t.autoescape,this.opts.throwOnUndefined=!!t.throwOnUndefined,this.opts.trimBlocks=!!t.trimBlocks,this.opts.lstripBlocks=!!t.lstripBlocks,this.loaders=[],e?this.loaders=s.isArray(e)?e:[e]:h.FileSystemLoader?this.loaders=[new h.FileSystemLoader("views")]:h.WebLoader&&(this.loaders=[new h.WebLoader("/views")]),window.nunjucksPrecompiled&&this.loaders.unshift(new h.PrecompiledLoader(window.nunjucksPrecompiled)),this.initCache(),this.globals=p(),this.filters={},this.asyncFilters=[],this.extensions={},this.extensionsList=[];for(var i in c)this.addFilter(i,c[i])},initCache:function(){s.each(this.loaders,function(e){e.cache={},"function"==typeof e.on&&e.on("update",function(t){e.cache[t]=null})})},addExtension:function(e,t){return t._name=e,this.extensions[e]=t,this.extensionsList.push(t),this},removeExtension:function(e){var t=this.getExtension(e);t&&(this.extensionsList=s.without(this.extensionsList,t),delete this.extensions[e])},getExtension:function(e){return this.extensions[e]},hasExtension:function(e){return!!this.extensions[e]},addGlobal:function(e,t){return this.globals[e]=t,this},getGlobal:function(e){if(void 0===this.globals[e])throw new Error("global not found: "+e);return this.globals[e]},addFilter:function(e,t,i){var r=t;return i&&this.asyncFilters.push(e),this.filters[e]=r,this},getFilter:function(e){if(!this.filters[e])throw new Error("filter not found: "+e);return this.filters[e]},resolveTemplate:function(e,t,i){return!(e.isRelative&&t&&e.isRelative(i)&&e.resolve)?i:e.resolve(t,i)},getTemplate:function(e,t,i,r,a){var o=this,u=null;if(e&&e.raw&&(e=e.raw),s.isFunction(i)&&(a=i,i=null,t=t||!1),s.isFunction(t)&&(a=t,t=!1),e instanceof n)u=e;else{if("string"!=typeof e)throw new Error("template names must be a string: "+e);for(var l=0;l<this.loaders.length;l++){var c=this.resolveTemplate(this.loaders[l],i,e);if(u=this.loaders[l].cache[c])break}}if(!u){var h,d=this,p=function(i,o){if(o||i||r||(i=new Error("template not found: "+e)),i){if(!a)throw i;a(i)}else{var s;o?(s=new n(o.src,d,o.path,t),o.noCache||(o.loader.cache[e]=s)):s=new n("",d,"",t),a?a(null,s):h=s}};return s.asyncIter(this.loaders,function(t,r,n,a){function s(e,i){e?a(e):i?(i.loader=t,a(null,i)):n()}e=o.resolveTemplate(t,i,e),t.async?t.getSource(e,s):s(null,t.getSource(e))},p),h}if(t&&u.compile(),!a)return u;a(null,u)},express:function(e){function t(e,t){if(this.name=e,this.path=e,this.defaultEngine=t.defaultEngine,this.ext=a.extname(e),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}var i=this;return t.prototype.render=function(e,t){i.render(this.name,e,t)},e.set("view",t),e.set("nunjucksEnv",this),this},render:function(e,t,i){s.isFunction(t)&&(i=t,t=null);var n=null;return this.getTemplate(e,function(e,a){if(e&&i)r(i,e);else{if(e)throw e;n=a.render(t,i)}}),n},renderString:function(e,t,i,r){return s.isFunction(i)&&(r=i,i={}),i=i||{},new n(e,this,i.path).render(t,r)},waterfall:f}),v=u.extend({init:function(e,t,i){this.env=i||new m,this.ctx={};for(var r in e)e.hasOwnProperty(r)&&(this.ctx[r]=e[r]);this.blocks={},this.exported=[];for(var n in t)this.addBlock(n,t[n])},lookup:function(e){return e in this.env.globals&&!(e in this.ctx)?this.env.globals[e]:this.ctx[e]},setVariable:function(e,t){this.ctx[e]=t},getVariables:function(){return this.ctx},addBlock:function(e,t){return this.blocks[e]=this.blocks[e]||[],this.blocks[e].push(t),this},getBlock:function(e){if(!this.blocks[e])throw new Error('unknown block "'+e+'"');return this.blocks[e][0]},getSuper:function(e,t,i,r,n,a){var o=s.indexOf(this.blocks[t]||[],i),u=this.blocks[t][o+1],l=this;if(-1===o||!u)throw new Error('no super block available for "'+t+'"');u(e,l,r,n,a)},addExport:function(e){this.exported.push(e)},getExported:function(){for(var e={},t=0;t<this.exported.length;t++){var i=this.exported[t];e[i]=this.ctx[i]}return e}});n=u.extend({init:function(e,t,i,r){if(this.env=t||new m,s.isObject(e))switch(e.type){case"code":this.tmplProps=e.obj;break;case"string":this.tmplStr=e.obj}else{if(!s.isString(e))throw new Error("src must be a string or an object describing the source");this.tmplStr=e}if(this.path=i,r){var n=this;try{n._compile()}catch(e){throw s.prettifyError(this.path,this.env.opts.dev,e)}}else this.compiled=!1},render:function(e,t,i){"function"==typeof e?(i=e,e={}):"function"==typeof t&&(i=t,t=null);var n=!0;t&&(n=!1);var a=this;try{a.compile()}catch(e){var o=s.prettifyError(this.path,this.env.opts.dev,e);if(i)return r(i,o);throw o}var u=new v(e||{},a.blocks,a.env),l=t?t.push(!0):new g;l.topLevel=!0;var c=null;return a.rootRenderFunc(a.env,u,l||new g,d,function(e,t){if(e&&(e=s.prettifyError(a.path,a.env.opts.dev,e)),i)n?r(i,e,t):i(e,t);else{if(e)throw e;c=t}}),c},getExported:function(e,t,i){"function"==typeof e&&(i=e,e={}),"function"==typeof t&&(i=t,t=null);try{this.compile()}catch(e){if(i)return i(e);throw e}var r=t?t.push():new g;r.topLevel=!0;var n=new v(e||{},this.blocks,this.env);this.rootRenderFunc(this.env,n,r,d,function(e){e?i(e,null):i(null,n.getExported())})},compile:function(){this.compiled||this._compile()},_compile:function(){var e;if(this.tmplProps)e=this.tmplProps;else{var t=l.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.opts);e=new Function(t)()}this.blocks=this._getBlocks(e),this.rootRenderFunc=e.root,this.compiled=!0},_getBlocks:function(e){var t={};for(var i in e)"b_"===i.slice(0,2)&&(t[i.slice(2)]=e[i]);return t}}),e.exports={Environment:m,Template:n}},function(e,t){},function(e,t,i){"use strict";function r(){if(u.length)throw u.shift()}function n(e){var t;t=s.length?s.pop():new a,t.task=e,o(t)}function a(){this.task=null}var o=i(5),s=[],u=[],l=o.makeRequestCallFromTimer(r);e.exports=n,a.prototype.call=function(){try{this.task.call()}catch(e){n.onerror?n.onerror(e):(u.push(e),l())}finally{this.task=null,s[s.length]=this}}},function(e,t){(function(t){"use strict";function i(e){o.length||(a(),s=!0),o[o.length]=e}function r(){for(;u<o.length;){var e=u;if(u+=1,o[e].call(),u>l){for(var t=0,i=o.length-u;t<i;t++)o[t]=o[t+u];o.length-=u,u=0}}o.length=0,u=0,s=!1}function n(e){return function(){function t(){clearTimeout(i),clearInterval(r),e()}var i=setTimeout(t,0),r=setInterval(t,50)}}e.exports=i;var a,o=[],s=!1,u=0,l=1024,c=void 0!==t?t:self,h=c.MutationObserver||c.WebKitMutationObserver;a="function"==typeof h?function(e){var t=1,i=new h(e),r=document.createTextNode("");return i.observe(r,{characterData:!0}),function(){t=-t,r.data=t}}(r):n(r),i.requestFlush=a,i.makeRequestCallFromTimer=n}).call(t,function(){return this}())},function(e,t){"use strict";function i(e,t,r){var n=function(){};n.prototype=e.prototype;var a=new n,o=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;r=r||{};for(var s in r){var u=r[s],l=a[s];"function"==typeof l&&"function"==typeof u&&o.test(u)?a[s]=function(e,t){return function(){var i=this.parent;this.parent=t;var r=e.apply(this,arguments);return this.parent=i,r}}(u,l):a[s]=u}a.typename=t;var c=function(){a.init&&a.init.apply(this,arguments)};return c.prototype=a,c.prototype.constructor=c,c.extend=function(e,t){return"object"==typeof e&&(t=e,e="anonymous"),i(c,e,t)},c}e.exports=i(Object,"Object",{})},function(e,t,i){"use strict";function r(e){return function(t,i){this.compile(t.left,i),this.emit(e),this.compile(t.right,i)}}var n=i(1),a=i(8),o=i(12),s=i(10),u=i(6),l=i(13).Frame,c={"==":"==","===":"===","!=":"!=","!==":"!==","<":"<",">":">","<=":"<=",">=":">="},h=u.extend({init:function(e,t){this.templateName=e,this.codebuf=[],this.lastId=0,this.buffer=null,this.bufferStack=[],this.scopeClosers="",this.inBlock=!1,this.throwOnUndefined=t},fail:function(e,t,i){throw void 0!==t&&(t+=1),void 0!==i&&(i+=1),new n.TemplateError(e,t,i)},pushBufferId:function(e){this.bufferStack.push(this.buffer),this.buffer=e,this.emit("var "+this.buffer+' = "";')},popBufferId:function(){this.buffer=this.bufferStack.pop()},emit:function(e){this.codebuf.push(e)},emitLine:function(e){this.emit(e+"\n")},emitLines:function(){n.each(n.toArray(arguments),function(e){this.emitLine(e)},this)},emitFuncBegin:function(e){this.buffer="output",this.scopeClosers="",this.emitLine("function "+e+"(env, context, frame, runtime, cb) {"),this.emitLine("var lineno = null;"),this.emitLine("var colno = null;"),this.emitLine("var "+this.buffer+' = "";'),this.emitLine("try {")},emitFuncEnd:function(e){e||this.emitLine("cb(null, "+this.buffer+");"),this.closeScopeLevels(),this.emitLine("} catch (e) {"),this.emitLine("  cb(runtime.handleError(e, lineno, colno));"),this.emitLine("}"),this.emitLine("}"),this.buffer=null},addScopeLevel:function(){this.scopeClosers+="})"},closeScopeLevels:function(){this.emitLine(this.scopeClosers+";"),this.scopeClosers=""},withScopedSyntax:function(e){var t=this.scopeClosers;this.scopeClosers="",e.call(this),this.closeScopeLevels(),this.scopeClosers=t},makeCallback:function(e){var t=this.tmpid();return"function("+t+(e?","+e:"")+") {\nif("+t+") { cb("+t+"); return; }"},tmpid:function(){return"t_"+ ++this.lastId},_templateName:function(){return null==this.templateName?"undefined":JSON.stringify(this.templateName)},_compileChildren:function(e,t){for(var i=e.children,r=0,n=i.length;r<n;r++)this.compile(i[r],t)},_compileAggregate:function(e,t,i,r){i&&this.emit(i);for(var n=0;n<e.children.length;n++)n>0&&this.emit(","),this.compile(e.children[n],t);r&&this.emit(r)},_compileExpression:function(e,t){this.assertType(e,s.Literal,s.Symbol,s.Group,s.Array,s.Dict,s.FunCall,s.Caller,s.Filter,s.LookupVal,s.Compare,s.InlineIf,s.In,s.And,s.Or,s.Not,s.Add,s.Concat,s.Sub,s.Mul,s.Div,s.FloorDiv,s.Mod,s.Pow,s.Neg,s.Pos,s.Compare,s.NodeList),this.compile(e,t)},assertType:function(e){for(var t=n.toArray(arguments).slice(1),i=!1,r=0;r<t.length;r++)e instanceof t[r]&&(i=!0);i||this.fail("assertType: invalid type: "+e.typename,e.lineno,e.colno)},compileCallExtension:function(e,t,i){var r=e.args,a=e.contentArgs,o="boolean"!=typeof e.autoescape||e.autoescape;if(i||this.emit(this.buffer+" += runtime.suppressValue("),this.emit('env.getExtension("'+e.extName+'")["'+e.prop+'"]('),this.emit("context"),(r||a)&&this.emit(","),r&&(r instanceof s.NodeList||this.fail("compileCallExtension: arguments must be a NodeList, use `parser.parseSignature`"),n.each(r.children,function(e,i){this._compileExpression(e,t),(i!==r.children.length-1||a.length)&&this.emit(",")},this)),a.length&&n.each(a,function(e,i){if(i>0&&this.emit(","),e){var r=this.tmpid();this.emitLine("function(cb) {"),this.emitLine("if(!cb) { cb = function(err) { if(err) { throw err; }}}"),this.pushBufferId(r),this.withScopedSyntax(function(){this.compile(e,t),this.emitLine("cb(null, "+r+");")}),this.popBufferId(),this.emitLine("return "+r+";"),this.emitLine("}")}else this.emit("null")},this),i){var u=this.tmpid();this.emitLine(", "+this.makeCallback(u)),this.emitLine(this.buffer+" += runtime.suppressValue("+u+", "+o+" && env.opts.autoescape);"),this.addScopeLevel()}else this.emit(")"),this.emit(", "+o+" && env.opts.autoescape);\n")},compileCallExtensionAsync:function(e,t){this.compileCallExtension(e,t,!0)},compileNodeList:function(e,t){this._compileChildren(e,t)},compileLiteral:function(e){if("string"==typeof e.value){var t=e.value.replace(/\\/g,"\\\\");t=t.replace(/"/g,'\\"'),t=t.replace(/\n/g,"\\n"),t=t.replace(/\r/g,"\\r"),t=t.replace(/\t/g,"\\t"),this.emit('"'+t+'"')}else null===e.value?this.emit("null"):this.emit(e.value.toString())},compileSymbol:function(e,t){var i,r=e.value;(i=t.lookup(r))?this.emit(i):this.emit('runtime.contextOrFrameLookup(context, frame, "'+r+'")')},compileGroup:function(e,t){this._compileAggregate(e,t,"(",")")},compileArray:function(e,t){this._compileAggregate(e,t,"[","]")},compileDict:function(e,t){this._compileAggregate(e,t,"{","}")},compilePair:function(e,t){var i=e.key,r=e.value;i instanceof s.Symbol?i=new s.Literal(i.lineno,i.colno,i.value):i instanceof s.Literal&&"string"==typeof i.value||this.fail("compilePair: Dict keys must be strings or names",i.lineno,i.colno),this.compile(i,t),this.emit(": "),this._compileExpression(r,t)},compileInlineIf:function(e,t){this.emit("("),this.compile(e.cond,t),this.emit("?"),this.compile(e.body,t),this.emit(":"),null!==e.else_?this.compile(e.else_,t):this.emit('""'),this.emit(")")},compileIn:function(e,t){this.emit("runtime.inOperator("),this.compile(e.left,t),this.emit(","),this.compile(e.right,t),this.emit(")")},compileOr:r(" || "),compileAnd:r(" && "),compileAdd:r(" + "),compileConcat:r(' + "" + '),compileSub:r(" - "),compileMul:r(" * "),compileDiv:r(" / "),compileMod:r(" % "),compileNot:function(e,t){this.emit("!"),this.compile(e.target,t)},compileFloorDiv:function(e,t){this.emit("Math.floor("),this.compile(e.left,t),this.emit(" / "),this.compile(e.right,t),this.emit(")")},compilePow:function(e,t){this.emit("Math.pow("),this.compile(e.left,t),this.emit(", "),this.compile(e.right,t),this.emit(")")},compileNeg:function(e,t){this.emit("-"),this.compile(e.target,t)},compilePos:function(e,t){this.emit("+"),this.compile(e.target,t)},compileCompare:function(e,t){this.compile(e.expr,t);for(var i=0;i<e.ops.length;i++){var r=e.ops[i];this.emit(" "+c[r.type]+" "),this.compile(r.expr,t)}},compileLookupVal:function(e,t){this.emit("runtime.memberLookup(("),this._compileExpression(e.target,t),this.emit("),"),this._compileExpression(e.val,t),this.emit(")")},_getNodeName:function(e){switch(e.typename){case"Symbol":return e.value;case"FunCall":return"the return value of ("+this._getNodeName(e.name)+")";case"LookupVal":return this._getNodeName(e.target)+'["'+this._getNodeName(e.val)+'"]';case"Literal":return e.value.toString();default:return"--expression--"}},compileFunCall:function(e,t){this.emit("(lineno = "+e.lineno+", colno = "+e.colno+", "),this.emit("runtime.callWrap("),this._compileExpression(e.name,t),this.emit(', "'+this._getNodeName(e.name).replace(/"/g,'\\"')+'", context, '),this._compileAggregate(e.args,t,"[","])"),this.emit(")")},compileFilter:function(e,t){var i=e.name;this.assertType(i,s.Symbol),this.emit('env.getFilter("'+i.value+'").call(context, '),this._compileAggregate(e.args,t),this.emit(")")},compileFilterAsync:function(e,t){var i=e.name;this.assertType(i,s.Symbol);var r=e.symbol.value;t.set(r,r),this.emit('env.getFilter("'+i.value+'").call(context, '),this._compileAggregate(e.args,t),this.emitLine(", "+this.makeCallback(r)),this.addScopeLevel()},compileKeywordArgs:function(e,t){var i=[];n.each(e.children,function(e){i.push(e.key.value)}),this.emit("runtime.makeKeywordArgs("),this.compileDict(e,t),this.emit(")")},compileSet:function(e,t){var i=[];n.each(e.targets,function(e){var r=e.value,n=t.lookup(r);null!==n&&void 0!==n||(n=this.tmpid(),this.emitLine("var "+n+";")),i.push(n)},this),e.value?(this.emit(i.join(" = ")+" = "),this._compileExpression(e.value,t),this.emitLine(";")):(this.emit(i.join(" = ")+" = "),this.compile(e.body,t),this.emitLine(";")),n.each(e.targets,function(e,t){var r=i[t],n=e.value;this.emitLine('frame.set("'+n+'", '+r+", true);"),this.emitLine("if(frame.topLevel) {"),this.emitLine('context.setVariable("'+n+'", '+r+");"),this.emitLine("}"),"_"!==n.charAt(0)&&(this.emitLine("if(frame.topLevel) {"),this.emitLine('context.addExport("'+n+'", '+r+");"),this.emitLine("}"))},this)},compileIf:function(e,t,i){this.emit("if("),this._compileExpression(e.cond,t),this.emitLine(") {"),this.withScopedSyntax(function(){this.compile(e.body,t),i&&this.emit("cb()")}),e.else_?(this.emitLine("}\nelse {"),this.withScopedSyntax(function(){this.compile(e.else_,t),i&&this.emit("cb()")})):i&&(this.emitLine("}\nelse {"),this.emit("cb()")),this.emitLine("}")},compileIfAsync:function(e,t){this.emit("(function(cb) {"),this.compileIf(e,t,!0),this.emit("})("+this.makeCallback()),this.addScopeLevel()},emitLoopBindings:function(e,t,i,r){var n={index:i+" + 1",index0:i,revindex:r+" - "+i,revindex0:r+" - "+i+" - 1",first:i+" === 0",last:i+" === "+r+" - 1",length:r};for(var a in n)this.emitLine('frame.set("loop.'+a+'", '+n[a]+");")},compileFor:function(e,t){var i,r=this.tmpid(),n=this.tmpid(),a=this.tmpid();if(t=t.push(),this.emitLine("frame = frame.push();"),this.emit("var "+a+" = "),this._compileExpression(e.arr,t),this.emitLine(";"),this.emit("if("+a+") {"),e.name instanceof s.Array){this.emitLine("var "+r+";"),this.emitLine("if(runtime.isArray("+a+")) {"),this.emitLine("var "+n+" = "+a+".length;"),this.emitLine("for("+r+"=0; "+r+" < "+a+".length; "+r+"++) {");for(var o=0;o<e.name.children.length;o++){var u=this.tmpid();this.emitLine("var "+u+" = "+a+"["+r+"]["+o+"]"),this.emitLine('frame.set("'+e.name.children[o].value+'", '+a+"["+r+"]["+o+"]);"),t.set(e.name.children[o].value,u)}this.emitLoopBindings(e,a,r,n),this.withScopedSyntax(function(){this.compile(e.body,t)}),this.emitLine("}"),this.emitLine("} else {");var l=e.name.children[0],c=e.name.children[1],h=this.tmpid();i=this.tmpid(),t.set(l.value,h),t.set(c.value,i),this.emitLine(r+" = -1;"),this.emitLine("var "+n+" = runtime.keys("+a+").length;"),this.emitLine("for(var "+h+" in "+a+") {"),this.emitLine(r+"++;"),this.emitLine("var "+i+" = "+a+"["+h+"];"),this.emitLine('frame.set("'+l.value+'", '+h+");"),this.emitLine('frame.set("'+c.value+'", '+i+");"),this.emitLoopBindings(e,a,r,n),this.withScopedSyntax(function(){this.compile(e.body,t)}),this.emitLine("}"),this.emitLine("}")}else i=this.tmpid(),t.set(e.name.value,i),this.emitLine("var "+n+" = "+a+".length;"),this.emitLine("for(var "+r+"=0; "+r+" < "+a+".length; "+r+"++) {"),this.emitLine("var "+i+" = "+a+"["+r+"];"),this.emitLine('frame.set("'+e.name.value+'", '+i+");"),this.emitLoopBindings(e,a,r,n),this.withScopedSyntax(function(){this.compile(e.body,t)}),this.emitLine("}");this.emitLine("}"),e.else_&&(this.emitLine("if (!"+n+") {"),this.compile(e.else_,t),this.emitLine("}")),this.emitLine("frame = frame.pop();")},_compileAsyncLoop:function(e,t,i){var r=this.tmpid(),a=this.tmpid(),o=this.tmpid(),u=i?"asyncAll":"asyncEach";if(t=t.push(),this.emitLine("frame = frame.push();"),this.emit("var "+o+" = "),this._compileExpression(e.arr,t),this.emitLine(";"),e.name instanceof s.Array)this.emit("runtime."+u+"("+o+", "+e.name.children.length+", function("),n.each(e.name.children,function(e){this.emit(e.value+",")},this),this.emit(r+","+a+",next) {"),n.each(e.name.children,function(e){var i=e.value;t.set(i,i),this.emitLine('frame.set("'+i+'", '+i+");")},this);else{var l=e.name.value;this.emitLine("runtime."+u+"("+o+", 1, function("+l+", "+r+", "+a+",next) {"),this.emitLine('frame.set("'+l+'", '+l+");"),t.set(l,l)}this.emitLoopBindings(e,o,r,a),this.withScopedSyntax(function(){var n;i&&(n=this.tmpid(),this.pushBufferId(n)),this.compile(e.body,t),this.emitLine("next("+r+(n?","+n:"")+");"),i&&this.popBufferId()});var c=this.tmpid();this.emitLine("}, "+this.makeCallback(c)),this.addScopeLevel(),i&&this.emitLine(this.buffer+" += "+c+";"),e.else_&&(this.emitLine("if (!"+o+".length) {"),this.compile(e.else_,t),this.emitLine("}")),this.emitLine("frame = frame.pop();")},compileAsyncEach:function(e,t){this._compileAsyncLoop(e,t)},compileAsyncAll:function(e,t){this._compileAsyncLoop(e,t,!0)},_compileMacro:function(e,t){var i=[],r=null,a="macro_"+this.tmpid(),o=void 0!==t;n.each(e.args.children,function(t,n){n===e.args.children.length-1&&t instanceof s.Dict?r=t:(this.assertType(t,s.Symbol),i.push(t))},this);var u=n.map(i,function(e){return"l_"+e.value});u.push("kwargs");var c=n.map(i,function(e){return'"'+e.value+'"'}),h=n.map(r&&r.children||[],function(e){return'"'+e.key.value+'"'});t=o?t.push(!0):new l,this.emitLines("var "+a+" = runtime.makeMacro(","["+c.join(", ")+"], ","["+h.join(", ")+"], ","function ("+u.join(", ")+") {","var callerFrame = frame;","frame = "+(o?"frame.push(true);":"new runtime.Frame();"),"kwargs = kwargs || {};",'if (kwargs.hasOwnProperty("caller")) {','frame.set("caller", kwargs.caller); }'),n.each(i,function(e){this.emitLine('frame.set("'+e.value+'", l_'+e.value+");"),t.set(e.value,"l_"+e.value)},this),r&&n.each(r.children,function(e){var i=e.key.value;this.emit('frame.set("'+i+'", kwargs.hasOwnProperty("'+i+'") ? kwargs["'+i+'"] : '),this._compileExpression(e.value,t),this.emitLine(");")},this);var d=this.tmpid();return this.pushBufferId(d),this.withScopedSyntax(function(){this.compile(e.body,t)}),this.emitLine("frame = "+(o?"frame.pop();":"callerFrame;")),this.emitLine("return new runtime.SafeString("+d+");"),this.emitLine("});"),this.popBufferId(),a},compileMacro:function(e,t){var i=this._compileMacro(e),r=e.name.value;t.set(r,i),t.parent?this.emitLine('frame.set("'+r+'", '+i+");"):("_"!==e.name.value.charAt(0)&&this.emitLine('context.addExport("'+r+'");'),this.emitLine('context.setVariable("'+r+'", '+i+");"))},compileCaller:function(e,t){this.emit("(function (){");var i=this._compileMacro(e,t);this.emit("return "+i+";})()")},compileImport:function(e,t){var i=this.tmpid(),r=e.target.value;this.emit("env.getTemplate("),this._compileExpression(e.template,t),this.emitLine(", false, "+this._templateName()+", false, "+this.makeCallback(i)),this.addScopeLevel(),this.emitLine(i+".getExported("+(e.withContext?"context.getVariables(), frame, ":"")+this.makeCallback(i)),this.addScopeLevel(),t.set(r,i),t.parent?this.emitLine('frame.set("'+r+'", '+i+");"):this.emitLine('context.setVariable("'+r+'", '+i+");")},compileFromImport:function(e,t){var i=this.tmpid();this.emit("env.getTemplate("),this._compileExpression(e.template,t),this.emitLine(", false, "+this._templateName()+", false, "+this.makeCallback(i)),this.addScopeLevel(),this.emitLine(i+".getExported("+(e.withContext?"context.getVariables(), frame, ":"")+this.makeCallback(i)),this.addScopeLevel(),n.each(e.names.children,function(e){var r,n,a=this.tmpid();e instanceof s.Pair?(r=e.key.value,n=e.value.value):(r=e.value,n=r),this.emitLine("if("+i+'.hasOwnProperty("'+r+'")) {'),this.emitLine("var "+a+" = "+i+"."+r+";"),this.emitLine("} else {"),this.emitLine("cb(new Error(\"cannot import '"+r+"'\")); return;"),this.emitLine("}"),t.set(n,a),t.parent?this.emitLine('frame.set("'+n+'", '+a+");"):this.emitLine('context.setVariable("'+n+'", '+a+");")},this)},compileBlock:function(e){var t=this.tmpid();this.inBlock||this.emit('(parentTemplate ? function(e, c, f, r, cb) { cb(""); } : '),this.emit('context.getBlock("'+e.name.value+'")'),this.inBlock||this.emit(")"),this.emitLine("(env, context, frame, runtime, "+this.makeCallback(t)),this.emitLine(this.buffer+" += "+t+";"),this.addScopeLevel()},compileSuper:function(e,t){var i=e.blockName.value,r=e.symbol.value;this.emitLine('context.getSuper(env, "'+i+'", b_'+i+", frame, runtime, "+this.makeCallback(r)),this.emitLine(r+" = runtime.markSafe("+r+");"),this.addScopeLevel(),t.set(r,r)},compileExtends:function(e,t){var i=this.tmpid();this.emit("env.getTemplate("),this._compileExpression(e.template,t),this.emitLine(", true, "+this._templateName()+", false, "+this.makeCallback("_parentTemplate")),this.emitLine("parentTemplate = _parentTemplate"),this.emitLine("for(var "+i+" in parentTemplate.blocks) {"),this.emitLine("context.addBlock("+i+", parentTemplate.blocks["+i+"]);"),this.emitLine("}"),this.addScopeLevel()},compileInclude:function(e,t){var i=this.tmpid(),r=this.tmpid();this.emitLine("var tasks = [];"),this.emitLine("tasks.push("),this.emitLine("function(callback) {"),this.emit("env.getTemplate("),this._compileExpression(e.template,t),this.emitLine(", false, "+this._templateName()+", "+e.ignoreMissing+", "+this.makeCallback(i)),this.emitLine("callback(null,"+i+");});"),this.emitLine("});"),this.emitLine("tasks.push("),this.emitLine("function(template, callback){"),this.emitLine("template.render(context.getVariables(), frame, "+this.makeCallback(r)),this.emitLine("callback(null,"+r+");});"),this.emitLine("});"),this.emitLine("tasks.push("),this.emitLine("function(result, callback){"),this.emitLine(this.buffer+" += result;"),this.emitLine("callback(null);"),this.emitLine("});"),this.emitLine("env.waterfall(tasks, function(){"),this.addScopeLevel()},compileTemplateData:function(e,t){this.compileLiteral(e,t)},compileCapture:function(e,t){var i=this.buffer;this.buffer="output",this.emitLine("(function() {"),this.emitLine('var output = "";'),this.withScopedSyntax(function(){this.compile(e.body,t)}),this.emitLine("return output;"),this.emitLine("})()"),this.buffer=i},compileOutput:function(e,t){for(var i=e.children,r=0,n=i.length;r<n;r++)i[r]instanceof s.TemplateData?i[r].value&&(this.emit(this.buffer+" += "),this.compileLiteral(i[r],t),this.emitLine(";")):(this.emit(this.buffer+" += runtime.suppressValue("),this.throwOnUndefined&&this.emit("runtime.ensureDefined("),this.compile(i[r],t),this.throwOnUndefined&&this.emit(","+e.lineno+","+e.colno+")"),this.emit(", env.opts.autoescape);\n"))},compileRoot:function(e,t){t&&this.fail("compileRoot: root node can't have frame"),t=new l,this.emitFuncBegin("root"),this.emitLine("var parentTemplate = null;"),this._compileChildren(e,t),this.emitLine("if(parentTemplate) {"),this.emitLine("parentTemplate.rootRenderFunc(env, context, frame, runtime, cb);"),this.emitLine("} else {"),this.emitLine("cb(null, "+this.buffer+");"),this.emitLine("}"),this.emitFuncEnd(!0),this.inBlock=!0;var i,r,n,a=[],o=e.findAll(s.Block);for(i=0;i<o.length;i++){if(n=o[i],r=n.name.value,-1!==a.indexOf(r))throw new Error('Block "'+r+'" defined more than once.');a.push(r),this.emitFuncBegin("b_"+r);var u=new l;this.emitLine("var frame = frame.push(true);"),this.compile(n.body,u),this.emitFuncEnd()}for(this.emitLine("return {"),i=0;i<o.length;i++)n=o[i],r="b_"+n.name.value,this.emitLine(r+": "+r+",");this.emitLine("root: root\n};")},compile:function(e,t){var i=this["compile"+e.typename];i?i.call(this,e,t):this.fail("compile: Cannot compile node: "+e.typename,e.lineno,e.colno)},getCode:function(){return this.codebuf.join("")}});e.exports={compile:function(e,t,i,r,n){var s=new h(r,n.throwOnUndefined);if(i&&i.length)for(var u=0;u<i.length;u++)"preprocess"in i[u]&&(e=i[u].preprocess(e,r));return s.compile(o.transform(a.parse(e,i,n),t,r)),s.getCode()},Compiler:h}},function(e,t,i){"use strict";var r=i(9),n=i(10),a=i(6),o=i(1),s=a.extend({init:function(e){this.tokens=e,this.peeked=null,this.breakOnBlocks=null,this.dropLeadingWhitespace=!1,this.extensions=[]},nextToken:function(e){var t;if(this.peeked){if(e||this.peeked.type!==r.TOKEN_WHITESPACE)return t=this.peeked,this.peeked=null,t;this.peeked=null}if(t=this.tokens.nextToken(),!e)for(;t&&t.type===r.TOKEN_WHITESPACE;)t=this.tokens.nextToken();return t},peekToken:function(){return this.peeked=this.peeked||this.nextToken(),this.peeked},pushToken:function(e){if(this.peeked)throw new Error("pushToken: can only push one token on between reads");this.peeked=e},fail:function(e,t,i){if((void 0===t||void 0===i)&&this.peekToken()){var r=this.peekToken();t=r.lineno,i=r.colno}throw void 0!==t&&(t+=1),void 0!==i&&(i+=1),new o.TemplateError(e,t,i)},skip:function(e){var t=this.nextToken();return!(!t||t.type!==e)||(this.pushToken(t),!1)},expect:function(e){var t=this.nextToken();return t.type!==e&&this.fail("expected "+e+", got "+t.type,t.lineno,t.colno),t},skipValue:function(e,t){var i=this.nextToken();return!(!i||i.type!==e||i.value!==t)||(this.pushToken(i),!1)},skipSymbol:function(e){return this.skipValue(r.TOKEN_SYMBOL,e)},advanceAfterBlockEnd:function(e){var t;return e||(t=this.peekToken(),t||this.fail("unexpected end of file"),t.type!==r.TOKEN_SYMBOL&&this.fail("advanceAfterBlockEnd: expected symbol token or explicit name to be passed"),e=this.nextToken().value),t=this.nextToken(),t&&t.type===r.TOKEN_BLOCK_END?"-"===t.value.charAt(0)&&(this.dropLeadingWhitespace=!0):this.fail("expected block end in "+e+" statement"),t},advanceAfterVariableEnd:function(){var e=this.nextToken();e&&e.type===r.TOKEN_VARIABLE_END?this.dropLeadingWhitespace="-"===e.value.charAt(e.value.length-this.tokens.tags.VARIABLE_END.length-1):(this.pushToken(e),this.fail("expected variable end"))},parseFor:function(){var e,t,i=this.peekToken();if(this.skipSymbol("for")?(e=new n.For(i.lineno,i.colno),t="endfor"):this.skipSymbol("asyncEach")?(e=new n.AsyncEach(i.lineno,i.colno),t="endeach"):this.skipSymbol("asyncAll")?(e=new n.AsyncAll(i.lineno,i.colno),t="endall"):this.fail("parseFor: expected for{Async}",i.lineno,i.colno),e.name=this.parsePrimary(),e.name instanceof n.Symbol||this.fail("parseFor: variable name expected for loop"),this.peekToken().type===r.TOKEN_COMMA){var a=e.name;for(e.name=new n.Array(a.lineno,a.colno),e.name.addChild(a);this.skip(r.TOKEN_COMMA);){var o=this.parsePrimary();e.name.addChild(o)}}return this.skipSymbol("in")||this.fail('parseFor: expected "in" keyword for loop',i.lineno,i.colno),e.arr=this.parseExpression(),this.advanceAfterBlockEnd(i.value),e.body=this.parseUntilBlocks(t,"else"),this.skipSymbol("else")&&(this.advanceAfterBlockEnd("else"),e.else_=this.parseUntilBlocks(t)),this.advanceAfterBlockEnd(),e},parseMacro:function(){var e=this.peekToken();this.skipSymbol("macro")||this.fail("expected macro");var t=this.parsePrimary(!0),i=this.parseSignature(),r=new n.Macro(e.lineno,e.colno,t,i);return this.advanceAfterBlockEnd(e.value),r.body=this.parseUntilBlocks("endmacro"),this.advanceAfterBlockEnd(),r},parseCall:function(){var e=this.peekToken();this.skipSymbol("call")||this.fail("expected call");var t=this.parseSignature(!0)||new n.NodeList,i=this.parsePrimary();this.advanceAfterBlockEnd(e.value);var r=this.parseUntilBlocks("endcall");this.advanceAfterBlockEnd();var a=new n.Symbol(e.lineno,e.colno,"caller"),o=new n.Caller(e.lineno,e.colno,a,t,r),s=i.args.children;return s[s.length-1]instanceof n.KeywordArgs||s.push(new n.KeywordArgs),s[s.length-1].addChild(new n.Pair(e.lineno,e.colno,a,o)),new n.Output(e.lineno,e.colno,[i])},parseWithContext:function(){var e=this.peekToken(),t=null;return this.skipSymbol("with")?t=!0:this.skipSymbol("without")&&(t=!1),null!==t&&(this.skipSymbol("context")||this.fail("parseFrom: expected context after with/without",e.lineno,e.colno)),t},parseImport:function(){var e=this.peekToken();this.skipSymbol("import")||this.fail("parseImport: expected import",e.lineno,e.colno);var t=this.parseExpression();this.skipSymbol("as")||this.fail('parseImport: expected "as" keyword',e.lineno,e.colno);var i=this.parseExpression(),r=this.parseWithContext(),a=new n.Import(e.lineno,e.colno,t,i,r);return this.advanceAfterBlockEnd(e.value),a},parseFrom:function(){var e=this.peekToken();this.skipSymbol("from")||this.fail("parseFrom: expected from");var t=this.parseExpression();this.skipSymbol("import")||this.fail("parseFrom: expected import",e.lineno,e.colno);for(var i,a=new n.NodeList;;){var o=this.peekToken();if(o.type===r.TOKEN_BLOCK_END){a.children.length||this.fail("parseFrom: Expected at least one import name",e.lineno,e.colno),"-"===o.value.charAt(0)&&(this.dropLeadingWhitespace=!0),this.nextToken();break}a.children.length>0&&!this.skip(r.TOKEN_COMMA)&&this.fail("parseFrom: expected comma",e.lineno,e.colno);var s=this.parsePrimary();if("_"===s.value.charAt(0)&&this.fail("parseFrom: names starting with an underscore cannot be imported",s.lineno,s.colno),this.skipSymbol("as")){var u=this.parsePrimary();a.addChild(new n.Pair(s.lineno,s.colno,s,u))}else a.addChild(s);i=this.parseWithContext()}return new n.FromImport(e.lineno,e.colno,t,a,i)},parseBlock:function(){var e=this.peekToken();this.skipSymbol("block")||this.fail("parseBlock: expected block",e.lineno,e.colno);var t=new n.Block(e.lineno,e.colno);t.name=this.parsePrimary(),t.name instanceof n.Symbol||this.fail("parseBlock: variable name expected",e.lineno,e.colno),this.advanceAfterBlockEnd(e.value),t.body=this.parseUntilBlocks("endblock"),this.skipSymbol("endblock"),this.skipSymbol(t.name.value);var i=this.peekToken();return i||this.fail("parseBlock: expected endblock, got end of file"),this.advanceAfterBlockEnd(i.value),t},parseExtends:function(){var e=this.peekToken();this.skipSymbol("extends")||this.fail("parseTemplateRef: expected extends");var t=new n.Extends(e.lineno,e.colno);return t.template=this.parseExpression(),this.advanceAfterBlockEnd(e.value),t},parseInclude:function(){var e=this.peekToken();this.skipSymbol("include")||this.fail("parseInclude: expected include");var t=new n.Include(e.lineno,e.colno);return t.template=this.parseExpression(),this.skipSymbol("ignore")&&this.skipSymbol("missing")&&(t.ignoreMissing=!0),this.advanceAfterBlockEnd(e.value),t},parseIf:function(){var e,t=this.peekToken();this.skipSymbol("if")||this.skipSymbol("elif")||this.skipSymbol("elseif")?e=new n.If(t.lineno,t.colno):this.skipSymbol("ifAsync")?e=new n.IfAsync(t.lineno,t.colno):this.fail("parseIf: expected if, elif, or elseif",t.lineno,t.colno),e.cond=this.parseExpression(),this.advanceAfterBlockEnd(t.value),e.body=this.parseUntilBlocks("elif","elseif","else","endif");var i=this.peekToken();switch(i&&i.value){case"elseif":case"elif":e.else_=this.parseIf();break;case"else":this.advanceAfterBlockEnd(),e.else_=this.parseUntilBlocks("endif"),this.advanceAfterBlockEnd();break;case"endif":e.else_=null,this.advanceAfterBlockEnd();break;default:this.fail("parseIf: expected elif, else, or endif, got end of file")}return e},parseSet:function(){var e=this.peekToken();this.skipSymbol("set")||this.fail("parseSet: expected set",e.lineno,e.colno);for(var t,i=new n.Set(e.lineno,e.colno,[]);(t=this.parsePrimary())&&(i.targets.push(t),this.skip(r.TOKEN_COMMA)););return this.skipValue(r.TOKEN_OPERATOR,"=")?(i.value=this.parseExpression(),this.advanceAfterBlockEnd(e.value)):this.skip(r.TOKEN_BLOCK_END)?(i.body=new n.Capture(e.lineno,e.colno,this.parseUntilBlocks("endset")),i.value=null,this.advanceAfterBlockEnd()):this.fail("parseSet: expected = or block end in set tag",e.lineno,e.colno),i},parseStatement:function(){var e=this.peekToken();if(e.type!==r.TOKEN_SYMBOL&&this.fail("tag name expected",e.lineno,e.colno),this.breakOnBlocks&&-1!==o.indexOf(this.breakOnBlocks,e.value))return null;switch(e.value){case"raw":return this.parseRaw();case"verbatim":return this.parseRaw("verbatim");case"if":case"ifAsync":return this.parseIf();case"for":case"asyncEach":case"asyncAll":return this.parseFor();case"block":return this.parseBlock();case"extends":return this.parseExtends();case"include":return this.parseInclude();case"set":return this.parseSet();case"macro":return this.parseMacro();case"call":return this.parseCall();case"import":return this.parseImport();case"from":return this.parseFrom();case"filter":return this.parseFilterStatement();default:if(this.extensions.length)for(var t=0;t<this.extensions.length;t++){var i=this.extensions[t];if(-1!==o.indexOf(i.tags||[],e.value))return i.parse(this,n,r)}this.fail("unknown block tag: "+e.value,e.lineno,e.colno)}},parseRaw:function(e){e=e||"raw";for(var t="end"+e,i=new RegExp("([\\s\\S]*?){%\\s*("+e+"|"+t+")\\s*(?=%})%}"),r=1,a="",o=null,s=this.advanceAfterBlockEnd();(o=this.tokens._extractRegex(i))&&r>0;){var u=o[0],l=o[1],c=o[2];c===e?r+=1:c===t&&(r-=1),0===r?(a+=l,this.tokens.backN(u.length-l.length)):a+=u}return new n.Output(s.lineno,s.colno,[new n.TemplateData(s.lineno,s.colno,a)])},parsePostfix:function(e){for(var t,i=this.peekToken();i;){if(i.type===r.TOKEN_LEFT_PAREN)e=new n.FunCall(i.lineno,i.colno,e,this.parseSignature());else if(i.type===r.TOKEN_LEFT_BRACKET)t=this.parseAggregate(),t.children.length>1&&this.fail("invalid index"),e=new n.LookupVal(i.lineno,i.colno,e,t.children[0]);else{if(i.type!==r.TOKEN_OPERATOR||"."!==i.value)break;this.nextToken();var a=this.nextToken();a.type!==r.TOKEN_SYMBOL&&this.fail("expected name as lookup value, got "+a.value,a.lineno,a.colno),t=new n.Literal(a.lineno,a.colno,a.value),e=new n.LookupVal(i.lineno,i.colno,e,t)}i=this.peekToken()}return e},parseExpression:function(){return this.parseInlineIf()},parseInlineIf:function(){var e=this.parseOr();if(this.skipSymbol("if")){var t=this.parseOr(),i=e;e=new n.InlineIf(e.lineno,e.colno),e.body=i,e.cond=t,this.skipSymbol("else")?e.else_=this.parseOr():e.else_=null}return e},parseOr:function(){for(var e=this.parseAnd();this.skipSymbol("or");){var t=this.parseAnd();e=new n.Or(e.lineno,e.colno,e,t)}return e},parseAnd:function(){for(var e=this.parseNot();this.skipSymbol("and");){var t=this.parseNot();e=new n.And(e.lineno,e.colno,e,t)}return e},parseNot:function(){var e=this.peekToken();return this.skipSymbol("not")?new n.Not(e.lineno,e.colno,this.parseNot()):this.parseIn()},parseIn:function(){for(var e=this.parseCompare();;){var t=this.nextToken();if(!t)break;var i=t.type===r.TOKEN_SYMBOL&&"not"===t.value;if(i||this.pushToken(t),!this.skipSymbol("in")){i&&this.pushToken(t);break}var a=this.parseCompare();e=new n.In(e.lineno,e.colno,e,a),i&&(e=new n.Not(e.lineno,e.colno,e))}return e},parseCompare:function(){for(var e=["==","===","!=","!==","<",">","<=",">="],t=this.parseConcat(),i=[];;){var r=this.nextToken();if(!r)break;if(-1===o.indexOf(e,r.value)){this.pushToken(r);break}i.push(new n.CompareOperand(r.lineno,r.colno,this.parseConcat(),r.value))}return i.length?new n.Compare(i[0].lineno,i[0].colno,t,i):t},parseConcat:function(){for(var e=this.parseAdd();this.skipValue(r.TOKEN_TILDE,"~");){var t=this.parseAdd();e=new n.Concat(e.lineno,e.colno,e,t)}return e},parseAdd:function(){for(var e=this.parseSub();this.skipValue(r.TOKEN_OPERATOR,"+");){var t=this.parseSub();e=new n.Add(e.lineno,e.colno,e,t)}return e},parseSub:function(){for(var e=this.parseMul();this.skipValue(r.TOKEN_OPERATOR,"-");){var t=this.parseMul();e=new n.Sub(e.lineno,e.colno,e,t)}return e},parseMul:function(){for(var e=this.parseDiv();this.skipValue(r.TOKEN_OPERATOR,"*");){var t=this.parseDiv();e=new n.Mul(e.lineno,e.colno,e,t)}return e},parseDiv:function(){for(var e=this.parseFloorDiv();this.skipValue(r.TOKEN_OPERATOR,"/");){var t=this.parseFloorDiv();e=new n.Div(e.lineno,e.colno,e,t)}return e},parseFloorDiv:function(){for(var e=this.parseMod();this.skipValue(r.TOKEN_OPERATOR,"//");){var t=this.parseMod();e=new n.FloorDiv(e.lineno,e.colno,e,t)}return e},parseMod:function(){for(var e=this.parsePow();this.skipValue(r.TOKEN_OPERATOR,"%");){var t=this.parsePow();e=new n.Mod(e.lineno,e.colno,e,t)}return e},parsePow:function(){for(var e=this.parseUnary();this.skipValue(r.TOKEN_OPERATOR,"**");){var t=this.parseUnary();e=new n.Pow(e.lineno,e.colno,e,t)}return e},parseUnary:function(e){var t,i=this.peekToken();return t=this.skipValue(r.TOKEN_OPERATOR,"-")?new n.Neg(i.lineno,i.colno,this.parseUnary(!0)):this.skipValue(r.TOKEN_OPERATOR,"+")?new n.Pos(i.lineno,i.colno,this.parseUnary(!0)):this.parsePrimary(),e||(t=this.parseFilter(t)),t},parsePrimary:function(e){var t,i=this.nextToken(),a=null;if(i?i.type===r.TOKEN_STRING?t=i.value:i.type===r.TOKEN_INT?t=parseInt(i.value,10):i.type===r.TOKEN_FLOAT?t=parseFloat(i.value):i.type===r.TOKEN_BOOLEAN?"true"===i.value?t=!0:"false"===i.value?t=!1:this.fail("invalid boolean: "+i.value,i.lineno,i.colno):i.type===r.TOKEN_NONE?t=null:i.type===r.TOKEN_REGEX&&(t=new RegExp(i.value.body,i.value.flags)):this.fail("expected expression, got end of file"),void 0!==t?a=new n.Literal(i.lineno,i.colno,t):i.type===r.TOKEN_SYMBOL?a=new n.Symbol(i.lineno,i.colno,i.value):(this.pushToken(i),a=this.parseAggregate()),e||(a=this.parsePostfix(a)),a)return a;this.fail("unexpected token: "+i.value,i.lineno,i.colno)},parseFilterName:function(){for(var e=this.expect(r.TOKEN_SYMBOL),t=e.value;this.skipValue(r.TOKEN_OPERATOR,".");)t+="."+this.expect(r.TOKEN_SYMBOL).value;return new n.Symbol(e.lineno,e.colno,t)},parseFilterArgs:function(e){if(this.peekToken().type===r.TOKEN_LEFT_PAREN){return this.parsePostfix(e).args.children}return[]},parseFilter:function(e){for(;this.skip(r.TOKEN_PIPE);){var t=this.parseFilterName();e=new n.Filter(t.lineno,t.colno,t,new n.NodeList(t.lineno,t.colno,[e].concat(this.parseFilterArgs(e))))}return e},parseFilterStatement:function(){var e=this.peekToken();this.skipSymbol("filter")||this.fail("parseFilterStatement: expected filter");var t=this.parseFilterName(),i=this.parseFilterArgs(t);this.advanceAfterBlockEnd(e.value);var r=new n.Capture(t.lineno,t.colno,this.parseUntilBlocks("endfilter"));this.advanceAfterBlockEnd();var a=new n.Filter(t.lineno,t.colno,t,new n.NodeList(t.lineno,t.colno,[r].concat(i)));return new n.Output(t.lineno,t.colno,[a])},parseAggregate:function(){var e,t=this.nextToken();switch(t.type){case r.TOKEN_LEFT_PAREN:e=new n.Group(t.lineno,t.colno);break;case r.TOKEN_LEFT_BRACKET:e=new n.Array(t.lineno,t.colno);break;case r.TOKEN_LEFT_CURLY:e=new n.Dict(t.lineno,t.colno);break;default:return null}for(;;){var i=this.peekToken().type;if(i===r.TOKEN_RIGHT_PAREN||i===r.TOKEN_RIGHT_BRACKET||i===r.TOKEN_RIGHT_CURLY){this.nextToken();break}if(e.children.length>0&&(this.skip(r.TOKEN_COMMA)||this.fail("parseAggregate: expected comma after expression",t.lineno,t.colno)),e instanceof n.Dict){var a=this.parsePrimary();this.skip(r.TOKEN_COLON)||this.fail("parseAggregate: expected colon after dict key",t.lineno,t.colno);var o=this.parseExpression();e.addChild(new n.Pair(a.lineno,a.colno,a,o))}else{var s=this.parseExpression();e.addChild(s)}}return e},parseSignature:function(e,t){var i=this.peekToken();if(!t&&i.type!==r.TOKEN_LEFT_PAREN){if(e)return null;this.fail("expected arguments",i.lineno,i.colno)}i.type===r.TOKEN_LEFT_PAREN&&(i=this.nextToken());for(var a=new n.NodeList(i.lineno,i.colno),o=new n.KeywordArgs(i.lineno,i.colno),s=!1;;){if(i=this.peekToken(),!t&&i.type===r.TOKEN_RIGHT_PAREN){this.nextToken();break}if(t&&i.type===r.TOKEN_BLOCK_END)break;if(s&&!this.skip(r.TOKEN_COMMA))this.fail("parseSignature: expected comma after expression",i.lineno,i.colno);else{var u=this.parseExpression();this.skipValue(r.TOKEN_OPERATOR,"=")?o.addChild(new n.Pair(u.lineno,u.colno,u,this.parseExpression())):a.addChild(u)}s=!0}return o.children.length&&a.addChild(o),a},parseUntilBlocks:function(){var e=this.breakOnBlocks;this.breakOnBlocks=o.toArray(arguments);var t=this.parse();return this.breakOnBlocks=e,t},parseNodes:function(){for(var e,t=[];e=this.nextToken();)if(e.type===r.TOKEN_DATA){var i=e.value,a=this.peekToken(),o=a&&a.value;this.dropLeadingWhitespace&&(i=i.replace(/^\s*/,""),this.dropLeadingWhitespace=!1),a&&(a.type===r.TOKEN_BLOCK_START&&"-"===o.charAt(o.length-1)||a.type===r.TOKEN_VARIABLE_START&&"-"===o.charAt(this.tokens.tags.VARIABLE_START.length)||a.type===r.TOKEN_COMMENT&&"-"===o.charAt(this.tokens.tags.COMMENT_START.length))&&(i=i.replace(/\s*$/,"")),t.push(new n.Output(e.lineno,e.colno,[new n.TemplateData(e.lineno,e.colno,i)]))}else if(e.type===r.TOKEN_BLOCK_START){this.dropLeadingWhitespace=!1;var s=this.parseStatement();if(!s)break;t.push(s)}else if(e.type===r.TOKEN_VARIABLE_START){var u=this.parseExpression();this.dropLeadingWhitespace=!1,this.advanceAfterVariableEnd(),t.push(new n.Output(e.lineno,e.colno,[u]))}else e.type===r.TOKEN_COMMENT?this.dropLeadingWhitespace="-"===e.value.charAt(e.value.length-this.tokens.tags.COMMENT_END.length-1):this.fail("Unexpected token at top-level: "+e.type,e.lineno,e.colno);return t},parse:function(){return new n.NodeList(0,0,this.parseNodes())},parseAsRoot:function(){return new n.Root(0,0,this.parseNodes())}});e.exports={parse:function(e,t,i){var n=new s(r.lex(e,i));return void 0!==t&&(n.extensions=t),n.parseAsRoot()},Parser:s}},function(e,t,i){"use strict";function r(e,t,i,r){return{type:e,value:t,lineno:i,colno:r}}function n(e,t){this.str=e,this.index=0,this.len=e.length,this.lineno=0,this.colno=0,this.in_code=!1,t=t||{};var i=t.tags||{};this.tags={BLOCK_START:i.blockStart||s,BLOCK_END:i.blockEnd||u,VARIABLE_START:i.variableStart||l,VARIABLE_END:i.variableEnd||c,COMMENT_START:i.commentStart||h,COMMENT_END:i.commentEnd||d},this.trimBlocks=!!t.trimBlocks,this.lstripBlocks=!!t.lstripBlocks}var a=i(1),o="()[]{}%*-+~/#,:|.<>=!",s="{%",u="%}",l="{{",c="}}",h="{#",d="#}";n.prototype.nextToken=function(){var e,t=this.lineno,i=this.colno;if(this.in_code){var n=this.current();if(this.is_finished())return null;if('"'===n||"'"===n)return r("string",this.parseString(n),t,i);if(e=this._extract(" \n\t\r "))return r("whitespace",e,t,i);if((e=this._extractString(this.tags.BLOCK_END))||(e=this._extractString("-"+this.tags.BLOCK_END)))return this.in_code=!1,this.trimBlocks&&(n=this.current(),"\n"===n?this.forward():"\r"===n&&(this.forward(),n=this.current(),"\n"===n?this.forward():this.back())),r("block-end",e,t,i);if((e=this._extractString(this.tags.VARIABLE_END))||(e=this._extractString("-"+this.tags.VARIABLE_END)))return this.in_code=!1,r("variable-end",e,t,i);if("r"===n&&"/"===this.str.charAt(this.index+1)){this.forwardN(2);for(var s="";!this.is_finished();){if("/"===this.current()&&"\\"!==this.previous()){this.forward();break}s+=this.current(),this.forward()}for(var u=["g","i","m","y"],l="";!this.is_finished();){if(!(-1!==u.indexOf(this.current())))break;l+=this.current(),this.forward()}return r("regex",{body:s,flags:l},t,i)}if(-1!==o.indexOf(n)){this.forward();var c,h=["==","===","!=","!==","<=",">=","//","**"],d=n+this.current();switch(-1!==a.indexOf(h,d)&&(this.forward(),n=d,-1!==a.indexOf(h,d+this.current())&&(n=d+this.current(),this.forward())),n){case"(":c="left-paren";break;case")":c="right-paren";break;case"[":c="left-bracket";break;case"]":c="right-bracket";break;case"{":c="left-curly";break;case"}":c="right-curly";break;case",":c="comma";break;case":":c="colon";break;case"~":c="tilde";break;case"|":c="pipe";break;default:c="operator"}return r(c,n,t,i)}if(e=this._extractUntil(" \n\t\r "+o),e.match(/^[-+]?[0-9]+$/)){if("."===this.current()){this.forward();return r("float",e+"."+this._extract("0123456789"),t,i)}return r("int",e,t,i)}if(e.match(/^(true|false)$/))return r("boolean",e,t,i);if("none"===e)return r("none",e,t,i);if(e)return r("symbol",e,t,i);throw new Error("Unexpected value while parsing: "+e)}var p=this.tags.BLOCK_START.charAt(0)+this.tags.VARIABLE_START.charAt(0)+this.tags.COMMENT_START.charAt(0)+this.tags.COMMENT_END.charAt(0);if(this.is_finished())return null;if((e=this._extractString(this.tags.BLOCK_START+"-"))||(e=this._extractString(this.tags.BLOCK_START)))return this.in_code=!0,r("block-start",e,t,i);if((e=this._extractString(this.tags.VARIABLE_START+"-"))||(e=this._extractString(this.tags.VARIABLE_START)))return this.in_code=!0,r("variable-start",e,t,i);e="";var f,g=!1;for(this._matches(this.tags.COMMENT_START)&&(g=!0,e=this._extractString(this.tags.COMMENT_START));null!==(f=this._extractUntil(p));){if(e+=f,(this._matches(this.tags.BLOCK_START)||this._matches(this.tags.VARIABLE_START)||this._matches(this.tags.COMMENT_START))&&!g){if(this.lstripBlocks&&this._matches(this.tags.BLOCK_START)&&this.colno>0&&this.colno<=e.length){if(/^\s+$/.test(e.slice(-this.colno))&&(e=e.slice(0,-this.colno),!e.length))return this.nextToken()}break}if(this._matches(this.tags.COMMENT_END)){if(!g)throw new Error("unexpected end of comment");e+=this._extractString(this.tags.COMMENT_END);break}e+=this.current(),this.forward()}if(null===f&&g)throw new Error("expected end of comment, got end of file");return r(g?"comment":"data",e,t,i)},n.prototype.parseString=function(e){this.forward();for(var t="";!this.is_finished()&&this.current()!==e;){var i=this.current();if("\\"===i){switch(this.forward(),this.current()){case"n":t+="\n";break;case"t":t+="\t";break;case"r":t+="\r";break;default:t+=this.current()}this.forward()}else t+=i,this.forward()}return this.forward(),t},n.prototype._matches=function(e){return this.index+e.length>this.len?null:this.str.slice(this.index,this.index+e.length)===e},n.prototype._extractString=function(e){return this._matches(e)?(this.index+=e.length,e):null},n.prototype._extractUntil=function(e){return this._extractMatching(!0,e||"")},n.prototype._extract=function(e){return this._extractMatching(!1,e)},n.prototype._extractMatching=function(e,t){if(this.is_finished())return null;var i=t.indexOf(this.current());if(e&&-1===i||!e&&-1!==i){var r=this.current();this.forward();for(var n=t.indexOf(this.current());(e&&-1===n||!e&&-1!==n)&&!this.is_finished();)r+=this.current(),this.forward(),n=t.indexOf(this.current());return r}return""},n.prototype._extractRegex=function(e){var t=this.currentStr().match(e);return t?(this.forwardN(t[0].length),t):null},n.prototype.is_finished=function(){return this.index>=this.len},n.prototype.forwardN=function(e){for(var t=0;t<e;t++)this.forward()},n.prototype.forward=function(){this.index++,"\n"===this.previous()?(this.lineno++,this.colno=0):this.colno++},n.prototype.backN=function(e){for(var t=0;t<e;t++)this.back()},n.prototype.back=function(){if(this.index--,"\n"===this.current()){this.lineno--;var e=this.src.lastIndexOf("\n",this.index-1);this.colno=-1===e?this.index:this.index-e}else this.colno--},n.prototype.current=function(){return this.is_finished()?"":this.str.charAt(this.index)},n.prototype.currentStr=function(){return this.is_finished()?"":this.str.substr(this.index)},n.prototype.previous=function(){return this.str.charAt(this.index-1)},e.exports={lex:function(e,t){return new n(e,t)},TOKEN_STRING:"string",TOKEN_WHITESPACE:"whitespace",TOKEN_DATA:"data",TOKEN_BLOCK_START:"block-start",TOKEN_BLOCK_END:"block-end",TOKEN_VARIABLE_START:"variable-start",TOKEN_VARIABLE_END:"variable-end",TOKEN_COMMENT:"comment",TOKEN_LEFT_PAREN:"left-paren",TOKEN_RIGHT_PAREN:"right-paren",TOKEN_LEFT_BRACKET:"left-bracket",TOKEN_RIGHT_BRACKET:"right-bracket",TOKEN_LEFT_CURLY:"left-curly",TOKEN_RIGHT_CURLY:"right-curly",TOKEN_OPERATOR:"operator",TOKEN_COMMA:"comma",TOKEN_COLON:"colon",TOKEN_TILDE:"tilde",TOKEN_PIPE:"pipe",TOKEN_INT:"int",TOKEN_FLOAT:"float",TOKEN_BOOLEAN:"boolean",TOKEN_NONE:"none",TOKEN_SYMBOL:"symbol",TOKEN_SPECIAL:"special",TOKEN_REGEX:"regex"}},function(e,t,i){(function(t){"use strict";function r(e,t,i){e instanceof t&&i.push(e),e instanceof s&&e.findAll(t,i)}function n(e,i){function r(e,i,r){for(var n=e.split("\n"),a=0;a<n.length;a++){if(n[a]&&(r&&a>0||!r))for(var o=0;o<i;o++)t.stdout.write(" ");a===n.length-1?t.stdout.write(n[a]):t.stdout.write(n[a]+"\n")}}if(i=i||0,r(e.typename+": ",i),e instanceof l)r("\n"),a.each(e.children,function(e){n(e,i+2)});else if(e instanceof ae)r(e.extName+"."+e.prop),r("\n"),e.args&&n(e.args,i+2),e.contentArgs&&a.each(e.contentArgs,function(e){n(e,i+2)});else{var o=null,u=null;if(e.iterFields(function(e,t){e instanceof s?(o=o||{},o[t]=e):(u=u||{},u[t]=e)}),u?r(JSON.stringify(u,null,2)+"\n",null,!0):r("\n"),o)for(var c in o)n(o[c],i+2)}}var a=i(1),o=i(6),s=o.extend("Node",{init:function(e,t){this.lineno=e,this.colno=t;for(var i=this.fields,r=0,n=i.length;r<n;r++){var a=i[r],o=arguments[r+2];void 0===o&&(o=null),this[a]=o}},findAll:function(e,t){t=t||[];var i,n;if(this instanceof l){var a=this.children;for(i=0,n=a.length;i<n;i++)r(a[i],e,t)}else{var o=this.fields;for(i=0,n=o.length;i<n;i++)r(this[o[i]],e,t)}return t},iterFields:function(e){a.each(this.fields,function(t){e(this[t],t)},this)}}),u=s.extend("Value",{fields:["value"]}),l=s.extend("NodeList",{fields:["children"],init:function(e,t,i){this.parent(e,t,i||[])},addChild:function(e){this.children.push(e)}}),c=l.extend("Root"),h=u.extend("Literal"),d=u.extend("Symbol"),p=l.extend("Group"),f=l.extend("Array"),g=s.extend("Pair",{fields:["key","value"]}),m=l.extend("Dict"),v=s.extend("LookupVal",{fields:["target","val"]}),_=s.extend("If",{fields:["cond","body","else_"]}),b=_.extend("IfAsync"),x=s.extend("InlineIf",{fields:["cond","body","else_"]}),S=s.extend("For",{fields:["arr","name","body","else_"]}),y=S.extend("AsyncEach"),C=S.extend("AsyncAll"),T=s.extend("Macro",{fields:["name","args","body"]}),M=T.extend("Caller"),w=s.extend("Import",{fields:["template","target","withContext"]}),A=s.extend("FromImport",{fields:["template","names","withContext"],init:function(e,t,i,r,n){this.parent(e,t,i,r||new l,n)}}),E=s.extend("FunCall",{fields:["name","args"]}),P=E.extend("Filter"),N=P.extend("FilterAsync",{fields:["name","args","symbol"]}),F=m.extend("KeywordArgs"),R=s.extend("Block",{fields:["name","body"]}),I=s.extend("Super",{fields:["blockName","symbol"]}),O=s.extend("TemplateRef",{fields:["template"]}),L=O.extend("Extends"),D=s.extend("Include",{fields:["template","ignoreMissing"]}),k=s.extend("Set",{fields:["targets","value"]}),B=l.extend("Output"),V=s.extend("Capture",{fields:["body"]}),U=h.extend("TemplateData"),G=s.extend("UnaryOp",{fields:["target"]}),z=s.extend("BinOp",{fields:["left","right"]}),j=z.extend("In"),H=z.extend("Or"),W=z.extend("And"),q=G.extend("Not"),Y=z.extend("Add"),X=z.extend("Concat"),K=z.extend("Sub"),J=z.extend("Mul"),Q=z.extend("Div"),Z=z.extend("FloorDiv"),$=z.extend("Mod"),ee=z.extend("Pow"),te=G.extend("Neg"),ie=G.extend("Pos"),re=s.extend("Compare",{fields:["expr","ops"]}),ne=s.extend("CompareOperand",{fields:["expr","type"]}),ae=s.extend("CallExtension",{fields:["extName","prop","args","contentArgs"],init:function(e,t,i,r){this.extName=e._name||e,this.prop=t,this.args=i||new l,this.contentArgs=r||[],this.autoescape=e.autoescape}}),oe=ae.extend("CallExtensionAsync");e.exports={Node:s,Root:c,NodeList:l,Value:u,Literal:h,Symbol:d,Group:p,Array:f,Pair:g,Dict:m,Output:B,Capture:V,TemplateData:U,If:_,IfAsync:b,InlineIf:x,For:S,AsyncEach:y,AsyncAll:C,Macro:T,Caller:M,Import:w,FromImport:A,FunCall:E,Filter:P,FilterAsync:N,KeywordArgs:F,Block:R,Super:I,Extends:L,Include:D,Set:k,LookupVal:v,BinOp:z,In:j,Or:H,And:W,Not:q,Add:Y,Concat:X,Sub:K,Mul:J,Div:Q,FloorDiv:Z,Mod:$,Pow:ee,Neg:te,Pos:ie,Compare:re,CompareOperand:ne,CallExtension:ae,CallExtensionAsync:oe,printNodes:n}}).call(t,i(11))},function(e,t){},function(e,t,i){"use strict";function r(){return"hole_"+g++}function n(e,t){for(var i=null,r=0;r<e.length;r++){var n=t(e[r]);n!==e[r]&&(i||(i=e.slice()),i[r]=n)}return i||e}function a(e,t,i){if(!(e instanceof p.Node))return e;if(!i){var r=t(e);if(r&&r!==e)return r}if(e instanceof p.NodeList){var o=n(e.children,function(e){return a(e,t,i)});o!==e.children&&(e=new p[e.typename](e.lineno,e.colno,o))}else if(e instanceof p.CallExtension){var s=a(e.args,t,i),u=n(e.contentArgs,function(e){return a(e,t,i)});s===e.args&&u===e.contentArgs||(e=new p[e.typename](e.extName,e.prop,s,u))}else{var l=e.fields.map(function(t){return e[t]}),c=n(l,function(e){return a(e,t,i)});c!==l&&(e=new p[e.typename](e.lineno,e.colno),c.forEach(function(t,i){e[e.fields[i]]=t}))}return i?t(e)||e:e}function o(e,t){return a(e,t,!0)}function s(e,t,i){var n=[],a=o(i?e[i]:e,function(e){if(e instanceof p.Block)return e;if(e instanceof p.Filter&&-1!==f.indexOf(t,e.name.value)||e instanceof p.CallExtensionAsync){var i=new p.Symbol(e.lineno,e.colno,r());return n.push(new p.FilterAsync(e.lineno,e.colno,e.name,e.args,i)),i}});return i?e[i]=a:e=a,n.length?(n.push(e),new p.NodeList(e.lineno,e.colno,n)):e}function u(e,t){return o(e,function(e){return e instanceof p.Output?s(e,t):e instanceof p.Set?s(e,t,"value"):e instanceof p.For?s(e,t,"arr"):e instanceof p.If?s(e,t,"cond"):e instanceof p.CallExtension?s(e,t,"args"):void 0})}function l(e){return a(e,function(e){if(e instanceof p.Block){var t=!1,i=r();e.body=a(e.body,function(e){if(e instanceof p.FunCall&&"super"===e.name.value)return t=!0,new p.Symbol(e.lineno,e.colno,i)}),t&&e.body.children.unshift(new p.Super(0,0,e.name,new p.Symbol(0,0,i)))}})}function c(e){return o(e,function(e){if(e instanceof p.If||e instanceof p.For){var t=!1;if(a(e,function(e){if(e instanceof p.FilterAsync||e instanceof p.IfAsync||e instanceof p.AsyncEach||e instanceof p.AsyncAll||e instanceof p.CallExtensionAsync)return t=!0,e}),t){if(e instanceof p.If)return new p.IfAsync(e.lineno,e.colno,e.cond,e.body,e.else_);if(e instanceof p.For)return new p.AsyncEach(e.lineno,e.colno,e.arr,e.name,e.body,e.else_)}}})}function h(e,t){return c(l(u(e,t)))}function d(e,t){return h(e,t||[])}var p=i(10),f=i(1),g=0;e.exports={transform:d}},function(e,t,i){"use strict";function r(e,t,i){return function(){var r,n,s=o(arguments),u=a(arguments);if(s>e.length){r=Array.prototype.slice.call(arguments,0,e.length);var l=Array.prototype.slice.call(arguments,r.length,s);for(n=0;n<l.length;n++)n<t.length&&(u[t[n]]=l[n]);r.push(u)}else if(s<e.length){for(r=Array.prototype.slice.call(arguments,0,s),n=s;n<e.length;n++){var c=e[n];r.push(u[c]),delete u[c]}r.push(u)}else r=arguments;return i.apply(this,r)}}function n(e){return e.__keywords=!0,e}function a(e){var t=e.length;if(t){var i=e[t-1];if(i&&i.hasOwnProperty("__keywords"))return i}return{}}function o(e){var t=e.length;if(0===t)return 0;var i=e[t-1];return i&&i.hasOwnProperty("__keywords")?t-1:t}function s(e){if("string"!=typeof e)return e;this.val=e,this.length=e.length}function u(e,t){return e instanceof s?new s(t):t.toString()}function l(e){var t=typeof e;return"string"===t?new s(e):"function"!==t?e:function(){var t=e.apply(this,arguments);return"string"==typeof t?new s(t):t}}function c(e,t){return e=void 0!==e&&null!==e?e:"",!t||e instanceof s||(e=_.escape(e.toString())),e}function h(e,t,i){if(null===e||void 0===e)throw new _.TemplateError("attempted to output null or undefined value",t+1,i+1);return e}function d(e,t){return e=e||{},"function"==typeof e[t]?function(){return e[t].apply(e,arguments)}:e[t]}function p(e,t,i,r){if(!e)throw new Error("Unable to call `"+t+"`, which is undefined or falsey");if("function"!=typeof e)throw new Error("Unable to call `"+t+"`, which is not a function");return e.apply(i,r)}function f(e,t,i){var r=t.lookup(i);return void 0!==r?r:e.lookup(i)}function g(e,t,i){return e.lineno?e:new _.TemplateError(e,t,i)}function m(e,t,i,r){if(_.isArray(e)){var n=e.length;_.asyncIter(e,function(e,r,a){switch(t){case 1:i(e,r,n,a);break;case 2:i(e[0],e[1],r,n,a);break;case 3:i(e[0],e[1],e[2],r,n,a);break;default:e.push(r,a),i.apply(this,e)}},r)}else _.asyncFor(e,function(e,t,r,n,a){i(e,t,r,n,a)},r)}function v(e,t,i,r){function n(e,t){u++,s[e]=t,u===a&&r(null,s.join(""))}var a,o,s,u=0;if(_.isArray(e))if(a=e.length,s=new Array(a),0===a)r(null,"");else for(o=0;o<e.length;o++){var l=e[o];switch(t){case 1:i(l,o,a,n);break;case 2:i(l[0],l[1],o,a,n);break;case 3:i(l[0],l[1],l[2],o,a,n);break;default:l.push(o,n),i.apply(this,l)}}else{var c=_.keys(e);if(a=c.length,s=new Array(a),0===a)r(null,"");else for(o=0;o<c.length;o++){var h=c[o];i(h,e[h],o,a,n)}}}var _=i(1),b=i(6),x=b.extend({init:function(e,t){this.variables={},this.parent=e,this.topLevel=!1,this.isolateWrites=t},set:function(e,t,i){var r=e.split("."),n=this.variables,a=this;if(i&&(a=this.resolve(r[0],!0)))return void a.set(e,t);for(var o=0;o<r.length-1;o++){var s=r[o];n[s]||(n[s]={}),n=n[s]}n[r[r.length-1]]=t},get:function(e){var t=this.variables[e];return void 0!==t?t:null},lookup:function(e){var t=this.parent,i=this.variables[e];return void 0!==i?i:t&&t.lookup(e)},resolve:function(e,t){var i=t&&this.isolateWrites?void 0:this.parent;return void 0!==this.variables[e]?this:i&&i.resolve(e)},push:function(e){return new x(this,e)},pop:function(){return this.parent}});s.prototype=Object.create(String.prototype,{length:{writable:!0,configurable:!0,value:0}}),s.prototype.valueOf=function(){return this.val},s.prototype.toString=function(){return this.val},e.exports={Frame:x,makeMacro:r,makeKeywordArgs:n,numArgs:o,suppressValue:c,ensureDefined:h,memberLookup:d,contextOrFrameLookup:f,callWrap:p,handleError:g,isArray:_.isArray,keys:_.keys,SafeString:s,copySafeness:u,markSafe:l,asyncEach:m,asyncAll:v,inOperator:_.inOperator}},function(e,t,i){"use strict";function r(e,t){return null===e||void 0===e||!1===e?t:e}var n=i(1),a=i(13),o={abs:Math.abs,batch:function(e,t,i){var r,n=[],a=[];for(r=0;r<e.length;r++)r%t==0&&a.length&&(n.push(a),a=[]),a.push(e[r]);if(a.length){if(i)for(r=a.length;r<t;r++)a.push(i);n.push(a)}return n},capitalize:function(e){e=r(e,"");var t=e.toLowerCase();return a.copySafeness(e,t.charAt(0).toUpperCase()+t.slice(1))},center:function(e,t){if(e=r(e,""),t=t||80,e.length>=t)return e;var i=t-e.length,o=n.repeat(" ",i/2-i%2),s=n.repeat(" ",i/2);return a.copySafeness(e,o+e+s)},default:function(e,t,i){return i?e||t:void 0!==e?e:t},dictsort:function(e,t,i){if(!n.isObject(e))throw new n.TemplateError("dictsort filter: val must be an object");var r=[];for(var a in e)r.push([a,e[a]]);var o;if(void 0===i||"key"===i)o=0;else{if("value"!==i)throw new n.TemplateError("dictsort filter: You can only sort by either key or value");o=1}return r.sort(function(e,i){var r=e[o],a=i[o];return t||(n.isString(r)&&(r=r.toUpperCase()),n.isString(a)&&(a=a.toUpperCase())),r>a?1:r===a?0:-1}),r},dump:function(e,t){return JSON.stringify(e,null,t)},escape:function(e){return e instanceof a.SafeString?e:(e=null===e||void 0===e?"":e,a.markSafe(n.escape(e.toString())))},safe:function(e){return e instanceof a.SafeString?e:(e=null===e||void 0===e?"":e,a.markSafe(e.toString()))},first:function(e){return e[0]},groupby:function(e,t){return n.groupBy(e,t)},indent:function(e,t,i){if(""===(e=r(e,"")))return"";t=t||4;for(var o="",s=e.split("\n"),u=n.repeat(" ",t),l=0;l<s.length;l++)o+=0!==l||i?u+s[l]+"\n":s[l]+"\n";return a.copySafeness(e,o)},join:function(e,t,i){return t=t||"",i&&(e=n.map(e,function(e){return e[i]})),e.join(t)},last:function(e){return e[e.length-1]},length:function(e){var t=r(e,"");return void 0!==t?"function"==typeof Map&&t instanceof Map||"function"==typeof Set&&t instanceof Set?t.size:!n.isObject(t)||t instanceof a.SafeString?t.length:Object.keys(t).length:0},list:function(e){if(n.isString(e))return e.split("");if(n.isObject(e)){var t=[];if(Object.keys)t=Object.keys(e);else for(var i in e)t.push(i);return n.map(t,function(t){return{key:t,value:e[t]}})}if(n.isArray(e))return e;throw new n.TemplateError("list filter: type not iterable")},lower:function(e){return e=r(e,""),e.toLowerCase()},nl2br:function(e){return null===e||void 0===e?"":a.copySafeness(e,e.replace(/\r\n|\n/g,"<br />\n"))},random:function(e){return e[Math.floor(Math.random()*e.length)]},rejectattr:function(e,t){return e.filter(function(e){return!e[t]})},selectattr:function(e,t){return e.filter(function(e){return!!e[t]})},replace:function(e,t,i,r){var n=e;if(t instanceof RegExp)return e.replace(t,i);void 0===r&&(r=-1);var o="";if("number"==typeof t)t+="";else if("string"!=typeof t)return e;if("number"==typeof e&&(e+=""),"string"!=typeof e&&!(e instanceof a.SafeString))return e;if(""===t)return o=i+e.split("").join(i)+i,a.copySafeness(e,o);var s=e.indexOf(t);if(0===r||-1===s)return e;for(var u=0,l=0;s>-1&&(-1===r||l<r);)o+=e.substring(u,s)+i,u=s+t.length,l++,s=e.indexOf(t,u);return u<e.length&&(o+=e.substring(u)),a.copySafeness(n,o)},reverse:function(e){var t;return t=n.isString(e)?o.list(e):n.map(e,function(e){return e}),t.reverse(),n.isString(e)?a.copySafeness(e,t.join("")):t},round:function(e,t,i){t=t||0;var r=Math.pow(10,t);return("ceil"===i?Math.ceil:"floor"===i?Math.floor:Math.round)(e*r)/r},slice:function(e,t,i){for(var r=Math.floor(e.length/t),n=e.length%t,a=0,o=[],s=0;s<t;s++){var u=a+s*r;s<n&&a++;var l=a+(s+1)*r,c=e.slice(u,l);i&&s>=n&&c.push(i),o.push(c)}return o},sum:function(e,t,i){var r=0;"number"==typeof i&&(r+=i),t&&(e=n.map(e,function(e){return e[t]}));for(var a=0;a<e.length;a++)r+=e[a];return r},sort:a.makeMacro(["value","reverse","case_sensitive","attribute"],[],function(e,t,i,r){return e=n.map(e,function(e){return e}),e.sort(function(e,a){var o,s;return r?(o=e[r],s=a[r]):(o=e,s=a),!i&&n.isString(o)&&n.isString(s)&&(o=o.toLowerCase(),s=s.toLowerCase()),o<s?t?1:-1:o>s?t?-1:1:0}),e}),string:function(e){return a.copySafeness(e,e)},striptags:function(e,t){e=r(e,""),t=t||!1;var i=/<\/?([a-z][a-z0-9]*)\b[^>]*>|<!--[\s\S]*?-->/gi,n=o.trim(e.replace(i,"")),s="";return s=t?n.replace(/^ +| +$/gm,"").replace(/ +/g," ").replace(/(\r\n)/g,"\n").replace(/\n\n\n+/g,"\n\n"):n.replace(/\s+/gi," "),a.copySafeness(e,s)},title:function(e){e=r(e,"");for(var t=e.split(" "),i=0;i<t.length;i++)t[i]=o.capitalize(t[i]);return a.copySafeness(e,t.join(" "))},trim:function(e){return a.copySafeness(e,e.replace(/^\s*|\s*$/g,""))},truncate:function(e,t,i,n){var o=e;if(e=r(e,""),t=t||255,e.length<=t)return e;if(i)e=e.substring(0,t);else{var s=e.lastIndexOf(" ",t);-1===s&&(s=t),e=e.substring(0,s)}return e+=void 0!==n&&null!==n?n:"...",a.copySafeness(o,e)},upper:function(e){return e=r(e,""),e.toUpperCase()},urlencode:function(e){var t=encodeURIComponent;if(n.isString(e))return t(e);var i;if(n.isArray(e))i=e.map(function(e){return t(e[0])+"="+t(e[1])});else{i=[];for(var r in e)e.hasOwnProperty(r)&&i.push(t(r)+"="+t(e[r]))}return i.join("&")},urlize:function(e,t,i){isNaN(t)&&(t=1/0);var r=!0===i?' rel="nofollow"':"",n=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,a=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,o=/^https?:\/\/.*$/,s=/^www\./,u=/\.(?:org|net|com)(?:\:|\/|$)/;return e.split(/(\s+)/).filter(function(e){return e&&e.length}).map(function(e){var i=e.match(n),l=i&&i[1]||e;return o.test(l)?'<a href="'+l+'"'+r+">"+l.substr(0,t)+"</a>":s.test(l)?'<a href="http://'+l+'"'+r+">"+l.substr(0,t)+"</a>":a.test(l)?'<a href="mailto:'+l+'">'+l+"</a>":u.test(l)?'<a href="http://'+l+'"'+r+">"+l.substr(0,t)+"</a>":e}).join("")},wordcount:function(e){e=r(e,"");var t=e?e.match(/\w+/g):null;return t?t.length:null},float:function(e,t){var i=parseFloat(e);return isNaN(i)?t:i},int:function(e,t){var i=parseInt(e,10);return isNaN(i)?t:i}};o.d=o.default,o.e=o.escape,e.exports=o},function(e,t,i){"use strict";var r=i(16),n=i(17),a=r.extend({init:function(e,t){this.baseURL=e||".",t=t||{},this.useCache=!!t.useCache,this.async=!!t.async},resolve:function(e,t){throw new Error("relative templates not support in the browser yet")},getSource:function(e,t){var i,r=this.useCache;return this.fetch(this.baseURL+"/"+e,function(n,a){if(n)if(t)t(n.content);else{if(404!==n.status)throw n.content;i=null}else i={src:a,path:e,noCache:!r},t&&t(null,i)}),i},fetch:function(e,t){var i,r=!0;window.XMLHttpRequest?i=new XMLHttpRequest:window.ActiveXObject&&(i=new ActiveXObject("Microsoft.XMLHTTP")),i.onreadystatechange=function(){4===i.readyState&&r&&(r=!1,0===i.status||200===i.status?t(null,i.responseText):t({status:i.status,content:i.responseText}))},e+=(-1===e.indexOf("?")?"?":"&")+"s="+(new Date).getTime(),i.open("GET",e,this.async),i.send()}});e.exports={WebLoader:a,PrecompiledLoader:n}},function(e,t,i){"use strict";var r=i(3),n=i(6),a=i(1),o=n.extend({on:function(e,t){this.listeners=this.listeners||{},this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t)},emit:function(e){var t=Array.prototype.slice.call(arguments,1);this.listeners&&this.listeners[e]&&a.each(this.listeners[e],function(e){e.apply(null,t)})},resolve:function(e,t){return r.resolve(r.dirname(e),t)},isRelative:function(e){return 0===e.indexOf("./")||0===e.indexOf("../")}});e.exports=o},function(e,t,i){"use strict";var r=i(16),n=r.extend({init:function(e){this.precompiled=e||{}},getSource:function(e){return this.precompiled[e]?{src:{type:"code",obj:this.precompiled[e]},path:e}:null}});e.exports=n},function(e,t){"use strict";function i(e){var t=-1;return{current:null,reset:function(){t=-1,this.current=null},next:function(){return t++,t>=e.length&&(t=0),this.current=e[t],this.current}}}function r(e){e=e||",";var t=!0;return function(){var i=t?"":e;return t=!1,i}}function n(){return{range:function(e,t,i){void 0===t?(t=e,e=0,i=1):i||(i=1);var r,n=[];if(i>0)for(r=e;r<t;r+=i)n.push(r);else for(r=e;r>t;r+=i)n.push(r);return n},cycler:function(){return i(Array.prototype.slice.call(arguments))},joiner:function(e){return r(e)}}}e.exports=n},function(e,t,i){var r,n;(function(i,a){!function(o){"use strict";var s=function(){var e=Array.prototype.slice.call(arguments);"function"==typeof e[0]&&e[0].apply(null,e.splice(1))},u=function(e){"function"==typeof i?i(e):void 0!==a&&a.nextTick?a.nextTick(e):setTimeout(e,0)},l=function(e){var t=function(i){var r=function(){return e.length&&e[i].apply(null,arguments),r.next()};return r.next=function(){return i<e.length-1?t(i+1):null},r};return t(0)},c=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},h=function(e,t,i){var r=i?u:s;if(t=t||function(){},!c(e)){var n=new Error("First argument to waterfall must be an array of functions");return t(n)}if(!e.length)return t();var a=function(e){return function(i){if(i)t.apply(null,arguments),t=function(){};else{var n=Array.prototype.slice.call(arguments,1),o=e.next();o?n.push(a(o)):n.push(t),r(function(){e.apply(null,n)})}}};a(l(e))()};r=[],void 0!==(n=function(){return h}.apply(t,r))&&(e.exports=n)}()}).call(t,i(20).setImmediate,i(11))},function(e,r,n){function a(e,t){this._id=e,this._clearFn=t}var o=Function.prototype.apply;r.setTimeout=function(){return new a(o.call(setTimeout,window,arguments),clearTimeout)},r.setInterval=function(){return new a(o.call(setInterval,window,arguments),clearInterval)},r.clearTimeout=r.clearInterval=function(e){e&&e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},r.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},r.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},r._unrefActive=r.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(21),r.setImmediate=t,r.clearImmediate=i},function(e,t,i){(function(e,t){!function(e,i){"use strict";function r(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var r={callback:e,args:t};return l[u]=r,s(u),u++}function n(e){delete l[e]}function a(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(i,r)}}function o(e){if(c)setTimeout(o,0,e);else{var t=l[e];if(t){c=!0;try{a(t)}finally{n(e),c=!1}}}}if(!e.setImmediate){var s,u=1,l={},c=!1,h=e.document,d=Object.getPrototypeOf&&Object.getPrototypeOf(e);d=d&&d.setTimeout?d:e,"[object process]"==={}.toString.call(e.process)?function(){s=function(e){t.nextTick(function(){o(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?function(){var t="setImmediate$"+Math.random()+"$",i=function(i){i.source===e&&"string"==typeof i.data&&0===i.data.indexOf(t)&&o(+i.data.slice(t.length))};e.addEventListener?e.addEventListener("message",i,!1):e.attachEvent("onmessage",i),s=function(i){e.postMessage(t+i,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){o(e.data)},s=function(t){e.port2.postMessage(t)}}():h&&"onreadystatechange"in h.createElement("script")?function(){var e=h.documentElement;s=function(t){var i=h.createElement("script");i.onreadystatechange=function(){o(t),i.onreadystatechange=null,e.removeChild(i),i=null},e.appendChild(i)}}():function(){s=function(e){setTimeout(o,0,e)}}(),d.setImmediate=r,d.clearImmediate=n}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,function(){return this}(),i(11))},function(e,t){function i(){"use strict";function e(){r.contextOrFrameLookup=l,a.prototype.assertType=c,o.prototype.parseAggregate=h,r.memberLookup=d}function t(e){return{index:e.index,lineno:e.lineno,colno:e.colno}}function i(e,t,i,n){e=e||[],null===t&&(t=n<0?e.length-1:0),null===i?i=n<0?-1:e.length:i<0&&(i+=e.length),t<0&&(t+=e.length);for(var a=[],o=t;!(o<0||o>e.length)&&!(n>0&&o>=i)&&!(n<0&&o<=i);o+=n)a.push(r.memberLookup(e,o));return a}var r=this.runtime,n=this.lib,a=this.compiler.Compiler,o=this.parser.Parser,s=this.nodes,u=this.lexer,l=r.contextOrFrameLookup,c=a.prototype.assertType,h=o.prototype.parseAggregate,d=r.memberLookup;r.contextOrFrameLookup=function(e,t,i){var r=l.apply(this,arguments);if(void 0===r)switch(i){case"True":return!0;case"False":return!1;case"None":return null}return r};var p=s.Node.extend("Slice",{fields:["start","stop","step"],init:function(e,t,i,r,n){i=i||new s.Literal(e,t,null),r=r||new s.Literal(e,t,null),n=n||new s.Literal(e,t,1),this.parent(e,t,i,r,n)}});a.prototype.assertType=function(e){if(!(e instanceof p))return c.apply(this,arguments)},a.prototype.compileSlice=function(e,t){this.emit("("),this._compileExpression(e.start,t),this.emit("),("),this._compileExpression(e.stop,t),this.emit("),("),this._compileExpression(e.step,t),this.emit(")")},o.prototype.parseAggregate=function(){var e=this,i=t(this.tokens);i.colno--,i.index--;try{return h.apply(this)}catch(h){var r=t(this.tokens),a=function(){return n.extend(e.tokens,r),h};n.extend(this.tokens,i),this.peeked=!1;var o=this.peekToken();if(o.type!==u.TOKEN_LEFT_BRACKET)throw a();this.nextToken();for(var l=new p(o.lineno,o.colno),c=!1,d=0;d<=l.fields.length&&!this.skip(u.TOKEN_RIGHT_BRACKET);d++){if(d===l.fields.length){if(!c)break;this.fail("parseSlice: too many slice components",o.lineno,o.colno)}if(this.skip(u.TOKEN_COLON))c=!0;else{var f=l.fields[d];l[f]=this.parseExpression(),c=this.skip(u.TOKEN_COLON)||c}}if(!c)throw a();return new s.Array(o.lineno,o.colno,[l])}};var f={pop:function(e){if(void 0===e)return this.pop();if(e>=this.length||e<0)throw new Error("KeyError");return this.splice(e,1)},append:function(e){return this.push(e)},remove:function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return this.splice(t,1);throw new Error("ValueError")},count:function(e){for(var t=0,i=0;i<this.length;i++)this[i]===e&&t++;return t},index:function(e){var t;if(-1===(t=this.indexOf(e)))throw new Error("ValueError");return t},find:function(e){return this.indexOf(e)},insert:function(e,t){return this.splice(e,0,t)}},g={items:function(){var e=[];for(var t in this)e.push([t,this[t]]);return e},values:function(){var e=[];for(var t in this)e.push(this[t]);return e},keys:function(){var e=[];for(var t in this)e.push(t);return e},get:function(e,t){var i=this[e];return void 0===i&&(i=t),i},has_key:function(e){return this.hasOwnProperty(e)},pop:function(e,t){var i=this[e];if(void 0===i&&void 0!==t)i=t;else{if(void 0===i)throw new Error("KeyError");delete this[e]}return i},popitem:function(){for(var e in this){var t=this[e];return delete this[e],[e,t]}throw new Error("KeyError")},setdefault:function(e,t){return e in this?this[e]:(void 0===t&&(t=null),this[e]=t)},update:function(e){for(var t in e)this[t]=e[t];return null}};return g.iteritems=g.items,g.itervalues=g.values,g.iterkeys=g.keys,r.memberLookup=function(e,t,r){return 4===arguments.length?i.apply(this,arguments):(e=e||{},n.isArray(e)&&f.hasOwnProperty(t)?function(){return f[t].apply(e,arguments)}:n.isObject(e)&&g.hasOwnProperty(t)?function(){return g[t].apply(e,arguments)}:d.apply(this,arguments))},e}e.exports=i}])})}).call(t,i(154).setImmediate,i(154).clearImmediate)},,,,,,,,,,,,,,,,,,,,,,,function(e,t){var i={};i.EPSILON=1e-6,i.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,i.RANDOM=Math.random,i.ENABLE_SIMD=!1,i.SIMD_AVAILABLE=i.ARRAY_TYPE===Float32Array&&"SIMD"in this,i.USE_SIMD=i.ENABLE_SIMD&&i.SIMD_AVAILABLE,i.setMatrixArrayType=function(e){i.ARRAY_TYPE=e};var r=Math.PI/180;i.toRadian=function(e){return e*r},i.equals=function(e,t){return Math.abs(e-t)<=i.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))},e.exports=i},function(e,t,i){"use strict";var r=i(14),n=i(30),a=i(422),o=i(68),s=i(580),u=i(331),l=new s,c=function(e,t){a.call(this),o.call(this),this._program=null,this._nullProgram=!0,this._vertex=void 0,this._fragment=void 0,this._uniformsCache=void 0,this._attributesCache=void 0,this._activeUniforms=void 0,this._foreignUniforms=void 0,this._trackAttributes=void 0,e&&this.setVertexShader(e),t&&this.setFragmentShader(t),this._dirty=!0},h=function(e){var t,i,r,n={},a=e.match(/attribute\s+\w+\s+\w+/g);if(null!==a)for(t=0,i=a.length;t<i;t++)r=a[t].match(/attribute\s+\w+\s+(\w+)/)[1],n[r]=!0;else for(a=e.match(/in\s+\w+\s+\w+\s*;/g),t=0,i=a.length;t<i;t++)r=a[t].match(/in\s+\w+\s+(\w+)\s*;/)[1],n[r]=!0;return n};c._sDeletedGLProgramCache=new window.Map,c.deleteGLProgram=function(e,t){c._sDeletedGLProgramCache.has(e)||c._sDeletedGLProgramCache.set(e,[]),c._sDeletedGLProgramCache.get(e).push(t)},c.flushDeletedGLPrograms=function(e,t){if(t<=0)return t;if(!c._sDeletedGLProgramCache.has(e))return t;for(var i=0,r=u.instance().tick(),n=c._sDeletedGLProgramCache.get(e),a=n.length,o=a-1;o>=0&&i<t;o--)e.deleteProgram(n[o]),n.splice(o,1),i=u.instance().deltaS(r,u.instance().tick());return t-i},c.flushAllDeletedGLPrograms=function(e){if(c._sDeletedGLProgramCache.has(e))for(var t=c._sDeletedGLProgramCache.get(e),i=t.length,r=i-1;r>=0;r--)e.deleteProgram(t[r]),t.splice(r,1)},r.createPrototypeStateAttribute(c,r.objectInherit(a.prototype,r.objectInherit(o.prototype,{attributeType:"Program",cloneType:function(){return new c},setVertexShader:function(e){this._vertex=e,this._nullProgram=!1,e.setText(l.processShader(e.getText()))},setFragmentShader:function(e){this._fragment=e,this._nullProgram=!1,e.setText(l.processShader(e.getText()))},getVertexShader:function(){return this._vertex},getFragmentShader:function(){return this._fragment},getProgram:function(){return this._program},setActiveUniforms:function(e){this._activeUniforms=e},getActiveUniforms:function(){return this._activeUniforms},setForeignUniforms:function(e){this._foreignUniforms=e},getForeignUniforms:function(){return this._foreignUniforms},setUniformsCache:function(e){this._uniformsCache=e},getUniformsCache:function(){return this._uniformsCache},setAttributesCache:function(e){this._attributesCache=e},getAttributesCache:function(){return this._attributesCache},setTrackAttributes:function(e){this._trackAttributes=e},getTrackAttributes:function(){return this._trackAttributes},releaseGLObjects:function(){void 0!==this._vertex&&this._vertex.releaseGLObjects(),void 0!==this._fragment&&this._fragment.releaseGLObjects(),null!==this._program&&(void 0!==this._gl&&c.deleteGLProgram(this._gl,this._program),this._program=void 0)},apply:function(e){if(!this._nullProgram){this._gl||this.setGraphicContext(e.getGraphicContext());var t=this._gl;if(!this._program||this._dirty){var i;this._vertex.shader||(i=this._vertex.compile(t)),this._fragment.shader||(i=this._fragment.compile(t));var a=h(this._vertex.getText());if(i&&(this._program=t.createProgram(),a.Vertex&&t.bindAttribLocation(this._program,0,"Vertex"),t.attachShader(this._program,this._vertex.shader),t.attachShader(this._program,this._fragment.shader),r.timeStamp("osgjs.metrics:linkShader"),t.linkProgram(this._program),!t.getProgramParameter(this._program,t.LINK_STATUS)&&!t.isContextLost())){var o=t.getProgramInfoLog(this._program);n.errorFold(o,"can't link program\nvertex shader:\n"+this._vertex.text+"\n fragment shader:\n"+this._fragment.text);var s=void 0!==t.rawgl?t.rawgl:t;void 0!==s&&void 0!==s.getExtension&&(s=s.getExtension("WEBGL_debug_shaders")),s&&"Failed to create D3D shaders.\n"===o&&(n.error(s.getTranslatedShaderSource(this._vertex.shader)),n.error(s.getTranslatedShaderSource(this._fragment.shader))),i=!1}if(!i){var u=t.createProgram();this._vertex.failSafe(t,this._vertex.getText()),this._fragment.failSafe(t,this._fragment.getText()),t.attachShader(u,this._vertex.shader),t.attachShader(u,this._fragment.shader),t.linkProgram(u),t.validateProgram(u),n.warn("FailSafe shader Activated "),this._program=u}this._uniformsCache={},this._attributesCache={},this.cacheUniformList(t,this._vertex.text),this.cacheUniformList(t,this._fragment.text),this.cacheAttributeList(t,window.Object.keys(a)),this._dirty=!1}e.applyProgram(this._program)}},cacheUniformList:function(e,t){var i=t.match(/uniform\s+\w+\s+\w+((\s)?\[(.*?)\])?/g),r=this._uniformsCache;if(null!==i)for(var n=0,a=i.length;n<a;n++){var o=i[n].match(/uniform\s+\w+\s+(\w+)/)[1],s=i[n].match(/uniform\s+\w+\s+(\w+)(\s?\[.*?\])?/)[1],u=e.getUniformLocation(this._program,o);void 0!==u&&null!==u&&void 0===r[s]&&(r[s]=u)}},cacheAttributeList:function(e,t){for(var i=this._attributesCache,r=0,n=t.length;r<n;r++){var a=t[r],o=e.getAttribLocation(this._program,a);-1!==o&&void 0!==o&&void 0===i[a]&&(i[a]=o)}}})),"osg","Program"),e.exports=c},function(e,t,i){"use strict";var r=i(30),n=i(14),a=i(331),o=i(422),s=function(e,t){o.call(this);var i=e;"string"==typeof e&&(i=s[e]),this.type=i,this.setText(t)};s.VERTEX_SHADER=35633,s.FRAGMENT_SHADER=35632;s.VS_DBG="#define _DEBUG 1\n#ifdef _DEBUG\nattribute vec3 Vertex;uniform mat4 uModelViewMatrix;uniform mat4 uProjectionMatrix;void main(void) {  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);}\n",s.FS_DBG="#define _DEBUG 1\n#ifdef _DEBUG\n precision lowp float; void main(void) { gl_FragColor = vec4(1.0, 0.6, 0.6, 1.0);}\n",s._sDeletedGLShaderCache=new window.Map,s.deleteGLShader=function(e,t){s._sDeletedGLShaderCache.has(e)||s._sDeletedGLShaderCache.set(e,[]),s._sDeletedGLShaderCache.get(e).push(t)},s.flushDeletedGLShaders=function(e,t){if(t<=0)return t;if(!s._sDeletedGLShaderCache.has(e))return t;for(var i=0,r=a.instance().tick(),n=s._sDeletedGLShaderCache.get(e),o=n.length,u=o-1;u>=0&&i<t;u--)e.deleteShader(n[u]),n.splice(u,1),i=a.instance().deltaS(r,a.instance().tick());return t-i},s.flushAllDeletedGLShaders=function(e){if(s._sDeletedGLShaderCache.has(e))for(var t=s._sDeletedGLShaderCache.get(e),i=t.length,r=i-1;r>=0;r--)e.deleteShader(t[r]),t.splice(r,1)},n.createPrototypeObject(s,n.objectInherit(o.prototype,{setText:function(e){this.text=e},getText:function(){return this.text},failSafe:function(e,t){this.shader=e.createShader(this.type);var i=t.match(/#define[\s]+SHADER_NAME[\s]+([\S]+)(\n|$)/);i=i?i[1]:"";var r=this.type===s.VERTEX_SHADER?s.VS_DBG:s.FS_DBG;r+="\n#define SHADER_NAME FailSafe"+i+"\n#else\n"+t+"\n#endif\n",e.shaderSource(this.shader,r),e.compileShader(this.shader)},processErrors:function(e,t){var i=/ERROR: [\d]+:([\d]+): (.+)/gim,n=t.split("\n"),a=n.length;if(0!==a){var o,s;if(null===i.exec(e)&&(i=/Shader compilation errors\n\((\d+)\, \d+\): (.+)/gim),null===i.exec(e))return void r.error(e);for(i.lastIndex=0;null!==(s=i.exec(e));){s.index===i.lastIndex&&i.lastIndex++;var u=parseInt(s[1],10);if(!(u>a)){r.error("ERROR "+s[2]+" in line "+u);var l=Math.max(0,u-7),c=Math.max(0,u-2);for(o=l;o<=c;o++)r.warn(n[o].replace(/^[ \t]+/g,""));for(c=Math.max(0,u-1),r.error(n[c].replace(/^[ \t]+/g,"")),l=Math.min(a,u),c=Math.min(a,u+5),o=l;o<c;o++)r.warn(n[o].replace(/^[ \t]+/g,""))}}}},compile:function(e){this._gl||this.setGraphicContext(e),this.shader=e.createShader(this.type);var t=this.text;if(s.enableGLSLOptimizer&&s.glslOptimizer){var i=this.type===s.VERTEX_SHADER?"vertex":"fragment";r.infoFold(i+" shader before optimization",t);var a=s.glslOptimizer(t,"2",this.type===s.VERTEX_SHADER);-1!==a.indexOf("Error:")?r.error(a):a.length<=1?r.warnFold("glsl optimizer returned an empty shader, the original will be used",t):(r.infoFold(i+" shader after optimization",a),t=a)}if(e.shaderSource(this.shader,t),n.timeStamp("osgjs.metrics:compileShader"),e.compileShader(this.shader),!e.getShaderParameter(this.shader,e.COMPILE_STATUS)&&!e.isContextLost()){var o=e.getShaderInfoLog(this.shader);this.processErrors(o,t);for(var u=t,l=u.split("\n"),c="\n",h=0,d=l.length;h<d;++h)c+=h+" "+l[h]+"\n";return r.errorFold("can't compile shader",c),!1}return!0},releaseGLObjects:function(){void 0!==this._gl&&s.deleteGLShader(this._gl,this.shader),this.shader=void 0}}),"osg","Shader"),e.exports=s},function(e,t,i){"use strict";var r=function(){var e=window||global;if(void 0===e.performance)return function(){return Date.now()};var t=e.performance.now||e.performance.mozNow||e.performance.msNow||e.performance.oNow||e.performance.webkitNow||function(){return Date.now()};return function(){return t.apply(e.performance,arguments)}}(),n=function(){};n.instance=function(){return n._instance||(n._instance=new n),n._instance},n.prototype={deltaS:function(e,t){return(t-e)/1e3},deltaM:function(e,t){return t-e},tick:function(){return r()}},e.exports=n},function(e,t,i){"use strict";var r=i(14),n=i(135),a=i(8).mat4,o=i(146),s=function(){n.call(this),this.referenceFrame=o.RELATIVE_RF};r.createPrototypeNode(s,r.objectInherit(n.prototype,{setReferenceFrame:function(e){this.referenceFrame=e},getReferenceFrame:function(){return this.referenceFrame},computeBoundingSphere:function(){var e=a.create();return function(t){return n.prototype.computeBoundingSphere.call(this,t),t.valid()?(a.identity(e),this.computeLocalToWorldMatrix(e),t.transformMat4(t,e),t):t}}()}),"osg","Transform"),e.exports=s},function(e,t,i){"use strict";var r,n=i(30),a=i(716),o=i(567),s=function(){r||(r=i(97)),this._checkRTT={},this._webGLExtensions={},this._webGLParameters={},this._webGLShaderMaxInt="NONE",this._webGLShaderMaxFloat="NONE",this._bugsDB={},this._webGLPlatforms={},this._webGLParameters.MAX_COMBINED_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_CUBE_MAP_TEXTURE_SIZE=16,this._webGLParameters.MAX_FRAGMENT_UNIFORM_VECTORS=16,this._webGLParameters.MAX_RENDERBUFFER_SIZE=1,this._webGLParameters.MAX_TEXTURE_IMAGE_UNITS=8,this._webGLParameters.MAX_TEXTURE_SIZE=64,this._webGLParameters.MAX_VARYING_VECTORS=8,this._webGLParameters.MAX_VERTEX_ATTRIBS=8,this._webGLParameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS=0,this._webGLParameters.MAX_VERTEX_UNIFORM_VECTORS=128,this._webGLParameters.MAX_VIEWPORT_DIMS=[1,1],this._webGLParameters.NUM_COMPRESSED_TEXTURE_FORMATS=0,this._webGLParameters.MAX_SHADER_PRECISION_FLOAT="none",this._webGLParameters.MAX_SHADER_PRECISION_INT="none",this._gl=void 0};s.instance=function(e){if(!s._instance){var t,i=e;if(!i){"undefined"!=typeof window&&window.gli&&(t=window.gli.host.inspectContext,window.gli.host.inspectContext=!1);var r=document.createElement("canvas");r.width=32,r.height=32;var u=new o;u.extend({antialias:!1}),u.extendWithOptionsURL(),i=a.setupWebGL(r,u,function(){})}s._instance=new s,i?s._instance.init(i):n.warn("no support for webgl context detected."),t&&(window.gli.host.inspectContext=t)}return e&&e!==s._instance.getContext()&&s._instance.initContextDependant(e),s._instance},s.prototype={getContext:function(){return this._gl},initContextDependant:function(e){this._gl=e,this._isGL2=void 0!==window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext,this.initWebGLExtensions(e),this.hasLinearHalfFloatRTT(e),this.hasLinearFloatRTT(e),this.hasHalfFloatRTT(e),this.hasFloatRTT(e)},init:function(e){if(this.initWebGLParameters(e),this.initPlatformSupport(),this.initBugDB(),this.initContextDependant(e),this._isGL2)for(var t=["OES_element_index_uint","EXT_sRGB","EXT_blend_minmax","EXT_frag_depth","WEBGL_depth_texture","EXT_shader_texture_lod","OES_standard_derivatives","OES_texture_float","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float_linear","OES_vertex_array_object","WEBGL_draw_buffers","OES_fbo_render_mipmap","ANGLE_instanced_arrays"],i=s._instance.getWebGLExtensions(),r=function(){},n=0,a=t.length;n<a;n++)i[t[n]]=r},isWebGL2:function(){return this._isGL2},initBugDB:function(){var e=this._webGLPlatforms,t=this._webGLParameters;e.Apple&&(t.UNMASKED_VENDOR_WEBGL&&-1===t.UNMASKED_VENDOR_WEBGL.indexOf("Intel")||(this._bugsDB.OES_standard_derivatives=!0))},initPlatformSupport:function(){var e=this._webGLPlatforms;e.Apple=-1!==navigator.vendor.indexOf("Apple")||-1!==navigator.vendor.indexOf("OS X"),e.Mobile=/Mobi/.test(navigator.userAgent)||/ablet/.test(navigator.userAgent)},getWebGLPlatform:function(e){return this._webGLPlatforms[e]},getWebGLPlatforms:function(){return this._webGLPlatforms},getWebGLParameter:function(e){return this._webGLParameters[e]},getWebGLParameters:function(){return this._webGLParameters},getShaderMaxPrecisionFloat:function(){return this._webGLParameters.MAX_SHADER_PRECISION_FLOAT},getShaderMaxPrecisionInt:function(){return this._webGLParameters.MAX_SHADER_PRECISION_INT},checkSupportRTT:function(e,t,i){var r=t+","+i;if(this._isGL2)return!!this._webGLExtensions.EXT_color_buffer_float;if(void 0!==this._checkRTT[r])return this._checkRTT[r];if(!e)return!1;var n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,2,2,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var o=this._checkRTT[r]=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.deleteTexture(n),e.deleteFramebuffer(a),e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),o},hasLinearHalfFloatRTT:function(e){return this._webGLExtensions.OES_texture_half_float_linear&&this.checkSupportRTT(e,r.HALF_FLOAT_OES,r.LINEAR)},hasLinearFloatRTT:function(e){return this._webGLExtensions.OES_texture_float_linear&&this.checkSupportRTT(e,r.FLOAT,r.LINEAR)},hasHalfFloatRTT:function(e){return this._webGLExtensions.OES_texture_half_float&&this.checkSupportRTT(e,r.HALF_FLOAT_OES,r.NEAREST)},hasFloatRTT:function(e){return this._webGLExtensions.OES_texture_float&&this.checkSupportRTT(e,r.FLOAT,r.NEAREST)},queryPrecision:function(e,t,i){var r=e.getShaderPrecisionFormat(t,i);return!!r&&0!==r.precision},hasVAO:function(){return!!this._webGLExtensions.OES_vertex_array_object},getDisjointTimerQuery:function(){return this._webGLExtensions.EXT_disjoint_timer_query_webgl2||this._webGLExtensions.EXT_disjoint_timer_query},initWebGLParameters:function(e){if(e){for(var t=["MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","MAX_VIEWPORT_DIMS","SHADING_LANGUAGE_VERSION","VERSION","VENDOR","RENDERER","ALIASED_LINE_WIDTH_RANGE","ALIASED_POINT_SIZE_RANGE","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],i=this._webGLParameters,r=0,n=t.length;r<n;++r){var a=t[r];i[a]=e.getParameter(e[a])}this.queryPrecision(e,e.FRAGMENT_SHADER,e.HIGH_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="high":this.queryPrecision(e,e.FRAGMENT_SHADER,e.MEDIUM_FLOAT)?i.MAX_SHADER_PRECISION_FLOAT="medium":this.queryPrecision(e,e.FRAGMENT_SHADER,e.LOW_FLOAT)&&(i.MAX_SHADER_PRECISION_FLOAT="low"),this.queryPrecision(e,e.FRAGMENT_SHADER,e.HIGH_INT)?i.MAX_SHADER_PRECISION_INT="high":this.queryPrecision(e,e.FRAGMENT_SHADER,e.MEDIUM_INT)?i.MAX_SHADER_PRECISION_INT="medium":this.queryPrecision(e,e.FRAGMENT_SHADER,e.LOW_INT)&&(i.MAX_SHADER_PRECISION_INT="low");var o=e.getExtension("WEBGL_debug_renderer_info");o&&(i.UNMASKED_RENDERER_WEBGL=e.getParameter(o.UNMASKED_VENDOR_WEBGL),i.UNMASKED_VENDOR_WEBGL=e.getParameter(o.UNMASKED_RENDERER_WEBGL))}},applyExtension:function(e,t){var i=e.getExtension(t),r=t.split("_")[0],n="_"+r,a=new RegExp(r+"$"),o=new RegExp(n);for(var s in i){if("function"==typeof i[s]){var u=s.replace(a,"");s.substring&&(e[u]=i[s].bind(i))}else{var l=s.replace(o,"");void 0===e[l]&&(e[l]=i[s])}}},getWebGLExtension:function(e){return this._webGLExtensions[e]},getWebGLExtensions:function(){return this._webGLExtensions},initWebGLExtensions:function(e,t){if(e){var i=t;void 0===i&&(i=!0);for(var n=e.getSupportedExtensions(),a=this._webGLExtensions,o=0,s=n.length;o<s;++o){var u=n[o];i&&this._bugsDB[u]||(a[u]=e.getExtension(u),this._isGL2||this.applyExtension(e,u))}var l=this.getWebGLExtension("EXT_texture_filter_anisotropic");l&&(r.ANISOTROPIC_SUPPORT_EXT=!0,r.ANISOTROPIC_SUPPORT_MAX=e.getParameter(l.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}}},e.exports=s},function(e,t,i){"use strict";var r=i(30),n=0,a=function(){this._name="AbstractNode",this._inputs=[],this._outputs=null,this._id=n++,this._text=void 0};a.prototype={getID:function(){return this._id},getName:function(){return this._name},getType:function(){return this.type},toString:function(){var e="name : "+this._name;return this.type&&(e+=" ("+this.type+")"),e},getInputs:function(){return this._inputs},getOutputs:function(){return this._outputs},checkInputsOutputs:function(){var e,t;if(this.validInputs)for(e=0;e<this.validInputs.length;e++)if(t=this.validInputs[e],!this._inputs[t])return r.error("Shader node "+this.type+" validation error input "+t+" is missing"),!1;if(this.validOutputs)for(e=0;e<this.validOutputs.length;e++)if(t=this.validOutputs[e],!this._outputs[t])return r.error("Shader node "+this.type+" validation error output "+t+" is missing"),!1;return!0},inputs:function(){for(var e=0,t=arguments.length;e<t;e++){var i=arguments[e];if(!i){r.error("Shader node "+this.type+" input number "+t+" is undefined ");break}if(Array.isArray(i))return this.inputs.apply(this,i),this;if("object"==typeof i&&null!==i&&i instanceof a==!1)return this._inputs=i,this;this._inputs.push(i)}return this},outputs:function(e){if(this._outputs=e,this._outputs instanceof a==!0)this.autoLink(this._outputs);else for(var t in this._outputs)this.autoLink(this._outputs[t]);return this},autoLink:function(e){return void 0===e?this:(e.inputs(this),this)},computeShader:function(){return this._text},comment:function(e){this._comment="//"+e},getComment:function(){return this._comment}},e.exports=a},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(10)),a=i.n(n),o={while:function(e,t){return new a.a(function(i,r){var n=function(o){return e()?a.a.cast(t()).then(n).catch(r):i(o)};setTimeout(n,0)}).cancellable()},retry:function(e,t,n){var s=i.i(r.extend)({interval:1e3},n);return t().catch(function(i){return e>0?a.a.delay(s.interval).then(function(){return o.retry(e-1,t)}):a.a.reject(i)})}};t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(156),a=r.a.osg,o=function(){a.StateAttribute.call(this),this._channelMapping={},this._materialModel=void 0,this._additive=!1,this._opaqueEarlyZ=!0,this._hashes=["",""],this._dirtyUniforms=!0,this._activeChannels=[]};o.SHADING_COMPILER=0,o.EARLYZ_COMPILER=1,o.WIREFRAME_COMPILER=2,o.CURRENT_COMPILER=o.SHADING_COMPILER;var s=[];s[o.SHADING_COMPILER]=n.a,s[o.EARLYZ_COMPILER]=["Opacity","Displacement"],s[o.WIREFRAME_COMPILER]=["Displacement"],o.hasVertexColor=!1,o.hasVertexAlpha=!1,a.createPrototypeStateAttribute(o,a.objectInherit(a.StateAttribute.prototype,{attributeType:"SketchfabMaterial",dirtyMaterial:function(){for(var e=this._hashes.length,t=0;t<e;++t)this._hashes[t]="";this._dirtyUniforms=!0},getHash:function(){if(!this._materialModel)return"";var e=this._hashes[o.CURRENT_COMPILER];if(e)return e;e=this.attributeType,o.CURRENT_COMPILER!==o.WIREFRAME_COMPILER&&(e+=this.getVertexAlphaEnable()?"1":"0"),o.CURRENT_COMPILER===o.SHADING_COMPILER&&(e+=(this.getShadeless()?"1":"0")+(this.getVertexColorEnable()?"1":"0")+(this.getHasOnlyPoints()?"1":"0")+("srgb"===this.getVertexColorColorSpace()?"1":"0"));for(var t=this._materialModel.getChannels(),i=s[o.CURRENT_COMPILER],r=i.length,n=this._channelMapping,a=0;a<r;++a){var u=i[a],l=t[u];if(l.isEnableEffective()){var c=n[u];e+="."+(c<0?"":c)+l.getShaderHash()}else e+=".0"}return this._hashes[o.CURRENT_COMPILER]=e,e},setMaterialModel:function(e){this._materialModel=e},setChannelMapping:function(e,t){this._channelMapping[e]=t},updateOpacity:function(){var e=this._materialModel.getChannels().Opacity,t=e.getTransparency(),i=e.isEffective(),r="additive"===t,n="alphaBlend"===t,a="alphaMask"===t,o="dithering"===t;this._additive=i&&r,this._opaqueEarlyZ=!i||a||o,!this._opaqueEarlyZ&&n&&1===e.getFactor()&&(this._opaqueEarlyZ=!!e.getTextureModel()||e.get("vertexAlphaEnable"))},cloneType:function(){return new o},getType:function(){return this.attributeType},getTypeMember:function(){return this.attributeType},getMaterialModel:function(){return this._materialModel},getShadeless:function(){return this._materialModel&&this._materialModel.get("shadeless")},getReflection:function(){return this._materialModel&&this._materialModel.get("reflection")},getVertexColorEnable:function(){return this._materialModel&&this._materialModel.get("vertexColorEnable")},getVertexAlphaEnable:function(){return this._materialModel&&this._materialModel.get("vertexAlphaEnable")},getVertexColorColorSpace:function(){return this._materialModel&&this._materialModel.get("vertexColorColorSpace")},getCullFace:function(){return this._materialModel&&this._materialModel.get("cullFace")},getHasOnlyPoints:function(){return this._materialModel&&this._materialModel.hasOnlyPoints()},getAdditive:function(){return this._additive},getOpaqueEarlyZ:function(){return this._opaqueEarlyZ},getChannelMapping:function(e){return this._channelMapping[e]},getOrCreateUniforms:function(){if(o.uniforms)return o.uniforms;var e=o.uniforms={};e.uReflection=a.Uniform.createFloat("uReflection");for(var t=i(598).default,r=n.a.length,s=0;s<r;++s){var u=n.a[s],l=t[u].model;l.prototype.addUniforms.call(l,e,u)}return e},_cacheChannelUniforms:function(){var e=this.getOrCreateUniforms(),t=this._materialModel.getChannels(),i=n.a.length,r=this._activeChannels;r.length=0;for(var a=0;a<i;++a){var o=t[n.a[a]];o.isEnableEffective()&&(o.cacheUniforms(e),r.push(o))}},apply:function(){if(this._materialModel){this._dirtyUniforms&&(this._dirtyUniforms=!1,this._cacheChannelUniforms());this.getOrCreateUniforms().uReflection.setFloat(this.getReflection());for(var e=this._activeChannels,t=e.length,i=0;i<t;++i)e[i].updateUniforms()}}}),"osgSketchfab","Material"),t.a=o},function(e,t,i){"use strict";var r=function(e,t,i){return!!Number.isInteger(e)&&(!(void 0!==t&&e<t)&&!(void 0!==i&&e>i))},n=function(e,t,i){return!("number"!=typeof e||isNaN(e)||!isFinite(e))&&(!(void 0!==t&&e<t)&&!(void 0!==i&&e>i))},a=function(e,t,i,r){if(void 0===e.length)return!1;if(e.length!==t)return!1;for(var a=0;a<t;a++)if(!n(e[a],i,r))return!1;return!0},o=function(e,t,i,n){if(void 0===e.length)return!1;if(e.length!==t)return!1;for(var a=0;a<t;a++)if(!r(e[a],i,n))return!1;return!0},s=function(e){return"boolean"==typeof e},u=function(e){return"string"==typeof e},l=function(e,t){return!!Array.isArray(e)&&e.length===t},c=function(e,t){return-1!==t.indexOf(e)&&u(e)},h=function(e,t){return-1!==t.indexOf(e)&&r(e)};t.a={isInteger:r,isNumber:n,isArrayNumber:a,isArrayInteger:o,isBoolean:s,isString:u,isArray:l,isEnumString:c,isEnumInteger:h}},function(e,t,i){var r;/*! Hammer.JS - v2.0.4 - 2015-03-02
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2015 Jorik Tangelder;
 * Licensed under the MIT license */
    !function(n,a,o,s){"use strict";function u(e,t,i){return setTimeout(f(e,i),t)}function l(e,t,i){return!!Array.isArray(e)&&(c(e,i[t],i),!0)}function c(e,t,i){var r;if(e)if(e.forEach)e.forEach(t,i);else if(e.length!==s)for(r=0;r<e.length;)t.call(i,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(i,e[r],r,e)}function h(e,t,i){for(var r=Object.keys(t),n=0;n<r.length;)(!i||i&&e[r[n]]===s)&&(e[r[n]]=t[r[n]]),n++;return e}function d(e,t){return h(e,t,!0)}function p(e,t,i){var r,n=t.prototype;r=e.prototype=Object.create(n),r.constructor=e,r._super=n,i&&h(r,i)}function f(e,t){return function(){return e.apply(t,arguments)}}function g(e,t){return typeof e==fe?e.apply(t?t[0]||s:s,t):e}function m(e,t){return e===s?t:e}function v(e,t,i){c(S(t),function(t){e.addEventListener(t,i,!1)})}function _(e,t,i){c(S(t),function(t){e.removeEventListener(t,i,!1)})}function b(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function x(e,t){return e.indexOf(t)>-1}function S(e){return e.trim().split(/\s+/g)}function y(e,t,i){if(e.indexOf&&!i)return e.indexOf(t);for(var r=0;r<e.length;){if(i&&e[r][i]==t||!i&&e[r]===t)return r;r++}return-1}function C(e){return Array.prototype.slice.call(e,0)}function T(e,t,i){for(var r=[],n=[],a=0;a<e.length;){var o=t?e[a][t]:e[a];y(n,o)<0&&r.push(e[a]),n[a]=o,a++}return i&&(r=t?r.sort(function(e,i){return e[t]>i[t]}):r.sort()),r}function M(e,t){for(var i,r,n=t[0].toUpperCase()+t.slice(1),a=0;a<de.length;){if(i=de[a],(r=i?i+n:t)in e)return r;a++}return s}function w(){return _e++}function A(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||n}function E(e,t){var i=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){g(e.options.enable,[e])&&i.handler(t)},this.init()}function P(e){var t=e.options.inputClass;return new(t||(Se?j:ye?q:xe?X:z))(e,N)}function N(e,t,i){var r=i.pointers.length,n=i.changedPointers.length,a=t&Te&&r-n==0,o=t&(we|Ae)&&r-n==0;i.isFirst=!!a,i.isFinal=!!o,a&&(e.session={}),i.eventType=t,F(e,i),e.emit("hammer.input",i),e.recognize(i),e.session.prevInput=i}function F(e,t){var i=e.session,r=t.pointers,n=r.length;i.firstInput||(i.firstInput=O(t)),n>1&&!i.firstMultiple?i.firstMultiple=O(t):1===n&&(i.firstMultiple=!1);var a=i.firstInput,o=i.firstMultiple,s=o?o.center:a.center,u=t.center=L(r);t.timeStamp=ve(),t.deltaTime=t.timeStamp-a.timeStamp,t.angle=V(s,u),t.distance=B(s,u),R(i,t),t.offsetDirection=k(t.deltaX,t.deltaY),t.scale=o?G(o.pointers,r):1,t.rotation=o?U(o.pointers,r):0,I(i,t);var l=e.element;b(t.srcEvent.target,l)&&(l=t.srcEvent.target),t.target=l}function R(e,t){var i=t.center,r=e.offsetDelta||{},n=e.prevDelta||{},a=e.prevInput||{};t.eventType!==Te&&a.eventType!==we||(n=e.prevDelta={x:a.deltaX||0,y:a.deltaY||0},r=e.offsetDelta={x:i.x,y:i.y}),t.deltaX=n.x+(i.x-r.x),t.deltaY=n.y+(i.y-r.y)}function I(e,t){var i,r,n,a,o=e.lastInterval||t,u=t.timeStamp-o.timeStamp;if(t.eventType!=Ae&&(u>Ce||o.velocity===s)){var l=o.deltaX-t.deltaX,c=o.deltaY-t.deltaY,h=D(u,l,c);r=h.x,n=h.y,i=me(h.x)>me(h.y)?h.x:h.y,a=k(l,c),e.lastInterval=t}else i=o.velocity,r=o.velocityX,n=o.velocityY,a=o.direction;t.velocity=i,t.velocityX=r,t.velocityY=n,t.direction=a}function O(e){for(var t=[],i=0;i<e.pointers.length;)t[i]={clientX:ge(e.pointers[i].clientX),clientY:ge(e.pointers[i].clientY)},i++;return{timeStamp:ve(),pointers:t,center:L(t),deltaX:e.deltaX,deltaY:e.deltaY}}function L(e){var t=e.length;if(1===t)return{x:ge(e[0].clientX),y:ge(e[0].clientY)};for(var i=0,r=0,n=0;n<t;)i+=e[n].clientX,r+=e[n].clientY,n++;return{x:ge(i/t),y:ge(r/t)}}function D(e,t,i){return{x:t/e||0,y:i/e||0}}function k(e,t){return e===t?Ee:me(e)>=me(t)?e>0?Pe:Ne:t>0?Fe:Re}function B(e,t,i){i||(i=De);var r=t[i[0]]-e[i[0]],n=t[i[1]]-e[i[1]];return Math.sqrt(r*r+n*n)}function V(e,t,i){i||(i=De);var r=t[i[0]]-e[i[0]],n=t[i[1]]-e[i[1]];return 180*Math.atan2(n,r)/Math.PI}function U(e,t){return V(t[1],t[0],ke)-V(e[1],e[0],ke)}function G(e,t){return B(t[0],t[1],ke)/B(e[0],e[1],ke)}function z(){this.evEl=Ve,this.evWin=Ue,this.allow=!0,this.pressed=!1,E.apply(this,arguments)}function j(){this.evEl=je,this.evWin=He,E.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function H(){this.evTarget=qe,this.evWin=Ye,this.started=!1,E.apply(this,arguments)}function W(e,t){var i=C(e.touches),r=C(e.changedTouches);return t&(we|Ae)&&(i=T(i.concat(r),"identifier",!0)),[i,r]}function q(){this.evTarget=Ke,this.targetIds={},E.apply(this,arguments)}function Y(e,t){var i=C(e.touches),r=this.targetIds;if(t&(Te|Me)&&1===i.length)return r[i[0].identifier]=!0,[i,i];var n,a,o=C(e.changedTouches),s=[],u=this.target;if(a=i.filter(function(e){return b(e.target,u)}),t===Te)for(n=0;n<a.length;)r[a[n].identifier]=!0,n++;for(n=0;n<o.length;)r[o[n].identifier]&&s.push(o[n]),t&(we|Ae)&&delete r[o[n].identifier],n++;return s.length?[T(a.concat(s),"identifier",!0),s]:void 0}function X(){E.apply(this,arguments);var e=f(this.handler,this);this.touch=new q(this.manager,e),this.mouse=new z(this.manager,e)}function K(e,t){this.manager=e,this.set(t)}function J(e){if(x(e,et))return et;var t=x(e,tt),i=x(e,it);return t&&i?tt+" "+it:t||i?t?tt:it:x(e,$e)?$e:Ze}function Q(e){this.id=w(),this.manager=null,this.options=d(e||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=rt,this.simultaneous={},this.requireFail=[]}function Z(e){return e&ut?"cancel":e&ot?"end":e&at?"move":e&nt?"start":""}function $(e){return e==Re?"down":e==Fe?"up":e==Pe?"left":e==Ne?"right":""}function ee(e,t){var i=t.manager;return i?i.get(e):e}function te(){Q.apply(this,arguments)}function ie(){te.apply(this,arguments),this.pX=null,this.pY=null}function re(){te.apply(this,arguments)}function ne(){Q.apply(this,arguments),this._timer=null,this._input=null}function ae(){te.apply(this,arguments)}function oe(){te.apply(this,arguments)}function se(){Q.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ue(e,t){return t=t||{},t.recognizers=m(t.recognizers,ue.defaults.preset),new le(e,t)}function le(e,t){t=t||{},this.options=d(t,ue.defaults),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.element=e,this.input=P(this),this.touchAction=new K(this,this.options.touchAction),ce(this,!0),c(t.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function ce(e,t){var i=e.element;i.style&&c(e.options.cssProps,function(e,r){i.style[M(i.style,r)]=t?e:""})}function he(e,t){var i=a.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t,t.target.dispatchEvent(i)}var de=["","webkit","moz","MS","ms","o"],pe=a.createElement("div"),fe="function",ge=Math.round,me=Math.abs,ve=Date.now,_e=1,be=/mobile|tablet|ip(ad|hone|od)|android/i,xe="ontouchstart"in n,Se=M(n,"PointerEvent")!==s,ye=xe&&be.test(navigator.userAgent),Ce=25,Te=1,Me=2,we=4,Ae=8,Ee=1,Pe=2,Ne=4,Fe=8,Re=16,Ie=Pe|Ne,Oe=Fe|Re,Le=Ie|Oe,De=["x","y"],ke=["clientX","clientY"];E.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(A(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&_(this.element,this.evEl,this.domHandler),this.evTarget&&_(this.target,this.evTarget,this.domHandler),this.evWin&&_(A(this.element),this.evWin,this.domHandler)}};var Be={mousedown:Te,mousemove:Me,mouseup:we},Ve="mousedown",Ue="mousemove mouseup";p(z,E,{handler:function(e){var t=Be[e.type];t&Te&&0===e.button&&(this.pressed=!0),t&Me&&1!==e.which&&(t=we),this.pressed&&this.allow&&(t&we&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var Ge={pointerdown:Te,pointermove:Me,pointerup:we,pointercancel:Ae,pointerout:Ae},ze={2:"touch",3:"pen",4:"mouse",5:"kinect"},je="pointerdown",He="pointermove pointerup pointercancel";n.MSPointerEvent&&!n.PointerEvent&&(je="MSPointerDown",He="MSPointerMove MSPointerUp MSPointerCancel"),p(j,E,{handler:function(e){var t=this.store,i=!1,r=e.type.toLowerCase().replace("ms",""),n=Ge[r],a=ze[e.pointerType]||e.pointerType,o="touch"==a,s=y(t,e.pointerId,"pointerId");n&Te&&(0===e.button||o)?s<0&&(t.push(e),s=t.length-1):n&(we|Ae)&&(i=!0),s<0||(t[s]=e,this.callback(this.manager,n,{pointers:t,changedPointers:[e],pointerType:a,srcEvent:e}),i&&t.splice(s,1))}});var We={touchstart:Te,touchmove:Me,touchend:we,touchcancel:Ae},qe="touchstart",Ye="touchstart touchmove touchend touchcancel";p(H,E,{handler:function(e){var t=We[e.type];if(t===Te&&(this.started=!0),this.started){var i=W.call(this,e,t);t&(we|Ae)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:e})}}});var Xe={touchstart:Te,touchmove:Me,touchend:we,touchcancel:Ae},Ke="touchstart touchmove touchend touchcancel";p(q,E,{handler:function(e){var t=Xe[e.type],i=Y.call(this,e,t);i&&this.callback(this.manager,t,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:e})}}),p(X,E,{handler:function(e,t,i){var r="touch"==i.pointerType,n="mouse"==i.pointerType;if(r)this.mouse.allow=!1;else if(n&&!this.mouse.allow)return;t&(we|Ae)&&(this.mouse.allow=!0),this.callback(e,t,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Je=M(pe.style,"touchAction"),Qe=Je!==s,Ze="auto",$e="manipulation",et="none",tt="pan-x",it="pan-y";K.prototype={set:function(e){"compute"==e&&(e=this.compute()),Qe&&this.manager.element.style&&(this.manager.element.style[Je]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return c(this.manager.recognizers,function(t){g(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),J(e.join(" "))},preventDefaults:function(e){if(!Qe){var t=e.srcEvent,i=e.offsetDirection;if(this.manager.session.prevented)return void t.preventDefault();var r=this.actions,n=x(r,et),a=x(r,it),o=x(r,tt);return n||a&&i&Ie||o&&i&Oe?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var rt=1,nt=2,at=4,ot=8,st=ot,ut=16;Q.prototype={defaults:{},set:function(e){return h(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(l(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=ee(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return l(e,"dropRecognizeWith",this)?this:(e=ee(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(l(e,"requireFailure",this))return this;var t=this.requireFail;return e=ee(e,this),-1===y(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(l(e,"dropRequireFailure",this))return this;e=ee(e,this);var t=y(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){i.manager.emit(i.options.event+(t?Z(r):""),e)}var i=this,r=this.state;r<ot&&t(!0),t(),r>=ot&&t(!0)},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|rt)))return!1;e++}return!0},recognize:function(e){var t=h({},e);if(!g(this.options.enable,[this,t]))return this.reset(),void(this.state=32);this.state&(st|ut|32)&&(this.state=rt),this.state=this.process(t),this.state&(nt|at|ot|ut)&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},p(te,Q,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,i=e.eventType,r=t&(nt|at),n=this.attrTest(e);return r&&(i&Ae||!n)?t|ut:r||n?i&we?t|ot:t&nt?t|at:nt:32}}),p(ie,te,{defaults:{event:"pan",threshold:10,pointers:1,direction:Le},getTouchAction:function(){var e=this.options.direction,t=[];return e&Ie&&t.push(it),e&Oe&&t.push(tt),t},directionTest:function(e){var t=this.options,i=!0,r=e.distance,n=e.direction,a=e.deltaX,o=e.deltaY;return n&t.direction||(t.direction&Ie?(n=0===a?Ee:a<0?Pe:Ne,i=a!=this.pX,r=Math.abs(e.deltaX)):(n=0===o?Ee:o<0?Fe:Re,i=o!=this.pY,r=Math.abs(e.deltaY))),e.direction=n,i&&r>t.threshold&&n&t.direction},attrTest:function(e){return te.prototype.attrTest.call(this,e)&&(this.state&nt||!(this.state&nt)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=$(e.direction);t&&this.manager.emit(this.options.event+t,e),this._super.emit.call(this,e)}}),p(re,te,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[et]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&nt)},emit:function(e){if(this._super.emit.call(this,e),1!==e.scale){var t=e.scale<1?"in":"out";this.manager.emit(this.options.event+t,e)}}}),p(ne,Q,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[Ze]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime>t.time;if(this._input=e,!r||!i||e.eventType&(we|Ae)&&!n)this.reset();else if(e.eventType&Te)this.reset(),this._timer=u(function(){this.state=st,this.tryEmit()},t.time,this);else if(e.eventType&we)return st;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===st&&(e&&e.eventType&we?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=ve(),this.manager.emit(this.options.event,this._input)))}}),p(ae,te,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[et]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&nt)}}),p(oe,te,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ie|Oe,pointers:1},getTouchAction:function(){return ie.prototype.getTouchAction.call(this)},attrTest:function(e){var t,i=this.options.direction;return i&(Ie|Oe)?t=e.velocity:i&Ie?t=e.velocityX:i&Oe&&(t=e.velocityY),this._super.attrTest.call(this,e)&&i&e.direction&&e.distance>this.options.threshold&&me(t)>this.options.velocity&&e.eventType&we},emit:function(e){var t=$(e.direction);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),p(se,Q,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[$e]},process:function(e){var t=this.options,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime<t.time;if(this.reset(),e.eventType&Te&&0===this.count)return this.failTimeout();if(r&&n&&i){if(e.eventType!=we)return this.failTimeout();var a=!this.pTime||e.timeStamp-this.pTime<t.interval,o=!this.pCenter||B(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,o&&a?this.count+=1:this.count=1,this._input=e;if(0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=u(function(){this.state=st,this.tryEmit()},t.interval,this),nt):st}return 32},failTimeout:function(){return this._timer=u(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==st&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ue.VERSION="2.0.4",ue.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[ae,{enable:!1}],[re,{enable:!1},["rotate"]],[oe,{direction:Ie}],[ie,{direction:Ie},["swipe"]],[se],[se,{event:"doubletap",taps:2},["tap"]],[ne]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};le.prototype={set:function(e){return h(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var i,r=this.recognizers,n=t.curRecognizer;(!n||n&&n.state&st)&&(n=t.curRecognizer=null);for(var a=0;a<r.length;)i=r[a],2===t.stopped||n&&i!=n&&!i.canRecognizeWith(n)?i.reset():i.recognize(e),!n&&i.state&(nt|at|ot)&&(n=t.curRecognizer=i),a++}},get:function(e){if(e instanceof Q)return e;for(var t=this.recognizers,i=0;i<t.length;i++)if(t[i].options.event==e)return t[i];return null},add:function(e){if(l(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(l(e,"remove",this))return this;var t=this.recognizers;return e=this.get(e),t.splice(y(t,e),1),this.touchAction.update(),this},on:function(e,t){var i=this.handlers;return c(S(e),function(e){i[e]=i[e]||[],i[e].push(t)}),this},off:function(e,t){var i=this.handlers;return c(S(e),function(e){t?i[e].splice(y(i[e],t),1):delete i[e]}),this},emit:function(e,t){this.options.domEvents&&he(e,t);var i=this.handlers[e]&&this.handlers[e].slice();if(i&&i.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<i.length;)i[r](t),r++}},destroy:function(){this.element&&ce(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h(ue,{INPUT_START:Te,INPUT_MOVE:Me,INPUT_END:we,INPUT_CANCEL:Ae,STATE_POSSIBLE:rt,STATE_BEGAN:nt,STATE_CHANGED:at,STATE_ENDED:ot,STATE_RECOGNIZED:st,STATE_CANCELLED:ut,STATE_FAILED:32,DIRECTION_NONE:Ee,DIRECTION_LEFT:Pe,DIRECTION_RIGHT:Ne,DIRECTION_UP:Fe,DIRECTION_DOWN:Re,DIRECTION_HORIZONTAL:Ie,DIRECTION_VERTICAL:Oe,DIRECTION_ALL:Le,Manager:le,Input:E,TouchAction:K,TouchInput:q,MouseInput:z,PointerEventInput:j,TouchMouseInput:X,SingleTouchInput:H,Recognizer:Q,AttrRecognizer:te,Tap:se,Pan:ie,Swipe:oe,Pinch:re,Rotate:ae,Press:ne,on:v,off:_,each:c,merge:d,extend:h,inherit:p,bindFn:f,prefixed:M}),"function"==fe&&i(470)?(r=function(){return ue}.call(t,i,t,e))!==s&&(e.exports=r):void 0!==e&&e.exports?e.exports=ue:n.Hammer=ue}(window,document)},,,,,,,,function(e,t,i){"use strict";var r=i(15),n=new r.a;n.PBR_LIT=1,n.CLASSIC_LIT=2,n.PBR_SHADELESS=4,n.CLASSIC_SHADELESS=8,n.MATCAP=16,n.nameMatch={"pbr-shadeless":n.PBR_SHADELESS,"classic-shadeless":n.CLASSIC_SHADELESS,"pbr-lit":n.PBR_LIT,"shading-vr":n.PBR_LIT,"classic-lit":n.CLASSIC_LIT},n.LIT=n.PBR_LIT|n.CLASSIC_LIT,n.SHADELESS=n.PBR_SHADELESS|n.CLASSIC_SHADELESS,n.PBR=n.PBR_LIT|n.PBR_SHADELESS,n.CLASSIC=n.CLASSIC_LIT|n.CLASSIC_SHADELESS,n.set("mask",n.PBR_LIT),n.on("change:mask",function(){var e=n.get("mask");switch(e){case n.PBR_LIT:case n.CLASSIC_LIT:case n.PBR_SHADELESS:case n.CLASSIC_SHADELESS:case n.MATCAP:break;default:console.error("Invalid ShadingGlobal mask value !"+e)}}),t.a=n},,function(e,t){!function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/popovers.jinja"]=function(){function e(e,t,i,r,n){var a="";try{var o=null,s=r.makeMacro([],["options"],function(n){var a=i;i=new r.Frame,n=n||{},n.hasOwnProperty("caller")&&i.set("caller",n.caller),i.set("options",n.hasOwnProperty("options")?n.options:{});var o="";return o+='\n\n    <div class="popover share-popover hidden',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"class")&&(o+=" ",o+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"class"),e.opts.autoescape)),o+='">\n        <p>Thanks! Also share?</p>\n\n        <a data-action="share-on-facebook" class="share-popover-icon icons-facebook"></a>\n        <a data-action="share-on-twitter" class="share-popover-icon icons-twitter"></a>\n        <a data-action="share-on-google-plus" class="share-popover-icon icons-google"></a>\n        <a data-action="share-on-pinterest" class="share-popover-icon icons-pinterest"></a>\n    </div>\n\n',i=a,new r.SafeString(o)});t.addExport("share_popover"),t.setVariable("share_popover",s),a+="\n",o?o.rootRenderFunc(e,t,i,r,n):n(null,a)}catch(e){n(r.handleError(e,null,null))}}return{root:e}}()}()},,,,,function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(23);t.a={isMaintenance:function(){return n()('meta[property="skfb:maintenance"]').attr("content")},showPopup:function(){var e=this.isMaintenance(),t=new a.default({title:e?"Maintenance":"Error",text:e?'Sketchfab is undergoing maintenance.<br>See: <a href="https://forum.sketchfab.com/t/sketchfab-operations/6678" target=_blank>Operations forum post</a>':"An unknown error occurred. Please try again later. If the error persists, please contact support@sketchfab.com",buttons:{ok:!0},safe:!0});return t.open().then(function(){t.close()}),t}}},,,,,,,,,,function(e,t,i){"use strict";var r=i(14),n=i(8).vec3,a=i(8).mat4,o=function(){this._min=n.create(),this._max=n.create(),this.init()};r.createPrototypeObject(o,{init:function(){n.copy(this._min,n.INFINITY),n.copy(this._max,n.NEGATIVE_INFINITY)},copy:function(e){var t=this._min,i=e._min;t[0]=i[0],t[1]=i[1],t[2]=i[2];var r=this._max,n=e._max;r[0]=n[0],r[1]=n[1],r[2]=n[2]},valid:function(){return this._max[0]>=this._min[0]&&this._max[1]>=this._min[1]&&this._max[2]>=this._min[2]},expandByBoundingSphere:function(e){if(e.valid()){var t=this._max,i=this._min,r=e._radius,n=e._center[0],a=e._center[1],o=e._center[2];i[0]=Math.min(i[0],n-r),i[1]=Math.min(i[1],a-r),i[2]=Math.min(i[2],o-r),t[0]=Math.max(t[0],n+r),t[1]=Math.max(t[1],a+r),t[2]=Math.max(t[2],o+r)}},expandByvec3:function(e){var t=this._min,i=this._max;t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),i[0]=Math.max(i[0],e[0]),i[1]=Math.max(i[1],e[1]),i[2]=Math.max(i[2],e[2])},expandByBoundingBox:function(e){if(e.valid()){var t=this._min,i=this._max,r=e._min,n=e._max;r[0]<t[0]&&(t[0]=r[0]),n[0]>i[0]&&(i[0]=n[0]),r[1]<t[1]&&(t[1]=r[1]),n[1]>i[1]&&(i[1]=n[1]),r[2]<t[2]&&(t[2]=r[2]),n[2]>i[2]&&(i[2]=n[2])}},center:function(e){var t=this._min,i=this._max;return e[0]=.5*(t[0]+i[0]),e[1]=.5*(t[1]+i[1]),e[2]=.5*(t[2]+i[2]),e},radius:function(){return Math.sqrt(this.radius2())},radius2:function(){var e=this._min,t=this._max,i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return.25*(i*i+r*r+n*n)},getMin:function(){return this._min},getMax:function(){return this._max},setMin:function(e){return n.copy(this._min,e),this},setMax:function(e){return n.copy(this._max,e),this},xMax:function(){return this._max[0]},yMax:function(){return this._max[1]},zMax:function(){return this._max[2]},xMin:function(){return this._min[0]},yMin:function(){return this._min[1]},zMin:function(){return this._min[2]},corner:function(e,t){return t[0]=1&e?this._max[0]:this._min[0],t[1]=2&e?this._max[1]:this._min[1],t[2]=4&e?this._max[2]:this._min[2],t},transformMat4:function(){var e=n.create(),t=n.create();return function(i,r){var o=this.getMin(),s=this.getMax();a.getTranslation(e,r),n.copy(t,e);for(var u=0;u<3;++u)for(var l=4*u,c=o[u],h=s[u],d=0;d<3;++d){var p=r[l+d],f=p*h,g=p*c;f<g?(e[d]+=f,t[d]+=g):(e[d]+=g,t[d]+=f)}var m=i.getMax(),v=i.getMin();return m[0]=t[0],m[1]=t[1],m[2]=t[2],v[0]=e[0],v[1]=e[1],v[2]=e[2],i}}()},"osg","BoundingBox"),e.exports=o},function(e,t,i){"use strict";var r=i(8).mat4,n=i(8).quat,a=i(8).vec3,o=i(675),s={};s.InvalidTargetID=-1;var u=function(e,t,i){return{type:e,id:s.InvalidTargetID,channels:[],value:t,defaultValue:i}},l=function(e){return u(o.Quat,n.copy(n.create(),e),n.copy(n.create(),e))},c=function(e){return u(o.Matrix,r.copy(r.create(),e),r.copy(r.create(),e))},h=function(e){return u(o.Vec3,a.copy(a.create(),e),a.copy(a.create(),e))},d=function(e){return u(o.Float,e,e)};s.createQuatTarget=l,s.createVec3Target=h,s.createFloatTarget=d,s.createMatrixTarget=c,e.exports=s},,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=i(29),o=i(803),s=i(802),u=i(541),l=i(599),c=n.a.osg,h=function(e,t){c.NodeVisitor.call(this,c.NodeVisitor.TRAVERSE_ALL_CHILDREN),this._lights=[],this._materials=[],this._materialManager=e,this._stateSetsProcessed={},this._authoringTool=t,this._style="",this._hasMetal=void 0,this._globalEnforceRoughness=void 0,this._dictionary=a.a.channelNames,this._dictionaryKeys=Object.keys(a.a.channelNames)};c.createPrototypeObject(h,c.objectInherit(c.NodeVisitor.prototype,{getStyle:function(){return this._style},hasMetallicWorkflow:function(){return this._hasMetal},getLights:function(){return this._lights},getMaterials:function(){return this._materials},copyDiffuse:function(e){var t=e.getChannels().DiffuseColor,i=e.getChannels().AlbedoPBR,r=e.getChannels().DiffusePBR,n=t.getColor(),a=t.getFactor(),o=t.getTextureModel();n&&(i.setColor(n),r.setColor(n)),i.setFactor(a),r.setFactor(a),o&&(i.setTextureModel(o),r.setTextureModel(o))},matchNameAgainstDict:function(e,t,r){for(var n=i.i(s.a)(e),a=0;a<t.length;a++){var u=t[a],l=i.i(o.a)(n,u);if(l<r&&l<u.length)return!0}return!1},channelTextureExtract:function(e,t){var i=e.getChannels()[t];if(i){var r=i.getTextureModel();if(r)return r.getImageModel().get("name")}},channelTextureMatch:function(e,t,i,r){var n=this.channelTextureExtract(e,t);return n&&this.matchNameAgainstDict(n,i,r)},hasTextureChannel:function(e,t){return void 0!==this.channelTextureExtract(e,t)},channelTextureCopy:function(e,t,i){var r,n=e.getChannels();if(this.channelTextureExtract(e,t))for(var a=i.length;a--;)r=n[i[a]],r.setTextureModel(n[t].getTextureModel().clone())},checkPBRSlot:function(e){if(e)for(var t=0;t<this._dictionaryKeys.length;t++){var i=this._dictionaryKeys[t],r=this._dictionary[i];if(this.matchNameAgainstDict(e,r,a.a.maxLevenshteinDistance))return i}},assignPBRTextureFromFilenames:function(e,t){e.forEach(function(e){var i=e.getName(),r=this.checkPBRSlot(i);if(void 0===r&&e.getImage()&&(i=e.getImage().getURL(),r=this.checkPBRSlot(i)),void 0!==r){var n,a=t.getChannels();n=a[r],void 0===n.getTextureModel()&&n.setTextureModel(this.createTextureModelFromTextureOSG(e))}},this)},checkChannelsAndSetWorkFlowRoughGloss:function(e){if(e){var t=e.getChannels(),i=this.hasTextureChannel(e,"GlossinessPBR"),r=this.hasTextureChannel(e,"SpecularPBR"),n=this.hasTextureChannel(e,"RoughnessPBR");this.hasTextureChannel(e,"BumpMap")&&t.BumpMap.setFactor(10),this.hasTextureChannel(e,"MetalnessPBR")&&(this._hasMetal=!0),r&&(t.SpecularPBR.setFactor(1),void 0===this._hasMetal&&(this._hasMetal=!1)),e.setWorkFlowRoughGloss(n||this._globalEnforceRoughness||!n&&!i&&void 0===this._globalEnforceRoughness,!1)}},setChannelsFromImagesNames:function(e,t,i){for(var r=0,n=t.length;r<n;r++)for(var o=0,s=i.length;o<s;o++){var l=i[o].get("name");if(this.matchNameAgainstDict(l,this._dictionary[t[r]],a.a.maxLevenshteinDistance)){var c=e.getChannels()[t[r]];c.setTextureModel(new u.a({image:i[o]})),c.setFactor(1),e.setChannelEnable(c.get("name"),!0)}}},setGlossinessPBRFromSpecularGlossiness:function(e,t,i){var r=.2126*t[0]+.7152*t[1]+.0722*t[2],n=Math.pow(1e4*i,.25)/100*r;e.setChannelFactor("GlossinessPBR",n),e.setChannelEnable("GlossinessPBR",!0),this._globalEnforceRoughness=!1},getPBRChannels:function(e){var t=[];return i.i(r.each)(e.getChannels(),function(e,i){-1!==i.indexOf("PBR")&&t.push(i)}),t},checkForPBRTextureFromChannelsAndFilenames:function(e){if(e){for(var t=this.getPBRChannels(e),i=t.length;i--;)if(void 0!==this.channelTextureExtract(e,t[i]))return;this.channelTextureCopy(e,"DiffuseColor",["AlbedoPBR","DiffusePBR"]),this.channelTextureCopy(e,"DiffuseIntensity",["AOPBR"]);var r=this._dictionary;this.channelTextureMatch(e,"SpecularColor",r.MetalnessPBR,2)?this.channelTextureCopy(e,"SpecularColor",["MetalnessPBR"]):this.channelTextureMatch(e,"SpecularHardness",r.MetalnessPBR,2)?this.channelTextureCopy(e,"SpecularHardness",["MetalnessPBR"]):this.channelTextureMatch(e,"SpecularColor",r.SpecularPBR,2)?this.channelTextureCopy(e,"SpecularColor",["SpecularPBR"]):this.channelTextureMatch(e,"SpecularHardness",r.SpecularPBR,2)&&this.channelTextureCopy(e,"SpecularHardness",["SpecularPBR"]),this.channelTextureMatch(e,"SpecularColor",r.RoughnessPBR,2)?this.channelTextureCopy(e,"SpecularColor",["RoughnessPBR"]):this.channelTextureMatch(e,"SpecularHardness",r.RoughnessPBR,2)?this.channelTextureCopy(e,"SpecularHardness",["RoughnessPBR"]):this.channelTextureMatch(e,"SpecularColor",r.GlossinessPBR,2)?this.channelTextureCopy(e,"SpecularColor",["GlossinessPBR"]):this.channelTextureMatch(e,"SpecularHardness",r.GlossinessPBR,2)&&this.channelTextureCopy(e,"SpecularHardness",["GlossinessPBR"])}},checkForPBRTextureFromMaterialAndFilenames:function(e){if(e){var t=[],n=this;i.i(r.each)(e.getChannels(),function(i,r){n.channelTextureExtract(e,r)||t.push(r)});var a=[],o=this._materialManager.getImageCollection().clone();o.comparator=function(e,t){return(e.get("version")||0)-(t.get("version")||0)},o.sort();for(var s=e.get("name").toLowerCase(),u=0;u<o.length;u++)-1!==o.models[u].get("name").toLowerCase().indexOf(s)&&a.push(o.models[u]);this.setChannelsFromImagesNames(e,t,a)}},hasMaterialAttributes:function(e){return e.getAttribute("Material")},hasTextureAttributes:function(e){for(var t=0,i=e.getNumTextureAttributeLists();t<i;t++)if(e.getTextureAttribute(t,"Texture"))return!0;return!1},processDefaultMaterial:function(e,t){t.removeAttribute("Material");for(var i=0,r=t.getNumTextureAttributeLists();i<r;i++)t.removeTextureAttribute(i,"Texture")},convertUserDataToObject:function(e){var t={};return e?(e.forEach(function(e){var i=e.Name,r=e.Value;t[i]=r}),t):t},getMetaData:function(e){if(e&&e.getUserData())return this.convertUserDataToObject(e.getUserData())},getTextureLists:function(e){for(var t=[],i=0;i<e.getNumTextureAttributeLists();i++){var r=e.getTextureAttribute(i,"Texture");void 0!==r&&("PackedMaterialTexture"===r.className()&&(r=r.getTexture()),t[i]=r)}return t},setMaterialChannelTexture:function(e,t,i,r,n){e.removeTextureAttribute(i,"Texture");var a=t.getChannels()[r];a.setTextureModel(n),a.resetTextureFormat(),a.setTexCoordUnit(i),a.setEnable(!0)},createMaterial:function(e,t){var i=this._materialManager.createMaterial(e,t);return this._materials.push(i),i},createTextureModelFromTextureOSG:function(e){var t=l.a.getOptions(e),n=e.getImage(),a=n.getURL(),o=this._materialManager.getImageCollection(),s=o.getImageFromURL(a);return s?new u.a(i.i(r.extend)(t,{image:s})):void c.error("SceneProcessorVisitor.createTextureModelFromTextureOSG can't find image "+a+" image collections")},mapTexturesOnMaterial:function(e,t){for(var i=this.getTextureLists(e),r=e.getNumTextureAttributeLists(),n=function(e,t,i,r,n){if(void 0!==r){var a=this.createTextureModelFromTextureOSG(r);this.setMaterialChannelTexture(e,t,i,n,a)}}.bind(this),a=0,o=r;a<o;a++){var s=a;void 0!==e.getTextureAttribute(a,"Texture")&&(1===r?n(e,t,s,i[s],"DiffuseColor"):r>=2&&(0===s?n(e,t,s,i[s],"EmitColor"):1===s?n(e,t,s,i[s],"DiffuseColor"):2===s&&n(e,t,s,i[s],"SpecularColor")))}},postApply:function(){},applyExistingMaterial:function(e,t){if(e){var i=this._materialManager.getMaterialByStateSet(e);if(!i)return void(this._stateSetsProcessed[e.getInstanceID()]=!0);var r=i.get("stateSet")||e,n=r.getInstanceID();return!0===this._stateSetsProcessed[n]?i:(this._stateSetsProcessed[n]=!0,i.set("name",this._materialManager.getUniqueMaterialName(e.getAttributeMap().Material,e,t)),i.setStateSet(e),this._materials.push(i),i)}},processLightSource:function(){},pushLight:function(e){var t=this.nodePath[this.nodePath.length-1];t instanceof c.LightSource&&(t.setNodeMask(0),t.setLight(e)),e._worldMatrix=c.computeLocalToWorld(this.nodePath),this._lights.push(e)},apply:function(e){e.typeID===c.LightSource.typeID&&this.processLightSource(e);var t=e.getStateSet();if(t){var i=this.applyExistingMaterial(t,e);if(i)e.setStateSet(i.get("stateSet"));else{var r=this.getMetaData(t);(this.hasMaterialAttributes(t)||this.hasTextureAttributes(t))&&(r?this.processMaterial(e,t,r):this.processDefaultMaterial(e,t)),i=this._materialManager.getMaterialByStateSet(t),this.checkForPBRTextureFromChannelsAndFilenames(i),this._materialManager.getImageCollection().length&&this.checkForPBRTextureFromMaterialAndFilenames(i),this.checkChannelsAndSetWorkFlowRoughGloss(i)}}this.traverse(e)}})),t.a=h},,,,,,,,,,,,,,,function(e,t,i){"use strict";var r=i(14),n=i(68),a=function(e,t,i,r){n.call(this),this._sourceFactor=a.DISABLE,this._destinationFactor=a.DISABLE,this._sourceFactorAlpha=this._sourceFactor,this._destinationFactorAlpha=this._destinationFactor,this._separate=!1,void 0!==e&&this.setSource(e),void 0!==t&&this.setDestination(t),void 0!==i&&this.setSourceAlpha(i),void 0!==r&&this.setDestinationAlpha(r)};a.DISABLE=-1,a.ZERO=0,a.ONE=1,a.SRC_COLOR=768,a.ONE_MINUS_SRC_COLOR=769,a.SRC_ALPHA=770,a.ONE_MINUS_SRC_ALPHA=771,a.DST_ALPHA=772,a.ONE_MINUS_DST_ALPHA=773,a.DST_COLOR=774,a.ONE_MINUS_DST_COLOR=775,a.SRC_ALPHA_SATURATE=776,a.BLEND_DST_RGB=32968,a.BLEND_SRC_RGB=32969,a.BLEND_DST_ALPHA=32970,a.BLEND_SRC_ALPHA=32971,a.CONSTANT_COLOR=32769,a.ONE_MINUS_CONSTANT_COLOR=32770,a.CONSTANT_ALPHA=32771,a.ONE_MINUS_CONSTANT_ALPHA=32772,a.BLEND_COLOR=32773,r.createPrototypeStateAttribute(a,r.objectInherit(n.prototype,{attributeType:"BlendFunc",cloneType:function(){return new a},setSource:function(e){this.setSourceRGB(e),this.setSourceAlpha(e)},getSource:function(){return this._sourceFactor},setDestination:function(e){this.setDestinationRGB(e),this.setDestinationAlpha(e)},getDestination:function(){return this._destinationFactor},getSeparate:function(){return this._separate},checkSeparate:function(){return this._sourceFactor!==this._sourceFactorAlpha||this._destinationFactor!==this._destinationFactorAlpha},setSourceRGB:function(e){this._sourceFactor="string"==typeof e?a[e]:e,this._separate=this.checkSeparate()},getSourceRGB:function(){return this._sourceFactor},setSourceAlpha:function(e){this._sourceFactorAlpha="string"==typeof e?a[e]:e,this._separate=this.checkSeparate()},getSourceAlpha:function(){return this._sourceFactorAlpha},setDestinationRGB:function(e){this._destinationFactor="string"==typeof e?a[e]:e,this._separate=this.checkSeparate()},getDestinationRGB:function(){return this._destinationFactor},setDestinationAlpha:function(e){this._destinationFactorAlpha="string"==typeof e?a[e]:e,this._separate=this.checkSeparate()},getDestinationAlpha:function(){return this._destinationFactorAlpha},apply:function(e){var t=e.getGraphicContext();this._sourceFactor===a.DISABLE||this._destinationFactor===a.DISABLE?t.disable(t.BLEND):(t.enable(t.BLEND),this._separate?t.blendFuncSeparate(this._sourceFactor,this._destinationFactor,this._sourceFactorAlpha,this._destinationFactorAlpha):t.blendFunc(this._sourceFactor,this._destinationFactor))}}),"osg","BlendFunc"),e.exports=a},function(e,t,i){"use strict";var r=i(14),n=i(68),a=function(e,t,i,r){n.call(this),this._func=a.LESS,this._near=0,this._far=1,this._writeMask=!0,void 0!==e&&(this._func="string"==typeof e?a[e]:e),void 0!==t&&(this._near=t),void 0!==i&&(this._far=i),void 0!==r&&(this._writeMask=r)};a.DISABLE=0,a.NEVER=512,a.LESS=513,a.EQUAL=514,a.LEQUAL=515,a.GREATER=516,a.NOTEQUAL=517,a.GEQUAL=518,a.ALWAYS=519,r.createPrototypeStateAttribute(a,r.objectInherit(n.prototype,{attributeType:"Depth",cloneType:function(){return new a},setRange:function(e,t){this._near=e,this._far=t},setWriteMask:function(e){this._writeMask=e},getWriteMask:function(){return this._writeMask},getFunc:function(){return this._func},apply:function(e){var t=e.getGraphicContext();0===this._func?t.disable(t.DEPTH_TEST):(t.enable(t.DEPTH_TEST),t.depthFunc(this._func),t.depthMask(this._writeMask),t.depthRange(this._near,this._far))}}),"osg","Depth"),e.exports=a},function(e,t,i){"use strict";var r=i(30),n=i(14),a=i(422),o=i(68),s=i(331),u=i(333),l=function(){a.call(this),o.call(this),this._fbo=void 0,this._rbo=void 0,this._attachments=[],this._dirty=!0,this._hasMRT=u.instance().getWebGLExtension("WEBGL_draw_buffers")};l.COLOR_ATTACHMENT0=36064,l.DEPTH_ATTACHMENT=36096,l.DEPTH_COMPONENT16=33189,l._sDeletedGLFrameBufferCache=new window.Map,l.deleteGLFrameBuffer=function(e,t){l._sDeletedGLFrameBufferCache.has(e)||l._sDeletedGLFrameBufferCache.set(e,[]),l._sDeletedGLFrameBufferCache.get(e).push(t)},l.flushDeletedGLFrameBuffers=function(e,t){if(t<=0)return t;if(!l._sDeletedGLFrameBufferCache.has(e))return t;for(var i=0,r=s.instance().tick(),n=l._sDeletedGLFrameBufferCache.get(e),a=n.length,o=a-1;o>=0&&i<t;o--)e.deleteFramebuffer(n[o]),n.splice(o,1),i=s.instance().deltaS(r,s.instance().tick());return t-i},l.flushAllDeletedGLFrameBuffers=function(e){if(l._sDeletedGLFrameBufferCache.has(e))for(var t=l._sDeletedGLFrameBufferCache.get(e),i=t.length,r=i-1;r>=0;r--)e.deleteFramebuffer(t[r]),t.splice(r,1)},l._sDeletedGLRenderBufferCache=new window.Map,l.deleteGLRenderBuffer=function(e,t){l._sDeletedGLRenderBufferCache.has(e)||l._sDeletedGLRenderBufferCache.set(e,[]),l._sDeletedGLRenderBufferCache.get(e).push(t)},l.flushDeletedGLRenderBuffers=function(e,t){if(t<=0)return t;if(!l._sDeletedGLRenderBufferCache.has(e))return t;for(var i=0,r=s.instance().tick(),n=l._sDeletedGLRenderBufferCache.get(e),a=n.length,o=a-1;o>=0&&i<t;o--)e.deleteRenderbuffer(n[o]),n.splice(o,1),i=s.instance().deltaS(r,s.instance().tick());return t-i},l.flushAllDeletedGLRenderBuffers=function(e){if(l._sDeletedGLRenderBufferCache.has(e))for(var t=l._sDeletedGLRenderBufferCache.get(e),i=t.length,r=i-1;r>=0;r--)e.deleteRenderbuffer(t[r]),t.splice(r,1)},n.createPrototypeStateAttribute(l,n.objectInherit(a.prototype,n.objectInherit(o.prototype,{attributeType:"FrameBufferObject",cloneType:function(){return new l},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},setAttachment:function(e){this._attachments.push(e)},releaseGLObjects:function(){void 0!==this._fbo&&void 0!==this._gl&&l.deleteGLFrameBuffer(this._gl,this._fbo),this._fbo=void 0,void 0!==this._rbo&&void 0!==this._gl&&l.deleteGLRenderBuffer(this._gl,this._rbo),this._rbo=void 0},_reportFrameBufferError:function(e){switch(e){case 36054:r.debug("FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case 36055:r.debug("FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case 36057:r.debug("FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case 36061:r.debug("FRAMEBUFFER_UNSUPPORTED");break;default:r.debug("FRAMEBUFFER unknown error "+e.toString(16))}},reset:function(){this.releaseGLObjects(),this._attachments=[]},getFrameBufferObject:function(){return this._fbo},createFrameBufferObject:function(e){this.setGraphicContext(e.getGraphicContext()),this._fbo=this._gl.createFramebuffer()},createRenderBuffer:function(e,t,i){var r=this._gl,n=r.createRenderbuffer();return r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),n},framebufferRenderBuffer:function(e,t){var i=this._gl;i.bindRenderbuffer(i.RENDERBUFFER,t),i.framebufferRenderbuffer(i.FRAMEBUFFER,e,i.RENDERBUFFER,t)},framebufferTexture2D:function(e,t,i,r){var n=this._gl;if(e.applyTextureAttribute(1,r),r.isDirty()||!r.getTextureObject())return!1;var a=n.DRAW_FRAMEBUFFER||n.FRAMEBUFFER;return n.framebufferTexture2D(a,t,i,r.getTextureObject().id(),0),!0},bindFrameBufferObject:function(){var e=this._gl;e.bindFramebuffer(e.FRAMEBUFFER,this._fbo)},checkStatus:function(){var e=this._gl,t=e.checkFramebufferStatus(e.FRAMEBUFFER);t!==e.FRAMEBUFFER_COMPLETE&&this._reportFrameBufferError(t)},_checkAllowedSize:function(e,t){var i=u.instance().getWebGLParameter("MAX_RENDERBUFFER_SIZE");return!(0===e||0===t||t>i||e>i)||(r.error("width ("+e+") or height ("+e+') makes frame buffer not bindable. Max RenderBuffer is "'+i+'"'),!1)},apply:function(e){this._gl||this.setGraphicContext(e.getGraphicContext());var t=this._gl,i=this._attachments;if(0===i.length&&!this._fbo)return void t.bindFramebuffer(t.FRAMEBUFFER,null);if(!this.isDirty())return t.bindFramebuffer(t.FRAMEBUFFER,this._fbo),void(!0===r.reportWebGLError&&this.checkStatus());this._fbo||this.createFrameBufferObject(e),this.bindFrameBufferObject();for(var n=this._hasMRT?[]:void 0,a=!1,o=0,s=i.length;o<s;++o){var u=i[o];if(u.texture){var l=u.texture;if(!this._checkAllowedSize(l.getWidth(),l.getHeight()))return void this.releaseGLObjects();if(this._hasMRT&&u.attachment>=t.COLOR_ATTACHMENT0&&u.attachment<=t.COLOR_ATTACHMENT15&&n.push(u.attachment),!this.framebufferTexture2D(e,u.attachment,u.textureTarget,l))return void this.releaseGLObjects()}else{if(!this._checkAllowedSize(u.width,u.height))return void this.releaseGLObjects();this._rbo=this.createRenderBuffer(u.format,u.width,u.height),this.framebufferRenderBuffer(u.attachment,this._rbo),a=!0}}n&&n.length>0&&t.drawBuffers(n),this.checkStatus(),a&&t.bindRenderbuffer(t.RENDERBUFFER,null),this._dirty=!1}})),"osg","FrameBufferObject"),e.exports=l},function(e,t,i){"use strict";var r=i(8).vec3,n=i(164),a=i(145),o=i(136),s=i(291),u=i(292),l=i(329),c=i(330),h=i(14),d=function(e,t,i,r,s,l){var c,d,p,f=void 0!==e?e:0,g=void 0!==t?t:0,m=void 0!==i?i:0,v=void 0!==r?r:1,_=void 0!==s?s:1,b=void 0!==l?l:1,x=new a;c=v/2,d=_/2,p=b/2;var S=new h.Float32Array(72),y=new h.Float32Array(48),C=new h.Float32Array(72);S[0]=f-c,S[1]=g-d,S[2]=m+p,C[0]=0,C[1]=-1,C[2]=0,y[0]=0,y[1]=1,S[3]=f-c,S[4]=g-d,S[5]=m-p,C[3]=0,C[4]=-1,C[5]=0,y[2]=0,y[3]=0,S[6]=f+c,S[7]=g-d,S[8]=m-p,C[6]=0,C[7]=-1,C[8]=0,y[4]=1,y[5]=0,S[9]=f+c,S[10]=g-d,S[11]=m+p,C[9]=0,C[10]=-1,C[11]=0,y[6]=1,y[7]=1,S[12]=f+c,S[13]=g+d,S[14]=m+p,C[12]=0,C[13]=1,C[14]=0,y[8]=0,y[9]=1,S[15]=f+c,S[16]=g+d,S[17]=m-p,C[15]=0,C[16]=1,C[17]=0,y[10]=0,y[11]=0,S[18]=f-c,S[19]=g+d,S[20]=m-p,C[18]=0,C[19]=1,C[20]=0,y[12]=1,y[13]=0,S[21]=f-c,S[22]=g+d,S[23]=m+p,C[21]=0,C[22]=1,C[23]=0,y[14]=1,y[15]=1,S[24]=f+c,S[25]=g-d,S[26]=m+p,C[24]=1,C[25]=0,C[26]=0,y[16]=0,y[17]=1,S[27]=f+c,S[28]=g-d,S[29]=m-p,C[27]=1,C[28]=0,C[29]=0,y[18]=0,y[19]=0,S[30]=f+c,S[31]=g+d,S[32]=m-p,C[30]=1,C[31]=0,C[32]=0,y[20]=1,y[21]=0,S[33]=f+c,S[34]=g+d,S[35]=m+p,C[33]=1,C[34]=0,C[35]=0,y[22]=1,y[23]=1,S[36]=f-c,S[37]=g+d,S[38]=m+p,C[36]=-1,C[37]=0,C[38]=0,y[24]=0,y[25]=1,S[39]=f-c,S[40]=g+d,S[41]=m-p,C[39]=-1,C[40]=0,C[41]=0,y[26]=0,y[27]=0,S[42]=f-c,S[43]=g-d,S[44]=m-p,C[42]=-1,C[43]=0,C[44]=0,y[28]=1,y[29]=0,S[45]=f-c,S[46]=g-d,S[47]=m+p,C[45]=-1,C[46]=0,C[47]=0,y[30]=1,y[31]=1,S[48]=f-c,S[49]=g+d,S[50]=m+p,C[48]=0,C[49]=0,C[50]=1,y[32]=0,y[33]=1,S[51]=f-c,S[52]=g-d,S[53]=m+p,C[51]=0,C[52]=0,C[53]=1,y[34]=0,y[35]=0,S[54]=f+c,S[55]=g-d,S[56]=m+p,C[54]=0,C[55]=0,C[56]=1,y[36]=1,y[37]=0,S[57]=f+c,S[58]=g+d,S[59]=m+p,C[57]=0,C[58]=0,C[59]=1,y[38]=1,y[39]=1,S[60]=f+c,S[61]=g+d,S[62]=m-p,C[60]=0,C[61]=0,C[62]=-1,y[40]=0,y[41]=1,S[63]=f+c,S[64]=g-d,S[65]=m-p,C[63]=0,C[64]=0,C[65]=-1,y[42]=0,y[43]=0,S[66]=f-c,S[67]=g-d,S[68]=m-p,C[66]=0,C[67]=0,C[68]=-1,y[44]=1,y[45]=0,S[69]=f-c,S[70]=g+d,S[71]=m-p,C[69]=0,C[70]=0,C[71]=-1,y[46]=1,y[47]=1;var T=new h.Uint16Array(36);T[0]=0,T[1]=1,T[2]=2,T[3]=0,T[4]=2,T[5]=3,T[6]=4,T[7]=5,T[8]=6,T[9]=4,T[10]=6,T[11]=7,T[12]=8,T[13]=9,T[14]=10,T[15]=8,T[16]=10,T[17]=11,T[18]=12,T[19]=13,T[20]=14,T[21]=12,T[22]=14,T[23]=15,T[24]=16,T[25]=17,T[26]=18,T[27]=16,T[28]=18,T[29]=19,T[30]=20,T[31]=21,T[32]=22,T[33]=20,T[34]=22,T[35]=23,x.getAttributes().Vertex=new n(n.ARRAY_BUFFER,S,3),x.getAttributes().Normal=new n(n.ARRAY_BUFFER,C,3),x.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,y,2);var M=new u(o.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,T,1));return x.getPrimitives().push(M),x},p=function(){var e=new a,t=new h.Float32Array([-1,-1,-1,4,4,-1]),i=new h.Float32Array([-1,-1,-1,4,4,-1]),r=new h.Uint16Array(3);r[0]=2,r[1]=1,r[2]=0,e.getAttributes().Vertex=new n(n.ARRAY_BUFFER,i,2),e.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,t,2);var s=new u(o.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,r,1));return e.getPrimitives().push(s),function(){return e}}(),f=function(e,t,i,s,l,c,d,p,f,g,m,v,_){void 0===v&&void 0===_&&(v=g,_=m,g=0,m=0);var b=new a,x=new h.Float32Array(12);x[0]=e+d,x[1]=t+p,x[2]=i+f,x[3]=e,x[4]=t,x[5]=i,x[6]=e+s,x[7]=t+l,x[8]=i+c,x[9]=e+s+d,x[10]=t+l+p,x[11]=i+c+f,void 0===v&&(v=1),void 0===_&&(_=1);var S=new h.Float32Array(8);S[0]=g,S[1]=_,S[2]=g,S[3]=m,S[4]=v,S[5]=m,S[6]=v,S[7]=_;var y=r.fromValues(s,l,c);r.cross(y,y,r.fromValues(d,p,f)),r.normalize(y,y);var C=new h.Float32Array(12);C[0]=y[0],C[1]=y[1],C[2]=y[2],C[3]=y[0],C[4]=y[1],C[5]=y[2],C[6]=y[0],C[7]=y[1],C[8]=y[2],C[9]=y[0],C[10]=y[1],C[11]=y[2];var T=new h.Uint16Array(6);T[0]=0,T[1]=1,T[2]=2,T[3]=0,T[4]=2,T[5]=3,b.getAttributes().Vertex=new n(n.ARRAY_BUFFER,x,3),b.getAttributes().Normal=new n(n.ARRAY_BUFFER,C,3),b.getAttributes().TexCoord0=new n(n.ARRAY_BUFFER,S,2);var M=new u(o.TRIANGLES,new n(n.ELEMENT_ARRAY_BUFFER,T,1));return b.getPrimitives().push(M),b},g=function(e){void 0===e&&(e=1),void 0===g.getShader&&(g.getShader=function(){if(void 0===g.getShader.program){var e=["#ifdef GL_ES","precision highp float;","#endif","attribute vec3 Vertex;","attribute vec4 Color;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","","varying vec4 vColor;","","void main(void) {","  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0));","  vColor = Color;","}"].join("\n"),t=["#ifdef GL_ES","precision highp float;","#endif","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"].join("\n"),i=new l(new c("VERTEX_SHADER",e),new c("FRAGMENT_SHADER",t));g.getShader.program=i}return g.getShader.program});var t=new a,i=new h.Float32Array(18);i[3]=e,i[10]=e,i[17]=e;var r=new h.Float32Array(24);r[0]=r[3]=1,r[4]=r[7]=1,r[9]=r[11]=1,r[13]=r[15]=1,r[18]=r[19]=1,r[22]=r[23]=1,t.getAttributes().Vertex=new n(n.ARRAY_BUFFER,i,3),t.getAttributes().Color=new n(n.ARRAY_BUFFER,r,4);var u=new s(o.LINES,0,6);return t.getPrimitives().push(u),t.getOrCreateStateSet().setAttributeAndModes(g.getShader()),t},m=function(e,t,i,l,c,d,p){e=e||1,l=void 0!==l?l:0,c=void 0!==c?c:2*Math.PI,d=void 0!==d?d:0,p=void 0!==p?p:Math.PI;for(var f=Math.max(3,Math.floor(t)||8),g=Math.max(2,Math.floor(i)||6),m=f*g/3>=65536,v=m?f*g*6:f*g*4,_=new h.Float32Array(3*v),b=new h.Float32Array(3*v),x=new h.Float32Array(2*v),S=m?void 0:new h.Uint16Array(f*g*6),y=0,C=0,T=new h.Float32Array(3),M=new h.Float32Array(3),w=new h.Float32Array(3),A=new h.Float32Array(3),E=new h.Float32Array(3),P=new h.Float32Array(3),N=new h.Float32Array(3),F=new h.Float32Array(3),R=new h.Float32Array(2),I=new h.Float32Array(2),O=new h.Float32Array(2),L=new h.Float32Array(2),D=function(t,i,n,a,o){n[0]=-e*Math.cos(l+t*c)*Math.sin(d+i*p),n[1]=e*Math.cos(d+i*p),n[2]=e*Math.sin(l+t*c)*Math.sin(d+i*p),r.normalize(a,n),o[0]=t,o[1]=1-i},k=0;k<g;k++)for(var B=0;B<f;B++){D((B+1)/f,k/g,T,E,R),D(B/f,k/g,M,P,I),D(B/f,(k+1)/g,w,N,O),D((B+1)/f,(k+1)/g,A,F,L);var V=3*y;_[V]=T[0],_[V+1]=T[1],_[V+2]=T[2],_[V+3]=M[0],_[V+4]=M[1],_[V+5]=M[2],_[V+6]=w[0],_[V+7]=w[1],_[V+8]=w[2],b[V]=E[0],b[V+1]=E[1],b[V+2]=E[2],b[V+3]=P[0],b[V+4]=P[1],b[V+5]=P[2],b[V+6]=N[0],b[V+7]=N[1],b[V+8]=N[2];var U=2*y;if(x[U]=R[0],x[U+1]=R[1],x[U+2]=I[0],x[U+3]=I[1],x[U+4]=O[0],x[U+5]=O[1],y+=3,m)V=3*y,_[V]=T[0],_[V+1]=T[1],_[V+2]=T[2],_[V+3]=w[0],_[V+4]=w[1],_[V+5]=w[2],_[V+6]=A[0],_[V+7]=A[1],_[V+8]=A[2],b[V]=E[0],b[V+1]=E[1],b[V+2]=E[2],b[V+3]=N[0],b[V+4]=N[1],b[V+5]=N[2],b[V+6]=F[0],b[V+7]=F[1],b[V+8]=F[2],U=2*y,x[U]=R[0],x[U+1]=R[1],x[U+2]=O[0],x[U+3]=O[1],x[U+4]=L[0],x[U+5]=L[1],y+=3;else{V=3*y,_[V]=A[0],_[V+1]=A[1],_[V+2]=A[2],b[V]=F[0],b[V+1]=F[1],b[V+2]=F[2],U=2*y,x[U]=L[0],x[U+1]=L[1];var G=3*C,z=y-3;S[G]=z,S[G+1]=z+1,S[G+2]=z+2,S[G+3]=z,S[G+4]=z+2,S[G+5]=z+3,C+=2,y+=1}}var j=new a;return j.getAttributes().Vertex=new n("ARRAY_BUFFER",_,3),j.getAttributes().Normal=new n("ARRAY_BUFFER",b,3),j.getAttributes().TexCoord0=new n("ARRAY_BUFFER",x,2),m?j.getPrimitives().push(new s(o.TRIANGLES,0,_.length/3)):j.getPrimitives().push(new u(o.TRIANGLES,new n("ELEMENT_ARRAY_BUFFER",S,1))),j},v=function(e,t,i,r,u,l,c,h,d,p,f){e=void 0!==e?e:-.5,t=void 0!==t?t:-.5,i=void 0!==i?i:0,r=void 0!==r?r:1,u=void 0!==u?u:0,l=void 0!==l?l:0,c=void 0!==c?c:0,h=void 0!==h?h:1,d=void 0!==d?d:0,p=void 0!==p?p:5,f=void 0!==f?f:p,p+=2,f+=2;var g=new a,m=new Float32Array(2*(p+f)*3),v=0,_=0,b=r/(p-1),x=u/(p-1),S=l/(p-1),y=e+r+c,C=t+u+h,T=i+l+d;for(v=0;v<p;++v)_=6*v,m[_]=e+b*v,m[_+1]=t+x*v,m[_+2]=i+S*v,m[_+3]=y-b*(p-v-1),m[_+4]=C-x*(p-v-1),m[_+5]=T-S*(p-v-1);for(b=c/(f-1),x=h/(f-1),S=d/(f-1),v=0;v<f;++v)_=6*(p+v),m[_]=e+b*v,m[_+1]=t+x*v,m[_+2]=i+S*v,m[_+3]=y-b*(f-v-1),m[_+4]=C-x*(f-v-1),m[_+5]=T-S*(f-v-1);g.getAttributes().Vertex=new n(n.ARRAY_BUFFER,m,3);var M=new s(o.LINES,0,2*(p+f));return g.getPrimitives().push(M),g},_=function(e){var t=new a,i=new Float32Array([-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5]);t.getAttributes().Vertex=new n(n.ARRAY_BUFFER,i,3),e||(e=[1,0,0,1]);for(var r=new h.Float32Array(32),s=0;s<8;s++)for(var l=0;l<4;l++)r[3*s+l]=e[l];t.getAttributes().Color=new n(n.ARRAY_BUFFER,r,4);var c=new h.Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);return t.getPrimitives().push(new u(o.LINES,new n("ELEMENT_ARRAY_BUFFER",c,1))),t};e.exports={createTexturedBoxGeometry:d,createTexturedQuadGeometry:f,createTexturedSphereGeometry:m,createTexturedFullScreenFakeQuadGeometry:p,createAxisGeometry:g,createTexturedSphere:m,createGridGeometry:v,createBoundingBoxGeometry:_}},function(e,t,i){"use strict";var r=i(14),n=i(649),a=i(30),o=i(8).vec3,s=i(145),u=i(293),l=i(669),c=i(68),h=i(363),d=function(){s.call(this),this._shape=null,this._targets=[],this._stateSetAnimation=new u,this._targetWeights=new Float32Array(d.MAX_MORPH_GPU),this._morphAttribute=void 0,this._morphTargetNames=void 0,this._maxMorphGPU=d.MAX_MORPH_GPU,this._isInitialized=!1},p=d.EFFECTIVE_EPS=.05;d.MAX_MORPH_GPU=4,r.createPrototypeNode(d,r.objectInherit(s.prototype,{init:function(){return this._morphAttribute?(this._isInitialized=!0,!1):(this._morphAttribute=new l(Math.min(this._maxMorphGPU,this.getMorphTargets().length)),this.getStateSetAnimation().setAttributeAndModes(this._morphAttribute,c.ON),this._morphAttribute.setTargetWeights(this.getTargetsWeight()),this._targets[0]?(this._morphTargetNames=window.Object.keys(this._targets[0].getVertexAttributeList()),this._morphAttribute.copyTargetNames(this._morphTargetNames)):(this._morphTargetNames=[],a.error("No Targets in the MorphGeometry !")),this._isInitialized=!0,!0)},getMaximumPossibleMorphGPU:function(){return this._maxMorphGPU},setMaximumPossibleMorphGPU:function(e){this._maxMorphGPU=e,this._isInitialized=!1,this._morphAttribute&&this._morphAttribute.setNumTargets(e)},getMorphTargetNames:function(){return this._morphTargetNames},getStateSetAnimation:function(){return this._stateSetAnimation},getMorphTargets:function(){return this._targets},isInitialized:function(){return this._isInitialized},getTargetsWeight:function(){return this._targetWeights},computeBoundingBox:function(){var e=new h;return function(t){s.prototype.computeBoundingBox.call(this,t);for(var i=0,r=this._targets.length;i<r;i++)t.expandByBoundingBox(this._targets[i].computeBoundingBox(e));return t}}(),mergeChildrenVertexAttributeList:function(){for(var e=0,t=this._targets.length;e<t;e++){var i=this._targets[e],r=i.getVertexAttributeList();for(var a in r){var o=r[a];o&&!o.getBufferArray&&(r[a]=new n(o))}s.appendVertexAttributeToList(i.getVertexAttributeList(),this.getVertexAttributeList(),e)}},_computeEffectiveSumWeights:function(){for(var e=0,t=this._targetWeights,i=0,r=t.length;i<r;++i){var n=t[i];Math.abs(n)<p||(e+=n)}return Math.abs(e)>1e-5?e:e<0?-1e-5:1e-5},computeTransformedVertex:function(e,t){t=t||o.create();var i=3*e,r=this._targetWeights,n=this.getVertexAttributeList(),a=n.Vertex.getElements(),s=1-this._computeEffectiveSumWeights();t[0]=s*a[i],t[1]=s*a[i+1],t[2]=s*a[i+2];for(var u=0,l=r.length;u<l;++u){var c=r[u];if(!(Math.abs(c)<p)){var h=n["Vertex_"+u].getElements();t[0]+=c*h[i],t[1]+=c*h[i+1],t[2]+=c*h[i+2]}}return t},computeTransformedVertices:function(){for(var e=this._targetWeights,t=this.getVertexAttributeList(),i=t.Vertex.getElements(),r=i.length,n=this._morphedVerts=this._morphedVerts||new Float32Array(r),a=1-this._computeEffectiveSumWeights(),o=0;o<r;++o)n[o]=a*i[o];for(var s=0,u=e.length;s<u;++s){var l=e[s];if(!(Math.abs(l)<p))for(var c=t["Vertex_"+s].getElements(),h=0;h<r;++h)n[h]+=l*c[h]}return n}}),"osgAnimation","MorphGeometry"),e.exports=d},function(e,t,i){"use strict";var r=i(30),n=i(14),a=i(88),o=i(381),s=i(145),u=i(164),l=i(136),c=i(291),h=i(292),d=i(293),p=i(135),f=i(8).mat4,g=i(165),m=i(570),v=i(457),_={};_.ObjectWrapper={},_.ObjectWrapper.serializers={},_.readImage=function(e,t){return _.registry().readImageURL(e,t)},_.readImageURL=_.readImage,_.readBinaryArrayURL=function(e,t){return _.registry().readBinaryArrayURL(e,t)},_.readNodeURL=function(e,t){var i=e.substr(e.lastIndexOf(".")+1),r=v.instance().getReaderWriterForExtension(i);return void 0!==r?r.readNodeURL(e,t):_.registry().readNodeURL(e,t)},_.registry=function(){var e=i(576);return void 0===_.registry._input&&(_.registry._input=new e),_.registry._input},_.parseSceneGraph=function(e,t){if(!(void 0!==e.Version&&e.Version>0)){n.time("osgjs.metric:ReaderParser.parseSceneGraphDeprecated");var i=_.parseSceneGraphDeprecated(e);return n.timeEnd("osgjs.metric:ReaderParser.parseSceneGraphDeprecated"),i}n.time("osgjs.metric:ReaderParser.parseSceneGraph");var a;for(var o in e)if("Generator"!==o&&"Version"!==o){a=o;break}if(a){var s={};s[a]=e[a];var u=_.registry().clone();u.setJSON(s);var l=n.objectMix(n.objectMix({},_.registry().getOptions()),t||{});u.setOptions(l);var c=u.readObject();return n.timeEnd("osgjs.metric:ReaderParser.parseSceneGraph"),c}r.log("can't parse scenegraph "+e)},_.parseSceneGraphDeprecated=function(e){var t,v=function(e,t){var i=t[e];return void 0===i&&(i=t[e.toLowerCase()]),i},b=function(e,t){var i=v("Name",t);i&&void 0!==e.setName&&e.setName(i)},x=function(e,t){b(e,t),e.setAmbient(v("Ambient",t)),e.setDiffuse(v("Diffuse",t)),e.setEmission(v("Emission",t)),e.setSpecular(v("Specular",t)),e.setShininess(v("Shininess",t))},S=function(e,t){b(e,t),e.setSourceRGB(t.SourceRGB),e.setSourceAlpha(t.SourceAlpha),e.setDestinationRGB(t.DestinationRGB),e.setDestinationAlpha(t.DestinationAlpha)},y=function(e,t){var i=t.MagFilter||t.mag_filter||void 0;i&&e.setMagFilter(i);var n=t.MinFilter||t.min_filter||void 0;n&&e.setMinFilter(n);var a=t.WrapT||t.wrap_t||void 0;a&&e.setWrapT(a);var o=t.WrapS||t.wrap_s||void 0;o&&e.setWrapS(o);var s=v("File",t);_.readImage(s).then(function(t){e.setImage(t)}).catch(function(){r.log("Can't read image")})},C=e.children,T=e._primitives||e.primitives||e.Primitives||void 0,M=e._attributes||e.attributes||e.Attributes||void 0;if(T||M){var w=new s;b(w,e),w.stateset=e.stateset,e=w;for(var A=0,E=T.length;A<E;A++){var P=T[A].mode;if(T[A].indices){var N=T[A].indices;N=new u(u[N.type],N.elements,N.itemSize),P=P?l[P]:"TRIANGLES",w.getPrimitiveSetList().push(new h(P,N))}else{P=l[P];var F=T[A].first,R=T[A].count;w.getPrimitiveSetList().push(new c(P,F,R))}}for(var I in M){var O=M[I];w.getVertexAttributeList()[I]=new u(O.type,O.elements,O.itemSize)}}var L=v("StateSet",e);if(L){var D=new d;!function(e,t){b(e,t);var n=v("Textures",t)||v("TextureAttributeList",t)||void 0;if(n)for(var s=0,u=n.length;s<u;s++){var l=v("File",n[s]);if(l){var c=i(97),h=new c;y(h,n[s]),e.setTextureAttributeAndModes(s,h),e.addUniform(a.createInt1(s,"Texture"+s))}else r.log("no texture on unit "+s+" skip it")}var d=v("BlendFunc",t);if(d){var p=new o;S(p,d),e.setAttributeAndModes(p)}var f=v("Material",t);if(f){var g=i(566),m=new g;x(m,f),e.setAttributeAndModes(m)}}(D,L),e.stateset=D}var k=e.matrix||e.Matrix||void 0;k&&(t=new g,b(t,e),n.extend(t,e),f.copy(t.getMatrix(),k),e=t);var B=e.projection||e.Projection||void 0;if(B&&(t=new m,b(t,e),n.extend(t,e),f.copy(t.setProjectionMatrix(),B),e=t),void 0===e.typeID&&(t=new p,b(t,e),n.extend(t,e),e=t),C){e.children=[];for(var V=0,U=C.length;V<U;V++)e.addChild(_.parseSceneGraphDeprecated(C[V]))}return e},e.exports=_},function(e,t,i){"use strict";var r=i(5),n=i(1048),a=i(1050),o=i(1052),s=i(31),u=i(156),l=r.a.osg,c=r.a.osgShader,h=c.Compiler,d=c.nodeFactory;d.registerNodes(n.a),d.registerNodes(a.a),d.registerNodes(o.a);var p=function(){c.Compiler.apply(this,arguments);var e=this._material?this._material.getMaterialModel():void 0;this._channels=e?e.getChannels():void 0,this._isLighted=e&&!1===this._material.getShadeless(),this._isVertexColored=e&&this._material.getVertexColorEnable(),this._isVertexAlpha=e&&this._material.getVertexAlphaEnable()},f={attribute:["SketchfabLight0","ShadowReceive0","SketchfabLight1","ShadowReceive1","SketchfabLight2","ShadowReceive2","SketchfabLight3","ShadowReceive3","SketchfabMaterial","PointSize","Morph","Skinning","Billboard"],textureAttribute:["Texture"]};c.Compiler.setStateAttributeConfig(p,f),l.createPrototypeObject(p,l.objectInherit(h.prototype,{sortDeclarations:function(e){if(h.prototype.sortDeclarations.call(this,e),!this._fragmentShaderMode&&i.i(s.a)().varyingSorting)for(var t=-1,r=0,n=e.length;r<n;++r){var a=e[r];if(-1===t&&"v"===a[0]&&(t=r),-1!==a.indexOf("vViewNormal")){e[r]=e[t],e[t]=a;break}}},isAlphaBlendedMaterial:function(){if(!this._channels)return!1;var e=this._channels.Opacity,t=e.get("type");return e.isEffective()&&("alphaBlend"===t||"additive"===t)},getTextureByName:function(){},declareTextures:function(){},getCompilerName:function(){return"Classic"},registerTextureAttributes:function(e,t){var i=e.className();return"PackedMaterialTexture"===i?this.registerPackedMaterialTexture(e,t):"TextureEnvironment"===i?this.registerTextureEnvironment(e,t):"ShadowTexture"===i?this.registerTextureShadow(e,t):void 0},registerPackedMaterialTexture:function(e,t){return h.prototype.registerTexture.call(this,e,t)},registerTextureEnvironment:function(e,t){this._textures[t]=e,this._texturesByName["TextureEnvironment"+e.getChannel()]={texture:e,variable:void 0,textureUnit:t}},getOrCreateStateAttributeUniforms:function(e,t){var i=h.prototype.getOrCreateStateAttributeUniforms.call(this,e,t);return"SketchfabLight"===e.getType()&&(i.lightspecular&&(i.lightspecular=i.lightdiffuse),i.lightambient&&(i.lightambient=this.getOrCreateConstantZero("vec4")),"SPOT"!==e.getLightType()&&(i.lightinvMatrix=i.lightmatrix)),i},applyEmissive:function(e){var t=this.getOrCreateChannel("EmitColor");if(!t)return e;var i=this.createVariable("vec3");return this.getNode("InlineCode").code("%output = %mult == 1 ? %color * %emit : %color + %emit;").inputs({color:e,emit:t,mult:this.getOrCreateUniform("int","uEmitMultiplicative")}).outputs({output:i}),i},createFragmentShaderGraph:function(){var e;if(this._isLighted){var t=this.createLighting(),i=this.getEnvironment();t&&i?(e=this.createVariable("vec3"),this.getNode("Add").inputs(t,i).outputs(e)):e=t||i||this.getOrCreateConstantZero("vec3")}else e=this.getShadelessColor();return e=this.applyEmissive(e),[this.getFinalFrag(e)]},getEnumLightToNodeName:function(){return{DIRECTION:"SunLight",SPOT:"SpotLight",POINT:"PointLight",HEMI:"HemiLight"}},connectShadowLightNode:function(e,t,i){return h.prototype.connectShadowLightNode.call(this,e,t,i)},getFinalFrag:function(e){var t=this.getNode("glFragColor");return this.applyPointSizeCircle(t),this.isAlphaBlendedMaterial()?this.getFinalRGBA(e,t):(this.applyAlphaMask(t),this.getRGBM(this.getSrgbColor(e),t))},getRGBM:function(e,t){return this.getNode("EncodeRGBM").inputs({color:e,range:this.getOrCreateUniform("float","uRGBMRange")}).outputs({color:t}),t},getFinalRGBA:function(e,t){var i=this.getOrCreateChannel("Opacity"),r=this.getAlphaFinalAlpha(i);this.applyDiscardTransparentOpaque(i,r,t);var n=this.getSrgbColor(this.getPremultAlpha(e,i));return this.getNode("InlineCode").code("%color = %drawOpaque == 1 ? %rgbm : vec4(%rgb, %alpha);").inputs({rgb:n,rgbm:this.getRGBM(n,this.createVariable("vec4")),alpha:r,drawOpaque:this.getOrCreateUniform("int","uDrawOpaque")}).outputs({color:t}),t},applyDiscardTransparentOpaque:function(e,t,r){var n=(1-i.i(s.a)().epsilonAlpha).toExponential(),a="if(%alphaOriginal == 0.0 || (%drawOpaque == 1 && %alphaFinal < "+n+") || (%drawOpaque == 0 && %alphaFinal >= "+n+")) discard;";this.getNode("InlineCode").code(a).inputs({alphaOriginal:e,alphaFinal:t,drawOpaque:this.getOrCreateUniform("int","uDrawOpaque")}).outputs({out:r})},getAlphaFinalAlpha:function(e){var t=this.createVariable("float");return this.getNode("InlineCode").code("%finalAlpha = %alpha * float(1 - %additive);").inputs({alpha:e,additive:this.getOrCreateUniform("int","uOpacityAdditive")}).outputs({finalAlpha:t}),t},getShadelessColor:function(){return this.getOrCreateMaterialDiffuseColor()},getVertexAlpha:function(e){if(!this._isVertexAlpha)return e;var t=this.createVariable("float");return this.getNode("InlineCode").code("%out = %alpha * (%hasVertexColor == 1.0 ? %vertexColor.a : 1.0);").inputs({hasVertexColor:this.getOrCreateUniform("float","uArrayColorEnabled"),vertexColor:this.getOrCreateVarying("vec4","vVertexColor"),alpha:e}).outputs({out:t}),t},multiplyDiffuseWithVertexColor:function(e){if(!this._isVertexColored)return e;var t=this.getOrCreateVarying("vec4","vVertexColor"),i=this.getOrCreateUniform("float","uArrayColorEnabled");if("srgb"===this._material.getVertexColorColorSpace()){var r=this.createVariable("vec3");this.getNode("sRGBToLinear").inputs({color:t}).outputs({color:r}),t=r}var n=this.createVariable("vec3"),a=["","%color.rgb = %diffuse.rgb;","if ( %hasVertexColor == 1.0)","  %color *= %vertexColor.rgb;"].join("\n");return this.getNode("InlineCode").code(a).inputs({diffuse:e,hasVertexColor:i,vertexColor:t}).outputs({color:n}).comment("diffuse color = diffuse color * vertex color"),n},getOrCreateMaterialDiffuseColor:function(){var e=this.getVariable("materialDiffuseColor");if(e)return e;e=this.createVariable("vec3","materialDiffuseColor");var t=this.getOrCreateChannel("DiffuseColor");if(!t)return e.setValue("vec3(0.0)");var i=this.getOrCreateChannel("DiffuseIntensity")||this.getOrCreateConstantOne("float");return this.getNode("Mult").inputs(this.multiplyDiffuseWithVertexColor(t),i).outputs(e),e},getOrCreateMaterialNormal:function(){return this.getOrCreateGeometryNormal()},addAmbientLighting:function(){},getOrCreateMaterialSpecularColor:function(){return this.getOrCreateChannel("SpecularColor")||this.getOrCreateConstantZero("vec3")},getOrCreateMaterialSpecularHardness:function(){return this.getOrCreateChannel("SpecularHardness")||this.getOrCreateConstantZero("float")},applyAlphaMask:function(e){if(this.isAlphaBlendedMaterial())return e;var t=this.getOrCreateChannel("Opacity");if(void 0===t)return e;var i,r;s.a.taa?(i="1000.0",r=" + 10.0*fract(%time)"):(i="abs(%halton.z) == 2.0 ? 1000.0 : 1.0",r="");var n=["if (%dithering == 1) {","    float jitterForce = "+i+";","    vec3 dith = vec3(gl_FragCoord.xy"+r+", gl_FragCoord.x + gl_FragCoord.z * jitterForce) + %halton.xyx * 1000.0;","    dith = fract(dith * 0.1031);","    dith += dot(dith, dith.yzx + 19.19);","    if (%alpha * %factor < fract((dith.x + dith.y) * dith.z)) {","        discard;","    }","} else if (%alpha < %factor) {","    discard;","}"].join("\n");return this.getNode("InlineCode").code(n).inputs({alpha:t,factor:this.getOrCreateUniform("float","uOpacityFactor"),dithering:this.getOrCreateUniform("int","uOpacityDithering"),halton:this.getOrCreateUniform("vec4","uHalton"),time:this.getOrCreateUniform("float","uTimeDithering")}).outputs({out:e}),e},getOrCreateNormalMap:function(){var e=this.getVariable("normalMap");return e||(e=this.createVariable("vec3","normalMap"),this.getNode("RGBToNormal").inputs({normal:this.getOrCreateChannel("NormalMap"),flipY:this.getOrCreateUniform("int","uNormalMapFlipY")}).outputs({normal:e}),e)},getOrCreateGeometryNormal:function(){var e=this.getVariable("geoNormal");if(e)return e;e=this.createVariable("vec3","geoNormal");var t=this.getNormalMapNormal();return t||(t=this.getBumpMapNormal())||(t=this.getOrCreateNormalizedFrontViewNormal()),this.getNode("SetFromNode").inputs(t).outputs(e),e},getSrgbColor:function(e){var t=this.createVariable("vec3");return this.getNode("LinearTosRGBWithTest").inputs({color:e,keepLinear:this.getOrCreateUniform("int","uOutputLinear")}).outputs({color:t}),t},getTextureEnvironmentSpecular:function(){return this._texturesByName.TextureEnvironmentSpecular},getEnvironment:function(){var e=this.getTextureEnvironmentSpecular();if(void 0!==e){var t=e.texture,i=t.getCommonUniforms(),r=this.createVariable("mat3");this.getNode("EnvironmentTransformPBR").inputs({inTransform:this.getOrCreateUniform(i.environmentTransform)}).outputs({outTransform:r});var n=this.createVariable("vec3"),a=this.getEnvironmentDiffuse(r,i),o=this.getEnvironmentSpecular(r,t,i),s=this.createVariable("vec3");return this.getNode("Add").inputs(a,o).outputs(s),this.getNode("Mult").inputs(s,this.getOrCreateUniform(i.exposure)).outputs(n),n}},getEnvironmentDiffuse:function(e,t){var i=this.getOrCreateUniform(t.diffuseSPH);i.globalDeclaration=function(){return"uniform vec3 "+i.getVariable()+"[9];"};var r=this.createVariable("vec3");return this.getNode("DiffuseUE4v1").inputs({normal:this.getOrCreateMaterialNormal(),albedo:this.getOrCreateMaterialDiffuseColor(),ao:this.getOrCreateConstantOne("float"),envTransform:e,sphCoef:i}).outputs({color:r}),r},getEnvironmentSpecular:function(e,t,i){var r=this.createVariable("vec3");this.getNode("TextureEnvironmentCube").inputs({sampler:this.getOrCreateSampler("samplerCube",i.textureSpecular.getName()),envTransform:e,normal:this.getOrCreateMaterialNormal(),eye:this.getOrCreateNormalizedViewEyeDirection(),texSize:this.getOrCreateUniform(t.getOrCreateUniforms().size)}).outputs({color:r});var n=this.createVariable("vec3"),a=this.getOrCreateUniform("float","uReflection");return this.getNode("Mult").inputs(r,this.getOrCreateMaterialSpecularColor(),a).outputs(n),n},getNormalMapNormal:function(){if(this.getOrCreateChannel("NormalMap")){var e=this.getOrCreateNormalizedFrontViewNormal(),t=this.getOrCreateNormalMap(),i=this.getOrCreateUniform("float","uNormalMapFactor"),r=this.createVariable("vec3");this.getNode("InlineCode").code("%out.xy = %factor * %input.xy;\n%out.z = %input.z;").inputs({input:t,factor:i}).outputs({out:r});var n=this.createVariable("vec3");return this.getNode("NormalTangentSpace").inputs({tangent:this.getOrCreateFrontViewTangent(),normal:e,texNormal:r}).outputs({normal:n}),n}},getBumpMapNormal:function(){var e=this.getOrCreateChannel("BumpMap");if(e){var t=this.getOrCreateNormalizedFrontViewNormal(),i=this.getOrCreateUniform("float","uBumpMapFactor"),r=this.createVariable("vec2");this.getNode("Mult").inputs(e,i).outputs(r);var n=this.createVariable("vec3");return this.getNode("Bumpmap").inputs({tangent:this.getOrCreateFrontViewTangent(),normal:t,gradient:r}).outputs({normal:n}),n}},getColorAtlasUV:function(e){var t=u.a.getColorPacking(e),i="";return i=0===t?"vec2(0.125, 0.5)":1===t?"vec2(0.375, 0.5)":2===t?"vec2(0.625, 0.5)":"vec2(0.875, 0.5)",this.getOrCreateConstant("vec2","uvColorAtlas"+t).setValue(i)},getOrCreateChannel:function(e){if(this._channels){var t="channel"+e,i=this.getVariable(t);if(i)return i;var r=this._channels[e];if(r.isEnableEffective()){var n=u.a.getDefaultFormat(e)===l.Texture.RGB,a=n?"vec3":"float";if("BumpMap"===e&&(a="vec2"),i=this.createVariable(a,t),!r.isEffective()){var o=this.getOrCreateConstantOne(a),s=this.getOrCreateUniform("float","u"+e+"Factor");return this.getNode("Mult").inputs(o,s).outputs(i),i}var c;if(!r.getTextureModel()&&u.a.getColorPacking(e)<0)c=this.getOrCreateConstantOne(a);else{var h=this._material.getChannelMapping(e);if(void 0===h||h<0)return;var d=this._textures[h],p=d.getName(),f=this.getVariable(p);void 0===f&&(f=this.getOrCreateSampler("sampler2D",p));var g;if("Matcap"===e)g=this.getOrCreateMatcapUV();else if(r.getColor())g=this.getColorAtlasUV(e);else{var m=r.getTexCoordUnit();g=this._fragmentShaderMode?this.getOrCreateVarying("vec2","vTexCoord"+m):this.getOrCreateAttribute("vec2","TexCoord"+m)}c=this.readChannel(e,f,g,d.getChannelPacking(e))}"Opacity"===e&&(c=this.getVertexAlpha(c));if("Opacity"===e&&!this.isAlphaBlendedMaterial()||"NormalMap"===e||"BumpMap"===e||"Displacement"===e)return this.getNode("SetFromNode").inputs(c).outputs(i),i;var v=this.getOrCreateUniform("float","u"+e+"Factor");return"SpecularColor"===e&&(v=this.applyAdjustSpecular(v)),"CavityPBR"===e||"AOPBR"===e||"Matcap"===e?this.applyInvertLerpFactor(c,v,i):(this.getNode("Mult").inputs(c,v).outputs(i),i)}}},getOrCreateMatcapUV:function(){var e=this.getVariable("uvMatcap");return e||(e=this.createVariable("vec2","uvMatcap"),this.getNode("NormalMatcap").inputs({normal:this.getOrCreateMaterialNormal(),eye:this.getOrCreateNormalizedViewEyeDirection()}).outputs({uv:e}),e)},applyAdjustSpecular:function(e){if(!this.getOrCreateChannel("NormalMap"))return e;var t=this.getOrCreateNormalMap(),i=this.createVariable("float");return this.getNode("AdjustSpecular").inputs({specular:e,normal:t}).outputs({specular:i}),i},applyInvertLerpFactor:function(e,t,i){return this.getNode("Blend").mode("MIX").inputs(this.getOrCreateConstantOne(e.getType()),e,t).outputs(i),i},readChannel:function(e,t,i,r){var n;switch(e){case"DiffuseColor":case"EmitColor":case"DiffuseIntensity":case"SpecularColor":case"NormalMap":case"Matcap":n=this.readTexture("vec3",e,t,i,r);break;case"Opacity":n=this.readTextureOpacity("float",e,t,i,r);break;case"SpecularHardness":case"Displacement":n=this.readTexture("float",e,t,i,r);break;case"BumpMap":n=this.createTextureChannelsGradient(e,t,i,r)}return n},getLinearTexel:function(e,t){if(!this._channels[e].getSRGB())return t;var i=this.createVariable(t.getType());return this.getNode("sRGBToLinear").inputs({color:t}).outputs({color:i}),i},readTexture:function(e,t,i,r,n){var a=this.createVariable(e),o="%color = texture2D(%sampler, %uv)."+n+";";return this.getNode("InlineCode").code(o).inputs({sampler:i,uv:r}).outputs({color:a}),this.getLinearTexel(t,a)},readTextureOpacity:function(e,t,i,r,n){var a=this.readTexture(e,t,i,r,n),o=this.createVariable("float");return this.getNode("InlineCode").code("%aout = %invert == 1 ? 1.0 - %alpha : %alpha;").inputs({alpha:a,invert:this.getOrCreateUniform("int","uOpacityInvert")}).outputs({aout:o}),o},createTextureChannelsGradient:function(e,t,i,r){var n=this.createVariable("vec2","gradient"+e),a=this._channels[e].getSRGB();return this.getNode("TextureGradient").setPackingRead(r).setSRGB(a).inputs({sampler:t,texSize:this.getOrCreateUniform("vec2","u"+e+"Size"),uv:i}).outputs({color:n}),n},getOrCreateProjectionMatrix:function(e){e=e||!1;var t=this.getVariable("jitteredProjection");if(t)return t;t=this.createVariable("mat4","jitteredProjection");var r=e?"(abs(%halton.z) == 2.0 ? 1.0 : 0.0) * ":"",n=[""," vec4 ndcPos = %jitteredProjection * %viewVertex;"," ndcPos.xyz /= ndcPos.w;"," float fact = 1.0;"," if( ndcPos.x > 0.0 && abs( %halton.z ) == 1.0 )","   fact = 0.0;"],a=i.i(s.a)().taaSplit?"fact * ":"",o=i.i(s.a)().taaSplit?n.join("\n"):"",u=["",o," %projMat = %jitteredProjection;"," float doPerp = %projMat[3][3] == 0.0 ? 1.0 : 0.0;"," float doOrtho = doPerp == 1.0 ? 0.0 : 1.0;"," vec2 halt = "+r+a+"( %halton.xy / %renderSize.xy );"," // persp"," %projMat[2][0] += doPerp * halt.x;"," %projMat[2][1] += doPerp * halt.y;"," // ortho"," %projMat[3][0] += doOrtho * halt.x;"," %projMat[3][1] += doOrtho * halt.y;",""];return this.getNode("InlineCode").code(u.join("\n")).inputs({jitteredProjection:this.getOrCreateUniform("mat4","uProjectionMatrix"),halton:this.getOrCreateUniform("vec4","uHalton"),renderSize:this.getOrCreateUniform("vec2","RenderSize"),viewVertex:this.getOrCreateViewVertex()}).outputs({projMat:t}),t},getOrCreateDisplacement:function(){var e=this.getVariable("displacement");if(e)return e;var t=this.getOrCreateChannel("Displacement");if(t){e=this.createVariable("float","displacement");return this.getNode("InlineCode").code("%out = (%displacement - 0.5) * %factor;").inputs({displacement:t,factor:this.getOrCreateUniform("float","uDisplacementFactor")}).outputs({out:e}),e}},displaceVertex:function(e,t){var r,n={vertex:e,displacement:this.getOrCreateDisplacement()};return i.i(s.a)().substanceDisplacement?r="%output = %vertex + vec3(0.0, 0.0, 1.0) * (%vertex.z > 0.01 ? %displacement : 0.0);":(r="%output = %vertex + %direction * %displacement;",n.direction=this.getOrCreateVertexNormalizedModelNormal()),this.getNode("InlineCode").code(r).inputs(n).outputs({output:t}),t},getOrCreateVertexNormalizedModelNormal:function(){var e=this._variables.vnModelNormal;if(e)return e;var t=this.createVariable("vec3","vnModelNormal");return this.getNode("Normalize").inputs({vec:h.prototype.getOrCreateModelNormal.call(this)}).outputs({vec:t}),t},displaceNormalCorrection:function(e,t){var i=this._channels.Displacement.getTexCoordUnit(),r=this._material.getChannelMapping("Displacement"),n=this._textures[r],a=n.getName(),o=this.getVariable(a),s=this.createTextureChannelsGradient("Displacement",o,this.getVariable("TexCoord"+i),n.getChannelPacking("Displacement")),u=this.createVariable("vec2");return this.getNode("Mult").inputs(s,this.getOrCreateUniform("float","uDisplacementNormal")).outputs(u),this.getNode("Bumpmap").inputs({tangent:this.getOrCreateModelTangent(),normal:e,gradient:u}).outputs({normal:t}),t},getOrCreateModelVertex:function(){if(!this.getOrCreateDisplacement())return h.prototype.getOrCreateModelVertex.call(this);var e=this._variables.displacedVertex;if(e)return e;e=this.createVariable("vec3","displacedVertex");var t=this.createVariable("vec3","modelVertex");return this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:t}),this.displaceVertex(t,e)},getOrCreateModelNormal:function(){if(!this.getOrCreateDisplacement()||this._channels.NormalMap.isEnableEffective())return h.prototype.getOrCreateModelNormal.call(this);var e=this._variables.displaceNormalCorrection;return e||(e=this.createVariable("vec3","displacedNormal"),this.displaceNormalCorrection(this.getOrCreateVertexNormalizedModelNormal(),e))},getOrCreateViewVertex:function(){if(!this.getOrCreateDisplacement())return h.prototype.getOrCreateViewVertex.call(this);var e=this._variables.viewVertex;return e||(e=this.createVariable("vec4","viewVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uViewMatrix"),vec:this.getOrCreateModelVertex()}).outputs({vec:e}),e)},getOrCreateViewNormal:function(){if(!this.getOrCreateDisplacement())return h.prototype.getOrCreateViewNormal.call(this);var e=this._variables.viewNormal;return e||(e=this.createVariable("vec3","viewNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat4","uViewMatrix"),vec:this.getOrCreateModelNormal()}).outputs({vec:e}),e)}}),"osgSketchfab","Compiler"),t.a=p},function(e,t,i){"use strict";var r=i(5),n=i(46),a=i(336),o=r.a.osg,s=r.a.osgDB,u=r.a.osgAnimation,l={},c={};l.uidGeometryMap={},l.hasPoints=!1,l.hasTriangles=!1,l.hasLines=!1,l.hasVertexNormals=!1;var h=[o.primitiveSet.TRIANGLES,o.primitiveSet.TRIANGLE_STRIP,o.primitiveSet.TRIANGLE_FAN],d=[o.primitiveSet.LINES,o.primitiveSet.LINE_LOOP,o.primitiveSet.LINE_STRIP],p={wireframe:!0,epsilon:!0,nphi:!0,attributes:!0,vertex_mode:!0,triangle_mode:!0,rigIndex:!0,framerate:!0,bx:!0,by:!0,bz:!0,hx:!0,hy:!0,hz:!0,ox:!0,oy:!0,oz:!0,ow:!0,ot:!0,channel_mode:!0};l.convertUserDataToObject=function(e,t){var i=t||{};if(!e)return i;for(var r=0,n=e.length;r<n;++r){var a=e[r],o=a.Name;p[o]||-1!==o.indexOf("_bbl_")||-1!==o.indexOf("_h_")||-1!==o.indexOf("_mode")?i[o]=JSON.parse(a.Value):i[o]=a.Value}return i};var f=function(){o.NodeVisitor.call(this)};o.createPrototypeObject(f,o.objectInherit(o.NodeVisitor.prototype,{apply:function(e){var t=e instanceof o.Geometry;if(t&&(void 0!==e._uniqueID&&(l.uidGeometryMap[e._uniqueID]=e),c[e.getInstanceID()]=e),t||e instanceof u.Bone){var i=e.userDataMap=l.convertUserDataToObject(e.getUserData()),r=e;if(e.getSourceGeometry&&(r=e.getSourceGeometry(),l.convertUserDataToObject(r.getUserData(),i)),r instanceof u.MorphGeometry)for(var n=r.getMorphTargets(),a=0,s=n.length;a<s;++a){var h=i["morph_"+a]={};l.convertUserDataToObject(n[a].getUserData(),h)}}return this.traverse(e)}}));var g=function(e,t){var i=t.getItemSize(),r=t.getElements(),n=1;1===r.BYTES_PER_ELEMENT?n=255:2===r.BYTES_PER_ELEMENT&&(n=65535);var o=!1,s=r.length,u=0;if(4===i){var l=!0,c=!0;for(u=3;u<s;u+=4){var h=r[u];if(0!==h&&(l=!1),h!==n&&(c=!1),!l&&!c)break}if(l&&4===i)for(u=3;u<s;u+=4)r[u]=n;o=!l&&!c}var d=!0;if(!o){var p=!0;for(u=0;u<s&&(r[u]!==n&&(p=!1),r[u+1]!==n&&(p=!1),r[u+2]!==n&&(p=!1),p);u+=i);p&&delete e.getVertexAttributeList().Color,d=!p}o&&(a.a.hasVertexAlpha=e.userDataMap.hasVertexAlpha=!0),d&&(a.a.hasVertexColor=!0)},m=function(e){for(var t=e.getPrimitiveSetList(),i=t.length,r=!1,n=!1,a=!1,s=void 0!==e.getVertexAttributeList().Normal,u=0;u<i;++u){var c=t[u].getMode();0!==t[u].getCount()&&(r||(r=c===o.primitiveSet.POINTS),a||(a=-1!==h.indexOf(c)),n||(n=-1!==d.indexOf(c)))}l.hasPoints||(l.hasPoints=r),l.hasTriangles||(l.hasTriangles=a),l.hasLines||(l.hasLines=n),l.hasVertexNormals||(l.hasVertexNormals=s),e.userDataMap.hasPoints=r,e.userDataMap.hasTriangles=a,e.userDataMap.hasLines=n},v=function(){var e=c;for(var t in e){var i=e[t];if(!i.userDataMap.wireframe){var r=i.getVertexAttributeList().Color;r&&g(i,r),m(i)}}};l.parse=function(e,t,i){return n.a.OSG_VERSION=e.Version,s.parseSceneGraph(e,t).then(function(e){var t=new f;return e.accept(t),i.then(v),e})},t.a=l},function(e,t,i){"use strict";var r=i(15),n=i(90),a=i(31),o=new r.a({hasTransparency:!1,hasExtra:!1}),s={},u=0;o.registerStateSetTransparency=function(e){var t=e.getInstanceID();s[t]||(s[t]=!0,u++,o.set("hasTransparency",u>0))},o.registerStateSetOpaque=function(e){var t=e.getInstanceID();s[t]&&(s[t]=!1,u--,o.set("hasTransparency",u>0))};var l=!1,c=!1,h=!1,d=function(){o.set("hasExtra",l||c||h||i.i(a.a)().debug3d||i.i(n.a)()||!i.i(a.a)().vrStereo)};o.setHotspot=function(e){c=e,d()},o.setWireframe=function(e){l=e,d()},o.setGizmo=function(e){h=e,d()},d(),t.a=o},function(e,t,i){!function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/logo.jinja"]=function(){function e(e,t,r,n,a){var o=null,s=null,u="";try{var l=null,c=n.makeMacro([],["headerStyle"],function(a){var o=r;r=new n.Frame,a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("headerStyle",a.hasOwnProperty("headerStyle")?a.headerStyle:"normal");var s="";return s+='\n<div class="logo">\n    <a class="link" href="/">\n        ',"inverted"==n.contextOrFrameLookup(t,r,"headerStyle")?(s+='\n        <img src="',s+=n.suppressValue(i(621),e.opts.autoescape),s+='" width="121" height="30" class="visual" alt="Sketchfab">\n        '):(s+='\n        <img src="',s+=n.suppressValue(i(620),e.opts.autoescape),s+='" width="121" height="30" class="visual" alt="Sketchfab">\n        '),s+="\n    </a>\n</div>\n",r=o,new n.SafeString(s)});t.addExport("header_logo"),t.setVariable("header_logo",c),u+="\n\n\n";var h=n.makeMacro([],[],function(i){var a=r;r=new n.Frame,i=i||{},i.hasOwnProperty("caller")&&r.set("caller",i.caller);var u="";return u+='\n<div class="logo">\n    <a href="/">\n        ',u+=n.suppressValue((o=16,s=13,n.callWrap(n.contextOrFrameLookup(t,r,"logo"),"logo",t,[96,20])),e.opts.autoescape),u+="\n    </a>\n</div>\n",r=a,new n.SafeString(u)});t.addExport("responsive_header_logo"),t.setVariable("responsive_header_logo",h),u+="\n\n\n";var d=n.makeMacro(["width","height"],["options"],function(i,a,o){var s=r;r=new n.Frame,o=o||{},o.hasOwnProperty("caller")&&r.set("caller",o.caller),r.set("width",i),r.set("height",a),r.set("options",o.hasOwnProperty("options")?o.options:{});var u="";u+="\n\n    ";var l;if(l=e.getFilter("merge").call(t,{brand:!0,color:"#555555"},n.contextOrFrameLookup(t,r,"options")),r.set("options",l,!0),r.topLevel&&t.setVariable("options",l),r.topLevel&&t.addExport("options",l),u+="\n\n    ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"brand")){u+="\n        ";var c;c=121,r.set("view_width",c,!0),r.topLevel&&t.setVariable("view_width",c),r.topLevel&&t.addExport("view_width",c),u+="\n    "}else{u+="\n        ";var h;h=25,r.set("view_width",h,!0),r.topLevel&&t.setVariable("view_width",h),r.topLevel&&t.addExport("view_width",h),u+="\n    "}return u+='\n\n    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\n         x="0" y="0" width="',u+=n.suppressValue(i,e.opts.autoescape),u+='" height="',u+=n.suppressValue(a,e.opts.autoescape),u+='"\n         viewBox="0 0 ',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"view_width"),e.opts.autoescape),u+=' 25"\n         enable-background="new 0 0 ',u+=n.suppressValue(n.contextOrFrameLookup(t,r,"view_width"),e.opts.autoescape),u+=' 25">\n\n        ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"brand")&&(u+='\n            <g id="logo-text">\n                <path fill="',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"color"),e.opts.autoescape),u+='"\n                    d="M36.471,7.719c-1.526,0-2.289,0.504-2.289,1.512c0,0.448,0.189,0.791,0.567,1.029\n                       c0.378,0.238,1.263,0.582,2.656,1.029c1.393,0.448,2.37,0.956,2.93,1.522c0.56,0.567,0.84,1.438,0.84,2.615\n                       c0,1.498-0.455,2.632-1.365,3.401c-0.911,0.771-2.1,1.155-3.57,1.155c-1.092,0-2.429-0.168-4.011-0.504l-0.756-0.147l0.294-2.247\n                       c1.876,0.253,3.311,0.379,4.305,0.379c1.484,0,2.226-0.616,2.226-1.849c0-0.447-0.171-0.798-0.515-1.05s-1.025-0.525-2.047-0.819\n                       c-1.624-0.462-2.769-1.011-3.434-1.648s-0.998-1.522-0.998-2.657c0-1.428,0.434-2.492,1.302-3.192c0.868-0.7,2.058-1.05,3.57-1.05\n                       c1.036,0,2.352,0.14,3.948,0.42l0.756,0.147L40.65,8.056C38.676,7.832,37.283,7.719,36.471,7.719z"\n                />\n                <path fill="',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"color"),e.opts.autoescape),u+='"\n                    d="M46.068,19.731h-2.814v-14.7h2.814v8.358l1.071-0.189l2.079-3.969h3.15l-2.73,4.977l2.877,5.523h-3.171\n                       l-2.121-4.095l-1.155,0.188V19.731z"\n                />\n                <path fill="',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"color"),e.opts.autoescape),u+='"\n                    d="M56.705,17.075c0.329,0.287,0.801,0.431,1.417,0.431c1.302,0,2.464-0.042,3.486-0.126l0.589-0.063\n                       l0.041,2.079c-1.61,0.392-3.066,0.588-4.368,0.588c-1.582,0-2.73-0.42-3.444-1.26c-0.714-0.84-1.071-2.205-1.071-4.095\n                       c0-3.766,1.547-5.649,4.641-5.649c3.052,0,4.578,1.582,4.578,4.746l-0.209,1.953H56.19C56.204,16.322,56.375,16.788,56.705,17.075z\n                       M59.802,13.536c0-0.84-0.133-1.424-0.399-1.753c-0.266-0.329-0.732-0.493-1.396-0.493c-0.666,0-1.134,0.171-1.407,0.514\n                       c-0.273,0.343-0.417,0.921-0.431,1.732H59.802z"\n                />\n                <path fill="',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"color"),e.opts.autoescape),u+='"\n                    d="M70.407,11.625h-2.583v4.305c0,0.42,0.011,0.718,0.031,0.893c0.021,0.175,0.098,0.325,0.231,0.451\n                       c0.133,0.126,0.339,0.189,0.619,0.189l1.596-0.042l0.126,2.246c-0.938,0.211-1.651,0.315-2.142,0.315\n                       c-1.26,0-2.121-0.283-2.583-0.851c-0.462-0.566-0.693-1.613-0.693-3.14v-4.368h-1.238V9.231h1.238V6.312h2.814v2.919h2.583V11.625z"\n                />\n                <path fill="',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"color"),e.opts.autoescape),u+='"\n                    d="M76.161,8.979c0.729,0,1.659,0.112,2.794,0.336l0.566,0.126l-0.084,2.226\n                       c-1.106-0.112-1.925-0.168-2.457-0.168c-0.966,0-1.606,0.207-1.921,0.62c-0.315,0.413-0.473,1.193-0.473,2.341\n                       c0,1.148,0.157,1.937,0.473,2.363c0.314,0.427,0.962,0.641,1.942,0.641l2.436-0.168l0.084,2.246\n                       c-1.498,0.295-2.639,0.441-3.423,0.441c-1.554,0-2.671-0.438-3.35-1.312s-1.019-2.278-1.019-4.211c0-1.932,0.35-3.328,1.05-4.189\n                       S74.607,8.979,76.161,8.979z"\n                />\n                <path fill="',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"color"),e.opts.autoescape),u+='"\n                    d="M84.414,19.731H81.6v-14.7h2.814v4.704c0.966-0.504,1.834-0.756,2.604-0.756c1.4,0,2.366,0.413,2.898,1.239\n                       c0.531,0.826,0.798,2.1,0.798,3.822v5.691h-2.814v-5.628c0-0.882-0.104-1.536-0.314-1.963s-0.63-0.641-1.26-0.641\n                       c-0.546,0-1.093,0.084-1.639,0.252l-0.272,0.084V19.731z"\n                />\n                <path fill="',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"color"),e.opts.autoescape),u+='"\n                    d="M96.531,11.625v8.106h-2.814v-8.106h-1.134V9.231h1.134V8.77c0-1.512,0.224-2.555,0.672-3.129\n                       s1.246-0.861,2.395-0.861c0.504,0,1.155,0.07,1.953,0.21l0.44,0.063l-0.042,2.289c-0.616-0.028-1.134-0.042-1.554-0.042\n                       s-0.7,0.112-0.84,0.336c-0.141,0.224-0.21,0.609-0.21,1.155v0.441h2.541v2.394H96.531z"\n                />\n                <path fill="',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"color"),e.opts.autoescape),u+='"\n                    d="M108.753,12.507v4.368c0.028,0.337,0.084,0.571,0.168,0.704s0.259,0.228,0.525,0.283l-0.084,2.121\n                       c-0.714,0-1.285-0.049-1.712-0.146c-0.427-0.099-0.857-0.295-1.291-0.589c-1.008,0.49-2.037,0.735-3.087,0.735\n                       c-2.171,0-3.255-1.147-3.255-3.444c0-1.119,0.301-1.914,0.902-2.383c0.603-0.469,1.526-0.746,2.772-0.83l2.247-0.168v-0.651\n                       c0-0.434-0.099-0.731-0.294-0.893c-0.196-0.161-0.512-0.241-0.945-0.241l-3.948,0.168l-0.084-1.953\n                       c1.498-0.406,2.923-0.609,4.273-0.609c1.352,0,2.324,0.28,2.919,0.84C108.456,10.379,108.753,11.276,108.753,12.507z\n                       M104.028,15.279c-0.784,0.07-1.176,0.49-1.176,1.26c0,0.771,0.343,1.155,1.028,1.155c0.532,0,1.113-0.084,1.743-0.252l0.315-0.084\n                       v-2.247L104.028,15.279z"\n                />\n                <path fill="',u+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"color"),e.opts.autoescape),u+='"\n                    d="M116.522,8.979c1.47,0,2.545,0.402,3.224,1.208s1.019,2.244,1.019,4.316c0,2.071-0.392,3.503-1.176,4.294\n                       s-2.136,1.187-4.053,1.187c-0.603,0-1.701-0.07-3.298-0.21l-0.798-0.084V5.031h2.814v4.515\n                       C115.15,9.168,115.906,8.979,116.522,8.979z M115.536,17.464c0.938,0,1.567-0.228,1.89-0.683s0.482-1.271,0.482-2.447\n                       c0-1.89-0.588-2.834-1.764-2.834c-0.56,0-1.092,0.07-1.596,0.21l-0.294,0.063v5.607C114.898,17.436,115.325,17.464,115.536,17.464z"\n                />\n            </g>\n        '),u+='\n\n        <g>\n            <path fill="#FFFFFF"\n                  d="M12.5,0.833C6.056,0.833,0.834,6.057,0.834,12.5S6.056,24.167,12.5,24.167S24.167,18.943,24.167,12.5\n                     S18.944,0.833,12.5,0.833z" />\n        </g>\n\n        <g id="logo-circle">\n            <path fill="#1CAAD9"\n                d="M12.5-0.029C5.596-0.029,0,5.568,0,12.472c0,6.904,5.596,12.501,12.5,12.501s12.5-5.597,12.5-12.501\n                   C25.001,5.568,19.405-0.029,12.5-0.029z M11.414,19.911L6.025,16.8v-6.276l5.389,2.911V19.911z M12.374,11.958l-6.376-3.38\n                   l6.376-3.682l6.377,3.682L12.374,11.958z M18.755,16.812l-5.369,3.1v-6.452l5.369-2.901V16.812z"\n            />\n        </g>\n\n    </svg>\n\n',r=s,new n.SafeString(u)});t.addExport("logo"),t.setVariable("logo",d),u+="\n",l?l.rootRenderFunc(e,t,r,n,a):a(null,u)}catch(e){a(n.handleError(e,o,s))}}return{root:e}}()}()},,,function(e,t,i){"use strict";t.a={name:"internal",domain:"/i",parse:function(e){return e.results||[]}}},function(e,t,i){"use strict";var r=i(15);t.a=r.a.extend({})},,function(e,t,i){var r,n;//! moment.js
//! version : 2.2.1
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
    (function(i){function a(e,t){return function(i){return h(e.call(this,i),t)}}function o(){}function s(e){l(this,e)}function u(e){var t=e.years||e.year||e.y||0,i=e.months||e.month||e.M||0,r=e.weeks||e.week||e.w||0,n=e.days||e.day||e.d||0,a=e.hours||e.hour||e.h||0,o=e.minutes||e.minute||e.m||0,s=e.seconds||e.second||e.s||0,u=e.milliseconds||e.millisecond||e.ms||0;this._input=e,this._milliseconds=+u+1e3*s+6e4*o+36e5*a,this._days=+n+7*r,this._months=+i+12*t,this._data={},this._bubble()}function l(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function c(e){return e<0?Math.ceil(e):Math.floor(e)}function h(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i}function d(e,t,i,r){var n,a,o=t._milliseconds,s=t._days,u=t._months;o&&e._d.setTime(+e._d+o*i),(s||u)&&(n=e.minute(),a=e.hour()),s&&e.date(e.date()+s*i),u&&e.month(e.month()+u*i),o&&!r&&V.updateOffset(e),(s||u)&&(e.minute(n),e.hour(a))}function p(e){return"[object Array]"===Object.prototype.toString.call(e)}function f(e,t){var i,r=Math.min(e.length,t.length),n=Math.abs(e.length-t.length),a=0;for(i=0;i<r;i++)~~e[i]!=~~t[i]&&a++;return a+n}function g(e){return e?ue[e]||e.toLowerCase().replace(/(.)s$/,"$1"):e}function m(e,t){return t.abbr=e,z[e]||(z[e]=new o),z[e].set(t),z[e]}function v(e){delete z[e]}function _(e){if(!e)return V.fn._lang;if(!z[e]&&j)try{!function(){var e=new Error('Cannot find module "./lang"');throw e.code="MODULE_NOT_FOUND",e}()}catch(e){return V.fn._lang}return z[e]||V.fn._lang}function b(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function x(e){var t,i,r=e.match(q);for(t=0,i=r.length;t<i;t++)de[r[t]]?r[t]=de[r[t]]:r[t]=b(r[t]);return function(n){var a="";for(t=0;t<i;t++)a+=r[t]instanceof Function?r[t].call(n,e):r[t];return a}}function S(e,t){return t=y(t,e.lang()),le[t]||(le[t]=x(t)),le[t](e)}function y(e,t){function i(e){return t.longDateFormat(e)||e}for(var r=5;r--&&(Y.lastIndex=0,Y.test(e));)e=e.replace(Y,i);return e}function C(e,t){switch(e){case"DDDD":return J;case"YYYY":return Q;case"YYYYY":return Z;case"S":case"SS":case"SSS":case"DDD":return K;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return $;case"a":case"A":return _(t._l)._meridiemParse;case"X":return ie;case"Z":case"ZZ":return ee;case"T":return te;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return X;default:return new RegExp(e.replace("\\",""))}}function T(e){var t=(ee.exec(e)||[])[0],i=(t+"").match(ae)||["-",0,0],r=60*i[1]+~~i[2];return"+"===i[0]?-r:r}function M(e,t,i){var r,n=i._a;switch(e){case"M":case"MM":null!=t&&(n[1]=~~t-1);break;case"MMM":case"MMMM":r=_(i._l).monthsParse(t),null!=r?n[1]=r:i._isValid=!1;break;case"D":case"DD":null!=t&&(n[2]=~~t);break;case"DDD":case"DDDD":null!=t&&(n[1]=0,n[2]=~~t);break;case"YY":n[0]=~~t+(~~t>68?1900:2e3);break;case"YYYY":case"YYYYY":n[0]=~~t;break;case"a":case"A":i._isPm=_(i._l).isPM(t);break;case"H":case"HH":case"h":case"hh":n[3]=~~t;break;case"m":case"mm":n[4]=~~t;break;case"s":case"ss":n[5]=~~t;break;case"S":case"SS":case"SSS":n[6]=~~(1e3*("0."+t));break;case"X":i._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=T(t)}null==t&&(i._isValid=!1)}function w(e){var t,i,r,n=[];if(!e._d){for(r=E(e),t=0;t<3&&null==e._a[t];++t)e._a[t]=n[t]=r[t];for(;t<7;t++)e._a[t]=n[t]=null==e._a[t]?2===t?1:0:e._a[t];n[3]+=~~((e._tzm||0)/60),n[4]+=~~((e._tzm||0)%60),i=new Date(0),e._useUTC?(i.setUTCFullYear(n[0],n[1],n[2]),i.setUTCHours(n[3],n[4],n[5],n[6])):(i.setFullYear(n[0],n[1],n[2]),i.setHours(n[3],n[4],n[5],n[6])),e._d=i}}function A(e){var t=e._i;e._d||(e._a=[t.years||t.year||t.y,t.months||t.month||t.M,t.days||t.day||t.d,t.hours||t.hour||t.h,t.minutes||t.minute||t.m,t.seconds||t.second||t.s,t.milliseconds||t.millisecond||t.ms],w(e))}function E(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function P(e){var t,i,r,n=_(e._l),a=""+e._i;for(r=y(e._f,n).match(q),e._a=[],t=0;t<r.length;t++)i=(C(r[t],e).exec(a)||[])[0],i&&(a=a.slice(a.indexOf(i)+i.length)),de[r[t]]&&M(r[t],i,e);a&&(e._il=a),e._isPm&&e._a[3]<12&&(e._a[3]+=12),!1===e._isPm&&12===e._a[3]&&(e._a[3]=0),w(e)}function N(e){var t,i,r,n,a,o=99;for(n=0;n<e._f.length;n++)t=l({},e),t._f=e._f[n],P(t),i=new s(t),a=f(t._a,i.toArray()),i._il&&(a+=i._il.length),a<o&&(o=a,r=i);l(e,r)}function F(e){var t,i=e._i,r=re.exec(i);if(r){for(e._f="YYYY-MM-DD"+(r[2]||" "),t=0;t<4;t++)if(ne[t][1].exec(i)){e._f+=ne[t][0];break}ee.exec(i)&&(e._f+=" Z"),P(e)}else e._d=new Date(i)}function R(e){var t=e._i,r=H.exec(t);t===i?e._d=new Date:r?e._d=new Date(+r[1]):"string"==typeof t?F(e):p(t)?(e._a=t.slice(0),w(e)):t instanceof Date?e._d=new Date(+t):"object"==typeof t?A(e):e._d=new Date(t)}function I(e,t,i,r,n){return n.relativeTime(t||1,!!i,e,r)}function O(e,t,i){var r=G(Math.abs(e)/1e3),n=G(r/60),a=G(n/60),o=G(a/24),s=G(o/365),u=r<45&&["s",r]||1===n&&["m"]||n<45&&["mm",n]||1===a&&["h"]||a<22&&["hh",a]||1===o&&["d"]||o<=25&&["dd",o]||o<=45&&["M"]||o<345&&["MM",G(o/30)]||1===s&&["y"]||["yy",s];return u[2]=t,u[3]=e>0,u[4]=i,I.apply({},u)}function L(e,t,i){var r,n=i-t,a=i-e.day();return a>n&&(a-=7),a<n-7&&(a+=7),r=V(e).add("d",a),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function D(e){var t=e._i,i=e._f;return null===t||""===t?null:("string"==typeof t&&(e._i=t=_().preparse(t)),V.isMoment(t)?(e=l({},t),e._d=new Date(+t._d)):i?p(i)?N(e):P(e):R(e),new s(e))}function k(e,t){V.fn[e]=V.fn[e+"s"]=function(e){var i=this._isUTC?"UTC":"";return null!=e?(this._d["set"+i+t](e),V.updateOffset(this),this):this._d["get"+i+t]()}}function B(e,t){V.duration.fn["as"+e]=function(){return+this/t}}for(var V,U,G=Math.round,z={},j=void 0!==e&&e.exports,H=/^\/?Date\((\-?\d+)/i,W=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,q=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,Y=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,X=/\d\d?/,K=/\d{1,3}/,J=/\d{3}/,Q=/\d{1,4}/,Z=/[+\-]?\d{1,6}/,$=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,ee=/Z|[\+\-]\d\d:?\d\d/i,te=/T/i,ie=/[\+\-]?\d+(\.\d{1,3})?/,re=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,ne=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ae=/([\+\-]|\d\d)/gi,oe="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),se={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},ue={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",W:"isoweek",M:"month",y:"year"},le={},ce="DDD w W M D d".split(" "),he="M D H h m s w W".split(" "),de={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return h(this.year()%100,2)},YYYY:function(){return h(this.year(),4)},YYYYY:function(){return h(this.year(),5)},gg:function(){return h(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return h(this.weekYear(),5)},GG:function(){return h(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return h(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return h(~~(this.milliseconds()/10),2)},SSS:function(){return h(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+h(~~(e/60),2)+":"+h(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+h(~~(10*e/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}};ce.length;)U=ce.pop(),de[U+"o"]=function(e,t){return function(i){return this.lang().ordinal(e.call(this,i),t)}}(de[U],U);for(;he.length;)U=he.pop(),de[U+U]=a(de[U],2);for(de.DDDD=a(de.DDD,3),l(o.prototype,{set:function(e){var t,i;for(i in e)t=e[i],"function"==typeof t?this[i]=t:this["_"+i]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,i,r;for(this._monthsParse||(this._monthsParse=[]),t=0;t<12;t++)if(this._monthsParse[t]||(i=V.utc([2e3,t]),r="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[t]=new RegExp(r.replace(".",""),"i")),this._monthsParse[t].test(e))return t},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,i,r;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;t<7;t++)if(this._weekdaysParse[t]||(i=V([2e3,1]).day(t),r="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[t]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,i){return e>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var i=this._calendar[e];return"function"==typeof i?i.apply(t):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,i,r){var n=this._relativeTime[i];return"function"==typeof n?n(e,t,i,r):n.replace(/%d/i,e)},pastFuture:function(e,t){var i=this._relativeTime[e>0?"future":"past"];return"function"==typeof i?i(t):i.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return L(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}}),V=function(e,t,i){return D({_i:e,_f:t,_l:i,_isUTC:!1})},V.utc=function(e,t,i){return D({_useUTC:!0,_isUTC:!0,_l:i,_i:e,_f:t}).utc()},V.unix=function(e){return V(1e3*e)},V.duration=function(e,t){var i,r,n=V.isDuration(e),a="number"==typeof e,o=n?e._input:a?{}:e,s=W.exec(e);return a?t?o[t]=e:o.milliseconds=e:s&&(i="-"===s[1]?-1:1,o={y:0,d:~~s[2]*i,h:~~s[3]*i,m:~~s[4]*i,s:~~s[5]*i,ms:~~s[6]*i}),r=new u(o),n&&e.hasOwnProperty("_lang")&&(r._lang=e._lang),r},V.version="2.2.1",V.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",V.updateOffset=function(){},V.lang=function(e,t){if(!e)return V.fn._lang._abbr;e=e.toLowerCase(),e=e.replace("_","-"),t?m(e,t):null===t?(v(e),e="en"):z[e]||_(e),V.duration.fn._lang=V.fn._lang=_(e)},V.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),_(e)},V.isMoment=function(e){return e instanceof s},V.isDuration=function(e){return e instanceof u},l(V.fn=s.prototype,{clone:function(){return V(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return S(V(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return null==this._isValid&&(this._a?this._isValid=!f(this._a,(this._isUTC?V.utc(this._a):V(this._a)).toArray()):this._isValid=!isNaN(this._d.getTime())),!!this._isValid},invalidAt:function(){var e,t=this._a,i=(this._isUTC?V.utc(this._a):V(this._a)).toArray();for(e=6;e>=0&&t[e]===i[e];--e);return e},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var t=S(this,e||V.defaultFormat);return this.lang().postformat(t)},add:function(e,t){var i;return i="string"==typeof e?V.duration(+t,e):V.duration(e,t),d(this,i,1),this},subtract:function(e,t){var i;return i="string"==typeof e?V.duration(+t,e):V.duration(e,t),d(this,i,-1),this},diff:function(e,t,i){var r,n,a=this._isUTC?V(e).zone(this._offset||0):V(e).local(),o=6e4*(this.zone()-a.zone());return t=g(t),"year"===t||"month"===t?(r=432e5*(this.daysInMonth()+a.daysInMonth()),n=12*(this.year()-a.year())+(this.month()-a.month()),n+=(this-V(this).startOf("month")-(a-V(a).startOf("month")))/r,n-=6e4*(this.zone()-V(this).startOf("month").zone()-(a.zone()-V(a).startOf("month").zone()))/r,"year"===t&&(n/=12)):(r=this-a,n="second"===t?r/1e3:"minute"===t?r/6e4:"hour"===t?r/36e5:"day"===t?(r-o)/864e5:"week"===t?(r-o)/6048e5:r),i?n:c(n)},from:function(e,t){return V.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)},fromNow:function(e){return this.from(V(),e)},calendar:function(){var e=this.diff(V().zone(this.zone()).startOf("day"),"days",!0),t=e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(t,this))},isLeapYear:function(){var e=this.year();return e%4==0&&e%100!=0||e%400==0},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?"string"==typeof e&&"number"!=typeof(e=this.lang().weekdaysParse(e))?this:this.add({d:e-t}):t},month:function(e){var t,i=this._isUTC?"UTC":"";return null!=e?"string"==typeof e&&"number"!=typeof(e=this.lang().monthsParse(e))?this:(t=this.date(),this.date(1),this._d["set"+i+"Month"](e),this.date(Math.min(t,this.daysInMonth())),V.updateOffset(this),this):this._d["get"+i+"Month"]()},startOf:function(e){switch(e=g(e)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoweek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoweek"===e&&this.isoWeekday(1),this},endOf:function(e){return e=g(e),this.startOf(e).add("isoweek"===e?"week":e,1).subtract("ms",1)},isAfter:function(e,t){return t=void 0!==t?t:"millisecond",+this.clone().startOf(t)>+V(e).startOf(t)},isBefore:function(e,t){return t=void 0!==t?t:"millisecond",+this.clone().startOf(t)<+V(e).startOf(t)},isSame:function(e,t){return t=void 0!==t?t:"millisecond",+this.clone().startOf(t)==+V(e).startOf(t)},min:function(e){return e=V.apply(null,arguments),e<this?this:e},max:function(e){return e=V.apply(null,arguments),e>this?this:e},zone:function(e){var t=this._offset||0;return null==e?this._isUTC?t:this._d.getTimezoneOffset():("string"==typeof e&&(e=T(e)),Math.abs(e)<16&&(e*=60),this._offset=e,this._isUTC=!0,t!==e&&d(this,V.duration(t-e,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},hasAlignedHourOffset:function(e){return e=e?V(e).zone():0,(this.zone()-e)%60==0},daysInMonth:function(){return V.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(e){var t=G((V(this).startOf("day")-V(this).startOf("year"))/864e5)+1;return null==e?t:this.add("d",e-t)},weekYear:function(e){var t=L(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=L(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=L(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this._d.getDay()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},get:function(e){return e=g(e),this[e.toLowerCase()]()},set:function(e,t){e=g(e),this[e.toLowerCase()](t)},lang:function(e){return e===i?this._lang:(this._lang=_(e),this)}}),U=0;U<oe.length;U++)k(oe[U].toLowerCase().replace(/s$/,""),oe[U]);k("year","FullYear"),V.fn.days=V.fn.day,V.fn.months=V.fn.month,V.fn.weeks=V.fn.week,V.fn.isoWeeks=V.fn.isoWeek,V.fn.toJSON=V.fn.toISOString,l(V.duration.fn=u.prototype,{_bubble:function(){var e,t,i,r,n=this._milliseconds,a=this._days,o=this._months,s=this._data;s.milliseconds=n%1e3,e=c(n/1e3),s.seconds=e%60,t=c(e/60),s.minutes=t%60,i=c(t/60),s.hours=i%24,a+=c(i/24),s.days=a%30,o+=c(a/30),s.months=o%12,r=c(o/12),s.years=r},weeks:function(){return c(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*~~(this._months/12)},humanize:function(e){var t=+this,i=O(t,!e,this.lang());return e&&(i=this.lang().pastFuture(t,i)),this.lang().postformat(i)},add:function(e,t){var i=V.duration(e,t);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(e,t){var i=V.duration(e,t);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(e){return e=g(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=g(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:V.fn.lang});for(U in se)se.hasOwnProperty(U)&&(B(U,se[U]),function(e){V.duration.fn[e]=function(){return this._data[e]}}(U.toLowerCase()));B("Weeks",6048e5),V.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},V.lang("en",{ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),V.lang("en"),j&&(e.exports=V),"undefined"==typeof ender&&(this.moment=V),r=[],(n=function(){return V}.apply(t,r))!==i&&(e.exports=n)}).call(this)},,function(e,t,i){e.exports=i.p+"by-7813b5794d8ba96aec20acb7f14ff76a.svg"},function(e,t,i){e.exports=i.p+"nc-e378f908a7f49e2a3812c0d4e70333dd.svg"},function(e,t,i){e.exports=i.p+"nd-7966b830678388d28550a10805a754db.svg"},function(e,t,i){e.exports=i.p+"sa-978acd9d54dfd3c39cd92e8acfe1fe7e.svg"},function(e,t,i){"use strict";t.a={getBaseVR:function(e){i.e(7).then(function(){e(i(1496).default)}.bind(null,i)).catch(i.oe)},getVrBrowserAssets:function(e){i.e(9).then(function(){e(i(1501).default)}.bind(null,i)).catch(i.oe)},getControllerVive:function(e){i.e(12).then(function(){e(i(1499).default)}.bind(null,i)).catch(i.oe)},getControllerDaydream:function(e){i.e(14).then(function(){e(i(1497).default)}.bind(null,i)).catch(i.oe)},getControllerOculusTouch:function(e){i.e(13).then(function(){e(i(1498).default)}.bind(null,i)).catch(i.oe)},getHuman:function(e){i.e(11).then(function(){e(i(1500).default)}.bind(null,i)).catch(i.oe)}}},,,function(e,t,i){"use strict";var r=i(15);t.a=r.a.extend({})},function(e,t,i){"use strict";function r(e){var t=[],r=i.i(n.debounce)(function(){var i=t.slice();t=[],e.trigger("afterAdd",i)},20),a=function(e){t.push(e),r()};return e.on("add",a),function(){e.off("add",a)}}t.a=r;var n=i(0);i.n(n)},function(e,t,i){"use strict";function r(e,t){e.__proto={},i.i(n.each)(t,function(t,i){"function"==typeof t?(e[i]&&(e.__proto[i]=e[i]),e[i]=t.bind(e)):e[i]=t})}t.a=r;var n=i(0);i.n(n)},function(e,t,i){"use strict";var r=["a","e","i","o","u","h"],n=function(e,t){var i,n,a,o;e<0?(i="in ",n=""):(i="",n=" ago");var s=Math.abs(e);return 1!==s?(a=s.toString(),o="s"):(a=-1!==r.indexOf(t[0])?"an ":"a ",o=""),i+a+" "+t+o+n},a={1e3:function(e){return n(e,"second")},6e4:function(e){return n(e,"minute")},36e5:function(e){return n(e,"hour")},864e5:function(e){return n(e,"day")},6048e5:function(e){return n(e,"week")},24192e5:function(e){return n(e,"month")},290304e5:function(e){return n(e,"year")}};t.a={timeAgo:function(e){var t=(new Date).getTime(),i=e.getTime(),r=t-i,n=null;Object.keys(a).forEach(function(e){e=parseInt(e),(null===n||e>n&&Math.floor(r/e)>=1)&&(n=e)});var o=Math.floor(r/n);return a[n](o)}}},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(21)),a=function(e){return n.a.parse(e.split("?")[1]||"").cursor},o=function(){var e={};return{get:function(t){return e[t]},update:function(t,i){i.results.forEach(function(i){e[i.uid]=t})}}},s=function(e,t){function n(){return{previousCursor:e.previous,currentCursor:e.current,nextCursor:e.next}}function s(e,t){return function(i){return t.isPrefetching||(u.update(e,i),l.currentCursor=e,t.setNext&&(l.nextCursor=i.next?a(i.next):null),t.setPrevious&&(l.previousCursor=i.previous?a(i.previous):null)),i}}var u=o(),l=n();return{type:"cursor",loadPrevious:function(e){return t(l.previousCursor,e).then(s(l.previousCursor,i.i(r.extend)({},e,{setPrevious:!0})))},loadNext:function(e){return t(l.nextCursor,e).then(s(l.nextCursor,i.i(r.extend)({},e,{setNext:!0})))},loadFirst:function(e){return l=n(),u=o(),t(l.current,e).then(s(l.current,i.i(r.extend)({},e,{setNext:!0,setPrevious:!0})))},hasPrevious:function(){return null!==l.previousCursor},hasNext:function(){return null!==l.nextCursor},isFirst:function(){return l.currentCursor===e.current},getQueryParamsForElementUid:function(e){return{cursor:u.get(e)}},setInitialQuery:function(e,t){var i=a(e);u.update(i,t)}}};t.a=s},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(21)),a=function(e){return n.a.parse(e.split("?")[1]||"").page},o=function(){var e={};return{get:function(t){return e[t]},update:function(t,i){i.results.forEach(function(i){e[i.uid]=t})}}},s=function(e,t){function n(){var t=i.i(r.isNumber)(e.lastPage)?e.lastPage:1/0,n=u(t,e.currentPageIndex);return{lastPage:t,currentPageIndex:n,hasPrevious:0!==n}}function s(e,t){return function(i){return t.isPrefetching||(l.update(e,i),c.currentPageIndex=e,i.previous||(c.hasPrevious=!1),i.next?c.lastPage=1/0:c.lastPage=e),i}}var u=function(e,t){return Math.min(e,Math.max(0,parseInt(t)||0))},l=o(),c=n();return{type:"offset",loadPrevious:function(e){var i=u(c.lastPage,c.currentPageIndex-1);return t(i,e).then(s(i,e))},loadNext:function(e){var i=u(c.lastPage,c.currentPageIndex+1);return t(i,e).then(s(i,e))},loadFirst:function(e){c=n(),l=o();return t(0,e).then(s(0,e))},hasPrevious:function(){return c.hasPrevious},hasNext:function(){return c.currentPageIndex+1<c.lastPage},isFirst:function(){return 0===c.currentPageIndex},getQueryParamsForElementUid:function(e){return{page:l.get(e)||""}},setInitialQuery:function(e,t){var i=a(e);l.update(i,t)}}};t.a=s},,,,,,,,,function(e,t,i){var r=i(878),n=function(e){e=e||"",e=decodeURIComponent(e);var t={};return e.split("&").forEach(function(e){if(e.indexOf("=")>-1){var i=e.split("=");t[i[0]]=i[1]}else t=e.indexOf(",")>-1?e.split(","):e}.bind(this)),t},a=function(e,t){var i=e;i.indexOf("#")>-1&&(i=i.slice(1));var r=i.split(";"),n=[];for(var a in r){var u=new s(o(r[a]));u.from&&u.from===t||!u.data||n.push(u)}return n},o=function(e){var t=e,i={};t.indexOf("#")>-1&&(t=t.slice(1));var r=t.split(":");return 1===r.length?i.data=r[0]:2===r.length?(i.from=r[0].toUpperCase(),i.data=r[1]):3===r.length&&(i.from=r[0].toUpperCase(),i.to=r[1].toUpperCase(),i.data=r[2]),i.data&&(i.stringData=i.data,i.data=n(i.data)),i._originalString=e+";",i},s=function(e){var t=e;"string"==typeof e&&(t=o(e)),this._msg=t,this.from=t.from,this.to=t.to,this.data=u(t.data)},u=function(e){return"string"==typeof e?e=decodeURIComponent(e):Array.isArray(e)?e=e.map(decodeURIComponent):"object"===(typeof e).toLowerCase()&&Object.keys(e).forEach(function(t){"string"==typeof e[t]?e[t]=decodeURIComponent(e[t]):Array.isArray(e[t])&&(e[t]=e[t].map(decodeURIComponent))}.bind(this)),e};s.prototype._getStringifiedData=function(){var e="";if("string"==typeof this.data)return encodeURIComponent(this.data);if(Array.isArray(this.data))return this.data.map(encodeURIComponent).join(",");if("object"==typeof this.data)for(var t in this.data){var i;"string"==typeof this.data[t]?i=encodeURIComponent(this.data[t]):Array.isArray(this.data[t])&&(i=this.data[t].map(encodeURIComponent).join(",")),e+=t+"="+i}return e},s.prototype.toString=function(){var e="";return this.from&&(e+=this.from+":"),this.to&&(e+=this.to+":"),e+=this._getStringifiedData()+";"};var l=function(e){if(e=e||{},!e.device)throw new Error('ViewerHashAPI options need to contain the "device" identifier property');e.listen&&this.listen(e.listen),this.device=e.device};l.prototype.appendToHash=function(e,t){e instanceof s&&(e=e.toString()),"string"==typeof e&&(t=c(t),-1===t.location.hash.indexOf(e)&&(t.location.hash=t.location.hash+e))},l.prototype.removeFromHash=function(e,t){if(!(e instanceof s))throw new Error("Please supply an instance of ViewerHashMessage");t=c(t);var i=t.location.hash;i=e._msg&&e._msg._originalString?i.replace(e._msg._originalString,""):i.replace(e.toString(),""),t.location.hash=i};var c=function(e){if(e=(!0===e?window:e)||window,e&&e.tagName&&"iframe"===e.tagName.toLowerCase()&&(e=e.contentWindow),!e.addEventListener)throw new Error("Could not bind an event to supplied target. Please supply an instance of window or an iframe.");return e};l.prototype.listen=function(e){return e=c(e),e.addEventListener("hashchange",this._onHashChange.bind(this,e),!1)},l.prototype._onHashChange=function(e){(this.getMessages(e.location.hash).messages||[]).forEach(function(e){if(e)if(e.data&&!Array.isArray(e)){var t=e.data;if("object"==typeof e.data){var i=Object.keys(e.data);t=e.data._key?e.data._key:i[0]}t&&this.trigger("message:"+t,e)}else this.trigger("message",e)}.bind(this))},l.prototype.getMessages=function(e){var t=a(e,this.device),i=e;for(var r in t)i=t[r]._msg&&t[r]._msg._originalString?i.replace(t[r]._msg._originalString,""):i.replace(t[r].toString(),"");return{messages:t,hash:i}},l.prototype.createMessage=function(e){return e=e||{},e.from=this.device,new s(e)},r.mixin(l.prototype),s.prototype.removeFromHash=function(){l.prototype.removeFromHash.call(this,this)},s.prototype.appendToHash=function(){l.prototype.appendToHash.call(this,this)},e.exports=l},,function(e,t,i){"use strict";var r=i(363),n=i(8).vec3,a=i(8).mat4,o=function(){this._center=n.create(),this._radius=-1};o.prototype={init:function(){n.init(this._center),this._radius=-1},valid:function(){return this._radius>=0},set:function(e,t){this._center=e,this._radius=t},center:function(){return this._center},radius:function(){return this._radius},radius2:function(){return this._radius*this._radius},expandByBoundingBox:function(){var e=n.create(),t=new r;return function(i){if(i.valid())if(this.valid()){n.copy(t._min,i._min),n.copy(t._max,i._max);for(var r=0;r<8;r++)n.sub(e,i.corner(r,e),this._center),n.normalize(e,e),n.scaleAndAdd(e,this._center,e,-this._radius),t.expandByvec3(e);t.center(this._center),this._radius=t.radius()}else i.center(this._center),this._radius=i.radius()}}(),expandByvec3:function(){var e=n.create();return function(t){if(this.valid()){n.sub(e,t,this.center(e));var i=n.length(e);if(i>this.radius()){var r=.5*(i-this.radius());this._center[0]+=e[0]*(r/i),this._center[1]+=e[1]*(r/i),this._center[2]+=e[2]*(r/i),this._radius+=r}}else this._center[0]=t[0],this._center[1]=t[1],this._center[2]=t[2],this._radius=0}}(),expandRadiusBySphere:function(e){if(e.valid())if(this.valid()){var t=n.distance(this._center,e._center)+e._radius;t>this._radius&&(this._radius=t)}else n.copy(this._center,e._center),this._radius=e._radius},expandByBoundingSphere:function(e){if(e.valid()){if(!this.valid())return this._center[0]=e._center[0],this._center[1]=e._center[1],this._center[2]=e._center[2],void(this._radius=e.radius());var t=n.distance(e.center(),this.center());if(!(t+e.radius()<=this.radius())){if(t+this.radius()<=e.radius())return this._center[0]=e._center[0],this._center[1]=e._center[1],this._center[2]=e._center[2],void(this._radius=e._radius);var i=.5*(this.radius()+t+e.radius()),r=(i-this.radius())/t;this._center[0]+=(e._center[0]-this._center[0])*r,this._center[1]+=(e._center[1]-this._center[1])*r,this._center[2]+=(e._center[2]-this._center[2])*r,this._radius=i}}},contains:function(e){return!!this.valid()&&n.sqrDist(this.center(),e)<=this.radius2()},intersects:function(e){if(!this.valid()||!e.valid())return!1;var t=this.radius()+e.radius();return n.sqrDist(e.center(),this.center())<=t*t},transformMat4:function(){var e=n.create();return function(t,i){if(!this.valid())return t;t._center!==this._center&&(n.copy(t._center,this._center),t._radius=this._radius);var r=t._center,o=t._radius;return a.getSqrScale(e,i),o*=Math.sqrt(Math.max(Math.max(e[0],e[1]),e[2])),t._radius=o,n.transformMat4(r,r,i),t}}()},e.exports=o},function(e,t,i){"use strict";var r=function(){this._gl=void 0};r.prototype={setGraphicContext:function(e){this._gl=e},getGraphicContext:function(){return this._gl}},e.exports=r},function(e,t,i){"use strict";var r=i(8).mat4,n=function(){this._stack=[r.create()],this._current=0};n.prototype={reset:function(){this._current=0},get:function(){var e=this._stack[this._current++];return this._current===this._stack.length&&this._stack.push(r.create()),e}},e.exports=n},function(e,t,i){"use strict";var r=i(14),n=i(8).vec4,a=i(8).vec3,o=r.objectInherit(n,{INSIDE:1,INTERSECT:2,OUTSIDE:3,transformProvidingInverse:function(){var e=o.create();return function(t,i){var r=t[0],n=t[1],a=t[2],s=t[3];return e[0]=i[0]*r+i[1]*n+i[2]*a+i[3]*s,e[1]=i[4]*r+i[5]*n+i[6]*a+i[7]*s,e[2]=i[8]*r+i[9]*n+i[10]*a+i[11]*s,e[3]=i[12]*r+i[13]*n+i[14]*a+i[15]*s,o.normalizeEquation(e),o.copy(e,t),t}},normalizeEquation:function(e){var t=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t},getNormal:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},setNormal:function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2]},getDistance:function(e){return e[3]},setDistance:function(e,t){e[3]=t},distanceToPlane:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]},intersectsOrContainsBoundingSphere:function(e,t){if(!t.valid())return o.OUTSIDE;var i=t.center(),r=t.radius(),n=this.distanceToPlane(e,i);return n<-r?o.OUTSIDE:n<=r?o.INTERSECT:o.INSIDE},instersectsBoundingSphere:function(e,t){return this.intersectsOrContainsBoundingSphere(e,t)===o.INTERSECT},intersectsOrContainsBoundingBox:function(){var e=a.create();return function(t,i){var r=(t[0]>=0?1:0)|(t[1]>=0?2:0)|(t[2]>=0?4:0),n=7&~r;return this.distanceToPlane(t,i.corner(n,e))>0?o.INSIDE:this.distanceToPlane(t,i.corner(r,e))<0?o.OUTSIDE:o.INTERSECT}}(),intersectsBoundingBox:function(e,t,i){return this.intersectsOrContainsBoundingBox(e,t,i)===o.INTERSECT},intersectOrContainsVertices:function(e,t){for(var i=-1,r=0;r<t.length;r++){var n=this.distanceToPlane(e,t[r]);if(n<0){if(1===i)return o.INTERSECT;i=2}else{if(!(n>0))return o.INTERSECT;if(2===i)return o.INTERSECT;i=1}}return i>0?o.INSIDE:o.OUTSIDE},intersectVertices:function(e,t){return this.intersectOrContainsVertices(e,t)===o.INTERSECT}});e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(68),a=i(8).mat4,o=i(8).vec3,s=function(e,t,i,r){n.call(this),this._x=void 0!==e?e:0,this._y=void 0!==t?t:0,this._width=void 0!==i?i:800,this._height=void 0!==r?r:600};r.createPrototypeStateAttribute(s,r.objectInherit(n.prototype,{attributeType:"Viewport",cloneType:function(){return new s},apply:function(e){e.getGraphicContext().viewport(this._x,this._y,this._width,this._height)},setViewport:function(e,t,i,r){this._x=e,this._y=t,this._width=i,this._height=r},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height},computeWindowMatrix:function(){var e=a.create(),t=a.create(),i=o.create();return function(r){a.fromTranslation(e,o.ONE),a.fromScaling(t,[.5*this._width,.5*this._height,.5]);var n=a.fromTranslation(r,o.set(i,this._x,this._y,0));return a.mul(n,n,a.mul(t,t,e))}}()}),"osg","Viewport"),e.exports=s},function(e,t,i){"use strict";var r=function(e,t,i){return Math.min(i,Math.max(t,e))},n=function(e,t,i){if(i<=e)return 0;if(i>=t)return 1;var r=(i-e)/(t-e);return r*r*(3-2*r)},a=function(e){return e!==e};e.exports={clamp:r,smoothStep:n,isNaN:a}},function(e,t,i){"use strict";var r=i(14),n=i(8).vec3,a=i(363),o=i(8).mat4,s=i(165),u=i(573),l=function(e){void 0!==e&&this.setName(e),s.call(this),this._invBindInSkeletonSpace=o.create(),this._boneInSkeletonSpace=o.create(),this._boneBoundingBox=new a};r.createPrototypeNode(l,r.objectInherit(s.prototype,{getOrCreateDebugColor:function(){return this._boneColor?this._boneColor:(this._boneColor=n.fromValues(Math.random(),Math.random(),Math.random()),this._boneColor)},getBoneBoundingBox:function(){return this._boneBoundingBox},setBoneBoundingBox:function(e){this._boneBoundingBox=e},getMatrixInSkeletonSpace:function(){return this._boneInSkeletonSpace},getInvBindMatrixInSkeletonSpace:function(){return this._invBindInSkeletonSpace},setMatrixInSkeletonSpace:function(e){o.copy(this._boneInSkeletonSpace,e)},setInvBindMatrixInSkeletonSpace:function(e){o.copy(this._invBindInSkeletonSpace,e)},getBoneParent:function(){for(var e=this.getParents(),t=0,i=e.length;t<i;t++){if(e[t].getTypeID()===l.getTypeID())return e[t]}},setDefaultUpdateCallback:function(e){this.addUpdateCallback(new u(void 0!==e?e:this.getName()))}}),"osgAnimation","Bone"),e.exports=l},function(e,t,i){"use strict";var r=i(14),n=i(8).vec3,a=i(145),o=i(30),s=i(8).mat4,u=i(293),l=i(385),c=i(902),h=i(900),d=i(456),p=i(455),f=function(){a.call(this),this._shape=null,this.addUpdateCallback(new c),this._root=void 0,this._pathToRoot=void 0,this._isAnimatedPath=!1,this._boneNameID={},this._matrixFromSkeletonToGeometry=s.create(),this._invMatrixFromSkeletonToGeometry=s.create(),this._rigTransformImplementation=new h,this._stateSetAnimation=new u,this._needToComputeMatrix=!0};r.createPrototypeNode(f,r.objectInherit(a.prototype,{getStateSetAnimation:function(){return this._stateSetAnimation},getSkeleton:function(){return this._root},setSkeleton:function(e){this._root=e},setPathToSkeleton:function(e){this._pathToRoot=e,this._isAnimatedPath=d.checkPathIsAnimated(e)},setNeedToComputeMatrix:function(e){this._needToComputeMatrix=e},getNeedToComputeMatrix:function(){return this._needToComputeMatrix},computeBoundingBox:function(e){e.init();var t=this.getVertexAttributeList().Vertex,i=this.getVertexAttributeList().Weights;if(t&&i&&t.getElements()&&t.getItemSize()>2){for(var r=i.getElements(),n=t.getElements(),a=t.getItemSize(),o=e.getMin(),s=e.getMax(),u=o[0],l=o[1],c=o[2],h=s[0],d=s[1],p=s[2],f=0,g=0,m=n.length;f<m;f+=a,g+=4)if(0===r[f]&&0===r[f+1]&&0===r[f+2]&&0===r[f+3]){var v=n[f],_=n[f+1],b=n[f+2];v<u&&(u=v),v>h&&(h=v),_<l&&(l=_),_>d&&(d=_),b<c&&(c=b),b>p&&(p=b)}o[0]=u,o[1]=l,o[2]=c,s[0]=h,s[1]=d,s[2]=p}return e},computeMatrixFromRootSkeleton:function(){if(!this._root)return void o.warn("Warning "+this.className()+".computeMatrixFromRootSkeleton if you have this message it means you miss to call buildTransformer( root ), or your RigGeometry ("+this.getName()+") is not attached to a Skeleton subgraph");s.identity(this._matrixFromSkeletonToGeometry),p.computeLocalToWorld(this._pathToRoot,!0,this._matrixFromSkeletonToGeometry),s.invert(this._invMatrixFromSkeletonToGeometry,this._matrixFromSkeletonToGeometry),this._isAnimatedPath||(this._needToComputeMatrix=!1)},getMatrixFromSkeletonToGeometry:function(){return this._matrixFromSkeletonToGeometry},getInvMatrixFromSkeletonToGeometry:function(){return this._invMatrixFromSkeletonToGeometry},getSourceGeometry:function(){return this._geometry},setSourceGeometry:function(e){this._geometry=e},getBoneNameID:function(){return this._boneNameID},setBoneNameID:function(e){this._boneNameID=e},mergeChildrenVertexAttributeList:function(){this._geometry instanceof l&&this._geometry.mergeChildrenVertexAttributeList();var e=this._geometry.getVertexAttributeList();a.appendVertexAttributeToList(e,this.getVertexAttributeList())},mergeChildrenData:function(){this.mergeChildrenVertexAttributeList();var e=this._geometry.getPrimitiveSetList();this.getPrimitiveSetList().length=0;for(var t=0,i=e.length;t<i;t++)this.getPrimitiveSetList()[t]=e[t];this.getStateSet()&&console.error("A stateset in the rig is already present : "+this.getStateSet()),this.setStateSet(this._geometry.getStateSet())},update:function(){this._rigTransformImplementation.update(this)},computeTransformedVertex:function(e,t){t=t||n.create();var i=this.getVertexAttributeList(),r=i.Weights.getElements(),a=i.Bones.getElements(),o=0,s=0,u=0;if(this._geometry.computeTransformedVertex)this._geometry.computeTransformedVertex(e,t),o=t[0],s=t[1],u=t[2];else{var l=i.Vertex.getElements();o=l[3*e],s=l[3*e+1],u=l[3*e+2]}for(var c=4*e,h=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),d=0,p=0,f=0,g=0,m=0,v=0,_=0,b=0,x=0,S=0,y=0,C=0,T=0,M=!1,w=0;w<4;++w){var A=r[c+w];if(0!==A){var E=12*a[c+w];d+=h[E+0]*A,g+=h[E+1]*A,_+=h[E+2]*A,S+=h[E+3]*A,p+=h[E+4]*A,m+=h[E+5]*A,b+=h[E+6]*A,y+=h[E+7]*A,f+=h[E+8]*A,v+=h[E+9]*A,x+=h[E+10]*A,C+=h[E+11]*A,T+=A,M=!0}}M||(t[0]=o,t[1]=s,t[2]=u);var P=1/T;return t[0]=(d*o+g*s+_*u+S)*P,t[1]=(p*o+m*s+b*u+y)*P,t[2]=(f*o+v*s+x*u+C)*P,t},computeTransformedVertices:function(){for(var e=this.getVertexAttributeList(),t=this._geometry.computeTransformedVertices?this._geometry.computeTransformedVertices():e.Vertex.getElements(),i=e.Weights.getElements(),r=e.Bones.getElements(),n=this._riggedVerts||new Float32Array(t.length),a=this._rigTransformImplementation._skinningAttribute.getMatrixPalette(),o=0,s=0,u=t.length;o<u;o+=3,s+=4){var l,c=0,h=0,d=0,p=0,f=0,g=0,m=0,v=0,_=0,b=0,x=0,S=0,y=0,C=!1,T=i[s];0!==T&&(l=12*r[s],c+=a[l+0]*T,p+=a[l+1]*T,m+=a[l+2]*T,b+=a[l+3]*T,h+=a[l+4]*T,f+=a[l+5]*T,v+=a[l+6]*T,x+=a[l+7]*T,d+=a[l+8]*T,g+=a[l+9]*T,_+=a[l+10]*T,S+=a[l+11]*T,y+=T,C=!0),T=i[s+1],0!==T&&(l=12*r[s+1],c+=a[l+0]*T,p+=a[l+1]*T,m+=a[l+2]*T,b+=a[l+3]*T,h+=a[l+4]*T,f+=a[l+5]*T,v+=a[l+6]*T,x+=a[l+7]*T,d+=a[l+8]*T,g+=a[l+9]*T,_+=a[l+10]*T,S+=a[l+11]*T,y+=T,C=!0),T=i[s+2],0!==T&&(l=12*r[s+2],c+=a[l+0]*T,p+=a[l+1]*T,m+=a[l+2]*T,b+=a[l+3]*T,h+=a[l+4]*T,f+=a[l+5]*T,v+=a[l+6]*T,x+=a[l+7]*T,d+=a[l+8]*T,g+=a[l+9]*T,_+=a[l+10]*T,S+=a[l+11]*T,y+=T,C=!0),T=i[s+3],0!==T&&(l=12*r[s+3],c+=a[l+0]*T,p+=a[l+1]*T,m+=a[l+2]*T,b+=a[l+3]*T,h+=a[l+4]*T,f+=a[l+5]*T,v+=a[l+6]*T,x+=a[l+7]*T,d+=a[l+8]*T,g+=a[l+9]*T,_+=a[l+10]*T,S+=a[l+11]*T,y+=T,C=!0);var M=t[o],w=t[o+1],A=t[o+2];if(C){var E=1/y;n[o]=(c*M+p*w+m*A+b)*E,n[o+1]=(h*M+f*w+v*A+x)*E,n[o+2]=(d*M+g*w+_*A+S)*E}else n[o]=M,n[o+1]=w,n[o+2]=A}return n}}),"osgAnimation","RigGeometry"),e.exports=f},function(e,t,i){"use strict";var r=i(8).vec3,n=i(8).quat,a=i(364),o=i(675),s={},u=function(e,t,i,r,n,a){var o=i[0],s=i[i.length-1];return a.start=o,a.keys=t,a.end=s,a.times=i,a.type=e,a.duration=s-o,a.target=r,a.name=n,a},l=function(e,t,i,r,n){return u(o.Vec3,e,t,i,r,n||{})},c=function(e,t,i,r,n){return u(o.Float,e,t,i,r,n||{})},h=function(e,t,i,r,n){return u(o.Quat,e,t,i,r,n||{})},d=function(e,t,i,r,n){return u(o.QuatSlerp,e,t,i,r,n||{})},p=function(e,t,i,r,n){return u(o.FloatCubicBezier,e,t,i,r,n||{})},f=function(e,t,i,r,n){return u(o.Vec3CubicBezier,e,t,i,r,n||{})},g={create:function(){return 0}},m={create:function(){return r.create32()}},v={create:function(){return n.create32()}},_=function(e,t){return{channel:t,value:e.create(),targetID:a.InvalidTargetID,weight:1,key:0,start:0,end:0}},b=function(e){return _(m,e)},x=function(e){return _(v,e)},S=function(e){return _(g,e)},y=function(e){return _(g,e)},C=function(e){return _(m,e)},T=function(e){return s[e.type](e)};s.createInstanceChannel=T,s.createInstanceVec3Channel=b,s.createInstanceQuatChannel=x,s.createInstanceQuatSlerpChannel=x,s.createInstanceFloatChannel=S,s.createInstanceFloatCubicBezierChannel=y,s.createInstanceVec3CubicBezierChannel=C,s.createVec3Channel=l,s.createQuatChannel=h,s.createQuatSlerpChannel=d,s.createFloatChannel=c,s.createFloatCubicBezierChannel=p,s.createVec3CubicBezierChannel=f,s[o.Vec3]=b,s[o.Quat]=x,s[o.QuatSlerp]=x,s[o.Float]=S,s[o.FloatCubicBezier]=y,s[o.Vec3CubicBezier]=C,s.ChannelType=o,e.exports=s},function(e,t,i){(function(t){var r=i(10),n=function(e,t){var i=r.defer(),n=new XMLHttpRequest;return n.open("GET",e,!0),t&&t.responseType&&(n.responseType=t.responseType),t&&t.progress&&n.addEventListener("progress",t.progress,!1),n.addEventListener("error",function(){i.reject()},!1),n.addEventListener("load",function(){"arraybuffer"===n.responseType||"blob"===n.responseType?i.resolve(n.response):i.resolve(n.responseText)}),n.send(null),i.promise},a=function(e,i){var r=t.defer(),n=new window.FileReader;return n.onload=function(e){if("blob"===i.responseType){var t=new window.Image;t.src=e.target.result,r.resolve(t)}else r.resolve(e.target.result)},i&&i.responseType?"arraybuffer"===i.responseType?n.readAsArrayBuffer(e):"string"===i.responseType?n.readAsText(e):n.readAsDataURL(e):n.readAsText(e),r.promise},o=function(e,t){return"string"==typeof e?n(e,t):a(e,t)};e.exports=o}).call(t,i(380))},function(e,t,i){"use strict";e.exports={NO_LIMIT:0,LIMIT_ONE_PER_DRAWABLE:1,LIMIT_ONE:2,POINT_PRIMITIVES:1,LINE_PRIMITIVES:2,TRIANGLE_PRIMITIVES:4,ALL_PRIMITIVES:7}},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(0),o=(i.n(a),i(19)),s=i.n(o),u=i(335);t.a={status:function(){return void 0===this.get("status")?this.pollStatus():n.a.resolve(this.get("status"))},pollStatus:function(){return new n.a(function(e,t){s.a.ajax({type:"GET",url:i.i(a.result)(this,"url")+"/status",allowPrefetching:!1}).then(function(t){var i={PENDING:0,PROCESSING:1,SUCCEEDED:2,FAILED:3}[t.processing.toUpperCase()];this.set("status",t),this.set("processingStatus",i),e(t)}.bind(this),t)}.bind(this))},checkStatus:function(){return this.pollStatus().then(function(e){return-1!==["SUCCEEDED","FAILED"].indexOf(e.processing.toUpperCase())?n.a.resolve(e):n.a.reject(e)}.bind(this),function(){return this.maxFailCount<=0?n.a.resolve({processing:"FAILED",error:"The server failed to answer in time"}):(this.maxFailCount-=1,n.a.reject("Server responded with an error"))}.bind(this))},checkStatusAndRetry:function(){var e=!0;return u.a.while(function(){return e},function(){return new n.a(function(t){this.checkStatus().then(function(i){e=!1,t(i)}).catch(function(){return n.a.delay(2e3).then(function(){t()})})}.bind(this))}.bind(this)).catch(function(){e=!1})}}},,,,function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=function(){n.Light.apply(this,arguments)};a.DIRECTION=n.Light.DIRECTION,a.SPOT=n.Light.SPOT,a.POINT=n.Light.POINT,a.HEMI=n.Light.HEMI,n.createPrototypeStateAttribute(a,n.objectInherit(n.Light.prototype,{attributeType:"SketchfabLight",isDirectionLight:function(){return 0===this._position[3]&&(-1===this._ground[3]||0===this._ground[3])}}),"osgSketchfab","Light");var o=n.vec3.create();n.LightSource.prototype.computeBoundingSphere=function(e){if(n.Node.prototype.computeBoundingSphere.call(this,e),!e.valid())return e;if(void 0!==this._light&&this._referenceFrame===n.Transform.RELATIVE_RF){var t=this._light.getPosition();0!==t[3]&&e.expandByVec3(n.vec3.scale(o,t,1/t[3]))}return e},t.a=a},,,,,function(e,t,i){i(40),i(41),i(348),i(47),i(390),function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/viewer.jinja"]=function(){function e(e,t,r,n,a){var o=null,s=null,u="";try{var l=null;e.getTemplate("skfb_front/macros/buttons.jinja",!1,"skfb_front/macros/viewer.jinja",!1,function(c,h){if(c)return void a(c);h.getExported(function(c,h){if(c)return void a(c);if(!h.hasOwnProperty("star_like_button"))return void a(new Error("cannot import 'star_like_button'"));var d=h.star_like_button;t.setVariable("star_like_button",d),u+="\n",e.getTemplate("skfb_front/macros/model.jinja",!1,"skfb_front/macros/viewer.jinja",!1,function(c,h){if(c)return void a(c);h.getExported(function(c,h){if(c)return void a(c);if(!h.hasOwnProperty("model_name"))return void a(new Error("cannot import 'model_name'"));var d=h.model_name;t.setVariable("model_name",d),u+="\n",e.getTemplate("skfb_front/macros/popovers.jinja",!1,"skfb_front/macros/viewer.jinja",!1,function(c,h){if(c)return void a(c);h.getExported(function(c,h){if(c)return void a(c);if(!h.hasOwnProperty("share_popover"))return void a(new Error("cannot import 'share_popover'"));var d=h.share_popover;t.setVariable("share_popover",d),u+="\n",e.getTemplate("skfb_front/macros/user.jinja",!1,"skfb_front/macros/viewer.jinja",!1,function(c,h){if(c)return void a(c);h.getExported(function(c,h){if(c)return void a(c);if(!h.hasOwnProperty("user_name"))return void a(new Error("cannot import 'user_name'"));var d=h.user_name;t.setVariable("user_name",d),u+="\n",e.getTemplate("skfb_front/macros/user.jinja",!1,"skfb_front/macros/viewer.jinja",!1,function(c,h){if(c)return void a(c);h.getExported(function(c,h){if(c)return void a(c);if(!h.hasOwnProperty("user_avatar"))return void a(new Error("cannot import 'user_avatar'"));var d=h.user_avatar;t.setVariable("user_avatar",d),u+="\n",e.getTemplate("skfb_front/macros/logo.jinja",!1,"skfb_front/macros/viewer.jinja",!1,function(c,h){if(c)return void a(c);h.getExported(function(c,h){if(c)return void a(c);if(!h.hasOwnProperty("logo"))return void a(new Error("cannot import 'logo'"));var d=h.logo;t.setVariable("logo",d),u+="\n\n\n";var p=n.makeMacro(["authUser","model"],["options"],function(i,a,u){var l=r;r=new n.Frame,u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var c="";return c+='\n\n    <div class="titlebar">\n\n        <div class="summary">\n            ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiInfos")&&(c+='\n                <div class="avatar">\n                    <a target="_blank" href="/models/',c+=n.suppressValue(n.memberLookup(a,"uid"),e.opts.autoescape),c+='">',c+=n.suppressValue((o=15,s=78,n.callWrap(n.contextOrFrameLookup(t,r,"user_avatar"),"user_avatar",t,[n.memberLookup(n.memberLookup(a,"user"),"avatars"),{size:32}])),e.opts.autoescape),c+='</a>\n                </div>\n                <div class="model-info">\n                    <h1 class="title">',c+=n.suppressValue((o=18,s=49,n.callWrap(n.contextOrFrameLookup(t,r,"model_name"),"model_name",t,[i,a,{target:"_blank",withRestrictedFlag:!1}])),e.opts.autoescape),c+='</h1>\n                    <h2>by <a target="_blank" href="/models/',c+=n.suppressValue(n.memberLookup(a,"uid"),e.opts.autoescape),c+='">',c+=n.suppressValue(n.memberLookup(n.memberLookup(a,"user"),"displayName"),e.opts.autoescape),c+="</a></h2>\n                </div>\n            "),c+='\n        </div>\n\n        <div class="actions">\n\n            ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiInfos")&&(c+='\n                <a class="help tooltip tooltip-down share" data-title="Share" data-action="open-share-overlay">\n                    <i class="custom-icons icon-ion-android-share-alt-icon"></i>\n                </a>\n            '),c+="\n\n            ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiStop")&&(c+='\n                <a class="help tooltip tooltip-down close hidden" data-title="Stop" data-action="stop">\n                    <i class="custom-icons icon-ion-close-round-icon"></i>\n                </a>\n            '),c+="\n\n        </div>\n\n    </div>\n\n",r=l,new n.SafeString(c)});t.addExport("viewer_infos"),t.setVariable("viewer_infos",p),u+="\n\n";var f=n.makeMacro(["authUser","model"],["options"],function(i,a,u){var l=r;r=new n.Frame,u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var c="";return c+="\n\n    ",n.memberLookup(a,"isDeleted")?c+='\n        <div class="viewer">\n            <div class="osd active">\n                <div class="content">\n                    <div class="panel">\n                        <p>This model has been deleted</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ':n.memberLookup(a,"isPublished")||n.memberLookup(n.memberLookup(a,"user"),"uid")==n.memberLookup(i,"uid")||n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"share")?(c+="\n        ",c+=n.suppressValue((o=57,s=20,n.callWrap(n.contextOrFrameLookup(t,r,"show_viewer"),"show_viewer",t,[i,a,n.contextOrFrameLookup(t,r,"options")])),e.opts.autoescape),c+="\n    "):c+='\n        <div class="viewer">\n            <div class="osd active">\n                <div class="content">\n                    <div class="panel">\n                        <p>This model has not been published yet</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    ',c+="\n\n",r=l,new n.SafeString(c)});t.addExport("viewer"),t.setVariable("viewer",f),u+="\n\n";var g=n.makeMacro(["authUser","model"],["options"],function(i,a,u){var l=r;r=new n.Frame,u=u||{},u.hasOwnProperty("caller")&&r.set("caller",u.caller),r.set("authUser",i),r.set("model",a),r.set("options",u.hasOwnProperty("options")?u.options:{});var c="";return c+='\n\n    <div class="viewer has-model ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"transparent")&&(c+=" transparent"),n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"autostart")&&(c+=" started"),c+='">\n\n        ',c+=n.suppressValue((o=76,s=21,n.callWrap(n.contextOrFrameLookup(t,r,"viewer_infos"),"viewer_infos",t,[i,a,n.contextOrFrameLookup(t,r,"options")])),e.opts.autoescape),c+='\n\n        <div class="landing" data-action="start">\n\n            <div class="preview">\n                ',c+=n.suppressValue(e.getFilter("image_container").call(t,n.memberLookup(a,"thumbnails"),1024,768,!0,!0),e.opts.autoescape),c+='\n            </div>\n\n            <div class="start-button">\n                <button class="play">\n                    <i class="fa fa-play"></i>\n                    <span class="label">3D</span>\n                </button>\n            </div>\n\n            ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiWatermark")&&(c+='\n                <div class="watermark">\n                    <a data-action="watermark" href="',c+=n.suppressValue(n.memberLookup(a,"viewerUrl"),e.opts.autoescape),c+='" title="View on Sketchfab" target="_blank"></a>\n                </div>\n            '),c+='\n\n        </div>\n\n        <div class="overlays">\n            ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"restricted")&&(c+='\n                <div class="overlay restricted">\n                    <div>\n                        <h3 class="heading">Age-restricted content</h3>\n                        <p>\n                            This 3D scene contains age-restricted content.<br/>\n                            You need to enable age-restricted content to view this.\n                        </p>\n                        <button type="submit" class="button btn-input btn-primary submit" data-action="allowRestricted">Enable age-restricted content</button>\n                        ',c+=n.suppressValue((o=109,s=29,n.callWrap(n.contextOrFrameLookup(t,r,"logo"),"logo",t,[121,25,{color:"#ffffff"}])),e.opts.autoescape),c+="\n                    </div>\n                </div>\n            "),c+='\n            <div class="overlay help hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <ul class="tabs">\n                        <li class="active"><a href="#" data-target="basic">Navigation basics</a></li>\n                        <li><a href="#" data-target="all">All controls</a></li>\n                    </ul>\n                    <div class="tabs-container">\n                        <div class="tab active" data-tab="basic">\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-refresh"></i>\n                                </div>\n                                <div>\n                                    <b>Orbit around</b>\n                                    <div>\n                                        Left click + drag or<br>\n                                        One finger drag (touch)\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-search-plus"></i>\n                                </div>\n                                <div>\n                                    <b>Zoom</b>\n                                    <div>\n                                        Double click on model<br>\n                                        or scroll anywhere or<br>\n                                        Pinch (touch)\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="tip">\n                                <div>\n                                    <i class="fa fa-arrows"></i>\n                                </div>\n                                <div>\n                                    <b>Pan</b>\n                                    <div>\n                                        Right click + drag or<br />\n                                        Two fingers drag (touch)\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="tab" data-tab="all">\n                            <div>\n                                <div class="section">\n                                    <h2>Orbit navigation</h2>\n                                    <b>Move camera:</b> 1 finger drag or Left Mouse Button<br>\n                                    <b>Pan:</b> 2-finger drag or Right Mouse Button or <kbd>SHIFT</kbd>+ Left Mouse Button<br>\n                                    <b>Zoom on object:</b> Double-tap or Double-click on object<br>\n                                    <b>Zoom out:</b> Double-tap or Double-click on background<br>\n                                    <b>Zoom:</b> Pinch in/out or Mousewheel or <kbd>CTRL</kbd> + Left Mouse Button<br>\n                                </div>\n                                <div class="section">\n                                    <h2>First-person navigation</h2>\n                                    <b>Move:</b> <kbd></kbd>,<kbd></kbd>,<kbd></kbd>,<kbd></kbd> (or <kbd>W</kbd>,<kbd>A</kbd>,<kbd>S</kbd>,<kbd>D</kbd>)<br>\n                                    <b>Look around:</b> 1-finger drag or Left Mouse Button<br>\n                                    <b>Adjust speed:</b> Mousewheel<br>\n                                </div>\n                                <div class="section rendering-shortcuts"></div>\n                                <div class="section">\n                                    <h2>Lighting</h2>\n                                    <b>Rotate lighting:</b> 3-finger drag or <kbd>ALT</kbd> + Left Mouse Button<br>\n                                    <b>Rotate env. only:</b> <kbd>ALT</kbd> + <kbd>SHIFT</kbd> + Left Mouse Button<br>\n                                </div>\n                                <div class="section annotation-shortcuts"></div>\n                                <div class="section animation-shortcuts"></div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="action">\n                        <button class="button" data-action="reset-camera">Reset camera view</button>\n                    </div>\n\n                </div>\n            </div>\n            <div class="overlay share hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <div class="share-link">\n                        <div class="text-field">\n                            <label>Link</label>\n                            <input type="text" class="text" value="" readonly>\n                            <button data-clipboard-target=".text-field .text">copy</button>\n                        </div>\n                    </div>\n                    <div class="share-social">\n                        <a data-action="share-on-facebook" target="_blank"><i class="fa fa-facebook"></i></a>\n                        <a data-action="share-on-twitter" target="_blank"><i class="fa fa-twitter"></i></a>\n                        <a data-action="share-on-reddit" target="_blank"><i class="fa fa-reddit"></i></a>\n                        <a data-action="share-on-tumblr" target="_blank"><i class="fa fa-tumblr"></i></a>\n                        <a data-action="share-on-google-plus" target="_blank"><i class="fa fa-google-plus"></i></a>\n                        <a data-action="share-on-linkedin" target="_blank"><i class="fa fa-linkedin"></i></a>\n                        <a data-action="share-on-pinterest" target="_blank"><i class="fa fa-pinterest"></i></a>\n                        <a class="share-mail" target="_blank"><i class="fa fa-envelope"></i></a>\n                    </div>\n                    <div class="share-embed">\n                        <a class="button" href="" target="_blank">\n                            <i class="fa fa-code"></i> Embed\n                        </a>\n                    </div>\n                </div>\n            </div>\n            <div class="overlay hotspots-overlay hidden">\n                <a href="#" class="close custom-icons icon-ion-close-round-icon"></a>\n                <div class="inner">\n                    <h4 class="hotspot-title"></h4>\n                    <div class="hotspot-content markdown-rendered-content"></div>\n                </div>\n            </div>\n            <div class="overlay helper-vr-overlay hidden">\n                <i class="custom-icons icon-ion-close-round-icon close"></i>\n                <div class="inner custom-scrollbar">\n                     <div class="header-helper">\n                        To view this model in virtual reality:\n                    </div>\n                    <div class="content-helper">\n                        <div class="row-helper">\n                            <div class="content-row">\n                                <div class="image"><i class="fa fa-mobile"></i></div>\n                                <div class="text">\n                                    <div class="title">on mobile phone</div>\n                                    <div>with Cardboard or similar</div>\n                                </div>\n                            </div>\n                            <ul class="info">\n                                <li>On your mobile, open this link: <a class="url" target="_blank" href="#"></a></li>\n                                <li>Press the VR icon</li>\n                                <li>Insert your mobile in a Cardboard headset</li>\n                            </ul>\n                        </div>\n                        <div class="row-helper">\n                            <div class="content-row">\n                                <div class="image"><i class="fa fa-desktop"></i></div>\n                                <div class="text">\n                                    <div class="title">on desktop PC <span class="flag --info">BETA</span></div>\n                                    <div>with a VR headset</div>\n                                </div>\n                            </div>\n                            <ul class="info">\n                                <li><a target="_blank" href="https://webvr.info/">Get a WebVR-compatible browser</a></li>\n                                <li>Enable WebVR</li>\n                                <li>Open this model</li>\n                                <li>Click on the VR icon</li>\n                            </ul>\n                        </div>\n                    </div>\n                    <div class="footer-helper">\n                        <a target="_blank" href="https://help.sketchfab.com/hc/en-us/articles/204777439-Mobile-VR-and-Desktop-WebVR?utm_source=website&amp;utm_campaign=vr_hints">\n                        More info on Virtual reality.\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class="webgl">\n\n            <canvas class="canvas" data-modelUid="',c+=n.suppressValue(n.memberLookup(a,"uid"),e.opts.autoescape),c+='" data-action="create-hotspot">\n            </canvas>\n\n            <div class="loading-container">\n                <div class="secondary-progress">\n                    <div class="secondary-progress-percentage"></div>\n                    <div class="secondary-progress-display"></div>\n                </div>\n                <div class="main-progress">\n                    <img src="',c+=n.suppressValue(e.getFilter("best_fit").call(t,n.memberLookup(a,"thumbnails"),64,36),e.opts.autoescape),c+='" class="loading-thumbnail" />\n                    <div class="main-progress-wrapper">\n                        <div class="main-progress-percentage loading-percentage">0%</div>\n                        <p>Loading 3D model</p>\n                        <progress class="main-progress-display" value="0" max="1"></progress>\n                    </div>\n                </div>\n            </div>\n\n            <div class="hotspots"></div>\n\n            <div class="gui">\n\n                <div class="animation-not-supported hidden">\n                    <a href="#" class="close"></a>\n                    <p>Model is too heavy for your device and can not be rendered properly</p>\n                </div>\n\n                ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiControls")&&n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiAnnotations")&&(c+='\n                    <div class="hotspot-controls-responsive">\n                        <div data-title="Previous Annotation" data-action="prev-annotation">\n                            <div class="icon fa fa-caret-left"></div>\n                        </div>\n                        <div data-title="Next Annotation" data-action="next-annotation">\n                            <div class="icon fa fa-caret-right"></div>\n                        </div>\n                    </div>\n                '),c+='\n\n                <div class="controls">\n\n                    ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiWatermark")&&(c+='\n                        <div class="watermark">\n                            <a data-action="watermark" href="',c+=n.suppressValue(n.memberLookup(a,"viewerUrl"),e.opts.autoescape),c+='" title="View on Sketchfab" target="_blank"></a>\n                        </div>\n                    '),c+="\n\n                    ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiControls")&&(c+="\n\n                        ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiAnimations")&&(c+='\n                            <div class="animation-controls widget ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiFadeout")||(c+="no-fadeout"),c+='">\n                                <div class="timeline">\n                                    <div class="timeline-wrapper">\n                                        <div class="track">\n                                            <div class="bar">\n                                            </div>\n                                            <div class="knob">\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <a href="#" class="control play fa"></a>\n                                <a href="#" class="control next fa"></a>\n                                <div class="animation-timer control progress help" data-unit="time">00:00.00</div>\n                                <div class="animation-list control has-menu">\n                                    <p class="animation-name"></p>\n                                    <div class="control-menu list">\n                                        <p class="static-pose animation-item" data-uid="-1">Static Pose</p>\n                                        <ul></ul>\n                                    </div>\n                                </div>\n                            </div>\n                        '),c+="\n\n                        ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiAnnotations")&&(c+='\n                            <div class="hotspot-controls widget ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiFadeout")||(c+="no-fadeout"),c+='">\n\n                                <div data-title="Previous Annotation" data-action="prev-annotation">\n                                    <div class="icon fa fa-caret-left"></div>\n                                </div>\n\n                                <div class="hotspot-name default has-menu" data-action="toggle-annotation-list">\n                                    Select an annotation\n                                </div>\n\n                                <div data-title="Next Annotation" data-action="next-annotation">\n                                    <div class="icon fa fa-caret-right"></div>\n                                </div>\n\n                                <div class="list hotspots-list js-pointable"></div>\n\n                            </div>\n                        '),c+='\n\n                        <div class="spacer"></div>\n\n                        ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiGeneralControls")&&(c+='\n                            <div class="general-controls widget ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiFadeout")||(c+="no-fadeout"),c+='">\n\n                                ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiHelp")&&(c+='\n                                    <a class="control tooltip help" data-title="Help">\n                                        <i class="fa fa-question"></i>\n                                    </a>\n                                '),c+="\n                                ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiSound")&&(c+='\n                                    <a class="control volume" title="Volume (M)" draggable="false">\n                                        <i class="fa fa-volume-up"></i>\n                                        <div class="volume-menu">\n                                        </div>\n                                    </a>\n                                '),c+="\n                                ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiSettings")&&(c+='\n                                    <a class="control tooltip settings has-menu" data-title="Settings">\n                                        <i class="fa fa-gear"></i>\n                                        <div class="control-menu settings-menu">\n                                            <div class="control-menu-wrapper">\n                                                <div class="control-menu-list"></div>\n                                                <div class="control-menu-pane"></div>\n                                            </div>\n                                        </div>\n                                        <span class="control-badge"></span>\n                                    </a>\n                                '),c+="\n                                ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiVr")&&(c+='\n                                    <a class="control tooltip vr ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiTheatre")||n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiFullscreen")||(c+="tooltip-right-bound"),c+='" data-title="View in VR">\n                                        <i class="custom-icons icon-vr-icon"></i>\n                                    </a>\n                                '),c+="\n                                ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiTheatre")&&(c+='\n                                    <a class="control tooltip theatre" data-title="Theater Mode">\n                                        <i class="custom-icons icon-theater-icon"></i>\n                                    </a>\n                                '),c+="\n                                ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiFullscreen")&&(c+='\n                                    <a class="control tooltip tooltip-right-bound fullscreen" data-title="Fullscreen">\n                                        <i class="custom-icons icon-fullscreen-icon"></i>\n                                    </a>\n                                '),c+="\n                            </div>\n                        "),c+="\n                    "),c+="\n                </div>\n\n                ",n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiSnapshots")&&(c+='\n                    <div class="snapshot-guides">\n                    </div>\n                    <div class="snapshot widget">\n                        <a class="button help">\n                            <span class="normal"><i class="icon fa fa-camera"></i> Save view</span>\n                            <span class="progress"><i class="icon fa fa-camera"></i> Saving&hellip;</span>\n                            <span class="success"><i class="icon fa fa-check"></i>Saved</span>\n                            <div class="tooltip tooltip-right">Save thumbnail and initial camera view</div>\n                        </a>\n                        <div class="img-container invisible"></div>\n                    </div>\n                    <div class="snapshot-flash">\n                    </div>\n                '),c+='\n\n                <div class="viewer-hint widget disabled">\n                    <div class="viewer-movehint">\n                        <i class="icon"></i>\n                        <span class="label">\n                            click &amp; hold<br>\n                            to rotate\n                        </span>\n                    </div>\n                </div>\n\n            </div>\n\n        </div>\n\n        <div class="osd widget">\n            <div class="osd-content">\n            </div>\n        </div>\n\n        <div class="fallback" style="display: none">\n\n            <div class="fallback-viewport">\n                <img src="" alt="" class="fallback-sprite">\n            </div>\n\n            <div class="fallback-warning">\n                <div class="inner">\n                    For compatibility reasons, 3D is not available (<a href="https://help.sketchfab.com/hc/en-us/articles/203059088-Compatibility?utm_source=website&amp;utm_campaign=error_fallback" target="_blank">see requirements</a>).<br>\n                    You are seeing a 360&deg; image instead.\n                </div>\n            </div>\n\n            <div class="fallback-error fallback-error-loading">\n                <div class="inner">\n                    <p>Connection error. Please try again.</p>\n                </div>\n            </div>\n\n            <div class="fallback-error fallback-error-nofallback">\n                <div class="inner">\n                    <p>Sorry, the model can\'t be displayed.</p>\n                    <p>Please check out <a href="https://help.sketchfab.com/hc/en-us/articles/203059088-Compatibility?utm_source=website&utm_campaign=error_fallback" target="_blank">our FAQ</a> to learn how to fix this issue.</p>\n                </div>\n            </div>\n\n            <div class="progress-bar">\n                <div class="progress-bar-percentage"></div>\n                <div class="progress-bar-display"></div>\n            </div>\n\n            <div class="progress-circle">\n                <div class="progress-circle-percentage loading-percentage"></div>\n                <svg class="progress-circle-display" version="1.1">\n                    <path class="progress-circle-path" fill="none" stroke="#1caad9" stroke-width="6" />\n                </svg>\n            </div>\n\n            ',n.memberLookup(n.contextOrFrameLookup(t,r,"options"),"uiControls")&&(c+='\n                <div class="controls">\n                    <div class="control control-fullscreen fullscreen" data-title="Toggle Fullscreen" data-action="fullscreen">\n                        <div class="icon custom-icons icon-fullscreen-icon"></div>\n                    </div>\n                </div>\n            '),c+="\n\n        </div>\n\n    </div>\n\n",r=l,new n.SafeString(c)});t.addExport("show_viewer"),t.setVariable("show_viewer",g),u+="\n\n";var m=n.makeMacro(["mode"],[],function(e,t){var i=r;r=new n.Frame,t=t||{},t.hasOwnProperty("caller")&&r.set("caller",t.caller),r.set("mode",e);var a="";return a+="\n\n    ","orbit"==e&&(a+='\n\n        <div class="viewer-mode-help">\n            <h2>Orbit mode</h2>\n            <ul class="help-shortcuts">\n                <li class="mouse-left">Rotate</li>\n                <li class="mouse-wheel">Zoom <small class="hint">also works with CTRL+left click</small></li>\n                <li class="mouse-right">Pan <small class="hint">also works with SHIFT+left click</small></li>\n            </ul>\n        </div>\n\n    '),a+="\n\n    ","fps"==e&&(a+='\n\n        <div class="viewer-mode-help">\n            <h2>First person mode</h2>\n            <ul class="help-shortcuts">\n                <li class="mouse-left">Look around</li>\n                <li class="mouse-wheel">Walking speed</li>\n                <li class="kbd-wasd">Walk <small class="hint">also works with arrows or Z,Q,S,D</small></li>\n            </ul>\n        </div\n\n    '),a+="\n\n",r=i,new n.SafeString(a)});t.addExport("help_viewer_mode"),t.setVariable("help_viewer_mode",m),u+="\n\n";var v=n.makeMacro(["hotspots"],[],function(i,a){var o=r;r=new n.Frame,a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("hotspots",i);var s="";s+='\n<a href="#" data-action="toggle-autopilot" class="autopilot stopped"></a>\n<ul>\n    ',r=r.push();var u=i;if(u)for(var l=u.length,c=0;c<u.length;c++){var h=u[c];r.set("hotspot",h),r.set("loop.index",c+1),r.set("loop.index0",c),r.set("loop.revindex",l-c),r.set("loop.revindex0",l-c-1),r.set("loop.first",0===c),r.set("loop.last",c===l-1),r.set("loop.length",l),s+='\n        <li class="link"><a data-hotspot-target="',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"loop"),"index0"),e.opts.autoescape),s+='" title="',s+=n.suppressValue(n.memberLookup(h,"name"),e.opts.autoescape),s+='"><span class="index">',s+=n.suppressValue(n.memberLookup(n.contextOrFrameLookup(t,r,"loop"),"index"),e.opts.autoescape),s+="</span> ",s+=n.suppressValue(n.memberLookup(h,"name"),e.opts.autoescape),s+="</a></li>\n    "}return r=r.pop(),s+="\n</ul>\n",r=o,new n.SafeString(s)});t.addExport("hotspots_list"),t.setVariable("hotspots_list",v),u+="\n\n";var _=n.makeMacro(["hasFullscreen"],[],function(t,a){var o=r;r=new n.Frame,a=a||{},a.hasOwnProperty("caller")&&r.set("caller",a.caller),r.set("hasFullscreen",t);var s="";return s+='\n\n    <div class="vr-mode-help">\n        ',s+='\n        <img src="',s+=n.suppressValue(i(639),e.opts.autoescape),s+='" width="96" height="116" alt="Place your landscape oriented phone in front of lenses">\n\n        <p>\n            ',s+=t?'\n                <button class="button btn-textified" data-action="fullscreen">Switch to fullscreen</button><br>\n                then place your phone into your Cardboard viewer\n            ':"\n                Place your phone into your Cardboard viewer\n            ",s+="\n        </p>\n    </div>\n\n",r=o,new n.SafeString(s)});t.addExport("help_vr_mode"),t.setVariable("help_vr_mode",_),u+="\n",l?l.rootRenderFunc(e,t,r,n,a):a(null,u)})})})})})})})})})})})})}catch(e){a(n.handleError(e,o,s))}}return{root:e}}()}()},,,,,,,,,function(e,t,i){"use strict";var r=function(){r.prototype.reset.call(this)};r.prototype={reset:function(){this._computeNearFar=!0,this._nearFarRatio=.005,this.bbCornerFar=3,this.bbCornerNear=4,this._enableFrustumCulling=!1,this._settingsSourceOverrider=this,this._LODScale=1,this._clampProjectionMatrixCallback=void 0},setCullSettings:function(e){this._computeNearFar=e._computeNearFar,this._nearFarRatio=e._nearFarRatio,this._enableFrustumCulling=e._enableFrustumCulling,this._settingsSourceOverrider=e._settingsSourceOverrider,this._clampProjectionMatrixCallback=e._clampProjectionMatrixCallback},setNearFarRatio:function(e){this._nearFarRatio=e},getNearFarRatio:function(){return this._nearFarRatio},setComputeNearFar:function(e){this._computeNearFar=e},getComputeNearFar:function(){return this._computeNearFar},setEnableFrustumCulling:function(e){this._enableFrustumCulling=e},getEnableFrustumCulling:function(){return this._enableFrustumCulling},getSettingSourceOverrider:function(){return this._settingsSourceOverrider},setClampProjectionMatrixCallback:function(e){this._clampProjectionMatrixCallback=e},getClampProjectionMatrixCallback:function(){return this._clampProjectionMatrixCallback},setLODScale:function(e){this._LODScale=e},getLODScale:function(){return this._LODScale}},e.exports=r},function(e,t,i){"use strict";var r=i(30),n=i(14),a=i(426),o=i(67),s=i(450),u=i(650),l=i(8).mat4,c=i(165),h=i(562),d=i(570),p=i(564),f=i(505),g=i(665),m=i(145),v=i(657),_=i(497),b=i(571),x=i(135),S=i(565),y=i(661),C=i(568),T=i(274),M=i(146),w=i(8).vec3,A=i(498),E=i(428),P=i(427),N=i(385),F=function(){o.call(this,o.TRAVERSE_ACTIVE_CHILDREN),s.call(this),u.call(this),this._rootStateGraph=void 0,this._currentStateGraph=void 0,this._currentRenderBin=void 0,this._currentRenderStage=void 0,this._rootRenderStage=void 0,this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY;var e=w.fromValues(0,0,-1);this._camera=void 0,this._bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar,this._reserveLeafStack=[new v],this._reserveLeafStackCurrent=0,this._reserveRenderStageStacks={},this._reserveCullSettingsStack=[new s],this._reserveCullSettingsStackCurrent=0,this._renderBinStack=[],this.visitorType=o.CULL_VISITOR,this._identityMatrix=l.create(),this._renderer=void 0,this._renderStageType=b,this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0};F.registerApplyFunction=g.registerApplyFunction,F.getApplyFunction=g.getApplyFunction,n.createPrototypeObject(F,n.objectInherit(u.prototype,n.objectInherit(o.prototype,{applyFunctionArray:g.applyFunctionArray,distance:function(e,t){return-(e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+t[14])},getComputedNear:function(){return this._computedNear},getComputedFar:function(){return this._computedFar},resetStats:function(){this._numCamera=0,this._numMatrixTransform=0,this._numProjection=0,this._numNode=0,this._numLightSource=0,this._numGeometry=0},handleCullCallbacksAndTraverse:function(e){var t=e.getCullCallback();t&&!t.cull(e,this)||this.traverse(e)},getCurrentCamera:function(){return this._currentRenderBin.getStage().getCamera()},updateCalculatedNearFar:function(){var e=w.create(),t=w.create();return function(i,r){var n,a,o=r.getBoundingBox();if(n=this.distance(o.corner(this._bbCornerNear,e),i),a=this.distance(o.corner(this._bbCornerFar,t),i),n>a){var s=n;n=a,a=s}return!(a<0)&&(n<this._computedNear&&(this._computedNear=n),a>this._computedFar&&(this._computedFar=a),!0)}}(),setStateGraph:function(e){this._rootStateGraph=e,this._currentStateGraph=e},setRenderStage:function(e){this._rootRenderStage=e,this._currentRenderBin=e},setRenderer:function(e){this._renderer=e},getRenderer:function(){return this._renderer},reset:function(){u.prototype.reset.call(this),this.resetRenderLeafStack(),this._reserveLeafStackCurrent=0,this.resetCullSettingsStack(),this._reserveCullSettingsStackCurrent=0;for(var e in this._reserveRenderStageStacks)this._reserveRenderStageStacks[e].reset();_.resetStack(),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY},getCurrentRenderBin:function(){return this._currentRenderBin},setCurrentRenderBin:function(e){this._currentRenderBin=e},addPositionedAttribute:function(e,t){var i=e||this._identityMatrix;this._currentRenderBin.getStage().positionedAttribute.push([i,t])},pushStateSet:function(e){if(this._currentStateGraph=this._currentStateGraph.findOrInsert(e),void 0!==e.getBinName()){var t=this._renderBinStack,i=this._currentRenderBin;t.push(i),this._currentRenderBin=i.getStage().findOrInsert(e.getBinNumber(),e.getBinName())}},popStateSet:function(){var e=this._currentStateGraph,t=e.getStateSet();if(this._currentStateGraph=e.parent,void 0!==t.getBinName()){var i=this._renderBinStack;0===i.length?this._currentRenderBin=this._currentRenderBin.getStage():this._currentRenderBin=i.pop()}},popProjectionMatrix:function(){if(!0===this._computeNearFar&&this._computedFar>=this._computedNear){var e=this.getCurrentProjectionMatrix();void 0!==this._clampProjectionMatrixCallback?this._clampProjectionMatrixCallback(e,this._computedNear,this._computedFar,this._nearFarRatio):this.clampProjectionMatrix(e,this._computedNear,this._computedFar,this._nearFarRatio)}u.prototype.popProjectionMatrix.call(this)},clampProjectionMatrix:function(e,t,i,n,a){if(i<t-1e-6)return r.log("clampProjectionMatrix not applied, invalid depth range, znear = "+t+"  zfar = "+i,!1,!0),!1;var o,s;if(i<t+1e-6){var u=.5*(t+i);t=u-1e-6,i=u+1e-6}if(Math.abs(e[3])<1e-6&&Math.abs(e[7])<1e-6&&Math.abs(e[11])<1e-6){var l=.02*(i-t);l<1&&(l=1),o=t-l,s=i+l,t=o,i=s,e[10]=-2/(s-o),e[14]=-(s+o)/(s-o)}else{o=.98*t,s=1.02*i;var c=i*n;o<c&&(o=c),t=o,i=s;var h=e[10],d=e[14],p=e[11],f=e[15],g=(-o*h+d)/(-o*p+f),m=(-s*h+d)/(-s*p+f),v=Math.abs(2/(g-m)),_=-(g+m)/2,b=_*v;e[2]=e[2]*v+e[3]*b,e[6]=e[6]*v+e[7]*b,e[10]=h*v+p*b,e[14]=d*v+f*b}return void 0!==a&&(a[0]=t,a[1]=i),!0},popCameraModelViewProjectionMatrix:function(){this.popModelViewMatrix(),this.popProjectionMatrix()},pushCameraModelViewProjectionMatrix:function(e,t,i){this.pushModelViewMatrix(t),this.pushProjectionMatrix(i)},apply:function(e){this.applyFunctionArray[e.nodeTypeID].call(this,e)},createOrReuseRenderStage:function(e){var t,i=e?e.className():"RenderStage",r=e?e.constructor:b;return this._reserveRenderStageStacks[i]?t=this._reserveRenderStageStacks[i]:(t=new f.OsgObjectMemoryStack(r),this._reserveRenderStageStacks[i]=t),t.get().init()},createOrReuseRenderLeaf:function(){var e=this._reserveLeafStack[this._reserveLeafStackCurrent++];return this._reserveLeafStackCurrent===this._reserveLeafStack.length&&this._reserveLeafStack.push(new v),e},resetRenderLeafStack:function(){for(var e=0,t=this._reserveLeafStackCurrent;e<=t;e++)this._reserveLeafStack[e].reset()},createOrReuseCullSettings:function(){var e=this._reserveCullSettingsStack[this._reserveCullSettingsStackCurrent++];return this._reserveCullSettingsStackCurrent===this._reserveCullSettingsStack.length&&this._reserveCullSettingsStack.push(new s),e},resetCullSettingsStack:function(){for(var e=0,t=this._reserveCullSettingsStackCurrent;e<=t;e++)this._reserveCullSettingsStack[e].reset()},postPushGeometry:function(e,t){var i,r;t instanceof E?(r=t.getStateSetAnimation(),r&&e.pushStateSet(r),(i=t.getSourceGeometry())instanceof N&&(r=i.getStateSetAnimation())&&e.pushStateSet(r)):t instanceof N&&(r=t.getStateSetAnimation())&&e.pushStateSet(r)},prePopGeometry:function(e,t){if(t instanceof E){var i=t.getSourceGeometry();i instanceof N&&i.getStateSetAnimation()&&e.popStateSet(),t.getStateSetAnimation()&&e.popStateSet()}else t instanceof N&&t.getStateSetAnimation()&&e.popStateSet()},pushLeaf:function(e,t){var i=this._currentStateGraph.leafs;0===i.length&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var r=this.createOrReuseRenderLeaf();r.init(this._currentStateGraph,e,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelMatrix(),t),i.push(r)}})),"osg","CullVisitor");var R=function(e){this._numCamera++;var t=e.getStateSet();t&&this.pushStateSet(t);var i=this._reservedMatrixStack.get(),r=this._reservedMatrixStack.get();if(e.getReferenceFrame()===M.RELATIVE_RF){var n=this.getCurrentProjectionMatrix();l.mul(r,n,e.getProjectionMatrix());var a=this.getCurrentModelViewMatrix();l.mul(i,a,e.getViewMatrix())}else l.copy(i,e.getViewMatrix()),l.copy(r,e.getProjectionMatrix());var o=this._computedNear,s=this._computedFar,u=this.createOrReuseCullSettings();if(u.setCullSettings(this),this._computedNear=Number.POSITIVE_INFINITY,this._computedFar=Number.NEGATIVE_INFINITY,this.setCullSettings(e),u.getSettingSourceOverrider()===this&&u.getEnableFrustumCulling()&&this.setEnableFrustumCulling(!0),this.pushCameraModelViewProjectionMatrix(e,i,r),e.getViewport()&&this.pushViewport(e.getViewport()),e.getRenderOrder()===T.NESTED_RENDER)this.handleCullCallbacksAndTraverse(e);else{var c=this.getCurrentRenderBin(),h=c.getStage(),d=this.createOrReuseRenderStage(this._rootRenderStage);d.setCamera(e),d.setClearDepth(e.getClearDepth()),d.setClearColor(e.getClearColor()),d.setClearMask(e.getClearMask());var p;p=void 0===e.getViewport()?h.getViewport():e.getViewport(),d.setViewport(p),this.setCurrentRenderBin(d),this.handleCullCallbacksAndTraverse(e),this.setCurrentRenderBin(c),e.getRenderOrder()===T.PRE_RENDER?this.getCurrentRenderBin().getStage().addPreRenderStage(d,e.renderOrderNum):this.getCurrentRenderBin().getStage().addPostRenderStage(d,e.renderOrderNum)}this.popCameraModelViewProjectionMatrix(e),e.getViewport()&&this.popViewport(),this.setCullSettings(u),this._computedNear=o,this._computedFar=s,t&&this.popStateSet()},I=function(e){if(this._numMatrixTransform++,!this.isCulled(e,this.nodePath)){this.pushCurrentMask();var t=this._reservedMatrixStack.get(),i=this.getCurrentModelViewMatrix();l.copy(t,i),e.computeLocalToWorldMatrix(t),this.pushModelViewMatrix(t);var r=e.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(e),r&&this.popStateSet(),this.popModelViewMatrix(),this.popCurrentMask()}},O=function(e){this._numProjection++;var t=this.getCurrentProjectionMatrix(),i=this._reservedMatrixStack.get();l.mul(i,t,e.getProjectionMatrix()),this.pushProjectionMatrix(i);var r=e.getStateSet();r&&this.pushStateSet(r),this.handleCullCallbacksAndTraverse(e),r&&this.popStateSet(),this.popProjectionMatrix()},L=function(e){if(this._numNode++,!this.isCulled(e,this.nodePath)){this.pushCurrentMask();var t=e.getStateSet();t&&this.pushStateSet(t),this.handleCullCallbacksAndTraverse(e),t&&this.popStateSet(),this.popCurrentMask()}},D=function(e){this._numLightSource++;var t=e.getStateSet();t&&this.pushStateSet(t);var i=e.getLight();i&&(e.getReferenceFrame()===M.RELATIVE_RF?this.addPositionedAttribute(this.getCurrentModelViewMatrix(),i):this.addPositionedAttribute(null,i)),this.handleCullCallbacksAndTraverse(e),t&&this.popStateSet()},k=function(){var e=w.create(),t=!1;return function(i){this._numGeometry++;var n=this.getCurrentModelViewMatrix(),o=i.getBoundingBox();if(!this._computeNearFar||!o.valid()||this.updateCalculatedNearFar(n,i)){var s=i.getCullCallback();if(!s||s.cull(i,this)){var u=i.getStateSet();u&&this.pushStateSet(u),this.postPushGeometry(this,i);var l=0;o.valid()&&(l=this.distance(o.center(e),n)),a.isNaN(l)?t||(r.warn("warning geometry has a NaN depth, "+n+" center "+e),t=!0):this.pushLeaf(i,l),this.prePopGeometry(this,i),u&&this.popStateSet()}}}}();g.registerApplyFunction(x.nodeTypeID,L),g.registerApplyFunction(y.nodeTypeID,L),g.registerApplyFunction(C.nodeTypeID,L),g.registerApplyFunction(T.nodeTypeID,R),g.registerApplyFunction(c.nodeTypeID,I),g.registerApplyFunction(d.nodeTypeID,O),g.registerApplyFunction(m.nodeTypeID,k),g.registerApplyFunction(A.nodeTypeID,I),g.registerApplyFunction(P.nodeTypeID,I),g.registerApplyFunction(h.nodeTypeID,I),g.registerApplyFunction(S.nodeTypeID,L),g.registerApplyFunction(p.nodeTypeID,D),g.registerApplyFunction(E.nodeTypeID,k),g.registerApplyFunction(N.nodeTypeID,k),e.exports=F},function(e,t,i){"use strict";var r=(i(30),i(14)),n=i(91),a=window.ImageBitmap||function(){},o=function(e){n.call(this),this._imageObject=void 0,this._url=void 0,this._width=void 0,this._height=void 0,this._dirty=!0,this._mipmap=[],e&&this.setImage(e),this._isGreyscale=void 0};r.createPrototypeObject(o,r.objectInherit(n.prototype,{dirty:function(){this._isGreyscale=void 0,this._dirty=!0},isDirty:function(){return this._dirty},setDirty:function(e){this._dirty=e},getImage:function(){return this._imageObject instanceof o?this._imageObject.getImage():this._imageObject},getURL:function(){return this._url},setURL:function(e){this._url=e},useOrCreateImage:function(e){return e instanceof o==!1?new o(e):e},setImage:function(e){if(!this._url&&e&&(e.src||e.currentSrc)&&(this._url=e.src||e.currentSrc),this._mipmap.length=0,Array.isArray(e)){for(var t=0,i=e.length;t<i;t++)this._mipmap.push(this.useOrCreateImage(e[t]));this.setWidth(this._mipmap[0].getWidth()),this.setHeight(this._mipmap[0].getHeight())}else this._mipmap.push(e);this._imageObject=this._mipmap[0],this.dirty()},isCanvas:function(){return this.getImage()instanceof window.HTMLCanvasElement},isBitmap:function(){return this.getImage()instanceof a},isVideo:function(){return this.getImage()instanceof window.HTMLVideoElement},isImage:function(){return this.getImage()instanceof window.Image},isTypedArray:function(){var e=this.getImage();return e instanceof Uint8Array||e instanceof Float32Array||e instanceof Uint16Array},setWidth:function(e){this._width=e},setHeight:function(e){this._height=e},getWidth:function(){var e=this.getImage();return this.isImage()?e.naturalWidth:this.isVideo()?e.videoWidth:this.isCanvas()||this.isBitmap()?e.width:this._width},getHeight:function(){var e=this.getImage();return this.isImage()?e.naturalHeight:this.isVideo()?e.videoHeight:this.isCanvas()||this.isBitmap()?e.height:this._height},isGreyscale:function(e){if(void 0!==this._isGreyscale)return this._isGreyscale;if(void 0!==this._imageObject&&this.isReady()&&void 0===this._isGreyscale){var t=this._imageObject;this.isCanvas()||(t=document.createElement("canvas"));var i=t.getContext("2d");t.width=this._imageObject.width,t.height=this._imageObject.height,i.drawImage(this._imageObject,0,0);var r,n;e||(r=t.width,n=t.height),e>0&&(e=Math.min(Math.min(t.width,t.height),e),r=n=e);for(var a=!0,o=t.width/r,s=t.height/n,u=0;u<r;u++)for(var l=0;l<n;l++){var c=Math.floor(o*(u+.5)),h=Math.floor(s*(l+.5)),d=i.getImageData(c,h,1,1).data;if(d[0]!==d[1]||d[0]!==d[2]){a=!1;break}}this._isGreyscale=a}return this._isGreyscale},isReady:function(){if(this._imageObject&&this._imageObject instanceof o)return this._imageObject.isReady();if(this.isCanvas()||this.isTypedArray()||this.isBitmap())return!0;if(this.isImage()){var e=this.getImage();if(e.complete)return void 0===e.naturalWidth||0!==e.naturalWidth}if(this.isVideo()&&0!==this.getWidth())return!0;var t=this.getImage();return!!t.complete&&(void 0===t.naturalWidth||0!==t.naturalWidth)},getMipmap:function(){return this._mipmap},hasMipmap:function(){return this._mipmap.length>1},release:function(){this._mipmap.length=0,this._imageObject=void 0}}),"osg","Image"),e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(68),a=i(88),o=i(8).mat4,s=i(8).vec3,u=i(8).vec4,l=function(e,t){n.call(this);var i=void 0!==e?e:0;this._ambient=u.fromValues(.2,.2,.2,1),this._diffuse=u.fromValues(.8,.8,.8,1),this._specular=u.fromValues(.2,.2,.2,1),this._position=u.fromValues(0,0,1,0),this._direction=s.fromValues(0,0,-1),this._ground=u.fromValues(.2,.2,.2,-1),this._spotCutoff=180,this._spotBlend=.01,this._attenuation=u.fromValues(1,0,0,0),this._lightNumber=i,this._enable=!t};l.DIRECTION="DIRECTION",l.SPOT="SPOT",l.POINT="POINT",l.HEMI="HEMI",l.uniforms={},r.createPrototypeStateAttribute(l,r.objectInherit(n.prototype,{attributeType:"Light",cloneType:function(){return new l(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this._lightNumber},getUniformName:function(e){return"u"+(this.getType()+this._lightNumber.toString())+"_"+e},getHash:function(){return this.getTypeMember()+this.getLightType()+this.isEnabled().toString()},getOrCreateUniforms:function(){var e=l,t=this.getTypeMember();return e.uniforms[t]?e.uniforms[t]:(e.uniforms[t]={ambient:a.createFloat4(this.getUniformName("ambient")),diffuse:a.createFloat4(this.getUniformName("diffuse")),specular:a.createFloat4(this.getUniformName("specular")),attenuation:a.createFloat4(this.getUniformName("attenuation")),position:a.createFloat4(this.getUniformName("position")),direction:a.createFloat3(this.getUniformName("direction")),spotCutOff:a.createFloat1(this.getUniformName("spotCutOff")),spotBlend:a.createFloat1(this.getUniformName("spotBlend")),ground:a.createFloat4(this.getUniformName("ground")),matrix:a.createMatrix4(this.getUniformName("matrix")),invMatrix:a.createMatrix4(this.getUniformName("invMatrix"))},e.uniforms[t])},isEnabled:function(){return this._enable},setEnabled:function(e){this._enable=e},setAmbient:function(e){u.copy(this._ambient,e)},getAmbient:function(){return this._ambient},setDiffuse:function(e){u.copy(this._diffuse,e)},getDiffuse:function(){return this._diffuse},setSpecular:function(e){u.copy(this._specular,e)},getSpecular:function(){return this._specular},setPosition:function(e){u.copy(this._position,e)},getPosition:function(){return this._position},setDirection:function(e){s.copy(this._direction,e)},getDirection:function(){return this._direction},setSpotCutoff:function(e){this._spotCutoff=e},getSpotCutoff:function(){return this._spotCutoff},setSpotBlend:function(e){this._spotBlend=e},getSpotBlend:function(){return this._spotBlend},setGround:function(e){s.copy(this._ground,e)},getGround:function(){return this._ground},setConstantAttenuation:function(e){this._attenuation[0]=e},getConstantAttenuation:function(){return this._attenuation[0]},setLinearAttenuation:function(e){this._attenuation[1]=e},getLinearAttenuation:function(){return this._attenuation[1]},setQuadraticAttenuation:function(e){this._attenuation[2]=e},getQuadraticAttenuation:function(){return this._attenuation[2]},setLightType:function(e){return e===l.DIRECTION?this.setLightAsDirection():e===l.SPOT?this.setLightAsSpot():e===l.HEMI?this.setLightAsHemi():this.setLightAsPoint()},getLightType:function(){return this.isDirectionLight()?l.DIRECTION:this.isSpotLight()?l.SPOT:this.isHemiLight()?l.HEMI:l.POINT},setLightAsSpot:function(){u.set(this._position,0,0,0,1),s.set(this._direction,0,0,-1),this._ground[3]=-1,this._spotCutoff=90},setLightAsPoint:function(){u.set(this._position,0,0,0,1),s.set(this._direction,0,0,-1),this._ground[3]=-1},setLightAsDirection:function(){u.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=-1},setLightAsHemi:function(){u.set(this._position,0,0,1,0),this._spotCutoff=180,this._ground[3]=1},setLightNumber:function(e){this._lightNumber=e},getLightNumber:function(){return this._lightNumber},isSpotLight:function(){return this._spotCutoff<180},isDirectionLight:function(){return 0===this._position[3]&&-1===this._ground[3]},isHemiLight:function(){return 1===this._ground[3]},applyPositionedUniform:function(e){var t=this.getOrCreateUniforms(),i=t.matrix.getInternalArray(),r=t.invMatrix.getInternalArray();o.copy(i,e),o.copy(r,e),r[12]=0,r[13]=0,r[14]=0,o.invert(r,r),o.transpose(r,r)},apply:function(){if(this._enable){var e=this.getOrCreateUniforms();if(e.position.setFloat4(this._position),this.isSpotLight()){var t=Math.cos(this._spotCutoff*Math.PI/180);e.spotCutOff.setFloat(t),e.spotBlend.setFloat((1-t)*this._spotBlend),e.direction.setFloat3(this._direction)}this.isHemiLight()&&e.ground.setFloat4(this._ground),e.attenuation.setFloat4(this._attenuation),e.diffuse.setFloat4(this._diffuse),e.specular.setFloat4(this._specular),e.ambient.setFloat4(this._ambient)}}}),"osg","Light"),e.exports=l},function(e,t,i){"use strict";var r=i(505),n=function(){this.depth=0,this.children={},this.children.keys=[],this.leafs=[],this.stateset=void 0,this.parent=void 0};n.prototype={clean:function(){this.leafs.length=0,this.stateset=void 0,this.parent=void 0,this.depth=0;for(var e,t,i=this.children,n=i.keys,a=0,o=n.length;a<o;a++)t=n[a],e=i[t],e.clean(),r.memoryPools.stateGraph.put(e);this.children={},n.length=0,this.children.keys=n},getStateSet:function(){return this.stateset},findOrInsert:function(e){var t,i=e.getInstanceID(),n=this.children;return n[i]?t=n[i]:(t=r.memoryPools.stateGraph.get(),t.parent=this,t.depth=this.depth+1,t.stateset=e,n[i]=t,n.keys.push(i)),t}},n.moveStateGraph=function(e,t,i){var r,n,a=[],o=i,s=t;if(o!==s&&void 0!==o)if(void 0!==s){if(s.parent===o.parent)return void 0!==s.stateset&&e.popStateSet(),void(void 0!==o.stateset&&e.pushStateSet(o.stateset));for(;s.depth>o.depth;)void 0!==s.stateset&&e.popStateSet(),s=s.parent;for(a=[];o.depth>s.depth;)void 0!==o.stateset&&a.push(o.stateset),o=o.parent;for(;s!==o;)void 0!==s.stateset&&e.popStateSet(),s=s.parent,void 0!==o.stateset&&a.push(o.stateset),o=o.parent;for(r=a.length-1,n=0;r>=n;--r)e.pushStateSet(a[r])}else{do{void 0!==o.stateset&&a.push(o.stateset),o=o.parent}while(o);for(r=a.length-1,n=0;r>=n;--r)e.pushStateSet(a[r])}},e.exports=n},function(e,t,i){"use strict";var r=i(8).mat4,n=i(146),a=function(e,t,i){var a=t;void 0===a&&(a=!0);var o=i||r.create(),s=0;if(a){for(s=e.length-1;s>=0;s--){var u=e[s];if("Camera"===u.className()&&(u.getReferenceFrame()!==n.RELATIVE_RF||0===u.getParents().length))break}s+=1}for(var l=s,c=e.length;l<c;l++){var h=e[l];h.computeLocalToWorldMatrix&&h.computeLocalToWorldMatrix(o)}return o};e.exports={computeLocalToWorld:a}},function(e,t,i){"use strict";var r=i(30),n=i(14),a=i(91),o=i(165),s=function(){a.call(this)};s.checkPathIsAnimated=function(e){for(var t=0,i=e.length;t<i;++t){var r=e[t];if(r instanceof o)for(var n=r.getUpdateCallbackList(),a=0,u=n.length;a<u;++a)if(n[a]instanceof s)return!0}return!1},n.createPrototypeObject(s,n.objectInherit(a.prototype,{linkChannel:function(){},linkAnimation:function(e){var t=this.getName();if(0===t.length)return r.log("no name on an update callback, discard"),0;for(var i=0,n=e.getChannels(),a=0,o=n.length;a<o;a++){var s=n[a];s.getTargetName()===t&&(this.linkChannel(s),i++)}return i}}),"osgAnimation","AnimationUpdateCallback"),e.exports=s},function(e,t,i){"use strict";var r=i(30),n={instance:function(){return n._instance||(n._instance=n,n._instance.plugins=new window.Map),n._instance},addReaderWriter:function(e,t){void 0!==n.instance().plugins.get(e)&&r.warn("the '"+e+"' plugin already exists"),n.instance().plugins.set(e,t)},getReaderWriterForExtension:function(e){return n.instance().plugins.get(e)}};e.exports=n},function(e,t,i){"use strict";var r=i(30),n=i(88),a=i(697),o=i(14),s=i(915),u=i(914),l=function(e,t,i){this._attributes=e,this._textureAttributes=t,this._fragmentShaderMode=!1,this._activeNodeList={},this._compiledNodeList={},this._traversedNodeList={},this._variables={},this._varyings={},this._vertexShader=[],this._fragmentShader=[],this._shaderProcessor=i,this._texturesByName={},this._shadowsTextures=[],this._lights=[],this._shadows=[],this._textures=[],this._material=null,this._invariantPosition=!1,this._isBillboard=!1,this._customVertexShader=!1,this._customFragmentShader=!1,this.initAttributes(),this.initTextureAttributes()};l.cloneStateAttributeConfig=function(e){return JSON.parse(JSON.stringify(e.stateAttributeConfig))},l.setStateAttributeConfig=function(e,t){e.stateAttributeConfig=t,t.attribute.forEach(o.getOrCreateStateAttributeTypeMemberIndexFromName),t.textureAttribute.forEach(o.getOrCreateTextureStateAttributeTypeMemberIndexFromName),e.validAttributeTypeMember=t.attribute,e.validTextureAttributeTypeMember=t.textureAttribute},l.setStateAttributeConfig(l,{attribute:["Light0","ShadowReceive0","Light1","ShadowReceive1","Light2","ShadowReceive2","Light3","ShadowReceive3","Light4","Light5","Light6","Light7","Material","Billboard","Morph","Skinning"],textureAttribute:["Texture"]}),l.prototype=o.extend({},s,u,{constructor:l,createFragmentShader:function(){return this._fragmentShaderMode=!0,this._createFragmentShader()},createVertexShader:function(){return this._fragmentShaderMode=!1,this._createVertexShader()},getOrCreateProjectionMatrix:function(){return this.getOrCreateUniform("mat4","uProjectionMatrix")},getCompilerName:function(){return this._material?"CompilerOSGJS":"NoMaterialCompilerOSGJS"},getFragmentShaderName:function(){var e=this.getCompilerName(),t=this._material&&this._material.getName();return t&&(t=t.replace(/[^a-zA-Z0-9]+/g,"_").slice(0,20),e+="("+t+")"),e},getVertexShaderName:function(){return this.getFragmentShaderName()},getDebugIdentifier:function(){var e=this.getVertexShaderName(),t=this.getFragmentShaderName();return e===t?t:e+"|"+t},logError:function(e){r.error(this.getDebugIdentifier()+" : "+e)},logWarn:function(e){r.warn(this.getDebugIdentifier()+" : "+e)},getOrCreateConstantOne:function(e){return this.getOrCreateConstant(e,e+"White").setValue(e+"(1.0)")},getOrCreateConstantZero:function(e){return this.getOrCreateConstant(e,e+"Black").setValue(e+"(0.0)")},initAttributes:function(){for(var e=this._attributes,t=this._lights,i=this._shadows,r=0,n=e.length;r<n;r++){var a=e[r].className();"Light"===a?t.push(e[r]):"Material"===a?this._material=e[r]:"ShadowReceiveAttribute"===a?i.push(e[r]):"Billboard"===a?this._isBillboard=!!e[r]:"SkinningAttribute"===a?this._skinningAttribute=e[r]:"MorphAttribute"===a?this._morphAttribute=e[r]:"PointSizeAttribute"===a&&(this._pointSizeAttribute=e[r])}},initTextureAttributes:function(){var e=this._textureAttributes,t=e.length;this._textures.length=this._shadowsTextures.length=t;for(var i=0;i<t;i++){var r=e[i];if(void 0!==r)for(var n=0,a=r.length;n<a;n++)this.registerTextureAttributes(r[n],i)}},registerTextureAttributes:function(e,t){var i=e.className();return"Texture"===i?this.registerTexture(e,t):-1!==i.indexOf("ShadowTexture")?this.registerTextureShadow(e,t):void 0},registerTexture:function(e,t){var i=e.getName();i||(i="Texture"+t,e.setName(i)),this._textures[t]=e,this._texturesByName[i]={texture:e,variable:void 0,textureUnit:t}},registerTextureShadow:function(e,t){var i=e.getName();i||(i="Texture"+t,e.setName(i)),this._shadowsTextures[t]=e,this._texturesByName[i]={texture:e,variable:void 0,textureUnit:t,shadow:!0}},getTextureByName:function(e){var t=this._texturesByName[e];if(!t||t.variable)return t;var i,r=t.texture,n=t.textureUnit,a=r.className(),o="Texture"+n;if("Texture"===a)i=this.getOrCreateSampler("sampler2D",o);else{if("TextureCubeMap"!==a)return;i=this.getOrCreateSampler("samplerCube",o)}var s=this._fragmentShaderMode?this.getOrCreateVarying("vec2","vTexCoord"+n):this.getOrCreateAttribute("vec2","TexCoord"+n);return t.variable=this.createTextureRGBA(r,i,s),t},createShaderFromGraphs:function(e){this._compiledNodeList={};var t=[];for(var i in this._variables){var r=this._variables[i],n=r.declare();n&&t.push(n)}var a=this.evaluateExtensions(e),o=this.evaluateDefines(e),s=[];s.push("\n"),s.push(this.evaluateGlobalVariableDeclaration(e)),this._invariantPosition&&!this._fragmentShaderMode&&s.push("\ninvariant gl_Position;"),s.push("\n"),s.push(this.evaluateGlobalFunctionDeclaration(e)),s.push("void main() {"),0!==t.length&&(s.push("// vars\n"),s.push(t.join(" ")),s.push("\n// end vars\n")),0===e.length&&this.logError("shader without any final Node output (need at least one)"),s.push(this.evaluate(e)),s.push("}");var u=s.join("\n");return this._shaderProcessor.processShader(u,o,a,this._fragmentShaderMode?"fragment":"vertex")},getNode:function(){var e=a.getNode.apply(a,arguments),t=e.getID();return this._activeNodeList[t]=e,e},getVariable:function(e){return this._variables[e]},getAttributeType:function(e){for(var t=0;t<this._attributes.length;t++)if(this._attributes[t].getType()===e)return this._attributes[t]},createVariable:function(e,t,i){var r=t;if(void 0===r){r="tmp_"+window.Object.keys(this._variables).length}else if(this._variables[r]){if(r+=i,void 0===i)return this.createVariable(e,t,1);if(this._variables[r])return i++,this.createVariable(e,t,i)}var n=this.getNode("Variable",e,r);return this._variables[r]=n,n},getOrCreateUniform:function(e,t,i){var r=t;if(e instanceof n){var a=e;e=a.getType(),r=a.getName()}else void 0===r&&this.logError("Cannot create unamed Uniform");var o=this._variables[r];if(o&&o.getType()===e)return o;var s=this.getNode("Uniform",e,r,i);return this._variables[r]=s,s},getOrCreateSampler:function(e,t){void 0===t&&this.logError("No name given for sampler type : "+e);var i=this._variables[t];if(i)return i;var r=this.getNode("Sampler",e,t);return this._variables[t]=r,r},getOrCreateAttribute:function(e,t){this._fragmentShaderMode&&this.logError("No Vertex Attribute in Fragment Shader");var i=this._variables[t];if(i)return i;var r=this.getNode("Attribute",e,t);return this._variables[t]=r,r},getOrCreateConstant:function(e,t){var i=t;if(void 0===i){i="tmp_"+window.Object.keys(this._variables).length}else{var r=this._variables[i];if(r)return r}var n=this.getNode("Constant",e,i);return this._variables[i]=n,n},getOrCreateVarying:function(e,t){void 0===t&&this.logError("Error: Mandatory to name varying (as you need to retrieve them)");var i=this._variables[t];return i?(this._varyings[t]||this.logError("Error: requesting a varying not declared with getOrCreateVarying previously"),i.getType()!==e&&this.logError("Error: Same varying, but different type"),i):(this._fragmentShaderMode||this._customFragmentShader||this.logError("Error: requesting a varying not declared in Fragment Shader Graph (for Custom Vertex Shader, add this._customFragmentShader to the processor): "+t+" "+e),i=this._variables[t]=this._varyings[t]=this.getNode("Varying",e,t))},markNodeAsVisited:function(e){var t=e.getID();this._activeNodeList[t]===e?this._compiledNodeList[t]=e:this.logWarn("Node not requested by using Compiler getNode and/or not registered in nodeFactory "+e.toString())},checkOrMarkNodeAsTraversed:function(e){var t=e.getID();return!!this._traversedNodeList[t]||(this._traversedNodeList[t]=e,!1)},traverse:function(e,t){if(!this.checkOrMarkNodeAsTraversed(t)){var i=t.getInputs();if(!Array.isArray(i)){var r=[];for(var n in i)r.push(i[n]);i=r}for(var a=0,o=i.length;a<o;a++){t.checkInputsOutputs();var s=i[a];void 0!==s&&s!==t&&this.traverse(e,s)}e.call(e,t),this.markNodeAsVisited(t)}},preTraverse:function(e){return this._traversedNodeList={},e._map={},e._text=[],e},evaluateAndGatherField:function(e,t){var i=function(e){var i=e.getType();if(void 0!==i&&""!==i||this.logError("Your node "+e+" has no type"),e[t]&&void 0===this._map[i]){this._map[i]=!0;var r=e[t]();Array.prototype.push.apply(this._text,r)}};this.preTraverse(i);for(var r=0,n=e.length;r<n;r++)this.traverse(i,e[r]);return i._text},evaluateGlobalFunctionDeclaration:function(e){var t=function(e){var t=e.getType();if(void 0!==t&&""!==t||this.logError("Your node "+e+" has no type"),e.globalFunctionDeclaration&&void 0===this._map[t]){this._map[t]=!0;var i=e.globalFunctionDeclaration();void 0!==i&&this._text.push(i)}};this.preTraverse(t);for(var i=0,r=e.length;i<r;i++)this.traverse(t,e[i]);return t._text.join("\n")},evaluateGlobalVariableDeclaration:function(e){var t=function(e){var t=e.getID();if(e.globalDeclaration&&void 0===this._map[t]){this._map[t]=!0;var i=e.globalDeclaration();void 0!==i&&this._text.push(i)}};this.preTraverse(t);var i=0,r=e.length;for(i=0;i<r;i++)this.traverse(t,e[i]);var n=t._text,a=n.length;if(a>0){this.sortDeclarations(n);var o=n[0][0];for(i=0;i<a;++i){var s=n[i][0];s!==o&&(o=s,n[i-1]+="\n")}}return n.join("\n")},sortDeclarations:function(e){if(e.sort(),!this._fragmentShaderMode)for(var t=0,i=e.length;t<i;++t){var r=e[t];if("a"!==r[0])break;if(-1!==r.indexOf("Vertex")){e.splice(t,1),e.unshift(r);break}}},evaluate:function(e){var t=function(e){var t=e.getID();if(void 0===this._map[t]){var i=e.computeShader();if(void 0!==i){if(void 0!==e.getComment){var r=e.getComment();void 0!==r&&this._text.push(r)}this._text.push(i)}this._map[t]=!0}};this.preTraverse(t);for(var i=0,r=e.length;i<r;i++)this.traverse(t,e[i]);return t._text.join("\n")},evaluateDefines:function(e){return this.evaluateAndGatherField(e,"getDefines")},evaluateExtensions:function(e){return this.evaluateAndGatherField(e,"getExtensions")}}),e.exports=l},function(e,t,i){"use strict";var r=i(14),n=i(30),a=i(329),o=i(330),s=i(458),u=i(580),l=function(){this._cache={},this._shaderProcessor=new u,this._ShaderCompiler=void 0,this.setShaderCompiler(s)};l.prototype={setShaderCompiler:function(e){this._ShaderCompiler=e,e._validAttributeTypeMemberCache||this._computeStateAttributeCache(e)},getShaderCompiler:function(){return this._ShaderCompiler},getShaderProcessor:function(){return this._shaderProcessor},setShaderProcessor:function(e){this._shaderProcessor=e},filterAttributeTypes:function(e){return!(!e.isEnabled||e.isEnabled())},getActiveAttributeList:function(e,t){for(var i="",r=e._attributeArray,n=this._ShaderCompiler._validAttributeTypeMemberCache,a=0,o=n.length;a<o;a++){var s=n[a],u=r[s];if(u){var l=u.lastApplied;l&&!this.filterAttributeTypes(l)&&(i+=l.getHash(),t.push(l))}}return i},getActiveAttributeListCache:function(e){for(var t="",i=this._ShaderCompiler._validAttributeTypeMemberCache,r=0,n=i.length;r<n;r++){var a=i[r],o=e._attributeArray[a];if(o){var s=o.lastApplied;if(!s||this.filterAttributeTypes(s))continue;t+=o.lastApplied.getHash()}}return t},getActiveTextureAttributeListCache:function(e){for(var t="",i=this._ShaderCompiler._validTextureAttributeTypeMemberCache,r=e._textureAttributeArrayList,n=0;n<r.length;n++){var a=r[n];if(a)for(var o=0;o<i.length;o++){var s=i[o],u=a[s];if(u){var l=u.lastApplied;if(!l||this.filterAttributeTypes(l)||l.isTextureNull())continue;t+=l.getHash()}}}return t},getActiveTextureAttributeList:function(e,t){var i,r,n="",a=e._textureAttributeArrayList,o=this._ShaderCompiler._validTextureAttributeTypeMemberCache;for(i=0,r=a.length;i<r;i++){var s=a[i];if(s){t[i]=[];for(var u=0,l=o.length;u<l;u++){var c=o[u],h=s[c];if(h){var d=h.lastApplied;!d||this.filterAttributeTypes(d)||d.isTextureNull()||(n+=d.getHash(),t[i].push(d))}}}}return n},getActiveUniforms:function(e,t,i){for(var r={},n=0,a=t.length;n<a;n++){var o=t[n];if(o.getOrCreateUniforms){var s=o.getOrCreateUniforms();if(void 0!==s)for(var u in s){var l=s[u];r[l.getName()]=l}}}for(var c=0,h=i.length;c<h;c++){var d=i[c];if(d)for(var p=0,f=d.length;p<f;p++){var g=d[p],m=g.getOrCreateUniforms(c);for(var v in m){var _=m[v];r[_.getName()]=_}}}return r},_computeStateAttributeCache:function(e){var t,i,a,o,s,u=e.stateAttributeConfig.attribute||[],l=[];for(i=0,a=u.length;i<a;i++)t=u[i],void 0!==(s=r.getIdFromTypeMember(t))&&(-1!==l.indexOf(s)?n.warn("Compiler "+e.name+" contains duplicate attribute entry "+t+", check the Compiler configuration"):l.push(s));for(o=new Uint8Array(l),e._validAttributeTypeMemberCache=o,u=e.stateAttributeConfig.textureAttribute||[],l=[],i=0,a=u.length;i<a;i++)t=u[i],s=r.getTextureIdFromTypeMember(t),-1!==l.indexOf(s)?n.warn("Compiler "+e.name+" contains duplicate texture attribute entry "+t+", check the Compiler configuration"):l.push(s);o=new Uint8Array(l),e._validTextureAttributeTypeMemberCache=o},getOrCreateProgram:function(){var e=[],t=[];return function(i){var r=this._ShaderCompiler,n=this.getActiveAttributeListCache(i)+this.getActiveTextureAttributeListCache(i),s=this._cache[n];if(void 0!==s)return s;t.length=0,e.length=0,this.getActiveAttributeList(i,t),this.getActiveTextureAttributeList(i,e);var u=new r(t,e,this._shaderProcessor),l=u.createFragmentShader(),c=u.createVertexShader(),h=new a(new o(o.VERTEX_SHADER,c),new o(o.FRAGMENT_SHADER,l));return h.hash=n,h.setActiveUniforms(this.getActiveUniforms(i,t,e)),h.generated=!0,this._cache[n]=h,h}}()},e.exports=l},,,function(e,t,i){"use strict";t.a={iconCamCenter:i(816),iconZoomHint:i(815),iconsLight:{DIRECTION:i(810),SPOT:i(814),POINT:i(812),HEMI:i(811)},iconSound:i(813),iconHotspot:i(818)}},function(e,t,i){"use strict";var r=i(5),n=i(387),a=i(436),o=i(1049),s=i(1051),u=r.a.osg,l=r.a.osgShader,c=l.nodeFactory;c.registerNodes(o.a),c.registerNodes(s.a);var h=function(){n.a.apply(this,arguments)};l.Compiler.setStateAttributeConfig(h,l.Compiler.cloneStateAttributeConfig(n.a)),u.createPrototypeObject(h,u.objectInherit(n.a.prototype,{getCompilerName:function(){return"PBR"},getTextureEnvironmentSpecular:function(){return this._texturesByName.TextureEnvironmentSpecularPBR},getTextureEnvironmentIntegrateBRDF:function(){return this._texturesByName.TextureEnvironmentIntegrateBRDF},getEnvironmentDiffuse:function(e,t){var i=this.getOrCreateUniform(t.diffuseSPH);i.globalDeclaration=function(){return"uniform vec3 "+i.getVariable()+"[9];"};var r=this.createVariable("vec3");this.getNode("DiffuseUE4v1").inputs({normal:this.getOrCreateMaterialNormal(),albedo:this.getOrCreateMaterialDiffusePBR(),envTransform:e,sphCoef:i}).outputs({color:r});var n=this.createVariable("vec3");return this.getNode("Mult").inputs(r,this.getOrCreateMaterialAOPBR()).outputs(n),n},getEnvironmentSpecular:function(e,t,i){var r;this.getTextureEnvironmentIntegrateBRDF()&&(r=this.getOrCreateSampler("sampler2D",i.textureIntegrateBRDF.getName()));var n={normal:this.getOrCreateMaterialNormal(),eye:this.getOrCreateNormalizedViewEyeDirection(),roughness:this.getOrCreateMaterialRoughness(),specular:this.getOrCreateMaterialSpecularPBR(),envTransform:e,integrateBRDF:r,texSize:this.getOrCreateUniform(t.getOrCreateUniforms().size),frontNormal:this.getOrCreateNormalizedFrontViewNormal(),lodRange:this.getOrCreateUniform(t.getOrCreateUniforms().lodRange)},a="";t.getIsCubemap()?(a="SpecularUE4v1Cubemap",n.texSpec=this.getOrCreateSampler("samplerCube",i.textureSpecularPBR.getName())):(a="SpecularUE4v1Panorama",n.texSpec=this.getOrCreateSampler("sampler2D",i.textureSpecularPBR.getName()));var o=this.createVariable("vec3");this.getNode(a).inputs(n).outputs({color:o});var s=this.createVariable("vec3");return this.getNode("Mult").inputs(o,this.getOrCreateMaterialAOSpecularPBR()).outputs(s),s},readChannel:function(e,t,i,r){var a=n.a.prototype.readChannel.apply(this,arguments);if(a)return a;switch(e){case"DiffusePBR":case"AlbedoPBR":case"SpecularPBR":a=this.readTexture("vec3",e,t,i,r);break;case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SpecularF0":case"CavityPBR":case"AOPBR":a=this.readTexture("float",e,t,i,r)}return a},getOrCreateMaterialSpecularF0:function(){var e=this.getVariable("materialSpecularf0");if(e)return e;e=this.createVariable("float","materialSpecularf0");var t=this.getOrCreateChannel("SpecularF0");if(!t)return e.setValue("0.04");var i=this.createVariable("float").setValue("0.0"),r=this.createVariable("float").setValue("0.08");return this.getNode("Blend").mode("MIX").inputs(i,r,t).outputs(e),e},getOrCreateMaterialAOPBR:function(){return this.getOrCreateChannel("AOPBR")||this.getOrCreateConstantOne("float")},getOrCreateMaterialAOSpecularPBR:function(){if(!this.getOrCreateChannel("AOPBR"))return this.getOrCreateConstantOne("float");var e=this.getVariable("materialAO");return e||(e=this.createVariable("float","materialAO"),this.getNode("SpecularOcclusion").inputs({occlude:this.getOrCreateUniform("int","uAOPBROccludeSpecular"),ao:this.getOrCreateMaterialAOPBR(),normal:this.getOrCreateGeometryNormal(),eye:this.getOrCreateNormalizedViewEyeDirection()}).outputs({ao:e}),e)},getOrCreateMaterialCavityPBR:function(){return this.getOrCreateChannel("CavityPBR")||this.getOrCreateConstantOne("float")},getShadelessColor:function(){var e=this.createVariable("vec3");return this.getNode("Mult").inputs(this.getOrCreateMaterialAlbedo(),this.getOrCreateMaterialAOPBR()).outputs(e),e},getOrCreateMaterialAlbedo:function(){var e=this.getVariable("materialAlbedo");if(e)return e;e=this.createVariable("vec3","materialAlbedo");var t=this.getOrCreateChannel("AlbedoPBR")||this.getOrCreateChannel("DiffusePBR")||this.getOrCreateConstantZero("vec3");return this.getNode("SetFromNode").inputs(this.multiplyDiffuseWithVertexColor(t)).outputs(e),e},getOrCreateMaterialDiffusePBR:function(){var e=this.getVariable("materialDiffusePBR");if(e)return e;e=this.createVariable("vec3","materialDiffusePBR");var t=this.getOrCreateChannel("MetalnessPBR");if(t){this.getNode("InlineCode").code("%out = %albedo * (1.0 - %metal);").inputs({albedo:this.getOrCreateMaterialAlbedo(),metal:t}).outputs({out:e})}else this.getNode("SetFromNode").inputs(this.getOrCreateMaterialAlbedo()).outputs(e);return e},getOrCreateMaterialRoughness:function(){var e=this.getVariable("materialRoughness");if(e)return e;e=this.createVariable("float","materialRoughness");var t=this.getOrCreateChannel("RoughnessPBR");t||(t=this.getOrCreateChannel("GlossinessPBR"))&&(t=this.getRoughnessFromGlossiness(t)),t=t?this.getMinRoughness(t):this.createVariable("float").setValue("0.2");var i=t;return this._texturesByName.NormalMap&&(i=this.createVariable("float"),this.getNode("AdjustRoughnessNmap").inputs({roughness:t,normal:this.getOrCreateNormalMap()}).outputs({roughness:i})),this.getNode("AdjustRoughnessGeometry").inputs({roughness:i,normal:this.getOrCreateNormalizedFrontViewNormal()}).outputs({roughness:e}),e},getOrCreateMaterialSpecularPBR:function(){var e=this.getOrCreateChannel("SpecularPBR");if(e)return e;var t=this.getVariable("materialSpecularPBR");if(t)return t;t=this.createVariable("vec3","materialSpecularPBR");var i=this.getOrCreateChannel("MetalnessPBR");if(!i)return t.setValue("vec3(0.05)");return this.getNode("InlineCode").code("%out = mix( vec3(%f0), %albedo, %metal);").inputs({metal:i,albedo:this.getOrCreateMaterialAlbedo(),f0:this.getOrCreateMaterialSpecularF0()}).outputs({out:t}),t},getEnumLightToNodeName:function(){return{DIRECTION:"SunLightPBR",SPOT:"SpotLightPBR",POINT:"PointLightPBR",HEMI:"SunLightPBR",ENV:"EnvLightPBR"}},getOrCreatePrepSpec:function(){var e=this.getVariable("prepSpec");if(e)return e;e=this.createVariable("vec4","prepSpec");var t={normal:this.getOrCreateMaterialNormal(),eyeVector:this.getOrCreateNormalizedViewEyeDirection(),materialroughnesspbr:this.getOrCreateMaterialRoughness()};return this.getNode("PrepSpecLightPBR").inputs(t).outputs({prepSpec:e}),e},getInputsFromLight:function(e){var t=e.getOrCreateUniforms(),i={normal:this.getOrCreateMaterialNormal(),eyeVector:this.getOrCreateNormalizedViewEyeDirection(),materialalbedopbr:this.getOrCreateMaterialDiffusePBR(),prepSpec:this.getOrCreatePrepSpec(),materialspecularpbr:this.getOrCreateMaterialSpecularPBR(),lightdiffuse:this.getOrCreateUniform(t.diffuse),lightposition:this.getOrCreateUniform(t.position),lightmatrix:this.getOrCreateUniform(t.matrix)},r=e.getLightType();return r===a.a.POINT?i.lightattenuation=this.getOrCreateUniform(t.attenuation):r===a.a.SPOT&&(i.lightattenuation=this.getOrCreateUniform(t.attenuation),i.lightdirection=this.getOrCreateUniform(t.direction),i.lightspotCutOff=this.getOrCreateUniform(t.spotCutOff),i.lightspotBlend=this.getOrCreateUniform(t.spotBlend),i.lightinvMatrix=this.getOrCreateUniform(t.invMatrix)),i},getRoughnessFromGlossiness:function(e){var t=this.createVariable("float");return this.getNode("InlineCode").code("%out = 1.0 - %input;").inputs({input:e}).outputs({out:t}),t},getMinRoughness:function(e){var t=this.createVariable("float");return this.getNode("InlineCode").code("%out = max(1.e-4, %input);").inputs({input:e}).outputs({out:t}),t},getFinalFrag:function(e){var t=this.createVariable("vec3");return this.getNode("Mult").inputs(e,this.getOrCreateMaterialCavityPBR()).outputs(t),n.a.prototype.getFinalFrag.call(this,t)}})),t.a=h},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=function(){return n.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS")};t.a=a},function(e,t,i){"use strict";i.d(t,"a",function(){return u}),i.d(t,"b",function(){return l});var r=i(5),n=i(388),a=i(513),o=r.a.osg,s=r.a.osgAnimation,u=function(){var e=o.vec3.create(),t=o.mat4.create();return function(i,r){var a=i.get("lastComputedScenePosition"),s=i.get("geometryUid");if(s<0)return o.vec3.copy(a,i.get("position"));var u=n.a.uidGeometryMap[s];if(!u)return o.vec3.copy(a,i.get("position"));var l=i.get("indices"),c=l[0],h=l[1],d=l[2];if(u.getWorldMatrix(r,t),c<0)return o.vec3.transformMat4(a,i.get("localPosition"),t);var p=u.getVertexAttributeList().Vertex.getElements(),f=p.length/3;if(c>=f||h>=f||d>=f)return o.vec3.copy(a,i.get("position"));var g=i.get("barycentricWeights"),m=g[0],v=g[1],_=g[2];if(o.vec3.set(a,0,0,0),u.computeTransformedVertex)u.computeTransformedVertex(c,e),o.vec3.scale(e,e,m),o.vec3.add(a,e,a),u.computeTransformedVertex(h,e),o.vec3.scale(e,e,v),o.vec3.add(a,e,a),u.computeTransformedVertex(d,e),o.vec3.scale(e,e,_),o.vec3.add(a,e,a);else{var b=3*c,x=3*h,S=3*d;a[0]=m*p[b]+v*p[x]+_*p[S],a[1]=m*p[b+1]+v*p[x+1]+_*p[S+1],a[2]=m*p[b+2]+v*p[x+2]+_*p[S+2]}return o.vec3.transformMat4(a,a,t),a}}(),l=function(e,t,r){t.getScenePositionFromHit(r,e.get("position"));var n=r._nodePath[r._nodePath.length-1],o=void 0!==n._uniqueID?n._uniqueID:-1,u=n instanceof s.RigGeometry||n instanceof s.MorphGeometry,l=u||i.i(a.a)(r._nodePath);e.set("geometryUid",l?o:-1);var c=e.get("indices");c[0]=u?r._i1:-1,c[1]=u?r._i2:-1,c[2]=u?r._i3:-1;var h=e.get("barycentricWeights");h[0]=u?r._r1:0,h[1]=u?r._r2:0,h[2]=u?r._r3:0;var d=e.get("localPosition");d[0]=l?r._localIntersectionPoint[0]:0,d[1]=l?r._localIntersectionPoint[1]:0,d[2]=l?r._localIntersectionPoint[2]:0}},function(e,t,i){"use strict";var r=i(402),n=i(5),a=i(519),o=i(419),s=i.n(o),u=i(10),l=i.n(u),c=i(70),h=i.n(c),d=i(2),p=i.n(d),f=i(0),g=(i.n(f),i(808)),m=i(31),v=i(298),_=n.a.osg,b=new s.a({device:"VWR",listen:!0}),x={},S=function(e){return 1<<Math.ceil(Math.log2(e))},y=function(e){var t,i,r,n=0;if(0===e.length)return n;for(t=0,r=e.length;t<r;t++)i=e.charCodeAt(t),n=(n<<5)-n+i,n|=0;return"vr-browser-"+n},C=function(e,t,i,r,n,o){a.a.call(this,e,t,i,r,n,o),this._uPaginate=void 0,this._textureWidth=1024,this._textureHeight=1024,this._useCache=!1};C.prototype=_.objectInherit(a.a.prototype,{initialize:function(e,t,n){g.a||(t=i.i(f.extend)({},t),r.a.getBaseVR(function(r){this._styles=r.vrStyles,this._appendVrElement();var a=p()(r.TEMPLATES.getFromMacro(e,"panel",[t]));this._templatePath=e,a.css("position","absolute"),a.css("top","0"),a.css("left","0"),this._$uiPanelsDiv.append(a);var o=this._extractMetaData(a);if(this._useCache){var s=y(a.html()),u=localStorage.getItem(s);if(u){var l=new Image;return l.onload=function(){var e=new _.Texture;e.setTextureSize(1,1),e.setImage(l),this._applyTexture(e,o,n)}.bind(this),l.src=u,void a.remove()}}if(!i.i(m.a)().vrGenerateUiTextures)return n(v.a.dummyTexture,o),void a.remove();this._rasterizeElement(r.rasterizeHTML,a).then(function(e){if(this._useCache){var t=e.toDataURL(),i=y(a.html());this._storeInCache(i,t)}var r=new _.Texture;return r.setTextureSize(1,1),r.setImage(e),r}.bind(this)).then(function(e){this._applyTexture(e,o,n)}.bind(this)),a.remove()}.bind(this)))},_storeInCache:function(e,t){try{localStorage.setItem(e,t)}catch(r){localStorage.removeItem(localStorage.key(0));for(var i=0;i<localStorage.length&&0!==localStorage.key(i).indexOf("vr-browser-");i++)localStorage.removeItem(localStorage.key(i));this._storeInCache(e,t)}},setUseCache:function(e){this._useCache=e||!1},_applyTexture:function(e,t,i){this.isInitialized()?(this.changeTexture(e),this.updateMetaData(t)):a.a.prototype.initialize.call(this,e,t),i&&i(e,t)},_appendVrElement:function(){this._$uiPanelsDiv=p()("#vr-ui-panels"),this._$uiPanelsDiv.length||(this._$uiPanelsDiv=p()('<div id="vr-ui-panels" style="position:absolue; top:0;bottom:0;left:0;right:0; background:transparent"/>'),p()("body").append(this._$uiPanelsDiv),this._$uiPanelsDiv.append('<style id="vr-panel-style">'+this._styles+"</style>"))},_rasterizeElement:function(e,t){var r=document.createElement("canvas");return r.width=t.outerWidth(),r.height=t.outerHeight(),e.drawHTML(this._$uiPanelsDiv.prop("outerHTML"),r,{cacheBucket:x,cache:"all"}).then(function(e){if(h.a.apple.phone){var t="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(e.svg))),n=i.i(f.uniqueId)("rasterize");return b.createMessage({data:{_key:n,height:r.height+"",width:r.width+"",svg:t}}).appendToHash(),new l.a(function(e){b.on("message:"+n,function(t){var i,r=new Image;r.onload=function(){e(r)},t.b64&&(i=t.b64),t.data.b64&&(i=t.data.b64),i.indexOf("%3D")>-1&&(i=decodeURIComponent(i)),-1===i.indexOf("data:image/png")&&(i="data:image/png;base64,"+i),r.src=i})})}if(this._textureWidth=S(r.width),this._textureHeight=S(r.height),r.width===this._textureWidth&&r.height===this._textureHeight)return r;var a=document.createElement("canvas");return a.width=this._textureWidth,a.height=this._textureHeight,a.getContext("2d").drawImage(r,0,0,this._textureWidth,this._textureHeight),a}.bind(this),function(e){console.log(e)})},_extractMetaData:function(e){var t=e.find(".page"),i=e.outerHeight(!0),r=e.outerWidth(!0),n={id:e.attr("id"),width:r,height:i,cells:[],pages:[]};if(0===t.length)this._extractButtons(e,n,0,"default");else for(var a=0;a<t.length;a++)this._extractButtons(p()(t[a]),n,a,t[a].id);return this._extractCells(e,n),n},_extractButtons:function(e,t,i,r){if(r){var n=e.find("button"),a=e.offset().top,o=e.offset().left,s=e.outerHeight(!0),u=e.outerWidth(!0);t.pages[i]={id:r,num:i,x:o,y:a,width:u,height:s,items:[],areas:[]};for(var l=0;l<n.length;l++){var c=n[l].id,h=n[l].disabled;if(c&&!h){var d=p()(n[l]),f=_.vec4.create();f[0]=d.offset().left-o,f[1]=f[0]+d.outerWidth(),f[2]=d.offset().top-a,f[3]=f[2]+d.outerHeight(),f[0]>t.width&&(f[0]%=t.width),f[1]>t.width&&(f[1]%=t.width),t.pages[i].items.push(c),t.pages[i].areas.push(f)}}}},_extractCells:function(e,t){for(var i=e.find(".cell"),r=e.offset().top,n=e.offset().left,a=0,o=1/0,s=1/0,u=0,l=0;l<i.length;l++){var c=i[l].id;if(c){var h=p()(i[l]),d={};d.id=c,d.x=h.offset().left-n,d.y=h.offset().top-r;var f=h.css("z-index");d.z=isNaN(f)?0:f,d.width=h.outerWidth(!1),d.height=h.outerHeight(!1);var g=d.x+d.width;g>a&&(a=g),d.x<o&&(o=d.x);var m=d.y+d.height;m>u&&(u=m),d.y<s&&(s=d.y),t.cells[l]=d}}0===i.length?(t.cellsWidth=e.outerWidth(!1),t.cellsHeight=e.outerHeight(!1)):(t.cellsWidth=a-o,t.cellsHeight=u-s)}}),t.a=C},,,,function(e,t){(function(t){e.exports=t}).call(t,{})},,,,,,function(e,t,i){"use strict";var r=i(139),n=i(85),a=i(65),o=i(5),s=i(10),u=i.n(s),l=i(1096),c=i(31),h=i(90),d=i(367),p=i(70),f=i.n(p),g=o.a.osg,m=function(){this._volume=Number(n.a.get("volume",1)),this._sounds=[],this._enabled=!0,this._context=void 0,this._hasSounds=!1,this._unlockBinded=this._unlock.bind(this);var e=window.location.href.match(/\/models\/((.+)(?:\/)+|(.+))/);if(e&&e.length>3){var t=e[2]?e[2]:e[3];a.a.get(t).then(function(e){var t=e.get("options").sound;if(t&&t.soundtracks&&t.soundtracks.length)if(f.a.apple.device){if(!i.i(h.a)()){for(var r,n=0,a=t.soundtracks.length;n<a;n++)if(t.soundtracks[n].ambient){r=n;break}void 0!==r?(t.soundtracks=t.soundtracks.splice(r,1),this._hasSounds=!0):t.soundtracks.length=0}}else this._hasSounds=!0}.bind(this))}this._radius=1,r.a.getBoxReady().then(function(){this._radius=r.a.getModelBoxWithoutDisplacement().radius();for(var e=0;e<this._sounds.length;e++){var t=this._sounds[e];t.setMaxDistance(t.getModel().get("distanceMax")),t.setRefDistance(t.getModel().get("distance"))}}.bind(this)),this._resetPlayedOnceFromMobileGesture(),this._enablingMobileAudio=!1,this._firstEnter=!0,this._readyForErrorMessage=u.a.defer(),this._audioContextTriesCount=0,window.addEventListener("beforeunload",this.exit.bind(this)),this._contextClosePending=!1};m.prototype={release:function(){if(this._context&&!this._releasePending){var e;this._releasePendingPromises=[];for(var t=0;t<this._sounds.length;t++)(e=this.releaseSound(this._sounds[t]))&&this._releasePendingPromises.push(e);e=this._context.close(),this._contextClosePending=!0,e.then(function(){this._contextClosePending=!1,this._context=void 0}.bind(this)),this._releasePendingPromises.push(e),this._releasePending=u.a.all(this._releasePendingPromises),this._releasePending.then(function(){this._releasePendingPromises=void 0,this._releasePending=void 0}.bind(this))}},releaseSound:function(e){if(e&&(this.disconnectSound(e),e._mediaElementSource&&e._mediaElementSource.disconnect(this._context),e._player)){var t=e.playerPause();return t.then(e.releasePlayerBinded),e.isPlayerPlaying()||e.releasePlayer(),t}},removeSound:function(e){e&&(this.releaseSound(e),this._sounds.splice(this._sounds.indexOf(e),1))},reset:function(){if(this._releasePending)return void this._releasePending.then(this.reset.bind(this));this._audioContextTriesCount=0,!this._firstEnter&&this._playedOnceFromMobileGesture&&this.getOrCreateAudioContext()&&this.forcePlay()},enableTapRequestPopup:function(){this._osdProxyModel&&this._osdProxyModel.trigger("requestTapForSound","Tap/Click to play sounds",{position:"top",duration:Math.Infinity})},exit:function(){this._context&&(this.release(),this._firstEnter=!1,this._resetPlayedOnceFromMobileGesture(),this._playedOnceFromMobileGesture||(this._enableMobileAudioListener(),this.enableTapRequestPopup()))},enter:function(){this.reset()},setModel:function(e){this._osdProxyModel=e,this._readyForErrorMessage.resolve(),this._playedOnceFromMobileGesture||(this._enableMobileAudioListener(),this.enableTapRequestPopup())},getOrCreateAudioContext:function(e){if(this._enabled){if(this._context&&!this._contextClosePending)return this._context;var t=window.AudioContext||window.webkitAudioContext;if(!t)return void(this._enabled=!1);try{return this._context=e?new t:new t({latencyHint:"interactive"}),"suspended"===this._context.state?(this._playedOnceFromMobileGesture=!1,this._enableMobileAudioListener(),void this.enableTapRequestPopup()):(this._playedOnceFromMobileGesture||this._enableMobileAudioListener(),this._audioContextTriesCount&&this.forcePlay(),this._context)}catch(e){if(e instanceof TypeError&&(this.getOrCreateAudioContext(!0),this._context))return this._context;this._readyForErrorMessage.promise.then(function(){this._audioContextTriesCount++,this._audioContextTriesCount<5?setTimeout(function(){this.getOrCreateAudioContext()}.bind(this),200):this._osdProxyModel.trigger("sound-error",'Your browser can not play additional sounds and this page must be reloaded. If the problem persists, try to restart your browser. <a style="color: -webkit-link; cursor: auto; text-decoration: underline;" href="javascript:window.location.reload()">reload</a>',{position:"top",duration:Math.Infinity})}.bind(this))}return this._context}},_createAudio:function(e){if(this.getOrCreateAudioContext()){var t=document.createElement("audio");return t.volume=1,t.preload="auto",t.crossOrigin="anonymous",t.loop=e.get("loop"),t}},addSound:function(e,t){return this.canPlay()&&(t||!1===this._hasAnim)&&e.play(),this._sounds.push(e),e},createSound:function(e,t){this.getOrCreateAudioContext();var i=this._createAudio(e),r=new l.a(this,i,e);return i&&this.canPlay()&&(e.get("ambient")?this.connectAmbientSound(r):this.connect3DSound(r)),this.addSound(r,t)},createPreview:function(e){var t=this._createAudio(e),i=new l.a(this,t,e);return this.connectAmbientSound(i),i},connect3DSound:function(e){var t=this.getOrCreateAudioContext();if(t){var i=t.createPanner();if(e._panner=i,i.panningModel="HRTF",i.rolloffFactor=1,i.coneInnerAngle=360,i.coneOuterAngle=0,i.coneOuterGain=0,i.setPosition(0,0,0),i.distanceModel=e.getModel().get("distanceModel"),e.setRefDistance(e.getModel().get("distance")),e.setMaxDistance(e.getModel().get("distanceMax")),e._player||(e._player=this._createAudio(e.getModel())),!e._mediaElementSource)try{e._mediaElementSource=t.createMediaElementSource(e._player)}catch(e){if("Failed to execute 'createMediaElementSource' on 'BaseAudioContext': AudioContext has been closed."===e.message)return this.exit(),void window.setTimeout(function(){this.reset()}.bind(this),500)}var r=t.createGain();r.gain.value=0,e._gain=r,e._mediaElementSource.connect(i),i.connect(r),r.connect(t.destination),e.play()}},connectAmbientSound:function(e){var t=this.getOrCreateAudioContext();if(t){e._player||(e._player=this._createAudio(e.getModel())),e._mediaElementSource||(e._mediaElementSource=t.createMediaElementSource(e._player));var i=t.createGain();i.gain.value=0,e._mediaElementSource.connect(i),e._gain=i,i.connect(t.destination),e.play()}},disconnectSound:function(e){e&&(e._player&&this._gain&&(this._gain.gain.value=0),e._panner&&(e._panner.disconnect(),e._panner=void 0),e._gain&&(e._gain.disconnect(),e._gain=void 0))},update:function(){var e=g.vec3.create(),t=g.vec3.create(),i=g.vec3.create();return function(){if(!this._enabled)return!0;var r=this._context,n=this._camera;if(!n||!r)return!0;g.mat4.getLookAt(e,t,i,n.getViewMatrix()),g.vec3.sub(t,t,e),g.vec3.normalize(t,t);var a=r.listener;return a.setPosition(e[0]/this._radius,e[1]/this._radius,e[2]/this._radius),a.setOrientation(t[0],t[1],t[2],i[0],i[1],i[2]),!0}}(),getVolume:function(){return this._volume},setCamera:function(e){this._camera=e},setVolume:function(e){if(this._volume=e,n.a.set("volume",e,{path:"/"}),this.canPlay())for(var t=0,i=this._sounds.length;t<i;t++)this._sounds[t].updateVolume()},setEnabled:function(e){e?(this._enabled=!0,this.reset()):(this._enabled=!1,this.exit())},isEnabled:function(){return this._enabled},setHasAnim:function(e){this._hasAnim=e},_unlock:function(){var e=this.getOrCreateAudioContext();this._enablingMobileAudio=!1,e&&(document.removeEventListener("touchend",this._unlockBinded,!0),document.removeEventListener("click",this._unlockBinded,!0),this._playedOnceFromMobileGesture=!0,this.forcePlay(),this._osdProxyModel&&this._osdProxyModel.trigger("stopRequestTapForSound"))},_enableMobileAudioListener:function(){this._enablingMobileAudio||(this._enablingMobileAudio=!0,document.addEventListener("touchend",this._unlockBinded,!0),document.addEventListener("click",this._unlockBinded,!0))},forcePlay:function(){for(var e=0;e<this._sounds.length;e++){var t=this._sounds[e];t.updateFromModel(),t.playerPlay(),t.play()}},getPlayedOnceFromMobileGesture:function(){return this._playedOnceFromMobileGesture},_resetPlayedOnceFromMobileGesture:function(){this._playedOnceFromMobileGesture=!this._hasSounds||!f.a.any||i.i(c.a)().isApp||i.i(d.a)()},canPlay:function(){return this._enabled&&this._playedOnceFromMobileGesture&&!this._releasePending},getRadius:function(){return this._radius}};var v=new m;t.a=v},,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(2)),a=i.n(n),o=i(19),s=i.n(o),u=i(885),l=i.n(u),c=function(e,t){if(Array.isArray(e))this.shortcuts=e||[];else{if(!i.i(r.isObject)(e))throw new Error("Shortcut manager needs a shortcut object to function");this.shortcutGroup=e,this.shortcuts=e.shortcuts||[]}this.options=t||{},this.handlers={},this.options=i.i(r.defaults)({},this.options,{listen:!1}),this.options.listen&&this.listen()},h=new l.a;h.stopCallback=function(e,t){return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&("button"===document.activeElement.tagName.toLowerCase()||("INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||t.contentEditable&&"true"===t.contentEditable))},i.i(r.extend)(c.prototype,s.a.Events),c.prototype.listen=function(e){void 0===e?this.shortcuts.forEach(this._listen.bind(this)):Array.isArray(e)?(this.shortcuts=this.shortcuts.concat(e),e.forEach(this._listen.bind(this))):this._listen(e)},c.prototype.stopListening=function(e){e.forEach(function(e){h.unbind(this._getShortcut(e).keyCombinations),delete this.handlers[e]}.bind(this))},c.prototype.getTitle=function(){return this.shortcutGroup?this.shortcutGroup.name||"":""},c.prototype.getShortcut=function(e){return this.shortcuts.filter(function(t){return t.id===e})[0]||""},c.prototype.getShortDescriptionById=function(e){var t="";return this.shortcuts.forEach(function(i){i.id===e&&(t=this._formatKeyCombination(i.keyCombinations).replace("<br />",""))}.bind(this)),t},c.prototype.generateHelpSection=function(){var e=a()("<div />"),t=this.getTitle();return t&&e.append("<h2>"+t+"</h2>"),this.shortcuts.forEach(function(t){t.name&&e.append("<b>"+t.name+"</b>"),e.append(this._formatKeyCombination(t.keyCombinations))}.bind(this)),e.html()||""},c.prototype.hasKeyCombination=function(e){var t=!1;return this.shortcuts.forEach(function(i){t||(Array.isArray(i.shortcuts)?i.shortcuts.forEach(function(i){t=i===e}):t=i.shortcuts===e)}),t},c.prototype._formatKeyCombination=function(e){var t="";return t=Array.isArray(e)?e.join("</kbd> or <kbd>"):e,t="<kbd>"+t+"</kbd><br />"},c.prototype._listen=function(e){this._validate(e)&&!this.handlers[e.id]&&(this.handlers[e.id]=this._notify.bind(this,e),h.bind(e.keyCombinations,this.handlers[e.id]))},c.prototype._getShortcut=function(e){return i.i(r.find)(this.shortcuts,function(t){return t.id===e})},c.prototype._validate=function(e){return void 0!==e.keyCombinations&&void 0!==e.id},c.prototype._notify=function(e,t){this.trigger(e.id,e,t)},t.a=c},,function(e,t,i){"use strict";i(897);var r=i(689),n=i(666),a=i(904),o=i(906),s=i(910),u=i(935),l=i(945),c=i(581),h=i(925),d=i(927),p=i(947),f=i(913),g=r;g.osg=n,g.osgAnimation=a,g.osgDB=o,g.osgGA=s,g.osgUtil=u,g.osgViewer=l,g.osgShader=c,g.osgShadow=h,g.osgText=d,g.osgWrappers=p,g.osgPlugins=f;var m=["osg","osgAnimation","osgDB","osgGA","osgUtil","osgViewer","osgShader","osgShadow","osgText","osgWrappers","osgPlugins"];g.globalify=function(){m.forEach(function(e){window[e]=g[e]})},e.exports=g},function(e,t,i){"use strict";var r=i(363),n=i(145),a=i(8).mat4,o=i(423),s=i(332),u=i(67),l=i(14),c=function(e){u.call(this,e),this._reservedMatrixStack=new o,this._matrixStack=[],this._bb=new r};l.createPrototypeObject(c,l.objectInherit(u.prototype,{reset:function(){this._reservedMatrixStack.reset(),this._matrixStack.length=0,this._bb.init()},getBoundingBox:function(){return this._bb},applyTransform:function(e){var t=this._reservedMatrixStack.get(),i=this._matrixStack.length;i?a.copy(t,this._matrixStack[i-1]):a.identity(t),e.computeLocalToWorldMatrix(t,this),this.pushMatrix(t),this.traverse(e),this.popMatrix()},apply:function(e){return e instanceof s?void this.applyTransform(e):e instanceof n?void this.applyBoundingBox(e.getBoundingBox()):void this.traverse(e)},pushMatrix:function(e){this._matrixStack.push(e)},popMatrix:function(){this._matrixStack.pop()},applyBoundingBox:function(){var e=new r;return function(t){var i=this._matrixStack.length;if(i){if(t.valid()){var r=this._matrixStack[i-1];t.transformMat4(e,r),this._bb.expandByBoundingBox(e)}}else this._bb.expandByBoundingBox(t)}}(),getMatrixStack:function(){return this._matrixStack}}),"osg","ComputeBoundsVisitor"),e.exports=c},function(e,t,i){"use strict";var r=i(14),n=i(30),a=i(91),o=i(426),s=function(e){a.call(this),this._leafs=[],this.positionedAttribute=[],this.stateGraphList=[],s.prototype.init.call(this,e)};s.SORT_BY_STATE=0,s.SORT_BACK_TO_FRONT=1,s.SORT_FRONT_TO_BACK=2,s.defaultSortMode=s.SORT_BY_STATE,s.BinPrototypes={RenderBin:function(){return s.getOrCreate().init()},DepthSortedBin:function(){return s.getOrCreate().init(s.SORT_BACK_TO_FRONT)}};var u=function(e,t){return t._depth-e._depth},l=function(e,t){return e._depth-t._depth},c=function(e,t){return e._binNum-t._binNum};r.createPrototypeObject(s,r.objectInherit(a.prototype,{init:function(e){return this._leafs.length=0,this.positionedAttribute.length=0,this._renderStage=void 0,this._bins={},this.stateGraphList.length=0,this._parent=void 0,this._binNum=0,this._sorted=!1,this._sortMode=void 0!==e?e:s.defaultSortMode,this._drawCallback=void 0,this},_createRenderBin:function(e){var t=s.BinPrototypes.RenderBin;return e&&s.BinPrototypes[e]&&(t=s.BinPrototypes[e]),t()},getStateGraphList:function(){return this.stateGraphList},copyLeavesFromStateGraphListToRenderLeafList:function(){this._leafs.splice(0,this._leafs.length);for(var e=!1,t=0,i=this.stateGraphList.length;t<i;t++)for(var r=this.stateGraphList[t].leafs,a=0,s=r.length;a<s;a++){var u=r[a];o.isNaN(u._depth)?e=!0:this._leafs.push(u)}e&&n.debug("warning: RenderBin::copyLeavesFromStateGraphListToRenderLeafList() detected NaN depth values, database may be corrupted."),this.stateGraphList.splice(0,this.stateGraphList.length)},getSortMode:function(){return this._sortMode},sortBackToFront:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(u)},sortFrontToBack:function(){this.copyLeavesFromStateGraphListToRenderLeafList(),this._leafs.sort(l)},sortImplementation:function(){var e=s;switch(this._sortMode){case e.SORT_BACK_TO_FRONT:this.sortBackToFront();break;case e.SORT_FRONT_TO_BACK:this.sortFrontToBack();break;case e.SORT_BY_STATE:}},sort:function(){if(!this._sorted){for(var e in this._bins)this._bins[e].sort();this.sortImplementation(),this._sorted=!0}},setParent:function(e){this._parent=e},getParent:function(){return this._parent},getBinNumber:function(){return this._binNum},findOrInsert:function(e,t){var i=this._bins[e];return i||(i=this._createRenderBin(t),i._parent=this,i._binNum=e,i._renderStage=this._renderStage,this._bins[e]=i),i},getStage:function(){return this._renderStage},addStateGraph:function(e){this.stateGraphList.push(e)},reset:function(){this.stateGraphList.length=0,this._bins={},this.positionedAttribute.length=0,this._leafs.length=0,this._sorted=!1},draw:function(e,t){var i=t;return i=this._drawCallback&&this._drawCallback.drawImplementation?this._drawCallback.drawImplementation(this,e,i):this.drawImplementation(e,i)},applyPositionedAttribute:function(e,t){for(var i=0,r=t.length;i<r;i++){var n=t[i],a=n[1],o=n[0];e.setGlobalDefaultAttribute(a),a.apply(e),a.applyPositionedUniform(o,e),e.haveAppliedAttribute(a)}},drawImplementation:function(e,t){var i=t,r=[];for(var n in this._bins)r.push(this._bins[n]);r.sort(c);for(var a,o=0,s=r.length;o<s&&(a=r[o],!(a.getBinNumber()>0));o++)i=a.draw(e,i);for(i=this.drawLeafs(e,i);o<s;o++)a=r[o],i=a.draw(e,i);return i},drawLeafs:function(e,t){for(var i,r=this.stateGraphList,n=this._leafs,a=t,o=0,s=n.length;o<s;o++)i=n[o],i.render(e,a),a=i;for(var u=0,l=r.length;u<l;u++)for(var c=r[u],h=0,d=c.leafs.length;h<d;h++)i=c.leafs[h],i.render(e,a),a=i;return a}}),"osg","RenderBin"),s.getOrCreate=function(){var e=s._reservedStack[s._reservedStackCurrent++];return s._reservedStackCurrent===s._reservedStack.length&&s._reservedStack.push(new s),e},s.resetStack=function(){s._reservedStackCurrent=0},s._reservedStack=[new s],s._reservedStackCurrent=0,e.exports=s},function(e,t,i){"use strict";var r=i(14),n=i(165),a=i(674),o=i(67),s=i(499),u=i(427),l=function(){o.call(this,o.TRAVERSE_ALL_CHILDREN)};r.createPrototypeObject(l,r.objectInherit(o.prototype,{apply:function(e){if(e.getTypeID()===u.getTypeID()){var t=e.getUpdateCallback();if(t instanceof s){for(var i=t._stackedTransforms,r=0,n=i.length;r<n;r++){i[r].resetToDefaultValue()}t.computeChannels()}}this.traverse(e)}}),"osgAnimation","ResetRestPoseVisitor");var c=new l,h=function(){n.call(this)};r.createPrototypeNode(h,r.objectInherit(n.prototype,{setDefaultUpdateCallback:function(){this.addUpdateCallback(new a)},setRestPose:function(){this.accept(c)}}),"osgAnimation","Skeleton"),e.exports=h},function(e,t,i){"use strict";var r=i(14),n=i(8).mat4,a=i(456),o=function(){a.call(this),this._stackedTransforms=[],this._matrix=n.create(),this._dirty=!1};r.createPrototypeObject(o,r.objectInherit(a.prototype,{getStackedTransforms:function(){return this._stackedTransforms},computeChannels:function(){this._dirty=!0;var e=this._matrix;n.identity(e);for(var t=this._stackedTransforms,i=0,r=t.length;i<r;i++){t[i].applyToMatrix(e)}},update:function(e){return n.copy(e.getMatrix(),this._matrix),this._dirty&&(e.dirtyBound(),this._dirty=!1),!0}}),"osgAnimation","UpdateMatrixTransform"),e.exports=o},function(e,t,i){"use strict";var r=i(429),n=0,a=function(e,t){for(var i=1/0,r=-1/0,a=0;a<e.length;a++)i=Math.min(i,e[a].start),r=Math.max(r,e[a].end);var o=r-i,s=t||"animation"+n.toString();return n++,{channels:e,duration:o,name:s,start:i}},o=function(e){for(var t=[],i=0;i<e.channels.length;i++){var n=r.createInstanceChannel(e.channels[i]);t.push(n)}return{channels:t,duration:e.duration,start:0,name:e.name,firstKeyTime:e.start}},s=function(){};s.createAnimation=a,s.createInstanceAnimation=o,e.exports=s},function(e,t,i){"use strict";var r=i(421),n=i(8).mat4,a=function(e){this._boundStrategy=e,void 0===this._boundStrategy&&(this._boundStrategy=a.COMPUTE_HOME_USING_SPHERE),this._controllerList={},this._inverseMatrix=n.create(),this._camera=void 0,this._node=void 0,this._frustum={},this._computeBoundNodeMaskOverride=-1};a.prototype={setCamera:function(e){this._camera=e},getCamera:function(){return this._camera},setNode:function(e){this._node=e},setComputeBoundNodeMaskOverride:function(e){this._computeBoundNodeMaskOverride=e},getComputeBoundNodeMaskOverride:function(){return this._computeBoundNodeMaskOverride},getHomeBound:function(e){var t=this._node;if(t){var n=void 0!==e?e:this._boundStrategy;if(n&a.COMPUTE_HOME_USING_BBOX){var o=new r,s=null;if(-1===this._computeBoundNodeMaskOverride)s=t.getBoundingBox();else{var u=i(496),l=new u;l.setNodeMaskOverride(this._computeBoundNodeMaskOverride),l.reset(),l.apply(t),s=l.getBoundingBox()}if(s.valid()&&o.expandByBoundingBox(s),n&a.COMPUTE_HOME_USING_SPHERE){var c=t.getBound();if(c.radius()<o.radius())return c}return o}return t.getBound()}},getHomeDistance:function(e){var t=this._frustum,i=e.radius();if(this._camera&&n.getFrustum(t,this._camera.getProjectionMatrix())){var r=Math.abs(t.right-t.left)/t.zNear/2,a=Math.abs(t.top-t.bottom)/t.zNear/2;i/=Math.sin(Math.atan2(a<r?a:r,1))}else i*=1.5;return i},update:function(){},getInverseMatrix:function(){return this._inverseMatrix},getControllerList:function(){return this._controllerList}},a.COMPUTE_HOME_USING_SPHERE=1,a.COMPUTE_HOME_USING_BBOX=2,e.exports=a},function(e,t){var i=function(e,t){this._current=new Float32Array(e),this._target=new Float32Array(e),this._delta=new Float32Array(e),this._delay=void 0!==t?t:.15,this._reset=!1,this._start=0,this.reset()};i.prototype={setDelay:function(e){this._delay=e},reset:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=0;this._reset=!0},update:function(e){for(var t=Math.min(1,this._delay*e*60),i=0,r=this._current.length;i<r;i++){var n=(this._target[i]-this._current[i])*t;this._delta[i]=n,this._current[i]+=n}return this._delta},set:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=arguments[e];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var e=0,t=this._target.length;e<t;e++)this._reset?this._target[e]=this._current[e]=arguments[e]:this._target[e]=arguments[e];this._reset=!1},addTarget:function(){for(var e=0;e<arguments.length;e++)this._target[e]+=arguments[e]},getTarget:function(){return this._target},getDelta:function(){return this._delta},getStart:function(){return this._start},setStart:function(e){this._start=e}},e.exports=i},function(e,t,i){"use strict";var r=i(14),n=i(67),a=i(8).mat4,o=i(423),s=i(146),u=function(){n.call(this),this._intersector=void 0,this._projectionStack=[a.IDENTITY],this._modelStack=[a.IDENTITY],this._viewStack=[a.IDENTITY],this._windowStack=[a.IDENTITY],this.reset()};r.createPrototypeObject(u,r.objectInherit(n.prototype,{reset:function(){u._reservedMatrixStack.reset()},setIntersector:function(e){this._intersector=e},getIntersector:function(){return this._intersector},pushModelMatrix:function(e){this._modelStack.push(e)},getModelMatrix:function(){return this._modelStack.length?this._modelStack[this._modelStack.length-1]:void 0},popModelMatrix:function(){return this._modelStack.pop()},pushViewMatrix:function(e){this._viewStack.push(e)},getViewMatrix:function(){return this._viewStack.length?this._viewStack[this._viewStack.length-1]:void 0},popViewMatrix:function(){return this._viewStack.pop()},pushProjectionMatrix:function(e){this._projectionStack.push(e)},getProjectionMatrix:function(){return this._projectionStack.length?this._projectionStack[this._projectionStack.length-1]:void 0},popProjectionMatrix:function(){return this._projectionStack.pop()},pushWindowMatrix:function(e){this._windowStack.push(e)},pushWindowMatrixUsingViewport:function(e){this._windowStack.push(e.computeWindowMatrix(u._reservedMatrixStack.get()))},getWindowMatrix:function(){return this._windowStack.length?this._windowStack[this._windowStack.length-1]:void 0},popWindowMatrix:function(){return this._windowStack.pop()},getTransformation:function(){var e=a.create64();return function(){return a.copy(e,this.getWindowMatrix()||a.IDENTITY),a.mul(e,e,this.getProjectionMatrix()||a.IDENTITY),a.mul(e,e,this.getViewMatrix()||a.IDENTITY),a.mul(e,e,this.getModelMatrix()||a.IDENTITY),e}}(),enter:function(e){return this._intersector.enter(e)},apply:function(e){e.getViewMatrix?this.applyCamera(e):e.getMatrix?this.applyTransform(e):this.applyNode(e)},applyCamera:function(e){var t=e.getViewport();void 0!==t&&this.pushWindowMatrixUsingViewport(t);var i,r,n;e.getReferenceFrame()===s.RELATIVE_RF&&this.getViewMatrix()&&this.getProjectionMatrix()?(i=a.mul(u._reservedMatrixStack.get(),this.getProjectionMatrix(),e.getProjectionMatrix()),r=this.getViewMatrix(),n=a.mul(u._reservedMatrixStack.get(),this.getModelMatrix(),e.getViewMatrix())):(i=e.getProjectionMatrix(),r=e.getViewMatrix(),n=a.identity(u._reservedMatrixStack.get())),this.pushProjectionMatrix(i),this.pushViewMatrix(r),this.pushModelMatrix(n),this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(e),this.popModelMatrix(),this.popViewMatrix(),this.popProjectionMatrix(),void 0!==t&&this.popWindowMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())},applyNode:function(e){if(this.enter(e))return e.getPrimitiveSetList?void this._intersector.intersect(this,e):void(e.traverse&&this.traverse(e))},applyTransform:function(e){if(this.enter(e)){if(e.getReferenceFrame()===s.ABSOLUTE_RF){var t=u._reservedMatrixStack.get();this.pushViewMatrix(a.identity(t)),this.pushModelMatrix(e.getMatrix())}else if(this._modelStack.length>0){var i=a.copy(u._reservedMatrixStack.get(),this.getModelMatrix());a.mul(i,i,e.getMatrix()),this.pushModelMatrix(i)}else this.pushModelMatrix(e.getMatrix());this._intersector.setCurrentTransformation(this.getTransformation()),this.traverse(e),this.popModelMatrix(),e.getReferenceFrame()===s.ABSOLUTE_RF&&this.popViewMatrix(),this._intersector.setCurrentTransformation(this.getTransformation())}}}),"osgUtil","IntersectionVisitor"),u._reservedMatrixStack=new o,e.exports=u},function(e,t,i){"use strict";var r=i(8).vec3,n=i(8).mat4,a=i(585),o=i(431),s=function(){this._lineSegIntersector=void 0,this._intersectionVisitor=void 0,this._geometry=void 0,this._vertices=[],this._limitOneIntersection=!1},u=function(){this._start=r.create(),this._end=r.create(),this._iStart=r.create(),this._iEnd=r.create(),this._intersections=[],this._intersectionLimit=o.NO_LIMIT};u.prototype={set:function(e,t){r.copy(this._start,e),r.copy(this._iStart,e),r.copy(this._end,t),r.copy(this._iEnd,t)},setStart:function(e){r.copy(this._start,e),r.copy(this._iStart,e)},setEnd:function(e){r.copy(this._end,e),r.copy(this._iEnd,e)},reset:function(){this._intersections=[]},enter:function(e){return!e.isCullingActive()||this.intersects(e.getBound())},setIntersectionLimit:function(e){this._intersectionLimit=e},getIntersectionLimit:function(){return this._intersectionLimit},intersects:function(){var e=r.create(),t=r.create();return function(i){if(!i.valid())return!1;r.sub(e,this._iStart,i.center());var n=r.sqrLen(e)-i.radius2();if(n<=0)return!0;r.sub(t,this._iEnd,this._iStart);var a=r.sqrLen(t),o=2*r.dot(e,t),s=o*o-4*a*n;if(s<0)return!1;s=Math.sqrt(s);var u=.5/a,l=(-o-s)*u,c=(-o+s)*u;return!(l<=0&&c<=0)&&!(l>1&&c>1)}}(),intersect:function(){var e=new s,t=new a;return function(i,r){e._lineSegIntersector=this,e._intersectionVisitor=i,r.getPrimitives&&(e._geometry=r,e._vertices=r.getVertexAttributeList()),e._limitOneIntersection=this._intersectionLimit===o.LIMIT_ONE_PER_DRAWABLE||this._intersectionLimit===o.LIMIT_ONE,t.reset(),t.set(this._iStart,this._iEnd,e);var n=r.getShape();if(n)return n.intersectLineSegment(t,n.getNodes()[0],this._iStart,this._iEnd);if(r.computeTransformedVertices){var a=r.getVertexAttributeList(),s=a.Vertex.getElements();a.Vertex._elements=r.computeTransformedVertices(),t.apply(r),a.Vertex._elements=s}else t.apply(r)}}(),getIntersections:function(){return this._intersections},setCurrentTransformation:function(e){n.invert(e,e),r.transformMat4(this._iStart,this._start,e),r.transformMat4(this._iEnd,this._end,e)}},e.exports=u},function(e,t,i){"use strict";var r={};r.memoryPools={},r.OsgObjectMemoryPool=function(e){return{_memPool:[],reset:function(){return this._memPool=[],this},put:function(e){this._memPool.push(e)},get:function(){return this._memPool.length>0?this._memPool.pop():(this.grow(),this.get())},grow:function(t){var i;i=void 0===t?this._memPool.length>0?2*this._memPool.length:20:t;for(var r=this._memPool.length;r++<i;)this._memPool.push(new e);return this}}},r.OsgArrayMemoryPool=function(){return{_mempoolofPools:[],reset:function(){return this._memPoolofPools={},this},put:function(e){this._memPoolofPools[e.length]||(this._memPoolofPools[e.length]=[]),this._memPoolofPools[e.length].push(e)},get:function(e){if(this._memPoolofPools[e]){if(this._memPoolofPools.length>0)return this._memPool.pop()}else this._memPoolofPools[e]=[];return this.grow(e),this.get()},grow:function(e,t){void 0===t&&(t=this._memPool.length>0?2*this._memPool.length:5);for(var i=this._memPool.length;i++<t;)this._memPool.push(new Array(e));return this}}},r.OsgObjectMemoryStack=function(e){return{_current:0,_memPool:[new e],reset:function(){return this._current=0,this},get:function(){var t=this._memPool[this._current++];return this._current>=this._memPool.length&&this._memPool.push(new e),t}}},e.exports=r},function(e,t,i){"use strict";var r=i(10),n=i(146),a={};a.Object=function(e,t){var i=e.getJSON();if(i.Name&&t.setName(i.Name),i.UserDataContainer){var r=e.setJSON(i.UserDataContainer).readUserDataContainer();void 0!==r&&t.setUserData(r)}return t},a.Node=function(e,t){var i=e.getJSON();a.Object(e,t);var n=[];if(i.UpdateCallbacks)for(var o=t.addUpdateCallback.bind(t),s=0,u=i.UpdateCallbacks.length;s<u;s++){var l=e.setJSON(i.UpdateCallbacks[s]).readObject();n.push(l),l.then(o)}if(i.StateSet){var c=e.setJSON(i.StateSet).readObject();n.push(c),c.then(t.setStateSet.bind(t))}var h=[];if(i.Children)for(var d=0,p=i.Children.length;d<p;d++)h.push(e.setJSON(i.Children[d]).readObject());return r.all(n).then(function(){return r.all(h).then(function(e){for(var i=e.length,r=0;r<i;r++)t.addChild(e[r]);return t})})},a.StateSet=function(e,t){var i=e.getJSON();a.Object(e,t),void 0!==i.RenderingHint&&t.setRenderingHint(i.RenderingHint);var n=[];if(void 0!==i.AttributeList)for(var o=0,s=i.AttributeList.length;o<s;o++)!function(i){var r=e.setJSON(i).readObject();r.isRejected()||(n.push(r),r.then(t.setAttributeAndModes.bind(t)))}(i.AttributeList[o]);if(i.TextureAttributeList)for(var u=i.TextureAttributeList,l=0,c=u.length;l<c;l++)for(var h=u[l],d=0,p=h.length;d<p;d++)!function(i,r){var a=e.setJSON(r).readObject();a.isRejected()||(n.push(a),a.then(t.setTextureAttributeAndModes.bind(t,i)))}(l,h[d]);return r.all(n).then(function(){return t})},a.Material=function(e,t){var i=e.getJSON();return i.Diffuse&&i.Emission&&i.Specular&&void 0!==i.Shininess?(a.Object(e,t),t.setAmbient(i.Ambient),t.setDiffuse(i.Diffuse),t.setEmission(i.Emission),t.setSpecular(i.Specular),t.setShininess(i.Shininess),r.resolve(t)):r.reject()},a.BlendFunc=function(e,t){var i=e.getJSON();return i.SourceRGB&&i.SourceAlpha&&i.DestinationRGB&&i.DestinationAlpha?(a.Object(e,t),t.setSourceRGB(i.SourceRGB),t.setSourceAlpha(i.SourceAlpha),t.setDestinationRGB(i.DestinationRGB),t.setDestinationAlpha(i.DestinationAlpha),r.resolve(t)):r.reject()},a.CullFace=function(e,t){var i=e.getJSON();return void 0===i.Mode?r.reject():(a.Object(e,t),t.setMode(i.Mode),r.resolve(t))},a.BlendColor=function(e,t){var i=e.getJSON();return i.ConstantColor?(a.Object(e,t),t.setConstantColor(i.ConstantColor),r.resolve(t)):r.reject()},a.Light=function(e,t){var i=e.getJSON();return i.Ambient&&i.Diffuse&&i.Direction&&i.Position&&i.Specular&&void 0!==i.LightNum&&void 0!==i.SpotCutoff&&void 0!==i.LinearAttenuation&&void 0!==i.ConstantAttenuation&&void 0!==i.QuadraticAttenuation?(a.Object(e,t),t.setAmbient(i.Ambient),t.setConstantAttenuation(i.ConstantAttenuation),t.setDiffuse(i.Diffuse),t.setDirection(i.Direction),t.setLightNumber(i.LightNum),t.setLinearAttenuation(i.LinearAttenuation),t.setPosition(i.Position),t.setQuadraticAttenuation(i.QuadraticAttenuation),t.setSpecular(i.Specular),t.setSpotCutoff(i.SpotCutoff),t.setSpotBlend(.01),void 0!==i.SpotExponent&&t.setSpotBlend(i.SpotExponent/128),r.resolve(t)):r.reject()},a.Texture=function(e,t){var i=e.getJSON();a.Object(e,t),i.MinFilter&&t.setMinFilter(i.MinFilter),i.MagFilter&&t.setMagFilter(i.MagFilter),i.WrapT&&t.setWrapT(i.WrapT),i.WrapS&&t.setWrapS(i.WrapS);var r=i.File;return void 0===r&&(r="no-image-provided"),e.readImageURL(r).then(function(e){return t.setImage(e),t})},a.Projection=function(e,t){var i=e.getJSON();if(!i.Matrix)return r.reject();var n=a.Node(e,t);return t.setMatrix(i.Matrix),n},a.MatrixTransform=function(e,t){var i=e.getJSON();if(!i.Matrix)return r.reject();var n=a.Node(e,t);return t.setMatrix(i.Matrix),n},a.LightSource=function(e,t){var i=e.getJSON();if(!i.Light)return r.reject();var o=a.Node(e,t);return r.all([e.setJSON(i.Light).readObject(),o]).then(function(e){var r=e[0];return t.setLight(r),"ABSOLUTE_RF"===i.ReferenceFrame&&t.setReferenceFrame(n.ABSOLUTE_RF),t})},a.functionSortAttributes=function(e,t){return-1!==e.indexOf("TexCoord")&&-1!==t.indexOf("TexCoord")?parseInt(e.substr(8),10)-parseInt(t.substr(8),10):e<t?-1:e>t?1:0},a.Geometry=function(e,t){var i=e.getJSON();if(!i.VertexAttributeList)return r.reject();i.PrimitiveSetList=i.PrimitiveSetList||[];var n=[];n.push(a.Node(e,t));var o=t.getPrimitives(),s=o.push.bind(o),u=0,l=i.PrimitiveSetList.length;for(u=0;u<l;u++){var c=e.setJSON(i.PrimitiveSetList[u]).readPrimitiveSet();n.push(c),c.then(s)}var h=function(e,t){this.getVertexAttributeList()[e]=t},d=i.VertexAttributeList,p=window.Object.keys(d);for(p.sort(a.functionSortAttributes),l=p.length,u=0;u<l;u++){var f=p[u],g=e.setJSON(d[f]).readBufferArray();n.push(g),g.then(h.bind(t,f))}return r.all(n).then(function(){return t})},a.PagedLOD=function(e,t){var i=e.getJSON();a.Object(e,t),"USE_BOUNDING_SPHERE_CENTER"===i.CenterMode?t.setCenterMode(0):"UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED"===i.CenterMode&&t.setCenterMode(2),t.setCenter([i.UserCenter[0],i.UserCenter[1],i.UserCenter[2]]),t.setRadius(i.UserCenter[3]),"PIXEL_SIZE_ON_SCREEN"===i.RangeMode&&t.setRangeMode(1);for(var n,o=i.RangeList,s=0;s<window.Object.keys(o).length;s++){n="Range "+s;var u=o[n];t.setRange(s,u[0],u[1])}for(o=i.RangeDataList,s=0;s<window.Object.keys(o).length;s++)n="File "+s,t.setFileName(s,o[n]);t.setDatabasePath(e.getDatabasePath());var l=[];if(i.Children)for(var c=0,h=i.Children.length;c<h;c++)l.push(e.setJSON(i.Children[c]).readObject());return r.all(l).then(function(e){var i=e.length;for(s=0;s<i;s++)t.addChildNode(e[s]);return t})},e.exports=a},,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=i(90),o=i(31),s=n.a.osg,u=function(e,t,i,r){var n=i-e,a=r-t;return n*n+a*a},l=function(e){return 0==(e&e-1)},c=function(e){return l(e.width)&&l(e.height)},h={isVideoURL:function(e){var t=e.split("."),i=t[t.length-1].toLowerCase();return"ogv"===i||"ogg"===i||"mp4"===i||"avi"===i||"webm"===i},isVideo:function(){return this.isVideoURL(this.get("images")[0].url)},getUID:function(){return this.get("uid")},getImages:function(){return this.get("images")},getURL:function(){console.error("dont call ImageSet.getURL")},findFormat:function(e){if("N"===e){var t=i.i(r.filter)(this.get("images"),function(t){var r=t.options&&t.options.format===e&&t.options.quality;return"percep"===i.i(o.a)().normalCompression?r&&"percep"===r.flag:r&&"percep"!==r.flag});if(t.length)return t}return i.i(r.filter)(this.get("images"),function(t){return!t.options||t.options.format===e})},getFilteredImages:function(e){if(!e||i.i(a.a)()||!i.i(o.a)().imageCompression)return this.findFormat();var t;switch(e){case s.Texture.ALPHA:if(t=this.findFormat("A"),t.length>0)return t;break;case s.Texture.RGB:if(t=this.findFormat("RGB"),t.length>0)return t;if(t=this.findFormat("N"),t.length>0)return t;break;case s.Texture.LUMINANCE:if(t=this.findFormat("R"),t.length>0)return t;if(t=this.findFormat("RGB"),t.length>0)return t;if(t=this.findFormat("N"),t.length>0)return t}return this.findFormat()},findImageNearestPowerOfTwoUpToResolution:function(e,t,i){return this.findImageNearestUpToResolution(e,t,!0,i)},findImageNearestUpToResolution:function(e,t,i,r){for(var n,a,o=1/0,s=!1,l=1/0,h=this.getFilteredImages(r),d=0,p=h.length;d<p;++d){var f=h[d],g=u(e,t,f.width,f.height);if(g<o&&(o=g,n=f),!(f.width>e||f.height>t))if(i){var m=c(f);s&&!m||(!a||!s&&m||g<l||l===1/0&&f.width>a.width&&f.height>a.height)&&(a=f,s=m,l=g)}else(!a||g<l||l===1/0&&f.width>a.width&&f.height>a.height)&&(a=f,l=g)}return a||n},findImageSmallest:function(e){return this.findImageNearestToResolution(0,0,e)},findImageWidget:function(){return this.findImageNearestToResolution(0,0,s.Texture.RGB)},findImageNearestToResolution:function(e,t,i){for(var r,n=1/0,a=this.getFilteredImages(i),o=0,s=a.length;o<s;++o){var l=a[o],c=u(e,t,l.width,l.height);c<n&&(n=c,r=l)}return r}};t.a=h},function(e,t,i){"use strict";var r=i(0);i.n(r);t.a=function(e){var t={fileTypes:function(e,t){var i=t.name.replace(/^.*\.([^.]*)$/,"$1").toLowerCase();if(-1===e.indexOf(i))return"Unsupported format. Please upload a "+e.join(", ").toUpperCase()+"."},maxFileSize:function(e,t){if(!(t.size<e))return"Maximum upload size: "+Math.floor(e/1024/1024)+"MB (your file is "+Math.ceil(t.size/1024/1024)+"MB)."}};return{validateFile:function(n){if(null==e)return console.error("Ruleset not defined");var a,o=[];return i.i(r.each)(e,function(e,i){(a=t[i](e,n))&&o.push(a)}),o.join(" ")}}}},function(e,t,i){"use strict";var r=function(e){var t,i=window.WebKitBlobBuilder||window.MozBlobBuilder||window.BlobBuilder;t=e.split(",")[0].indexOf("base64")>=0?window.atob(e.split(",")[1]):window.decodeURI(e.split(",")[1]);for(var r=e.split(",")[0].split(":")[1].split(";")[0],n=new ArrayBuffer(t.length),a=new Uint8Array(n),o=0;o<t.length;o++)a[o]=t.charCodeAt(o);var s;if(void 0!==window.Blob)s=new Blob([a],{type:r});else if(void 0!==i){var u=new i;u.append(n),s=u.getBlob(r)}return s};t.a=r},function(e,t,i){"use strict";var r=i(5),n=i(69),a=r.a.osg,o=function(){a.CullVisitor.call(this),this._uNearFar=a.Uniform.createFloat2(a.vec2.fromValues(1,-1),"uNearFar"),this._separateVR=!1,this._isEnv=!1},s=o.vrConfig={doVR:!1,leftRenderWidth:0,rightRenderWidth:0,leftRenderHeight:0,rightRenderHeight:0,rightProjection:a.mat4.create(),leftProjection:a.mat4.create(),leftOffsetView:a.mat4.create(),rightOffsetView:a.mat4.create()};a.createPrototypeObject(o,a.objectInherit(a.CullVisitor.prototype,{popCameraModelViewProjectionMatrix:function(e){this.popModelViewMatrix(),this.popProjectionMatrix(e)},reset:function(){a.CullVisitor.prototype.reset.call(this),this._minNear=this._computedNear,this._maxFar=this._computedFar},updateNearFar:function(){this._minNear=Math.min(this._minNear,this._computedNear),this._maxFar=Math.max(this._maxFar,this._computedFar)},getNearFarUniform:function(){return this._uNearFar},popProjectionMatrix:function(e){if(!0===this._computeNearFar&&this._computedFar>=this._computedNear){var t=this.getCurrentProjectionMatrix(),i=void 0!==e&&!e.isRenderToTextureCamera()&&e.getReferenceFrame()===a.Transform.RELATIVE_RF,r="PostProcess - MainCamera"===e.getName();if((i||r)&&this.updateNearFar(),r){var n=this._projectionMatrixStack[0];a.mat4.copy(n,t),this.clampProjectionMatrix(n,this._minNear,this._maxFar,1e-5),s.doVR&&(this.clampProjectionMatrix(s.leftProjection,this._computedNear,this._computedFar,this._nearFarRatio),this.clampProjectionMatrix(s.rightProjection,this._computedNear,this._computedFar,this._nearFarRatio)),this.clampProjectionMatrix(t,this._computedNear,this._computedFar,this._nearFarRatio,this._uNearFar.getInternalArray())}else this.clampProjectionMatrix(t,this._computedNear,this._computedFar,this._nearFarRatio)}a.CullStack.prototype.popProjectionMatrix.call(this)},handleCullCallbacksAndTraverse:function(e){var t=s.doVR&&(this._nodeOut===e||"PostProcess - node Out"===e.getName());t&&(this._nodeOut=e,this._separateVR=!0);var i=this._nodeEnv===e||"Environment - Camera"===e.getName();i&&(this._nodeEnv=e,this._isEnv=!0);var r=e.getCullCallback();r&&!r.cull(e,this)||this.traverse(e),i&&(this._isEnv=!1),t&&(this._separateVR=!1)},pushLeaf:function(e,t){var i=this._currentStateGraph.leafs;0===i.length&&this._currentRenderBin.addStateGraph(this._currentStateGraph);var r=this._separateVR&&this.traversalMask!==n.a.SHADOW,o=this.createOrReuseRenderLeaf();if(o.isVR=r,r){var u=this._isEnv,l=this.getCurrentModelViewMatrix(),c=this.getCurrentViewMatrix();o.leftProjection=s.leftProjection,o.rightProjection=s.rightProjection;var h=o.leftModelView||a.mat4.create(),d=o.rightModelView||a.mat4.create();o.leftModelView=u?a.mat4.copy(h,l):a.mat4.multiply(h,s.leftOffsetView,l),o.rightModelView=u?a.mat4.copy(d,l):a.mat4.multiply(d,s.rightOffsetView,l);var p=o.leftView||a.mat4.create(),f=o.rightView||a.mat4.create();o.leftView=u?a.mat4.copy(p,c):a.mat4.multiply(p,s.leftOffsetView,c),o.rightView=u?a.mat4.copy(f,c):a.mat4.multiply(f,s.rightOffsetView,c)}o.init(this._currentStateGraph,e,this.getCurrentProjectionMatrix(),this.getCurrentViewMatrix(),this.getCurrentModelViewMatrix(),this.getCurrentModelMatrix(),t),i.push(o)}}),"osgSketchfab","Class"),t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(53),a=r.a.osg,o=function(e){this._duration=void 0===e?1:e,this.reset()};a.createPrototypeObject(o,{getDuration:function(){return this._duration},setDuration:function(e){this._duration=e},reset:function(){this._startTime=-1,this._finished=!1,this._ratio=0,n.a.draw()},finished:function(){},interpolate:function(e,t,i){if(this._finished)return 1;this._startTime<0&&(this._startTime=e);var r=Math.min(this._duration,e-this._startTime),n=0===this._duration?1:r/this._duration;return this._ratio=n,(n>=1||0===this._duration)&&(this._finished=!0,this.finished(t,i)),n},update:function(e,t){return this.interpolate(t.getFrameStamp().getSimulationTime(),e,t),!0}}),t.a=o},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=r.a.osgAnimation,o=function(e){for(var t=0,i=e.length;t<i;++t){var r,o=e[t];if(o instanceof a.Bone)r=a.UpdateBone;else{if(!(o instanceof n.MatrixTransform))continue;r=a.UpdateMatrixTransform}for(var s=o.getUpdateCallbackList(),u=0,l=s.length;u<l;++u)if(s[u]instanceof r)return!0}return!1};t.a=o},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=function(e,t,i){this._url=e,this._defer=n.a.defer(),this._responseType=t,this._promise=this._defer.promise,this._options=i};a.prototype={getPromise:function(){return this._promise},getURL:function(){return this._url},start:function(){this._xhr=new XMLHttpRequest,this._xhr.addEventListener("error",this.error.bind(this),!1),this._xhr.addEventListener("abort",this.abort.bind(this),!1),this._xhr.addEventListener("progress",this.progress.bind(this),!1),this._xhr.addEventListener("load",function(e){if(200!==this._xhr.status)return console.log("Error not loaded "+this._url),void this.error(e);this._xhr.response||(this._xhr.response=this._xhr.responseText),this.load.call(this)}.bind(this),!1),this._xhr.open("GET",this._url,!0),this._xhr.responseType=this._responseType,this._xhr.send(null)},error:function(){console.log("Error not loaded "+this._url),this._defer.reject(this)},abort:function(){console.log("Error not loaded "+this._url),this._defer.reject(this)},progress:function(e){var t=this._options;t&&t.progress&&t.size&&t.progress(e.loaded/t.size,t.secondary,t.idChannel)},load:function(){this._defer.resolve(this)},getXHR:function(){return this._xhr}},t.a=a},function(e,t,i){"use strict";var r=i(5),n=i(387),a=r.a.osgShader,o=r.a.osg,s=n.a.prototype,u=function(){n.a.apply(this,arguments),this._outputs=[],this._index=u.DEFAULT},l=u;l.DIFFUSE=1,l.SPECULAR=2,l.ROUGHNESS=4,l.GEOMETRY=8,l.EMIT=16,l.ENVIRONMENT=32,l.MATCAP=64,l.WIREFRAME=128,l.DEFAULT=l.DIFFUSE|l.SPECULAR|l.ROUGHNESS|l.GEOMETRY|l.EMIT|l.ENVIRONMENT,a.Compiler.setStateAttributeConfig(u,a.Compiler.cloneStateAttributeConfig(n.a)),o.createPrototypeObject(u,o.objectInherit(n.a.prototype,{getCompilerName:function(){return"Blending"},setOutputs:function(e,t){this._outputs[0]=e,this._outputs[1]=t},computeShader:function(e){return this._index=e,e&u.MATCAP?this.getMatcapFragment():this.getDefaultFragment()},createFragmentShaderGraph:function(){var e=this.computeShader(this._outputs[0]),t=this._outputs[1]!==this._outputs[0]?this.computeShader(this._outputs[1]):e,i=this.createVariable("vec3");return this.getNode("Blend").mode("MIX").inputs(e,t,this.getOrCreateUniform("float","uBlend")).outputs(i),[this.getFinalFrag(i)]},getDefaultFragment:function(){var e,t=this.createLighting(),i=this._index&l.ENVIRONMENT?this.getEnvironment():void 0;return t&&i?(e=this.createVariable("vec3"),this.getNode("Add").inputs(t,i).outputs(e)):e=t||i||this.getOrCreateConstantZero("vec3"),this._index&l.EMIT&&(e=this.applyEmissive(e)),e},getOrCreateMaterialDiffuseColor:function(){return this._index&l.DIFFUSE?s.getOrCreateMaterialDiffuseColor.call(this):this.getOrCreateConstantZero("vec3")},getOrCreateMaterialSpecularColor:function(){return this._index&l.SPECULAR?s.getOrCreateMaterialSpecularColor.call(this):this.getOrCreateConstantZero("vec3")},getOrCreateMaterialSpecularHardness:function(){return this._index&l.SPECULAR?s.getOrCreateMaterialSpecularHardness.call(this):this.getOrCreateConstantOne("float")},getOrCreateMaterialNormal:function(){return this._index&l.GEOMETRY?s.getOrCreateMaterialNormal.call(this):this.getOrCreateNormalizedFrontViewNormal()},getMatcapFragment:function(){return this.getOrCreateChannel("Matcap")}})),t.a=u},function(e,t,i){"use strict";var r=i(5),n=i(463),a=i(31),o=r.a.osg,s=r.a.osgShader,u=function(){n.a.apply(this,arguments),this._isVertexAlpha=!!this._material&&this._material.getVertexAlphaEnable(),this._isVertexColored=this._isVertexAlpha},l={attribute:["SketchfabMaterial","ShadowCast","Morph","Skinning","PointSize"],textureAttribute:["Texture"]};s.Compiler.setStateAttributeConfig(u,l),o.createPrototypeObject(u,o.objectInherit(n.a.prototype,{getCompilerName:function(){return"earlyZ"},getOrCreateChannel:function(e){switch(e){case"Opacity":case"Displacement":return n.a.prototype.getOrCreateChannel.call(this,e)}},registerTextureEnvironment:function(){},registerTextureShadow:function(){},createDepthColor:function(){var e=this.createVariable("vec4"),t=["float depth = (-%fragEye.z * %fragEye.w - %nearFar.x) / (%nearFar.y - %nearFar.x);","%color.rgb = vec3(1.0, 255.0, 65025.0) * depth;","%color.gb = fract(%color.gb);","%color.rg -= %color.gb * (1.0/256.0);"],r=i.i(a.a)().ssaoNormal,n={fragEye:this.getOrCreateVarying("vec4","vViewVertex"),nearFar:this.getOrCreateUniform("vec2","uNearFar"),normal:r?this.getOrCreateMaterialNormal():void 0,drawOpaque:this.getOrCreateUniform("int","uDrawOpaque")},o=this.isAlphaBlendedMaterial()?this.getOrCreateChannel("Opacity"):void 0;if(o){n.alpha=o;var s=(1-i.i(a.a)().epsilonAlpha).toExponential();t.unshift("if(%drawOpaque == 1 && %alpha < "+s+") discard;"),t.push("%color.a = %drawOpaque == 1 ? 1.0 : %alpha;")}else t.push("%color.a = 1.0;");return r&&t.push("%color.ba = normalize(%normal).rg * 0.5 + 0.5;"),this.getNode("InlineCode").code(t.join("\n")).inputs(n).outputs({color:e}),e},createFragmentShaderGraph:function(){var e=this.getNode("glFragColor");return this.applyPointSizeCircle(e),this.applyAlphaMask(e),this.getNode("SetFromNode").inputs(this.createDepthColor()).outputs(e),[e]}})),t.a=u},function(e,t,i){"use strict";var r=i(5),n=i(297),a=i(463),o=r.a.osg,s=function(){n.a.apply(this,arguments),this.setShaderCompiler(a.a)};o.createPrototypeObject(s,n.a.prototype),t.a=s},,function(e,t,i){"use strict";var r=i(5),n=i(69),a=i(86),o=i(129),s=i(866),u=i.n(s),l=i(865),c=i.n(l),h=i(0),d=(i.n(h),r.a.osg),p=d.BufferArray,f=d.Geometry,g=d.primitiveSet,m=d.DrawElements,v=d.vec4.fromValues(1,1,1,1),_=function(e,t,i,r,n,a){d.MatrixTransform.call(this),this._subX=void 0!==n?n:1,this._subY=void 0!==a?a:1,this._curveAxis=i,this._curveFactor=r,this._distanceFromCam=2.5,this._width=1,t&&(this._distanceFromCam=t),e&&(this._width=e),this._clickActions={},this._opacity=1,this._round=.02,this._opaqueRollover=!1,this._visible=!0,this._currentPage=0,this._enabled=!0};_.AXIS_X=0,_.AXIS_Y=1,_.AXIS_BOTH=2,d.createPrototypeNode(_,d.objectInherit(d.MatrixTransform.prototype,{initialize:function(e,t){this._texPanel=e,this._metaData=this._computeMetaData(t),this._panelGeom=this._createGridGeometry(this._metaData.cells),this.addChild(this._panelGeom);var i=this._panelGeom.getOrCreateStateSet(),r=d.Uniform.createFloat1(this._opacity,"uAlpha");this._uAlpha=r.getInternalArray(),i.addUniform(r);var n=d.Uniform.createFloat1(t.aspectRatio,"uRatio");this._uRatio=n.getInternalArray(),i.addUniform(n);var s=d.Uniform.createFloat1(this._enabled?1:.5,"uVeilFactor");this._uVeilFactor=s.getInternalArray(),i.addUniform(s),i.addUniform(d.Uniform.createFloat1(this._opaqueRollover?1:0,"uHoveredOpaque"));var l=d.Uniform.createFloat1(this._round,"uRound");i.addUniform(l),i.addUniform(d.Uniform.createInt(0,"uTexturePanel")),i.setTextureAttributeAndModes(0,this._texPanel),i.setAttributeAndModes(new d.CullFace(d.CullFace.DISABLE));var h=o.a.getOrCreateShader(u.a,c.a,"textured-panel","TexturedPanel");i.setAttributeAndModes(h);var p=d.Uniform.createFloat4(v,"uHoveredArea");this._uHoveredArea=p.getInternalArray(),i.addUniform(p),i.setRenderBinDetails(a.a.VR_MENU,"RenderBin"),i.setAttributeAndModes(new d.BlendFunc(d.BlendFunc.ONE,d.BlendFunc.ONE_MINUS_SRC_ALPHA)),this.initPage(),this._initialized=!0},changeTexture:function(e){var t=this._panelGeom.getOrCreateStateSet();this._texPanel=e,t.setTextureAttributeAndModes(0,this._texPanel)},updateMetaData:function(e){this._metaData=this._computeMetaData(e),this._uRatio[0]=this._metaData.aspectRatio},setEnabled:function(e){this._enabled=e,this._uVeilFactor&&(this._uVeilFactor[0]=e?1:.5)},setMetaData:function(e){this._metaData=e,this._uRatio[0]=this._metaData.aspectRatio},getTexture:function(){return this._texPanel},isInitialized:function(){return this._initialized},setVisible:function(e){if(this._visible!==e){if(this._animation){if(!this._animation.isFinished())return;e&&this._doSetVisible(!0),this._animation.start(0)}else this._doSetVisible(e);this._visible=e}},_doSetVisible:function(e){this.setNodeMask(e?n.a.PICK_GEOMETRY_FAST:0),this._uAlpha&&(this._uAlpha[0]=1),e||this.initPage()},isVisible:function(){return this._visible},setOpacity:function(e){this._opacity=e,this._uAlpha&&(this._uAlpha[0]=e)},updateHit:function(e){if(this._initialized&&this._enabled){var t=e&&e._localIntersectionPoint;if(!e||-1===e._nodePath.indexOf(this))return void(void 0!==this._currentHovered&&(this._currentHovered=void 0,d.vec4.copy(this._uHoveredArea,v)));var i={x:(t[0]+.5*this._width)/this._width,y:(t[1]+.5*this._height)/this._height},r=this._metaData.pages?this._findPage(i):void 0,n=i.x,a=i.y;if(r){var o=r.areas;if(o)for(var s=0;s<o.length;s++)if(this._checkArea(o[s],n,a,r.items[s],r))return this}return"WHOLE_PANEL"!==this._currentHovered&&(this._currentHovered="WHOLE_PANEL",d.vec4.copy(this._uHoveredArea,v)),this}},_findPage:function(e){for(var t=e.x,i=e.y,r=0;r<this._metaData.cells.length;r++){var n=this._metaData.cells[r],a=n.x/this._width,o=1-n.y/this._height,s=(n.x+n.width)/this._width,u=1-(n.y+n.height)/this._height;if(t>=a&&t<=s&&i<=o&&i>=u)return e.x=(t-a)/(s-a),e.y=(i-u)/(o-u),n.page}},_checkArea:function(e,t,i,r,n){return t>e[0]&&t<e[1]&&i<e[2]&&i>e[3]&&(this._currentHovered!==r&&(this._currentHovered=r,n?(this._uHoveredArea[0]=n.x+e[0]*n.width,this._uHoveredArea[1]=n.x+e[1]*n.width,this._uHoveredArea[2]=1-n.y-n.height+e[2]*n.height,this._uHoveredArea[3]=1-n.y-n.height+e[3]*n.height):d.vec4.copy(this._uHoveredArea,e)),!0)},click:function(){if(this._currentHovered)if("WHOLE_PANEL"!==this._currentHovered){var e=this._clickActions[this._currentHovered];e&&e()}else this._panelClickAction&&this._panelClickAction()},initPage:function(){this._metaData&&this._metaData.pages&&this.setPageForCell(this._metaData.pages[0].id,this._metaData.cells[0].id)},setPageForCell:function(e,t){var i=this._getPage(e);if(!i)return void d.log("can't find page named "+e+" for panel "+(this._metaData?this._metaData.id:"unknown"));var r=this._getCell(t);if(!r)return void d.log("can't find cell named "+t+" for panel "+(this._metaData?this._metaData.id:"unknown"));r.page=i;for(var n=this._panelGeom.getAttributes().TexCoord0,a=n.getElements(),o=this._subY,s=this._subX,u=r.startIndex?r.startIndex:0,l=0;l<=o;l++)for(var c=0;c<=s;c++){var h=2*u;a[h]=i.x+c/s*i.width,a[h+1]=1-i.y-l/o*i.height,u++}n.dirty(),this._panelGeom.dirty()},_getPage:function(e){if(this._metaData&&this._metaData.pages)for(var t=0;t<this._metaData.pages.length;t++)if(this._metaData.pages[t].id===e)return this._metaData.pages[t]},_getCell:function(e){if(this._metaData&&this._metaData.cells)return this._metaData.cells.find(function(t){return t.id===e})},setClickAction:function(e,t){this._clickActions[e]=t},removeClickAction:function(e){delete this._clickActions[e]},setPanelClickAction:function(e){this._panelClickAction=e},removePanelClickAction:function(){this._panelClickAction=void 0},displayInView:function(){var e=d.vec3.create(),t=d.vec3.create(),i=d.vec3.fromValues(0,0,.1),r=d.vec3.create();return function(n,a,o){d.vec3.copy(e,a),e[2]=n[2];var s=d.mat4.lookAt(this.getMatrix(),n,e,i);d.mat4.invert(s,s);var u=o;d.mat4.scale(s,s,d.vec3.set(t,u,u,u)),d.vec3.sub(r,e,n),d.vec3.normalize(r,r),d.vec3.scale(r,r,this._distanceFromCam*o),d.vec3.add(r,n,r),r[2]+=-.2*o,d.mat4.setTranslation(s,r),this.dirtyBound(),this.setVisible(!0)}}(),setAnimation:function(e){e.setOnFinishCallback(this._onAnimationFinished.bind(this)),this._animation=e,this.addUpdateCallback(e)},getAnimation:function(){return this._animation},_onAnimationFinished:function(){this._visible||this._doSetVisible(!1)},_computeMetaData:function(e){var t=i.i(h.extend)(e,{aspectRatio:e.cellsWidth?e.cellsWidth/e.cellsHeight:e.width/e.height});this._height=this._width/t.aspectRatio;var r,n;if(t.pages)for(n=0;n<t.pages.length;n++){var a=t.pages[n];if(a.areas)for(r=0;r<a.areas.length;r++){var o=a.areas[r];o[0]=o[0]/a.width,o[1]=o[1]/a.width,o[2]=1-o[2]/a.height,o[3]=1-o[3]/a.height}a.x/=e.width,a.y/=e.height,a.width/=e.width,a.height/=e.height}if(t.cells&&t.cells.length>0)for(r=0;r<t.cells.length;r++){var s=t.cells[r];s.x=s.x/t.cellsWidth*this._width,s.y=s.y/t.cellsHeight*this._height,s.z/=100,s.width=s.width/t.cellsWidth*this._width,s.height=s.height/t.cellsHeight*this._height}else t.cells=[{id:"default",x:0,y:0,z:0,width:this._width,height:this._height}];return t},_createTexturedGridGeometry:function(e,t,i,r,n,a,o,s,u,l,c,h){t*=-1,s&&(u=void 0!==u?u:.2);for(var d=r/a,p=n/o,f=this._verticesIndex,g=0,m=0,v=this._indicesIndex,b=0,x=0,S=0;S<=o;S++)for(var y=0;y<=a;y++)g=3*f,m=2*f,c[m]=y/a,c[m+1]=1-S/o,s&&(s!==_.AXIS_X&&s!==_.AXIS_BOTH||(b=y/a-.5,b=b*b*u),s!==_.AXIS_Y&&s!==_.AXIS_BOTH||(x=S/o-.5,x=x*x*u)),l[g]=e+d*y,l[g+1]=t-p*S,l[g+2]=i+b+x,f++;var C=this._verticesIndex;this._verticesIndex=f;for(var T=0;T<a*o;T++)v=this._indicesIndex+6*T,f=C+T+Math.floor(T/a),h[v]=f,h[v+1]=a+1+f,h[v+2]=a+1+f+1,h[v+3]=a+1+f+1,h[v+4]=f+1,h[v+5]=f;this._indicesIndex=v+6},_createGridGeometry:function(e){var t=this._subY,i=this._subX,r=(i+1)*(t+1)*e.length,n=new f,a=new Float32Array(3*r),o=new Float32Array(2*r),s=new Float32Array(i*t*6*e.length);this._verticesIndex=0,this._indicesIndex=0;for(var u=.5*this._width,l=.5*this._height,c=0;c<e.length;c++){var h=e[c];h.startIndex=this._verticesIndex,this._createTexturedGridGeometry(h.x-u,h.y-l,h.z,h.width,h.height,i,t,this._curveAxis,this._curveFactor,a,o,s)}n.getAttributes().Vertex=new p(p.ARRAY_BUFFER,a,3),n.getAttributes().TexCoord0=new p(p.ARRAY_BUFFER,o,2);var d=new m(g.TRIANGLES,new p(p.ELEMENT_ARRAY_BUFFER,s,1));return n.getPrimitives().push(d),n}}),"osgSketchfab","TexturedPanel"),t.a=_},,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(2),o=i.n(a),s=i(15),u=i(508),l="/i/textures";t.a=s.a.extend({url:function(){return this.isNew()?l:l+"/"+this.get("uid")},isValid:function(){var e=this.get("name");return void 0===e&&console.warn("no name for Texture "+this.id),e=e||this.id,void 0===this.get("images")&&console.warn("no images for Texture "+e),void 0===this.get("uid")&&console.warn("no uid for Texture "+e),!0},save:function(e,t){null!=e&&"object"!=typeof e||(t=e);var i=new FormData;return i.append("imageFile",this.get("imageFile"),this.get("name")),i.append("colorSpace",this.get("colorSpace")),i.append("modelUid",t.modelUID),n.a.resolve(o.a.ajax({url:this.url(),data:i,processData:!1,contentType:!1,type:"POST"}))},saveColorspace:function(){return n.a.resolve(o.a.ajax({url:this.url(),data:{colorSpace:this.get("colorSpace")},type:"PATCH"}))}}).extend(u.a)},,,,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=i(15),o=i(599),s=i(92),u=n.a.osg,l=i.i(r.invert)(u.Texture),c=["magFilter","minFilter","wrapS","wrapT","textureTarget","internalFormat"],h=a.a.extend({initialize:function(){if(a.a.prototype.initialize.apply(this,arguments),!this.attributes.image)return void u.error("no image found in attributes, TextureModel invalid");var e=o.a.createValidOptionsForMaterial(this.attributes);this.set(e),this.setMultiresTextureFromValidOptions(e),void 0===this.get("texCoordUnit")&&this.set("texCoordUnit",0),this.bind("change:image",this.updateMultiresTexture,this)},getImageModel:function(){return this.get("image")},setImageModel:function(e){this.set("image",e)},getResourceManager:function(){return this._resourceManager||s.default.instance},getMultiresTexture:function(){return this.get("multiresTexture")},getURL:function(){console.trace("dont call TextureModel.getURL")},setMultiresTextureFromValidOptions:function(e){var t=this.get("image").getUID(),i=this.getResourceManager().getOrCreateMultiresTexture(t,e);i&&this.set("multiresTexture",i.resource)},updateMultiresTexture:function(){this.setMultiresTextureFromValidOptions(o.a.createValidOptionsForMaterial(this.attributes))},getUID:function(){return this.getImageModel().getUID()},getJSON:function(){for(var e={},t=0,i=c.length;t<i;++t){var r=c[t];e[r]=l[this.get(r)]}return e.texCoordUnit=this.get("texCoordUnit"),e.uid=this.getUID(),e}});t.a=h},,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var r=i(174);t.a=r.a.extend({events:{"click .close":"hide","touchstart .close":"hide"},show:function(e){e&&e.preventDefault&&e.preventDefault(),this.$el.removeClass("hidden")},hide:function(e){e&&e.preventDefault&&e.preventDefault(),this.$el.addClass("hidden")},isVisible:function(){return!this.$el.hasClass("hidden")}})},,function(e,t){},,function(e,t,i){"use strict";var r=i(14),n=i(332),a=i(8).vec3,o=i(8).vec4,s=i(8).quat,u=i(8).mat4,l=i(67),c=i(146),h=i(135),d=function(){n.call(this),this._matrix=u.create(),this._position=a.create(),this._matrixDirty=!0,this._scale=a.fromValues(1,1,1),this._minimumScale=0,this._maximumScale=Number.MAX_VALUE,this._rotation=s.create(),this._pivotPoint=a.create(),this._autoScaleToScreen=!1,this._autoRotateToScreen=!1,this._cachedMatrix=u.create(),this._firstTimeToInitEyePoint=!0,this._autoScaleTransitionWidthRatio=.25,this._billboardAttribute=void 0,this._previousWidth=0,this._previousHeight=0,this._previousProjection=u.create(),this._previousModelView=u.create(),this._previousPosition=a.create()};r.createPrototypeNode(d,r.objectInherit(n.prototype,{getMatrix:function(){return this._matrix},setMatrix:function(e){this._matrix=e,this.dirtyBound()},setPosition:function(e){this._position=e,this._matrixDirty=!0,this.dirtyBound()},getPosition:function(){return this._position},setRotation:function(e){this._rotation=e,this._matrixDirty=!0,this.dirtyBound()},getRotation:function(){return this._rotation},setScale:function(e){this.setScaleFromvec3(a.fromValues(e,e,e))},setScaleFromvec3:function(e){this._scale=e,this._matrixDirty=!0,this.dirtyBound()},getScale:function(){return this._scale},setMinimumScale:function(e){this._minimumScale=e},getMinimumScale:function(){return this._minimumScale},setMaximumScale:function(e){this._maximumScale=e},getMaximumScale:function(){return this._maximumScale},setAutoScaleToScreen:function(e){this._autoScaleToScreen=e,this._matrixDirty=!0},getAutoScaleToScreen:function(){return this._autoScaleToScreen},setAutoRotateToScreen:function(e){this._autoRotateToScreen=e},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setAutoScaleTransitionWidthRatio:function(e){this._autoScaleTransitionWidthRatio=e},getAutoScaleTransitionWidthRatio:function(){return this._autoScaleTransitionWidthRatio},computeLocalToWorldMatrix:function(e){this._matrixDirty&&this.computeMatrix(),this.referenceFrame===c.RELATIVE_RF?u.mul(e,e,this._matrix):u.copy(e,this._matrix)},computeMatrix:function(){var e=a.create(),t=u.create();return function(){this._matrixDirty&&(u.fromQuat(this._matrix,this._rotation),u.fromTranslation(t,this._position),u.mul(this._matrix,t,this._matrix),u.scale(this._matrix,this._matrix,this._scale),u.translate(this._matrix,this._matrix,a.neg(e,this._pivotPoint)),this._matrixDirty=!1)}}(),computeWorldToLocalMatrix:function(){var e=a.create(),t=s.create(),i=a.create(),r=u.create();return function(n){return(0!==this.scale[0]||0!==this.scale[1]||0!==this.scale[2])&&(i[0]=1/this._scale[0],i[1]=1/this._scale[1],i[2]=1/this._scale[2],this.referenceFrame===c.RELATIVE_RF?(u.fromTranslation(r,a.neg(e,this._position)),u.mul(n,r,n),s.zeroRotation(this._rotation)||(u.fromQuat(r,s.invert(t,this._rotation)),u.mul(n,r,n)),u.fromScaling(r,i),u.mul(n,r,n),u.fromTranslation(r,this._pivotPoint),u.mul(n,r,n)):(u.fromQuat(this._matrix,s.invert(t,this._rotation)),u.translate(n,n,a.neg(e,this._position)),u.fromScaling(r,i),u.mul(n,r,n),u.fromTranslation(r,this._pivotPoint),u.mul(n,r,n)),!0)}}(),computeBound:function(){var e=u.create();return function(t){return this._autoScaleToScreen&&this._firstTimeToInitEyePoint?t:(h.prototype.computeBound.call(this,t),t.valid()?(u.identity(e),this.computeLocalToWorldMatrix(e),t.transformMat4(t,e),t):t)}}(),accept:function(){return function(e){if(e.getVisitorType()===l.CULL_VISITOR){var t=e.getViewport().width(),i=e.getViewport().height(),r=e.getCurrentProjectionMatrix(),n=e.getCurrentModelViewMatrix(),c=this._position,d=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(t!==this._previousWidth||i!==this._previousHeight?d=!0:u.exactEquals(r,this._previousProjection)&&u.exactEquals(n,this._previousModelView)?a.exactEquals(c,this._previousPosition)||(d=!0):d=!0),this._firstTimeToInitEyePoint=!1,d){if(this._autoScaleToScreen){var p=e.getViewport(),f=this.computePixelSizeVector(p,r,n),g=o.fromValues(this._position[0],this._position[1],this._position[2],1),m=o.dot(g,f);m=.48/m;var v=1/m;if(this._autoScaleTransitionWidthRatio>0){var _,b,x;if(this._minimumScale>0){var S=this._minimumScale,y=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);_=1/(4*(y-S)),b=1-2*_*y,x=S+b*b/(4*_);v<-b/(2*_)?v=this._minimumScale:v<y&&(v=x+b*v+_*(v*v))}if(this._maximumScale<Number.MAX_VALUE){var C=this._maximumScale,T=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);_=1/(4*(T-C)),b=1-2*_*T,x=C+b*b/(4*_);v>-b/(2*_)?v=this._maximumScale:v>T&&(v=x+b*v+_*(v*v))}}this.setScale(v)}if(this._autoRotateToScreen){var M=s.create();u.getRotation(M,n),this.setRotation(s.invert(M,M))}this._previousWidth=t,this._previousHeight=i,a.copy(this._previousPosition,c),u.copy(this._previousProjection,r),u.copy(this._previousModelView,n)}}h.prototype.accept.call(this,e)}}(),computePixelSizeVector:function(){var e=a.create(),t=a.create();return function(i,r,n){var s=r[0]*i.width()*.5,u=r[8]*i.width()*.5+r[11]*i.width()*.5;a.set(e,n[0]*s+n[2]*u,n[4]*s+n[6]*u,n[8]*s+n[10]*u);var l=r[5]*i.height()*.5,c=r[9]*i.height()*.5+r[11]*i.height()*.5;a.set(t,n[1]*l+n[2]*c,n[5]*l+n[6]*c,n[9]*l+n[10]*c);var h=r[11],d=r[15],p=o.fromValues(n[2]*h,n[6]*h,n[10]*h,n[14]*h+n[15]*d),f=.7071067811/Math.sqrt(a.sqrLen(e)+a.sqrLen(t));return o.scale(p,p,f),p}}()}),"osg","AutoTransform"),e.exports=d},function(e,t,i){"use strict";var r=i(14),n=i(68),a=function(e){n.call(this),this.setMode(void 0!==e?e:a.BACK)};a.DISABLE=0,a.FRONT=1028,a.BACK=1029,a.FRONT_AND_BACK=1032,r.createPrototypeStateAttribute(a,r.objectInherit(n.prototype,{attributeType:"CullFace",cloneType:function(){return new a},setMode:function(e){var t=e;"string"==typeof t&&(t=a[t]),this._mode=t},getMode:function(){return this._mode},apply:function(e){var t=e.getGraphicContext();this._mode===a.DISABLE?t.disable(t.CULL_FACE):(t.enable(t.CULL_FACE),t.cullFace(this._mode))}}),"osg","CullFace"),e.exports=a},function(e,t,i){"use strict";var r=i(14),n=i(135),a=i(146),o=i(8).vec3,s=function(){n.call(this),this.setCullingActive(!1),this._light=void 0,this._referenceFrame=a.RELATIVE_RF};r.createPrototypeNode(s,r.objectInherit(n.prototype,{getLight:function(){return this._light},setLight:function(e){this._light=e},setReferenceFrame:function(e){this._referenceFrame=e},getReferenceFrame:function(){return this._referenceFrame},computeBoundingSphere:function(){var e=o.create();return function(t){if(n.prototype.computeBoundingSphere.call(this,t),void 0!==this._light&&this._referenceFrame===a.RELATIVE_RF){var i=this._light.getPosition();0!==i[3]&&t.expandByvec3(o.scale(e,i,1/i[3]))}return t}}()}),"osg","LightSource"),e.exports=s},function(e,t,i){"use strict";var r=i(14),n=i(135),a=i(67),o=i(8).mat4,s=i(8).vec2,u=i(8).vec3,l=i(421),c=function(){n.call(this),this._radius=-1,this._range=[],this._rangeMode=c.DISTANCE_FROM_EYE_POINT,this._userDefinedCenter=[],this._centerMode=c.USE_BOUNDING_SPHERE_CENTER};c.DISTANCE_FROM_EYE_POINT=0,c.PIXEL_SIZE_ON_SCREEN=1,c.USE_BOUNDING_SPHERE_CENTER=0,c.USER_DEFINED_CENTER=1,c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED=2,r.createPrototypeNode(c,r.objectInherit(n.prototype,{getRadius:function(){return this._radius},setRadius:function(e){this._radius=e},setCenter:function(e){this._centerMode!==c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&(this._centerMode=c.USER_DEFINED_CENTER),this._userDefinedCenter=e},getCenter:function(){return this._centerMode===c.USER_DEFINED_CENTER||this._centerMode===c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED?this._userDefinedCenter:this.getBound().center()},setCenterMode:function(e){this._centerMode=e},computeBoundingSphere:function(e){if(this._centerMode===c.USER_DEFINED_CENTER&&this._radius>=0)return e.set(this._userDefinedCenter,this._radius),e;if(this._centerMode===c.UNION_OF_BOUNDING_SPHERE_AND_USER_DEFINED&&this._radius>=0){e.set(this._userDefinedCenter,this._radius);var t=new l;return e.expandByBoundingSphere(n.prototype.computeBoundingSphere.call(this,t)),e}return n.prototype.computeBoundingSphere.call(this,e),e},projectBoundingSphere:function(){var e=u.create();return function(t,i,r){u.transformMat4(e,t.center(),i);var n=t.radius2(),a=e[2]*e[2],o=u.sqrLen(e);return-Math.PI*r*r*n*Math.sqrt(Math.abs((o-n)/(n-a)))/(n-a)}}(),setRangeMode:function(e){this._rangeMode=e},addChildNode:function(e){if(n.prototype.addChild.call(this,e),this.children.length>this._range.length){var t=[],i=0;this._range.lenght>0&&(i=this._range[this._range.length-1][1]),t.push(s.fromValues(i,i)),this._range.push(t)}return!0},addChild:function(e,t,i){if(n.prototype.addChild.call(this,e),this.children.length>this._range.length){var r=[];r.push(s.fromValues(t,t)),this._range.push(r)}return this._range[this.children.length-1][0]=t,this._range[this.children.length-1][1]=i,!0},traverse:function(){var e=u.create(),t=u.create(),i=o.create();return function(r){switch(r.traversalMode){case a.TRAVERSE_ALL_CHILDREN:for(var n=0;n<this.children.length;n++)this.children[n].accept(r);break;case a.TRAVERSE_ACTIVE_CHILDREN:var s=0,l=r.getCurrentModelViewMatrix();if(o.invert(i,l),this._rangeMode===c.DISTANCE_FROM_EYE_POINT)u.transformMat4(t,e,i),s=u.distance(this.getBound().center(),t)*r.getLODScale();else{var h=r.getCurrentProjectionMatrix();s=this.projectBoundingSphere(this.getBound(),l,h[0]),s=s*r.getViewport().width()*r.getViewport().width()*.25/r.getLODScale()}var d=this.children.length;this._range.length<d&&(d=this._range.length);for(var p=0;p<d;++p)this._range[p][0]<=s&&s<this._range[p][1]&&this.children[p].accept(r)}}}()}),"osg","Lod"),e.exports=c},function(e,t,i){"use strict";var r=i(14),n=i(68),a=i(8).vec4,o=i(88),s=function(){n.call(this),this._ambient=a.fromValues(.2,.2,.2,1),this._diffuse=a.fromValues(.8,.8,.8,1),this._specular=a.fromValues(0,0,0,1),this._emission=a.fromValues(0,0,0,1),this._shininess=12.5};r.createPrototypeStateAttribute(s,r.objectInherit(n.prototype,{attributeType:"Material",cloneType:function(){return new s},getParameterName:function(e){return"u"+this.getType()+"_"+e},getOrCreateUniforms:function(){var e=s;return e.uniforms?e.uniforms:(e.uniforms={ambient:o.createFloat4("uMaterialAmbient"),diffuse:o.createFloat4("uMaterialDiffuse"),specular:o.createFloat4("uMaterialSpecular"),emission:o.createFloat4("uMaterialEmission"),shininess:o.createFloat1("uMaterialShininess")},e.uniforms)},setEmission:function(e){a.copy(this._emission,e)},getEmission:function(){return this._emission},setAmbient:function(e){a.copy(this._ambient,e)},getAmbient:function(){return this._ambient},setSpecular:function(e){a.copy(this._specular,e)},getSpecular:function(){return this._specular},setDiffuse:function(e){a.copy(this._diffuse,e)},getDiffuse:function(){return this._diffuse},setShininess:function(e){this._shininess=e},getShininess:function(){return this._shininess},setTransparency:function(e){this._diffuse[3]=1-e},getTransparency:function(){return this._diffuse[3]},apply:function(){var e=this.getOrCreateUniforms();e.ambient.setFloat4(this._ambient),e.diffuse.setFloat4(this._diffuse),e.specular.setFloat4(this._specular),e.emission.setFloat4(this._emission),e.shininess.setFloat(this._shininess)}}),"osg","Material"),e.exports=s},function(e,t,i){"use strict";var r,n=i(30),a=i(14),o={antialias:!0,fullscreen:!0,enableFrustumCulling:!1,stats:!1,scrollwheel:!0,webgl2:!1},s=function(){for(var e in o)this[e]=o[e]};s.getOptionsURL=function(){if(r)return r;if(r={},!window.location.search)return r;for(var e,t=[],i=window.location.search.slice(1).split("&"),a=0;a<i.length;a++){e=i[a].split("=");var o=e[0];t.push(o);var s=e[1];"0"!==s&&"false"!==s&&(void 0===s&&(s="1"),r[o]=s)}if(void 0!==r.log){switch(r.log.toLowerCase()){case"debug":n.setNotifyLevel(n.DEBUG);break;case"info":n.setNotifyLevel(n.INFO);break;case"notice":n.setNotifyLevel(n.NOTICE);break;case"warn":n.setNotifyLevel(n.WARN);break;case"error":n.setNotifyLevel(n.ERROR);break;case"html":var u=[],l=document.createElement("div"),c=document.createElement("pre");document.addEventListener("DOMContentLoaded",function(){document.body.appendChild(l),l.appendChild(c)});var h=function(e){u.unshift(e),c.innerHTML=u.join("\n")};l.style.overflow="hidden",l.style.position="absolute",l.style.zIndex="10000",l.style.height="100%",l.style.maxWidth="600px",c.style.overflow="scroll",c.style.width="105%",c.style.height="100%",c.style.fontSize="10px",["log","error","warn","info","debug"].forEach(function(e){window.console[e]=h})}}return r},s.prototype={extend:function(e){return a.objectMix(this,e),this},get:function(e){return this[e]},getBoolean:function(e){var t=this.getString(e);if(t)return"false"!==t&&"0"!==t},getNumber:function(e){var t=this[e];if(t)return Number(t)},getString:function(e){if(void 0!==this[e])return this[e].toString()},extendWithOptionsURL:function(){this.extend(s.getOptionsURL())}},e.exports=s},function(e,t,i){"use strict";var r=i(14),n=i(565),a=i(67),o=i(8).mat4,s=i(8).vec3,u=function(){n.call(this),this._perRangeDataList=[],this._loading=!1,this._expiryTime=0,this._expiryFrame=0,this._centerMode=n.USER_DEFINED_CENTER,this._frameNumberOfLastTraversal=0,this._databasePath="",this._numChildrenThatCannotBeExpired=0},l=function(){this.filename="",this.function=void 0,this.loaded=!1,this.timeStamp=0,this.frameNumber=0,this.frameNumberOfLastTraversal=0,this.dbrequest=void 0};r.createPrototypeNode(u,r.objectInherit(n.prototype,{setRange:function(e,t,i){if(e>=this._range.length){var r=[];r.push([t,t]),this._range.push(r)}this._range[e][0]=t,this._range[e][1]=i},setExpiryTime:function(e){this._expiryTime=e},setDatabasePath:function(e){this._databasePath=e},getDatabasePath:function(){return this._databasePath},setFileName:function(e,t){if(e>=this._perRangeDataList.length){var i=new l;i.filename=t,this._perRangeDataList.push(i)}else this._perRangeDataList[e].filename=t},setFunction:function(e,t){if(e>=this._perRangeDataList.length){var i=new l;i.function=t,this._perRangeDataList.push(i)}else this._perRangeDataList[e].function=t},addChild:function(e,t,i){n.prototype.addChild.call(this,e,t,i),this._perRangeDataList.push(new l)},addChildNode:function(e){n.prototype.addChildNode.call(this,e)},setFrameNumberOfLastTraversal:function(e){this._frameNumberOfLastTraversal=e},getFrameNumberOfLastTraversal:function(){return this._frameNumberOfLastTraversal},setTimeStamp:function(e,t){this._perRangeDataList[e].timeStamp=t},setFrameNumber:function(e,t){this._perRangeDataList[e].frameNumber=t},setNumChildrenThatCannotBeExpired:function(e){this._numChildrenThatCannotBeExpired=e},getNumChildrenThatCannotBeExpired:function(){return this._numChildrenThatCannotBeExpired},getDatabaseRequest:function(e){return this._perRangeDataList[e].dbrequest},removeExpiredChildren:function(e,t,i){if(!(this.children.length<=this._numChildrenThatCannotBeExpired)){var r,n,a=this.children.length-1;r=this._perRangeDataList[a].timeStamp+this._expiryTime,n=this._perRangeDataList[a].frameNumber+this._expiryFrame,r<e&&n<t&&(this._perRangeDataList[a].filename.length>0||void 0!==this._perRangeDataList[a].function)&&(i.push(this.children[a]),this.removeChild(this.children[a]),this._perRangeDataList[a].loaded=!1,void 0!==this._perRangeDataList[a].dbrequest&&(this._perRangeDataList[a].dbrequest._groupExpired=!0))}},traverse:function(){var e=s.create(),t=s.create(),i=o.create();return function(r){var u=r.traversalMode,l=!1;switch(r.getVisitorType()===a.CULL_VISITOR&&(this._frameNumberOfLastTraversal=r.getFrameStamp().getFrameNumber(),l=!0),u){case a.TRAVERSE_ALL_CHILDREN:for(var c=0;c<this.children.length;c++)this.children[c].accept(r);break;case a.TRAVERSE_ACTIVE_CHILDREN:var h=0,d=r.getCurrentModelViewMatrix();if(o.invert(i,d),this._rangeMode===n.DISTANCE_FROM_EYE_POINT){s.transformMat4(t,e,i);h=s.distance(this.getBound().center(),t)*r.getLODScale()}else{var p=r.getCurrentProjectionMatrix();h=this.projectBoundingSphere(this.getBound(),d,p[0]),h=h*r.getViewport().width()*r.getViewport().width()*.25/r.getLODScale(),h<0&&(h=this._range[this._range.length-1][0])}for(var f=!1,g=-1,m=0;m<this._range.length;++m)this._range[m][0]<=h&&h<this._range[m][1]&&(m<this.children.length?(l&&(this._perRangeDataList[m].timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[m].frameNumber=r.getFrameStamp().getFrameNumber()),this.children[m].accept(r),g=m):f=!0);if(f){var v=this.children.length;if(v>0&&v-1!==g&&(l&&(this._perRangeDataList[v-1].timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[v-1].frameNumber=r.getFrameStamp().getFrameNumber()),this.children[v-1].accept(r)),v<this._perRangeDataList.length){var _=(this._range[v][0]-h)/(this._range[v][1]-this._range[v][0]);this._rangeMode===n.PIXEL_SIZE_ON_SCREEN&&(_=-_);var b=r.nodePath[r.nodePath.length-1];if(!1===this._perRangeDataList[v].loaded){this._perRangeDataList[v].loaded=!0;var x=r.getDatabaseRequestHandler();this._perRangeDataList[v].dbrequest=x.requestNodeFile(this._perRangeDataList[v].function,this._databasePath+this._perRangeDataList[v].filename,b,r.getFrameStamp().getSimulationTime(),_)}else void 0!==this._perRangeDataList[v].dbrequest?(this._perRangeDataList[v].dbrequest._timeStamp=r.getFrameStamp().getSimulationTime(),this._perRangeDataList[v].dbrequest._priority=_):this._perRangeDataList[v].loaded=!1}}}}}()}),"osg","PagedLOD"),e.exports=u},function(e,t,i){"use strict";var r=i(91),n=i(424),a=i(14),o=i(8).vec4,s=function(){this._clippingMask=0,this._planeList=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()],this._vertexList=[],this._maskStack=[],this._resultMask=0,this._maskStack.push(this._resultMask)};a.createPrototypeObject(s,a.objectInherit(r.prototype,{getPlanes:function(){return this._planeList},setPlanes:function(e){this._planeList=e,this.setupMask()},clear:function(){if(this._clippingMask=0,this._planeList)for(var e=0,t=this._planeList.length;e<t;++e)n.init(this._planeList[e]);this._vertexList=[],this.setupMask()},setToUnitFrustum:function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._planeList.length=0,this._planeList.push(o.set(n.create(),1,0,0,1)),this._planeList.push(o.set(n.create(),-1,0,0,1)),this._planeList.push(o.set(n.create(),0,1,0,1)),this._planeList.push(o.set(n.create(),0,-1,0,1)),e&&this._planeList.push(o.set(n.create(),0,0,1,1)),t&&this._planeList.push(o.set(n.create(),0,0,-1,1)),this.setupMask()},setToBoundingBox:function(e){this._planeList.length=0,this._planeList.push(o.set(n.create(),1,0,0,-e.getMin()[0])),this._planeList.push(o.set(n.create(),-1,0,0,e.getMax()[0])),this._planeList.push(o.set(n.create(),0,1,0,-e.getMin()[1])),this._planeList.push(o.set(n.create(),0,-1,0,e.getMax()[1])),this._planeList.push(o.set(n.create(),0,0,1,-e.getMin()[2])),this._planeList.push(o.set(n.create(),0,0,-1,e.getMax()[2])),this.setupMask()},setAndTransformProvidingInverse:function(e,t){this._referenceVertexList=e._referenceVertexList;var i=e._maskStack[this._maskStack.length-1];if(0===i)return this._maskStack[this._maskStack.length-1]=0,this._resultMask=0,void(this._planeList.length=0);var r,a=1,o=0;for(r=0;r!==e._planeList.length;++r)i&a&&++o,a<<=1;this._planeList.length=o,this._resultMask=0,a=1;var s=0;for(r=0;r!==e._planeList.length;++r)i&a&&(this._planeList[s]=e._planeList[r],n.transformProvidingInverse(this._planeList[s++],t),this._resultMask=this._resultMask<<1|1),a<<=1;this._maskStack[this._maskStack.length-1]=this._resultMask},voidset:function(e){this._planeList=e,this.setupMask()},add:function(e){this._planeList.push(e),this.setupMask()},empty:function(){return 0===this._planeList.length},setReferenceVertexList:function(e){this._referenceVertexList=e},getReferenceVertexList:function(){return this._referenceVertexList},setupMask:function(e){this._resultMask=0;for(var t=void 0!==e?e:this._planeList.length,i=0;i<t;++i)this._resultMask=this._resultMask<<1|1;this._maskStack=[],this._maskStack.push(this._resultMask)},getCurrentMask:function(){return this._maskStack[this._maskStack.length-1]},setResultMask:function(e){this._resultMask=e},getResultMask:function(){return this._resultMask},getMaskStack:function(){return this._maskStack},pushCurrentMask:function(){this._maskStack.push(this._resultMask)},popCurrentMask:function(){return this._maskStack.pop()},containsVertex:function(e){if(!this._maskStack[this._maskStack.length-1])return!0;for(var t=1,i=0;i<this._planeList.length;++i){if(this._maskStack[this._maskStack.length-1]&t&&n.distanceToPlane(this._planeList[i],e)<0)return!1;t<<=1}return!0},containsVertices:function(e){if(!this._maskStack[this._maskStack.length-1])return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var t=0;t<e.length;++t){for(var i=e[t],r=!1,a=1,o=0;!r&&o<this._planeList.length;++o)this._maskStack[this._maskStack.length-1]&a&&n.distanceToPlane(this._planeList[o],i)<0&&(r=!0),a<<=1;if(!r)return!0}return!1},containsBoundingSphere:function(e){if(!this._maskStack[this._maskStack.length-1]||!e.valid())return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var t=1,i=0;i<this._planeList.length;++i){if(this._resultMask&t){var r=n.intersectsOrContainsBoundingSphere(this._planeList[i],e);if(n.OUTSIDE===r)return!1;n.INSIDE===r&&(this._resultMask^=t)}t<<=1}return!0},containsBoundingBox:function(e){if(!this._maskStack[this._maskStack.length-1])return!0;this._resultMask=this._maskStack[this._maskStack.length-1];for(var t=1,i=0;i<this._planeList.length;++i){if(this._resultMask&t){var r=n.intersectsOrContainsBoundingBox(this._planeList[i],e);if(n.OUTSIDE===r)return!1;n.INSIDE===r&&(this._resultMask^=t)}t<<=1}return!0},containsAllOfVertices:function(e){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var t=1,i=0;i<this._planeList.length;++i){if(this._resultMask&t){if(n.intersectsOrContainsVertices(this._planeList[i],e)<1)return!1;this._resultMask^=t}t<<=1}return!0},containsAllOfBoundingSphere:function(e){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var t=1,i=0;i<this._planeList.length;++i){if(this._resultMask&t){if(n.intersectsOrContainsBoundingSphere(this._planeList[i],e)<1)return!1;this._resultMask^=t}t<<=1}return!0},containsAllOfBoundingBox:function(e){if(!this._maskStack[this._maskStack.length-1])return!1;this._resultMask=this._maskStack[this._maskStack.length-1];for(var t=1,i=0;i<this._planeList.length;++i){if(this._resultMask&t){if(n.intersectsOrContainsBoundingBox(this._planeList[i],e)<1)return!1;this._resultMask^=t}t<<=1}return!0},transformProvidingInverse:function(e){if(this._maskStack[this._maskStack.length-1]){this._resultMask=this._maskStack[this._maskStack.length-1];for(var t=1,i=0;i<this._planeList.length;++i)this._resultMask&t&&n.transformProvidingInverse(this._planeList[i],e),t<<=1}}}),"osg","Polytope"),e.exports=s},function(e,t,i){"use strict";var r=i(14),n=i(135),a=i(8).mat4,o=function(){n.call(this),this.projection=a.create()};r.createPrototypeNode(o,r.objectInherit(n.prototype,{getProjectionMatrix:function(){return this.projection},setProjectionMatrix:function(e){this.projection=e}}),"osg","Projection"),e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(274),a=i(383),o=i(30),s=i(497),u=i(8).vec4,l=function(){s.call(this),this.clearColor=u.create(),this.preRenderList=[],this.postRenderList=[],l.prototype.init.call(this)};r.createPrototypeObject(l,r.objectInherit(s.prototype,{init:function(){return s.prototype.init.call(this),this.positionedAttribute.length=0,this.clearDepth=1,u.set(this.clearColor,0,0,0,1),this.clearMask=n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT,this.camera=void 0,this.viewport=void 0,this.preRenderList.length=0,this.postRenderList.length=0,this._renderStage=this,this},reset:function(){s.prototype.reset.call(this),this.preRenderList.length=0,this.postRenderList.length=0},setClearDepth:function(e){this.clearDepth=e},getClearDepth:function(){return this.clearDepth},setClearColor:function(e){u.copy(this.clearColor,e)},getClearColor:function(){return this.clearColor},setClearMask:function(e){this.clearMask=e},getClearMask:function(){return this.clearMask},setViewport:function(e){this.viewport=e},getViewport:function(){return this.viewport},setCamera:function(e){this.camera=e},getCamera:function(){return this.camera},getPositionedAttribute:function(){return this.positionedAttribute},getPreRenderStageList:function(){return this.preRenderList},getPostRenderStageList:function(){return this.postRenderList},addPreRenderStage:function(e,t){for(var i=0,r=this.preRenderList.length;i<r;i++){if(t<this.preRenderList[i].order)break}i<this.preRenderList.length?this.preRenderList=this.preRenderList.splice(i,0,{order:t,renderStage:e}):this.preRenderList.push({order:t,renderStage:e})},addPostRenderStage:function(e,t){for(var i=0,r=this.postRenderList.length;i<r;i++){if(t<this.postRenderList[i].order)break}i<this.postRenderList.length?this.postRenderList=this.postRenderList.splice(i,0,{order:t,renderStage:e}):this.postRenderList.push({order:t,renderStage:e})},drawPreRenderStages:function(e,t){for(var i=t,r=0,n=this.preRenderList.length;r<n;++r){i=this.preRenderList[r].renderStage.draw(e,i)}return i},draw:function(e,t){this.camera&&this.camera.getInitialDrawCallback()&&this.camera.getInitialDrawCallback()(e);var i=this.drawPreRenderStages(e,t);return i=this.drawImplementation(e,i),i=this.drawPostRenderStages(e,i),this.camera&&this.camera.getFinalDrawCallback()&&this.camera.getFinalDrawCallback()(e),i},sort:function(){for(var e=0,t=this.preRenderList.length;e<t;++e)this.preRenderList[e].renderStage.sort();s.prototype.sort.call(this);for(var i=0,r=this.postRenderList.length;i<r;++i)this.postRenderList[i].renderStage.sort()},drawPostRenderStages:function(e,t){for(var i=t,r=0,n=this.postRenderList.length;r<n;++r){i=this.postRenderList[r].renderStage.draw(e,i)}return i},applyCamera:function(e){var t=e.getGraphicContext();if(void 0===this.camera)return void t.bindFramebuffer(t.FRAMEBUFFER,null);var i=this.camera.getViewport(),r=this.camera.frameBufferObject;if(r||(r=new a,this.camera.frameBufferObject=r),r.isDirty()){var n,o,s=this.camera.getAttachments(),u=s[a.COLOR_ATTACHMENT0];u&&u.texture&&(n=u.texture.getWidth(),o=u.texture.getHeight());for(var l in s){u=s[l];var c={};c.attachment=u.attachment,void 0===u.texture?(c.format=u.format,c.width=void 0!==n?n:i.width(),c.height=void 0!==o?o:i.height()):(c.texture=u.texture,c.textureTarget=u.textureTarget,u.format&&(c.format=u.format)),r.setAttachment(c)}}r.apply(e)},drawImplementation:function(e,t){var i=e.getGraphicContext();if(this.applyCamera(e),void 0===this.viewport&&o.log("RenderStage does not have a valid viewport"),e.applyAttribute(this.viewport),this.camera){var r=this.camera.getStateSet()&&this.camera.getStateSet().getAttribute("Scissor");r&&e.applyAttribute(r)}return 0!==this.clearMask&&(this.clearMask&i.COLOR_BUFFER_BIT&&i.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),this.clearMask&i.DEPTH_BUFFER_BIT&&(i.depthMask(!0),i.clearDepth(this.clearDepth)),i.clear(this.clearMask)),0!==this.positionedAttribute.length&&this.applyPositionedAttribute(e,this.positionedAttribute),s.prototype.drawImplementation.call(this,e,t)}}),"osg","RenderStage"),e.exports=l},function(e,t,i){"use strict";var r=i(14),n=i(91),a=i(8).mat4,o=i(8).vec3,s=i(364),u=function(e,t){n.call(this),this._target=s.createVec3Target(t||o.ONE),e&&this.setName(e)};r.createPrototypeObject(u,r.objectInherit(n.prototype,{init:function(e){this.setScale(e),o.copy(this._target.defaultValue,e)},setScale:function(e){o.copy(this._target.value,e)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setScale(this._target.defaultValue)},applyToMatrix:function(e){var t=this._target.value;a.scale(e,e,t)}}),"osgAnimation","StackedScale"),e.exports=u},function(e,t,i){"use strict";var r=i(14),n=i(30),a=i(499),o=i(8).mat4,s=i(67),u=function(){a.call(this)};r.createPrototypeObject(u,r.objectInherit(a.prototype,{update:function(e,t){if(t.getVisitorType()===s.UPDATE_VISITOR){if(e.className&&"Bone"!==e.className())return n.warn("Warning: UpdateBone set on non-Bone object."),!1;var i=e;a.prototype.update.call(this,e),i.setMatrix(i.getMatrix());var r=i.getMatrix(),u=i.getBoneParent();u?o.mul(i.getMatrixInSkeletonSpace(),u.getMatrixInSkeletonSpace(),r):i.setMatrixInSkeletonSpace(r)}return!0}}),"osgAnimation","UpdateBone"),e.exports=u},function(e,t,i){"use strict";var r=i(14),n=i(164),a=i(428),o=i(456),s=i(364),u=i(385),l=function(){o.call(this),this._targets=[],this._targetNames=[],this._morphs=[],this._weights=new Float32Array(u.MAX_MORPH_GPU),this._indexMap=new Uint32Array(u.MAX_MORPH_GPU),this._gpuMorphed=[],this._maxMorphGPU=-1},c=u.EFFECTIVE_EPS,h=function(e,t){return Math.abs(t.value)-Math.abs(e.value)};r.createPrototypeObject(l,r.objectInherit(o.prototype,{init:function(e){this._maxMorphGPU=u.MAX_MORPH_GPU,this._morphs.length=0;for(var t=e.getChildren(),i=0,r=t.length;i<r;i++){var n,o=t[i];o instanceof u?n=o:o instanceof a&&o.getSourceGeometry()instanceof u&&(n=o.getSourceGeometry()),n&&(n.getName()===this.getName()&&(n.isInitialized()||n.init(),this._morphs.push(n),this._maxMorphGPU=Math.min(this._maxMorphGPU,n.getMaximumPossibleMorphGPU())))}},isInitialized:function(){var e=this._morphs,t=e.length;if(!t)return!1;for(var i=0;i<t;++i)if(!e[i].isInitialized())return!1;return!0},getNumTarget:function(){return this._targets.length},getTarget:function(e){return this._targets[e]},getTargetName:function(e){return this._targetNames[e]},addTarget:function(e,t){this._targets[t]=s.createFloatTarget(0),this._targetNames[t]=e},_remapBufferArrays:function(){for(var e=this._indexMap,t=this._morphs,i=0;i<this._maxMorphGPU;++i)for(var r=e[i],n="_"+i,a="_"+r,o=0,s=t.length;o<s;++o)for(var u=t[o],l=u.getVertexAttributeList(),c=u.getMorphTargetNames(),h=0,d=c.length;h<d;++h){var p=c[h];l[p+n].setBufferArray(l[p+a].getInitialBufferArray())}},_mergeExtraMorphTarget:function(e,t,i){var r=0,a=this._gpuMorphed,o=e[t],s=o.getElements().length,u=s/o.getItemSize(),l=o.getItemSize();o._cpuMorph=o._cpuMorph||new n(n.ARRAY_BUFFER,new Float32Array(s),l);var h=o._cpuMorph.getElements();for(r=0;r<s;++r)h[r]=0;for(var d=this._targets,p=0,f=d.length;p<f;++p)if(!0!==a[p]){var g=d[p].value;if(!(Math.abs(g)<c)){g/=i;var m=e[t+"_"+p].getInitialBufferArray().getElements();for(r=0;r<u;++r){var v=r*l;h[v]+=g*m[v],h[v+1]+=g*m[v+1],h[v+2]+=g*m[v+2]}}}e[t+"_"+(this._maxMorphGPU-1)].setBufferArray(o._cpuMorph),o._cpuMorph.dirty()},_computeExtraWeightsSum:function(){for(var e=this._gpuMorphed,t=0,i=this._targets,r=0,n=i.length;r<n;++r)if(!0!==e[r]){var a=i[r].value;Math.abs(a)<c||(t+=a)}return Math.abs(t)>1e-5?t:t<0?-1e-5:1e-5},_morphBufferArrayCPU:function(){for(var e=this._weights[this._maxMorphGPU-1]=this._computeExtraWeightsSum(),t={},i=this._morphs,r=0,n=i.length;r<n;++r)for(var a=i[r],o=a.getVertexAttributeList(),s=a.getMorphTargetNames(),u=0,l=s.length;u<l;++u){var c=s[u],h=o[c];h&&!t[h.getInstanceID()]&&(t[h.getInstanceID()]=!0,this._mergeExtraMorphTarget(o,c,e))}},updateWeights:function(){if(0!==this._maxMorphGPU){var e=0,t=this._targets,i=t.length,r=this._weights;if(r[0]=r[1]=r[2]=r[3]=0,i<=this._maxMorphGPU)for(e=0;e<i;++e)r[e]=t[e].value;else{var n=this._indexMap;n[0]=n[1]=n[2]=n[3]=0;var a=this._gpuMorphed;for(a.length=i,e=0;e<i;++e)a[e]=!1;var o=t.slice(0).sort(h);for(e=0;e<this._maxMorphGPU;++e){var s=t.indexOf(o[e]);a[s]=!0,n[e]=s,r[e]=o[e].value}var u=Math.abs(o[this._maxMorphGPU].value)>=c;a[n[this._maxMorphGPU-1]]=!u,this._remapBufferArrays(),u&&this._morphBufferArrayCPU()}}},update:function(e){this.isInitialized()||this.init(e),this.updateWeights();for(var t=this._weights,i=Math.min(this._maxMorphGPU,this._targets.length),r=this._morphs,n=0,a=r.length;n<a;++n)for(var o=r[n].getTargetsWeight(),s=0;s<i;s++)o[s]=t[s];return!0}}),"osgAnimation","UpdateMorph"),e.exports=l},function(e,t,i){"use strict";var r=i(10),n=i(386),a=i(457),o=i(430),s=i(30),u={readFileList:function(e){var t,i,s=new window.Map,l=[];for(i=0;i<e.length;++i){var c=e[i].name.substr(e[i].name.lastIndexOf(".")+1);void 0===a.instance().getReaderWriterForExtension(c)&&"osgjs"!==c||(t=e[i].name);var h=u.getTypeForExtension(c);l.push(o(e[i],{responseType:h}))}return r.all(l).then(function(r){for(i=0;i<r.length;++i)s.set(e[i].name,r[i]);return n.readNodeURL(t,{filesMap:s})})},init:function(){u._typesMap=new window.Map,u._typesMap.set("bin","arraybuffer"),u._typesMap.set("b3dm","arraybuffer"),u._typesMap.set("glb","arraybuffer"),u._typesMap.set("zip","arraybuffer"),u._typesMap.set("png","blob"),u._typesMap.set("jpg","blob"),u._typesMap.set("jpeg","blob"),u._typesMap.set("gif","blob"),u._typesMap.set("json","string"),u._typesMap.set("gltf","string"),u._typesMap.set("osgjs","string")},addTypeForExtension:function(e,t){u._typesMap||u.init(),void 0!==u._typesMap.get(t)&&s.warn("the '"+t+"' already has a type"),u._typesMap.set(t,e)},getTypeForExtension:function(e){return u._typesMap||u.init(),this._typesMap.get(e)}};e.exports=u},function(e,t,i){"use strict";var r=i(10),n=i(14),a=i(689),o=i(430),s=i(905),u=i(560),l=i(30),c=i(452),h=i(164),d=i(291),p=i(652),f=i(292),g=i(136),m=function(e,t){this._json=e;var i=t;void 0===i&&(i={}),this._identifierMap=i,this._objectRegistry={},this._cacheReadObject={},this.setOptions(n.objectMix({},s))};m.imageFallback||(m.imageFallback=function(){var e=new window.Image;return e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=",e}()),m.prototype={clone:function(){var e=new m;return e._objectRegistry=this._objectRegistry,e._cacheReadObject=this._cacheReadObject,e},setOptions:function(e){this._defaultOptions=e},getOptions:function(){return this._defaultOptions},setProgressXHRCallback:function(e){this._defaultOptions.progressXHRCallback=e},setReadNodeURLCallback:function(e){this._defaultOptions.readNodeURL=e},registerObject:function(e,t){this._objectRegistry[e]=t},getJSON:function(){return this._json},setJSON:function(e){return this._json=e,this},setPrefixURL:function(e){this._defaultOptions.prefixURL=e},getPrefixURL:function(){return this._defaultOptions.prefixURL},setDatabasePath:function(e){this._defaultOptions.databasePath=e},getDatabasePath:function(){return this._defaultOptions.databasePath},computeURL:function(e){return"string"==typeof this._defaultOptions.prefixURL&&this._defaultOptions.prefixURL.length>0?this._defaultOptions.prefixURL+e:e},requestFile:function(e,t){return o(e,t)},getObjectWrapper:function(e){if(this._objectRegistry[e])return new this._objectRegistry[e];for(var t=a,i=e.split("."),r=0,n=i.length;r<n;r++){var o=t[i[r]];if(void 0===o)return;t=o}return this._objectRegistry[e]=t,new t},fetchImage:function(e,t,i,r){var n="data:image/"===t.substring(0,"data:image/".length),a=new window.Image;return a.onerror=function(){l.warn("warning use white texture as fallback instead of "+t),e.setImage(m.imageFallback),r&&r.resolve(e)},!n&&i.imageCrossOrigin&&(a.crossOrigin=i.imageCrossOrigin),a.onload=function(){r?(i.imageOnload&&i.imageOnload.call(e),r.resolve(e)):i.imageOnload&&i.imageOnload.call(e)},e.setURL(t),e.setImage(a),a.src=t,e},readImageURL:function(e,t){if(void 0===t&&(t=this._defaultOptions),t.readImageURL)return t.readImageURL.call(this,e,t);"data:image"!==e.substr(0,10)&&(e=this.computeURL(e));var i=new c;if(!0!==t.imageLoadingUsePromise)return this.fetchImage(i,e,t);var n=r.defer();return this.fetchImage(i,e,t,n),n.promise},readNodeURL:function(e,t){var a=t;if(void 0===a&&(a=this._defaultOptions),a.readNodeURL)return a.readNodeURL.call(this,e,a);e=this.computeURL(e);var o=r.defer();if(a=n.objectMix({},a),!a.prefixURL){var s=this.getPrefixURL(),c=e.lastIndexOf("/");-1!==c&&(s=e.substring(0,c+1)),a.prefixURL=s}var h=this,d=i(386),p=function(t){d.parseSceneGraph(t,a).then(function(t){o.resolve(t),l.log("loaded "+e)}).catch(o.reject.bind(o))},f=function(e){function t(e){return e.length<2?"0"+e:e}var i=e;u.isGunzipBuffer(e)&&(i=u.gunzip(e));var r=new Uint8Array(i);return function(e){for(var i="",r=0,n=e.length;r<n;++r)i+="%"+t(e[r].toString(16));return i=decodeURIComponent(i)}(r)};return h.requestFile(e).then(function(t){var i;try{i=JSON.parse(t)}catch(t){l.error("cant parse url "+e+" try to gunzip")}return i?p(i):(h.requestFile(e,{responseType:"arraybuffer"}).then(function(e){var t=f(e);i=JSON.parse(t),p(i)}).catch(function(t){l.error("cant read file "+e+" status "+t),o.reject()}).done(),!0)}).catch(function(t){l.error("cant get file "+e+" status "+t),o.reject()}).done(),o.promise},_unzipTypedArray:function(e){var t=new Uint8Array(e);if(31===t[0]&&139===t[1]){var r=i(560);r||l.error("osg failed to use a gunzip.min.js to uncompress a gz file.\n You can add this vendors to enable this feature or adds the good header in your gzip file served by your server");return new r.Gunzip(t).decompress().buffer}return e},readBinaryArrayURL:function(e,t){if(void 0===t&&(t=this._defaultOptions),t.readBinaryArrayURL)return t.readBinaryArrayURL.call(this,e,t);if(e=this.computeURL(e),void 0!==this._identifierMap[e])return this._identifierMap[e];var i=r.defer(),n=this.requestFile(e,{responseType:"arraybuffer",progress:this._defaultOptions.progressXHRCallback});return this._identifierMap[e]=i.promise,n.then(function(e){i.resolve(this._unzipTypedArray(e))}.bind(this)),i.promise},initializeBufferArray:function(e,t,i,a){if(void 0===a&&(a=this.getOptions()),a.initializeBufferArray)return a.initializeBufferArray.call(this,e,t,i);var o=e.File,s=r.defer();return this.readBinaryArrayURL(o).then(function(r){var a,o;!function(){var e=new Uint8Array([18,52]),t=new Uint16Array(e.buffer);o="1234"===t[0].toString(16)}();var u=0;void 0!==e.Offset&&(u=e.Offset);var c=n[t].BYTES_PER_ELEMENT,h=e.Size,d=i.getItemSize(),p=h*c*d;if(o){l.log("big endian detected");var f=n[t],g=new f(h*d),m=new DataView(r,u,p),v=0,_=g.length;if("Uint16Array"===t)for(;v<_;v++)g[v]=m.getUint16(v*c,!0);else if("Float32Array"===t)for(;v<_;v++)g[v]=m.getFloat32(v*c,!0);a=g,m=null}else a=new n[t](r,u,d*h);i.setElements(a),s.resolve(i)}).catch(function(){l.warn("Can't read binary array URL")}),s.promise},readBufferArray:function(e){var t,i=this.getJSON(),a=i.UniqueID;if(void 0!==a&&void 0!==(t=this._identifierMap[a]))return t;if(void 0===e&&(e=this.getOptions()),e.readBufferArray)return e.readBufferArray.call(this);if(!i.Elements&&!i.Array||!i.ItemSize||!i.Type)return r.reject();var o;if(i.Elements)o=r.resolve(new h(h[i.Type],i.Elements,i.ItemSize));else if(i.Array){var s=new h(h[i.Type]);s.setItemSize(i.ItemSize);var u,c;if(i.Array.Float32Array?(u=i.Array.Float32Array,c="Float32Array"):i.Array.Uint16Array?(u=i.Array.Uint16Array,c="Uint16Array"):i.Array.Uint8Array&&(u=i.Array.Uint8Array,c="Uint8Array"),void 0===u)return l.warn("Typed Array "+window.Object.keys(i.Array)[0]),r.reject();u.File?o=this.initializeBufferArray(u,c,s):u.Elements&&(s.setElements(new n[c](u.Elements)),o=r.resolve(s))}return void 0!==a&&(this._identifierMap[a]=o),o},readUserDataContainer:function(){var e,t=this.getJSON(),i=t.UniqueID;return void 0!==i&&void 0!==(e=this._identifierMap[i])?e.Values:(this._identifierMap[i]=t,t.Values)},readPrimitiveSet:function(){var e,t,i,n,a,o,s=this.getJSON(),u=r.defer(),c=s.DrawElementUShort||s.DrawElementUByte||s.DrawElementUInt||s.DrawElementsUShort||s.DrawElementsUByte||s.DrawElementsUInt||void 0;if(c){if(void 0!==(e=c.UniqueID)&&void 0!==(t=this._identifierMap[e]))return t;var h=c.Indices,m=s;n=c.Mode,n=n?g[n]:g.TRIANGLES,i=new f(n),this.setJSON(h),this.readBufferArray().then(function(e){i.setIndices(e),u.resolve(i)}).catch(function(){l.warn("Error buffer array")}),this.setJSON(m)}var v=s.DrawArray||s.DrawArrays;if(v){if(void 0!==(e=v.UniqueID)&&void 0!==(t=this._identifierMap[e]))return t;n=v.Mode||v.mode,a=void 0!==v.First?v.First:v.first,o=void 0!==v.Count?v.Count:v.count;var _=new d(g[n],a,o);u.resolve(_)}var b=s.DrawArrayLengths||void 0;if(b){if(void 0!==(e=b.UniqueID)&&void 0!==(t=this._identifierMap[e]))return t;n=b.Mode,a=b.First;var x=b.ArrayLengths,S=new p(g[n],a,x);u.resolve(S)}return void 0!==e&&(this._identifierMap[e]=u.promise),u.promise},readObject:function(){var e=this.getJSON(),t=window.Object.keys(e)[0];if(!t)return l.warn("can't find property for object "+e),r.reject();var n,a=e[t].UniqueID;if(void 0!==a&&void 0!==(n=this._identifierMap[a]))return n;var o=this.getObjectWrapper(t);if(!o)return l.warn("can't instanciate object "+t),r.reject();var s=i(386),u=s.ObjectWrapper.serializers;if(this._cacheReadObject[t])u=this._cacheReadObject[t];else{for(var c=t.split("."),h=0,d=c.length;h<d;h++){var p=u[c[h]];if(void 0===p)return l.warn("can't find function to read object "+t+" - undefined"),r.reject();u=p}this._cacheReadObject[t]=u}var f=u(this.setJSON(e[t]),o);return void 0!==a&&(this._identifierMap[a]=f,o._uniqueID=a),f}},e.exports=m},function(e,t,i){"use strict";var r=i(8).quat,n=i(8).vec3,a=Math.PI/180,o=function(e,t,i,r,n){var a=Math.cos(t/2),o=Math.cos(i/2),s=Math.cos(r/2),u=Math.sin(t/2),l=Math.sin(i/2),c=Math.sin(r/2);return"XYZ"===n?(e[0]=u*o*s+a*l*c,e[1]=a*l*s-u*o*c,e[2]=a*o*c+u*l*s,e[3]=a*o*s-u*l*c):"YXZ"===n?(e[0]=u*o*s+a*l*c,e[1]=a*l*s-u*o*c,e[2]=a*o*c-u*l*s,e[3]=a*o*s+u*l*c):"ZXY"===n?(e[0]=u*o*s-a*l*c,e[1]=a*l*s+u*o*c,e[2]=a*o*c+u*l*s,e[3]=a*o*s-u*l*c):"ZYX"===n?(e[0]=u*o*s-a*l*c,e[1]=a*l*s+u*o*c,e[2]=a*o*c-u*l*s,e[3]=a*o*s+u*l*c):"YZX"===n?(e[0]=u*o*s+a*l*c,e[1]=a*l*s+u*o*c,e[2]=a*o*c-u*l*s,e[3]=a*o*s-u*l*c):"XZY"===n&&(e[0]=u*o*s-a*l*c,e[1]=a*l*s-u*o*c,e[2]=a*o*c+u*l*s,e[3]=a*o*s+u*l*c),e},s=function(e){this._manipulator=e,this.init()};s.computeQuaternion=function(){var e=r.create(),t=r.fromValues(-Math.sqrt(.5),0,0,Math.sqrt(.5));return function(i,n,s){var u=n.alpha*a,l=n.beta*a,c=n.gamma*a,h=s*a;o(i,l,u,-c,"YXZ");var d=-h/2;e[1]=Math.sin(d),e[3]=Math.cos(d),r.mul(i,i,e),r.mul(i,i,t);var p=i[1];return i[1]=-i[2],i[2]=p,i}}(),s.prototype={init:function(){this._stepFactor=1,this._quat=r.create(),this._pos=n.create()},update:function(e,t){s.computeQuaternion(this._quat,e,t),this._manipulator.setPoseVR(this._quat,this._pos)}},e.exports=s},function(e,t,i){"use strict";var r=i(14),n=i(8).vec3,a=i(8).mat4,o=i(501),s=i(683),u=i(684),l=i(579),c=i(685),h=i(686),d=i(687),p=i(502),f=function(e){o.call(this,e),this._homePosition=n.create(),this._frustum={},this.init()};f.AvailableControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer","DeviceOrientation","WebVR"],f.ControllerList=["StandardMouseKeyboard","LeapMotion","GamePad","Hammer","DeviceOrientation","WebVR"];var g=2*Math.PI,m=function(e,t){return e<t+1e-5};r.createPrototypeObject(f,r.objectInherit(o.prototype,{init:function(){this._distance=25,this._target=n.create(),this._upz=n.fromValues(0,0,1),n.init(this._target);var e=a.fromRotation(a.create(),-Math.PI,this._upz),t=a.fromRotation(a.create(),Math.PI/10,n.fromValues(1,0,0));this._rotation=a.create(),a.mul(this._rotation,e,t),this._time=0,this._vrMatrix=a.create(),this._rotate=new p(2),this._pan=new p(2),this._zoom=new p(1),this._minSpeed=1e-4,this._scaleMouseMotion=1,this._inverseMatrix=a.create(),this._autoPushTarget=!0,this._limitPitchUp=.5*Math.PI*.9,this._limitPitchDown=-this._limitPitchUp,this._limitYawLeft=-Math.PI,this._limitYawRight=-this._limitYawLeft,this._limitZoomIn=1e-4,this._limitZoomOut=1/0;var i=this;f.ControllerList.forEach(function(e){void 0!==f[e]&&(i._controllerList[e]=new f[e](i))})},setLimitPitchUp:function(e){this._limitPitchUp=e},setLimitPitchDown:function(e){this._limitPitchDown=e},setLimitYawLeft:function(e){this._limitYawLeft=e},setLimitYawRight:function(e){this._limitYawRight=e},setLimitZoomOut:function(e){this._limitZoomOut=e},setLimitZoomIn:function(e){this._limitZoomIn=e},setDelay:function(e){this._rotate.setDelay(e),this._pan.setDelay(e),this._zoom.setDelay(e)},reset:function(){this.init()},setTarget:function(e){n.copy(this._target,e);var t=n.create();this.getEyePosition(t),this._distance=n.distance(e,t)},setEyePosition:function(){var e=n.create(),t=n.create(),i=n.create();return function(r){var a=this._rotation,o=this._target;n.sub(e,r,o),n.normalize(e,e),n.cross(t,e,this._upz),n.normalize(t,t),n.cross(i,t,e),n.normalize(i,i),a[0]=t[0],a[1]=e[0],a[2]=i[0],a[3]=0,a[4]=t[1],a[5]=e[1],a[6]=i[1],a[7]=0,a[8]=t[2],a[9]=e[2],a[10]=i[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,this._distance=n.distance(o,r)}}(),computeHomePosition:function(e){var t=this.getHomeBound(e);t&&t.valid()&&(this.setDistance(this.getHomeDistance(t)),this.setTarget(t.center()))},getHomePosition:function(){if(void 0!==this._node){var e=this._target,t=this.getDistance();this.computeEyePosition(e,t,this._homePosition)}return this._homePosition},setMinSpeed:function(e){this._minSpeed=e},getMinSpeed:function(){return this._minSpeed},setDistance:function(e){this._distance=e},getDistance:function(){return this._distance},getSpeedFactor:function(){return Math.max(this._distance,this._minSpeed)},computePan:function(){var e=a.create(),t=n.create(),i=n.create();return function(r,o){var s=this._camera.getProjectionMatrix(),u=1===s[15]?1:2/s[5],l=this.getSpeedFactor()*u;o*=l,r*=l,a.invert(e,this._rotation),t[0]=e[0],t[1]=e[1],t[2]=e[2],n.normalize(t,t),i[0]=e[8],i[1]=e[9],i[2]=e[10],n.normalize(i,i),n.scale(t,t,-r),n.scale(i,i,o),n.add(this._target,this._target,t),n.add(this._target,this._target,i)}}(),computeRotation:function(){var e=n.fromValues(1,0,0);return function(t,i){var r=Math.atan(-this._rotation[6]/this._rotation[5])+i/10;r=Math.min(Math.max(r,this._limitPitchDown),this._limitPitchUp);var n=t/10,o=Math.atan2(this._rotation[4],this._rotation[0]),s=this._computeYaw(o,n,this._limitYawLeft,this._limitYawRight);a.fromRotation(this._rotation,-r,e),a.rotate(this._rotation,this._rotation,-s,this._upz)}}(),_computeYaw:function(e,t,i,r){var n=e+t;if(r!==Math.PI||i!==-Math.PI){if(r<i&&(n>Math.PI&&(e-=g,n-=g),n<-Math.PI&&(e+=g,n+=g)),0===t){var a=!1;a=i>r?n<i&&n>r:n<i||n>r,a&&(n=Math.abs(n-i)>Math.abs(n-r)?r:i)}t>0&&m(e,r)&&n>r?n=r:t<0&&m(i,e)&&n<i&&(n=i)}return n},computeZoom:function(e){this.zoom(e)},setAutoPushTarget:function(e){this._autoPushTarget=e},zoom:function(){var e=n.create();return function(t){var i=this._distance+this.getSpeedFactor()*(t-1);this._autoPushTarget&&i<this._limitZoomIn&&(n.sub(e,this._target,this.getEyePosition(e)),n.normalize(e,e),n.scale(e,e,this._limitZoomIn-i),n.add(this._target,this._target,e)),this._distance=Math.max(this._limitZoomIn,Math.min(this._limitZoomOut,i))}}(),getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getTarget:function(e){return n.copy(e,this._target)},getEyePosition:function(e){return this.computeEyePosition(this._target,this._distance,e),e},computeEyePosition:function(){var e=n.create(),t=a.create();return function(i,r,o){a.invert(t,this._rotation),e[1]=r,n.transformMat4(o,e,t),n.add(o,i,o)}}(),update:function(){var e=n.create();return function(t){var i,r=t.getFrameStamp().getDeltaTime();i=this._rotate.update(r),this.computeRotation(.1*-i[0]*this._scaleMouseMotion,.1*-i[1]*this._scaleMouseMotion);i=this._pan.update(r),this.computePan(.002*-i[0],.002*-i[1]),i=this._zoom.update(r),this.computeZoom(1+i[0]/10);var o=this._target,s=this._distance;a.invert(this._inverseMatrix,this._rotation),a.mul(this._inverseMatrix,this._vrMatrix,this._inverseMatrix),n.set(e,0,s,0),n.transformMat4(e,e,this._inverseMatrix),a.lookAt(this._inverseMatrix,n.add(e,o,e),o,this._upz)}}(),setPoseVR:function(e){a.fromQuat(this._vrMatrix,e)}}),"osgGA","OrbitManipulator"),f.DeviceOrientation=s,f.GamePad=u,f.Hammer=l,f.LeapMotion=c,f.WebVR=d,f.StandardMouseKeyboard=h,e.exports=f},function(e,t,i){"use strict";var r=i(30),n=i(426),a=function(e){this._manipulator=e,this.init()};a.prototype={init:function(){this._panFactorX=1,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._lastScale=0,this._nbPointerLast=0,this._delay=.15,this._transformStarted=!1,this._dragStarted=!1},setEventProxy:function(e){if(void 0!==e&&(void 0===e||e!==this._eventProxy)){this._eventProxy=e;var t=this,i=e,a=function(e){return void 0!==e.pointers?e.pointers.length:1},o=function(e){return"touches "+a(e)+" distance "+e.distance+" x "+e.deltaX+" y "+e.deltaY};i.get("pinch").set({threshold:.1}),i.get("pan").set({threshold:0,pointers:0}),i.get("pinch").recognizeWith(i.get("pan")),this._cbPanStart=function(e){var i=t._manipulator;i&&!t._transformStarted&&"mouse"!==e.pointerType&&(t._dragStarted=!0,t._nbPointerLast=a(e),2===t._nbPointerLast?(i.getPanInterpolator().reset(),i.getPanInterpolator().set(e.center.x*t._panFactorX,e.center.y*t._panFactorY)):(i.getRotateInterpolator().reset(),i.getRotateInterpolator().set(e.center.x*t._rotateFactorX,e.center.y*t._rotateFactorY)),r.debug("drag start, "+o(e)))},this._cbPanMove=function(e){var i=t._manipulator;if(i&&t._dragStarted&&"mouse"!==e.pointerType){var n=a(e);t._nbPointerLast!==n&&(2===n?i.getPanInterpolator().reset():i.getRotateInterpolator().reset(),t._nbPointerLast=n),2===n?(i.getPanInterpolator().setTarget(e.center.x*t._panFactorX,e.center.y*t._panFactorY),r.debug("pan, "+o(e))):(i.getRotateInterpolator().setDelay(t._delay),i.getRotateInterpolator().setTarget(e.center.x*t._rotateFactorX,e.center.y*t._rotateFactorY),r.debug("rotate, "+o(e)))}},this._cbPanEnd=function(e){t._manipulator&&t._dragStarted&&"mouse"!==e.pointerType&&(t._dragStarted=!1,r.debug("drag end, "+o(e)))},this._cbPinchStart=function(e){var i=t._manipulator;i&&"mouse"!==e.pointerType&&(t._transformStarted=!0,t._lastScale=e.scale,i.getZoomInterpolator().reset(),i.getZoomInterpolator().set(t._lastScale),e.preventDefault(),r.debug("zoom start, "+o(e)))},this._cbPinchEnd=function(e){"mouse"!==e.pointerType&&(t._transformStarted=!1,r.debug("zoom end, "+o(e)))},this._cbPinchInOut=function(e){var i=t._manipulator;if(i&&t._transformStarted&&"mouse"!==e.pointerType){var a=e.scale>t._lastScale?t._zoomFactor:3*t._zoomFactor;a*=n.smoothStep(0,.5,.5-Math.abs(e.velocity));var s=(e.scale-t._lastScale)*a;t._lastScale=e.scale,i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0]-s),r.debug("zoom, "+o(e))}},i.on("panstart ",this._cbPanStart),i.on("panmove",this._cbPanMove),i.on("panend",this._cbPanEnd),i.on("pinchstart",this._cbPinchStart),i.on("pinchend",this._cbPinchEnd),i.on("pinchin pinchout",this._cbPinchInOut)}},removeEventProxy:function(e){e&&this._eventProxy&&(e.off("panstart ",this._cbPanStart),e.off("panmove",this._cbPanMove),e.off("panend",this._cbPanEnd),e.off("pinchstart",this._cbPinchStart),e.off("pinchend",this._cbPinchEnd),e.off("pinchin pinchout",this._cbPinchInOut))},setManipulator:function(e){this._manipulator=e}},e.exports=a},function(e,t,i){"use strict";var r=i(30),n=i(920),a=i(926),o=i(333),s=function(e){if(!e){if(s.instance)return s.instance;s.instance=this}return this.addShaders(n),this.addShaders(a),this};s.prototype={_shadersText:{},_shadersList:{},_globalDefaultprecision:"#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif",_debugLines:!1,_includeR:/#pragma include "([^"]+)"/g,_includeCondR:/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,_defineR:/\#define\s+([a-zA-Z_0-9]+)/,_precisionR:/precision\s+(high|low|medium)p\s+float/,addShaders:function(e){for(var t in e)this._shadersList[t]=t,this._shadersText[t]=e[t]},instrumentShaderlines:function(e,t){return"\n#line 0 "+t+"\n"+e},getShaderTextPure:function(e){var t=this._shadersText[e];return t||(r.error("shader file/text: "+e+" not registered"),t=""),t},getShader:function(e,t,i,r){var n=this.getShaderTextPure(e);return this.processShader(n,t,i,r)},preprocess:function(e,t,i,r){var n=this;return e.replace(this._includeCondR,function(e,a){var o=a.split(" "),s=o[0].replace(/"/g,"");if(o.length>1&&r){for(var u=!1,l=r.map(function(e){return n._defineR.test(e)&&e.replace(/\s+/g," ").split(" ")[1]}),c=1;c<o.length&&!u;c++)for(var h=o[c].replace(/"/g,""),d=0;d<l.length&&!u;d++)if(!1!==l[d]&&l[d]===h){u=!0;break}if(!u)return""}if(-1!==i.indexOf(s))return"";var p=this.getShaderTextPure(s);return i.push(s),this._debugLines&&(p=this.instrumentShaderlines(p,t)),t++,p=this.preprocess(p,t,i,r)}.bind(this))},_getSortedUnique:function(){var e=function(e,t,i){return!t||e!==i[t-1]};return function(t){return t&&t.sort().filter(e)}}(),_convertExtensionsToWebGL2:function(){var e=function(e,t){return"core_"+t},t=function(e,t){return"#define "+t},i="(GL_EXT_shader_texture_lod|GL_OES_standard_derivatives|GL_EXT_draw_buffers|GL_EXT_frag_depth)",r=new RegExp("#\\s*extension\\s+"+i+".*","g"),n=new RegExp(i,"g");return function(i){return i=i.replace(r,t),i=i.replace(n,e)}}(),_convertToWebGL2:function(){var e=[],t=function(t,i){var r="glFragData_"+i;return e[i]="layout(location = "+i+") out vec4 "+r+";",r};return function(i,r){return i?(i=i.replace(/attribute\s+/g,"in "),i=i.replace(/varying\s+/g,r?"in ":"out "),i=i.replace(/(texture2D|textureCube)\s*\(/g,"texture("),i=i.replace(/(textureCubeLodEXT)\s*\(/g,"textureLod("),i=this._convertExtensionsToWebGL2(i),r&&(e.length=0,i=i.replace(/gl_FragData\s*\[\s*(\d+)\s*\]/g,t),e.length||e.push("out vec4 glFragColor_0;"),i=i.replace(/gl_FragColor/g,"glFragColor_0"),i=i.replace(/void\s+main\s*\(/g,e.join("\n")+"\nvoid main(")),i):i}}(),_hasVersion:function(e){var t=e.match(/^#(.*)$/m);return t&&-1!==t[0].indexOf("version")},processShader:function(e,t,i,r){if(this._hasVersion(e))return e;var n=[],a=e,s=0;this._debugLines&&(a=this.instrumentShaderlines(a,s),s++),t=this._getSortedUnique(t),i=this._getSortedUnique(i);var u=this.preprocess(a,s,n,t,r),l=-1===u.indexOf("gl_Position"),c=o.instance().isWebGL2(),h=c?"#version 300 es":"#version 100";h+="\n";var d=i?i.join("\n")+"\n":"",p=t?t.join("\n")+"\n":"";c&&(d=this._convertExtensionsToWebGL2(d),p=this._convertToWebGL2(p,l),u=this._convertToWebGL2(u,l));var f="";return this._globalDefaultprecision&&!this._precisionR.test(u)&&(f=this._globalDefaultprecision+"\n"),h+d+f+p+u}},e.exports=s},function(e,t,i){"use strict";var r=i(458),n=i(459),a=i(916),o=i(580),s=i(697),u=i(917),l=i(294),c={};c.Compiler=r,c.ShaderGenerator=n,c.ShaderGeneratorProxy=a,c.ShaderProcessor=o,c.nodeFactory=s,c.node=u,c.utils=l,c.debugShaderNode=!1,e.exports=c},function(e,t,i){"use strict";var r=i(30),n=i(91),a=i(14),o=function(){n.call(this),this._shadowedScene=void 0,this._dirty=!1,this._enabled=!0,this._filledOnce=!1};a.createPrototypeObject(o,a.objectInherit(n.prototype,{dirty:function(){this._dirty=!0},getShadowedScene:function(){return this._shadowedScene},setEnabled:function(e){this._enabled=e},isEnabled:function(){return this._enabled},isFilledOnce:function(){return this._filledOnce},requestRedraw:function(){this._filledOnce=!1},setShadowedScene:function(e){this._shadowedScene=e},init:function(){r.log("No ShadowTechnique activated: normal rendering activated")},valid:function(){return!1},updateShadowTechnique:function(){},cullShadowCasting:function(){},cleanSceneGraph:function(){r.log("No ShadowTechnique activated: normal rendering activated")}}),"osgShadow","ShadowTechnique"),e.exports=o},function(e,t,i){"use strict";var r=i(30),n=i(14),a=i(135),o=i(563),s=i(382),u=i(97),l=i(274),c=i(383),h=i(425),d=i(8).mat4,p=i(88),f=i(293),g=i(329),m=i(330),v=i(384),_=i(146),b=i(8).vec2,x=i(8).vec3,S=function(){a.call(this),this._stack=[],this._renderToScreen=!1,this._dirty=!1,this._textureRTT=[],this._cameraRTT=[];var e=function(){};e.prototype={update:function(e){return e.isDirty()&&e.build(),!0}},this.addUpdateCallback(new e),this.getOrCreateStateSet().setAttributeAndModes(new s("DISABLE")),this.getOrCreateStateSet().setAttributeAndModes(new o("BACK"))};n.createPrototypeObject(S,n.objectInherit(a.prototype,{dirty:function(){for(var e=0,t=this._stack.length;e<t;e++)this._stack[e].filter.dirty()},addPass:function(e,t,i){var r={};return r.filter=e,t instanceof u?(r.texture=t,r.textureTarget=i||u.TEXTURE_2D):void 0!==t&&void 0!==i&&(r.width=Math.floor(t),r.height=Math.floor(i)),this._stack.push(r),r.filter},renderToScreen:function(e,t){this._renderToScreen=!0,this._renderToScreenWidth=e,this._renderToScreenHeight=t},getResultTexture:function(){return this._resultTexture},isDirty:function(){for(var e=0,t=this._stack.length;e<t;e++)if(this._stack[e].filter.isDirty())return!0;return!1},build:function(){var e=this;e._textureRTT=[],e._cameraRTT=[],this.removeChildren();var t;this._stack.forEach(function(i,n,a){if(i.filter.isDirty()&&i.filter.build(),i.filter.interConnectFilters)return void(t=i.filter.interConnectFilters(e,n,a));var o,s,f=i.filter.getStateSet();if(void 0!==i.texture)o=i.texture.getWidth(),s=i.texture.getHeight();else if(void 0!==i.width&&void 0!==i.height)o=i.width,s=i.height;else{var g=f.getTextureAttribute(0,"Texture");void 0===g?r.warn("Composer can't find any information to setup texture output size"):(o=g.getWidth(),s=g.getHeight())}var m=n===a.length-1&&!0===e._renderToScreen;if(!m&&void 0===f.getAttribute("Program"))return void a[n+1].filter.getStateSet().setTextureAttributeAndModes(0,f.getTextureAttribute(0,"Texture"));var x=new l;e._cameraRTT.push(x),x.setStateSet(f);var S;if(!0===m)o=e._renderToScreenWidth,s=e._renderToScreenHeight;else{x.setRenderOrder(l.PRE_RENDER,0),S=i.texture;var y=i.textureTarget;void 0===S&&(S=new u,S.setName("composer Rtt "+i.filter.getFragmentName()),S.setTextureSize(o,s),y=u.TEXTURE_2D,e._textureRTT.push(S)),x.attachTexture(c.COLOR_ATTACHMENT0,S,y)}var C=new h(0,0,o,s);x.setReferenceFrame(_.ABSOLUTE_RF),x.setViewport(C),d.ortho(x.getProjectionMatrix(),0,1,0,1,-5,5);var T=v.createTexturedFullScreenFakeQuadGeometry();i.filter.buildGeometry&&(T=i.filter.buildGeometry(T)),T.setName("composer layer"),S&&n+1<a.length&&a[n+1].filter.getStateSet().setTextureAttributeAndModes(0,S),t=S,x.addChild(T),i.filter.getStateSet().addUniform(p.createFloat2(b.fromValues(o,s),"RenderSize")),x.setClearMask(0),x.setName(i.filter.getFragmentName()||"Composer Pass"+n),e.addChild(x)}),this._resultTexture=t}}),"osgUtil","Composer"),S.Filter=function(){this._stateSet=new f,this._dirty=!0,this._fragmentName="",this._vertexName=""},n.createPrototypeObject(S.Filter,{setFragmentName:function(e){this._fragmentName=e},getFragmentName:function(){return this._fragmentName},setVertexName:function(e){this._vertexName=e},getVertexName:function(){return this._vertexName},getDefineFragmentName:function(){return this._fragmentName?"\n#define SHADER_NAME "+this._fragmentName+"\n":""},getDefineVertexName:function(){return this._vertexName||this._fragmentName?"\n#define SHADER_NAME "+(this._vertexName||this._fragmentName)+"\n":""},getStateSet:function(){return this._stateSet},getOrCreateStateSet:function(){return this._stateSet},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty}},"osgUtil","ComposerFilter"),S.Filter.defaultVertexShader=["attribute vec3 Vertex;","varying vec2 vTexCoord0;","void main(void) {","  gl_Position = vec4(Vertex*2.0 - 1.0,1.0);","  vTexCoord0 = Vertex.xy;","}",""].join("\n"),S.Filter.defaultFragmentShaderHeader=["#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif","varying vec2 vTexCoord0;","uniform vec2 RenderSize;","uniform sampler2D Texture0;",""].join("\n"),S.Filter.shaderUtils=["vec4 packFloatTo4x8(in float v) {","vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;","enc = fract(enc);","enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);","return enc;","}"," ","vec4 pack2FloatTo4x8(in vec2 val) {"," const vec2 bitSh = vec2(256.0, 1.0);"," const vec2 bitMsk = vec2(0.0, 1.0/256.0);"," vec2 res1 = fract(val.x * bitSh);"," res1 -= res1.xx * bitMsk;"," vec2 res2 = fract(val.y * bitSh);"," res2 -= res2.xx * bitMsk;"," return vec4(res1.x,res1.y,res2.x,res2.y);","}"," ","float unpack4x8ToFloat( vec4 rgba ) {"," return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );","}"," ","vec2 unpack4x8To2Float(in vec4 val) {"," const vec2 unshift = vec2(1.0/256.0, 1.0);"," return vec2(dot(val.xy, unshift), dot(val.zw, unshift));","}","vec2 encodeNormal (vec3 n)","{","    float f = sqrt(8.0*n.z+8.0);","    return n.xy / f + 0.5;","}","vec3 decodeNormal (vec2 enc)","{","    vec2 fenc = enc*4.0-2.0;","    float f = dot(fenc,fenc);","    float g = sqrt(1.0-f/4.0);","    vec3 n;","    n.xy = fenc*g;","    n.z = 1.0-f/2.0;","    return n;","}",""].join("\n"),S.Filter.Helper={pascalCache:[[1]],getOrCreatePascalCoefficients:function(e){e=void 0===e?5:Math.min(e,128);var t=S.Filter.Helper.pascalCache;if(t[e])return t[e];for(var i=t.length-1;i<e;i++){var r=t[i],n=r.length,a=new Array(n);a[0]=1,a[n]=1;for(var o=i===t.length-1?Math.pow(2,i):1,s=0;s<n-1;s++)a[s+1]=(r[s]+r[s+1])*o;o=Math.pow(2,i+1);for(var u=0;u<n+1;u++)a[u]/=o;t.push(a)}return t[e]}},S.Filter.Custom=function(e,t){S.Filter.call(this),this._fragmentShader=e,this._uniforms=t,this._vertexShader=S.Filter.defaultVertexShader},n.createPrototypeObject(S.Filter.Custom,n.objectInherit(S.Filter.prototype,{getFragmentShader:function(){return this._fragmentShader},getVertexShader:function(){return this._vertexShader},setFragmentShader:function(e){this._fragmentShader=e},setVertexShader:function(e){this._vertexShader=e},autoBindFragmentUniformStateSet:function(e,t,i){var r=0,n=t.match(/uniform\s+\w+\s+\w+/g);if(n)for(var a=0,o=n.length;a<o;a++){var s,u=n[a].match(/uniform\s+(\w+)\s+(\w+)/),l=u[1],c=u[2];if(i[c]){var h=i[c];-1!==l.search("sampler")?(e.setTextureAttributeAndModes(r,h),s=p.createInt1(r,c),r++,e.addUniform(s)):(s=p.isUniform(h)?h:p[l](i[c],c),e.addUniform(s))}}},build:function(){this._program=new g(new m(m.VERTEX_SHADER,this._vertexShader+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,this._fragmentShader+this.getDefineFragmentName())),this._uniforms&&this.autoBindFragmentUniformStateSet(this._stateSet,this._fragmentShader,this._uniforms),this._stateSet.setAttributeAndModes(this._program),this._dirty=!1}}),"osgUtil","ComposerFilterCustom"),S.Filter.PingPong=function(e,t,i,r,n,a){S.Filter.Custom.apply(this,[n,a]),this._cameraRtt0=e,this._rtt0=t,this._cameraRtt1=i,this._rtt1=r,this._fragmentName="PingPong"},n.createPrototypeObject(S.Filter.PingPong,n.objectInherit(S.Filter.Custom.prototype,{interConnectFilters:function(e,t,i){var r=this.getStateSet(),n=this._cameraRtt0.getOrCreateStateSet(),a=this._cameraRtt1.getOrCreateStateSet();n.setAttributeAndModes(this._program),a.setAttributeAndModes(this._program);var o,s,u=this.getStateSet().getUniformList();if(u)for(o in u)s=u[o].getUniform(),n.addUniform(s),a.addUniform(s);if(u=this._uniforms)for(o in u)s=u[o],n.addUniform(s),a.addUniform(s);var l=p.createInt1(0,"Texture0"),c=p.createInt1(1,"Texture1");n.addUniform(l),n.addUniform(c),a.addUniform(l),a.addUniform(c);var h=r.getTextureAttribute(0,"Texture");if(n.setTextureAttributeAndModes(0,h),a.setTextureAttributeAndModes(0,h),n.setTextureAttributeAndModes(1,this._rtt1),a.setTextureAttributeAndModes(1,this._rtt0),t!==i.length-1){var d=i[t+1].filter.getStateSet();d.setTextureAttributeAndModes(0,this._rtt0),d.setTextureAttributeAndModes(1,this._rtt1),d.addUniform(l),d.addUniform(c)}var f=v.createTexturedFullScreenFakeQuadGeometry();return this.buildGeometry&&(f=this.buildGeometry(f)),f.setName("composer layer"),this._cameraRtt0.addChild(f),this._cameraRtt1.addChild(f),e.addChild(this._cameraRtt0),e.addChild(this._cameraRtt1),e._textureRTT.push(this._rtt0),e._textureRTT.push(this._rtt1),e._cameraRTT.push(this._cameraRtt0),e._cameraRTT.push(this._cameraRtt1),this._cameraRtt1.setNodeMask(0),this._rtt0},switch:function(){var e=this._cameraRtt0.getNodeMask(),t=this._cameraRtt1.getNodeMask();this._cameraRtt0.setNodeMask(t),this._cameraRtt1.setNodeMask(e)}}),"osgUtil","ComposerFilterPingPong"),S.Filter.AverageHBlur=function(e,t,i,r){S.Filter.call(this),this._linear=!1!==t,this.setBlurSize(void 0!==e?e:5),this._unpack=i,this._pack=r,this._pixelSize=1,this._fragmentName="AverageHBlur"+this._nbSamples},n.createPrototypeObject(S.Filter.AverageHBlur,n.objectInherit(S.Filter.prototype,{setBlurSize:function(e){e%2!=1&&(e+=1),this._nbSamples=e,this.dirty()},setPixelSize:function(e){this._pixelSize=e,this.dirty()},getUVOffset:function(e){return"vec2(float("+e+")/RenderSize[0], 0.0);"},getShaderBlurKernel:function(){var e=this._nbSamples,t=[];t.push(" pixel = unpack(Texture0, vTexCoord0 );"),t.push(" if (pixel.w == 0.0) { gl_FragColor = pixel; return; }"),t.push(" vec2 offset;");var i,r=Math.floor(e/2);r%2!=0&&(e+=1,r=Math.floor(e/2));var n=2*r+1,a=1/n;if(this._linear){var o,s,u=1,l=(1-a)/(2*r);for(t.push(" pixel *= float("+a+");"),t.push(" vec4 pixelLin = vec4(0.0);"),i=0;i<r;i+=2)s=u+.5,u+=2,o=this.getUVOffset(s*this._pixelSize),t.push(" offset = "+o),t.push(" pixelLin += unpack(Texture0, vTexCoord0 + offset);"),t.push(" pixelLin += unpack(Texture0, vTexCoord0 - offset);");t.push(" pixel += pixelLin * float("+2*l+");")}else{for(i=0;i<r;i++)t.push(" offset = "+this.getUVOffset((i+1)*this._pixelSize)),t.push(" pixel += unpack(Texture0, vTexCoord0 + offset);"),t.push(" pixel += unpack(Texture0, vTexCoord0 - offset);");t.push(" pixel *= float("+a+");")}return t},build:function(){var e=this._stateSet.getTextureAttribute(0,"Texture");e&&this._linear?(e.setMinFilter("LINEAR"),e.setMagFilter("LINEAR")):this._linear=!1;var t=S.Filter.defaultVertexShader,i=[S.Filter.defaultFragmentShaderHeader,"uniform float width;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","void main (void)","{","  vec4 pixel;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = pack(pixel);","}",""].join("\n"),r=new g(new m(m.VERTEX_SHADER,t+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(p.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(r),this._dirty=!1}}),"osgUtil","ComposerFilterAverageHBlur"),S.Filter.AverageVBlur=function(e,t,i,r){S.Filter.AverageHBlur.call(this,e,t,i,r),this._fragmentName="AverageVBlur"+this._nbSamples},n.createPrototypeObject(S.Filter.AverageVBlur,n.objectInherit(S.Filter.AverageHBlur.prototype,{getUVOffset:function(e){return"vec2(0.0, float("+e+")/RenderSize[1]);"}}),"osgUtil","ComposerFilterAverageVBlur"),S.Filter.BilateralHBlur=function(e,t,i){S.Filter.call(this),void 0===e&&(e={});var r=e.nbSamples,n=e.depthTexture,a=e.radius;this.setBlurSize(void 0!==r?r:5),this._depthTexture=n,this._radius=p.createFloat(1,"radius"),this._pixelSize=p.createFloat(1,"pixelSize"),this.setRadius(a),this._unpack=t,this._pack=i,this._fragmentName="BilateralHBlur"+this._nbSamples},n.createPrototypeObject(S.Filter.BilateralHBlur,n.objectInherit(S.Filter.prototype,{setBlurSize:function(e){e%2!=1&&(e+=1),this._nbSamples=e,this.dirty()},setPixelSize:function(e){this._pixelSize.setFloat(e)},setRadius:function(e){this._radius.setFloat(e)},getUVOffset:function(e){return"vec2(0.0, float("+e+") * pixelSize )/RenderSize[1];"},getShaderBlurKernel:function(){var e=this._nbSamples,t=[];t.push(" pixel = unpack(Texture0, vTexCoord0 );"),t.push(" if (pixel.w <= 0.0001) { gl_FragColor = vec4(1.0); return; }"),t.push(" vec2 offset, tmpUV;"),t.push(" depth = getDepthValue(unpack(Texture1, vTexCoord0 ));");for(var i=1;i<Math.ceil(e/2);i++)t.push(" offset = "+this.getUVOffset(i)),t.push(" tmpUV =  vTexCoord0 + offset;"),t.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),t.push(" if ( abs(depth-tmpDepth) < radius) {"),t.push("   pixel += unpack(Texture0, tmpUV);"),t.push("   nbHits += 1.0;"),t.push(" }"),t.push(" tmpUV =  vTexCoord0 - offset;"),t.push(" tmpDepth = getDepthValue(unpack(Texture1, tmpUV ));"),t.push(" if ( abs(depth-tmpDepth) < radius) {"),t.push("   pixel += unpack(Texture0, tmpUV);"),t.push("   nbHits += 1.0;"),t.push(" }");return t.push(" pixel /= nbHits;"),t},build:function(){var e=S.Filter.defaultVertexShader,t=[S.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float width;","uniform mat4 projection;","uniform float radius;","uniform float pixelSize;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","float znear,zfar,zrange;","",S.Filter.shaderUtils,"","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  return -depth;","}","void main (void)","{","  vec4 pixel;","  float depth, tmpDepth;","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  float nbHits = 1.0;",this.getShaderBlurKernel().join("\n"),"  gl_FragColor = pack(pixel);","}",""].join("\n"),i=new g(new m(m.VERTEX_SHADER,e+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,t+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(p.createInt1(0,"Texture0")),void 0===this._stateSet.getUniform("Texture1")&&this._stateSet.addUniform(p.createInt1(1,"Texture1")),this._stateSet.addUniform(this._radius),this._stateSet.addUniform(this._pixelSize),this._stateSet.setTextureAttributeAndModes(1,this._depthTexture),this._stateSet.setAttributeAndModes(i),this._dirty=!1}}),"osgUtil","ComposerFilterBilateralHBlur"),S.Filter.BilateralVBlur=function(e,t,i){S.Filter.BilateralHBlur.call(this,e,t,i),this._fragmentName="BilateralVBlur"+this._nbSamples},n.createPrototypeObject(S.Filter.BilateralVBlur,n.objectInherit(S.Filter.BilateralHBlur.prototype,{getUVOffset:function(e){return"vec2(float("+e+")*pixelSize/RenderSize[0],0.0);"}}),"osgUtil","ComposerFilterBilateralVBlur"),S.Filter.InputTexture=function(e){S.Filter.call(this),this._stateSet.setTextureAttributeAndModes(0,e),this._fragmentName="InputTexture"},n.createPrototypeObject(S.Filter.InputTexture,n.objectInherit(S.Filter.prototype,{build:function(){this._dirty=!1}}),"osgUtil","ComposerFilterInputTexture"),S.Filter.HBlur=function(e,t,i,r){S.Filter.call(this),this._linear=!1!==t,this.setBlurSize(void 0!==e?e:5),this._unpack=i,this._pack=r,this._fragmentName="HBlur"+this._nbSamples},n.createPrototypeObject(S.Filter.HBlur,n.objectInherit(S.Filter.prototype,{setBlurSize:function(e){e%2!=0&&(e+=1),this._nbSamples=e,this.dirty()},getUVOffset:function(e){return"vec2(float("+e+")/ RenderSize[0], 0.0) ;"},build:function(){var e=this._nbSamples,t=this._stateSet.getTextureAttribute(0,"Texture");t&&this._linear?(t.setMinFilter("LINEAR"),t.setMagFilter("LINEAR")):this._linear=!1;var i=S.Filter.defaultVertexShader,r=.005/e,n=e,a=S.Filter.Helper.getOrCreatePascalCoefficients(n),o=Math.floor(n/2),s=[];s.push(" pixel = float("+a[o]+")*unpack(Texture0, vTexCoord0 ).rgb;"),s.push(" vec2 offset;");var u,l,c,h,d;if(this._linear)for(u=1,l=o+1;l<e;l+=2){var f=a[l],v=a[l+1];if((c=f+v)<r)break;var _=u,b=u+1;u+=2,d=(_*f+b*v)/c,h=this.getUVOffset(d),s.push(" offset = "+h),s.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy + offset.xy)).rgb;"),s.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy - offset.xy)).rgb;")}else for(u=1,l=o+1;l<e&&!((c=a[l])<r);l++)d=u++,h=this.getUVOffset(d),s.push(" offset = "+h),s.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy + offset.xy)).rgb;"),s.push(" pixel += "+c+"* unpack(Texture0, (vTexCoord0.xy - offset.xy)).rgb;");var x=[S.Filter.defaultFragmentShaderHeader,"uniform float width;",this._unpack||"vec4 unpack(const in sampler2D tex, const in vec2 uv) { return texture2D(tex, uv); }",this._pack||"vec4 pack(vec4 pix) { return pix; }","void main (void)","{","  vec3 pixel;",s.join("\n"),"  gl_FragColor = pack(vec4(pixel, 1.0));","}",""].join("\n"),y=new g(new m(m.VERTEX_SHADER,i+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,x+this.getDefineFragmentName()));void 0===this._stateSet.getUniform("Texture0")&&this._stateSet.addUniform(p.createInt1(0,"Texture0")),this._stateSet.setAttributeAndModes(y),this._dirty=!1}}),"osgUtil","ComposerFilterHBlur"),S.Filter.VBlur=function(e,t,i,r){S.Filter.HBlur.call(this,e,t,i,r),this._fragmentName="VBlur"+this._nbSamples},n.createPrototypeObject(S.Filter.VBlur,n.objectInherit(S.Filter.HBlur.prototype,{getUVOffset:function(e){return"vec2(0.0, float("+e+")/RenderSize[1]) ;"}}),"osgUtil","ComposerFilterVBlur"),S.Filter.SobelFilter=function(){S.Filter.call(this),this._color=p.createFloat3(x.fromValues(1,1,1),"color"),this._factor=p.createFloat(1,"factor"),this._fragmentName="SobelFilter"},n.createPrototypeObject(S.Filter.SobelFilter,n.objectInherit(S.Filter.prototype,{setColor:function(e){this._color.setVec3(e)},setFactor:function(e){this._factor.setFloat(e)},build:function(){var e=this._stateSet,t=S.Filter.defaultVertexShader,i=["",S.Filter.defaultFragmentShaderHeader,"uniform vec3 color;","uniform float factor;","void main (void)","{","  float fac0 = 2.0;","  float fac1 = 1.0;","  float offsetx = 1.0/RenderSize[0];","  float offsety = 1.0/RenderSize[1];","  vec4 texel0 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, offsety));","  vec4 texel1 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, 0.0));","  vec4 texel2 = texture2D(Texture0, vTexCoord0 + vec2(offsetx, -offsety));","  vec4 texel3 = texture2D(Texture0, vTexCoord0 + vec2(0.0, -offsety));","  vec4 texel4 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, -offsety));","  vec4 texel5 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, 0.0));","  vec4 texel6 = texture2D(Texture0, vTexCoord0 + vec2(-offsetx, offsety));","  vec4 texel7 = texture2D(Texture0, vTexCoord0 + vec2(0.0, offsety));","  vec4 rowx = -fac0*texel5 + fac0*texel1 +  -fac1*texel6 + fac1*texel0 + -fac1*texel4 + fac1*texel2;","  vec4 rowy = -fac0*texel3 + fac0*texel7 +  -fac1*texel4 + fac1*texel6 + -fac1*texel2 + fac1*texel0;","  float mag = sqrt(dot(rowy,rowy)+dot(rowx,rowx));","  if (mag < 1.0/255.0) discard;","  mag *= factor;","  mag = min(1.0, mag);","  gl_FragColor = vec4(color*mag,mag);","}",""].join("\n"),r=new g(new m(m.VERTEX_SHADER,t+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i+this.getDefineFragmentName()));e.setAttributeAndModes(r),e.addUniform(this._color),e.addUniform(this._factor),e.addUniform(p.createInt1(0,"Texture0")),this._dirty=!1}}),"osgUtil","ComposerFilterSobelFilter"),S.Filter.BlendMix=function(){S.Filter.call(this);var e,t,i,r=0,n=1,a=this._stateSet;3===arguments.length?(e=arguments[0],t=arguments[1],i=arguments[2],r=1,n=2,a.setTextureAttributeAndModes(r,e)):2===arguments.length?(t=arguments[0],i=arguments[1]):1===arguments.length&&(t=arguments[0],i=.5),a.setTextureAttributeAndModes(n,t),a.addUniform(p.createInt1(r,"Texture0")),a.addUniform(p.createInt1(n,"Texture1")),this._mixValueUniform=p.createFloat1(i,"MixValue"),a.addUniform(this._mixValueUniform),this._fragmentName="BlendMix"},n.createPrototypeObject(S.Filter.BlendMix,n.objectInherit(S.Filter.prototype,{getBlendFactorUniform:function(){return this._mixValueUniform},build:function(){var e=this._stateSet,t=S.Filter.defaultVertexShader,i=["",S.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = mix(texture2D(Texture0,vTexCoord0), texture2D(Texture1,vTexCoord0),MixValue);","}",""].join("\n"),r=new g(new m(m.VERTEX_SHADER,t+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,i+this.getDefineFragmentName()));e.setAttributeAndModes(r),this._dirty=!1}}),"osgUtil","ComposerFilterBlendMix"),S.Filter.BlendMultiply=function(){S.Filter.call(this);var e,t,i=this._stateSet,r=0;2===arguments.length?(e=arguments[0],t=arguments[1],r=1,r=2,i.setTextureAttributeAndModes(r,e)):1===arguments.length&&(t=arguments[0]),i.setTextureAttributeAndModes(1,t),i.addUniform(p.createInt1(r,"Texture0")),i.addUniform(p.createInt1(1,"Texture1")),this._fragmentName="BlendMultiply"},n.createPrototypeObject(S.Filter.BlendMultiply,n.objectInherit(S.Filter.prototype,{build:function(){var e=S.Filter.defaultVertexShader,t=["",S.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform float MixValue;","void main (void)","{","  gl_FragColor = texture2D(Texture0,vTexCoord0)*texture2D(Texture1,vTexCoord0);","}",""].join("\n"),i=new g(new m(m.VERTEX_SHADER,e+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,t+this.getDefineFragmentName()));this._stateSet.setAttributeAndModes(i),this._dirty=!1}}),"osgUtil","ComposerFilterBlendMultiply"),S.Filter.SSAO=function(e){S.Filter.call(this);var t=this._stateSet,i=16,r=.05;if(void 0!==e){void 0!==e.nbSamples&&(i=e.nbSamples),void 0!==e.radius&&(r=e.radius);var n=e.normal,a=e.position,o=n.getWidth(),s=n.getHeight();this._size=b.fromValues(o,s),t.setTextureAttributeAndModes(0,n),t.setTextureAttributeAndModes(1,a)}this._radius=r,this._nbSamples=i,this._noiseTextureSize=16,this._sceneRadius=2,t.addUniform(p.createFloat1(1,"Power")),t.addUniform(p.createFloat1(r,"Radius")),t.addUniform(p.createInt1(0,"Texture0")),t.addUniform(p.createInt1(1,"Texture1")),t.addUniform(p.createInt1(2,"Texture2")),t.addUniform(p.createFloat1(.1,"AngleLimit")),this.initNoise(),this._fragmentName="SSAO"},n.createPrototypeObject(S.Filter.SSAO,n.objectInherit(S.Filter.prototype,{initNoise:function(){var e=this._noiseTextureSize,t=new Array(e*e*3);!function(t){for(var i=b.fromValues(0,0),r=0;r<e*e;r++)i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),b.normalize(i,i),t[3*r+0]=255*(.5*i[0]+.5),t[3*r+1]=255*(.5*i[1]+.5),t[3*r+2]=127.5}(t);var i=new u;i.setWrapS("REPEAT"),i.setWrapT("REPEAT"),i.setMinFilter("NEAREST"),i.setMagFilter("NEAREST"),i.setTextureSize(e,e),i.setImage(new Uint8Array(t),"RGB"),this._noiseTexture=i},setSceneRadius:function(e){this._sceneRadius=e,this.dirty()},setAngleLimit:function(e){this._stateSet.getUniform("AngleLimit").setFloat(e)},setNbSamples:function(e){e!==this._nbSamples&&(this._nbSamples=Math.floor(e),this.dirty())},setRadius:function(e){this._stateSet.getUniform("Radius").setFloat(e)},setPower:function(e){this._stateSet.getUniform("Power").setFloat(e)},build:function(){var e=this._stateSet,t=this._nbSamples,i=new Array(4*t);!function(e){for(var i=x.create(),r=0;r<t;r++){i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),i[2]=Math.random(),x.normalize(i,i);var n=Math.max(r/t,.1);n=.1+n*n*.9,e[3*r+0]=i[0],e[3*r+1]=i[1],e[3*r+2]=i[2],e[3*r+3]=n}}(i),e.setTextureAttributeAndModes(2,this._noiseTexture);var r=e.getUniform("noiseSampling");void 0===r?(r=p.createFloat2(b.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize),"noiseSampling"),e.addUniform(r)):r.setVec2(b.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize));for(var n=["","attribute vec3 Vertex;","attribute vec2 TexCoord0;","varying vec2 vTexCoord0;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex,1.0);","  vTexCoord0 = TexCoord0;","}",""].join("\n"),a=[],o=0;o<t;o++)a.push("kernel["+o+"] = vec4("+i[3*o]+","+i[3*o+1]+", "+i[3*o+2]+", "+i[3*o+3]+");");a=a.join("\n");var s=["",S.Filter.defaultFragmentShaderHeader,"uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","vec3 normal;","vec4 position;","vec4 kernel["+t+"];","mat3 computeBasis()","{","  vec2 uvrand = vTexCoord0*noiseSampling;","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","void main (void)","{",a,"  position = texture2D(Texture1, vTexCoord0);","  vec4 p = texture2D(Texture0, vTexCoord0);","  depth = p.w;","  normal = vec3(p);","  if ( position.w == 0.0) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vecKernel;","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = texture2D(Texture1, offset.xy).z;","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),u=new g(new m(m.VERTEX_SHADER,n+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,s+this.getDefineFragmentName()));e.setAttributeAndModes(u),this._dirty=!1}}),"osgUtil","ComposerFilterSSAO"),S.Filter.SSAO8=function(e){S.Filter.SSAO.call(this,e),this._fragmentName="SSAO8"},n.createPrototypeObject(S.Filter.SSAO8,n.objectInherit(S.Filter.SSAO.prototype,{buildGeometry:function(e){return e.getAttributes().TexCoord1=this._texCoord1,e},build:function(){var e=this._stateSet,t=this._nbSamples,i=new Array(4*t);!function(e){for(var i=x.create(),r=0;r<t;r++){i[0]=2*(Math.random()-.5),i[1]=2*(Math.random()-.5),i[2]=Math.random(),x.normalize(i,i);var n=Math.max(r/t,.1);n=.1+n*n*.9,e[3*r+0]=i[0],e[3*r+1]=i[1],e[3*r+2]=i[2],e[3*r+3]=n}}(i),e.setTextureAttributeAndModes(2,this._noiseTexture);var r=e.getUniform("noiseSampling");void 0===r?(r=p.createFloat2(b.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize),"noiseSampling"),e.addUniform(r)):r.setVec2(b.fromValues(this._size[0]/this._noiseTextureSize,this._size[1]/this._noiseTextureSize));for(var n=["","attribute vec3 Vertex;","attribute vec2 TexCoord0;","attribute vec3 TexCoord1;","varying vec2 vTexCoord0;","varying vec3 vTexCoord1;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex,1.0);","  vTexCoord0 = TexCoord0;","  vTexCoord1 = TexCoord1;","}",""].join("\n"),a=[],o=0;o<t;o++)a.push("kernel["+o+"] = vec4("+i[3*o]+","+i[3*o+1]+", "+i[3*o+2]+", "+i[3*o+3]+");");a=a.join("\n");var s=["",S.Filter.defaultFragmentShaderHeader,"varying vec3 vTexCoord1;","uniform sampler2D Texture1;","uniform sampler2D Texture2;","uniform mat4 projection;","uniform vec2 noiseSampling;","uniform float Power;","uniform float Radius;","uniform float AngleLimit;","#define NB_SAMPLES "+this._nbSamples,"float depth;","float znear, zfar, zrange;","vec3 normal;","vec3 position;","vec4 kernel["+t+"];",S.Filter.shaderUtils,"mat3 computeBasis()","{","  vec2 uvrand = vTexCoord0*noiseSampling;","  //uvrand = rand(gl_FragCoord.xy);","  vec3 rvec = texture2D(Texture2, uvrand*2.0).xyz*2.0-vec3(1.0);","  //vec3 rvec = normalize(vec3(uvrand,0.0));","  vec3 tangent = normalize(rvec - normal * dot(rvec, normal));","  vec3 bitangent = cross(normal, tangent);","  mat3 tbn = mat3(tangent, bitangent, normal);","  return tbn;","}","float getDepthValue(vec4 v) {","  float depth = unpack4x8ToFloat(v);","  depth = depth*zrange+znear;","  //depth = depth*zrange;","  return -depth;","}","void main (void)","{",a,"  vec4 p = texture2D(Texture0, vTexCoord0);","  if (dot(p,p) < 0.001) { ","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  znear = projection[3][2] / (projection[2][2]-1.0);","  zfar = projection[3][2] / (projection[2][2]+1.0);","  zrange = zfar-znear;","  depth = getDepthValue(texture2D(Texture1, vTexCoord0));","  if ( -depth < znear) {","     gl_FragColor = vec4(1.0,1.0,1.0,0.0);","     return;","  }","  normal = decodeNormal(unpack4x8To2Float(p));","  position = -vTexCoord1*depth;","  position.z = -position.z;",""," mat3 tbn = computeBasis();"," float occlusion = 0.0;"," for (int i = 0; i < NB_SAMPLES; i++) {","    vec3 vecKernel = vec3(kernel[i]);","    vecKernel[2] = max(AngleLimit,vecKernel[2]);","    vec3 sample = tbn * vec3(vecKernel);","    vec3 dir = sample;","    float w = dot(dir, normal);","    float dist = 1.0-kernel[i].w;","    w *= dist*dist*Power;","    sample = dir * float(Radius) + position.xyz;","    vec4 offset = projection * vec4(sample,1.0);","    offset.xy /= offset.w;","    offset.xy = offset.xy * 0.5 + 0.5;","    float sample_depth = getDepthValue(texture2D(Texture1, offset.xy));","    float range_check = abs(sample.z - sample_depth) < float(Radius) ? 1.0 : 0.0;","    occlusion += (sample_depth > sample.z ? 1.0 : 0.0) * range_check*w;"," }"," occlusion = 1.0 - (occlusion / float(NB_SAMPLES));"," gl_FragColor = vec4(vec3(occlusion),1.0);","}",""].join("\n"),u=new g(new m(m.VERTEX_SHADER,n+this.getDefineVertexName()),new m(m.FRAGMENT_SHADER,s+this.getDefineFragmentName()));e.setAttributeAndModes(u),this._dirty=!1}}),"osgUtil","ComposerFilterSSAO8"),e.exports=S},function(e,t,i){"use strict";var r,n=i(928),a=i(708),o=i(30),s=function(){try{r=i(2)}catch(e){o.warn("You will not be able to use osgUtil.DisplayGraph until you add jQuery in your page")}},u=function(e){this.options=e;var t=document.createElement("style");t.type="text/css",t.innerHTML=[".osgDebugSimpleTooltip {","display: none;","position: absolute;","margin-left: 10px;","border-radius: 4px;","padding: 10px;","background: rgba(0,0,0,.9);","color: #ffffff;","}",".osgDebugSimpleTooltip:before {","content: ",";","position: absolute;","left: -10px;","top: 8px;","border: 10px solid transparent;","border-width: 10px 10px 10px 0;","border-right-color: rgba(0,0,0,.9);","}"].join("\n"),document.getElementsByTagName("head")[0].appendChild(t),this.el=document.createElement("div"),this.el.className="osgDebugSimpleTooltip",document.body.appendChild(this.el);for(var i=document.querySelectorAll(this.options.selector),r=0;r<i.length;r++)i[r].addEventListener("mouseover",this.showTooltip.bind(this),!1),i[r].addEventListener("mouseout",this.hideTooltip.bind(this),!1)};u.prototype={showTooltip:function(e){if(r){var t=e.currentTarget;this.el.innerHTML=t.getAttribute("title"),this.el.style.display="block",this.el.style.left=r(t).position().left+r(t).get(0).getBoundingClientRect().width+"px",this.el.style.top=r(t).position().top+"px"}},hideTooltip:function(){this.el.style.display="none"}};var l=function(){s(),r&&(this._selectables=new window.Map,this._graphNode=new a(this._selectables),this._graphRender=new n(this._selectables),this._displayNode=!0,this._displayRenderer=!1,this._cbSelect=void 0,this._focusedElement="graph",this._idToDomElement=new window.Map,this._$svg=r("<svg width=100% height=100%></svg>"),r("body").append(this._$svg),this._css=".node {text-align: center;cursor: pointer;}.node rect {stroke: #FFF;}.edgePath path {stroke: #FFF;fill: none;}table {text-align: right;}svg {position: absolute;left: 0px;top: 0px;}.osgDebugButton {position: absolute;left: 15px;top: 15px;z-index: 5;border: 0;background: #65a9d7;background: -webkit-gradient(linear, left top, left bottom, from(#3e779d), to(#65a9d7));background: -webkit-linear-gradient(top, #3e779d, #65a9d7);background: -moz-linear-gradient(top, #3e779d, #65a9d7);background: -ms-linear-gradient(top, #3e779d, #65a9d7);background: -o-linear-gradient(top, #3e779d, #65a9d7);padding: 5px 10px;-webkit-border-radius: 7px;-moz-border-radius: 7px;border-radius: 7px;-webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;-moz-box-shadow: rgba(0,0,0,1) 0 1px 0;box-shadow: rgba(0,0,0,1) 0 1px 0;text-shadow: rgba(0,0,0,.4) 0 1px 0;color: white;font-size: 15px;font-family: Helvetica, Arial, Sans-Serif;text-decoration: none;vertical-align: middle;}.osgDebugButton:hover {border-top-color: #28597a;background: #28597a;color: #ccc;}.osgDebugButton:active {border-top-color: #1b435e;background: #1b435e;}.osgDebugSimpleTooltip .osgDebugName {font-weight: bold;color: #60b1fc;margin: 0;}.osgDebugSimpleTooltip .osgDebugDescription {margin: 0;}")};l.instance=function(){return l._instance||(l._instance=new l),l._instance},l.prototype={getColorFromClassName:a.prototype.getColorFromClassName,setCallbackSelect:function(e){this._cbSelect=e},reset:function(){r&&(this._selectables.clear(),this._$svg.empty(),this._focusedElement="scene",r(".osgDebugButton").hide())},setDisplayGraphRenderer:function(e){this._displayRenderer=e},createRenderGraph:function(e){this._graphRender.createGraph(e),this.displayGraph()},createGraph:function(e){r&&(this.reset(),this._displayNode=!!e,e&&this._graphNode.createGraph(e),this._displayRenderer?i(586).debugGraph=!0:this.displayGraph())},displayGraph:function(){if(r){if(window.d3&&window.dagreD3)return void this._createGraphApply();var e=this._createGraphApply.bind(this);r.getScript("//cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js").done(function(){r.getScript("//cdn.jsdelivr.net/dagre-d3/0.2.9/dagre-d3.min.js").done(e)})}},_createGraphApply:function(){var e=new window.dagreD3.Digraph;this._displayNode&&this._graphNode.generateNodeAndLink(e),this._displayRenderer&&this._graphRender.generateNodeAndLink(e),this.injectStyleElement(),r(".osgDebugButton").show();var t=this.renderer=new window.dagreD3.Renderer,i=window.d3.select(this._$svg.get(0)),n=i.append("g"),a=t.zoom();t.zoom(function(e,t){var i=a(e,t);return i.scale(.75).event(t),i});var o=function(e,t){return'<p class="osgDebugName">'+e+'</p><pre class="osgDebugDescription">'+t+"</pre>"},s=this._idToDomElement,l=t.drawNodes();t.drawNodes(function(e,t){var i=l(e,t);return i.attr("title",function(t){return s.set(t,this),o(t,e.node(t).description||"")}),i}),t.run(e,n),this.tooltip=new u({selector:".node"}),r(".node").click(this.onNodeSelect.bind(this)),this.focusOnGraph()},selectNode:function(e){var t=e.getInstanceID(),i=this._idToDomElement.get(t);i&&r(i).click()},onNodeSelect:function(e){var t=e.currentTarget,i=r(t.getAttribute("title"))[0].innerHTML,n=this._selectables;this.lastNode&&(this.lastNode.style.fill=this.lastColor);var a=n.get(i);a&&(this.lastNode=t.childNodes[0],this.lastColor=this.lastNode.style.fill,t.childNodes[0].style.fill="#f00",window.activeNode=a,o.info("window.activeNode is set with the node below !"),o.log(window.activeNode),o.log("\n"),this._cbSelect&&this._cbSelect(a))},focusOnScene:function(){r(".osgDebugButton").text("Access to the graph"),this._$svg.css("zIndex","-2"),this._focusedElement="scene"},focusOnGraph:function(){r(".osgDebugButton").text("Access to the scene"),this._$svg.css("zIndex","2"),r(".osgDebugSimpleTooltip").css("zIndex","3"),this._focusedElement="graph"},injectStyleElement:function(){if(!this._cssInjected){this._cssInjected=!0,r("body").append('<button class="osgDebugButton">Access to the scene</button>'),r(".osgDebugButton").click(function(){"scene"===this._focusedElement?this.focusOnGraph():this.focusOnScene()}.bind(this));var e=document.createElement("style");e.type="text/css",e.innerHTML=this._css,document.getElementsByTagName("head")[0].appendChild(e)}}},e.exports=l},function(e,t,i){"use strict";var r=i(8).vec3,n=i(8).mat4,a=i(663),o=function(e,t,i,r,n,a){this._intersectionPoints=[],this._primitiveIndex=void 0,this._ratio=0,this._maxDistance=0,this._nodePath=void 0,this._drawable=void 0,this._matrix=void 0,this._localIntersectionPoint=void 0,this._localIntersectionNormal=void 0,this._numIntersectionPoints=0,this._backface=void 0,this._i1=e,this._i2=t,this._i3=i,this._r1=r,this._r2=n,this._r3=a},s=function(){this._settings=void 0,this._primitiveIndex=0,this._d=r.create(),this._length=0,this._invLength=0,this._start=r.create(),this._end=r.create(),this._dInvX=r.create(),this._dInvY=r.create(),this._dInvZ=r.create(),this._hit=!1};s.prototype={reset:function(){this._hit=!1},set:function(e,t,i){this._settings=i,this._start=e,this._end=t,r.sub(this._d,t,e),this._length=r.length(this._d),this._invLength=0!==this._length?1/this._length:0,r.scale(this._d,this._d,this._invLength),0!==this._d[0]&&r.scale(this._dInvX,this._d,1/this._d[0]),0!==this._d[1]&&r.scale(this._dInvY,this._d,1/this._d[1]),0!==this._d[2]&&r.scale(this._dInvZ,this._d,1/this._d[2])},enter:function(e,t,i){var n=e._min,a=n[0],o=n[1],s=n[2],u=e._max,l=u[0],c=u[1],h=u[2],d=this._dInvX,p=this._dInvY,f=this._dInvZ;if(t[0]<=i[0]){if(i[0]<a)return!1;if(t[0]>l)return!1;t[0]<a&&r.scaleAndAdd(t,t,d,a-t[0]),i[0]>l&&r.scaleAndAdd(i,t,d,l-t[0])}else{if(t[0]<a)return!1;if(i[0]>l)return!1;i[0]<a&&r.scaleAndAdd(i,t,d,a-t[0]),t[0]>l&&r.scaleAndAdd(t,t,d,l-t[0])}if(t[1]<=i[1]){if(i[1]<o)return!1;if(t[1]>c)return!1;t[1]<o&&r.scaleAndAdd(t,t,p,o-t[1]),i[1]>c&&r.scaleAndAdd(i,t,p,c-t[1])}else{if(t[1]<o)return!1;if(i[1]>c)return!1;i[1]<o&&r.scaleAndAdd(i,t,p,o-t[1]),t[1]>c&&r.scaleAndAdd(t,t,p,c-t[1])}if(t[2]<=i[2]){if(i[2]<s)return!1;if(t[2]>h)return!1;t[2]<s&&r.scaleAndAdd(t,t,f,s-t[2]),i[2]>h&&r.scaleAndAdd(i,t,f,h-t[2])}else{if(t[2]<s)return!1;if(i[2]>h)return!1;i[2]<s&&r.scaleAndAdd(i,t,f,s-t[2]),t[2]>h&&r.scaleAndAdd(t,t,f,h-t[2])}return!0},intersect:function(){var e=r.create(),t=r.create(),i=r.create(),a=r.create(),s=r.create(),u=r.create();return function(l,c,h,d,p,f){if(!this._settings._limitOneIntersection||!this._hit){var g=this._d;r.sub(t,h,l),r.sub(i,c,l),r.cross(s,g,t);var m=r.dot(s,i);if(!(m>-1e-20&&m<1e-20)){var v=1/m;r.sub(a,this._start,l);var _=r.dot(s,a)*v;if(!(_<0||_>1)){r.cross(u,a,i);var b=r.dot(u,g)*v;if(!(b<0||_+b>1)){var x=r.dot(u,t)*v;if(!(x<1e-20||x>this._length)){var S=1-_-b,y=_,C=b,T=x*this._invLength,M=l[0]*S+c[0]*y+h[0]*C,w=l[1]*S+c[1]*y+h[1]*C,A=l[2]*S+c[2]*y+h[2]*C;r.cross(e,i,t),r.normalize(e,e);var E=new o(d,p,f,S,y,C);E._ratio=T,E._matrix=n.clone(this._settings._intersectionVisitor.getModelMatrix()),E._nodePath=this._settings._intersectionVisitor.getNodePath().slice(),E._drawable=this._settings._drawable,E._primitiveIndex=this._primitiveIndex,E._backface=n.determinant(E._matrix)*m<0,E._localIntersectionPoint=r.fromValues(M,w,A),E._localIntersectionNormal=r.clone(e),this._settings._lineSegIntersector.getIntersections().push(E),this._hit=!0}}}}}}}(),operatorPoint:function(){this._primitiveIndex++},operatorLine:function(){this._primitiveIndex++},operatorTriangle:function(e,t,i){this._settings._limitOneIntersection&&this._hit||this.intersect(e,t,i)},intersectPoint:function(){},intersectLine:function(){},intersectTriangle:function(){var e=r.create(),t=r.create(),i=r.create();return function(n,a,o,s,u){this._settings._limitOneIntersection&&this._hit||(this._primitiveIndex=a,r.set(e,n[3*o],n[3*o+1],n[3*o+2]),r.set(t,n[3*s],n[3*s+1],n[3*s+2]),r.set(i,n[3*u],n[3*u+1],n[3*u+2]),this.intersect(e,t,i,o,s,u))}}(),leave:function(){},apply:function(){var e=r.create(),t=r.create(),i=r.create(),n=new a;return function(r){if(r.getAttributes().Vertex){var a=r.getAttributes().Vertex.getElements(),o=this,s=function(r,n,s){if(r!==n&&r!==s&&n!==s){var u=3*r;e[0]=a[u],e[1]=a[u+1],e[2]=a[u+2],u=3*n,t[0]=a[u],t[1]=a[u+1],t[2]=a[u+2],u=3*s,i[0]=a[u],i[1]=a[u+1],i[2]=a[u+2],o.intersect(e,t,i,r,n,s)}};n.init(r,s),n.apply()}}}()},e.exports=s},function(e,t,i){"use strict";var r=i(14),n=i(450),a=i(451),o=i(91),s=i(571),u=i(660),l=i(454),c=i(8).vec4,h=i(581),d=i(584),p=function(e){o.call(this),this._state=void 0,this._camera=e,this._renderStage=void 0,this._stateGraph=void 0,this._frameStamp=void 0,this._previousCullsettings=new n,this.setDefaults()};p.debugGraph=!1,r.createPrototypeObject(p,r.objectInherit(o.prototype,{setDefaults:function(){this._state=new u(new h.ShaderGeneratorProxy),this._cullVisitor=new a,this._cullVisitor.setRenderer(this),this._stateGraph=new l,this.getCamera().setClearColor(c.create()),this.setRenderStage(new s);var e=i(666),t=this.getCamera().getOrCreateStateSet();t.setAttributeAndModes(new e.Material),t.setAttributeAndModes(new e.Depth),t.setAttributeAndModes(new e.BlendFunc),t.setAttributeAndModes(new e.CullFace)},getCullVisitor:function(){return this._cullVisitor},setCullVisitor:function(e){e&&!e.getRenderer()&&e.setRenderer(this),this._cullVisitor=e},setRenderStage:function(e){this._renderStage=e},getCamera:function(){return this._camera},setFrameStamp:function(e){this._frameStamp=e},getFrameStamp:function(){return this._frameStamp},getState:function(){return this._state},setState:function(e){this._state=e},setGraphicContext:function(e){this._state.setGraphicContext(e)},getGraphicContext:function(){return this._state.getGraphicContext()},cullAndDraw:function(){this.cull(),this.draw()},cull:function(){var e=this.getCamera(),t=e.getView();this._cullVisitor.setFrameStamp(this._frameStamp),this._cullVisitor.resetStats(),this._stateGraph.clean(),this._renderStage.reset(),this._cullVisitor.reset(),this._cullVisitor.setStateGraph(this._stateGraph),this._cullVisitor.setRenderStage(this._renderStage),this._cullVisitor.pushStateSet(e.getStateSet()),this._previousCullsettings.reset(),this._previousCullsettings.setCullSettings(this._cullVisitor),this._cullVisitor.setCullSettings(e),this._previousCullsettings.getSettingSourceOverrider()===this._cullVisitor&&this._previousCullsettings.getEnableFrustumCulling()&&this._cullVisitor.setEnableFrustumCulling(!0),this._cullVisitor.pushCameraModelViewProjectionMatrix(e,e.getViewMatrix(),e.getProjectionMatrix()),e.getBound();var r=t.getLight(),n=i(587);if(r)switch(t.getLightingMode()){case n.LightingMode.HEADLIGHT:this._cullVisitor.addPositionedAttribute(null,r);break;case n.LightingMode.SKY_LIGHT:this._cullVisitor.addPositionedAttribute(e.getViewMatrix(),r)}this._cullVisitor.pushViewport(e.getViewport()),this._renderStage.setClearDepth(e.getClearDepth()),this._renderStage.setClearColor(e.getClearColor()),this._renderStage.setClearMask(e.getClearMask()),this._renderStage.setViewport(e.getViewport()),this._cullVisitor.setDatabaseRequestHandler(this._camera.getView().getDatabasePager()),this._cullVisitor.handleCullCallbacksAndTraverse(e),this._cullVisitor.popCameraModelViewProjectionMatrix(e),this._cullVisitor.setCullSettings(this._previousCullsettings),this._cullVisitor.popViewport(),this._cullVisitor.popStateSet(),this._renderStage.sort()},draw:function(){var e=this.getState();e.resetCacheFrame(),e.resetStats(),this._renderStage.setCamera(this._camera),this._renderStage.draw(e),p.debugGraph&&(d.instance().createRenderGraph(this._renderStage),p.debugGraph=!1),this._renderStage.setCamera(void 0),e.applyDefault()}}),"osgViewer","Renderer"),e.exports=p},function(e,t,i){"use strict";var r=i(164),n=i(274),a=i(653),o=i(383),s=i(453),u=i(8).mat4,l=i(97),c=i(329),h=i(330),d=i(8).vec3,p=i(425),f=i(333),g=i(503),m=i(504),v=i(586),_=i(714),b=i(584),x=i(30),S=function(){this._camera=new n,this._camera.setName("OSGJS camera"),this._scene=new _,this._camera.setName("OSGJS Scene"),this._frameStamp=new a,this._lightingMode=void 0,this._manipulator=void 0,this._canvasWidth=0,this._canvasHeight=0,this._requestContinousUpdate=!0,this._requestRedraw=!0,this.setLightingMode(S.LightingMode.HEADLIGHT);var e=this.createRenderer(this.getCamera());e.setFrameStamp(this._frameStamp),this.getCamera().setRenderer(e),this.getCamera().setView(this)};S.LightingMode={NO_LIGHT:0,HEADLIGHT:1,SKY_LIGHT:2},S.prototype={requestRedraw:function(){this._requestRedraw=!0},requestContinuousUpdate:function(e){this._requestContinousUpdate=e},createRenderer:function(e){return new v(e)},setGraphicContext:function(e){this.getCamera().getRenderer().getState().setGraphicContext(e)},getGraphicContext:function(){return this.getCamera().getRenderer().getState().getGraphicContext()},initWebGLCaps:function(e){f.instance(e)},computeCanvasSize:function(){return function(e){var t,i;t=e.clientWidth,i=e.clientHeight,t<1&&(t=1),i<1&&(i=1);var r=this._devicePixelRatio,n=Math.floor(t*r),a=Math.floor(i*r),o=!1;return this._canvasWidth!==n&&(e.width=n,this._canvasWidth=n,o=!0),this._canvasHeight!==a&&(e.height=a,this._canvasHeight=a,o=!0),o}}(),getCanvasWidth:function(){return this._canvasWidth},getCanvasHeight:function(){return this._canvasHeight},getCanvasClientWidth:function(){return Math.ceil(this._canvasWidth/this._devicePixelRatio)},getCanvasClientHeight:function(){return Math.ceil(this._canvasHeight/this._devicePixelRatio)},getCanvasPixelRatio:function(){return this._devicePixelRatio},setUpView:function(e,t){var i=window.devicePixelRatio||1,r=t.getNumber("overrideDevicePixelRatio"),n=t.getNumber("maxDevicePixelRatio")||-1;"number"==typeof r?i=r:-1!==n&&(i=Math.min(i,n)),this._devicePixelRatio=i,this.computeCanvasSize(e);var a=e.width,o=e.height,s=a/o;if(this._camera.setViewport(new p(0,0,a,o)),this._camera.setGraphicContext(this.getGraphicContext()),u.lookAt(this._camera.getViewMatrix(),d.fromValues(0,0,-10),d.create(),d.fromValues(0,1,0)),u.perspective(this._camera.getProjectionMatrix(),Math.PI/180*55,s,1,1e3),t&&t.enableFrustumCulling&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),t&&t.debugGraph){var l=this.getCamera();b.instance().refreshGraph=function(){var e=b.instance();e.setDisplayGraphRenderer(!0),e.createGraph(l)},x.log("to refresh the graphs type in the console:\nOSG.osgUtil.DisplayGraph.instance().refreshGraph()")}},computeIntersections:function(e,t,i){return void 0===i&&(i=-1),this._lsi?this._lsi.reset():this._lsi=new m,this._origIntersect||(this._origIntersect=d.create(),this._dstIntersect=d.create()),this._lsi.set(d.set(this._origIntersect,e,t,0),d.set(this._dstIntersect,e,t,1)),this._iv?this._iv.reset():(this._iv=new g,this._iv.setIntersector(this._lsi)),this._iv.setTraversalMask(i),this._camera.accept(this._iv),this._lsi.getIntersections()},setFrameStamp:function(e){this._frameStamp=e},getFrameStamp:function(){return this._frameStamp},setCamera:function(e){this._camera=e},getCamera:function(){return this._camera},setSceneData:function(e){e!==this._scene.getSceneData()&&(this._scene.setSceneData(e),this._camera.removeChildren(),this._camera.addChild(e))},getSceneData:function(){return this._scene.getSceneData()},setDatabasePager:function(e){this._scene.setDatabasePager(e)},getDatabasePager:function(){return this._scene.getDatabasePager()},getScene:function(){return this._scene},getManipulator:function(){return this._manipulator},setManipulator:function(e){this._manipulator=e},getLight:function(){return this._light},setLight:function(e){this._light=e,this._lightingMode!==S.LightingMode.NO_LIGHT&&this._scene.getOrCreateStateSet().setAttributeAndModes(this._light)},getLightingMode:function(){return this._lightingMode},setLightingMode:function(e){this._lightingMode!==e&&(this._lightingMode=e,this._lightingMode!==S.LightingMode.NO_LIGHT?this._light||(this._light=new s):this._light=void 0)},flushDeletedGLObjects:function(e){var t=this.getGraphicContext(),i=e;i=r.flushDeletedGLBufferArrays(t,i),i=l.getTextureManager(t).flushDeletedTextureObjects(t,i),i=c.flushDeletedGLPrograms(t,i),i=h.flushDeletedGLShaders(t,i),i=o.flushDeletedGLFrameBuffers(t,i),o.flushDeletedGLRenderBuffers(t,i)},flushAllDeletedGLObjects:function(){var e=this.getGraphicContext();r.flushAllDeletedGLBufferArrays(e),l.getTextureManager(e).flushAllDeletedTextureObjects(e),c.flushAllDeletedGLPrograms(e),h.flushAllDeletedGLShaders(e),o.flushAllDeletedGLFrameBuffers(e),o.flushAllDeletedGLRenderBuffers(e)}},e.exports=S},,,,,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(10)),a=i.n(n),o=i(19),s=i.n(o),u=i(15),l=i(29),c=i(509);t.a=u.a.extend({defaults:{name:"",enable:!0,ambient:!0,volume:.5,loop:!1,snap:!1,sync:!1,distance:-1,distanceMax:-1,distanceModel:"exponential",startTime:0,position:[0,0,0],geometryUid:-1,indices:[-1,-1,-1],barycentricWeights:[0,0,0],localPosition:[0,0,0],lastComputedScenePosition:[0,0,0]},url:function(){return this.isNew()?"/i/sounds":"/i/sounds/"+this.get("uid")},getJSON:function(){return{uid:this.getUid(),enable:this.get("enable"),ambient:this.get("ambient"),volume:this.get("volume"),loop:this.get("loop"),snap:this.get("snap"),sync:this.get("sync"),distance:this.get("distance"),distanceMax:this.get("distanceMax"),distanceModel:this.get("distanceModel"),startTime:this.get("startTime"),position:this.get("position"),geometryUid:this.get("geometryUid"),indices:this.get("indices"),barycentricWeights:this.get("barycentricWeights"),localPosition:this.get("localPosition")}},getUid:function(){return(this.get("uid")||"").split("_")[0]},duplicate:function(){var e=this.clone();return this.isNew()||e.set("uid",i.i(r.uniqueId)(this.getUid()+"_")),e},isDuplicated:function(){return-1!==(this.get("uid")||"").indexOf("_")},save:function(e,t){if(!this.isNew()||this.isDuplicated())return a.a.resolve();null!=e&&"object"!=typeof e||(t=e);var i=new FormData;i.append("soundFile",this.get("files")[0]),i.append("name",this.get("name")),i.append("model",t.modelUID);var r=this;return a.a.resolve(s.a.ajax({type:"POST",url:this.url(),data:i,processData:!1,contentType:!1})).then(function(e){r.set("uid",e.uid)})}},i.i(c.a)({fileTypes:l.a.soundFiletypes,maxFileSize:l.a.maxSoundFilesize}))},,,,function(e,t,i){"use strict";var r=i(5),n=i(994),a=i(996),o=i(53),s=i(31),u=r.a.osg,l=r.a.osgGA,c=r.a.osgUtil,h=c.DelayInterpolator.prototype,d=h.reset;h.reset=function(){d.call(this),this._epsilon=.01};var p=h.set;h.set=function(){p.apply(this,arguments),this._epsilon>=0&&!this.isDone()&&o.a.draw()};var f=h.setTarget;h.setTarget=function(){this._isOrbitPan&&this._isConstrainPan||(f.apply(this,arguments),this._epsilon>=0&&!this.isDone()&&o.a.draw())};var g=h.addTarget;h.addTarget=function(){g.apply(this,arguments),this._epsilon>=0&&!this.isDone()&&o.a.draw()},h.isDone=function(e){e=e||1;for(var t=Math.abs(this._epsilon),i=0,r=this._current.length;i<r;++i)if(Math.abs(this._target[i]-this._current[i])>t*e)return!1;return!0};var m=h.update;h.update=function(e){var t=m.call(this,e);if(this._epsilon>=0)if(this.isDone())for(var i=0,r=this._current.length;i<r;++i)this._current[i]=this._target[i];else this.isDone(100)?o.a.draw():o.a.drawNoJitter();return t};var v=function(){for(var e=Math.abs(this._epsilon),t=0,i=this._current.length;t<i;++t)if(1===Math.abs(this._target[t])||Math.abs(this._target[t]-this._current[t])>e)return!1;return!0},_=function(e){e.isDone=v.bind(e)},b=function(){l.SwitchManipulator.call(this),this._boundStrategy=l.Manipulator.COMPUTE_HOME_USING_SPHERE|l.Manipulator.COMPUTE_HOME_USING_BBOX,this.init()};u.createPrototypeObject(b,u.objectInherit(l.SwitchManipulator.prototype,{init:function(){l.SwitchManipulator.prototype.setManipulatorIndex.call(this,0);var e=new a.a(this._boundStrategy);e.getRotateInterpolator()._epsilon=.1,e.getPanInterpolator()._epsilon=.1,e.getZoomInterpolator()._epsilon=.001,e.getPanInterpolator()._isOrbitPan=!0;var t=new n.a(this._boundStrategy);t.getLookPositionInterpolator()._epsilon=.1,t.getSideInterpolator()._epsilon=.001,_(t.getSideInterpolator()),t.getForwardInterpolator()._epsilon=.001,_(t.getForwardInterpolator()),t.getPanInterpolator()._epsilon=.001,_(t.getPanInterpolator()),t.getZoomInterpolator()._epsilon=.001,_(t.getZoomInterpolator()),this.addManipulator(e,"ORBIT"),this.addManipulator(t,"FPS"),void 0!==i.i(s.a)().cameraEasing&&this.setDelay(1-i.i(s.a)().cameraEasing)},getOrbitManipulator:function(){return this._manipulatorList[b.ORBIT]},getFirstPersonManipulator:function(){return this._manipulatorList[b.FPS]},setConstrainPan:function(e){this.getOrbitManipulator().getPanInterpolator()._isConstrainPan=e},isConstrainPan:function(){return this.getOrbitManipulator().getPanInterpolator()._isConstrainPan},_setManipulatorDelay:function(e,t){e.setDelay(t);var i=e._controllerList;for(var r in i){var n=i[r];void 0!==n._delay&&(n._delay=t)}},setDelay:function(e){this._setManipulatorDelay(this._manipulatorList[b.ORBIT],e),this._setManipulatorDelay(this._manipulatorList[b.FPS],e)},addManipulator:function(e,t){l.SwitchManipulator.prototype.addManipulator.call(this,e),t&&(b[t]=this.getManipulatorList().length-1)},setManipulatorIndex:function(){var e=u.vec3.create(),t=u.vec3.create();return function(i){if(i!==this.getCurrentManipulatorIndex()){var r=this.getCurrentManipulator();l.SwitchManipulator.prototype.setManipulatorIndex.call(this,i),this.setTargetAndEye(r.getTarget(e),r.getEyePosition(t))}}}(),setTargetAndEye:function(e,t){var i=this.getCurrentManipulator();this.getCurrentManipulatorIndex()===b.ORBIT?(e&&i.setTarget(e),t&&i.setEyePosition(t)):(t&&i.setEyePosition(t),e&&i.setTarget(e)),o.a.draw()},setEyePosition:function(e,t){this.getCurrentManipulator().setEyePosition(e,t),o.a.draw()},getEyePosition:function(e){return this.getCurrentManipulator().getEyePosition(e)},setTarget:function(e){this.getCurrentManipulator().setTarget(e),o.a.draw()},getTarget:function(e){return this.getCurrentManipulator().getTarget(e)},setDistance:function(e){this.getCurrentManipulatorIndex()===b.ORBIT&&(this.getCurrentManipulator().setDistance(e),o.a.draw())},getDistance:function(){return this.getCurrentManipulator().getDistance()},computeHomePosition:function(e){l.SwitchManipulator.prototype.computeHomePosition.call(this,e),o.a.draw()}}),"osgSketchfab","SwitchManipulator"),t.a=b},function(e,t,i){"use strict";var r=i(19),n=i.n(r),a=i(10),o=i.n(a),s=i(0),u=(i.n(s),i(5)),l=i(90),c=i(336),h=i(1023),d=i(1024),p=i(1026),f=i(541),g=i(156),m=u.a.osg,v=1,_=function(){m.NodeVisitor.call(this,m.NodeVisitor.TRAVERSE_PARENTS),this._material=void 0,this._manager=void 0};m.createPrototypeObject(_,m.objectInherit(m.NodeVisitor.prototype,{setManager:function(e){this._manager=e},reset:function(){this.nodePath.length=0,this._material=void 0},apply:function(e){if(!this._material){var t=e.getStateSet();t&&(this._material=this._manager.getMaterialByStateSet(t)),this._material||this.traverse(e)}}}));var b=function(e,t){m.NodeVisitor.call(this),this._manager=e,this._useVertexAlpha=t,this._stackMaterial=[]};m.createPrototypeObject(b,m.objectInherit(m.NodeVisitor.prototype,{apply:function(e){var t=e.getStateSet(),i=t&&this._manager.getMaterialByStateSet(t);if(i&&this._stackMaterial.push(i),e instanceof m.Geometry&&this._stackMaterial.length>0){var r=this._stackMaterial[this._stackMaterial.length-1];e.getVertexAttributeList().Color&&(r.set("hasVertexColor",!0),!r.get("hasVertexAlpha")&&e.userDataMap.hasVertexAlpha&&(r.set("hasVertexAlpha",!0),r.getChannels().Opacity.set("vertexAlphaEnable",this._useVertexAlpha))),e.userDataMap&&(r.set("hasPoints",e.userDataMap.hasPoints),r.set("hasTriangles",e.userDataMap.hasTriangles),r.set("hasLines",e.userDataMap.hasLines)),r.get("geometryList").push(e)}this.traverse(e),i&&this._stackMaterial.pop()}}));var x=n.a.Model.extend({initialize:function(){this._materialByStateSetID={},this._materialNames={material_:0}},getImageCollection:function(){return this._imageCollection||u.a.osg.error("ImageCollection not initialized in MaterialManager, something is wrong"),this._imageCollection},setImageCollection:function(e){this._imageCollection=e},getMatcapCollection:function(){return this._matcapCollection||u.a.osg.error("matcapCollection not initialized in MaterialManager, somewhing wrong"),this._matcapCollection},setMatcapCollection:function(e){this._matcapCollection=e},setNewMaterial:function(e,t){this.attributes[e]=t;var i=t.get("stateSetID");void 0!==i&&(this._materialByStateSetID[i]=t)},addMaterial:function(e){var t=new h.a,i=this.getImageCollection();return t.setMaterialJSON(e,i),new d.a({model:t}),this.setNewMaterial(e.id,t),t},getMaterials:function(){return this.attributes},getMaterialStateID:function(e){if(void 0!==e._materialID)return e._materialID;var t=e.getUserData();if(t)for(var i=t.length-1;i>=0;--i)if("UniqueID"===t[i].Name){e._materialID=parseInt(t[i].Value,10);break}return void 0===e._materialID&&(void 0!==e._uniqueID?e._materialID=e._uniqueID:(u.a.osg.warn("v0 StateSet detected"),e._materialID=v++)),e._materialID},getMaterialByStateSetID:function(e){return void 0!==e?this._materialByStateSetID[e]:void 0},getMaterialByStateSet:function(e){return this.getMaterialByStateSetID(this.getMaterialStateID(e))},removeMaterialByStateSetID:function(e){var t=this;i.i(s.filter)(this.attributes,function(t){return t.get("stateSetID")===e}).forEach(function(e){delete t.attributes[e.get("id")]})},removeMaterialByStateSet:function(e){var t=this.attributes;for(var i in t){if(t[i].get("stateSet")===e)return void delete t[i]}},removeUnboundMaterial:function(){var e=this.attributes;i.i(s.each)(e,function(t){t.get("stateSet")||delete e[t.get("id")]})},createMaterial:function(e,t){void 0===t&&(t=e.getOrCreateStateSet());var r=new h.a;new d.a({model:r});var n=i.i(p.a)();return r.set("id",n),r.set("stateSetID",this.getMaterialStateID(t)),r.set("name",this.getUniqueMaterialName(t.getAttributeMap().Material,t,e)),this.setNewMaterial(n,r),r},getUniqueMaterialName:function(e,t,i){var r=this._materialNames,n=e&&e.getAttribute()?e.getAttribute().getName():void 0;return void 0===n&&(n=void 0!==t.getName()?t.getName():i.getName()),void 0===n?"material_"+r.material_++:(void 0===r[n]?r[n]=0:n+="_"+r[n]++,n)},setWorkFlowMetalSpec:function(e,t){var i=this.attributes;for(var r in i)i[r].setWorkFlowMetalSpec(e,t)},setWorkFlowRoughGloss:function(e,t){var i=this.attributes;for(var r in i)i[r].setWorkFlowRoughGloss(e,t)},overrideMaterialChannels:function(e){if(!i.i(l.a)()&&e.materialShowcase){var t=e.materialDisplacement,r=e.materialDisplacementFactor,n=e.materialNormal,a=e.materialDiffuse,o=e.materialMetalness,u=e.materialRoughness,c=e.materialGlossiness,h=e.materialSpecular,d=e.materialEmissive,p=e.materialTransparency,f=e.materialCavity,g=e.materialAO,m=e.materialF0,v=e.materialNames||"main_material",_=v.split(";"),b=this;if(e.substanceDisplacement&&void 0!==t){var x=this.attributes["ae605e73-2987-4b0f-b25b-bdf1dc02e6ed"];x||(x=i.i(s.find)(this.attributes,function(e){return"Sides"===e.get("name")})),x&&this._replaceChannelURL(x.getChannels(),"Displacement",t,!0,r)}i.i(s.each)(this.attributes,function(e){if(-1!==_.indexOf(e.get("name"))){var i=e.getChannels();a&&(b._replaceChannelURL(i,"DiffuseColor",a),b._replaceChannelURL(i,"AlbedoPBR",a),b._replaceChannelURL(i,"DiffusePBR",a)),void 0!==m&&(m.length?b._replaceChannelURL(i,"SpecularF0",m):(i.SpecularF0.reset(),i.SpecularF0.setFactor(.5))),void 0!==n&&b._replaceChannelURL(i,"NormalMap",n,!0),void 0!==t&&b._replaceChannelURL(i,"Displacement",t,!0,r),void 0!==f&&b._replaceChannelURL(i,"CavityPBR",f,!0),void 0!==d&&b._replaceChannelURL(i,"EmitColor",d,!0),void 0!==p&&b._replaceChannelURL(i,"Opacity",p,!0),void 0!==g&&(b._replaceChannelURL(i,"AOPBR",g,!0),b._replaceChannelURL(i,"DiffuseIntensity",g,!0)),(h||o)&&(b._replaceChannelURL(i,"SpecularPBR",h),b._replaceChannelURL(i,"MetalnessPBR",o),e.setWorkFlowMetalSpec(Boolean(o))),(u||c)&&(b._replaceChannelURL(i,"RoughnessPBR",u),b._replaceChannelURL(i,"GlossinessPBR",c),e.setWorkFlowRoughGloss(Boolean(u)))}})}},_replaceChannelURL:function(e,t,i,r,n){var a=e[t];if(!i||!i.length)return void a.setEnable(!1);var o=this.getImageCollection(),s=o.addNewImage({url:i,name:i,width:1,height:1}),u=new f.a({image:s});a.setTextureModel(u),r&&a.setEnable(!0),a.setFactor(void 0===n?1:n)},tagMaterialWithGeometryInfo:function(e,t){var i=new b(this,t);e.accept(i)},updateTexCoordUnitList:function(){var e=this.attributes;for(var t in e)e[t].updateTexCoordUnitList()},findFirstMaterial:function(){var e=new _;return function(t){var i=t.length,r=t[i-1];if(r._mostInfluencedRig)return e.reset(),e.setManager(this),r._mostInfluencedRig.accept(e),e._material;for(var n=i-1;n>=0;--n){var a=t[n].getStateSet();if(a){var o=this.getMaterialByStateSet(a);if(o)return o}}}}(),getJSON:function(){var e={},t=this.attributes;return i.i(s.each)(t,function(t){e[t.get("id")]=t.getJSON()}),e},editorGetJSON:function(){var e={},t=this.getImageCollection(),i=this.getMatcapCollection();for(var r in this.attributes){var n=this.attributes[r].getJSON(),a=n.channels;for(var o in a){var s=a[o];if(s.texture){var u="Matcap"===o?i:t,l=u.get(s.texture.uid),c=l.get("name");s.texture.name=c,delete s.texture.uid,delete s.texture.texCoordUnit,delete s.texture.textureTarget}}e[r]={shadeless:n.shadeless,name:n.name,cullFace:n.cullFace,reflection:n.reflection,channels:a}}return e},editorSetJSON:function(e){var t=this.getImageCollection(),i=this.getMatcapCollection(),r=[];for(var n in this.attributes){var a=e[n];a&&r.push(function(e,r){for(var n=[],a=0,s=g.a.length;a<s;a++){var u=g.a[a],l=e.channels[u];if(!(!l|!l.texture)&&l.texture.name){var c="Matcap"===u?i:t,d=c.where({name:l.texture.name})[0];d?l.texture.uid=d.getUID():(e.channels[u]=void 0,n.push("texture "+l.texture.name+" not found in the current scene, skipping channel "+u+" for material "+r.get("name")))}}var p=h.a.validateJSON(e,t);return p?o.a.reject(p):(r.setMaterialJSON(e,t),o.a.resolve(n))}(a,this.attributes[n]))}return o.a.all(r)}});x.createMaterialModel=function(e){var t=new h.a;new d.a({model:t});var i=e.getName();return i&&t.set("name",i),(new c.a).setMaterialModel(t),t.setStateSet(e),t},t.a=x},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(0),n=(i.n(r),i(5)),a=i(4),o=i(15),s=i(29),u=i(156),l=i(346),c=i(541),h=i(53),d=i(139),p=i(337),f=i(92),g=n.a.osg,m=function(e){return 0===e[0]&&0===e[1]&&0===e[2]},v={CavityPBR:!0,AOPBR:!0,NormalMap:!0,Displacement:!0,BumpMap:!0},_={DiffuseIntensity:!0,DiffusePBR:!0,AlbedoPBR:!0,SpecularPBR:!0,GlossinessPBR:!0,RoughnessPBR:!0,MetalnessPBR:!0,SpecularF0:!0},b={},x=b.view=a.a.extend({initialize:function(){a.a.prototype.initialize.apply(this,arguments),this.model.on("change:enable",this.updateChannel,this),this.model.on("change:texCoordUnit",this.changeTexCoord,this),this.model.on("setFactor",this.updateChannel,this),this.model.on("setColor",this.updateChannel,this),this.model.on("setTextureModel",this.updateChannel,this),this.model.on("updateChannels",this.updateChannel,this),this.model.on("all",h.a.draw)},getStateSetContext:function(){return this.options.stateSetContext},updateChannel:function(){if(this.model.getTextureModel()){var e=this.model.get("material").get("texCoordUnitList"),t=this.model.getTexCoordUnit();e.length&&-1===e.indexOf(t)&&this.model.setTexCoordUnit(e[0])}this.getStateSetContext().updateChannel(this.model)},apply:function(){this.updateChannel()},changeTexCoord:function(){this.getStateSetContext().dirtyMaterial()}}),S=b.model=o.a.extend({defaults:function(){return{texture:void 0,color:g.vec3.fromValues(1,1,1),factor:1,enable:!0}},initialize:function(){o.a.prototype.initialize.apply(this,arguments),this.get("color")&&this.get("textureModel")&&this.set("color",void 0)},_createTextureModel:function(e,t){var n=t.get(e.uid);if(n)return new c.a(i.i(r.extend)(e,{image:n}));g.error("can't find imageModel"+e.uid)},setChannelJSON:function(e,t){if(void 0!==e.enable&&this.setEnable(e.enable),void 0!==e.factor&&this.setFactor(e.factor),e.color&&this.setColor(e.color),e.texture){var i=this._createTextureModel(e.texture,t);i?this.setTextureModel(i):this.setColor(e.color||g.vec3.fromValues(1,1,1))}},getName:function(){return this.get("name")},getEnable:function(){return this.get("enable")},getFactor:function(){return this.get("factor")},getTextureModel:function(){return this.get("textureModel")},getTexCoordUnit:function(){var e=this.get("textureModel");return e&&e.get("texCoordUnit")},getColor:function(){return this.get("color")},setEnable:function(e){return this.set("enable",e)},setFactor:function(e){return this.set("factor",e),this.trigger("setFactor")},setTextureModel:function(e){return this.set("color",void 0),this.set("textureModel",e),this.trigger("setTextureModel")},setColor:function(e){return this.set("textureModel",void 0),this.set("color",g.vec3.copy(this.get("color")||g.vec3.create(),e)),this.trigger("setColor")},setTexCoordUnit:function(e){var t=this.get("textureModel");void 0!==t&&(t.set("texCoordUnit",e),this.trigger("change:texCoordUnit"))},removeTexture:function(){this.setColor(g.vec3.ONE)},reset:function(){return this.removeTexture(),this.set("factor",1),this.trigger("updateChannels")},getJSON:function(){var e={},t=this.get("textureModel");t&&(e.texture=t.getJSON());var i=this.get("color");return i&&(e.color=i),e.factor=this.get("factor"),e.enable=this.get("enable"),e},resetTextureFormat:function(){var e=this.get("textureModel");e&&(e.set("internalFormat",u.a.getDefaultFormat(this.get("name"))),e.updateMultiresTexture())},isEffective:function(){if(!this.isActivated()||!this.get("enable"))return!1;var e=this.get("name");if(0===this.get("factor"))return!1;if(v[e]&&!this.get("textureModel"))return!1;if("Displacement"===e&&!g.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_TEXTURE_IMAGE_UNITS"))return!1;var t=this.get("color");return!(!_[e]&&t&&m(t))},isEnableEffective:function(){return!(!this.isActivated()||!this.get("enable"))&&(!!_[this.get("name")]||this.isEffective())},isActivated:function(){return!!(u.a.getShadingMask(this.get("name"))&this.getCurrentShading())},getCurrentShading:function(){var e=this.get("material").get("stateSet").getShaderGeneratorName();return e?l.a.nameMatch[e]:l.a.get("mask")},shouldDisplayGUIWarningOnDeletion:function(){if(!this.getEnable())return!1;var e=l.a.get("mask")&l.a.CLASSIC?l.a.CLASSIC:l.a.PBR;return!!(u.a.getShadingMask(this.getName())&e)},addUniforms:function(e,t){var i="u"+(t||this.get("name"))+"Factor";e[i]=g.Uniform.createFloat(i)},cacheUniforms:function(e){this._uniformFactor=e["u"+this.get("name")+"Factor"].getInternalArray(),this._valueFactor=this.isEnableEffective()?this.get("factor"):0},updateUniforms:function(){this._uniformFactor[0]=this._valueFactor},getSRGB:function(){var e=this.get("textureModel");if(!e)return!1;if(!e.getImageModel())return u.a.isSRGB(this.get("name"));var t=e.getImageModel().get("colorSpace");return"srgb"===t||"linear"!==t&&u.a.isSRGB(this.get("name"))},getShaderHash:function(){var e="",t=this.isEffective(),i=t&&this.get("textureModel");return e+=(this.isEnableEffective()?"1":"0")+(this.getSRGB()?"1":"0")+(i?i.get("texCoordUnit"):"x")}});S.validateJSON=function(e,t,i){var r=[];if(p.a.isBoolean(t.enable)||r.push(e+" enable must be a boolean"),p.a.isNumber(t.factor)||r.push(e+" factor must be a number"),void 0===t.texture&&void 0===t.color&&r.push(e+" texture or color is missing"),void 0!==t.color)p.a.isArrayNumber(t.color,3,0,1)||r.push(e+" color must be a vec3 with values in range [ 0.0, 1.0 ]");else{void 0===t.texture.internalFormat||p.a.isEnumString(t.texture.internalFormat,["RGB","RGBA","LUMINANCE","ALPHA"])||r.push(e+" internalFormat must be an enum string in values [ RGB, RGBA, LUMINANCE, ALPHA ]"),void 0===t.texture.magFilter||p.a.isEnumString(t.texture.magFilter,["LINEAR","NEAREST"])||r.push(e+" magFilter must be a enum string in values [LINEAR, NEAREST ]"),void 0===t.texture.minFilter||p.a.isEnumString(t.texture.minFilter,["LINEAR_MIPMAP_LINEAR","NEAREST_MIPMAP_NEAREST","LINEAR","NEAREST"])||r.push(e+" minFilter must be a enum string in values [LINEAR_MIPMAP_LINEAR, NEAREST_MIPMAP_NEAREST, LINEAR, NEAREST]"),void 0===t.texture.wrapS||p.a.isEnumString(t.texture.wrapS,["CLAMP_TO_EDGE","REPEAT"])||r.push(e+" wrapS must be an enum string in values [CLAMP_TO_EDGE, REPEAT] "),void 0===t.texture.wrapT||p.a.isEnumString(t.texture.wrapT,["CLAMP_TO_EDGE","REPEAT"])||r.push(e+" wrapT must be an enum string in values [CLAMP_TO_EDGE, REPEAT] "),void 0===t.texture.uid&&r.push(e+" texture must contain an uid"),p.a.isString(t.texture.uid)||r.push(e+" uid must be a string");i.get(t.texture.uid)||r.push(e+" texture uid does not exist")}return r.join("\n")};var y=S.prototype.addUniforms,C=S.prototype.cacheUniforms,T={};T.view=x.extend({initialize:function(){x.prototype.initialize.apply(this,arguments),this.model.on("change:type",this.changeType,this),this.model.on("change:invert",this.updateChannel,this),this.model.on("change:vertexAlphaEnable",this.updateChannel,this),this._isMasking="alphaMask"===this.model.getTransparency()},updateChannel:function(){var e=this.model.getTextureModel(),t=e?e.getMultiresTexture():void 0;if(t){var i=e.getImageModel(),r=(e.getImageModel().get("name")||t.getImageModel().getURL()).toLowerCase();(!1===i.get("alpha")||-1!==r.indexOf("jpg")||-1!==r.indexOf("jpeg"))&&(e.set("internalFormat",g.Texture.LUMINANCE),e.updateMultiresTexture())}x.prototype.updateChannel.call(this)},changeType:function(){var e="alphaMask"===this.model.getTransparency();if(e!==this._isMasking){this._isMasking=e;var t=this.model.getTextureModel();if(t&&t.get("magFilter")!==g.Texture.NEAREST){var i=t.get("minFilter"),r=i;e&&i===g.Texture.LINEAR_MIPMAP_LINEAR?r=g.Texture.LINEAR:e||i!==g.Texture.LINEAR||(r=this._blendFilter),r&&(t.set("minFilter",i),t.set("magFilter",i===g.Texture.LINEAR_MIPMAP_LINEAR?g.Texture.LINEAR:i),t.updateMultiresTexture())}}this.updateChannel()}});var M={alphaMask:1,alphaBlend:1,additive:1,dithering:1};T.model=S.extend({defaults:function(){var e=S.prototype.defaults.apply(this,arguments);return e.type="alphaBlend",e.invert=!1,e.vertexAlphaEnable=!1,e},getTransparency:function(){return this.get("type")},setTransparency:function(e){if(!M[e])return void g.error("Invalid transparency type given : "+e);this.set("type",e)},setChannelJSON:function(e,t){S.prototype.setChannelJSON.call(this,e,t),e.type&&this.setTransparency(e.type),void 0!==e.invert&&this.set("invert",e.invert)},getJSON:function(){var e=S.prototype.getJSON.apply(this);return e.type=this.get("type"),e.invert=this.get("invert"),e},isEffective:function(){if(!this.isActivated()||!this.get("enable"))return!1;var e=this.get("type"),t=this.get("factor"),i=this.get("textureModel"),r=!i&&!this.get("vertexAlphaEnable");return("alphaMask"!==e||0!==t&&!r)&&("alphaBlend"!==e&&"dithering"!==e||1!==t||!r)},addUniforms:function(e,t){y.call(this,e,t),e.uOpacityInvert=g.Uniform.createInt("uOpacityInvert"),e.uOpacityDithering=g.Uniform.createInt("uOpacityDithering"),e.uOpacityAdditive=g.Uniform.createInt("uOpacityAdditive")},cacheUniforms:function(e){C.call(this,e),this._uniformInvert=e.uOpacityInvert.getInternalArray(),this._uniformDithering=e.uOpacityDithering.getInternalArray(),this._uniformAdditive=e.uOpacityAdditive.getInternalArray();var t=this.isEnableEffective();this._valueInvert=t&&this.get("textureModel")&&this.get("invert")?1:0,this._valueDithering=t&&"dithering"===this.get("type")?1:0,this._valueAdditive=t&&"additive"===this.get("type")?1:0},updateUniforms:function(){this._uniformFactor[0]=this._valueFactor,this._uniformInvert[0]=this._valueInvert,this._uniformDithering[0]=this._valueDithering,this._uniformAdditive[0]=this._valueAdditive},getSRGB:function(){var e=this.get("textureModel");if(e){var t=e.getMultiresTexture();if(t&&t.getOriginalFormat&&t.getOriginalFormat()===g.Texture.ALPHA)return!1}return S.prototype.getSRGB.call(this)},getShaderHash:function(){var e=S.prototype.getShaderHash.call(this),t=this.get("type"),i=this.get("textureModel"),r=this.isEnableEffective()&&("alphaBlend"===t||"additive"===t),n=this.isEnableEffective()&&i&&i.get("internalFormat")===g.Texture.LUMINANCE;return e+(r?"1":"0")+(n?"1":"0")}}),T.model.validateJSON=function(e,t,i){var r=[],n=S.validateJSON(e,t,i);return n&&r.push(n),p.a.isEnumString(t.type,["alphaBlend","alphaMask","additive","dithering"])||r.push(e+" type must be an enum string with values in [alphaBlend, alphaMask, additive, dithering]"),p.a.isBoolean(t.invert)||r.push(e+" invert must be a boolean"),r.join("\n")};var w={};w.view=x.extend({initialize:function(){x.prototype.initialize.apply(this,arguments),this.model.on("change:occludeSpecular",this.updateChannel,this)}}),w.model=S.extend({defaults:function(){var e=S.prototype.defaults.call(this);return e.occludeSpecular=!1,e},setChannelJSON:function(e,t){S.prototype.setChannelJSON.call(this,e,t),void 0!==e.occludeSpecular&&this.set("occludeSpecular",e.occludeSpecular)},getJSON:function(){var e=S.prototype.getJSON.apply(this);return e.occludeSpecular=this.get("occludeSpecular"),e},addUniforms:function(e,t){y.call(this,e,t),e.uAOPBROccludeSpecular=g.Uniform.createInt("uAOPBROccludeSpecular")},cacheUniforms:function(e){C.call(this,e),this._uniformOcclude=e.uAOPBROccludeSpecular.getInternalArray(),this._valueOcclude=this.isEnableEffective()&&this.get("occludeSpecular")?1:0},updateUniforms:function(){this._uniformFactor[0]=this._valueFactor,this._uniformOcclude[0]=this._valueOcclude}}),w.model.validateJSON=function(e,t,i){var r=[],n=S.validateJSON(e,t,i);return n?r.push(n):(p.a.isBoolean(t.occludeSpecular)||r.push(e+" occludeSpecular must be a boolean"),r.join("\n"))};var A={};A.view=x.extend({}),A.model=S.extend({addUniforms:function(e,t){y.call(this,e,t);var i="u"+t+"Size";e[i]=g.Uniform.createFloat2(g.vec2.create(),i)},cacheUniforms:function(e){C.call(this,e),this._uniformSize=e["u"+this.get("name")+"Size"].getInternalArray(),this._mrTexture=this.get("textureModel")&&this.get("textureModel").getMultiresTexture()},updateUniforms:function(){this._uniformFactor[0]=this._valueFactor,this._uniformSize[0]=this._mrTexture?this._mrTexture.getWidth():0,this._uniformSize[1]=this._mrTexture?this._mrTexture.getHeight():0}}),A.model.validateJSON=function(e,t,i){return S.validateJSON(e,t,i)};var E={};E.view=x.extend({updateChannel:function(){x.prototype.updateChannel.call(this),this.model.updateGeometryOffsets()}}),E.model=S.extend({defaults:function(){return S.prototype.defaults.apply(this,arguments)},updateGeometryOffsets:function(){var e=g.vec3.create();return function(){var t=this.isEffective()?this.getFactor():0;if(d.a.updateMaxWorldDisplacement(t),0!==t)for(var i=this.get("material").get("geometryList"),r=0,n=i.length;r<n;++r){var a=i[r];if(!a._maxScale){for(var o=a.getWorldMatrices(),s=0,u=0,l=o.length;u<l;++u)g.mat4.getScale(e,o[u]),s=Math.max(s,e[0],e[1],e[2]);a._maxScale=s}a._displacementFactor=Math.max(a._displacementFactor||0,t/(a._maxScale||1)),a.dirtyBound()}}}(),setTextureModel:function(e){return e.get("minFilter")===g.Texture.LINEAR_MIPMAP_LINEAR&&(e.set("minFilter",g.Texture.LINEAR),e.updateMultiresTexture()),S.prototype.setTextureModel.call(this,e)},addUniforms:function(e,t){A.model.prototype.addUniforms.call(this,e,t),e.uDisplacementNormal=g.Uniform.createFloat(1,"uDisplacementNormal")},cacheUniforms:function(e){if(A.model.prototype.cacheUniforms.call(this,e),this._uniformNormal=e.uDisplacementNormal.getInternalArray(),this.isEnableEffective()){var t=d.a.getModelBoxWithoutDisplacement();t?this._valueNormal=250*this.get("factor")/t.radius():d.a.getBoxReady().then(this.cacheUniforms.bind(this,e))}else this._valueNormal=0},updateUniforms:function(){A.model.prototype.updateUniforms.call(this),this._uniformNormal[0]=this._valueNormal}}),E.model.validateJSON=function(e,t,i){return S.validateJSON(e,t,i)};var P={};P.view=x.extend({initialize:function(){x.prototype.initialize.apply(this,arguments),this.model.on("change:flipY",this.updateChannel,this)}}),P.model=S.extend({defaults:function(){var e=S.prototype.defaults.call(this);return e.flipY=!1,e},getJSON:function(){var e=S.prototype.getJSON.apply(this);return e.flipY=this.get("flipY"),e},setChannelJSON:function(e,t){S.prototype.setChannelJSON.call(this,e,t),void 0!==e.flipY&&this.set("flipY",e.flipY)},addUniforms:function(e,t){y.call(this,e,t),e.uNormalMapFlipY=g.Uniform.createInt("uNormalMapFlipY")},cacheUniforms:function(e){C.call(this,e),this._uniformFlip=e.uNormalMapFlipY.getInternalArray(),this._valueFlip=this.isEnableEffective()&&this.get("flipY")?1:0},updateUniforms:function(){this._uniformFactor[0]=this._valueFactor,this._uniformFlip[0]=this._valueFlip}}),P.model.validateJSON=function(e,t,i){var r=[],n=S.validateJSON(e,t,i);return n&&r.push(n),p.a.isBoolean(t.flipY)||r.push(e+" flipY must be a boolean"),r.join("\n")};var N={};N.view=x.extend({initialize:function(){x.prototype.initialize.apply(this,arguments),this.model.on("change:type",this.updateChannel,this)}}),N.model=S.extend({defaults:function(){var e=S.prototype.defaults.apply(this,arguments);return e.type="additive",e},getJSON:function(){var e=S.prototype.getJSON.apply(this);return e.type=this.get("type"),e},setChannelJSON:function(e,t){S.prototype.setChannelJSON.call(this,e,t),void 0!==e.type&&this.set("type",e.type)},addUniforms:function(e,t){y.call(this,e,t),e.uEmitMultiplicative=g.Uniform.createInt("uEmitMultiplicative")},cacheUniforms:function(e){C.call(this,e),this._uniformMultiply=e.uEmitMultiplicative.getInternalArray(),this._valueMultiply=this.isEnableEffective()&&"multiplicative"===this.get("type")?1:0},updateUniforms:function(){this._uniformFactor[0]=this._valueFactor,this._uniformMultiply[0]=this._valueMultiply},isEffective:function(){return!(!this.isActivated()||!this.get("enable"))&&(0!==this.get("factor")||"additive"!==this.get("type"))}}),N.model.validateJSON=function(e,t,i){var r=[],n=S.validateJSON(e,t,i);return n&&r.push(n),p.a.isEnumString(t.type,["additive","multiplicative"])||r.push(e+" type must be an enum string with values in [additive, multiplicative]"),r.join("\n")};var F,R=function(){if(F)return F;if(F=f.default.instance.getOrCreateMatcapCollection().resource,0===F.length){F.addNewImage({url:s.a.defaultMatcapUid,name:s.a.defaultMatcapUid,width:1,height:1}).set("uid",s.a.defaultMatcapUid)}return F},I={};I.view=x.extend({initialize:function(){x.prototype.initialize.apply(this,arguments),this.model.on("change:curvature",this.updateChannel,this)}}),I.model=S.extend({initialize:function(){S.prototype.initialize.apply(this,arguments),this.get("textureModel")||this.setChannelJSON({texture:{uid:s.a.defaultMatcapUid}})},defaults:function(){var e=S.prototype.defaults.call(this);return e.curvature=0,e},setTextureModel:function(e){return this.set("textureModel",e),this.trigger("setTextureModel")},setColor:function(e){return this.set("color",g.vec3.copy(this.get("color")||g.vec3.create(),e)),this.trigger("setColor")},isEffective:function(){return!(!this.isActivated()||!this.get("enable"))},addUniforms:function(e,t){y.call(this,e,t),e.uMatcapCurvature=g.Uniform.createFloat("uMatcapCurvature"),e.uMatcapColor=g.Uniform.createFloat3("uMatcapColor")},cacheUniforms:function(e){C.call(this,e),this._uniformCurvature=e.uMatcapCurvature.getInternalArray(),this._valueCurvature=this.isEnableEffective()?this.get("curvature"):0,this._uniformColor=e.uMatcapColor.getInternalArray(),this._valueColor=this.isEnableEffective()?this.get("color"):g.vec3.ONE},updateUniforms:function(){this._uniformFactor[0]=this._valueFactor,this._uniformCurvature[0]=this._valueCurvature,g.vec3.copy(this._uniformColor,this._valueColor)},setChannelJSON:function(e){S.prototype.setChannelJSON.call(this,e,R()),void 0!==e.curvature&&this.set("curvature",e.curvature)},getJSON:function(){var e=S.prototype.getJSON.apply(this);return e.curvature=this.get("curvature"),e},resetToDefaultMatcap:function(){this.setChannelJSON({texture:{uid:s.a.defaultMatcapUid}})}});var O={DiffusePBR:b,AlbedoPBR:b,SpecularPBR:b,GlossinessPBR:b,RoughnessPBR:b,MetalnessPBR:b,SpecularF0:b,CavityPBR:b,Matcap:I,DiffuseColor:b,SpecularColor:b,DiffuseIntensity:b,SpecularHardness:b,Displacement:E,NormalMap:P,AOPBR:w,BumpMap:A,EmitColor:N,Opacity:T};t.default=O},function(e,t,i){"use strict";var r=i(5),n=i(31),a=r.a.osg,o=["magFilter","minFilter","wrapS","wrapT","textureWidth","textureHeight","textureTarget","internalFormat"],s={getValidOptions:function(){return o},getOptions:function(e){var t={};return t.minFilter=e.getMinFilter(),t.magFilter=e.getMagFilter(),t.wrapT=e.getWrapT(),t.wrapS=e.getWrapS(),t.textureWidth=e.getWidth(),t.textureHeight=e.getHeight(),t.textureTarget=e.getTextureTarget(),t.internalFormat=e._internalFormat,t.imageFormat=e._imageFormat,t},setOptions:function(e,t){t.setMinFilter(e.minFilter),t.setMagFilter(e.magFilter),t.setWrapT(e.wrapT),t.setWrapS(e.wrapS),e.minFilter===a.Texture.LINEAR_MIPMAP_LINEAR&&i.i(n.a)().anisotropy&&t.setMaxAnisotropy(16),t.setInternalFormat(e.internalFormat)},createValidOptionsForMaterial:function(e){var t=s.createValidOptions(e);return t.minFilter===a.Texture.NEAREST_MIPMAP_LINEAR?(t.magFilter=a.Texture.NEAREST,t):t.minFilter===a.Texture.LINEAR_MIPMAP_LINEAR||t.minFilter===a.Texture.LINEAR?(t.magFilter=a.Texture.LINEAR,t):t.minFilter===a.Texture.NEAREST?(t.magFilter=a.Texture.NEAREST,t):t.magFilter===a.Texture.LINEAR?(t.minFilter=a.Texture.LINEAR_MIPMAP_LINEAR,t):(t.magFilter=a.Texture.NEAREST,t.minFilter=a.Texture.NEAREST,t)},createValidOptions:function(e){e||(e={});for(var t=o.length,i=0;i<t;++i){var r=o[i];"string"==typeof e[r]&&(e[r]=a.Texture[e[r]])}return e.magFilter||(e.magFilter=a.Texture.LINEAR),e.minFilter||(e.minFilter=a.Texture.LINEAR_MIPMAP_LINEAR),e.wrapS||(e.wrapS=a.Texture.REPEAT),e.wrapT||(e.wrapT=a.Texture.REPEAT),e.textureWidth||(e.textureWidth=0),e.textureHeight||(e.textureHeight=0),e.textureTarget||(e.textureTarget=a.Texture.TEXTURE_2D),e.internalFormat||(e.internalFormat=a.Texture.RGBA),e}};t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(464),a=i(86),o=i(511),s=r.a.osg,u=o.a.vrConfig,l=!1,c=function(e,t){return e._binNum-t._binNum},h=function(e,t){for(var i=t?t._parent:void 0,r=0;i;)i.stateset&&r++,i=i.parent;return r>1&&r--,e.getStateSetStackSize()-r},d={DEFAULT:0,EARLYZ_OPAQUE:1,EARLYZ_TRANSPARENT:2,OPAQUE:3,TRANSPARENT:4,EXTRA:5,SHADOWMAP:6},p={currentPass:d.DEFAULT,depth:void 0,blend:void 0,colorMask:void 0,uDrawOpaque:s.Uniform.createInt(-1,"uDrawOpaque")},f=new s.Depth(s.Depth.LESS,0,1,!0),g=new s.Depth(s.Depth.LESS,0,1,!1),m=new s.ColorMask(!1,!1,!1,!1),v=new s.ColorMask(!1,!1,!1,!0),_=new s.ColorMask(!0,!0,!0,!0),b=new s.Depth(s.Depth.EQUAL,0,1,!1),x=new s.BlendFunc,S=new s.Depth(s.Depth.LEQUAL,0,1,!1),y=new s.BlendFunc(s.BlendFunc.ONE,s.BlendFunc.ONE_MINUS_SRC_ALPHA),C=new s.BlendFunc(s.BlendFunc.ONE,s.BlendFunc.ONE),T=s.StateAttribute.OVERRIDE|s.StateAttribute.ON,M=function(){var e=new s.StateSet;e.setShaderGeneratorName("earlyZ",T);for(var t=i.i(n.a)(),r=0;r<t;r++)e.setTextureAttributeAndModes(r,s.Texture.textureNull,T);return e}(),w=new s.CullFace(s.CullFace.BACK),A=new s.CullFace(s.CullFace.FRONT),E=new s.CullFace(s.CullFace.DISABLE),P=s.RenderLeaf.prototype.drawGeometry,N=s.getOrCreateStateAttributeTypeMemberIndexFromName("SketchfabMaterial"),F=function(e,t,i){if(!i)return t.applyAttribute(E),void P.call(e,t);var r=t._attributeArray[N],n=r?r.lastApplied:void 0,a=p.currentPass,o=a===d.TRANSPARENT,u=o&&n&&!n.getAdditive()&&n.getCullFace()===s.CullFace.DISABLE;u&&t.applyAttribute(A),P.call(e,t),u&&(t.applyAttribute(w),e._geometry.drawImplementation(t))};s.RenderLeaf.prototype.drawGeometry=function(e){var t=e._attributeArray[N],i=t?t.lastApplied:void 0,r=p.currentPass;if(i){if(!i.getOpaqueEarlyZ()&&(r===d.EARLYZ_OPAQUE||r===d.OPAQUE||r===d.SHADOWMAP))return;r===d.EARLYZ_TRANSPARENT&&e.applyAttribute(i.getAdditive()?C:y)}p.depth&&e.applyAttribute(p.depth),p.blend&&e.applyAttribute(p.blend),p.colorMask&&e.applyAttribute(p.colorMask);var n=e.getLastProgramApplied().getUniformsCache().uDrawOpaque;if(void 0!==n){p.uDrawOpaque.getInternalArray()[0]=r!==d.TRANSPARENT&&r!==d.EARLYZ_TRANSPARENT?1:0,p.uDrawOpaque.apply(e.getGraphicContext(),n)}for(var a=this._geometry.getPrimitiveSetList(),o=!1,c=0,h=a.length;c<h;++c)if(a[c].getMode()>=s.primitiveSet.TRIANGLES){o=!0;break}if(l.isVR){var f=e.getGraphicContext();f.viewport(0,0,u.leftRenderWidth,u.leftRenderHeight),this._projection=l.leftProjection,this._modelView=l.leftModelView,this._view=l.leftView,F(this,e,o),f.viewport(u.leftRenderWidth,0,u.rightRenderWidth,u.rightRenderHeight),this._projection=l.rightProjection,this._modelView=l.rightModelView,this._view=l.rightView,F(this,e,o)}else F(this,e,o)};var R=function(){s.RenderStage.apply(this,arguments),this._binArraySorted=[],R.prototype.init.call(this)},I=!0;R.setHasTriangles=function(e){I=e};var O;R.setTimerGPU=function(e){O=e},R.getTimerGPU=function(){return O};var L=s.vec4.create();R.getClearColor=function(){return L},R.getDrawOpaqueUniform=function(){return p.uDrawOpaque},s.createPrototypeObject(R,s.objectInherit(s.RenderStage.prototype,{constructor:R,init:function(){return s.RenderStage.prototype.init.call(this),this._binArraySorted.length=0,this._renderBufferDepth=void 0,this},isMainCamera:function(){var e=this.getCamera();return!(!e||"PostProcess - MainCamera"!==e.getName())},isShadowCasterCamera:function(){var e=this.getCamera();return!!(e&&e.getName()&&e.getName().startsWith("light_shadow_camera"))},sortBinArray:function(){var e=this._binArraySorted;e.length=0;for(var t in this._bins)e.push(this._bins[t]);e.sort(c)},drawTransparentBin:function(e,t){for(var i,r=t,n=this._binArraySorted,o=0,s=n.length;o<s;o++){i=n[o];var u=i.getBinNumber();if(u===a.a.TRANSPARENT_BIN)r=i.draw(e,r);else if(p.currentPass!==d.EARLYZ_TRANSPARENT&&(u===a.a.TRANSPARENT_BIN_NO_EARLYZ_POST||u===a.a.TRANSPARENT_BIN_NO_EARLYZ_PRE)){var l=p.depth;p.depth=void 0,r=i.draw(e,r),p.depth=l}}return r},drawOpaqueBin:function(e,t){for(var i,r=this.getDoEarlyZ(),n=t,o=this._binArraySorted,s=0,u=o.length;s<u&&(i=o[s],!(i.getBinNumber()>0));s++)n=i.draw(e,n);for(n=this.drawLeafs(e,n);s<u;s++){i=o[s];var l=i.getBinNumber();if(l===a.a.OPAQUE_BIN||l===a.a.TRANSPARENT_BIN&&r)n=i.draw(e,n);else if(p.currentPass===d.OPAQUE&&l===a.a.BACKGROUND){var c=p.depth;p.depth=void 0,n=i.draw(e,n),p.depth=c}}return n},drawExtraBin:function(e,t){for(var i,r=t,n=this._binArraySorted,o=0,s=n.length;o<s;o++){i=n[o];i.getBinNumber()>=a.a.EXTRA&&(r=i.draw(e,r))}return r},bindDepthRTT:function(e){this.getCamera().frameBufferObjectDepth.apply(e)},bindTransparencyRTT:function(e){this.getCamera().frameBufferObjectTransparent.apply(e)},bindOpaqueRTT:function(e){this.getCamera().frameBufferObjectOpaque.apply(e)},bindExtraRTT:function(e){this.getCamera().frameBufferObjectExtra.apply(e)},createFBO:function(e,t){if(t){var i=this.getViewport(),r=new s.FrameBufferObject;r.createFrameBufferObject(e),r.bindFrameBufferObject();var n=this._renderBufferDepth;return n||(n=r.createRenderBuffer(s.FrameBufferObject.DEPTH_COMPONENT16,i.width(),i.height()),this._renderBufferDepth=n),r.framebufferRenderBuffer(s.FrameBufferObject.DEPTH_ATTACHMENT,n),r.framebufferTexture2D(e,s.FrameBufferObject.COLOR_ATTACHMENT0,s.Texture.TEXTURE_2D,t),r.checkStatus(),r}},drawOpaqueShading:function(e,t){p.currentPass=d.OPAQUE,p.depth=this.getDoEarlyZ()?b:f,p.blend=x;var i=this.drawOpaqueBin(e,t);return p.blend=void 0,p.depth=void 0,p.currentPass=d.DEFAULT,i},drawEarlyOpaque:function(e,t){p.currentPass=d.EARLYZ_OPAQUE,p.depth=f,p.blend=x,p.colorMask=this.isWritingDepth()?_:m;var i=this.drawOpaqueBin(e,t);return p.colorMask=void 0,p.blend=void 0,p.depth=void 0,p.currentPass=d.DEFAULT,i},drawEarlyAlpha:function(e,t){p.currentPass=d.EARLYZ_TRANSPARENT,p.depth=g,p.colorMask=v;var i=this.drawTransparentBin(e,t);return p.colorMask=void 0,p.depth=void 0,p.currentPass=d.DEFAULT,i},drawTransparentShading:function(e,t){p.currentPass=d.TRANSPARENT,p.depth=S,p.blend=y;var i=this.drawTransparentBin(e,t);return p.blend=void 0,p.depth=void 0,p.currentPass=d.DEFAULT,i},drawExtra:function(e,t){p.currentPass=d.EXTRA;var i=this.drawExtraBin(e,t);return p.currentPass=d.DEFAULT,i},isWritingDepth:function(){return!!this.getCamera()._textureDepth},getDoEarlyZ:function(){return I||this.isWritingDepth()},drawImplementationSketchfab:function(e,t){var i=e.getGraphicContext(),r=t,n=this.getCamera(),a=!!n._textureDepth;if(a?(this.bindDepthRTT(e),i.clearColor(1,1,1,0)):(this.bindOpaqueRTT(e),i.clearColor(L[0],L[1],L[2],L[3])),i.depthMask(!0),i.clearDepth(this.clearDepth),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),this.getDoEarlyZ()){var o=h(e,r);e.insertStateSet(o,M),O.start("EarlyOpaque"),r=this.drawEarlyOpaque(e,r),O.end("EarlyOpaque"),a&&n._textureTransparent&&(O.start("EarlyTransparency"),r=this.drawEarlyAlpha(e,r),O.end("EarlyTransparency")),e.removeStateSet(o),e.applyAttribute(_)}return a&&(this.bindOpaqueRTT(e),i.clearColor(L[0],L[1],L[2],L[3]),i.clear(i.COLOR_BUFFER_BIT)),O.start("ShadingOpaque"),r=this.drawOpaqueShading(e,r),O.end("ShadingOpaque"),i.clearColor(0,0,0,0),n._textureTransparent&&(this.bindTransparencyRTT(e),i.clear(i.COLOR_BUFFER_BIT),O.start("ShadingTransparency"),r=this.drawTransparentShading(e,r),O.end("ShadingTransparency")),n._textureExtra&&(this.bindExtraRTT(e),i.clear(i.COLOR_BUFFER_BIT),O.start("Extra"),r=this.drawExtra(e,r),O.end("Extra")),r},drawImplementation:function(e,t){if(!this.isMainCamera()){this.isShadowCasterCamera()&&(p.currentPass=d.SHADOWMAP);var i=s.RenderStage.prototype.drawImplementation.call(this,e,t);return p.currentPass=d.DEFAULT,i}var r=this.getCamera();if(!r._textureOpaque)return t;r.frameBufferObjectOpaque||(r.frameBufferObjectOpaque=this.createFBO(e,r._textureOpaque)),r.frameBufferObjectTransparent||(r.frameBufferObjectTransparent=this.createFBO(e,r._textureTransparent)),r.frameBufferObjectDepth||(r.frameBufferObjectDepth=this.createFBO(e,r._textureDepth)),r.frameBufferObjectExtra||(r.frameBufferObjectExtra=this.createFBO(e,r._textureExtra)),void 0===this.viewport&&s.log("RenderStage does not have a valid viewport"),e.applyAttribute(this.viewport),0!==this.positionedAttribute.length&&this.applyPositionedAttribute(e,this.positionedAttribute),this.sortBinArray();var n=t;return O.start("Shading"),n=this.drawImplementationSketchfab(e,n),O.end("Shading"),n}})),s.RenderBin.prototype.drawLeafs=function(e,t){for(var i,r=this.stateGraphList,n=this._leafs,a=t,o=this.getStage().viewport,s=e.getGraphicContext(),u=0,c=n.length;u<c;u++)i=l=n[u],!i.isVR&&a&&a.isVR&&s.viewport(o._x,o._y,o._width,o._height),i.render(e,a),a=i;for(var h=0,d=r.length;h<d;h++)for(var p=r[h],f=0,g=p.leafs.length;f<g;f++)i=l=p.leafs[f],!i.isVR&&a&&a.isVR&&s.viewport(o._x,o._y,o._width,o._height),i.render(e,a),a=i;return a},t.a=R},function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=[0,0],o=function(e,t){if(t=t||a,e.center||e.touches){var i=e.center?e.center.x:e.touches[0].clientX,r=e.center?e.center.y:e.touches[0].clientY;t[0]=i-n()(e.target).offset().left+(window.scrollX||0),t[1]=r-n()(e.target).offset().top+(window.scrollY||0)}else t[0]=void 0===e.offsetX?e.layerX:e.offsetX,t[1]=void 0===e.offsetY?e.layerY:e.offsetY;return t};t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(31),a=r.a.osg,o=function(e){var t=a.WebGLCaps.instance().getWebGLParameter("MAX_TEXTURE_SIZE"),r=i.i(n.a)().maxTextureSize,o=void 0===e?1/0:e;return Math.min(t,r,o)};t.a=o},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=!1,o=n.Timer.prototype.tick,s=function(){this.children=[],this.timerMessage="",this.message="",this.start=o(),this.parent=this},u={},l={},c=new s,h=c;n.time=function(e){var t=u[e]=new s;h.children.push(t),t.parent=h,h=t,t.timerMessage=e},n.timeEnd=function(e){var t=u[e];h=t.parent||c,t.message=e+" : "+(o()-t.start).toFixed(2)+"ms",a&&l.showMessage()};var d=function(e,t){var i=e.children,r="";e!==c&&i.length>0&&(r=t+e.timerMessage+"\n");for(var n=e===c?"":"  |  ",a=0;a<i.length;++a)r+=d(i[a],t+n)+"\n";var o=e.parent===c&&e.timerMessage?"\n":"";return r+(t+e.message)+o};l.showMessage=function(){console.log("%c"+d(c,""),"color:purple"),a=!0,c.children.length=0},l.logBound=function(e){var t=e.center(n.vec3.create()),i="Bound center : [ "+t[0]+", "+t[1]+", "+t[2]+" ]\n";i+="Bound radius : "+e.radius()+"\n";var r=e.getMin(),a=e.getMax();i+="Bbox min : [ "+r[0]+", "+r[1]+", "+r[2]+" ]\n",i+="Bbox max : [ "+a[0]+", "+a[1]+", "+a[2]+" ]\n",l.logMessage(i)},l.logMessage=function(e){var t=new s(!0);t.message=e,h.children.push(t),t.parent=h},t.a=l},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a={};a.base64=function(e,t){return"data:"+e+";base64,"+t},a.isMobile=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},a.isFirefox=function(){return/firefox/i.test(navigator.userAgent)},a.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},a.isIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},a.appendQueryParameter=function(e,t,i){return e+=(e.indexOf("?")<0?"?":"&")+t+"="+i},a.getQueryParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},a.isLandscapeMode=function(){return 90===window.orientation||-90===window.orientation},a.getScreenWidth=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},a.getScreenHeight=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},a.projectionMatrixToVector_=function(e,t){var i=t||{},r=i.xScale||1,a=i.yScale||1,o=i.xTrans||0,s=i.yTrans||0,u=n.vec4.create();return u[0]=e[0]*r*.5,u[1]=e[5]*a*.5,u[2]=.5*(e[8]-1-o),u[3]=.5*(e[9]-1-s),u},a.leftProjectionVectorToRight_=function(e){return n.vec4.fromValues(e[0],e[1],-e[2]-1,e[3])},t.a=a},,,,,,,,,,,,,,,,function(e,t,i){e.exports=i.p+"sketchfab-logo-8bc6696c7ed7369e1acaee4ec5168169.png"},function(e,t,i){e.exports=i.p+"sketchfab-logo-white-23404398f711fe3ef715025c76e98bd2.svg"},function(e,t,i){"use strict";var r=i(980),n=i(993),a=i(1021),o=i(1074),s=i(1065),u=i(984),l=i(1041),c=i(1004),h=i(1046),d=i(988),p=i(1013),f=i(1017),g=i(1059),m=i(1117),v=i(1095);t.a=[r.a,n.a,a.a,o.a,s.a,u.a,l.a,c.a,h.a,d.a,p.a,f.a,g.a,m.a,v.a]},,,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(2)),a=i.n(n),o=i(70),s=i.n(o),u=i(419),l=i.n(u),c=i(4),h=i(16),d=i(137),p=i(90),f=i(85),g=i(6),m=i(493),v=i(65),_=i(1128),b=i(1134),x=i(1132),S=i(1129),y=i(1130),C=i(1137),T=i(1131),M=i(1133),w=i(558),A=i(1135),E=i(1139),P=i(1138),N=i(46),F=i(1071),R=i(726),I=i(31),O=i(515),L=i(476),D=i(29),k=i(441),B=(i.n(k),D.a.shortcuts),V=new l.a({device:"WEB",listen:!0});t.a=c.a.extend({subviews:{},events:{'click [data-action="start"]':"onStart",'click [data-action="stop"]':"onStop",click:"globalCloseEvent",touchend:"globalCloseEvent"},templates:{viewerMode:g.default.getFromMacro("skfb_front/macros/viewer","help_viewer_mode"),viewerVr:g.default.getFromMacro("skfb_front/macros/viewer","help_vr_mode")},initialize:function(){c.a.prototype.initialize.apply(this,arguments),this.proxySettings=new v.a({shadingStyle:null,viewerMode:null,wireframeColor:null,wireframeEnable:null,hasWireframe:null,annotationsVisible:null,textureQuality:null,speed:null,cycleMode:null,fps:null}),this.initializeMandatorySubviews(),this.initializeHashMessages(),this.initializeSoundManager(),this.delegateGlobalMoveEvent(),this.delegateSubviews(),this.isVR()&&s.a.apple.device&&this.hackIosCanvasRender()},_createSubview:function(e,t,n){return this.subviews[e]=new t(i.i(r.extend)({},{viewer:this,widgets:this.subviews},n)),this.subviews[e]},globalCloseEvent:function(e){a()(e.target).hasClass("has-menu")||a()(e.target).parents(".has-menu").length||a()(e.target).hasClass("js-pointable")||a()(e.target).parents(".js-pointable").length||(this.subviews.hotspots&&this.subviews.hotspots.toggleAnnotationList(null,!1),this.subviews.gui.closeMenus())},delegateGlobalMoveEvent:function(){var e=function(e){"canvas"===e.target.tagName.toLowerCase()&&(clearTimeout(this._showGuiTimeout),clearTimeout(this._hideGuiTimeout),this._hideGuiTimeout=setTimeout(function(){this.$el.addClass("moving")}.bind(this),150))},t=function(e){"canvas"===e.target.tagName.toLowerCase()&&(clearTimeout(this._hideGuiTimeout),clearTimeout(this._showGuiTimeout),e.preventDefault(),this._showGuiTimeout=setTimeout(function(){this.$el.hasClass("moving")&&this.$el.removeClass("moving")}.bind(this),500))},n=function(e){var t=e.relatedTarget||e.toElement;s.a.any||(clearTimeout(this.globalIdleTimeout),this.$el.find(t).length||(this.globalIdleTimeout=setTimeout(this.onGlobalIdleTimeout.bind(this),3500)))},o=function(){clearTimeout(this.globalIdleTimeout),(this.$el.hasClass("idle")||this.$el.hasClass("moving"))&&(this.$el.removeClass("idle moving"),i.i(r.each)(this.subviews,function(e){e.trigger("idle",!1)}))};if(!i.i(p.a)()){var u;this.$el.on("touchmove",this.preventScroll.bind(this)),this.$el.on("mousedown touchstart",e.bind(this)),this.$el.on("mouseup touchend",t.bind(this)),this.$el.on("mousewheel",function(e){"canvas"===e.target.tagName.toLowerCase()&&(this.$el.addClass("moving"),clearTimeout(u),u=setTimeout(function(){this.$el.removeClass("moving")}.bind(this),300))}.bind(this)),a()(this.el).on("mouseout",n.bind(this)),a()(this.el).on("mouseenter mousein",o.bind(this))}},preventScroll:function(e){!this.subviews||!this.subviews.helpOverlay||this.subviews.helpOverlay.isVisible()||a()(e.target).hasClass("js-pointable")||a()(e.target).parents(".js-pointable").length||e.preventDefault()},onGlobalIdleTimeout:function(){i.i(p.a)()||(this.$el.addClass("idle"),i.i(r.each)(this.subviews,function(e){e.trigger("idle",!0)}))},initializeMandatorySubviews:function(){this._createSubview("gui",_.a,{el:this.$el}),this._createSubview("loading",b.a,{el:this.$(".loading-container")}),this._createSubview("hint",x.a,{el:this.$el,fallback:!i.i(d.a)()}),this._createSubview("generalControls",S.a,{el:i.i(d.a)()?this.$(".general-controls"):this.$(".fallback .controls"),fallback:!i.i(d.a)()}),this._createSubview("header",y.a,{el:this.$(".titlebar")}),this._createSubview("snapshot",C.a,{el:this.$el}),this._createSubview("helpOverlay",T.a,{el:this.$(".help.overlay")}),this._createSubview("hotspotsOverlay",M.a,{el:this.$(".hotspots-overlay")}),this._createSubview("helperVrOverlay",w.a.extend({setUrl:function(e){this.$(".url").attr("href",e).text(e)}}),{el:this.$(".helper-vr-overlay")}),this._createSubview("osd",A.a,{el:this.$el})},initShortcuts:function(){this.viewerRenderingShortcuts=new m.a(B.viewerRendering),this.viewerRenderingShortcuts.on("toggleWireframe",function(){this.proxySettings.get("hasWireframe")&&this.proxySettings.set("wireframeEnable",!this.proxySettings.get("wireframeEnable"))}.bind(this)),this.viewerRenderingShortcuts.listen([this.viewerRenderingShortcuts.getShortcut("toggleWireframe")]),this.viewerRenderingShortcuts.on("defaultRenderingMode",function(){this.proxySettings.set("shadingStyle","lit")}.bind(this)),this.viewerRenderingShortcuts.on("shadelessRenderingMode",function(){this.proxySettings.set("shadingStyle","shadeless")}.bind(this)),this.viewerRenderingShortcuts.on("matcapRenderingMode",function(){this.proxySettings.set("shadingStyle","matcap")}.bind(this)),this.updateShorcuts()},updateShorcuts:function(){"lit"===this._currentModel.get("options").shading.type||i.i(p.a)()?this.viewerRenderingShortcuts.listen([this.viewerRenderingShortcuts.getShortcut("defaultRenderingMode"),this.viewerRenderingShortcuts.getShortcut("shadelessRenderingMode"),this.viewerRenderingShortcuts.getShortcut("matcapRenderingMode")]):this.viewerRenderingShortcuts.stopListening(["defaultRenderingMode","shadelessRenderingMode","matcapRenderingMode"])},blurHotspots:function(){this.subviews.hotspots&&(this.subviews.hotspots.hideTooltips(),this.subviews.hotspots.currentHotspot=-1,this.subviews.hotspots.renderControl())},initializeHashMessages:function(){i.i(I.a)().isApp&&V.on("message:vrMode",function(e){var t=parseInt(e.data.vrMode,10);this.blurHotspots(),this.scene.getFeatures().webVR.getModel().set("enable",!!t),e.removeFromHash()}.bind(this))},initializeHotspotsSubviews:function(e){i.e(8).then(function(){var t=i(1505).default;this._createSubview("hotspots",t,{el:this.$el,container:this.$(".hotspots"),fallback:!i.i(d.a)()}),"function"==typeof e&&e()}.bind(this).bind(null,i)).catch(i.oe)},initializeAnimationSubviews:function(e){i.e(10).then(function(){var t=i(1504).default,r=this.scene.getFeatures().animation.getModel();this._createSubview("animationControls",t,{el:this.$(".animation-controls"),model:r,currentModel:this._currentModel}),"function"==typeof e&&e()}.bind(this).bind(null,i)).catch(i.oe)},delegateSubviews:function(){this.isCardboard()?(this.subviews.gui.disable(),this.subviews.header.disable()):(this.subviews.loading.on("loaded",setTimeout.bind(window,this.subviews.gui.enable.bind(this.subviews.gui),500)),this.subviews.header.enable()),this.subviews.loading.on("loaded",function(){i.i(I.a)().transparent||this.$el.addClass("transparent-pattern")}.bind(this))},onStart:function(){this.start(),this._startTracked||(this._startTracked=!0)},start:function(e){return this.$el.addClass("started"),!0===e?h.a.modelEmbedAutostart(this._currentUid):h.a.modelEmbedPlayButtonClicked(this._currentUid),this.$el.hasClass("transparent")||this.$el.addClass("transparent-pattern"),this._options&&this.load(),this.scene&&this.scene.getViewerOSGJS&&this.scene.getViewerOSGJS().done()&&(this.scene.getViewerOSGJS().setDone(!1),this.scene.getViewerOSGJS().run()),L.a.enter(),this.trigger("started"),this},onStop:function(){this.stop()},stop:function(){var e=this._currentModel?this._currentModel.get("uid"):this._currentUid;return h.a.modelEmbedStopButtonClicked(e),this.$el.removeClass("started"),this.scene.getViewerOSGJS&&this.scene.getViewerOSGJS().setDone(!0),this.subviews.hotspots&&this.subviews.hotspots.triggerHotspotCycle(!1),L.a.exit(),this.trigger("started"),this},load:function(){if(this._options){var e=this._options;this._options=null,this.scene&&(this.scene.drop(),this.scene=null),this.subviews.loading.reset(),this.$el.removeClass("model-loaded"),this.$el.addClass("model-loading"),v.a.get(e.uid).then(this.onModelLoad.bind(this,e))}},lookat:function(e,t,i){void 0===i&&(i=1);var r=this.scene.getFeatures(),n=r.camera.getModel();n.set("animationDuration",i),n.setTargetAndEye(t,e)},isVR:function(){return this.scene?this.scene.getFeatures().webVR.getModel().get("enable"):i.i(I.a)().cardboard>0},isCardboard:function(){return i.i(I.a)().cardboard>0},onModelLoad:function(e,t){this._currentModel=t,t.hit();var r=this.scene=this.createScene(t,e);if(this.subviews.loading.handleLoading({model:t,scene:r}),r.run(),!i.i(d.a)())return void this.$el.addClass("fallback-mode");this.initShortcuts(),this.initViewerFeatures();var n=this.scene.getFeatures();this._createSubview("unsupportedAnimation",E.a,{el:this.$(".animation-not-supported"),model:n.animation.getModel()}),this.subviews.hint.show(),this.trigger("model-loaded")},setScene:function(e){if(this.scene)throw new Error("It is currently impossible to reset a scene");return this._options=e,this._currentUid=e.uid,this},createScene:function(e,t){if(i.i(d.a)()){var r={};return r.el=this.$(".webgl"),r.features=t.features,r.widgetAPI=t.widgetAPI,r.model=e,r.viewerAPI=t.viewerAPI,N.a.getPolygon().then(function(e){h.a.modelViewerPolygonLoaded(e.time)}),N.a.getWireframe().then(function(e){h.a.modelViewerWireframeLoaded(e.time)}),N.a.getLowResLoaded().then(function(e){h.a.modelViewerLowResTexturesLoaded(e.time,e.count)}),N.a.getHighResLoaded().then(function(e){h.a.modelViewerHighResTexturesLoaded(e.time,e.count)}),N.a.getModelDisplayed().then(function(e){h.a.modelViewerModelDisplayed(e.time)}),new R.a(r)}return h.a.modelViewerFallbackDisplayed(e.get("uid")),new F.a({model:e,el:this.$(".fallback"),features:t.features})},initViewerFeatures:function(){this.initializeSound(),N.a.getModelDisplayed().then(function(){N.a.getHasAnimation().then(function(e){e&&this.initializeAnimation()}.bind(this)),this.initializeHotspots(),this.initializeShadingStyle(),this.initializeViewerMode(),this.initializeTextureQuality(),this.initializeVr()}.bind(this))},getHotspotModel:function(){var e=this.scene.getFeatures().hotspot;return e&&e.getModel()},initializeHotspots:function(){var e=this.getHotspotModel();e&&this.initializeHotspotsSubviews(function(){var t=this.subviews.hotspots;e.setUpdateCallback(t.refreshHotspots.bind(t));var n=e.get("hotspots");n.on("add remove sort change:title change:description change:position",t.refreshHotspots,t),n.on("add remove sort change:name",t.updateHotspotsControls,t),n.on("add remove",i.i(r.debounce)(this.subviews.generalControls.renderSettings,100),this.subviews.generalControls),n.on("select",t.onHotspotSelected,t),n.on("add",t.showAnnotations,t),n.on("remove",function(){0===n.length&&t.hideAnnotations()}),this.proxySettings.on("change:annotationsVisible",function(){n.length&&this.proxySettings.get("annotationsVisible")?t.showAnnotations():t.hideAnnotations()}.bind(this)),this.proxySettings.set("annotationsVisible",e.get("visible")),t.updateHotspotsControls(),N.a.getFirstCameraAnimation().then(function(){t.refreshHotspots(),e.on("hotspot-error",this.subviews.osd.show.bind(this.subviews.osd)),i.i(I.a)().annotation>0&&n.trigger("select",n.at(i.i(I.a)().annotation-1)),!0===i.i(I.a)().annotationCycleAutostart&&(this.subviews.hotspots.trackHotspotCycle(!0),this.subviews.hotspots.triggerHotspotCycle(!0))}.bind(this))}.bind(this))},initializeAnimation:function(){var e=this.scene.getFeatures().animation,t=e.getModel();this.initializeAnimationSubviews(function(){this.$el.addClass("has-animation"),this.subviews.generalControls.setHasAnimations(!0),this.proxySettings.set("speed",t.get("speed")),this.proxySettings.set("cycleMode",t.get("cycleMode")),this.proxySettings.set("fps",t.get("fps")),this.proxySettings.on("change:speed",function(e,i){t.set("speed",i)}),this.proxySettings.on("change:cycleMode",function(e,i){t.set("cycleMode",i)}),this.proxySettings.on("change:fps",function(e,i){t.set("fps",i)}),t.on("change:fps",function(e,t){this.proxySettings.set("fps",t)}.bind(this)),this.$(".osd").addClass("padded"),this.$(".timeline").removeClass("disabled")}.bind(this))},initializeTextureQuality:function(){var e=this,t=this.scene.getFeatures().quality;if(t){var i=t.getModel();i.get("promiseReady").then(function(e){this.subviews.generalControls.generateTextureQualitySettings(e),this.subviews.generalControls.settings.onTextureQualityReady.call(this.subviews.generalControls.settings,e)}.bind(this)),this.proxySettings.on("change:textureQuality",function(){var t=parseInt(this.get("textureQuality"),10);window.requestAnimationFrame(function(){i.set("level",t)});var r=e.subviews.generalControls.getSettingLabelForValue("textureQuality",t+"");e.$(".control-badge").text(r).addClass("active")})}},initializeViewerMode:function(){var e=this.scene.getFeatures().camera;if(e){var t=e.getModel(),i=t.get("indexManipulator");this.proxySettings.set("viewerMode",i),this.subviews.gui.renderSetting("viewerMode",i),this.proxySettings.on("change:viewerMode",function(){t.set("indexManipulator",parseInt(this.proxySettings.get("viewerMode"),10)),this.scene.getFeaturesManager().focusOnSavedCamera(1),this.$("canvas").focus()}.bind(this))}},initializeShadingStyle:function(){var e=this.scene.getFeatures().shadingStyle;if(e){var t=e.getModel(),i=this,r=function(){i.proxySettings.set("shadingStyle",t.get("style")),i.proxySettings.set("wireframeColor",t.get("wireframeColor")),i.proxySettings.set("wireframeEnable",t.get("wireframeEnable")),i.proxySettings.set("hasWireframe",t.get("hasWireframe")),i.subviews.gui.renderSetting("wireframeColor",i.proxySettings.get("wireframeColor")),i.subviews.gui.renderSetting("wireframeEnable",i.proxySettings.get("wireframeEnable")?1:0),i.subviews.gui.renderSetting("shadingStyle",i.proxySettings.get("shadingStyle")),i.subviews.gui.renderSetting("hasWireframe",i.proxySettings.get("hasWireframe")?1:0)};r(),this.proxySettings.listenTo(t,"change",r),this.proxySettings.on("change:shadingStyle",function(){t.set("style",this.get("shadingStyle"))}),this.proxySettings.on("change:wireframeColor",function(){this.get("wireframeEnable")?t.setWireframeColorSmooth(this.get("wireframeColor")):t.set("wireframeColor",this.get("wireframeColor"))}),this.proxySettings.on("change:wireframeEnable",function(){t.set("wireframeEnable",!!this.get("wireframeEnable"))}),this.listenTo(t,"nextBlendingShader",function(e){var t={};t[O.a.MATCAP|O.a.WIREFRAME]="Matcap + Wireframe",t[O.a.MATCAP|O.a.GEOMETRY|O.a.WIREFRAME]="Matcap + Normal + Wireframe",t[O.a.DEFAULT&~O.a.DIFFUSE]="No diffuse",t[O.a.DEFAULT]="Default",this.subviews.osd.show(t[e],{duration:5e3,position:"top",style:"compact"})}.bind(this))}},initializeVr:function(){if(this.isVR()){this.$el.addClass("vr-mode");if(1===f.a.get("show_vr_hint",1)){var e=this.templates.viewerVr([this.subviews.generalControls.hasFullscreen()]);this.subviews.osd.show(e,{duration:8e3})}f.a.set("show_vr_hint",0,{expires:504e5,path:"/"})}},initializeSoundManager:function(){this.proxySettings.on("sound-error",this.subviews.osd.show.bind(this.subviews.osd)),this.proxySettings.on("hide-sound-error",this.subviews.osd.hide.bind(this.subviews.osd)),this.proxySettings.on("requestTapForSound",this.subviews.osd.show.bind(this.subviews.osd)),this.proxySettings.on("stopRequestTapForSound",this.subviews.osd.hide.bind(this.subviews.osd)),L.a.setModel(this.proxySettings)},initializeSound:function(){var e=this.scene.getFeatures().sound;if(e){var t=e.getModel(),i=t.get("soundtracks"),r=this._createSubview("sound",P.a,{el:this.$(".general-controls .volume"),model:t});i.on("add",r.show,r),i.on("remove",function(){0===i.length&&r.hide()}),i.length&&t.get("visible")&&r.show(),t.on("sound-error",this.subviews.osd.show.bind(this.subviews.osd))}},hackIosCanvasRender:function(){i.i(r.defer)(function(){a()("canvas")[0].style.width=a()("canvas")[0].clientWidth+1+"px",i.i(r.defer)(function(){a()("canvas")[0].style.width=a()("canvas")[0].clientWidth-1+"px",a()("canvas")[0].style.width=""})})}})},,,,function(e,t){!function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/hotspot.jinja"]=function(){function e(e,t,i,r,n){var a=null,o=null;try{var s=null,u=r.makeMacro([],["options"],function(n){var s=i;i=new r.Frame,n=n||{},n.hasOwnProperty("caller")&&i.set("caller",n.caller),i.set("options",n.hasOwnProperty("options")?n.options:{});var u="";u+="\n";var l;l=30,i.set("width_before",l,!0),i.topLevel&&t.setVariable("width_before",l),i.topLevel&&t.addExport("width_before",l),u+="\n";var c;c=960,i.set("width_next",c,!0),i.topLevel&&t.setVariable("width_next",c),i.topLevel&&t.addExport("width_next",c),u+='\n        <div class="vr-hotspot-content" style="width:',u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"widthContent"),e.opts.autoescape),u+='px;" id="hotspot',u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"hotspotIndex"),e.opts.autoescape),u+='">\n            <div class="cell" id="default" style="width:1024px;height:576px;position:absolute;top:0;left:0"></div>',i=i.push();var h=(a=5,o=32,r.callWrap(r.contextOrFrameLookup(t,i,"range"),"range",t,[0,r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"column")]));if(h)for(var d=h.length,p=0;p<h.length;p++){var f=h[p];i.set("column",f),i.set("loop.index",p+1),i.set("loop.index0",p),i.set("loop.revindex",d-p),i.set("loop.revindex0",d-p-1),i.set("loop.first",0===p),i.set("loop.last",p===d-1),i.set("loop.length",d),u+='<div class="page" id="column',u+=r.suppressValue(f,e.opts.autoescape),u+='" style="width:1024px;height:576px;position:absolute;top:0;left:',u+=r.suppressValue(1024*f,e.opts.autoescape),u+='px; overflow: visible">',f>0&&(u+='<div style="width:40px;height:40px;position:absolute;top:250px;left:30px" class="vr-icon vr-icon-arrow-left-white"></div>\n                        <button id="prevPage" style="opacity:0; height: 100%; width:10%; top:0; position: absolute; left: 0;"></button>');var g;if(g=r.contextOrFrameLookup(t,i,"width_before")+1024,i.set("width_before",g,!0),i.topLevel&&t.setVariable("width_before",g),i.topLevel&&t.addExport("width_before",g),u+='\n                    <div class="vr-hotspot-title">',u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"title"),e.opts.autoescape),u+="</div>",f<1&&(u+='<div class="vr-hotspot-description" style="column-count:',u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"column"),e.opts.autoescape),u+=";width:",u+=r.suppressValue(r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"widthContent"),e.opts.autoescape),u+='px">',u+=r.suppressValue(e.getFilter("safe").call(t,r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"description")),e.opts.autoescape),u+="</div>"),f+1<r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"column")){u+='<button id="nextPage" style="opacity:0; height: 100%; width:10%; top:0; position: absolute; right: 0;"></button>\n                        <div style="width:40px;height:40px;position:absolute;top:250px;left:960px" class="vr-icon vr-icon-arrow-right-white"></div>\n                        ';var m;m=r.contextOrFrameLookup(t,i,"width_next")+1024,i.set("width_next",m,!0),i.topLevel&&t.setVariable("width_next",m),i.topLevel&&t.addExport("width_next",m)}u+='<div class="vr-hotspot-footer">\n                        <div class="vr-hotspot-container-button" >',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"displayNavigation")?u+='<button id="prevButton" class="vr-hotspot-button">Prev</button>\n                                <button id="closeButton" class="vr-hotspot-button">Close annotation</button>\n                                <button id="nextButton" class="vr-hotspot-button">Next</button>':u+='<button id="closeButton" class="vr-hotspot-button">Close annotation</button>',u+="</div>\n                    </div>\n                </div>"}return i=i.pop(),u+="</div>\n",i=s,new r.SafeString(u)});t.addExport("panel"),t.setVariable("panel",u),s?s.rootRenderFunc(e,t,i,r,n):n(null,"")}catch(e){n(r.handleError(e,a,o))}}return{root:e}}()}()},,function(e,t){!function(){(window.nunjucksPrecompiled=window.nunjucksPrecompiled||{})["skfb_front/macros/vr/vr-menu.jinja"]=function(){function e(e,t,i,r,n){var a="";try{var o=null,s=r.makeMacro([],["options"],function(e){var n=i;i=new r.Frame,e=e||{},e.hasOwnProperty("caller")&&i.set("caller",e.caller),i.set("options",e.hasOwnProperty("options")?e.options:{});var a="";return a+='\n\n<div style="width:700px;">',r.memberLookup(r.contextOrFrameLookup(t,i,"options"),"hasHotspotsNavigation")&&(a+='<div class="vr-menu-row">\n            <button  id="vrPrevButton" class="vr-button vr-button-small">\n                <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-arrow-left-white"></div>                \n            </button>\n            <span class="vr-localize-icon">\n                <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-map-marker-white"></div>                                \n            </span>\n            <button id="vrNextButton" class="vr-button vr-button-small">\n                <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-arrow-right-white"></div>                                \n            </button>\n        </div>'),a+='<button id="vrHomeButton" class="vr-button">Home</button>\n    <button id="vrHelpButton" class="vr-button">Help</button>\n    <button id="vrExitButton" class="vr-button vr-round-button">\n        <div style="width:100px;height:100px;margin:auto" class="vr-icon vr-icon-times-white"></div>            \n    </button>\n</div>\n',i=n,new r.SafeString(a)});t.addExport("panel"),t.setVariable("panel",s),a+="\n",o?o.rootRenderFunc(e,t,i,r,n):n(null,a)}catch(e){n(r.handleError(e,null,null))}}return{root:e}}()}()},,,,,,,,function(e,t,i){e.exports=i.p+"cardboard-instructions-3559e10f564c87ffc582505a3919b0ad.svg"},function(e,t){e.exports="\nuniform float uAlpha;\n\nuniform vec4 uColor;\n\nuniform float uUp;\nuniform float uDown;\n\n#ifdef ICON\n    uniform sampler2D uTextureIcon;\n    varying vec2 vTexCoord0;\n#else\n    varying vec3 pos;\n#endif\n\nvoid main(void) {\n\n    #ifdef ICON\n        gl_FragColor = vec4(uColor.rgb, uAlpha) * texture2D(uTextureIcon, vTexCoord0);\n    #else\n        float alpha = step(pos.x, uUp) * step(uDown, pos.x);\n        gl_FragColor = vec4(uColor.rgb, uAlpha * alpha);\n    #endif\n\n    gl_FragColor.rgb *= gl_FragColor.a;\n}\n"},function(e,t){e.exports="attribute vec3 Vertex;\n\n#ifdef ICON\n attribute vec2 TexCoord0;\n varying vec2 vTexCoord0;\n#else\n varying vec3 pos;\n#endif\n\n\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  #ifdef ICON\n    vTexCoord0 = TexCoord0;\n  #else\n    pos = Vertex.xyz;\n  #endif\n\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},function(e,t){e.exports="#ifdef HEMI\nuniform vec4 uGround;\nvarying vec3 vLocalVertex;\nuniform float uRadius;\n#endif\n\n#ifdef ICON\nuniform sampler2D uTextureIcon;\nvarying vec2 vTexCoord0;\nuniform int uEnable;\n#endif\n\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\n\nuniform vec4 uColor;\n\nvoid main(void) {\n  float fragDepth = clamp((-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x), 0.0, 1.0);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize).rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n  float alpha = fragDepth < depth ? 1.0 : 0.1;\n\n#ifdef HEMI\n  gl_FragColor = vec4(mix(uGround.rgb, uColor.rgb, vLocalVertex.z / uRadius), alpha);\n#endif\n\n#ifdef LINE\n  gl_FragColor = vec4(uColor.rgb, alpha);\n#endif\n\n#ifdef ICON\n  gl_FragColor = vec4(float(uEnable) * uColor.rgb, alpha) * texture2D(uTextureIcon, vTexCoord0);\n#endif\n\n  gl_FragColor.rgb *= gl_FragColor.a;\n}\n"},function(e,t){e.exports="#ifdef ICON\nattribute vec2 TexCoord0;\nvarying vec2 vTexCoord0;\n#endif\n\n#ifdef HEMI\nvarying vec3 vLocalVertex;\n#endif\n\nattribute vec3 Vertex;\n\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n#ifdef ICON\n  vTexCoord0 = TexCoord0;\n#endif\n\n#ifdef HEMI\n  vLocalVertex = Vertex;\n#endif\n\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = uProjectionMatrix * vViewPos;\n}\n"},function(e,t){e.exports='uniform vec3 uColor;\nuniform float uAlpha;\nuniform int uOutputLinear;\n\nvarying float vHeight;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uColor, 1.0) * uAlpha * smoothstep(1.0, 0.0, pow(vHeight, 0.3));\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},function(e,t){e.exports="attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying float vHeight;\n\nvoid main(void) {\n  vHeight = Vertex.z;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},function(e,t,i){var r=i(328),n={};n.create=function(){var e=new r.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},n.clone=function(e){var t=new r.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},n.fromValues=function(e,t,i,n,a,o,s,u,l){var c=new r.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=n,c[4]=a,c[5]=o,c[6]=s,c[7]=u,c[8]=l,c},n.set=function(e,t,i,r,n,a,o,s,u,l){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e},n.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},n.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=c*o-s*l,d=-c*a+s*u,p=l*a-o*u,f=i*h+r*d+n*p;return f?(f=1/f,e[0]=h*f,e[1]=(-c*r+n*l)*f,e[2]=(s*r-n*o)*f,e[3]=d*f,e[4]=(c*i-n*u)*f,e[5]=(-s*i+n*a)*f,e[6]=p*f,e[7]=(-l*i+r*u)*f,e[8]=(o*i-r*a)*f,e):null},n.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return e[0]=o*c-s*l,e[1]=n*l-r*c,e[2]=r*s-n*o,e[3]=s*u-a*c,e[4]=i*c-n*u,e[5]=n*a-i*s,e[6]=a*l-o*u,e[7]=r*u-i*l,e[8]=i*o-r*a,e},n.determinant=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*(l*a-o*u)+i*(-l*n+o*s)+r*(u*n-a*s)},n.multiply=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=i[0],p=i[1],f=i[2],g=i[3],m=i[4],v=i[5],_=i[6],b=i[7],x=i[8];return e[0]=d*r+p*o+f*l,e[1]=d*n+p*s+f*c,e[2]=d*a+p*u+f*h,e[3]=g*r+m*o+v*l,e[4]=g*n+m*s+v*c,e[5]=g*a+m*u+v*h,e[6]=_*r+b*o+x*l,e[7]=_*n+b*s+x*c,e[8]=_*a+b*u+x*h,e},n.mul=n.multiply,n.translate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=i[0],p=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=d*r+p*o+l,e[7]=d*n+p*s+c,e[8]=d*a+p*u+h,e},n.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=Math.sin(i),p=Math.cos(i);return e[0]=p*r+d*o,e[1]=p*n+d*s,e[2]=p*a+d*u,e[3]=p*o-d*r,e[4]=p*s-d*n,e[5]=p*u-d*a,e[6]=l,e[7]=c,e[8]=h,e},n.scale=function(e,t,i){var r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},n.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},n.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},n.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},n.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,s=r+r,u=n+n,l=i*o,c=r*o,h=r*s,d=n*o,p=n*s,f=n*u,g=a*o,m=a*s,v=a*u;return e[0]=1-h-f,e[3]=c-v,e[6]=d+m,e[1]=c+v,e[4]=1-l-f,e[7]=p-g,e[2]=d-m,e[5]=p+g,e[8]=1-l-h,e},n.normalFromMat4=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15],_=i*s-r*o,b=i*u-n*o,x=i*l-a*o,S=r*u-n*s,y=r*l-a*s,C=n*l-a*u,T=c*g-h*f,M=c*m-d*f,w=c*v-p*f,A=h*m-d*g,E=h*v-p*g,P=d*v-p*m,N=_*P-b*E+x*A+S*w-y*M+C*T;return N?(N=1/N,e[0]=(s*P-u*E+l*A)*N,e[1]=(u*w-o*P-l*M)*N,e[2]=(o*E-s*w+l*T)*N,e[3]=(n*E-r*P-a*A)*N,e[4]=(i*P-n*w+a*M)*N,e[5]=(r*w-i*E-a*T)*N,e[6]=(g*C-m*y+v*S)*N,e[7]=(m*x-f*C-v*b)*N,e[8]=(f*y-g*x+v*_)*N,e):null},n.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},n.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},n.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e},n.sub=n.subtract,n.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},n.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},n.equals=function(e,t){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=t[0],p=t[1],f=t[2],g=t[3],m=t[4],v=t[5],_=e[6],b=t[7],x=t[8];return Math.abs(i-d)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-p)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-f)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-g)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))&&Math.abs(s-m)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-v)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(l-_)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-b)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(h-x)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))},e.exports=n},function(e,t,i){var r=i(328),n={};n.create=function(){var e=new r.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e},n.clone=function(e){var t=new r.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},n.fromValues=function(e,t,i){var n=new r.ARRAY_TYPE(3);return n[0]=e,n[1]=t,n[2]=i,n},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},n.set=function(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e},n.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},n.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e},n.sub=n.subtract,n.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e},n.mul=n.multiply,n.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},n.div=n.divide,n.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},n.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},n.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},n.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},n.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},n.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},n.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e},n.distance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)},n.dist=n.distance,n.squaredDistance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n},n.sqrDist=n.squaredDistance,n.length=function(e){var t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)},n.len=n.length,n.squaredLength=function(e){var t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r},n.sqrLen=n.squaredLength,n.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},n.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},n.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},n.cross=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[0],s=i[1],u=i[2];return e[0]=n*u-a*s,e[1]=a*o-r*u,e[2]=r*s-n*o,e},n.lerp=function(e,t,i,r){var n=t[0],a=t[1],o=t[2];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e[2]=o+r*(i[2]-o),e},n.hermite=function(e,t,i,r,n,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1),c=o*(3-2*a);return e[0]=t[0]*s+i[0]*u+r[0]*l+n[0]*c,e[1]=t[1]*s+i[1]*u+r[1]*l+n[1]*c,e[2]=t[2]*s+i[2]*u+r[2]*l+n[2]*c,e},n.bezier=function(e,t,i,r,n,a){var o=1-a,s=o*o,u=a*a,l=s*o,c=3*a*s,h=3*u*o,d=u*a;return e[0]=t[0]*l+i[0]*c+r[0]*h+n[0]*d,e[1]=t[1]*l+i[1]*c+r[1]*h+n[1]*d,e[2]=t[2]*l+i[2]*c+r[2]*h+n[2]*d,e},n.random=function(e,t){t=t||1;var i=2*r.RANDOM()*Math.PI,n=2*r.RANDOM()-1,a=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(i)*a,e[1]=Math.sin(i)*a,e[2]=n*t,e},n.transformMat4=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[3]*r+i[7]*n+i[11]*a+i[15];return o=o||1,e[0]=(i[0]*r+i[4]*n+i[8]*a+i[12])/o,e[1]=(i[1]*r+i[5]*n+i[9]*a+i[13])/o,e[2]=(i[2]*r+i[6]*n+i[10]*a+i[14])/o,e},n.transformMat3=function(e,t,i){var r=t[0],n=t[1],a=t[2];return e[0]=r*i[0]+n*i[3]+a*i[6],e[1]=r*i[1]+n*i[4]+a*i[7],e[2]=r*i[2]+n*i[5]+a*i[8],e},n.transformQuat=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[0],s=i[1],u=i[2],l=i[3],c=l*r+s*a-u*n,h=l*n+u*r-o*a,d=l*a+o*n-s*r,p=-o*r-s*n-u*a;return e[0]=c*l+p*-o+h*-u-d*-s,e[1]=h*l+p*-s+d*-o-c*-u,e[2]=d*l+p*-u+c*-s-h*-o,e},n.rotateX=function(e,t,i,r){var n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[0],a[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),a[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},n.rotateY=function(e,t,i,r){var n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),a[1]=n[1],a[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},n.rotateZ=function(e,t,i,r){var n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),a[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),a[2]=n[2],e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},n.forEach=function(){var e=n.create();return function(t,i,r,n,a,o){var s,u;for(i||(i=3),r||(r=0),u=n?Math.min(n*i+r,t.length):t.length,s=r;s<u;s+=i)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}(),n.angle=function(e,t){var i=n.fromValues(e[0],e[1],e[2]),r=n.fromValues(t[0],t[1],t[2]);n.normalize(i,i),n.normalize(r,r);var a=n.dot(i,r);return a>1?0:Math.acos(a)},n.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},n.equals=function(e,t){var i=e[0],n=e[1],a=e[2],o=t[0],s=t[1],u=t[2];return Math.abs(i-o)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-s)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(a-u)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))},e.exports=n},function(e,t,i){var r=i(328),n={};n.create=function(){var e=new r.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},n.clone=function(e){var t=new r.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.fromValues=function(e,t,i,n){var a=new r.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=i,a[3]=n,a},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},n.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},n.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e},n.sub=n.subtract,n.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e},n.mul=n.multiply,n.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e},n.div=n.divide,n.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},n.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},n.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},n.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},n.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},n.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},n.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},n.distance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(i*i+r*r+n*n+a*a)},n.dist=n.distance,n.squaredDistance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return i*i+r*r+n*n+a*a},n.sqrDist=n.squaredDistance,n.length=function(e){var t=e[0],i=e[1],r=e[2],n=e[3];return Math.sqrt(t*t+i*i+r*r+n*n)},n.len=n.length,n.squaredLength=function(e){var t=e[0],i=e[1],r=e[2],n=e[3];return t*t+i*i+r*r+n*n},n.sqrLen=n.squaredLength,n.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},n.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},n.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i*i+r*r+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=a*o),e},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},n.lerp=function(e,t,i,r){var n=t[0],a=t[1],o=t[2],s=t[3];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e[2]=o+r*(i[2]-o),e[3]=s+r*(i[3]-s),e},n.random=function(e,t){return t=t||1,e[0]=r.RANDOM(),e[1]=r.RANDOM(),e[2]=r.RANDOM(),e[3]=r.RANDOM(),n.normalize(e,e),n.scale(e,e,t),e},n.transformMat4=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*o,e[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*o,e[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*o,e[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*o,e},n.transformQuat=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[0],s=i[1],u=i[2],l=i[3],c=l*r+s*a-u*n,h=l*n+u*r-o*a,d=l*a+o*n-s*r,p=-o*r-s*n-u*a;return e[0]=c*l+p*-o+h*-u-d*-s,e[1]=h*l+p*-s+d*-o-c*-u,e[2]=d*l+p*-u+c*-s-h*-o,e[3]=t[3],e},n.forEach=function(){var e=n.create();return function(t,i,r,n,a,o){var s,u;for(i||(i=4),r||(r=0),u=n?Math.min(n*i+r,t.length):t.length,s=r;s<u;s+=i)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}(),n.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},n.equals=function(e,t){var i=e[0],n=e[1],a=e[2],o=e[3],s=t[0],u=t[1],l=t[2],c=t[3];return Math.abs(i-s)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-u)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-l)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-c)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},e.exports=n},function(e,t,i){"use strict";var r=i(164),n=function(e){this._initialBufferArray=void 0,this._bufferArray=void 0,e&&(this.setBufferArray(e),this.setInitialBufferArray(e))},a={setInitialBufferArray:function(e){this._initialBufferArray=e},getInitialBufferArray:function(){return this._initialBufferArray},setBufferArray:function(e){this._bufferArray=e.getBufferArray?e.getBufferArray():e},getBufferArray:function(){return this._bufferArray}};for(var o in r.prototype)a[o]=function(e){return function(){return e.apply(this._bufferArray,arguments)}}(r.prototype[o]);n.prototype=a,e.exports=n},function(e,t,i){"use strict";var r=i(14),n=i(421),a=i(274),o=i(455),s=i(450),u=i(651),l=i(8).mat4,c=i(424),h=i(423),d=i(332),p=i(146),f=i(8).vec3,g=function(){this._modelViewMatrixStack=[],this._projectionMatrixStack=[],this._viewportStack=[],this._cullingSetStack=[],this._frustumVolume=-1,this._bbCornerFar=0,this._bbCornerNear=0,this._reservedMatrixStack=new h,this._reserveCullingSetStack=[new u],this._reserveCullingSetStack.current=0,this._cameraIndexStack=[],this._cameraModelViewIndexStack=[],this._cameraMatrixInverse=[],this._cameraMatrixInverseRoot=void 0};r.createPrototypeObject(g,r.objectInherit(s.prototype,{_getReservedCullingSet:function(){var e=this._reserveCullingSetStack[this._reserveCullingSetStack.current++];return this._reserveCullingSetStack.current===this._reserveCullingSetStack.length&&this._reserveCullingSetStack.push(new u),e},reset:function(){this._modelViewMatrixStack.length=0,this._projectionMatrixStack.length=0,this._cullingSetStack.length=0,this._reservedMatrixStack.reset(),this._reserveCullingSetStack.current=0,this._cameraModelViewIndexStack.length=0,this._cameraIndexStack.length=0,this._cameraMatrixInverse.length=0,this._cameraMatrixInverseRoot=void 0},getProjectionMatrixStack:function(){return this._projectionMatrixStack},getCurrentProjectionMatrix:function(){return this._projectionMatrixStack[this._projectionMatrixStack.length-1]},getCurrentModelViewMatrix:function(){return this._modelViewMatrixStack[this._modelViewMatrixStack.length-1]},getCameraInverseMatrix:function(){if(!this._cameraIndexStack.length)return this._cameraMatrixInverseRoot;var e=this._cameraIndexStack[this._cameraIndexStack.length-1],t=this.getNodePath()[e],i=t.getInstanceID();if(void 0===this._cameraMatrixInverse[i]){var r=this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length-1],n=this._modelViewMatrixStack[r],a=this._reservedMatrixStack.get();l.invert(a,n),this._cameraMatrixInverse[i]=a}return this._cameraMatrixInverse[i]},getCurrentModelMatrix:function(){var e=this.getCameraInverseMatrix(),t=this._reservedMatrixStack.get();return l.mul(t,e,this.getCurrentModelViewMatrix())},getCurrentViewMatrix:function(){if(!this._cameraIndexStack.length)return this._modelViewMatrixStack[0];var e=this._cameraModelViewIndexStack[this._cameraModelViewIndexStack.length-1];return this._modelViewMatrixStack[e]},getViewport:function(){if(0!==this._viewportStack.length)return this._viewportStack[this._viewportStack.length-1]},getLookVectorLocal:function(e){var t=this.getCurrentModelViewMatrix();return f.set(e,-t[2],-t[6],-t[10])},pushViewport:function(e){this._viewportStack.push(e)},popViewport:function(){this._viewportStack.pop()},getFrustumPlanes:function(){var e=l.create();return function(t,i,r,n){l.mul(e,i,r);var a=!!n,o=t[0];o[0]=e[3]-e[0],o[1]=e[7]-e[4],o[2]=e[11]-e[8],o[3]=e[15]-e[12];var s=t[1];s[0]=e[3]+e[0],s[1]=e[7]+e[4],s[2]=e[11]+e[8],s[3]=e[15]+e[12];var u=t[2];u[0]=e[3]+e[1],u[1]=e[7]+e[5],u[2]=e[11]+e[9],u[3]=e[15]+e[13];var h=t[3];if(h[0]=e[3]-e[1],h[1]=e[7]-e[5],h[2]=e[11]-e[9],h[3]=e[15]-e[13],a){var d=t[4];d[0]=e[3]-e[2],d[1]=e[7]-e[6],d[2]=e[11]-e[10],d[3]=e[15]-e[14];var p=t[5];p[0]=e[3]+e[2],p[1]=e[7]+e[6],p[2]=e[11]+e[10],p[3]=e[15]+e[14]}for(var f=n?6:4,g=0;g<f;g++)c.normalizeEquation(t[g])}}(),pushCullingSet:function(){var e=this._getReservedCullingSet();this._enableFrustumCulling&&(l.getFrustumPlanes(e.getFrustum().getPlanes(),this.getCurrentProjectionMatrix(),this.getCurrentModelViewMatrix(),!1),e.getFrustum().setupMask(4)),this._cullingSetStack.push(e)},popCullingSet:function(){return this._cullingSetStack.pop()},getCurrentCullingSet:function(){return this._cullingSetStack[this._cullingSetStack.length-1]},pushCurrentMask:function(){var e=this.getCurrentCullingSet();e&&e.pushCurrentMask()},popCurrentMask:function(){var e=this.getCurrentCullingSet();e&&e.popCurrentMask()},isVerticesCulled:function(e){return!!this._enableFrustumCulling&&this.getCurrentCullingSet().isVerticesCulled(e)},isBoundingBoxCulled:function(e){return!!this._enableFrustumCulling&&(e.valid()&&this.getCurrentCullingSet().isBoundingBoxCulled(e))},isBoundingSphereCulled:function(e){return!!this._enableFrustumCulling&&(e.valid()&&this.getCurrentCullingSet().isBoundingSphereCulled(e))},isCulled:function(){var e=new n;return function(t,i){if(!this._enableFrustumCulling)return!1;if(t.isCullingActive()){if(0===this.getCurrentCullingSet().getCurrentResultMask())return!1;var r=this._reservedMatrixStack.get();return l.identity(r),r=t instanceof d?o.computeLocalToWorld(i.slice(0,i.length-1),!0,r):o.computeLocalToWorld(i,!0,r),t.getBound().transformMat4(e,r),this.getCurrentCullingSet().isBoundingSphereCulled(e)}return this.getCurrentCullingSet().resetCullingMask(),!1}}(),pushModelViewMatrix:function(){var e=f.create();return function(t){var i=this.getNodePath(),r=i.length;if(r){var n=r-1;i[n].getTypeID()===a.getTypeID()&&i[n].getReferenceFrame()===p.ABSOLUTE_RF&&(this._cameraIndexStack.push(n),this._cameraModelViewIndexStack.push(this._modelViewMatrixStack.length))}else{var o=this._reservedMatrixStack.get();l.invert(o,t),this._cameraMatrixInverseRoot=o}this._modelViewMatrixStack.push(t),this.getLookVectorLocal(e),this._bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),popModelViewMatrix:function(){var e=f.create();return function(){var t=this.getNodePath(),i=t.length-1;this._cameraIndexStack.length&&i===this._cameraIndexStack[this._cameraIndexStack.length-1]&&(this._cameraIndexStack.pop(),this._cameraModelViewIndexStack.pop()),this._modelViewMatrixStack.pop(),0!==this._modelViewMatrixStack.length?this.getLookVectorLocal(e):f.set(e,0,0,-1),this._bbCornerFar=(e[0]>=0?1:0)|(e[1]>=0?2:0)|(e[2]>=0?4:0),this._bbCornerNear=7&~this._bbCornerFar}}(),pushProjectionMatrix:function(e){this._projectionMatrixStack.push(e),this._frustumVolume=-1,this.pushCullingSet()},popProjectionMatrix:function(){this._projectionMatrixStack.pop(),this._frustumVolume=-1,this.popCullingSet()}}),"osg","CullStack"),e.exports=g},function(e,t,i){"use strict";var r=i(569),n=function(){this._mask=n.DEFAULT_CULLING,this._frustum=new r};n.prototype={reset:function(){this._mask=n.DEFAULT_CULLING,this._frustum.clear()},setCullingMask:function(e){this._mask=e},getCullingMask:function(){return this._mask},setFrustum:function(e){this._frustum=e},getFrustum:function(){return this._frustum},getCurrentResultMask:function(){return this._frustum.getCurrentMask()},pushCurrentMask:function(){this._frustum.pushCurrentMask()},popCurrentMask:function(){this._frustum.popCurrentMask()},resetCullingMask:function(){this._frustum.setResultMask(this._frustum.getCurrentMask())},isBoundingBoxCulled:function(e){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingBox(e))},isBoundingSphereCulled:function(e){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsBoundingSphere(e))},isVerticesCulled:function(e){return!(!(this._mask&n.VIEW_FRUSTUM_CULLING)||this._frustum.containsVertices(e))}},n.NO_CULLING=0,n.VIEW_FRUSTUM_LEFT_CULLING=1,n.VIEW_FRUSTUM_RIGHT_CULLING=2,n.VIEW_FRUSTUM_TOP_CULLING=3,n.VIEW_FRUSTUM_BOTTOM_CULLING=4,n.NEAR_PLANE_CULLING=5,n.FAR_PLANE_CULLING=6,n.VIEW_FRUSTUM_SIDES_CULLING=n.VIEW_FRUSTUM_LEFT_CULLING|n.VIEW_FRUSTUM_RIGHT_CULLING|n.VIEW_FRUSTUM_BOTTOM_CULLING|n.VIEW_FRUSTUM_TOP_CULLING,n.VIEW_FRUSTUM_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING|n.NEAR_PLANE_CULLING|n.FAR_PLANE_CULLING,n.DEFAULT_CULLING=n.VIEW_FRUSTUM_SIDES_CULLING,n.ENABLE_ALL_CULLING=n.VIEW_FRUSTUM_CULLING,e.exports=n},function(e,t,i){"use strict";var r=function(e,t,i){this._mode=e,this._first=t,this._arrayLengths=i.slice(0)};r.prototype={draw:function(e){for(var t=e.getGraphicContext(),i=this._mode,r=this._first,n=this._arrayLengths,a=0,o=n.length;a<o;a++){var s=n[a];t.drawArrays(i,r,s),r+=s}},getMode:function(){return this._mode},getNumIndices:function(){for(var e=0,t=this._arrayLengths,i=0,r=t.length;i<r;i++)e+=t[i];return e},getCount:function(){return this.getNumIndices()},getArrayLengths:function(){return this._arrayLengths},getFirst:function(){return this._first},setFirst:function(e){this._first=e}},e.exports=r},function(e,t,i){"use strict";var r=function(){this._frame=0,this._startSimulation=0,this._currentSimulation=0,this._deltaTime=0};r.prototype={setReferenceTime:function(e){this._startSimulation=e},getReferenceTime:function(){return this._startSimulation},setSimulationTime:function(e){this._currentSimulation=e},getSimulationTime:function(){return this._currentSimulation},setDeltaTime:function(e){this._deltaTime=e},getDeltaTime:function(){return this._deltaTime},setFrameNumber:function(e){this._frame=e},getFrameNumber:function(){return this._frame}},e.exports=r},function(e,t,i){"use strict";var r=i(14),n=i(8).vec3,a=i(363),o=i(656),s=i(136),u=i(30),l=function(e,t){this._bb=new a,this._first=e,this._second=t,this._nodeRayStart=n.create(),this._nodeRayEnd=n.create()},c=function(){this._numVertexIndices=0};c.prototype={apply:function(e){if(e.getAttributes().Vertex){var t=this;new o(e,function(){return{operatorPoint:function(){t._numVertexIndices+=2},operatorLine:function(){t._numVertexIndices+=3},operatorTriangle:function(){t._numVertexIndices+=4}}}).apply()}}};var h=function(e){this._buildKdTree=e,this._numIndices=0};h.prototype={buildKdTreePoint:function(e){var t=this._buildKdTree._kdTree.getVertices(),i=3*e;this._buildKdTree._kdTree.addPoint(e),this._buildKdTree._primitiveIndices[this._numIndices]=this._numIndices;var r=this._buildKdTree._centers,n=3*this._numIndices;r[n]=t[i],r[n+1]=t[i+1],r[n+2]=t[i+2],this._numIndices++},buildKdTreeLine:function(e,t){if(e!==t){var i=this._buildKdTree._kdTree.getVertices(),r=3*e,n=3*t;this._buildKdTree._kdTree.addLine(e,t);var a=this._numIndices;this._buildKdTree._primitiveIndices[a]=a;var o=3*a,s=i[r],u=i[r+1],l=i[r+2],c=i[n],h=i[n+1],d=i[n+2],p=s<c?s:c,f=u<h?u:h,g=l<d?l:d,m=s>c?s:c,v=u>h?u:h,_=l>d?l:d,b=this._buildKdTree._centers;b[o]=.5*(p+m),b[o+1]=.5*(f+v),b[o+2]=.5*(g+_),this._numIndices++}},buildKdTreeTriangle:function(e,t,i){if(e!==t&&e!==i&&t!==i){var r=this._buildKdTree._kdTree.getVertices(),n=3*e,a=3*t,o=3*i;this._buildKdTree._kdTree.addTriangle(e,t,i);var s=this._numIndices;this._buildKdTree._primitiveIndices[s]=s;var u=3*s,l=r[n],c=r[n+1],h=r[n+2],d=r[a],p=r[a+1],f=r[a+2],g=r[o],m=r[o+1],v=r[o+2],_=l<d?l<g?l:g:d<g?d:g,b=c<p?c<m?c:m:p<m?p:m,x=h<f?h<v?h:v:f<v?f:v,S=l>d?l>g?l:g:d>g?d:g,y=c>p?c>m?c:m:p>m?p:m,C=h>f?h>v?h:v:f>v?f:v,T=this._buildKdTree._centers;T[u]=.5*(_+S),T[u+1]=.5*(b+y),T[u+2]=.5*(x+C),this._numIndices++}},apply:function(e){if(e.getAttributes().Vertex){var t=this;new o(e,function(){return{operatorPoint:function(e){t.buildKdTreePoint(e)},operatorLine:function(e,i){t.buildKdTreeLine(e,i)},operatorTriangle:function(e,i,r){t.buildKdTreeTriangle(e,i,r)}}}).apply()}}};var d=function(e){this._kdTree=e,this._bb=new a,this._primitiveIndices=void 0,this._centers=void 0,this._axisOrder=n.create(),this._stackLength=0};d.prototype={build:function(e,t){var i=e._targetNumTrianglesPerLeaf,r=t.getVertexAttributeList().Vertex;if(!r)return!1;var n=r.getElements();if(!n)return!1;var o=n.length/3;if(o<i)return!1;this._bb.copy(t.getBoundingBox()),this._kdTree.setVertices(n),this.computeDivisions(e),e._numVerticesProcessed+=o;for(var u=0,d=t.getPrimitiveSetList(),p=d.length,f=0;f<p;f++){var g=d[f],m=g.getMode();m===s.TRIANGLE_STRIP||m===s.TRIANGLE_FAN?u+=3*Math.abs(g.getCount()-2):u+=3*g.getCount()}var v=new c(this);v.apply(t);var _=v._numVertexIndices;this._primitiveIndices=new Uint32Array(u/3),this._centers=new Float32Array(u),this._kdTree.setPrimitiveIndices(new Uint32Array(u));var b=o>65535?new Uint32Array(_):new Uint16Array(_);this._kdTree.setVertexIndices(b);var x=new h(this);x.apply(t);var S=this._kdTree.getPrimitiveIndices().slice(0,this._kdTree.getNumPrimitiveIndices());this._kdTree.setPrimitiveIndices(S);var y=this._kdTree.getVertexIndices().slice(0,this._kdTree.getNumVertexIndices());this._kdTree.setVertexIndices(y),this._primitiveIndices=this._primitiveIndices.slice(0,x._numIndices),this._centers=this._centers.slice(0,3*x._numIndices);var C=new l(-1,this._primitiveIndices.length);C._bb.copy(this._bb);var T=this._kdTree.addNode(C),M=new a;M.copy(this._bb),this.divide(e,M,T,0);var w=this._kdTree.getPrimitiveIndices();for(p=this._primitiveIndices.length,f=0;f<p;++f)this._primitiveIndices[f]=w[this._primitiveIndices[f]];return this._kdTree.setPrimitiveIndices(this._primitiveIndices),this._kdTree.getNodes().length>0},computeDivisions:function(e){this._stackLength=e._maxNumLevels;var t=this._bb._max,i=this._bb._min,r=t[0]-i[0],n=t[1]-i[1],a=t[2]-i[2],o=this._axisOrder;o[0]=r>=n&&r>=a?0:n>=a?1:2,o[2]=r<n&&r<a?0:n<a?1:2;var s=o[0]+o[2];o[1]=3===s?0:2===s?1:2},divide:function(e,t,i,r){var n=this._kdTree,a=this._primitiveIndices,o=n.getNodes(),s=o[i],u=s._first,c=s._second,h=r<this._stackLength&&u<0&&c>e._targetNumTrianglesPerLeaf,d=-u-1,p=d+c-1;if(!h)return u<0&&this.computeNodeBox(s,d,p),i;if(u>=0)return i;for(var f=this._axisOrder[r%3],g=t._min[f],m=t._max[f],v=.5*(g+m),_=0,b=0,x=!1,S=d,y=p,C=this._centers;S<y;){for(;S<y&&C[3*a[S]+f]<=v;)++S;for(;S<y&&C[3*a[y]+f]>v;)--y;if(S<y){var T=a[S];a[S]=a[y],a[y]=T,++S,--y}}S===y&&(C[3*a[S]+f]<=v?++S:--y),y-d<=-1?(_=0,b=i,x=!0):p-S<=-1?(_=i,b=0,x=!0):(_=n.addNode(new l(-d-1,y-d+1)),b=n.addNode(new l(-S-1,p-S+1)));var M=t._max[f];t._max[f]=v;var w=0!==_?this.divide(e,t,_,r+1):0;t._max[f]=M,M=t._min[f],t._min[f]=v;var A=0!==b?this.divide(e,t,b,r+1):0;if(t._min[f]=M,!x){s._first=w,s._second=A,x=!0;var E=s._bb;E.init(),0!==w&&E.expandByBoundingBox(o[w]._bb),0!==A&&E.expandByBoundingBox(o[A]._bb)}return i},computeNodeBox:function(e,t,i){for(var r=1/0,n=1/0,a=1/0,o=-1/0,s=-1/0,u=-1/0,l=this._kdTree.getVertexIndices(),c=this._kdTree.getPrimitiveIndices(),h=this._kdTree.getVertices(),d=t;d<=i;++d)for(var p=c[this._primitiveIndices[d]],f=l[p++],g=0;g<f;++g){var m=3*l[p++],v=h[m],_=h[m+1],b=h[m+2];v<r&&(r=v),_<n&&(n=_),b<a&&(a=b),v>o&&(o=v),_>s&&(s=_),b>u&&(u=b)}var x=e._bb,S=x._min,y=x._max;S[0]=r-1e-6,S[1]=n-1e-6,S[2]=a-1e-6,y[0]=o+1e-6,y[1]=s+1e-6,y[2]=u+1e-6}};var p=function(){this._vertices=null,this._kdNodes=[],this._primitiveIndices=void 0,this._vertexIndices=void 0,this._numVertexIndices=0,this._numPrimitiveIndices=0};r.createPrototypeObject(p,{getVertices:function(){return this._vertices},setVertices:function(e){this._vertices=e},getNumPrimitiveIndices:function(){return this._numPrimitiveIndices},getNumVertexIndices:function(){return this._numVertexIndices},setPrimitiveIndices:function(e){this._primitiveIndices=e},getPrimitiveIndices:function(){return this._primitiveIndices},setVertexIndices:function(e){this._vertexIndices=e},getVertexIndices:function(){return this._vertexIndices},getNodes:function(){return this._kdNodes},addPoint:function(e){var t=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=t,this._vertexIndices[this._numVertexIndices++]=1,this._vertexIndices[this._numVertexIndices++]=e},addLine:function(e,t){var i=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=i,this._vertexIndices[this._numVertexIndices++]=2,this._vertexIndices[this._numVertexIndices++]=e,this._vertexIndices[this._numVertexIndices++]=t},addTriangle:function(e,t,i){var r=this._numVertexIndices;this._primitiveIndices[this._numPrimitiveIndices++]=r,this._vertexIndices[this._numVertexIndices++]=3,this._vertexIndices[this._numVertexIndices++]=e,this._vertexIndices[this._numVertexIndices++]=t,this._vertexIndices[this._numVertexIndices++]=i},addNode:function(e){return this._kdNodes.push(e),this._kdNodes.length-1},build:function(e,t){return new d(this).build(e,t)},intersect:function(e,t){if(t._first<0)for(var i=-t._first-1,r=i+t._second,n=this._vertexIndices,a=i;a<r;++a){var o=this._primitiveIndices[a],s=n[o++];switch(s){case 1:e.intersectPoint(this._vertices,a,n[o]);break;case 2:e.intersectLine(this._vertices,a,n[o],n[o+1]);break;case 3:e.intersectTriangle(this._vertices,a,n[o],n[o+1],n[o+2]);break;default:u.warn("Warning: KdTree::intersect() encounted unsupported primitive size of "+s)}}else e.enter(t._bb)&&(t._first>0&&this.intersect(e,this._kdNodes[t._first]),t._second>0&&this.intersect(e,this._kdNodes[t._second]),e.leave())},intersectLineSegment:function(e,t,i,r){var a=t._first,o=t._second,s=this._vertices;if(a<0)for(var u=-t._first-1,l=u+t._second,c=this._vertexIndices,h=u;h<l;++h){var d=this._primitiveIndices[h];d++,e.intersectTriangle(s,h,c[d],c[d+1],c[d+2])}else{var p=t._nodeRayStart,f=t._nodeRayEnd;n.copy(p,i),n.copy(f,r);var g,m=this._kdNodes;a>0&&(g=m[t._first],e.enter(g._bb,p,f)&&this.intersectLineSegment(e,g,p,f)),o>0&&(n.copy(p,i),n.copy(f,r),g=m[t._second],e.enter(g._bb,p,f)&&this.intersectLineSegment(e,g,p,f))}}},"osg","KdTree"),e.exports=p},function(e,t,i){"use strict";var r=i(8).vec3,n=i(136),a=i(292),o=i(291),s=function(e,t,i){this._geom=e,this._cb=t,this._vertices=i},u=s.functorDrawElements=[],l=s.functorDrawArrays=[];u[n.POINTS]=function(){var e=r.create();return function(t,i,r,n,a){for(var o=t+i,s=t;s<o;++s){var u=3*r[s];e[0]=a[u],e[1]=a[u+1],e[2]=a[u+2],n.operatorPoint(e)}}}(),u[n.LINES]=function(){var e=r.create(),t=r.create();return function(i,r,n,a,o){for(var s=i+r,u=i;u<s-1;u+=2){var l=3*n[u];e[0]=o[l],e[1]=o[l+1],e[2]=o[l+2],l=3*n[u+1],t[0]=o[l],t[1]=o[l+1],t[2]=o[l+2],a.operatorLine(e,t)}}}(),u[n.LINE_STRIP]=function(){var e=r.create(),t=r.create();return function(i,r,n,a,o){for(var s=i+r,u=i;u<s-1;++u){var l=3*n[u];e[0]=o[l],e[1]=o[l+1],e[2]=o[l+2],l=3*n[u+1],t[0]=o[l],t[1]=o[l+1],t[2]=o[l+2],a.operatorLine(e,t)}}}(),u[n.LINE_LOOP]=function(){var e=r.create(),t=r.create();return function(i,r,n,a,o){for(var s=i+r-1,u=i;u<s;++u){var l=3*n[u];e[0]=o[l],e[1]=o[l+1],e[2]=o[l+2],l=3*n[u+1],t[0]=o[l],t[1]=o[l+1],t[2]=o[l+2],a.operatorLine(e,t)}s=3*n[s],e[0]=o[s],e[1]=o[s+1],e[2]=o[s+2];var c=3*n[0];t[0]=o[c],t[1]=o[c+1],t[2]=o[c+2],a.operatorLine(e,t)}}(),u[n.TRIANGLES]=function(){var e=r.create(),t=r.create(),i=r.create();return function(r,n,a,o,s){for(var u=r+n,l=r;l<u;l+=3){var c=3*a[l];e[0]=s[c],e[1]=s[c+1],e[2]=s[c+2],c=3*a[l+1],t[0]=s[c],t[1]=s[c+1],t[2]=s[c+2],c=3*a[l+2],i[0]=s[c],i[1]=s[c+1],i[2]=s[c+2],o.operatorTriangle(e,t,i)}}}(),u[n.TRIANGLE_STRIP]=function(){var e=r.create(),t=r.create(),i=r.create();return function(r,n,a,o,s){for(var u=2,l=r;u<n;++u,++l){var c=3*a[l];e[0]=s[c],e[1]=s[c+1],e[2]=s[c+2],c=3*a[l+1],t[0]=s[c],t[1]=s[c+1],t[2]=s[c+2],c=3*a[l+2],i[0]=s[c],i[1]=s[c+1],i[2]=s[c+2],u%2?o.operatorTriangle(e,i,t):o.operatorTriangle(e,t,i)}}}(),u[n.TRIANGLE_FAN]=function(){var e=r.create(),t=r.create(),i=r.create();return function(r,n,a,o,s){for(var u=a[r],l=2,c=r+1;l<n;++l,++c){e[0]=s[u],e[1]=s[u+1],e[2]=s[u+2];var h=3*a[c];t[0]=s[h],t[1]=s[h+1],t[2]=s[h+2],h=3*a[c+1],i[0]=s[h],i[1]=s[h+1],i[2]=s[h+2],o.operatorTriangle(e,t,i)}}}(),l[n.POINTS]=function(){var e=r.create();return function(t,i,r,n){for(var a=t;a<t+i;++a){var o=3*a;e[0]=n[o],e[1]=n[o+1],e[2]=n[o+2],r.operatorPoint(e)}}}(),l[n.LINES]=function(){var e=r.create(),t=r.create();return function(i,r,n,a){for(var o=i;o<i+r-1;o+=2){var s=3*o;e[0]=a[s],e[1]=a[s+1],e[2]=a[s+2],s=3*(o+1),t[0]=a[s],t[1]=a[s+1],t[2]=a[s+2],n.operatorLine(e,t)}}}(),l[n.LINE_STRIP]=function(){var e=r.create(),t=r.create();return function(i,r,n,a){for(var o=i;o<i+r-1;++o){var s=3*o;e[0]=a[s],e[1]=a[s+1],e[2]=a[s+2],s=3*(o+1),t[0]=a[s],t[1]=a[s+1],t[2]=a[s+2],n.operatorLine(e,t)}}}(),l[n.LINE_LOOP]=function(){var e=r.create(),t=r.create();return function(i,r,n,a){for(var o=i+r-1,s=i;s<o;++s){var u=3*s;e[0]=a[u],e[1]=a[u+1],e[2]=a[u+2],u=3*(s+1),t[0]=a[u],t[1]=a[u+1],t[2]=a[u+2],n.operatorLine(e,t)}o*=3,e[0]=a[o],e[1]=a[o+1],e[2]=a[o+2],i*=3,t[0]=a[i],t[1]=a[i+1],t[2]=a[i+2],n.operatorLine(e,t)}}(),l[n.TRIANGLES]=function(){var e=r.create(),t=r.create(),i=r.create();return function(r,n,a,o){for(var s=r;s<r+n;s+=3){var u=3*s;e[0]=o[u],e[1]=o[u+1],e[2]=o[u+2],u=3*(s+1),t[0]=o[u],t[1]=o[u+1],t[2]=o[u+2],u=3*(s+2),i[0]=o[u],i[1]=o[u+1],i[2]=o[u+2],a.operatorTriangle(e,t,i)}}}(),l[n.TRIANGLE_STRIP]=function(){var e=r.create(),t=r.create(),i=r.create();return function(r,n,a,o){for(var s=2,u=r;s<n;++s,++u){var l=3*u;e[0]=o[l],e[1]=o[l+1],e[2]=o[l+2],l=3*(u+1),t[0]=o[l],t[1]=o[l+1],t[2]=o[l+2],l=3*(u+2),i[0]=o[l],i[1]=o[l+1],i[2]=o[l+2],s%2?a.operatorTriangle(e,i,t):a.operatorTriangle(e,t,i)}}}(),l[n.TRIANGLE_FAN]=function(){var e=r.create(),t=r.create(),i=r.create();return function(r,n,a,o){for(var s=2,u=r+1;s<n;++s,++u){e[0]=o[r],e[1]=o[r+1],e[2]=o[r+2];var l=3*u;t[0]=o[l],t[1]=o[l+1],t[2]=o[l+2],l=3*(u+1),i[0]=o[l],i[1]=o[l+1],i[2]=o[l+2],a.operatorTriangle(e,t,i)}}}(),s.prototype={apply:function(){var e=this._geom,t=e.getPrimitiveSetList();if(t)for(var i,r=this._cb(),n=this._vertices,s=t.length,c=0;c<s;c++){var h=t[c];if(h instanceof a){if(i=u[h.getMode()]){var d=h.indices.getElements();i(h.getFirst()/d.BYTES_PER_ELEMENT,h.getCount(),d,r,n)}}else h instanceof o&&(i=l[h.getMode()])&&i(h.getFirst(),h.getCount(),r,n)}}},e.exports=s},function(e,t,i){"use strict";var r=i(136),n=i(292),a=i(291),o=function(e,t){this._geom=e,this._cb=t},s=o.functorDrawElements=[],u=o.functorDrawArrays=[];s[r.TRIANGLES]=function(e,t,i,r){for(var n=e+t,a=e;a<n;a+=3)r.operatorTriangle(i[a],i[a+1],i[a+2])},s[r.TRIANGLE_STRIP]=function(e,t,i,r){for(var n=2,a=e;n<t;++n,++a)n%2?r.operatorTriangle(i[a],i[a+2],i[a+1]):r.operatorTriangle(i[a],i[a+1],i[a+2])},s[r.TRIANGLE_FAN]=function(e,t,i,r){for(var n=i[e],a=2,o=e+1;a<t;++a,++o)r.operatorTriangle(n,i[o],i[o+1])},s[r.POINTS]=function(e,t,i,r){for(var n=e+t,a=e;a<n;++a)r.operatorPoint(i[a])},s[r.LINES]=function(e,t,i,r){for(var n=e+t,a=e;a<n;a+=2)r.operatorLine(i[a],i[a+1])},s[r.LINE_STRIP]=function(e,t,i,r){for(var n=e+t,a=e;a<n;++a)r.operatorLine(i[a],i[a+1])},s[r.LINE_LOOP]=function(e,t,i,r){for(var n=e+t,a=e;a<n;++a)r.operatorLine(i[a],i[a+1]);r.operatorLine(i[i.length-1],i[0])},u[r.TRIANGLES]=function(e,t,i){for(var r=2,n=e;r<t;r+=3,n+=3)i.operatorTriangle(n,n+1,n+2)},u[r.TRIANGLE_STRIP]=function(e,t,i){for(var r=2,n=e;r<t;++r,++n)r%2?i.operatorTriangle(n,n+2,n+1):i.operatorTriangle(n,n+1,n+2)},u[r.TRIANGLE_FAN]=function(e,t,i){for(var r=2,n=e+1;r<t;++r,++n)i.operatorTriangle(e,n,n+1)},u[r.POINTS]=function(e,t,i){for(var r=0,n=e;r<t;++r,++n)i.operatorPoint(n)},u[r.LINES]=function(e,t,i){for(var r=1,n=e;r<t;r+=2,n+=2)i.operatorLine(n,n+1)},u[r.LINE_STRIP]=function(e,t,i){for(var r=1,n=e;r<t;++r,++n)i.operatorLine(n,n+1)},u[r.LINE_LOOP]=function(e,t,i){for(var r=1,n=e;r<t;++r,++n)i.operatorLine(n,n+1);i.operatorLine(e+t-1,e)},o.prototype={apply:function(){var e=this._geom,t=e.getPrimitiveSetList();if(t)for(var i,r=this._cb(),o=t.length,l=0;l<o;l++){var c=t[l];if(c instanceof n){if(i=s[c.getMode()]){var h=c.indices.getElements();i(c.getFirst()/h.BYTES_PER_ELEMENT,c.getCount(),h,r)}}else c instanceof a&&(i=u[c.getMode()])&&i(c.getFirst(),c.getCount(),r)}}},e.exports=o},function(e,t,i){"use strict";var r=i(454),n=[function(e,t,i,r,n){e.applyModelViewMatrix(t,i),e.applyProjectionMatrix(n)},function(e,t,i,r,n){var a=e.getGraphicContext(),o=e.applyModelViewMatrix(t,i);if(e.applyProjectionMatrix(n),o){var s=e._modelMatrix;s.setMatrix4(i),s.apply(a,this.modelUniform)}},function(e,t,i,r,n){var a=e.getGraphicContext(),o=e.applyModelViewMatrix(t,i);if(e.applyProjectionMatrix(n),o){var s=e._viewMatrix;s.setMatrix4(r),s.apply(a,this.viewUniform)}},function(e,t,i,r,n){var a=e.getGraphicContext(),o=e.applyModelViewMatrix(t,i);if(e.applyProjectionMatrix(n),o){var s=e._modelMatrix;s.setMatrix4(i),s.apply(a,this.modelUniform);var u=e._viewMatrix;u.setMatrix4(r),u.apply(a,this.viewUniform)}}],a=function(e,t){this.modelUniform=t._uniformsCache[e._modelMatrix.getName()],this.viewUniform=t._uniformsCache[e._viewMatrix.getName()];var i=0;this.modelUniform&&(i=1),this.viewUniform&&(i|=2),this.apply=n[i]},o=function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._model=void 0,this._modelView=void 0};o.prototype={reset:function(){this._parent=void 0,this._geometry=void 0,this._depth=0,this._projection=void 0,this._view=void 0,this._model=void 0,this._modelView=void 0},init:function(e,t,i,r,n,a,o){this._parent=e,this._geometry=t,this._depth=o,this._projection=i,this._view=r,this._model=a,this._modelView=n},drawGeometry:function(){return function(e){var t=e.getLastProgramApplied(),i=t.getInstanceID(),r=e.getCacheUniformsApplyRenderLeaf(),n=r[i];n||(n=new a(e,t),r[i]=n),n.apply(e,this._modelView,this._model,this._view,this._projection),this._geometry.drawImplementation(e)}}(),render:function(){var e=0,t=-1;return function(i,n){var a,o,s=this._parent,u=s.parent,l=s.stateset;void 0!==n?(a=n._parent,o=a.parent,o!==u?(r.moveStateGraph(i,o,u),i.applyStateSet(l)):s!==a?i.applyStateSet(l):i._stateSetStackChanged(e,t)&&i.applyStateSet(l)):(r.moveStateGraph(i,void 0,u),i.applyStateSet(l)),i._setStateSetsDrawID(++e),t=i.getStateSetStackSize(),this.drawGeometry(i)}}()},e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(68),a=function(e,t,i,r){n.call(this),this._x=void 0!==e?e:-1,this._y=void 0!==t?t:-1,this._width=void 0!==i?i:-1,this._height=void 0!==r?r:-1};r.createPrototypeStateAttribute(a,r.objectInherit(n.prototype,{attributeType:"Scissor",cloneType:function(){return new a},apply:function(e){var t=e.getGraphicContext();-1!==this._x?(t.enable(t.SCISSOR_TEST),t.scissor(this._x,this._y,this._width,this._height)):t.disable(t.SCISSOR_TEST)},setScissor:function(e,t,i,r){this._x=e,this._y=t,this._width=i,this._height=r},x:function(){return this._x},y:function(){return this._y},width:function(){return this._width},height:function(){return this._height}}),"osg","Scissor"),e.exports=a},function(e,t,i){"use strict";var r=function(){this.globalDefault=void 0,this.lastApplied=void 0,this.changed=!1,this.values=[],this.back=void 0};r.prototype={push:function(e){this.values.push(e),this.back=e},pop:function(){var e=this.values,t=e.pop();return this.back=e[e.length-1],t}},e.exports=r},function(e,t,i){"use strict";var r=i(8).mat4,n=i(8).mat3,a=i(30),o=i(91),s=i(329),u=i(68),l=i(659),c=i(88),h=i(14),d=i(333),p=[void 0,function(e,t){return e[0]===t[0]||(t[0]=e[0],!1)},function(e,t){return e[0]===t[0]&&e[1]===t[1]||(t[0]=e[0],t[1]=e[1],!1)},function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||(t[0]=e[0],t[1]=e[1],t[2]=e[2],!1)},function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]||(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],!1)}],f=function(e){o.call(this),this._graphicContext=void 0,this._shaderGeneratorProxy=e,void 0===e&&console.break(),this._currentVAO=null,this._currentIndexVBO=null,this._stateSets=new l,this._shaderGeneratorNames=new l,this._uniforms={},this._textureAttributeArrayList=[],this._attributeArray=[],this._projectionMatrix=c.createMatrix4(r.create(),"uProjectionMatrix"),this._modelMatrix=c.createMatrix4(r.create(),"uModelMatrix"),this._viewMatrix=c.createMatrix4(r.create(),"uViewMatrix"),this._modelViewMatrix=c.createMatrix4(r.create(),"uModelViewMatrix"),this._modelNormalMatrix=c.createMatrix3(n.create(),"uModelNormalMatrix"),this._modelViewNormalMatrix=c.createMatrix3(n.create(),"uModelViewNormalMatrix");var t=new l;t.globalDefault=c.createFloat1(0,"uArrayColorEnabled"),this._uniforms.ArrayColorEnabled=t,this._previousColorAttribPair={},this._vertexAttribMap={},this._vertexAttribMap._disable=[],this._vertexAttribMap._keys=[],this._frameStamp=void 0,this._programCommonUniformsCache={},this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0,this._program=void 0;var i=new s;this.applyAttribute(i),this._programType=h.getOrCreateStateAttributeTypeMemberIndex(i),this._programAttribute=this._attributeArray[this._programType],this._numPushStateSet=0,this._numApply=0,this._programUniformCache=[],this._cacheUniformId=0,this.resetStats()};h.createPrototypeObject(f,h.objectInherit(o.prototype,{getCacheUniformsApplyRenderLeaf:function(){return this._programCommonUniformsCache},setGraphicContext:function(e){this._graphicContext=e,this._extVAO=d.instance(e).getWebGLExtension("OES_vertex_array_object")},getGraphicContext:function(){return this._graphicContext},getShaderGeneratorProxy:function(){return this._shaderGeneratorProxy},pushCheckOverride:function(e,t,i){var r,n=this._evaluateOverrideObjectOnStack(e,t,i);r=n!==t?this.getObjectPair(n,e.back.value):this.getObjectPair(t,i),e.push(r)},_evaluateOverrideObjectOnStack:function(e,t,i){var r=e.back;return 0===e.values.length?t:r.value&u.OVERRIDE&&!(i&u.PROTECTED)?r.object:t},pushStateSet:function(e){this._numPushStateSet++,this._stateSets.push(e),this.pushAttributeMap(this._attributeArray,e._attributeArray,e._activeAttribute);for(var t=e._textureAttributeArrayList,i=e._activeTextureAttributeUnit,r=e._activeTextureAttribute,n=0,a=i.length;n<a;n++){var o=i[n],s=t[o],u=this.getOrCreateTextureAttributeArray(o);this.pushAttributeMap(u,s,r)}e.hasUniform()&&this.pushUniformsList(this._uniforms,e.getUniformList());var l=e.getShaderGeneratorPair();l&&this.pushCheckOverride(this._shaderGeneratorNames,l.getShaderGeneratorName(),l.getValue())},getStateSetStackSize:function(){return this._stateSets.values.length},insertStateSet:function(){var e=[];return function(t,i){e.length=0;for(var r=this.getStateSetStackSize();r>t;)e.push(this._stateSets.back),this.popStateSet(),r--;this.pushStateSet(i);for(var n=e.length-1;n>=0;n--)this.pushStateSet(e[n])}}(),removeStateSet:function(){var e=[];return function(t){var i=this.getStateSetStackSize();if(t>=i)return void a.warn("Warning State:removeStateSet "+t+" out of range");for(e.length=0;i-1>t;)e.push(this._stateSets.back),this.popStateSet(),i--;this.popStateSet();for(var r=e.length-1;r>=0;r--)this.pushStateSet(e[r])}}(),resetCacheFrame:function(){this._lastAppliedModelViewMatrix=this._lastAppliedProjectionMatrix=void 0},resetStats:function(){this._numApply=0,this._numPushStateSet=0},applyProgram:function(e){this._program!==e&&(this._program=e,this.getGraphicContext().useProgram(e))},applyModelViewMatrix:function(){var e=n.create();return function(t,i){if(this._lastAppliedModelViewMatrix===t)return!1;var r=this.getLastProgramApplied(),a=r.getUniformsCache(),o=this._modelViewMatrix,s=a.uModelViewMatrix,u=this.getGraphicContext();s&&(o.setMatrix4(t),o.apply(u,s));var l;if(this._lastAppliedModelViewMatrix){for(var c=this._lastAppliedModelViewMatrix,h=0;h<11;h++)if(t[h]!==c[h]){l=!0;break}}else l=!0;return l&&(o=this._modelViewNormalMatrix,s=a.uModelViewNormalMatrix,s&&(n.normalFromMat4(e,t),o.setMatrix3(e),o.apply(u,s)),(s=a.uModelNormalMatrix)&&(n.normalFromMat4(e,i),o.setMatrix3(e),o.apply(u,s))),this._lastAppliedModelViewMatrix=t,!0}}(),applyProjectionMatrix:function(e){if(this._lastAppliedProjectionMatrix!==e){this._lastAppliedProjectionMatrix=e;var t=this.getLastProgramApplied(),i=this._projectionMatrix,r=t.getUniformsCache()[i.getName()];r&&(i.setMatrix4(e),i.apply(this.getGraphicContext(),r))}},getCurrentShaderGeneratorStateSet:function(e){var t=this._programAttribute,i=e._attributeArray[this._programType];if(!(0!==t.values.length&&t.back.value!==u.OFF||i&&i.getValue()!==u.OFF)){var r,n=e.getShaderGeneratorPair(),a=this._shaderGeneratorNames;if(n){var o=n.getValue(),s=n.getShaderGeneratorName();r=this._evaluateOverrideObjectOnStack(this._shaderGeneratorNames,s,o)}else a.values.length&&(r=a.back.object);var l=r;return this._shaderGeneratorProxy.getShaderGenerator(l)}},_applyAttributeMapStateSet:function(e,t){for(var i=e.length>t.length?e.length:t.length,r=0,n=i;r<n;r++){var a,o=r,s=e[o],u=t[o],l=void 0!==s,c=l&&s.changed;if(u||c){var h=u?u.getAttribute():void 0;if(l)if(h){var d=u.getValue();a=this._evaluateOverrideObjectOnStack(s,h,d),a!==h?s.changed&&(this._applyAttributeStack(a,s),s.changed=!1):this._applyAttributeStack(a,s)&&(s.changed=!0)}else s.values.length?(s.changed=!1,this._applyAttributeStack(s.back.object,s)):(s.changed=!1,this._applyAttributeStack(s.globalDefault,s));else s=this._createAttributeStack(e,o,h.cloneType()),s.changed=!0,this._applyAttributeStack(h,s)}}},_applyTextureAttributeMapListStateSet:function(e,t){for(var i,r,n,a=0;a<16;a++){var o=a;i=e[o];var s=t[o];if(i||s){r=n=0,i?(n=i.length,s&&(r=s.length)):(i=this.getOrCreateTextureAttributeArray(o),r=s.length);for(var u=n>r?n:r,l=0;l<u;l++){var c,h=l,d=i[h],p=s?s[h]:void 0,f=void 0!==d,g=f&&d.changed;if(p||g){var m=p?p.getAttribute():void 0;if(f)if(m){var v=p.getValue();c=this._evaluateOverrideObjectOnStack(d,m,v),c!==m?d.changed&&(this._applyTextureAttribute(o,c,d),d.changed=!1):this._applyTextureAttribute(o,c,d)&&(d.changed=!0)}else d.values.length?(d.changed=!1,this._applyTextureAttribute(o,d.back.object,d)):(d.changed=!1,this._applyTextureAttribute(o,d.globalDefault,d));else c=p.getAttribute(),d=this._createAttributeStack(i,h,c.cloneType()),d.changed=!0,this._applyTextureAttribute(o,c,d)}}}}},applyStateSet:function(e){this._numApply++;var t=this.getLastProgramApplied();this._currentShaderGenerator=this.getCurrentShaderGeneratorStateSet(e),this._applyAttributeMapStateSet(this._attributeArray,e._attributeArray),this._applyTextureAttributeMapListStateSet(this._textureAttributeArrayList,e._textureAttributeArrayList);var i,r;this._currentShaderGenerator?(r=this._currentShaderGenerator.getOrCreateProgram(this),this.applyAttribute(r),i=r,this._applyGeneratedProgramUniforms(r,e)):(i=this.getLastProgramApplied(),this._applyCustomProgramUniforms(i,e)),t!==i&&(this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0)},popAllStateSets:function(){for(;this._stateSets.values.length;)this.popStateSet()},popStateSet:function(){if(this._stateSets.values.length){var e=this._stateSets.pop();this.popAttributeMap(this._attributeArray,e._attributeArray,e._activeAttribute);for(var t=e._textureAttributeArrayList,i=e._activeTextureAttributeUnit,r=e._activeTextureAttribute,n=0,a=i.length;n<a;n++){var o=i[n],s=t[o],u=this.getOrCreateTextureAttributeArray(o);this.popAttributeMap(u,s,r)}e.hasUniform()&&this.popUniformsList(this._uniforms,e.getUniformList()),e.getShaderGeneratorPair()&&this._shaderGeneratorNames.pop()}},_createAttributeStack:function(e,t,i){var r=new l;return r.globalDefault=i,e[t]=r,r},haveAppliedAttribute:function(e){if(e){var t=h.getOrCreateStateAttributeTypeMemberIndex(e),i=this._attributeArray[t];i||(i=this._createAttributeStack(this._attributeArray,t,e.cloneType())),i.lastApplied=e,i.changed=!0}},applyAttribute:function(e){var t=h.getOrCreateStateAttributeTypeMemberIndex(e),i=this._attributeArray,r=i[t];r||(r=this._createAttributeStack(i,t,e.cloneType())),r.changed=!0,this._applyAttributeStack(e,r)},_applyAttributeStack:function(e,t){return t.lastApplied!==e&&(e.apply&&e.apply(this),t.lastApplied=e,!0)},_applyTextureAttribute:function(e,t,i){if(i.lastApplied===t)return!1;if(i.lastApplied=t,!t.apply)return!0;var r=this.getGraphicContext();return r.activeTexture(r.TEXTURE0+e),t.apply(this,e),!0},applyTextureAttribute:function(e,t){var i=h.getOrCreateTextureStateAttributeTypeMemberIndex(t),r=this.getOrCreateTextureAttributeArray(e),n=r[i];n||(n=this._createAttributeStack(r,i,t.cloneType())),n.changed=!0,this._applyTextureAttribute(e,t,n)},getLastProgramApplied:function(){return this._programAttribute.lastApplied},applyDefault:function(){this.popAllStateSets(),this._currentShaderGenerator=void 0,this.applyAttributeMap(this._attributeArray),this.applyTextureAttributeMapList(this._textureAttributeArrayList)},apply:function(){this._numApply++;var e=this.getLastProgramApplied();this._currentShaderGenerator=this.getCurrentShaderGenerator(),this.applyAttributeMap(this._attributeArray),this.applyTextureAttributeMapList(this._textureAttributeArrayList);var t,i;this._currentShaderGenerator?(i=this._currentShaderGenerator.getOrCreateProgram(this),this.applyAttribute(i),t=i,this._applyGeneratedProgramUniforms(i)):(t=this.getLastProgramApplied(),this._applyCustomProgramUniforms(t)),e!==t&&(this._lastAppliedModelViewMatrix=void 0,this._lastAppliedProjectionMatrix=void 0)},applyAttributeMap:function(e){for(var t,i=0,r=e.length;i<r;i++)if(t=e[i]){var n;n=t.values.length?t.back.object:t.globalDefault,t.changed&&(t.lastApplied!==n&&(n.apply&&n.apply(this),t.lastApplied=n),t.changed=!1)}},getObjectPair:function(){return function(e,t){return{value:t,object:e}}}(),pushUniformsList:function(e,t){var i,r;for(var n in t){var a=t[n];r=a.getUniform(),i=r.getName(),e[i]||this._createAttributeStack(e,i,r),this.pushCheckOverride(e[i],r,a.getValue())}},popUniformsList:function(e,t){for(var i in t)e[i].pop()},applyTextureAttributeMapList:function(e){for(var t,i=this._graphicContext,r=0,n=e.length;r<n;r++)if(t=e[r])for(var a=0,o=t.length;a<o;a++){var s=t[a];if(s){var u;u=s.values.length?s.back.object:s.globalDefault,s.changed&&(s.lastApplied!==u&&(i.activeTexture(i.TEXTURE0+r),u.apply(this,r),s.lastApplied=u),s.changed=!1)}}},setGlobalDefaultAttribute:function(e){var t=this._attributeArray,i=h.getOrCreateStateAttributeTypeMemberIndex(e);void 0===t[i]?this._createAttributeStack(t,i,e):t[i].globalDefault=e},getGlobalDefaultAttribute:function(e){var t=this._attributeArray,i=h.getIdFromTypeMember(e);if(void 0!==i)return t[i]?t[i].globalDefault:void 0},setGlobalDefaultTextureAttribute:function(e,t){var i=this.getOrCreateTextureAttributeArray(e),r=h.getOrCreateTextureStateAttributeTypeMemberIndex(t);void 0===i[r]?this._createAttributeStack(i,r,t):i[r].globalDefault=t},getGlobalDefaultTextureAttribute:function(e,t){var i=this.getOrCreateTextureAttributeArray(e),r=h.getTextureIdFromTypeMember(t);if(void 0!==r)return i[r]?i[r].globalDefault:void 0},getOrCreateTextureAttributeArray:function(e){return this._textureAttributeArrayList[e]||(this._textureAttributeArrayList[e]=[]),this._textureAttributeArrayList[e]},pushAttributeMap:function(e,t,i){for(var r,n=0,a=i.length;n<a;n++){var o=i[n],s=t[o],u=s.getAttribute();r=e[o],r||(this._createAttributeStack(e,o,u.cloneType()),r=e[o]),this.pushCheckOverride(r,u,s.getValue()),r.changed=!0}},popAttributeMap:function(e,t,i){for(var r=0,n=i.length;r<n;r++){var a=i[r],o=e[a];o.pop(),o.changed=!0}},setIndexArray:function(e){var t=this._graphicContext;this._currentIndexVBO!==e&&(e.bind(t),this._currentIndexVBO=e),e.isDirty()&&e.compile(t)},lazyDisablingOfVertexAttributes:function(){for(var e=this._vertexAttribMap._keys,t=0,i=e.length;t<i;t++){var r=e[t];this._vertexAttribMap[r]&&(this._vertexAttribMap._disable[r]=!0)}},enableVertexColor:function(){var e=this._programAttribute.lastApplied;if(e.getUniformsCache().uArrayColorEnabled&&e.getAttributesCache().Color){var t=this._uniforms.ArrayColorEnabled.globalDefault;this._previousColorAttribPair[e.getInstanceID()]||(t.setFloat(1),t.apply(this.getGraphicContext(),e.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[e.getInstanceID()]=!0)}},disableVertexColor:function(){var e=this._programAttribute.lastApplied;if(e.getUniformsCache().uArrayColorEnabled&&e.getAttributesCache().Color){var t=this._uniforms.ArrayColorEnabled.globalDefault;this._previousColorAttribPair[e.getInstanceID()]&&(t.setFloat(0),t.apply(this.getGraphicContext(),e.getUniformsCache().uArrayColorEnabled),this._previousColorAttribPair[e.getInstanceID()]=!1)}},applyDisablingOfVertexAttributes:function(){for(var e=this._vertexAttribMap._keys,t=0,i=e.length;t<i;t++)if(!0===this._vertexAttribMap._disable[e[t]]){var r=e[t];this._graphicContext.disableVertexAttribArray(r),this._vertexAttribMap._disable[r]=!1,this._vertexAttribMap[r]=!1}},clearVertexAttribCache:function(){for(var e=this._vertexAttribMap,t=e._keys,i=0,r=t.length;i<r;i++){var n=t[i];e[n]=void 0,e._disable[n]=!1}this._vertexAttribMap._disable.length=0,this._vertexAttribMap._keys.length=0},setVertexArrayObject:function(e){return this._currentVAO!==e&&(this._graphicContext.bindVertexArray(e),this._currentVAO=e,e||this.clearVertexAttribCache(),this._currentIndexVBO=void 0,!0)},setVertexAttribArray:function(e,t,i){var r=this._vertexAttribMap;r._disable[e]=!1;var n=this._graphicContext,a=!1;t.isDirty()&&(t.bind(n),t.compile(n),a=!0);var o=r[e];o!==t&&(a||t.bind(n),o||(n.enableVertexAttribArray(e),void 0===o&&r._keys.push(e)),r[e]=t,n.vertexAttribPointer(e,t.getItemSize(),t.getType(),i,0,0))},_getActiveUniformsFromProgramAttributes:function(e,t){var i=this._attributeArray,r=e.getTrackAttributes().attributeKeys;if(r.length>0)for(var n=0,a=r.length;n<a;n++){var o=r[n],s=this.typeMember[o],u=i[s];if(void 0!==u){var l=u.globalDefault;if(void 0!==l.getOrCreateUniforms){var c=l.getOrCreateUniforms();for(var h in c)t.push(c[h])}}}},_getActiveUniformsFromProgramTextureAttributes:function(e,t){var i=e.getTrackAttributes().textureAttributeKeys;if(void 0!==i)for(var r=0,n=i.length;r<n;r++){var a=i[r];if(void 0!==a){var o=this._textureAttributeArrayList[r];if(void 0!==o)for(var s=0,u=a.length;s<u;s++){var l=a[s],c=o[l];if(void 0!==c){var h=c.globalDefault;if(void 0!==h.getOrCreateUniforms){var d=h.getOrCreateUniforms();for(var p in d)t.push(d[p])}}}}}},_cacheUniformsForCustomProgram:function(e,t){this._getActiveUniformsFromProgramAttributes(e,t),this._getActiveUniformsFromProgramTextureAttributes(e,t);for(var i=this._graphicContext,r={},n=0,a=t.length;n<a;n++){var o=t[n],s=o.getName(),u=i.getUniformLocation(e._program,s);void 0!==u&&null!==u&&(r[s]=o)}e.trackUniforms=r},_applyCustomProgramUniforms:function(){var e=[];return function(t,i){e.length=0,void 0!==t.getTrackAttributes()&&void 0===t.trackUniforms&&this._cacheUniformsForCustomProgram(t,e);var r,n=t.getUniformsCache(),a=this._uniforms;t.trackUniforms&&(r=t.trackUniforms);var o;for(var s in n){var u=n[s],l=a[s],c=i&&i.uniforms[s];if(l||c)if(c){var h=i.uniforms[s],d=h.getValue(),p=h.getUniform();o=l?this._evaluateOverrideObjectOnStack(l,p,d):p}else o=l.values.length?l.back.object:l.globalDefault;else{if(void 0===r)continue;o=r[s]}o.apply(this._graphicContext,u)}}}(),getCurrentShaderGenerator:function(){var e=this._programAttribute;if(void 0===e||0===e.values.length||e.back.value===u.OFF){var t=this._shaderGeneratorNames.back;return this._shaderGeneratorProxy.getShaderGenerator(t?t.object:void 0)}},_computeForeignUniforms:function(e,t){var i=e,r=[];for(var n in e){void 0!==i[n]&&void 0===t[n]&&n!==this._modelViewMatrix.getName()&&n!==this._modelMatrix.getName()&&n!==this._viewMatrix.getName()&&n!==this._projectionMatrix.getName()&&n!==this._modelViewNormalMatrix.getName()&&n!==this._modelNormalMatrix.getName()&&"uArrayColorEnabled"!==n&&r.push(n)}return r},_removeUniformsNotRequiredByProgram:function(e,t){for(var i in e){var r=t[i];void 0!==r&&null!==r||delete e[i]}},_cacheUniformsForGeneratedProgram:function(e){var t=e.getUniformsCache(),i=this._computeForeignUniforms(t,e.getActiveUniforms());e.setForeignUniforms(i),this._removeUniformsNotRequiredByProgram(e.getActiveUniforms(),e.getUniformsCache())},_copyUniformEntry:function(e){var t,i=e.getInternalArray();return i.length<16&&(t=new i.constructor(i.length)),t},_initUniformCache:function(e){var t,i,r,n,a,o,s=e.getActiveUniforms(),u=e.getForeignUniforms(),l=this._uniforms,c=[],h=[];if(e._cacheUniformId=this._cacheUniformId++,this._programUniformCache[e._cacheUniformId]={},u.length)for(r=c,t=0,i=u.length;t<i;t++){n=u[t];var d=l[n];d&&(o=d.globalDefault,a=this._copyUniformEntry(o),r.push(a))}for(var p in s)o=s[p],a=this._copyUniformEntry(o),h.push(a);this._programUniformCache[e._cacheUniformId].foreign=c,this._programUniformCache[e._cacheUniformId].active=h},_checkCacheAndApplyUniform:function(e,t,i,r,n){var a,o=e.getInternalArray(),s=o.length;if(s<=4){var u=t[i];a=p[s](o,u)}else a=!1;if(!a){var l=r[n];e.apply(this._graphicContext,l)}},_applyGeneratedProgramUniforms:function(e,t){var i,r,n,o,s=this._uniforms,u=e.getForeignUniforms();if(!u){if(this._cacheUniformsForGeneratedProgram(e),u=e.getForeignUniforms(),t){var l=t.uniforms;for(o=0;o<u.length;o++)r=u[o],s[r]||l[r]&&(i=l[r].getUniform(),this._createAttributeStack(s,r,i))}this._initUniformCache(e)}var c,h,d=e.getUniformsCache(),p=e.getActiveUniforms(),f=this._programUniformCache[e._cacheUniformId].active,g=this._programUniformCache[e._cacheUniformId].foreign;o=0;for(h in p)i=p[h],this._checkCacheAndApplyUniform(i,f,o,d,h),o++;for(o=0,c=u.length;o<c;o++){r=u[o],n=s[r];var m=t&&t.uniforms[r];if(m||n){if(n)if(m){var v=t.uniforms[r],_=v.getValue(),b=v.getUniform();i=this._evaluateOverrideObjectOnStack(n,b,_)}else n.values.length?i=n.back.object:(i=n.globalDefault,a.warn("Uniform Default Not attached to a StateSet in Scene Hierarchy: "+r));else a.error("Uniform name not in the scene hierarchy! : "+r),i=t.uniforms[r].getUniform(),this._createAttributeStack(s,r,i);this._checkCacheAndApplyUniform(i,g,o,d,r)}}},_setStateSetsDrawID:function(e){for(var t=this._stateSets.values,i=0,r=t.length;i<r;i++)t[i].setDrawID(e)},_stateSetStackChanged:function(e,t){var i=this._stateSets.values,r=i.length;if(t!==r)return!0;for(var n=0;n<r;n++)if(e!==i[n].getDrawID())return!0;return!1}}),"osg","State"),e.exports=f},function(e,t,i){"use strict";var r=i(14),n=i(135),a=i(67),o=function(){n.call(this),this._values=[]};r.createPrototypeNode(o,r.objectInherit(n.prototype,{addChild:function(e,t){return n.prototype.addChild.call(this,e),void 0===t&&(t=!0),this.children.length>this._values.length?this._values.push(t):this._values[this.children.length-1]=t,!0},setValue:function(e,t){e<this._values.length&&(this._values[e]=t)},getValue:function(e){if(e<this._values.length)return this._values[e]},setAllChildrenOff:function(){for(var e=0;e<this._values.length;++e)this._values[e]=!1},setAllChildrenOn:function(){for(var e=0;e<this._values.length;++e)this._values[e]=!0},traverse:function(){return function(e){switch(e.traversalMode){case a.TRAVERSE_ALL_CHILDREN:for(var t=0;t<this.children.length;++t)this.children[t].accept(e);break;case a.TRAVERSE_ACTIVE_CHILDREN:var i=this.children.length;for(this._values.length<i&&(i=this._values.length),t=0;t<i;++t)!0===this._values[t]&&this.children[t].accept(e)}}}()}),"osg","Switch"),e.exports=o},function(e,t,i){"use strict";var r=i(30),n=i(333),a=function(e){if(this._enabled=!1,e){var t=n.instance(e).getDisjointTimerQuery();if(!t)return this;if(e.getQueryParameter||(e.getQueryParameter=t.getQueryObjectEXT.bind(t)),this._hasTimeElapsed=e.getQuery(t.TIME_ELAPSED_EXT,t.QUERY_COUNTER_BITS_EXT)>=30,this._hasTimeStamp=e.getQuery(t.TIMESTAMP_EXT,t.QUERY_COUNTER_BITS_EXT)>=30,!this._hasTimeElapsed&&!this._hasTimeStamp)return this;this._hasTimeStamp||r.debug("Warning: do not use interleaved GPU query"),this._ext=t,this._gl=e,this._enabled=!0}this._frameAverageCount=10,this._glQueries=[],this._queriesByID={},this._userQueries=[],this._queryCount=0,this._nbOpened=0};a.FRAME_COUNT=0,a.instance=function(e){return a._instance?e&&a._instance.getContext()!==e&&a._instance.setContext(e):a._instance=new a(e),a._instance},a.prototype={getContext:function(){return this._gl},setContext:function(e){this._gl=e},setFrameAverageCount:function(e){this._frameAverageCount=e},clearQueries:function(){for(var e=this._glQueries,t=0,i=e.length;t<i;++t){var r=e[t];this._gl.deleteQuery(r._pollingStartQuery),r._pollingEndQuery&&this._gl.deleteQuery(r)}this._userQueries.length=0,this._glQueries.length=0,this._queriesByID={}},supportTimeStamp:function(){return this._hasTimeStamp},enable:function(){this._enabled=!!this._ext},disable:function(){this._enabled=!1},isEnabled:function(){return this._enabled},setCallback:function(e){this._callback=e},createUserQuery:function(e){var t;return t=this._hasTimeStamp?this.createGLQuery():{_startIndex:0,_endIndex:0},t._id=e,t._frame=a.FRAME_COUNT,t._isOpened=!0,t._siblings=[],t},createGLQuery:function(){var e={};return e._isWaiting=!1,e._pollingStartQuery=void 0,e._pollingEndQuery=void 0,e._averageTimer=0,e._resultCount=0,this._hasTimeStamp&&(e._pollingEndQuery=this._gl.createQuery()),e._pollingStartQuery=this._gl.createQuery(),this._glQueries.push(e),e},getOrCreateLastGLQuery:function(){var e=this._glQueries[this._queryCount-1];return e||(e=this._glQueries[this._queryCount-1]=this.createGLQuery())},beginCurrentQuery:function(){if(0!==this._nbOpened){this._queryCount++;var e=this.getOrCreateLastGLQuery();e._isWaiting||this._gl.beginQuery(this._ext.TIME_ELAPSED_EXT,e._pollingStartQuery)}},endCurrentQuery:function(){0!==this._nbOpened&&(this.getOrCreateLastGLQuery()._isWaiting||this._gl.endQuery(this._ext.TIME_ELAPSED_EXT))},getAvailableQueryByID:function(e){var t=this._queriesByID[e];if(!t)return t=this._queriesByID[e]=this.createUserQuery(e),this._userQueries.push(t),t;if(t._frame===a.FRAME_COUNT){if(t._isOpened)return t;for(var i=t._siblings,r=0,n=i.length;r<n;++r){var o=i[r];if(o._frame!==a.FRAME_COUNT||o._isOpened)return o._frame=a.FRAME_COUNT,o}var s=this.createUserQuery();return i.push(s),s}return t._frame=a.FRAME_COUNT,t},start:function(e){if(this._enabled){var t=this.getAvailableQueryByID(e);t._isOpened=!0,this._hasTimeStamp?t._isWaiting||this._ext.queryCounterEXT(t._pollingStartQuery,this._ext.TIMESTAMP_EXT):(this.endCurrentQuery(),this._nbOpened++,t._startIndex=this._queryCount,this.beginCurrentQuery())}},end:function(e){if(this._enabled){var t=this.getAvailableQueryByID(e);t._isOpened=!1,this._hasTimeStamp?t._isWaiting||this._ext.queryCounterEXT(t._pollingEndQuery,this._ext.TIMESTAMP_EXT):(this.endCurrentQuery(),t._endIndex=this._queryCount,this._nbOpened--,this.beginCurrentQuery())}},computeQueryAverageTime:function(e){for(var t=0,i=this._glQueries,r=e._startIndex;r<e._endIndex;++r){var n=i[r]._averageTimer;if(n<0)return-1;t+=n}return t},computeFullAverageTime:function(e){var t=this.computeQueryAverageTime(e);if(t<0)return-1;for(var i=e._siblings,r=0,n=i.length;r<n;++r){var o=i[r];if(o._frame===a.FRAME_COUNT-1){var s=this.computeQueryAverageTime(o);if(s<0)return-1;t+=s}}return t},pollQueries:function(){if(a.FRAME_COUNT++,this._queryCount=0,this._nbOpened=0,this._enabled&&this._callback){var e,t=this._glQueries,i=t.length;if(this._gl.getParameter(this._ext.GPU_DISJOINT_EXT))for(e=0;e<i;++e)t[e]._isWaiting=!1;else{for(e=0;e<i;++e)this.pollQuery(t[e]);var r=this._userQueries,n=r.length;for(e=0;e<n;++e){var o=r[e],s=this.computeFullAverageTime(o);s>0&&this._callback(s,o._id)}}}},pollQuery:function(e){e._isWaiting=!1;var t=this._hasTimeStamp?e._pollingEndQuery:e._pollingStartQuery;if(!this._gl.getQueryParameter(t,this._gl.QUERY_RESULT_AVAILABLE))return e._isWaiting=!0,0;var i;if(this._hasTimeStamp){var r=this._gl.getQueryParameter(e._pollingStartQuery,this._gl.QUERY_RESULT);i=this._gl.getQueryParameter(t,this._gl.QUERY_RESULT)-r}else i=this._gl.getQueryParameter(t,this._gl.QUERY_RESULT);return e._resultCount++,e._resultCount>this._frameAverageCount&&(e._averageTimer=0,e._resultCount=1),e._averageTimer=e._averageTimer+(i-e._averageTimer)/e._resultCount,e._averageTimer}},e.exports=a},function(e,t,i){"use strict";var r=i(136),n=i(292),a=i(291),o=function(){},s=o.functorDrawElements=[],u=o.functorDrawArrays=[];s[r.TRIANGLES]=function(e,t,i,r){for(var n=e+t,a=e;a<n;a+=3)r(i[a],i[a+1],i[a+2])},s[r.TRIANGLE_STRIP]=function(e,t,i,r){for(var n=2,a=e;n<t;++n,++a)n%2?r(i[a],i[a+2],i[a+1]):r(i[a],i[a+1],i[a+2])},s[r.TRIANGLE_FAN]=function(e,t,i,r){for(var n=i[e],a=2,o=e+1;a<t;++a,++o)r(n,i[o],i[o+1])},u[r.TRIANGLES]=function(e,t,i){for(var r=2,n=e;r<t;r+=3,n+=3)i(n,n+1,n+2)},u[r.TRIANGLE_STRIP]=function(e,t,i){for(var r=2,n=e;r<t;++r,++n)r%2?i(n,n+2,n+1):i(n,n+1,n+2)},u[r.TRIANGLE_FAN]=function(e,t,i){for(var r=2,n=e+1;r<t;++r,++n)i(e,n,n+1)},o.prototype={init:function(e,t){this._geom=e,this._cb=t},apply:function(){var e=this._geom,t=e.getPrimitiveSetList();if(t)for(var i,r=this._cb,o=t.length,l=0;l<o;l++){var c=t[l];if(c instanceof n){if(i=s[c.getMode()]){var h=c.indices.getElements();i(c.getFirst()/h.BYTES_PER_ELEMENT,c.getCount(),h,r)}}else c instanceof a&&(i=u[c.getMode()])&&i(c.getFirst(),c.getCount(),r)}}},e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(67),a=function(){n.call(this),this.visitorType=n.UPDATE_VISITOR,this._numUpdateCallback=0};r.createPrototypeObject(a,r.objectInherit(n.prototype,{resetStats:function(){this._numUpdateCallback=0},apply:function(e){var t=e.getStateSet();if(t&&t.requiresUpdateTraversal()){var i=t.getUpdateCallbackList(),r=i.length;if(r){this._numUpdateCallback+=r;for(var n=0,a=r;n<a;n++)i[n].update(t,this)}}for(var o=e.getUpdateCallbackList(),s=o.length,u=0;u<s;u++)if(this._numUpdateCallback++,!o[u].update(e,this))return;e.getNumChildrenRequiringUpdateTraversal()>0&&this.traverse(e)}}),"osg","NodeVisitor"),e.exports=a},function(e,t,i){"use strict";var r=[],n=function(e,t){r[e]=t},a=function(e){return r[e]};e.exports={applyFunctionArray:r,registerApplyFunction:n,getApplyFunction:a}},function(e,t,i){"use strict";var r=i(562),n=i(887),a=i(888),o=i(381),s=i(363),u=i(421),l=i(164),c=i(274),h=i(889),d=i(496),p=i(455),f=i(563),g=i(651),m=i(450),v=i(650),_=i(451),b=i(382),x=i(652),S=i(291),y=i(292),C=i(890),T=i(383),M=i(653),w=i(145),A=i(422),E=i(452),P=i(891),N=i(654),F=i(892),R=i(453),I=i(564),O=i(893),L=i(565),D=i(566),k=i(426),B=i(423),V=i(165),U=i(135),G=i(67),z=i(30),j=i(91),H=i(567),W=i(568),q=i(569),Y=i(894),X=i(424),K=i(655),J=i(656),Q=i(136),Z=i(329),$=i(570),ee=i(497),te=i(657),ie=i(571),re=i(330),ne=i(384),ae=i(659),oe=i(660),se=i(68),ue=i(454),le=i(293),ce=i(661),he=i(97),de=i(895),pe=i(332),fe=i(663),ge=i(88),me=i(664),ve=i(14),_e=i(425),be=i(505),xe=i(658),Se=i(146),ye=i(331),Ce=i(662),Te=i(333),Me={};Me.AutoTransform=r,Me.BillboardAttribute=n,Me.BlendColor=a,Me.BlendFunc=o,Me.BoundingBox=s,Me.BoundingSphere=u,Me.BufferArray=l,Me.ColorMask=h,Me.Camera=c,Me.ColorMask=h,Me.ComputeBoundsVisitor=d,ve.objectMix(Me,p),Me.CullFace=f,Me.CullingSet=g,Me.CullSettings=m,Me.CullStack=v,Me.CullVisitor=_,Me.Depth=b,Me.DrawArrayLengths=x,Me.DrawArrays=S,Me.DrawElements=y,Me.EllipsoidModel=C,Me.WGS_84_RADIUS_EQUATOR=C.WGS_84_RADIUS_EQUATOR,Me.WGS_84_RADIUS_POLAR=C.WGS_84_RADIUS_POLAR,Me.FrameBufferObject=T,Me.FrameStamp=M,Me.Geometry=w,Me.GLObject=A,Me.Image=E,Me.ImageStream=P,Me.KdTree=N,Me.KdTreeBuilder=F,Me.Light=R,Me.LightSource=I,Me.LineWidth=O,Me.Lod=L,Me.Material=D,ve.objectMix(Me,k),Me.MatrixTransform=V,Me.MatrixMemoryPool=B,Me.Node=U,Me.NodeVisitor=G,ve.objectMix(Me,z),Me.Object=j,Me.Options=H,Me.PagedLOD=W,Me.Plane=X,Me.PointSizeAttribute=Y,Me.Polytope=q,Me.primitiveSet=Q,Me.PrimitiveFunctor=K,Me.PrimitiveIndexFunctor=J,Me.Program=Z,Me.Projection=$,Me.RenderBin=ee,Me.RenderLeaf=te,Me.RenderStage=ie,Me.Shader=re,ve.objectMix(Me,ne),Me.Stack=ae,Me.State=oe,Me.StateAttribute=se,Me.StateGraph=ue,Me.StateSet=le,Me.Scissor=xe,Me.Switch=ce,Me.Texture=he,Me.TextureCubeMap=de,Me.Transform=pe,Me.TriangleIndexFunctor=fe,Me.Uniform=ge,Me.UpdateVisitor=me,ve.objectMix(Me,ve),Me.Viewport=_e;var we=i(8);Me.vec2=we.vec2,Me.vec3=we.vec3,Me.vec4=we.vec4,Me.quat=we.quat,Me.mat3=we.mat3,Me.mat4=we.mat4,Me.memoryPools=be.memoryPools,Me.Transform.RELATIVE_RF=Se.RELATIVE_RF,Me.Transform.ABSOLUTE_RF=Se.ABSOLUTE_RF,Me.Timer=ye,Me.TimerGPU=Ce,Me.WebGLCaps=Te,e.exports=Me},function(e,t,i){"use strict";var r=i(30),n=i(14),a=i(91),o=i(8).quat,s=i(8).vec3,u=i(8).mat4,l=i(429),c=i(500),h=i(676),d=i(668),p=i(364),f=i(574),g={lerp:function(e,t,i){return e+(t-e)*i},init:function(){return 0},copy:function(e){return e},create:function(){return 0}},m=[];m[l.ChannelType.Float]=1,m[l.ChannelType.FloatCubicBezier]=1,m[l.ChannelType.Vec3]=3,m[l.ChannelType.Vec3CubicBezier]=3,m[l.ChannelType.Quat]=4,m[l.ChannelType.QuatSlerp]=4,m[l.ChannelType.Matrix]=16;var v=[];v.length=l.ChannelType.Count,v[l.ChannelType.Vec3]=s,v[l.ChannelType.Quat]=o,v[l.ChannelType.QuatSlerp]=o,v[l.ChannelType.Float]=g,v[l.ChannelType.FloatCubicBezier]=g,v[l.ChannelType.Vec3CubicBezier]=s,v[l.ChannelType.Matrix]=u;var _=function(){a.call(this),this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._targets=[],this._targetsMap={},this._targetsByTypes=[],this._targetsByTypes.length=l.ChannelType.Count;for(var e=0,t=this._targetsByTypes.length;e<t;e++)this._targetsByTypes[e]=[];this._activeAnimations={},this._activeAnimationList=[],this._activeChannelsByTypes=[],this._activeChannelsByTypes.length=l.ChannelType.Count;for(var i=0,r=this._activeChannelsByTypes.length;i<r;i++)this._activeChannelsByTypes[i]=[];this._animationsUpdateCallback={},this._animationsUpdateCallbackArray=[],this._animationsToRegister=[],this._pause=!1,this._dirty=!1,this._seekTime=-1};n.createPrototypeObject(_,n.objectInherit(a.prototype,{init:function(e){this._simulationTime=0,this._pauseTime=0,this._timeFactor=1,this._startTime=0,this._instanceAnimations={},this._startAnimations={},this._resetTargets(),this._activeAnimations={},this._activeAnimationList.length=0;for(var t=0,i=this._activeChannelsByTypes.length;t<i;t++)this._activeChannelsByTypes[t].length=0;this._animationsUpdateCallback={},this._animationsUpdateCallbackArray.length=0,this._pause=!1,this._seekTime=-1,this.addAnimations(e)},addAnimations:function(e){var t=this._addAnimation(e);Array.prototype.push.apply(this._animationsToRegister,t),this._dirty=!0,this._registerAnimations()},update:function(e,t){this._dirty&&(this._findAnimationUpdateCallback(e),this._registerTargetFoundInAnimationCallback(),this._registerAnimations());var i=t.getFrameStamp().getSimulationTime();return-1!==this._seekTime&&(this._pauseTime=-this._seekTime+this._startTime+i),this._seekTime=-1,this._pause?this._pauseTime=i-this._simulationTime+this._startTime:this._simulationTime=this._startTime+(i-this._pauseTime),this.updateManager(this._simulationTime*this._timeFactor),!0},updateManager:function(e){this._processStartAnimation(e);for(var t=l.ChannelType.Count,i=0;i<t;i++){var r=this._activeChannelsByTypes[i];this._updateChannelsType(e,r,h[i])}for(var n=0;n<t;n++){var a=this._targetsByTypes[n];this._updateTargetType(a,v[n])}for(var o=0,s=this._animationsUpdateCallbackArray.length;o<s;o++){this._animationsUpdateCallbackArray[o].computeChannels()}this._removeFinishedAnimation(e)},togglePause:function(){this._pause=!this._pause,this._pause||(this._seekTime=this._simulationTime)},getSimulationTime:function(){return this._simulationTime},setSimulationTime:function(e){this._simulationTime=e},setSeekTime:function(e){this._simulationTime=e,this._seekTime=e},stopAnimation:function(e){for(var t=this._activeAnimationList,i=0,r=t.length;i<r;++i)if(t[i].name===e)return this._removeActiveChannels(this._instanceAnimations[e]),this._activeAnimations[e]=void 0,void t.splice(i,1)},stopAllAnimation:function(){for(var e=this._activeAnimationList,t=0,i=e.length;t<i;++t){var r=e[t].name;this._removeActiveChannels(this._instanceAnimations[r]),this._activeAnimations[r]=void 0}e.length=0},setTimeFactor:function(e){var t=e/this._timeFactor;this._startTime+=(this._simulationTime-this._simulationTime*t)/t,this._timeFactor=e,this._pause&&(this._simulationTime+=(this._simulationTime-this._simulationTime*t)/t)},getTimeFactor:function(){return this._timeFactor},isPlaying:function(e){return!!this._activeAnimations[e]},playAnimationObject:function(e){var t=this._instanceAnimations[e.name];if(!t)return void r.info("no animation "+e.name+" found");this.isPlaying(e.name)||(t.priority=void 0===e.priority?0:e.priority,t.weight=void 0===e.weight?1:e.weight,t.loop=void 0===e.loop||e.loop,this._startAnimations[t.name]=t)},playAnimation:function(e,t,i,r){var n;return n="object"==typeof e?e:{name:e,priority:i,weight:r,loop:t},this.playAnimationObject(n)},getAnimations:function(){return this._instanceAnimations},_registerAnimations:function(){if(this._targets.length){for(var e=0,t=this._animationsToRegister.length;e<t;e++){var i=this._animationsToRegister[e];this._registerInstanceAnimation(i)}this._animationsToRegister.length=0,this._dirty=!1}},_registerInstanceAnimation:function(e){for(var t=e.channels,i=0,n=t.length;i<n;i++){var a=t[i],o=a.channel.target,s=a.channel.name,u=o+"."+s;this._targetMap[u]?a.targetID=this._targetMap[u].id:r.warn("registerInstanceAnimation did not find targetName ("+u+") in the scene graph")}return!0},_findAnimationUpdateCallback:function(e){var t=new d;e.accept(t),this._animationsUpdateCallback=t.getAnimationUpdateCallbackMap()},_registerTargetFoundInAnimationCallback:function(){this._resetTargets();var e,t,i,n=0,a=this._targetMap,o=this._targets,s=function(e,t,i){if(a[e])t!==a[e]&&r.warn("detected differents target instance with the same name ("+i+")");else{a[e]=t,t.id=n++,o.push(t);var s=t.type;this._targetsByTypes[s].push(t)}}.bind(this);for(var u in this._animationsUpdateCallback){var l=this._animationsUpdateCallback[u];if(l.getStackedTransforms&&l.getStackedTransforms().length){this._animationsUpdateCallbackArray.push(l);for(var c=l.getStackedTransforms(),h=0,d=c.length;h<d;h++){var p=c[h];e=p.getTarget(),t=p.getName(),i=l.getName()+"."+t,s(i,e,t)}}else if(l instanceof f)for(var g=0,m=l.getNumTarget();g<m;g++)t=l.getTargetName(g),i=t+"."+g,e=l.getTarget(g),s(i,e,t)}},_addAnimation:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],a=n.name;if(!this._instanceAnimations[a]){var o=c.createInstanceAnimation(n);this._instanceAnimations[a]=o,t.push(o)}}return t},_addActiveChannels:function(e,t){for(var i=t.channels,r=0,n=i.length;r<n;r++){var a=i[r],o=a.channel.type;a.t=e,a.instanceAnimation=t;var s=a.targetID;s!==p.InvalidTargetID&&(this._activeChannelsByTypes[o].push(a),this._targets[s].channels.push(a))}},_removeActiveChannels:function(e){for(var t=e.channels,i=0,r=t.length;i<r;i++){var n=t[i],a=n.channel.type,o=n.targetID;if(o!==p.InvalidTargetID){var s=this._targets[o].channels,u=s.indexOf(n);s.splice(u,1);var l=this._activeChannelsByTypes[a],c=l.indexOf(n);l.splice(c,1)}}},_updateTargetType:function(e,t){for(var i=0,r=e.length;i<r;i++){var n=e[i],a=n.channels,o=a.length;if(0===o)n.value=t.copy(n.defaultValue,n.value);else if(1===o)n.value=t.copy(a[0].value,n.value);else{n.value=t.init(n.value);for(var s=0,u=0,l=a.length;u<l;u++){var c=a[u],h=c.weight;if(0!==(s+=h)&&0!==h){var d=h/s;n.value=t.lerp(n.value,n.value,c.value,d)}}}}},_updateChannelsType:function(e,t,i){for(var r=0,n=t.length;r<n;r++){var a=t[r],o=a.instanceAnimation,s=o.loop,u=e-a.t;s&&o.duration>0&&(u%=o.duration),i(u+o.firstKeyTime,a)}},_removeFinishedAnimation:function(e){for(var t=this._activeAnimationList,i=0;i<t.length;){var r=t[i],n=r.name;e>r.end&&!1===r.loop?(this._removeActiveChannels(r),this._activeAnimations[n]=void 0,t.splice(i,1)):i++}},_addActiveAnimation:function(e,t){this._activeAnimations[t.name]=t;var i=this._instanceAnimations[t.name];i.start=e,i.end=e+i.duration,this._addActiveChannels(e,i),this._activeAnimationList.push(i)},_processStartAnimation:function(e){if(this._targets.length){var t;for(t in this._startAnimations){var i=this._startAnimations[t],r=i.name;this.isPlaying(r)||this._addActiveAnimation(e,i)}void 0!==t&&(this._startAnimations={})}},_resetTargets:function(){this._targetMap={},this._targets.length=0;for(var e=0,t=this._targetsByTypes.length;e<t;e++)this._targetsByTypes[e].length=0},resetAllStackedTransforms:function(){for(var e=this._animationsUpdateCallbackArray,t=0,i=e.length;t<i;t++){for(var r=e[t].getStackedTransforms(),n=0,a=r.length;n<a;n++)r[n].resetToDefaultValue();e[t].computeChannels()}},setAnimationLerpEndStart:function(e,t){var i=e.channels;void 0===e.originalDuration&&(e.originalDuration=e.duration),e.duration=e.originalDuration+t;for(var r=e.firstKeyTime,n=e.originalDuration,a=0,o=i.length;a<o;++a){var s=i[a].channel;if(!(Math.abs(s.start-r)>.01||Math.abs(s.duration-n)>.01)){void 0===s.originalEnd&&(s.originalEnd=s.end),s.end=s.originalEnd+t;var u=m[s.type],l=s.times.buffer.byteLength/4;if(0===t)s.keys=new Float32Array(s.keys.buffer,0,(l-1)*u),s.times=new Float32Array(s.times.buffer,0,l-1);else{s.keys=new Float32Array(s.keys.buffer,0,l*u);for(var c=(l-1)*u,h=0;h<u;++h)s.keys[c+h]=s.keys[h];s.times=new Float32Array(s.times.buffer,0,l),s.times[l-1]=s.times[l-2]+t}}}}}),"osgAnimation","BasicAnimationManager"),_.TypeToSize=m,e.exports=_},function(e,t,i){"use strict";var r=i(14),n=i(67),a=i(456),o=function(){n.call(this),this._animationUpdateCallback={}};r.createPrototypeObject(o,r.objectInherit(n.prototype,{getAnimationUpdateCallbackMap:function(){return this._animationUpdateCallback},apply:function(e){for(var t=e.getUpdateCallbackList(),i=0,r=t.length;i<r;i++){var n=t[i];n instanceof a&&(this._animationUpdateCallback[n.getInstanceID()]=n)}this.traverse(e)}}),"osgAnimation","CollectAnimationUpdateCallbackVisitor"),e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(68),a=i(88),o=function(e,t){n.call(this),this._nbTarget=e,this._enable=!t,this._targetNames={},this._hashNames="",this._hash=""};o.uniforms={},r.createPrototypeStateAttribute(o,r.objectInherit(n.prototype,{attributeType:"Morph",cloneType:function(){return new o(void 0,!0)},hasTarget:function(e){return!!this._targetNames[e]},copyTargetNames:function(e){for(var t=this._targetNames,i="",r=t.length=e.length,n=0;n<r;++n){var a=e[n];t[a]=!0,i+=a}this._hashNames=i,this._hash=""},getOrCreateUniforms:function(){var e=o,t=this.getNumTargets();return e.uniforms[t]?e.uniforms[t]:(e.uniforms[t]={uTargetWeights:a.createFloat4("uTargetWeights")},e.uniforms[t])},setNumTargets:function(e){this._nbTarget=e,this._hash=""},getNumTargets:function(){return this._nbTarget},setTargetWeights:function(e){this._targetWeights=e},getTargetWeights:function(){return this._targetWeights},isEnabled:function(){return this._enable},getHash:function(){return this._hash||(this._hash=this.getTypeMember()+this._hashNames+this.getNumTargets()+this.isEnabled()),this._hash},apply:function(){if(this._enable){this.getOrCreateUniforms().uTargetWeights.setFloat4(this._targetWeights)}}}),"osgAnimation","MorphAttribute"),e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(68),a=i(88),o=function(e,t){n.call(this),this._enable=!e,this._boneUniformSize=t};o.uniforms={},o.maxBoneUniformSize=1,o.maxBoneUniformAllowed=1/0,r.createPrototypeStateAttribute(o,r.objectInherit(n.prototype,{attributeType:"Skinning",cloneType:function(){return new o(!0)},getBoneUniformSize:function(){return void 0!==this._boneUniformSize?this._boneUniformSize:o.maxBoneUniformSize},getOrCreateUniforms:function(){var e=o,t=this.getBoneUniformSize();return e.uniforms[t]?e.uniforms[t]:(e.uniforms[t]={uBones:a.createFloat4Array("uBones",t)},e.uniforms[t])},setMatrixPalette:function(e){this._matrixPalette=e,void 0===this._boneUniformSize&&(o.maxBoneUniformSize=Math.max(o.maxBoneUniformSize,e.length/4),o.maxBoneUniformSize=Math.min(o.maxBoneUniformAllowed,o.maxBoneUniformSize))},getMatrixPalette:function(){return this._matrixPalette},isEnabled:function(){return this._enable},getHash:function(){return this.getTypeMember()+this.getBoneUniformSize()+this.isEnabled()},apply:function(){this._enable&&this.getOrCreateUniforms().uBones.getInternalArray().set(this._matrixPalette)}}),"osgAnimation","SkinningAttribute"),e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(91),a=i(8).mat4,o=i(364),s=function(e,t){n.call(this),this._target=o.createMatrixTarget(t||a.IDENTITY),e&&this.setName(e)};r.createPrototypeObject(s,r.objectInherit(n.prototype,{init:function(e){this.setMatrix(e),a.copy(this._target.defaultValue,e)},getTarget:function(){return this._target},getMatrix:function(){return this._target.value},setMatrix:function(e){a.copy(this._target.value,e)},resetToDefaultValue:function(){this.setMatrix(this._target.defaultValue)},applyToMatrix:function(e){a.mul(e,e,this._target.value)}}),"osgAnimation","StackedMatrix"),e.exports=s},function(e,t,i){"use strict";var r=i(14),n=i(91),a=i(8).mat4,o=i(8).quat,s=i(364),u=o.create(),l=function(e,t){n.call(this),this._target=s.createQuatTarget(t||u),e&&this.setName(e)};r.createPrototypeObject(l,r.objectInherit(n.prototype,{init:function(e){this.setQuaternion(e),o.copy(this._target.defaultValue,e)},setQuaternion:function(e){o.copy(this._target.value,e)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setQuaternion(this._target.defaultValue)},applyToMatrix:function(){var e=a.create();return function(t){var i=e;a.fromQuat(i,this._target.value),a.mul(t,t,i)}}()}),"osgAnimation","StackedQuaternion"),e.exports=l},function(e,t,i){"use strict";var r=i(14),n=i(91),a=i(8).vec3,o=i(8).mat4,s=i(364),u=function(e,t){n.call(this),this._target=s.createVec3Target(t||a.ZERO),e&&this.setName(e)};r.createPrototypeObject(u,r.objectInherit(n.prototype,{init:function(e){this.setTranslate(e),a.copy(this._target.defaultValue,e)},setTranslate:function(e){a.copy(this._target.value,e)},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setTranslate(this._target.defaultValue)},applyToMatrix:function(e){o.translate(e,e,this._target.value)}}),"osgAnimation","StackedTranslate"),e.exports=u},function(e,t,i){"use strict";var r=i(14),n=i(427),a=i(67),o=i(30),s=i(91),u=function(){a.call(this)};r.createPrototypeObject(u,r.objectInherit(a.prototype,{apply:function(e){if(e.getTypeID()===n.getTypeID()){for(var t=!1,i=e.getChildren(),r=0,a=e.getChildren().length;r<a;r++){if(i[r].getTypeID()===n.getTypeID()){if(t)return void o.warn("Warning: a Bone was found after a non-Bone child within a Skeleton. Children of a Bone must be ordered with all child Bones first for correct update order.")}else t=!0}this.traverse(e)}}}),"osgAnimation","ValidateSkeletonVisitor");var l=function(e,t){return(e instanceof n?0:1)-(t instanceof n?0:1)},c=function(){this._needValidate=!0};r.createPrototypeObject(c,r.objectInherit(s.prototype,{needToValidate:function(){return this._needValidate},update:function(e,t){if(this._needValidate&&t.getVisitorType()===a.UPDATE_VISITOR&&e.className&&"Skeleton"===e.className()){for(var i=new u,r=e.getChildren(),n=0,o=r.length;n<o;n++){r[n].accept(i)}r.sort(l),this._needValidate=!1}return!0}}),"osgAnimation","UpdateSkeleton"),e.exports=c},function(e,t,i){"use strict";e.exports={Vec3:0,Quat:1,Float:2,FloatCubicBezier:3,Vec3CubicBezier:4,QuatSlerp:5,Matrix:6,Count:7}},function(e,t,i){"use strict";var r=i(8).vec3,n=i(8).quat,a=i(429),o=function(e,t,i){i[0]=t[e++],i[1]=t[e++],i[2]=t[e++]},s=function(e,t,i){i[0]=t[e++],i[1]=t[e++],i[2]=t[e++],i[3]=t[e++]},u=function(e,t){var i=t.channel,r=t.value,n=i.start,a=i.end,s=i.keys,u=i.times;if(e>=a)return t.key=0,void o(s.length-3,s,r);if(e<=n)return t.key=0,void o(0,s,r);var l=t.key;if(e>u[l])for(;u[l+1]<e;)l++;else if(e<u[l])for(;u[l]>e;)l--;var c=u[l],h=u[l+1],d=3*l,p=s[d++],f=s[d++],g=s[d++],m=s[d++],v=s[d++],_=s[d++],b=(e-c)/(h-c);r[0]=p+(m-p)*b,r[1]=f+(v-f)*b,r[2]=g+(_-g)*b,t.key=l},l=function(){var e=n.create32(),t=n.create32();return function(i,r){var a=r.channel,o=r.value,u=a.start,l=a.end,c=a.keys,h=a.times;if(i>=l)return r.key=0,void s(c.length-4,c,o);if(i<=u)return r.key=0,void s(0,c,o);var d=r.key;if(i>h[d])for(;h[d+1]<i;)d++;else if(i<h[d])for(;h[d]>i;)d--;var p=h[d],f=h[d+1],g=4*d;e[0]=c[g++],e[1]=c[g++],e[2]=c[g++],e[3]=c[g++],t[0]=c[g++],t[1]=c[g++],t[2]=c[g++],t[3]=c[g++];var m=(i-p)/(f-p);n.nlerp(o,e,t,m),r.key=d}}(),c=function(){var e=n.create32(),t=n.create32();return function(i,r){var a=r.channel,o=r.value,u=a.start,l=a.end,c=a.keys,h=a.times;if(i>=l)return r.key=0,void s(c.length-4,c,o);if(i<=u)return r.key=0,void s(0,c,o);var d=r.key;if(i>h[d])for(;h[d+1]<i;)d++;else if(i<h[d])for(;h[d]>i;)d--;var p=h[d],f=h[d+1],g=4*d;e[0]=c[g++],e[1]=c[g++],e[2]=c[g++],e[3]=c[g++],t[0]=c[g++],t[1]=c[g++],t[2]=c[g++],t[3]=c[g++];var m=(i-p)/(f-p);n.slerp(o,e,t,m),r.key=d}}(),h=function(e,t){var i=t.channel,r=t.value,n=i.start,a=i.end,o=i.keys,s=i.times;if(e>=a)return t.key=0,void(t.value=o[o.length-1]);if(e<=n)return t.key=0,void(t.value=o[0]);var u=t.key;if(e>s[u])for(;s[u+1]<e;)u++;else if(e<s[u])for(;s[u]>e;)u--;var l=s[u],c=s[u+1],h=u,d=o[h++];r=d+(o[h++]-d)*((e-l)/(c-l)),t.key=u,t.value=r},d=function(e,t){var i=t.channel,r=t.value,n=i.start,a=i.end,o=i.keys,s=i.times;if(e>=a)return t.key=0,void(t.value=o[o.length-3]);if(e<=n)return t.key=0,void(t.value=o[0]);var u=t.key;if(e>s[u])for(;s[u+1]<e;)u++;else if(e<s[u])for(;s[u]>e;)u--;var l=(e-s[u])/(s[u+1]-s[u]),c=1-l,h=c*c,d=h*c,p=l*l,f=3*u;r=o[f]*d+o[f+1]*(3*l*h)+o[f+2]*(3*p*c)+o[f+3]*(p*l),t.key=u,t.value=r},p=function(){var e=r.create(),t=r.create(),i=r.create(),n=r.create();return function(a,s){var u=s.channel,l=s.value,c=u.start,h=u.end,d=u.keys,p=u.times;if(a>=h)return s.key=0,void o(d.length-9,d,l);if(a<=c)return s.key=0,void o(0,d,l);var f=s.key;if(a>p[f])for(;p[f+1]<a;)f++;else if(a<p[f])for(;p[f]>a;)f--;var g=(a-p[f])/(p[f+1]-p[f]),m=1-g,v=m*m,_=v*m,b=g*g,x=9*f;r.scale(e,r.set(e,d[x++],d[x++],d[x++]),_),r.scale(t,r.set(t,d[x++],d[x++],d[x++]),3*g*v),r.scale(i,r.set(i,d[x++],d[x++],d[x++]),3*b*m),r.scale(n,r.set(n,d[x++],d[x++],d[x++]),b*g),l[0]=e[0]+t[0]+i[0]+n[0],l[1]=e[1]+t[1]+i[1]+n[1],l[2]=e[2]+t[2]+i[2]+n[2],s.key=f}}(),f=a.ChannelType,g={};g[f.Vec3]=u,g[f.Quat]=l,g[f.QuatSlerp]=c,g[f.Float]=h,g[f.FloatCubicBezier]=d,g[f.Vec3CubicBezier]=p,g.Vec3LerpInterpolator=u,g.QuatLerpInterpolator=l,g.QuatSlerpInterpolator=c,g.FloatLerpInterpolator=h,g.FloatCubicBezierInterpolator=d,g.Vec3CubicBezierInterpolator=p,e.exports=g},function(e,t,i){"use strict";var r=i(10),n=i(14),a=i(67),o=i(568),s=i(331),u=function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._progressCallback=void 0,this._lastCB=!0,this._activePagedLODList=new Set,this._childrenToRemoveList=new Set,this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},l=function(){this._loadedModel=void 0,this._group=void 0,this._url=void 0,this._function=void 0,this._timeStamp=0,this._groupExpired=!1,this._priority=0},c=function(e,t){a.call(this,a.TRAVERSE_ALL_CHILDREN),this._activePagedLODList=e,this._frameNumber=t};n.createPrototypeObject(c,n.objectInherit(a.prototype,{apply:function(e){e.getTypeID()===o.getTypeID()&&(e.setFrameNumberOfLastTraversal(this._frameNumber),this._activePagedLODList.add(e)),this.traverse(e)}}),"osgDB","FindPagedLODsVisitor");var h=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN)};n.createPrototypeObject(h,n.objectInherit(a.prototype,{apply:function(e){e.releaseGLObjects(),this.traverse(e)}}),"osgDB","ReleaseVisitor");var d=function(){a.call(this,a.TRAVERSE_ALL_CHILDREN),this._childrenList=[]};n.createPrototypeObject(d,n.objectInherit(a.prototype,{apply:function(e){e.getTypeID()===o.getTypeID()&&(this._childrenList.push(e),this._markRequestsExpired(e)),this.traverse(e)},removeExpiredChildrenAndFindPagedLODs:function(e,t,i,r){if(!e.children.length)return!1;var n=r.length;e.removeExpiredChildren(t,i,r);for(var a=n;a<r.length;a++)r[a].accept(this);return n!==r.length},_markRequestsExpired:function(e){for(var t,i=e._perRangeDataList.length,r=0;r<i;r++)void 0!==(t=e.getDatabaseRequest(r))&&(t._groupExpired=!0,t._loadedModel=null)}}),"osgDB","ExpirePagedLODVisitor"),n.createPrototypeObject(u,{setTargetMaximumNumberOfPageLOD:function(e){this._targetMaximumNumberOfPagedLOD=e},getTargetMaximumNumberOfPageLOD:function(){return this._targetMaximumNumberOfPagedLOD},setAcceptNewDatabaseRequests:function(e){this._acceptNewRequests=e},getAcceptNewDatabaseRequests:function(){return this._acceptNewRequests},reset:function(){this._pendingRequests=[],this._pendingNodes=[],this._loading=!1,this._lastCB=!0,this._activePagedLODList.clear(),this._childrenToRemoveList.clear(),this._downloadingRequestsNumber=0,this._maxRequestsPerFrame=10,this._acceptNewRequests=!0,this._targetMaximumNumberOfPagedLOD=75},updateSceneGraph:function(e){void 0!==this._progressCallback&&this.executeProgressCallback(),this.removeExpiredSubgraphs(e,.0025),this.takeRequests(),this.addLoadedDataToSceneGraph(e,.005)},executeProgressCallback:function(){this._pendingRequests.length>0||this._pendingNodes.length>0?(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!1):this._lastCB||(this._progressCallback(this._pendingRequests.length+this._downloadingRequestsNumber,this._pendingNodes.length),this._lastCB=!0)},setMaxRequestsPerFrame:function(e){this._maxRequestsPerFrame=e},getMaxRequestsPerFrame:function(){return this._maxRequestsPerFrame},getRequestListSize:function(){return this._pendingRequests.length+this._downloadingRequestsNumber},setProgressCallback:function(e){this._progressCallback=e},addLoadedDataToSceneGraph:function(e,t){if(t<=0)return 0;var i=0,r=s.instance().tick();this._pendingNodes.sort(function(e,t){return t._timeStamp-e._timeStamp});for(var n=0;n<this._pendingNodes.length;n++){if(i>t)return 0;var a=this._pendingNodes.shift(),o=e.getFrameNumber(),u=e.getSimulationTime();if(!1===a._groupExpired){var l=a._group;l.setTimeStamp(l.children.length,u),l.setFrameNumber(l.children.length,o),l.addChildNode(a._loadedModel),this._activePagedLODList.has(l)?this.registerPagedLODs(a._loadedModel,o):this.registerPagedLODs(l,o)}else a._loadedModel=void 0,a=void 0;i=s.instance().deltaS(r,s.instance().tick())}return t-=i},isLoading:function(){return this._loading},registerPagedLODs:function(e,t){e&&e.accept(new c(this._activePagedLODList,t))},requestNodeFile:function(e,t,i,r,n){if(this._acceptNewRequests){var a=new l;return a._group=i,a._function=e,a._url=t,a._timeStamp=r,a._priority=n,this._pendingRequests.push(a),a}},takeRequests:function(){if(this._pendingRequests.length){var e=Math.min(this._maxRequestsPerFrame,this._pendingRequests.length);this._pendingRequests.sort(function(e,t){var i=e._timeStamp-t._timeStamp;return 0===i&&(i=e._priority-t._priority),i});for(var t=0;t<e;t++)this._downloadingRequestsNumber++,this.processRequest(this._pendingRequests.shift())}},processRequest:function(e){this._loading=!0;var t=this;if(e._groupExpired)return t._downloadingRequestsNumber--,void(this._loading=!1);void 0!==e._function?this.loadNodeFromFunction(e._function,e._group).then(function(i){t._downloadingRequestsNumber--,e._loadedModel=i,t._pendingNodes.push(e),t._loading=!1}):""!==e._url&&this.loadNodeFromURL(e._url).then(function(i){t._downloadingRequestsNumber--,e._loadedModel=i,t._pendingNodes.push(e),t._loading=!1})},loadNodeFromFunction:function(e,t){var i=e(t);return i?i&&i.then?i:r.resolve(i):r.reject()},loadNodeFromURL:function(e){return i(386).readNodeURL(e)},releaseGLExpiredSubgraphs:function(e){if(e<=0)return 0;var t=0,i=s.instance().tick(),r=this;return this._childrenToRemoveList.forEach(function(n){t>e||(r._childrenToRemoveList.delete(n),n.accept(new h),n.removeChildren(),n=null,t=s.instance().deltaS(i,s.instance().tick()))}),e-=t},removeExpiredSubgraphs:function(e,t){if(0===e.getFrameNumber())return 0;var i=this._activePagedLODList.size-this._targetMaximumNumberOfPagedLOD,r=e.getSimulationTime()-.1,n=e.getFrameNumber()-1;return i>0&&(t=this.removeExpiredChildren(i,r,n,t)),t},removeExpiredChildren:function(e,t,i,r){var n=0,a=s.instance().tick(),o=this,u=[],l=new d;return this._activePagedLODList.forEach(function(c){if(n>r)return 0;if(e<0)return r;if(i<c.getFrameNumberOfLastTraversal())return r;l.removeExpiredChildrenAndFindPagedLODs(c,t,i,u);for(var h=0;h<l._childrenList.length;h++)o._activePagedLODList.delete(l._childrenList[h]),e--;for(h=0;h<u.length;h++)o._childrenToRemoveList.add(u[h]);l._childrenList.length=0,u.length=0,n=s.instance().deltaS(a,s.instance().tick())}),r-=n}},"osgDB","DatabasePager"),e.exports=u},function(e,t,i){"use strict";var r=i(30),n=function(e){this._manipulator=e,this._timer=!1,this.init()};n.prototype={init:function(){this._panFactorX=1,this._panFactorY=-this._panFactorX,this._rotateFactorX=.6,this._rotateFactorY=-this._rotateFactorX,this._zoomFactor=5,this._lastScale=0,this._nbPointerLast=0,this._lastPos=void 0},setEventProxy:function(e){if(void 0!==e&&(void 0===e||e!==this._eventProxy)){this._eventProxy=e;var t=this,i=e,n=function(e){return void 0!==e.pointers?e.pointers.length:1},a=function(e){return"touches "+n(e)+" distance "+e.distance+" x "+e.deltaX+" y "+e.deltaY};i.get("pinch").set({threshold:.1}),i.get("pan").set({threshold:0,pointers:0}),i.get("pinch").recognizeWith(i.get("pan")),i.get("tap").set({taps:2,posThreshold:300}),this._cbPanStart=function(e){var i=t._manipulator;if(i&&!t._transformStarted&&"mouse"!==e.pointerType){var o=e;t._dragStarted=!0,t._nbPointerLast=n(o);var s;2===t._nbPointerLast?(s=i.getPositionRelativeToCanvas(e.center.x,e.center.y),t._lastPos=s):s=void 0===t._lastPos?i.getCanvasCenter():t._lastPos,i.computeIntersections(s),2===t._nbPointerLast?(i.getPanInterpolator().reset(),i.getPanInterpolator().set(e.center.x*t._panFactorX,e.center.y*t._panFactorY)):i.getRotateInterpolator().reset(),r.debug("drag start, "+a(o))}},this._cbPanMove=function(e){var i=t._manipulator;if(i&&t._dragStarted&&"mouse"!==e.pointerType){var o=e,s=n(o);t._nbPointerLast!==s&&(2===s?i.getPanInterpolator().reset():i.getRotateInterpolator().reset(),t._nbPointerLast=s),2===s?(i.getPanInterpolator().setTarget(e.center.x*t._panFactorX,e.center.y*t._panFactorY),r.debug("pan, "+a(o))):(i.getRotateInterpolator().setTarget(e.center.x*t._rotateFactorX,e.center.y*t._rotateFactorY),r.debug("rotate, "+a(o)))}},this._cbPanEnd=function(e){if(t._manipulator&&t._dragStarted&&"mouse"!==e.pointerType){t._dragStarted=!1;var i=e;r.debug("drag end, "+a(i))}},this._cbPinchStart=function(e){var i=t._manipulator;if(i&&"mouse"!==e.pointerType){t._transformStarted=!0;var n=e;t._lastScale=n.scale,i.getZoomInterpolator().reset(),i.getZoomInterpolator().set(t._lastScale),e.preventDefault(),r.debug("zoom start, "+a(n))}},this._cbPinchEnd=function(e){"mouse"!==e.pointerType&&(t._transformStarted=!1,r.debug("zoom end, "+a(e)))},this._cbPinchInOut=function(e){var i=t._manipulator;if(i&&t._transformStarted&&"mouse"!==e.pointerType){var n=e,o=n.scale>t._lastScale?t._zoomFactor:4*t._zoomFactor,s=(n.scale-t._lastScale)*o;t._lastScale=n.scale,i.getZoomInterpolator().setTarget(i.getZoomInterpolator().getTarget()[0]-s),r.debug("zoom, "+a(n))}},this._cbDoubleTap=function(e){var i=t._manipulator;if(i&&"mouse"!==e.pointerType){var n=e,o=i.getPositionRelativeToCanvas(e.center.x,e.center.y);t._lastPos=o,i.getZoomInterpolator().set(0);var s=i.getZoomInterpolator().getTarget()[0]-10;i.getZoomInterpolator().setTarget(s),r.debug("tap, "+a(n))}},i.on("panstart ",this._cbPanStart),i.on("panmove",this._cbPanMove),i.on("panend",this._cbPanEnd),i.on("pinchstart",this._cbPinchStart),i.on("pinchend",this._cbPinchEnd),i.on("pinchin pinchout",this._cbPinchInOut),i.on("tap",this._cbDoubleTap)}},removeEventProxy:function(e){e&&this._eventProxy&&(e.off("panstart ",this._cbPanStart),e.off("panmove",this._cbPanMove),e.off("panend",this._cbPanEnd),e.off("pinchstart",this._cbPinchStart),e.off("pinchend",this._cbPinchEnd),e.off("pinchin pinchout",this._cbPinchInOut),e.off("tap",this._cbDoubleTap))},setManipulator:function(e){this._manipulator=e}},e.exports=n},function(e,t,i){"use strict";var r=i(578),n=function(e){this._manipulator=e,this._timer=!1,this.init()};n.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0},getMode:function(){return this._mode},setMode:function(e){this._mode=e},setEventProxy:function(e){this._eventProxy=e},setManipulator:function(e){this._manipulator=e},setDimensionMask:function(e){this._dimensionMask=e},mousemove:function(e){if(!0!==this._buttonup){var t=this._manipulator,i=t.getPositionRelativeToCanvas(e.clientX,e.clientY);if(!1===isNaN(i[0])&&!1===isNaN(i[1])){var n=this.getMode();if(n===r.Rotate)t.getRotateInterpolator().setTarget(i[0],i[1]);else if(n===r.Pan)t.getPanInterpolator().setTarget(i[0],i[1]);else if(n===r.Zoom){var a=t.getZoomInterpolator();t.computeIntersections(i),a.isReset()&&(a.setStart(i[1]),a.set(0));var o=i[1]-a.getStart();a.setStart(i[1]);var s=a.getTarget()[0];a.setTarget(s-o/20)}}e.preventDefault()}},mousedown:function(e){var t=this._manipulator,i=this.getMode();void 0===i&&(0===e.button?e.shiftKey?this.setMode(r.Pan):e.ctrlKey?this.setMode(r.Zoom):this.setMode(r.Rotate):this.setMode(r.Pan)),this.pushButton();var n=t.getPositionRelativeToCanvas(e.clientX,e.clientY);t.computeIntersections(n),i=this.getMode(),i===r.Rotate?(t.getRotateInterpolator().reset(),t.getRotateInterpolator().set(n[0],n[1])):i===r.Pan?(t.getPanInterpolator().reset(),t.getPanInterpolator().set(n[0],n[1])):i===r.Zoom&&(t.getZoomInterpolator().setStart(n[1]),t.getZoomInterpolator().set(0))},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(e,t){var i=this._manipulator,r=i.getZoomInterpolator().getTarget()[0]-t;i.getZoomInterpolator().setTarget(r);var n;if(!1===this._timer){this._timer=!0;var a=this;clearTimeout(n),n=setTimeout(function(){a._timer=!1},200);var o=i.getPositionRelativeToCanvas(e.clientX,e.clientY);i.computeIntersections(o)}},dblclick:function(e){var t=this._manipulator;e.preventDefault(),t.getZoomInterpolator().set(0);var i=t.getZoomInterpolator().getTarget()[0]-10;t.getZoomInterpolator().setTarget(i);var r=t.getPositionRelativeToCanvas(e.clientX,e.clientY);t.computeIntersections(r)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(e){32===e.keyCode?(this._manipulator.computeHomePosition(),e.preventDefault()):e.keyCode===this._panKey&&this.getMode()!==r.Pan?(this.setMode(r.Pan),this._manipulator.getPanInterpolator().reset(),this.pushButton(),e.preventDefault()):e.keyCode===this._zoomKey&&this.getMode()!==r.Zoom?(this.setMode(r.Zoom),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),e.preventDefault()):e.keyCode===this._rotateKey&&this.getMode()!==r.Rotate&&(this.setMode(r.Rotate),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),e.preventDefault())},keyup:function(e){e.keyCode===this._panKey?this.mouseup(e):e.keyCode===this._rotateKey?this.mouseup(e):e.keyCode===this._rotateKey&&this.mouseup(e),this.setMode(void 0)}},e.exports=n},function(e,t,i){"use strict";var r=i(579);e.exports=r},function(e,t,i){"use strict";var r=function(e){this._manipulator=e,this.init()};r.prototype={init:function(){this.releaseButton(),this._delay=.15,this._stepFactor=1},setEventProxy:function(e){this._eventProxy=e},setManipulator:function(e){this._manipulator=e,this._manipulator.setStepFactor(this._stepFactor)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},mousedown:function(e){var t=this._eventProxy.getPositionRelativeToCanvas(e);this._manipulator.getLookPositionInterpolator().set(t[0],t[1]),this.pushButton()},mouseup:function(){this.releaseButton()},mouseout:function(){this.releaseButton()},mousemove:function(e){if(!0!==this._buttonup){var t=this._eventProxy.getPositionRelativeToCanvas(e);this._manipulator.getLookPositionInterpolator().setDelay(this._delay),this._manipulator.getLookPositionInterpolator().setTarget(t[0],t[1]),e.preventDefault()}},mousewheel:function(e,t){this._stepFactor=Math.min(Math.max(.001,this._stepFactor+.01*t),4),this._manipulator.setStepFactor(this._stepFactor)},keydown:function(e){var t=this._manipulator;if(32===e.keyCode)t.computeHomePosition(),e.preventDefault();else{if(87===e.keyCode||90===e.keyCode||38===e.keyCode)return t.getForwardInterpolator().setDelay(this._delay),t.getForwardInterpolator().setTarget(1),e.preventDefault(),!1;if(83===e.keyCode||40===e.keyCode)return t.getForwardInterpolator().setDelay(this._delay),t.getForwardInterpolator().setTarget(-1),e.preventDefault(),!1;if(68===e.keyCode||39===e.keyCode)return t.getSideInterpolator().setDelay(this._delay),t.getSideInterpolator().setTarget(1),e.preventDefault(),!1;if(65===e.keyCode||81===e.keyCode||37===e.keyCode)return t.getSideInterpolator().setDelay(this._delay),t.getSideInterpolator().setTarget(-1),e.preventDefault(),!1}},keyup:function(e){var t=this._manipulator;return 87===e.keyCode||90===e.keyCode||38===e.keyCode||83===e.keyCode||40===e.keyCode?(t.getForwardInterpolator().setDelay(this._delay),t.getForwardInterpolator().setTarget(0),!1):68===e.keyCode||39===e.keyCode||65===e.keyCode||81===e.keyCode||37===e.keyCode?(t.getSideInterpolator().setDelay(this._delay),t.getSideInterpolator().setTarget(0),!1):void 0}},e.exports=r},function(e,t,i){"use strict";var r=function(e){this._manipulator=e,this.init()};r.prototype={init:function(){},update:function(e,t){this._manipulator.setPoseVR(e,t)}},e.exports=r},function(e,t,i){"use strict";var r=i(8).quat,n=i(8).vec3,a=i(577),o=function(e){this._manipulator=e,this.init()};o.prototype={init:function(){this._stepFactor=1,this._quat=r.create(),this._pos=n.create()},update:function(e,t){a.computeQuaternion(this._quat,e,t),this._manipulator.setPoseVR(this._quat,this._pos)}},e.exports=o},function(e,t,i){"use strict";var r=i(8).vec2,n=function(e){this._manipulator=e,this.init()};n.prototype={init:function(){this._delay=.15,this._threshold=.08,this._mode=0,this._padFactor=10,this._zoomFactor=.5,this._rotateFactor=5},addPan:function(e,t,i){e.setDelay(this._delay),e.addTarget(t*this._padFactor,i*this._padFactor)},addZoom:function(e,t){e.setDelay(this._delay),e.addTarget(t*this._zoomFactor)},addRotate:function(e,t,i){e.setDelay(this._delay),e.addTarget(t*this._rotateFactor,i*this._rotateFactor)},gamepadaxes:function(e){var t=this._manipulator.getRotateInterpolator(),i=this._manipulator.getZoomInterpolator(),r=this._manipulator.getPanInterpolator();4===e.length?((Math.abs(e[0])>.005||Math.abs(e[1])>.005)&&this.addRotate(t,-e[0],e[1]),Math.abs(e[3])>.005&&this.addZoom(i,-e[3])):e.length>=5&&((Math.abs(e[0])>.005||Math.abs(e[1])>.005)&&this.addPan(r,-e[0],e[1]),Math.abs(e[2])>.005&&this.addZoom(i,-e[2]),(Math.abs(e[3])>.005||Math.abs(e[4])>.005)&&this.addRotate(t,e[4],e[3]))},gamepadbuttondown:function(e){if(e.button>=12&&e.button<=15){var t=this._manipulator.getPanInterpolator(),i=t.getTarget(),n={12:r.fromValues(0,-1),13:r.fromValues(0,1),14:r.fromValues(-1,0),15:r.fromValues(1,0)}[e.button];t.setDelay(this._delay),t.setTarget(i[0]-10*n[0],i[1]+10*n[1])}},update:function(e){if(e){var t=e.axes,i=e.buttons;this.gamepadaxes(t);for(var r=function(){},n=0;n<i.length;n++)i[n]&&this.gamepadbuttondown({preventDefault:r,gamepad:e,button:n},!!i[n])}}},e.exports=n},function(e,t,i){"use strict";var r=i(30),n=i(8).vec3,a=i(8).vec2,o=function(e){this._manipulator=e,this.init()},s={rotate:{dtx:-1.44,dty:-1.08,dtz:-.1,delay:.05,method:"getRotateInterpolator"},pan:{dtx:-1.44,dty:-1.08,delay:.05,method:"getPanInterpolator"},zoom:{dtx:0,dty:-.5,delay:.05,method:"getZoomInterpolator"},"zoom-twohands":{dtx:-.05,dty:0,delay:.05,method:"getZoomInterpolator"}};o.prototype={init:function(){this._virtualCursor=a.fromValues(0,0),this._targetPosition=a.fromValues(0,0),this._previousFrame=void 0,this._displacement=a.fromValues(0,0),this._top=a.fromValues(0,1),this._motion=a.fromValues(0,0),this._delay=.05,this._threshold=.08,this._directionDotThreshold=.5,this._mode="rotate"},update:function(e){if(this._previousFrame||(this._previousFrame=e),0!==e.fingers.length){var t=this._previousFrame.translation(e);if(this._previousFrame=e,0!==e.hands.length&&!(Math.abs(t[0])<this._threshold&&Math.abs(t[1])<this._threshold)){var i=this._mode,a=0;if(e.gestures.length>0)for(var o=0;o<e.gestures.length;o++){var u=e.gestures[o];if("circle"===u.type)return void this._manipulator.computeHomePosition()}if(1===e.hands.length)e.hands[0].fingers.length>=3?(i="zoom",a=e.hands[0].palmPosition[1]/10,a=Math.max(a-4,.01)):i=e.hands[0].fingers.length>1?"pan":"rotate";else if(2===e.hands.length){var l=Math.abs(n.dot(e.hands[0].palmNormal,this._top)),c=Math.abs(n.dot(e.hands[1].palmNormal,this._top));l<this._directionDotThreshold&&c<this._directionDotThreshold?i="zoom-twohands":(i=void 0,this._handsDistanceOld=void 0)}var h=this._manipulator.getZoomInterpolator();if(void 0!==i){if(i!==this._mode)return r.info("Switch to mode "+i),this._motion[0]=0,this._motion[1]=0,this._mode=i,void("zoom"!==i&&"zoom-twohands"!==i||h.isReset()&&(h.setStart(1),h.set(0)));var d,p,f;d=s[i].dtx,p=s[i].dty,f=s[i].dtz,this._motion[0]+=t[0]*d,this._motion[1]+=t[1]*p;var g=s[i].delay,m=s[i].method;if(this._manipulator[m]().setDelay(g),"zoom"===i)r.log(a),h.setTarget(a);else if("zoom-twohands"===i){var v=n.distance(e.hands[1].palmPosition,e.hands[0].palmPosition);if(void 0!==this._handsDistanceOld){var _=d*(v-this._handsDistanceOld);a=h._target,a[0]+=_}this._handsDistanceOld=v}else"rotate"===i&&(a=h._target[0],a+=t[2]*f,a=Math.max(a,.01),h.setTarget(a)),this._manipulator[m]().addTarget(this._motion[0],this._motion[1]);this._motion[1]=this._motion[0]=0}}}}},e.exports=o},function(e,t,i){"use strict";var r=i(426),n=i(688),a=function(e){this._manipulator=e,this.init()};a.prototype={init:function(){this.releaseButton(),this._rotateKey=65,this._zoomKey=83,this._panKey=68,this._mode=void 0,this._delay=.15},getMode:function(){return this._mode},setMode:function(e){this._mode=e},setEventProxy:function(e){this._eventProxy=e},setManipulator:function(e){this._manipulator=e},mousemove:function(e){if(!0!==this._buttonup){var t=this._eventProxy.getPositionRelativeToCanvas(e),i=this._manipulator;if(!1===r.isNaN(t[0])&&!1===r.isNaN(t[1])){var a=this.getMode();if(a===n.ROTATE)i.getRotateInterpolator().setDelay(this._delay),i.getRotateInterpolator().setTarget(t[0],t[1]);else if(a===n.PAN)i.getPanInterpolator().setTarget(t[0],t[1]);else if(a===n.ZOOM){var o=i.getZoomInterpolator();o.isReset()&&(o.setStart(t[1]),o.set(0));var s=t[1]-o.getStart();o.setStart(t[1]);var u=o.getTarget()[0];o.setTarget(u-s/20)}}e.preventDefault()}},mousedown:function(e){var t=this._manipulator,i=this.getMode();void 0===i&&(0===e.button?e.shiftKey?this.setMode(n.PAN):e.ctrlKey?this.setMode(n.ZOOM):this.setMode(n.ROTATE):2===e.button&&e.ctrlKey?this.setMode(n.ZOOM):this.setMode(n.PAN)),this.pushButton();var r=this._eventProxy.getPositionRelativeToCanvas(e);i=this.getMode(),i===n.ROTATE?(t.getRotateInterpolator().reset(),t.getRotateInterpolator().set(r[0],r[1])):i===n.PAN?(t.getPanInterpolator().reset(),t.getPanInterpolator().set(r[0],r[1])):i===n.ZOOM&&(t.getZoomInterpolator().setStart(r[1]),t.getZoomInterpolator().set(0))},mouseup:function(){this.releaseButton(),this.setMode(void 0)},mouseout:function(){this.releaseButton(),this.setMode(void 0)},mousewheel:function(e,t){var i=this._manipulator,r=i.getZoomInterpolator().getTarget()[0]-t;i.getZoomInterpolator().setTarget(r)},pushButton:function(){this._buttonup=!1},releaseButton:function(){this._buttonup=!0},keydown:function(e){32===e.keyCode?(this._manipulator.computeHomePosition(),e.preventDefault()):e.keyCode===this._panKey&&this.getMode()!==n.PAN?(this.setMode(n.PAN),this._manipulator.getPanInterpolator().reset(),this.pushButton(),e.preventDefault()):e.keyCode===this._zoomKey&&this.getMode()!==n.ZOOM?(this.setMode(n.ZOOM),this._manipulator.getZoomInterpolator().reset(),this.pushButton(),e.preventDefault()):e.keyCode===this._rotateKey&&this.getMode()!==n.ROTATE&&(this.setMode(n.ROTATE),this._manipulator.getRotateInterpolator().reset(),this.pushButton(),e.preventDefault())},keyup:function(e){e.keyCode===this._panKey?this.mouseup(e):e.keyCode===this._rotateKey?this.mouseup(e):e.keyCode===this._rotateKey&&this.mouseup(e),this.setMode(void 0)}},e.exports=a},function(e,t,i){"use strict";var r=function(e){this._manipulator=e,this.init()};r.prototype={init:function(){},update:function(e,t){this._manipulator.setPoseVR(e,t)}},e.exports=r},function(e,t,i){"use strict";e.exports={ROTATE:0,PAN:1,ZOOM:2}},function(e,t,i){"use strict";var r=i(824);e.exports={name:r.name,version:r.version,author:r.author}},function(e,t,i){"use strict";var r=i(14),n=i(294),a=i(334),o=n.sprintf,s=function(e,t){a.call(this),this._name="Variable",this._prefix=t,this._type=e,this._value=void 0};r.createPrototypeObject(s,r.objectInherit(a.prototype,{getType:function(){return this._type},getVariable:function(){return this._prefix},setValue:function(e){return this._value=e,this},toString:function(){var e="prefix : "+this._prefix;return e+=", name : "+this._prefix,this.type&&(e+=" ("+this.type+")"),e},declare:function(){return void 0!==this._value?o("%s %s = %s;",[this._type,this.getVariable(),this._value]):o("%s %s;",[this._type,this.getVariable()])},isEmpty:function(){return void 0===this._value&&0===this._inputs.length},reset:function(){this._inputs=[],this._outputs=null,this._value=void 0,this._text=void 0}}),"osgShader","Variable");var u=function(e,t){s.call(this,e,t)};r.createPrototypeObject(u,r.objectInherit(s.prototype,{declare:function(){return o("const %s %s = %s;",[this._type,this.getVariable(),this._value])}}),"osgShader","Constant");var l=function(e,t,i){s.call(this,e,t),this._size=i};r.createPrototypeObject(l,r.objectInherit(s.prototype,{declare:function(){},globalDeclaration:function(){return this._size?o("uniform %s %s[%s];",[this._type,this.getVariable(),this._size]):o("uniform %s %s;",[this._type,this.getVariable()])}}),"osgShader","Uniform");var c=function(e,t){s.call(this,e,t)};r.createPrototypeObject(c,r.objectInherit(s.prototype,{declare:function(){},globalDeclaration:function(){return o("attribute %s %s;",[this._type,this.getVariable()])}}),"osgShader","Attribute");var h=function(e,t){s.call(this,e,t)};r.createPrototypeObject(h,r.objectInherit(s.prototype,{declare:function(){},globalDeclaration:function(){return o("varying %s %s;",[this._type,this.getVariable()])}}),"osgShader","Varying");var d=function(e,t){s.call(this,e,t)};r.createPrototypeObject(d,r.objectInherit(s.prototype,{declare:function(){},globalDeclaration:function(){return o("uniform %s %s;",[this._type,this.getVariable()])}}),"osgShader","Sampler");var p=function(e,t){s.call(this,e,t)};r.createPrototypeObject(p,r.objectInherit(s.prototype,{_unique:!0,isUnique:function(){return this._unique},outputs:function(){return this},getVariable:function(){return this._prefix}}),"osgShader","Output");var f=function(){p.call(this,"vec4","gl_FragColor"),this._name="glFragColor"};r.createPrototypeObject(f,r.objectInherit(p.prototype,{}),"osgShader","glFragColor");var g=function(){p.call(this,"vec4","gl_Position"),this._name="glPosition"};r.createPrototypeObject(g,r.objectInherit(p.prototype,{}),"osgShader","glPosition");var m=function(){p.call(this,"float","gl_PointSize"),this._name="glPointSize"};r.createPrototypeObject(m,r.objectInherit(p.prototype,{}),"osgShader","glPointSize"),e.exports={Output:p,glPointSize:m,glPosition:g,glFragColor:f,Sampler:d,Variable:s,Constant:u,Attribute:c,Varying:h,Uniform:l}},function(e,t,i){"use strict";var r=i(14),n=i(294),a=i(334),o=n.sprintf,s=function(){a.call(this)};r.createPrototypeObject(s,r.objectInherit(a.prototype,{globalFunctionDeclaration:function(){return'#pragma include "functions.glsl"'}}),"osgShader","NodeFunctions");var u=function(){s.call(this)};r.createPrototypeObject(u,r.objectInherit(s.prototype,{type:"Normalize",validInputs:["vec"],validOuputs:["vec"],computeShader:function(){return n.callFunction("normalize",this._outputs.vec,[this._inputs.vec])}}),"osgShader","Normalize");var l=function(){s.call(this)};r.createPrototypeObject(l,r.objectInherit(s.prototype,{type:"sRGBToLinear",validInputs:["color"],validOuputs:["color"],computeShader:function(){return this.computeConversion("sRGBToLinear")},computeConversion:function(e){var t=this._outputs.color,i=this._inputs.color,r=t.getType()!==i.getType()?".rgb":"";return n.callFunction(e,t.getVariable()+r,[i.getVariable()+r])}}),"osgShader","sRGBToLinear");var c=function(){l.call(this)};r.createPrototypeObject(c,r.objectInherit(l.prototype,{type:"LinearTosRGB",computeShader:function(){return this.computeConversion("linearTosRGB")}}),"osgShader","LinearTosRGB");var h=function(){s.call(this)};r.createPrototypeObject(h,r.objectInherit(s.prototype,{type:"FrontNormal",validInputs:["normal"],validOuputs:["normal"],computeShader:function(){return o("%s = gl_FrontFacing ? %s : -%s ;",[this._outputs.normal.getVariable(),this._inputs.normal.getVariable(),this._inputs.normal.getVariable()])}}),"osgShader","FrontNormal");var d=function(e){return e.getType&&"vec4"===e.getType()?e.getVariable()+".rgb":e},p=function(){s.call(this)};r.createPrototypeObject(p,r.objectInherit(s.prototype,{type:"EncodeRGBM",validInputs:["color","range"],validOutputs:["color"],computeShader:function(){return n.callFunction("encodeRGBM",this._outputs.color,[d(this._inputs.color),this._inputs.range])}}),"osgShader","EncodeRGBM");var f=function(){s.call(this)};r.createPrototypeObject(f,r.objectInherit(s.prototype,{type:"DecodeRGBM",validInputs:["color","range"],validOutputs:["color"],computeShader:function(){return n.callFunction("decodeRGBM",this._outputs.color,[this._inputs.color,this._inputs.range])}}),"osgShader","DecodeRGBM");var g=function(e){a.call(this),this._defineName=e,this._defineValue=""};r.createPrototypeObject(g,r.objectInherit(a.prototype,{type:"Define",setValue:function(e){return this._defineValue=e,this},getDefines:function(){return["#define "+this._defineName+" "+this._defineValue]}}),"osgShader","Define"),e.exports={NodeFunctions:s,Normalize:u,sRGBToLinear:l,LinearTosRGB:c,FrontNormal:h,DecodeRGBM:f,EncodeRGBM:p,Define:g}},function(e,t,i){"use strict";var r=i(14),n=i(294),a=i(334),o=function(){a.call(this)};r.createPrototypeObject(o,r.objectInherit(a.prototype,{validOutputs:["color","lighted"],globalFunctionDeclaration:function(){return'#pragma include "lights.glsl"'}}),"osgShader","NodeLights");var s=function(e){return"vec4"===e.getType()?e.getVariable()+".rgb":e},u=function(){o.call(this)};r.createPrototypeObject(u,r.objectInherit(o.prototype,{type:"PointLight",validInputs:["normal","eyeVector","materialdiffuse","materialspecular","materialshininess","lightdiffuse","lightspecular","lightposition","lightattenuation","lightmatrix"],computeShader:function(){return n.callFunction("computePointLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,s(this._inputs.materialdiffuse),s(this._inputs.materialspecular),this._inputs.materialshininess,s(this._inputs.lightdiffuse),s(this._inputs.lightspecular),this._inputs.lightposition,this._inputs.lightattenuation,this._inputs.lightmatrix,this._outputs.lighted])}}),"osgShader","PointLight");var l=function(){o.call(this)};r.createPrototypeObject(l,r.objectInherit(o.prototype,{type:"SpotLight",validInputs:["normal","eyeVector","materialdiffuse","materialspecular","materialshininess","lightdiffuse","lightspecular","lightdirection","lightattenuation","lightposition","lightspotCutOff","lightspotBlend","lightmatrix","lightinvMatrix"],computeShader:function(){return n.callFunction("computeSpotLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,s(this._inputs.materialdiffuse),s(this._inputs.materialspecular),this._inputs.materialshininess,s(this._inputs.lightdiffuse),s(this._inputs.lightspecular),this._inputs.lightdirection,this._inputs.lightattenuation,this._inputs.lightposition,this._inputs.lightspotCutOff,this._inputs.lightspotBlend,this._inputs.lightmatrix,this._inputs.lightinvMatrix,this._outputs.lighted])}}),"osgShader","SpotLight");var c=function(){o.call(this)};r.createPrototypeObject(c,r.objectInherit(o.prototype,{type:"SunLight",validInputs:["normal","eyeVector","materialdiffuse","materialspecular","materialshininess","lightdiffuse","lightspecular","lightposition","lightmatrix"],computeShader:function(){return n.callFunction("computeSunLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,s(this._inputs.materialdiffuse),s(this._inputs.materialspecular),this._inputs.materialshininess,s(this._inputs.lightdiffuse),s(this._inputs.lightspecular),this._inputs.lightposition,this._inputs.lightmatrix,this._outputs.lighted])}}),"osgShader","SunLight");var h=function(){o.call(this)};r.createPrototypeObject(h,r.objectInherit(o.prototype,{type:"HemiLight",validInputs:["normal","eyeVector","materialdiffuse","materialspecular","materialshininess","lightdiffuse","lightground","lightposition","lightmatrix"],computeShader:function(){return n.callFunction("computeHemiLightShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,s(this._inputs.materialdiffuse),s(this._inputs.materialspecular),this._inputs.materialshininess,s(this._inputs.lightdiffuse),s(this._inputs.lightground),this._inputs.lightposition,this._inputs.lightmatrix,this._outputs.lighted])}}),"osgShader","HemiLight"),e.exports={PointLight:u,SpotLight:l,SunLight:c,HemiLight:h}},function(e,t,i){"use strict";var r=i(14),n=i(294),a=i(334),o=function(){a.call(this)},s=function(e){return"vec4"===e.getType()?e.getVariable()+".rgb":e};r.createPrototypeObject(o,r.objectInherit(a.prototype,{type:"Morph",validInputs:["weights","vertex","target0"],validOutputs:["out"],globalFunctionDeclaration:function(){var e=window.Object.keys(this._inputs).length-2,t=0,i="vec3 morphTransform( const in vec4 weights,  const in vec3 vertex, const in vec3 target0";for(t=1;t<e;++t)i+=", const in vec3 target"+t;if(i+=" ) { \n",1===e)i+="return mix(vertex, target0, weights[0])";else{for(i+="\tvec3 vecOut = vertex * (1.0 - ( weights[0]",t=1;t<e;++t)i+=" + weights["+t+"]";for(i+="));\n",t=0;t<e;++t)i+="\tvecOut += target"+t+" * weights["+t+"];\n";i+="\treturn vecOut"}return i+=";\n}\n"},computeShader:function(){for(var e=this._inputs,t=[e.weights,s(e.vertex)],i=0;i<4&&e["target"+i];i++)t.push(s(e["target"+i]));return n.callFunction("morphTransform",this._outputs.out,t)}}),"osgShader","Morph"),e.exports={Morph:o}},function(e,t,i){"use strict";var r=i(30),n=i(14),a=i(334),o=i(294),s=o.sprintf,u=function(){a.call(this)};u.prototype=a.prototype;var l=function(){u.call(this)};n.createPrototypeObject(l,n.objectInherit(u.prototype,{type:"Add",operator:"+",computeShader:function(){var e=this._outputs.getType(),t="";"vec4"===e?t=".rgba":"vec3"===e?t=".rgb":"vec2"===e&&(t=".rg");for(var i=this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+t,r=1,n=this._inputs.length;r<n;r++){var a=this._inputs[r];i+=this.operator+a.getVariable(),"float"!==a.getType()&&(i+=t)}return i+=";"}}),"osgShader","Add");var c=function(){l.call(this)};n.createPrototypeObject(c,n.objectInherit(l.prototype,{type:"Mult",operator:"*"}),"osgShader","Mult");var h=function(){l.call(this)};n.createPrototypeObject(h,n.objectInherit(l.prototype,{type:"SetFromNode"}),"osgShader","SetFromNode");var d=function(){l.call(this),this._overwriteW=!0,this._forceComplement=!0,this._inverseOp=!1};n.createPrototypeObject(d,n.objectInherit(l.prototype,{type:"MatrixMultDirection",operator:"*",validInputs:["vec","matrix"],validOutputs:["vec"],complement:"0.",setInverse:function(e){return this._inverseOp=e,this},setForceComplement:function(e){return this._forceComplement=e,this},setOverwriteW:function(e){return this._overwriteW=e,this},computeShader:function(){var e=this._inputs.vec.getVariable(),t=this._inputs.matrix.getVariable(),i=this._outputs.vec.getVariable(),r=this._inputs.vec.getType(),n=this._outputs.vec.getType(),a=this._inputs.matrix.getType(),o=i;if("mat4"===a){o+=" = ","vec4"!==n&&(o+=n+"(");var s=e;(this._forceComplement||"vec4"!==r)&&(s="vec4("+e+".xyz, "+this.complement+")"),o+=this._inverseOp?s+this.operator+t:t+this.operator+s,"vec4"!==n&&(o+=")"),o+=";",this._overwriteW||"vec4"!==r||(o+="\n"+i+".a = "+e+".a;")}else{"vec4"===n&&(o+=".xyz"),o+=" = ";var u=e+".xyz";o+=(this._inverseOp?u+this.operator+t:t+this.operator+u)+";",this._overwriteW||"vec4"!==n||"vec4"!==r||(o+="\n"+i+".a = "+e+".a;")}return o}}),"osgShader","MatrixMultDirection");var p=function(){d.call(this),this._forceComplement=!1};n.createPrototypeObject(p,n.objectInherit(d.prototype,{type:"MatrixMultPosition",complement:"1."}),"osgShader","MatrixMultPosition");var f=function(){a.call(this)};n.createPrototypeObject(f,n.objectInherit(a.prototype,{type:"InlineCode",code:function(e){return this._text=e,this},computeShader:function(){var e=n.objectMix({},this._inputs);e=n.objectMix(e,this._outputs);for(var t=new RegExp("%[A-Za-z0-9_]+","gm"),i=this._text,a=this._text.match(t),o=new Set,s=0;s<a.length;s++){var u=a[s].substr(1);if(!o.has(u)){e[u]||(r.error("error with inline code\n"+this._text),r.error("input "+u+" not provided for "+a[s]));var l=new RegExp(a[s].toString(),"gm");i=i.replace(l,e[u].getVariable()),o.add(u)}}return i}}),"osgShader","InlineCode");var g=function(){u.call(this)};n.createPrototypeObject(g,n.objectInherit(u.prototype,{type:"SetAlpha",validInputs:["color","alpha"],validOuputs:["color"],computeShader:function(){var e=this._inputs.alpha;return s("%s = vec4( %s.rgb, %s );",[this._outputs.color.getVariable(),this._inputs.color.getVariable(),"float"!==e.getType()?e.getVariable()+".a":e.getVariable()])}}),"osgShader","SetAlpha");var m=function(){u.call(this)};n.createPrototypeObject(m,n.objectInherit(u.prototype,{type:"PreMultAlpha",validInputs:["color"],validOuputs:["color"],computeShader:function(){var e,t=void 0!==this._inputs.alpha?this._inputs.alpha:this._inputs.color;return e="float"!==t.getType()?t.getVariable()+".a":t.getVariable(),s("%s.rgb = %s.rgb * %s;",[this._outputs.color.getVariable(),this._inputs.color.getVariable(),e])}}),"osgShader","PreMultAlpha"),e.exports={BaseOperator:u,Mult:c,MatrixMultPosition:p,MatrixMultDirection:d,Add:l,InlineCode:f,SetAlpha:g,SetFromNode:h,PreMultAlpha:m}},function(e,t,i){"use strict";var r=i(14),n=i(294),a=i(334),o=function(){a.call(this)};r.createPrototypeObject(o,r.objectInherit(a.prototype,{type:"Skinning",validInputs:["weights","bonesIndex","matrixPalette"],validOutputs:["mat4"],globalFunctionDeclaration:function(){return'#pragma include "skinning.glsl"'},computeShader:function(){return n.callFunction("skeletalTransform",this._outputs.mat4,[this._inputs.weights,this._inputs.bonesIndex])}}),"osgShader","Skinning"),e.exports={Skinning:o}},function(e,t,i){"use strict";var r=i(14),n=i(294),a=i(334),o=function(){a.call(this)};r.createPrototypeObject(o,r.objectInherit(a.prototype,{type:"TextureAbstractNode",functionName:"noTextureFunction",validInputs:["sampler","uv"],validOutputs:["color"],computeShader:function(){return n.callFunction(this.functionName,this._outputs.color,[this._inputs.sampler,this._inputs.uv.getVariable()+".xy"])},globalFunctionDeclaration:function(){return'#pragma include "textures.glsl"'}}),"osgShader","NodeTextures");var s=function(){o.call(this)};r.createPrototypeObject(s,r.objectInherit(o.prototype,{type:"TextureRGB",functionName:"textureRGB"}),"osgShader","TextureRGB");var u=function(){s.call(this)};r.createPrototypeObject(u,r.objectInherit(s.prototype,{type:"TextureRGBA",functionName:"textureRGBA"}),"osgShader","TextureRGBA");var l=function(){s.call(this)};r.createPrototypeObject(l,r.objectInherit(s.prototype,{type:"TextureAlpha",functionName:"textureAlpha"}),"osgShader","TextureAlpha");var c=function(){s.call(this)};r.createPrototypeObject(c,r.objectInherit(s.prototype,{type:"TextureIntensity",functionName:"textureIntensity"}),"osgShader","TextureIntensity"),e.exports={NodeTextures:o,TextureRGB:s,TextureRGBA:u,TextureAlpha:l,TextureIntensity:c}},function(e,t,i){"use strict";var r=i(30),n=i(695),a=i(690),o=i(691),s=i(692),u=i(919),l=i(694),c=i(696),h=i(693),d=i(918),p=function(){this._nodes=new window.Map,this.registerNodes(n),this.registerNodes(a),this.registerNodes(c),this.registerNodes(o),this.registerNodes(s),this.registerNodes(h),this.registerNodes(u),this.registerNodes(l),this.registerNodes(d)};p.prototype={registerNodes:function(e){for(var t in e)this.registerNode(t,e[t])},registerNode:function(e,t){this._nodes.has(e)&&r.warn("Node "+e+" already registered"),this._nodes.set(e,t)},getNode:function(e){var t=this._nodes.get(e);if(!t)return void r.warn("Node "+e+" does not exist");var i=window.Object.create(t.prototype);return t.apply(i,Array.prototype.slice.call(arguments,1)),i}};var f=new p;e.exports=f},function(e,t,i){"use strict";var r=i(14),n=i(68),a=function(e,t){n.call(this),this._enable=!e,this._shadowReceiveAttribute=t};r.createPrototypeStateAttribute(a,r.objectInherit(n.prototype,{attributeType:"ShadowCast",cloneType:function(){return new a(!0)},setReceiveAttribute:function(e){this._shadowReceiveAttribute=e},getReceiveAttribute:function(){return this._shadowReceiveAttribute},getDefines:function(){if(this._shadowReceiveAttribute)return this._shadowReceiveAttribute.getDefines()},_computeHash:function(){return"ShadowCast"+this._enable+this._shadowReceiveAttribute.getPrecision()},getHash:function(){return this._computeHash()},isEnabled:function(){return this._enable}}),"osgShadow","ShadowCastAttribute"),e.exports=a},function(e,t,i){"use strict";var r=i(14),n=i(458),a=function(){n.apply(this,arguments)},o=n.cloneStateAttributeConfig(n);o.attribute=["ShadowCast","Morph","Skinning","PointSize"],n.setStateAttributeConfig(a,o),r.createPrototypeObject(a,r.objectInherit(n.prototype,{getCompilerName:function(){return"ShadowCast"},initAttributes:function(){for(var e=this._attributes,t=0,i=e.length;t<i;t++){var r=e[t].className();"ShadowCastAttribute"===r?this._shadowCastAttribute=e[t]:"Billboard"===r?this._isBillboard=!!e[t]:"SkinningAttribute"===r?this._skinningAttribute=e[t]:"MorphAttribute"===r?this._morphAttribute=e[t]:"PointSizeAttribute"===r&&(this._pointSizeAttribute=e[t])}},registerTextureAttributes:function(){},createShadowCastDepth:function(e){return this.getNode("ShadowCast").setShadowCastAttribute(this._shadowCastAttribute).inputs({shadowDepthRange:this.getOrCreateUniform("vec4","uShadowDepthRange"),fragEye:this.getOrCreateVarying("vec4","vViewVertex")}).outputs({color:e}),e},createFragmentShaderGraph:function(){var e=this.getNode("glFragColor");return[this.createShadowCastDepth(e)]}}),"osgShader","CompilerShadowCast"),e.exports=a},function(e,t,i){"use strict";var r=i(459),n=i(699),a=function(){r.apply(this,arguments),this.setShaderCompiler(n)};a.prototype=r.prototype,e.exports=a},function(e,t,i){"use strict";var r=i(381),n=i(274),a=i(382),o=i(453),s=i(564),u=i(67),l=i(14),c=function(e){u.call(this),this._noCastMask=e,this._nodeList=[]};l.createPrototypeObject(c,l.objectInherit(u.prototype,{reset:function(){this._nodeList=[]},removeNodeFromCasting:function(e){var t=e.getNodeMask();-1===t?(t=this._noCastMask,e.setNodeMask(t),this._nodeList.push(e)):0!=(t&~this._noCastMask)&&(e.setNodeMask(t|this._noCastMask),this._nodeList.push(e))},apply:function(e){var t=e.getStateSet();if(t){var i=t.getAttribute("BlendFunc");if(void 0!==i&&i.getSource()!==r.DISABLE){var u=t.getAttribute("Depth");if(u&&(u.getFunc()===a.DISABLE||!1===u.getWriteMask()))return void this.removeNodeFromCasting(e)}}return e.getTypeID()===o.typeID||e.getTypeID()===s.typeID?void this.removeNodeFromCasting(e):e.getTypeID()===n.typeID&&e.isRenderToTextureCamera()?void this.removeNodeFromCasting(e):void this.traverse(e)},setNoCastMask:function(e){this._noCastMask=e},restore:function(){for(var e=0,t=this._nodeList.length;e<t;e++){var i=this._nodeList[e],r=i.getNodeMask();r===this._noCastMask?i.setNodeMask(-1):i.setNodeMask(r&~this._noCastMask)}}}),"osgShadow","ShadowCasterVisitor"),e.exports=c},function(e,t,i){"use strict";var r=i(274),n=i(451),a=i(381),o=i(382),s=i(383),u=i(8).mat4,l=i(165),c=i(30),h=i(384),d=i(68),p=i(293),f=i(712),g=i(97),m=i(332),v=i(88),_=i(14),b=i(136),x=i(8).vec3,S=i(8).vec4,y=i(425),C=i(333),T=i(703),M=i(698),w=i(582),A=i(704),E=function(e){this._shadowTechnique=e};_.createPrototypeObject(E,{cull:function(e,t){this._shadowTechnique.getShadowedScene().nodeTraverse(t);var i=t.getCurrentCullingSet(),r=t.getCurrentProjectionMatrix(),n=t.getComputedNear(),a=t.getComputedFar();return u.getFrustumPlanes(i.getFrustum().getPlanes(),r,t.getCurrentModelViewMatrix(),!1),i.getFrustum().setupMask(6),this._shadowTechnique.setLightFrustum(i.getFrustum(),n,a),!1}},"osgShadow","CameraCullCallback");var P=function(e,t){w.call(this),this._projectionMatrix=u.create(),this._viewMatrix=u.create(),this._lightNumberArrayIndex=-1,this._lightUp=x.fromValues(0,0,1),this._light=e.light,this._cameraShadow=new r,this._cameraShadow.setCullCallback(new E(this)),this._cameraShadow.setRenderOrder(r.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(m.ABSOLUTE_RF),this._cameraShadow.setClearColor(S.fromValues(1,1,1,1)),t?this._texture=t:(this._texture=new A,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0),this._textureSize=256;var i=v.createFloat2("RenderSize");this._texelSizeUniform=v.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=i.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._receivingStateset=void 0,this._casterStateSet=new p,this._casterStateSet.addUniform(v.createFloat1(0,"exponent0")),this._casterStateSet.addUniform(v.createFloat1(0,"exponent1")),this._casterStateSet.addUniform(v.createFloat1(.005,"bias")),this._casterStateSet.addUniform(this._texelSizeUniform),this._casterStateSet.addUniform(i),this._casterStateSet.setAttributeAndModes(new o(o.LESS),d.ON|d.OVERRIDE),this._casterStateSet.setAttributeAndModes(new a,d.ON|d.OVERRIDE),this._shadowReceiveAttribute=new T(this._light.getLightNumber()),this._casterStateSet.setAttributeAndModes(this._shadowReceiveAttribute,d.ON|d.OVERRIDE),this._shadowCastShaderGeneratorName="ShadowCast";var n=v.createFloat4("uShadowDepthRange");this._casterStateSet.addUniform(n),this._depthRange=n.getInternalArray(),this._depthRange[0]=.001,this._depthRange[1]=1e3,this._depthRange[2]=999.999,this._depthRange[3]=1/999.999,this._worldLightPos=S.create(),this._worldLightPos[3]=0,this._worldLightDir=S.create(),this._worldLightDir[3]=1,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,this._shaderProcessor=void 0,this._tmpVec=x.create(),this._tmpVecBis=x.create(),this._tmpVecTercio=x.create(),this._tmpMatrix=u.create(),e&&this.setShadowSettings(e),this._infiniteFrustum=!0;var s=new M(!1,this._shadowReceiveAttribute);this._casterStateSet.setAttributeAndModes(s,d.ON|d.OVERRIDE),this._casterStateSet.setShaderGeneratorName(this._shadowCastShaderGeneratorName,d.OVERRIDE|d.ON),this._debug=!1};_.createPrototypeObject(P,_.objectInherit(w.prototype,{getDepthRange:function(){return this._depthRange},setLightFrustum:function(e,t,i){this._lightFrustum=e,this._depthRange[0]=t,this._depthRange[1]=i,this.nearFarBounding(),this._debug&&(this._debugGeomFrustum.updateGeometry(this._projectionMatrix,this._depthRange),u.invert(this._debugNodeFrustum.getMatrix(),this._viewMatrix))},getCamera:function(){return this._cameraShadow},getTexture:function(){return this._texture},isDirty:function(){return this._dirty},setTextureUnitBase:function(e){this._textureUnitBase=e,this._textureUnit=e},setShadowSettings:function(e){e&&(this._light=e.light,this._shadowCastShaderGeneratorName=e.getShadowCastShaderGeneratorName(),this.setCastsShadowDrawTraversalMask(e.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(e.castsShadowBoundsTraversalMask),this.setLight(this._light),this.setTextureSize(e.textureSize),this.setTexturePrecision(e.textureType),this.setKernelSizePCF(e.kernelSizePCF),this.setBias(e.bias),this.setNormalBias(e.normalBias))},setCastsShadowDrawTraversalMask:function(e){this._castsShadowDrawTraversalMask=e},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(e){this._castsShadowBoundsTraversalMask=e},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},getNormalBias:function(){return this._shadowReceiveAttribute.getNormalBias()},setNormalBias:function(e){this._shadowReceiveAttribute.setNormalBias(e)},getBias:function(){return this._shadowReceiveAttribute.getBias()},setBias:function(e){this._shadowReceiveAttribute.setBias(e),this._casterStateSet.getUniformList().bias.getUniform().setFloat(e)},getKernelSizePCF:function(){return this._shadowReceiveAttribute.getKernelSizePCF()},setKernelSizePCF:function(e){this._shadowReceiveAttribute.setKernelSizePCF(e)},setShadowedScene:function(e){w.prototype.setShadowedScene.call(this,e),this._receivingStateset=this._shadowedScene.getReceivingStateSet(),this.dirty()},checkLightNumber:function(){var e=this._light.getLightNumber();this._shadowReceiveAttribute.getLightNumber()!==e&&this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()),this._texture&&!this._texture.hasLightNumber(e)&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember())},init:function(e,t,i){if(this._shadowedScene){this._filledOnce=!1,this.checkLightNumber(),this._cameraShadow||(this._cameraShadow=new r,this._cameraShadow.setCullCallback(new E(this)),this._cameraShadow.setRenderOrder(r.PRE_RENDER,0),this._cameraShadow.setReferenceFrame(m.ABSOLUTE_RF),this._cameraShadow.setClearColor(S.fromValues(1,1,1,1)));var n=this._light.getLightNumber();e?(this._texture=e,this._lightNumberArrayIndex=t,this._textureUnit=i,this._shadowReceiveAttribute.setAtlas(!0)):(this.initTexture(),this._textureUnit=this._textureUnitBase+n,this._texture.setLightNumber(n),this._texture.setName("ShadowTexture"+this._textureUnit),this._shadowReceiveAttribute.setAtlas(!1)),this._cameraShadow.setName("light_shadow_camera"+this._light.getName()),this._shadowReceiveAttribute.setLightNumber(n);var a=d.OVERRIDE|d.ON;this._receivingStateset.setAttributeAndModes(this._shadowReceiveAttribute,a),this._preventTextureBindingDuringShadowCasting(),this._casterStateSet.setTextureAttributeAndModes(this._textureUnit,g.textureNull,d.PROTECTED),this._receivingStateset.setTextureAttributeAndModes(this._textureUnit,this._texture,a),this._dirty=!1}},_preventTextureBindingDuringShadowCasting:function(){for(var e=C.instance().getWebGLParameter("MAX_TEXTURE_IMAGE_UNITS"),t=0;t<e;t++)this._casterStateSet.setTextureAttributeAndModes(t,g.textureNull,d.OVERRIDE|d.ON)},valid:function(){return!0},updateShadowTechnique:function(e,t){var i=this._cameraShadow,r=this._texture;if(i&&r){var n=i.getViewport();n||(n=new y,i.setViewport(n)),t?n.x()===t[0]&&n.y()===t[1]&&n.width()===t[2]&&n.height()===t[3]||(i.detachAll(),i.attachTexture(s.COLOR_ATTACHMENT0,r),i.attachRenderBuffer(s.DEPTH_ATTACHMENT,s.DEPTH_COMPONENT16),i.getViewport().setViewport(t[0],t[1],t[2],t[3])):n.width()===r.getWidth()&&n.height()===r.getHeight()||(i.detachAll(),i.attachTexture(s.COLOR_ATTACHMENT0,r),i.attachRenderBuffer(s.DEPTH_ATTACHMENT,s.DEPTH_COMPONENT16),i.getViewport().setViewport(0,0,r.getWidth(),r.getHeight()))}},updateShadowTechnic:function(){c.log("ShadowMap.updateShadowTechnic() is deprecated, use updateShadowTechnique instead"),this.updateShadowTechnique()},setTextureFiltering:function(){var e;switch(this.getTexturePrecision()){case"HALF_FLOAT":e=g.HALF_FLOAT;break;case"FLOAT":e=g.FLOAT;break;default:case"UNSIGNED_BYTE":e=g.UNSIGNED_BYTE}this._texture.setInternalFormatType(e),this._texture.setMinFilter(g.NEAREST),this._texture.setMagFilter(g.NEAREST),this._textureMagFilter=g.NEAREST,this._textureMinFilter=g.NEAREST},initTexture:function(){if(this._dirty){this._texture||(this._texture=new A,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize;var e;e=g.RGBA,this.setTextureFiltering(),this._texture.setInternalFormat(e),this._texture.setWrapS(g.CLAMP_TO_EDGE),this._texture.setWrapT(g.CLAMP_TO_EDGE),this._texture.dirty()}},setTexturePrecision:function(e){e!==this._shadowReceiveAttribute.getPrecision()&&(this._shadowReceiveAttribute.setPrecision(e),this.dirty())},getTexturePrecision:function(){return this._shadowReceiveAttribute.getPrecision()},setTextureSize:function(e){e!==this._textureSize&&(this._textureSize=e,this.dirty())},getCasterStateSet:function(){return this._casterStateSet},setLight:function(e){e&&e!==this._light&&(this._light=e,this.dirty())},getUp:function(e){return Math.abs(x.dot(this._lightUp,e))>=1&&(1===this._lightUp[0]?(this._lightUp[0]=0,this._lightUp[1]=1,this._lightUp[2]=0):(this._lightUp[0]=1,this._lightUp[1]=0,this._lightUp[2]=0)),this._lightUp},nearFarBounding:function(){var e=this._depthRange[0],t=this._depthRange[1],i=P.EPSILON;t<e-i?(this._emptyCasterScene=!0,t=1,e=i):e<i&&(e=i),this._depthRange[0]=e,this._depthRange[1]=t},makePerspectiveFromBoundingBox:function(e,t,i,r,n,a){var o=e.center(this._tmpVec),s=e.radius(),l=P.EPSILON,c=l,h=1;this._radius=s;var d=x.distance(o,i);d<-s?this._emptyCasterScene=!0:d<=0?(c=l,h=d+s):d<s?(c=l,h=d+s):(c=d-s,h=d+s),this._depthRange[0]=c,this._depthRange[1]=h,this.nearFarBounding();var p=this._depthRange[0]*Math.tan(t*Math.PI/180);p=p>s?s:p;var f=p,g=-f,m=p,v=-m,_=this.getUp(r);this._infiniteFrustum?u.infiniteFrustum(a,v,m,g,f,this._depthRange[0]):u.frustum(a,v,m,g,f,this._depthRange[0],this._depthRange[1]),u.lookAtDirection(n,i,r,_)},makeOrthoFromBoundingBox:function(e,t,i,r){var n=e.center(this._tmpVecTercio),a=e.radius(),o=a+a,s=1e-4,l=o+1e-4,c=this._tmpVec;x.scaleAndAdd(c,n,t,-o),s=a,l+=a;s<.001*l&&(s=.001*l);var h=this.getUp(t);u.lookAtDirection(i,c,t,h);var d,p;p=a,d=p,u.ortho(r,-d,d,-p,p,s,l),this._depthRange[0]=s,this._depthRange[1]=l},aimShadowCastingCamera:function(e,t){var i=this._light;if(!i)return void(this._emptyCasterScene=!0);var r=this._cameraShadow,n=this._worldLightPos,a=this._worldLightDir;u.copy(this._projectionMatrix,r.getProjectionMatrix()),u.copy(this._viewMatrix,r.getViewMatrix());var o,s=this._projectionMatrix,l=this._viewMatrix,h=e.getCurrentRenderBin().getPositionedAttribute();if(h.find(function(e){return e.length>0&&e[1]===i&&(o=e[0],!0)}),void 0===o)return c.warn("light isnt inside children of shadowedScene Node"),void(this._emptyCasterScene=!0);var d=this._tmpMatrix;if(u.invert(d,e.getCurrentModelViewMatrix()),this._light.isDirectionLight())S.transformMat4(n,i.getPosition(),o),S.transformMat4(n,n,d),x.scale(n,n,-1),x.normalize(n,n),this.makeOrthoFromBoundingBox(t,n,l,s),this._debug&&u.invert(this._debugNodeFrustum.getMatrix(),l);else{u.mul(this._tmpMatrix,d,o);var p=this._tmpMatrix;x.transformMat4(n,i.getPosition(),p),p[12]=0,p[13]=0,p[14]=0,u.invert(p,p),u.transpose(p,p),x.copy(a,i.getDirection()),S.transformMat4(a,a,p),x.normalize(a,a),this.makePerspectiveFromBoundingBox(t,i.getSpotCutoff(),n,a,l,s)}u.copy(r.getProjectionMatrix(),this._projectionMatrix),u.copy(r.getViewMatrix(),this._viewMatrix),this.setShadowUniformsDepthValue()},frameShadowCastingFrustum:function(e){this._infiniteFrustum||n.prototype.clampProjectionMatrix(this._projectionMatrix,this._depthRange[0],this._depthRange[1],e.getNearFarRatio(),this._depthRange),this.setShadowUniformsDepthValue();var t=this._cameraShadow;u.copy(t.getProjectionMatrix(),this._projectionMatrix),u.copy(t.getViewMatrix(),this._viewMatrix)},setShadowUniformsDepthValue:function(){this._depthRange[2]=this._depthRange[1]-this._depthRange[0],this._depthRange[3]=1/this._depthRange[2],-1!==this._lightNumberArrayIndex?(this._texture.setViewMatrix(this._lightNumberArrayIndex,this._viewMatrix),this._texture.setProjectionMatrix(this._lightNumberArrayIndex,this._projectionMatrix),this._texture.setDepthRange(this._lightNumberArrayIndex,this._depthRange)):(this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjectionMatrix(this._projectionMatrix),this._texture.setDepthRange(this._depthRange))},noDraw:function(){this._depthRange[0]=0,this._depthRange[1]=0,this._depthRange[2]=0,this._depthRange[3]=0,this._casterStateSet.getUniformList().uShadowDepthRange.getUniform().setVec4(this._depthRange),this._texture.setDepthRange(this._depthRange);var e=this._cameraShadow;u.copy(this._projectionMatrix,e.getProjectionMatrix()),u.copy(this._viewMatrix,e.getViewMatrix()),-1!==this._lightNumberArrayIndex?(this._texture.setViewMatrix(this._lightNumberArrayIndex,this._viewMatrix),this._texture.setProjectionMatrix(this._lightNumberArrayIndex,this._projectionMatrix)):(this._texture.setViewMatrix(this._viewMatrix),this._texture.setProjectionMatrix(this._projectionMatrix)),this._filledOnce=!0},cullShadowCasting:function(e,t){if(this._debug){var i=t.getMin(),r=t.getMax();t.center(this._tmpVec);var n=this._debugNodeSceneCast.getMatrix();u.fromScaling(n,[r[0]-i[0],r[1]-i[1],r[2]-i[2],1]),u.setTranslation(n,this._tmpVec)}if(this._emptyCasterScene=!1,this.aimShadowCastingCamera(e,t),this._emptyCasterScene)return void this.noDraw();var a=e.getTraversalMask();e.setTraversalMask(this._castsShadowDrawTraversalMask),e.pushStateSet(this._casterStateSet),this._cameraShadow.setEnableFrustumCulling(!0),this._cameraShadow.setComputeNearFar(!0),this._debug&&this._debugNode.accept(e),this._cameraShadow.accept(e),this.nearFarBounding(),this.frameShadowCastingFrustum(e),this._cameraShadow.setComputeNearFar(!1),e.popStateSet(),e.setTraversalMask(a),this._filledOnce=!0},cleanReceivingStateSet:function(){this._receivingStateset&&(this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember()),this._receivingStateset.getAttribute(this._shadowReceiveAttribute.getTypeMember())===this._shadowReceiveAttribute&&this._receivingStateset.removeAttribute(this._shadowReceiveAttribute.getTypeMember()))},cleanSceneGraph:function(){this._cameraShadow=void 0,this._filledOnce=!1,this.cleanReceivingStateSet(),this._texture=void 0,this._shadowedScene=void 0},setDebug:function(e){e&&!this._debug&&(this._debugNode||(this._debugGeomFrustum=f.createDebugFrustumGeometry(),this._debugGeomSceneCast=h.createBoundingBoxGeometry(),this._debugGeomSceneCast.getPrimitives()[0].mode=b.LINES,this._debugNode=new l,this._debugNodeFrustum=new l,this._debugNodeSceneCast=new l,this._debugNodeFrustum.addChild(this._debugGeomFrustum),this._debugNodeSceneCast.addChild(this._debugGeomSceneCast),this._debugNode.addChild(this._debugNodeFrustum),this._debugNode.addChild(this._debugNodeSceneCast))),this._debug=e},getDebug:function(){return this._debug}}),"osgShadow","ShadowMap"),P.EPSILON=.005,e.exports=P},function(e,t,i){"use strict";var r=i(14),n=i(68),a=i(88),o=function(e,t){n.call(this),this._lightNumber=e,this._bias=.001,this._normalBias=void 0,this._precision="UNSIGNED_BYTE",this._kernelSizePCF=void 0,this._fakePCF=!0,this._rotateOffset=!1,this._enable=!t,this._isAtlasTexture=!1};o.uniforms={},r.createPrototypeStateAttribute(o,r.objectInherit(n.prototype,{attributeType:"ShadowReceive",cloneType:function(){return new o(this._lightNumber,!0)},getTypeMember:function(){return this.attributeType+this.getLightNumber()},getLightNumber:function(){return this._lightNumber},getUniformName:function(e){return"u"+(this.getType()+this.getLightNumber().toString())+"_"+e},getAtlas:function(){return this._isAtlasTexture},setAtlas:function(e){this._isAtlasTexture=e},setBias:function(e){this._bias=e},getBias:function(){return this._bias},setNormalBias:function(e){this._normalBias=e},getNormalBias:function(){return this._normalBias},getKernelSizePCF:function(){return this._kernelSizePCF},setKernelSizePCF:function(e){this._kernelSizePCF=e},setPrecision:function(e){this._precision=e},getPrecision:function(){return this._precision},setLightNumber:function(e){this._lightNumber=e},getOrCreateUniforms:function(){var e=o,t=this.getTypeMember();return e.uniforms[t]?e.uniforms[t]:(e.uniforms[t]={bias:a.createFloat(this.getUniformName("bias")),normalBias:a.createFloat(this.getUniformName("normalBias"))},e.uniforms[t])},getExtensions:function(){return["#extension GL_OES_standard_derivatives : enable"]},getDefines:function(){var e=this.getPrecision(),t=[],i=!1;switch("UNSIGNED_BYTE"!==e&&(i=!0),this.getKernelSizePCF()){case"4Tap(16texFetch)":t.push("#define _PCFx4");break;case"9Tap(36texFetch)":t.push("#define _PCFx9");break;case"16Tap(64texFetch)":t.push("#define _PCFx25");break;default:case"1Tap(4texFetch)":t.push("#define _PCFx1")}return i&&t.push("#define _FLOATTEX"),this.getAtlas()&&t.push("#define _ATLAS_SHADOW"),this.getNormalBias()&&t.push("#define _NORMAL_OFFSET"),t},apply:function(){if(this._enable){var e=this.getOrCreateUniforms();e.normalBias.setFloat(this._normalBias),e.bias.setFloat(this._bias)}},isEnabled:function(){return this._enable},getHash:function(){return this._computeHash()},_computeHash:function(){return this.getTypeMember()+"_"+this.getKernelSizePCF()}}),"osgShadow","ShadowReceiveAttribute"),e.exports=o},function(e,t,i){"use strict";var r=i(30),n=i(97),a=i(88),o=i(14),s=i(8).vec4,u=function(){n.call(this),this._uniforms={},this._mapSize=s.create(),this._renderSize=s.create(),this._lightNumber=-1};u.uniforms={},o.createPrototypeStateAttribute(u,o.objectInherit(n.prototype,{cloneType:function(){return new u},hasLightNumber:function(e){return this._lightNumber===e},setLightNumber:function(e){this._lightNumber=e},getLightNumber:function(){return this._lightNumber},getUniformName:function(e){return"uShadow_"+this.getType()+this._lightNumber.toString()+"_"+e},getOrCreateUniforms:function(e){var t=u;if(r.assert(void 0!==e),r.assert(-1!==this._lightNumber),void 0!==t.uniforms[e])return t.uniforms[e];var i=t.uniforms[e]={ViewMatrix:a.createMat4(this.getUniformName("viewMatrix")),ProjectionMatrix:a.createMat4(this.getUniformName("projectionMatrix")),DepthRange:a.createFloat4(this.getUniformName("depthRange")),MapSize:a.createFloat4(this.getUniformName("mapSize")),RenderSize:a.createFloat4(this.getUniformName("renderSize"))},n="Texture"+e,o=a.createInt1(e,n);return i[n]=o,t.uniforms[e]},setViewMatrix:function(e){this._viewMatrix=e},setProjectionMatrix:function(e){this._projectionMatrix=e},setDepthRange:function(e){this._depthRange=e},setTextureSize:function(e,t){n.prototype.setTextureSize.call(this,e,t),this.dirty(),this._mapSize[0]=e,this._mapSize[1]=t,this._mapSize[2]=1/e,this._mapSize[3]=1/t,this._renderSize[0]=e,this._renderSize[1]=t,this._renderSize[2]=1/e,this._renderSize[3]=1/t},apply:function(e,t){if(n.prototype.apply.call(this,e,t),-1!==this._lightNumber){var i=this.getOrCreateUniforms(t);i.ViewMatrix.setMatrix4(this._viewMatrix),i.ProjectionMatrix.setMatrix4(this._projectionMatrix),i.DepthRange.setFloat4(this._depthRange),i.MapSize.setFloat4(this._mapSize),i.RenderSize.setFloat4(this._renderSize)}},getHash:function(){return this._computeHash()},_computeHash:function(){return this.getTypeMember()+"_"+this._lightNumber+"_"+this._type}}),"osgShadow","ShadowTexture"),e.exports=u},function(e,t,i){"use strict";var r=i(30),n=i(97),a=i(88),o=i(14),s=i(8).vec4,u=function(){n.call(this),this._uniforms={},this._lightNumberArray=[],this._viewMatrices=[],this._projectionMatrices=[],this._depthRanges=[],this._mapSizes=[],this._renderSize=s.create()};u.uniforms={},o.createPrototypeStateAttribute(u,o.objectInherit(n.prototype,{cloneType:function(){return new u},gettLightNumberArray:function(){return this._lightNumberArray},hasLightNumber:function(e){return-1!==this._lightNumberArray.indexOf(e)},setLightNumberArray:function(e){this._lightNumberArray=e;var t=e.length;this._viewMatrices.length=t,this._projectionMatrices.length=t,this._depthRanges.length=t,this._mapSizes.length=t},getUniformName:function(e,t){return"uShadow_"+this.getType()+e.toString()+"_"+t},getOrCreateUniforms:function(e){var t=u;if(r.assert(void 0!==e||0!==this._lightNumberArray.length),void 0!==t.uniforms[e])return t.uniforms[e];var i=t.uniforms[e]={},n=a.createFloat4(this.getUniformName(0,"renderSize"));i.RenderSize=n;for(var o=0,s=this._lightNumberArray.length;o<s;o++){var l=this._lightNumberArray[o];i["ViewMatrix_"+l]=a.createMat4(this.getUniformName(l,"viewMatrix")),i["ProjectionMatrix_"+l]=a.createMat4(this.getUniformName(l,"projectionMatrix")),i["DepthRange_"+l]=a.createFloat4(this.getUniformName(l,"depthRange")),i["MapSize_"+l]=a.createFloat4(this.getUniformName(l,"mapSize")),i["RenderSize_"+l]=n}var c="Texture"+e,h=a.createInt1(e,c);return i[c]=h,t.uniforms[e]},setViewMatrix:function(e,t){this._viewMatrices[e]=t},setProjectionMatrix:function(e,t){this._projectionMatrices[e]=t},setDepthRange:function(e,t){this._depthRanges[e]=t},setTextureSize:function(e,t){this._renderSize[0]=e,this._renderSize[1]=t,this._renderSize[2]=1/e,this._renderSize[3]=1/t,n.prototype.setTextureSize.call(this,e,t),this.dirty()},setLightShadowMapSize:function(e,t){this._mapSizes[e]=t},apply:function(e,t){if(n.prototype.apply.call(this,e,t),0!==this._lightNumberArray.length){for(var i=this.getOrCreateUniforms(t),r=0,a=this._lightNumberArray.length;r<a;r++){var o=this._lightNumberArray[r];i["ViewMatrix_"+o].setMatrix4(this._viewMatrices[r]),i["ProjectionMatrix_"+o].setMatrix4(this._projectionMatrices[r]),i["DepthRange_"+o].setFloat4(this._depthRanges[r]),i["MapSize_"+o].setFloat4(this._mapSizes[r]),i["RenderSize_"+o].setFloat4(this._renderSize)}i.RenderSize.setFloat4(this._renderSize)}},getHash:function(){for(var e=this.getTypeMember(),t=0,i=this._lightNumberArray.length;t<i;t++)e+="_"+this._lightNumberArray[t];return e+="_"+this._type}}),"osgShadow","ShadowTextureAtlas"),e.exports=u},function(e,t,i){"use strict";var r=i(451),n=i(14),a=i(8).vec3,o=i(8).vec4,s=i(8).mat4,u=i(562),l=i(165),c=i(384),h=i(97),d=i(381),p=i(8).quat,f=i(67),g=i(135),m=function(e){u.call(this),this._canvas=document.createElement("canvas"),this._context=this._canvas.getContext("2d"),this._matrixTransform=new l,this.addChild(this._matrixTransform),this._text="",void 0!==e&&(this._text=e),this._font="monospace",this._color=o.fromValues(0,0,0,1),this._fillStyle="rgba( 0, 0, 0, 1 )",this._context.textAlign="center",this._textX=void 0,this._context.baseLine="middle",this._textY=void 0,this._characterSize=1,this._characterSizeMode=m.OBJECT_COORDS,this._fontSize=32,this._geometry=void 0,this._autoRotateToScreen=!1,this._position=a.create(),this._layout=m.LEFT_TO_RIGHT,this._alignment=m.CENTER_CENTER,this._forcePowerOfTwo=!1,this._texture=new h,this.drawText(),this._dirty=!1,this._previousModelView=s.create()};m.OBJECT_COORDS=0,m.SCREEN_COORDS=1,m.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT=2,m.LEFT_TO_RIGHT="ltr",m.RIGHT_TO_LEFT="rtl",m.LEFT_TOP=0,m.LEFT_CENTER=1,m.LEFT_BOTTOM=2,m.CENTER_TOP=3,m.CENTER_CENTER=4,m.CENTER_BOTTOM=5,m.RIGHT_TOP=6,m.RIGHT_CENTER=7,m.RIGHT_BOTTOM=8,n.createPrototypeNode(m,n.objectInherit(u.prototype,{drawText:function(){if(void 0!==this._geometry&&(this._matrixTransform.removeChild(this._geometry),this._geometry.releaseGLObjects()),this._text){this.setTextProperties(),this._canvas.width=this._context.measureText(this._text).width,this._canvas.height=2*this._fontSize,this._forcePowerOfTwo&&(this._canvas.width=this._nextPowerOfTwo(this._canvas.width),this._canvas.height=this._nextPowerOfTwo(this._canvas.height)),this.setTextProperties(),this._context.clearRect(0,0,this._canvas.width,this._canvas.height),this._context.fillText(this._text,this._textX,this._textY);var e=this._canvas.width/this._canvas.height,t=this._characterSize*e;this._geometry=c.createTexturedQuadGeometry(-t/2,-this._characterSize/2,0,t,0,0,0,this._characterSize,0),this._texture.setTextureSize(this._canvas.width,this._canvas.height),this._texture.setMinFilter("LINEAR"),this._texture.setMagFilter("LINEAR"),this._texture.setImage(this._canvas);var i=this._geometry.getOrCreateStateSet();i.setTextureAttributeAndModes(0,this._texture),i.setRenderingHint("TRANSPARENT_BIN"),i.setAttributeAndModes(new d(d.ONE,d.ONE_MINUS_SRC_ALPHA)),this._matrixTransform.addChild(this._geometry),this.dirtyBound()}},setText:function(e){this._text=e,this._dirty=!0},getText:function(){return this._text},setFont:function(e){this._font=e,this._dirty=!0},setColor:function(e){this._color=e,this._fillStyle="rgba("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+","+e[3]+")",this._context.fillStyle=this._fillStyle,this._context.fillText(this._text,this._textX,this._textY)},getColor:function(){return this._color},setCharacterSize:function(e){this._characterSize=e,this._characterSizeMode!==m.OBJECT_COORDS&&(s.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this._characterSizeMode===m.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)),this._dirty=!0},getCharacterSize:function(){return this._characterSize},setCharacterSizeMode:function(e){this._characterSizeMode=e,this._characterSizeMode!==m.OBJECT_COORDS?(s.fromScaling(this._matrixTransform.getMatrix(),[this._characterSize,this._characterSize,this._characterSize]),this.setAutoScaleToScreen(!0),this.setMaximumScale(Number.MAX_VALUE),this._characterSizeMode===m.OBJECT_COORDS_WITH_MAXIMUM_SCREEN_SIZE_CAPPED_BY_FONT_HEIGHT&&this.setMaximumScale(this._characterSize)):(this._matrixTransform.setMatrix(s.create()),this.setAutoScaleToScreen(!1)),this._dirty=!0},getCharacterSizeMode:function(){return this._characterSizeMode},setFontResolution:function(e){this._fontSize=e,this._dirty=!0},getFontResolution:function(){return this._fontSize},setPosition:function(e){this._position=e,s.fromTranslation(this.getMatrix(),e)},getPosition:function(){return this._position},setTextProperties:function(){this._context.fillStyle=this._fillStyle,this._setAlignmentValues(this._alignment),this._context.font=this._fontSize+"px "+this._font,this._context.direction=this._layout},setAutoRotateToScreen:function(e){u.prototype.setAutoRotateToScreen.call(this,e),this._dirty=!0},getAutoRotateToScreen:function(){return this._autoRotateToScreen},setLayout:function(e){this._layout="string"==typeof e?m[e]:e,this._dirty=!0},getLayout:function(){return this._layout},setAlignment:function(e){this._alignment="string"==typeof e?m[e]:e,this._dirty=!0},getAlignment:function(){return this._alignment},accept:function(){return function(e){if(this._dirty&&(this.drawText(),this._dirty=!1),e.getVisitorType()===f.CULL_VISITOR){var t=e.getViewport().width(),i=e.getViewport().height(),r=e.getCurrentProjectionMatrix(),n=e.getCurrentModelViewMatrix(),u=this._position,l=this._firstTimeToInitEyePoint;if(this._firstTimeToInitEyePoint||(s.exactEquals(n,this._previousModelView)?t!==this._previousWidth||i!==this._previousHeight?l=!0:s.exactEquals(r,this._previousProjection)?a.exactEquals(u,this._previousPosition)||(l=!0):l=!0:l=!0),this._firstTimeToInitEyePoint=!1,l){if(this._autoScaleToScreen){var c=e.getViewport(),h=this.computePixelSizeVector(c,r,n),d=o.fromValues(this._position[0],this._position[1],this._position[2],1),m=o.dot(d,h);m=.48/m;var v=1/m;if(this._autoScaleTransitionWidthRatio>0){var _,b,x;if(this._minimumScale>0){var S=this._minimumScale,y=this._maximumScale<Number.MAX_VALUE?this._minimumScale+(this._maximumScale-this._minimumScale)*this._autoScaleTransitionWidthRatio:this._minimumScale*(1+this._autoScaleTransitionWidthRatio);_=1/(4*(y-S)),b=1-2*_*y,x=S+b*b/(4*_);v<-b/(2*_)?v=this._minimumScale:v<y&&(v=x+b*v+_*(v*v))}if(this._maximumScale<Number.MAX_VALUE){var C=this._maximumScale,T=this._minimumScale>0?this._maximumScale+(this._minimumScale-this._maximumScale)*this._autoScaleTransitionWidthRatio:this._maximumScale*(1-this._autoScaleTransitionWidthRatio);_=1/(4*(T-C)),b=1-2*_*T,x=C+b*b/(4*_);v>-b/(2*_)?v=this._maximumScale:v>T&&(v=x+b*v+_*(v*v))}}this.setScale(v)}if(this._autoRotateToScreen){var M=p.create(),w=e.getCurrentModelViewMatrix();s.getRotation(M,w),this.setRotation(p.invert(M,M))}this._previousWidth=t,this._previousHeight=i,a.copy(this._previousPosition,u),s.copy(this._previousProjection,r),s.copy(this._previousModelView,n)}}g.prototype.accept.call(this,e)}}(),_setAlignmentValues:function(e){switch(e){case m.LEFT_TOP:this._context.textAlign="left",this._textX=0,this._context.textBaseline="top",this._textY=0;break;case m.LEFT_CENTER:this._context.textAlign="left",this._textX=0,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case m.LEFT_BOTTOM:this._context.textAlign="left",this._textX=0,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case m.CENTER_TOP:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="top",this._textY=0;break;case m.CENTER_CENTER:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case m.CENTER_BOTTOM:this._context.textAlign="center",this._textX=this._canvas.width/2,this._context.textBaseline="bottom",this._textY=this._canvas.height;break;case m.RIGHT_TOP:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="top",this._textY=0;break;case m.RIGHT_CENTER:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="middle",this._textY=this._canvas.height/2;break;case m.RIGHT_BOTTOM:this._context.textAlign="right",this._textX=this._canvas.width,this._context.textBaseline="bottom",this._textY=this._canvas.height}},setForcePowerOfTwo:function(e){this._forcePowerOfTwo=e},getForcePowerOfTwo:function(){return this._forcePowerOfTwo},_nextPowerOfTwo:function(e){var t=e;return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}}),"osgText","Text"),r.registerApplyFunction(m.nodeTypeID,r.getApplyFunction(u.nodeTypeID)),e.exports=m},function(e,t,i){"use strict";var r=i(14),n=i(67),a=i(145),o=i(428),s=i(88),u=i(293),l=i(8).vec3,c=i(459),h=i(458),d=i(164),p=i(291),f=i(136),g=i(165),m=i(382),v=function(){h.apply(this,arguments)},_=h.cloneStateAttributeConfig(h);_.textureAttribute=[],_.attribute=[],h.setStateAttributeConfig(v,_),r.createPrototypeObject(v,r.objectInherit(h.prototype,{getCompilerName:function(){return"CompilerDebugGeometry"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var e=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:e}),[e]}}),"osgUtil","CompilerColorGeometry");var b=function(){c.apply(this,arguments),this.setShaderCompiler(v)};r.createPrototypeObject(b,r.objectInherit(c.prototype,{}),"osgUtil","ShaderGeneratorCompilerColorGeometry");var x=function(){h.apply(this,arguments)},S=h.cloneStateAttributeConfig(h);S.textureAttribute=[],h.setStateAttributeConfig(x,S),r.createPrototypeObject(x,r.objectInherit(h.prototype,{getCompilerName:function(){return"CompilerDebugSkinning"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var e=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateVarying("vec3","vBonesColor"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:e}),[e]},declareVertexVaryings:function(e){var t=this.getOrCreateVarying("vec3","vBonesColor");return this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec3","BonesColor")).outputs(t),h.prototype.declareVertexVaryings.call(this,e)}}),"osgUtil","CompilerColorSkinning");var y=function(){c.apply(this,arguments),this.setShaderCompiler(x)};r.createPrototypeObject(y,r.objectInherit(c.prototype,{}),"osgUtil","ShaderGeneratorCompilerColorSkinning");var C=function(){n.call(this),this._debugColor=!0,this._debugSkinning=!1,this._stCenter=new u,this._stCenter.setShaderGeneratorName("debugGeometry")};C.CompilerColorGeometry=v,C.ShaderGeneratorCompilerColorGeometry=b,C.CompilerSkinningGeometry=x,C.ShaderGeneratorCompilerColorSkinning=y,r.createPrototypeObject(C,r.objectInherit(n.prototype,{setGeometryDebug:function(e){this._stCenter.setAttributeAndModes(new m(m.ALWAYS)),this._debugColor=!0,this._debugSkinning=!1,this.apply(e)},setSkinningDebug:function(e){this._stCenter.setAttributeAndModes(new m(m.NEVER)),this._debugColor=!1,this._debugSkinning=!0,this.apply(e)},disableDebug:function(e){this._stCenter.setAttributeAndModes(new m(m.NEVER)),this._debugColor=!1,this._debugSkinning=!1,this.apply(e)},apply:function(e){if(!e._isNormalDebug&&!e._isCenterDebug){if(e instanceof a)if(this._debugColor||this._debugSkinning&&e instanceof o){void 0===e._originalStateSet&&(e._originalStateSet=e.getStateSet()||null);var t=new u;if(e.setStateSet(t),this._debugSkinning){t.setShaderGeneratorName("debugSkinning");var i=e.getVertexAttributeList();if(!i.BonesColor){for(var r=i.Bones.getElements(),n=i.Weights.getElements(),c=e._rigTransformImplementation._bones,h=r.length/4,m=new Float32Array(3*h),v=0;v<h;++v){var _=4*v,b=c[r[_]].getOrCreateDebugColor(),x=c[r[_+1]].getOrCreateDebugColor(),S=c[r[_+2]].getOrCreateDebugColor(),y=c[r[_+3]].getOrCreateDebugColor(),C=n[_],T=n[_+1],M=n[_+2],w=n[_+3],A=3*v;m[A]=C*b[0]+T*x[0]+M*S[0]+w*y[0],m[A+1]=C*b[1]+T*x[1]+M*S[1]+w*y[1],m[A+2]=C*b[2]+T*x[2]+M*S[2]+w*y[2]}i.BonesColor=new d(d.ARRAY_BUFFER,m,3)}}else{var E=l.fromValues(Math.random(),Math.random(),Math.random());t.addUniform(s.createFloat3(E,"uColorDebug")),t.setShaderGeneratorName("debugGeometry");var P=e.getBound(),N=new Float32Array(18),F=.1*P.radius();N[0]=F,N[3]=-F,N[7]=F,N[10]=-F,N[14]=F,N[17]=-F;var R=new a;R.getAttributes().Vertex=new d(d.ARRAY_BUFFER,N,3);var I=new p(f.LINES,0,6);R.getPrimitives().push(I);var O=new g,L=P.center();O.getMatrix()[12]=L[0],O.getMatrix()[13]=L[1],O.getMatrix()[14]=L[2],O.addChild(R),this.nodePath[this.nodePath.length-2].addChild(O),E=l.fromValues(.8*E[0],.8*E[1],.8*E[2]),R.getOrCreateStateSet().addUniform(s.createFloat3(E,"uColorDebug")),O.setStateSet(this._stCenter),O._isCenterDebug=!0}}else void 0!==e._originalStateSet&&e.setStateSet(e._originalStateSet||void 0);this.traverse(e)}}}),"osgUtil","GeometryColorDebugVisitor"),e.exports=C},function(e,t,i){"use strict";var r=i(14),n=i(67),a=i(385),o=function(e){n.call(this,n.TRAVERSE_ALL_CHILDREN),this._selectables=e,this._nodeList=[],this._linkList=[],this._uniqueNodes=new window.Set,this._uniqueEdges=new window.Set};r.createPrototypeObject(o,r.objectInherit(n.prototype,{getColorFromClassName:function(e){switch(e){case"ShadowedScene":return"#3D3D3D";case"Camera":return"#AB7BCF";case"RenderBin":return"#59778B";case"LightSource":return"#53967D";case"RenderStage":return"#DDCC55";case"RenderLeaf":case"Geometry":return"#FFCC55";case"RigGeometry":return"#DD8800";case"MorphGeometry":return"#AA5500";case"MatrixTransform":return"#CE697E";case"StateSet":return"#0099FF";case"StateGraph":case"Skeleton":return"#96999E";case"Bone":return"#A9DEAA";case"Node":return"#FFFFFF";default:return"#FF00AA"}},createGraph:function(e){this.reset(),e.accept(this)},reset:function(){this._nodeList.length=0,this._linkList.length=0,this._uniqueNodes.clear(),this._uniqueEdges.clear()},apply:function(e){if(!e._isNormalDebug){if(this._uniqueNodes.has(e.getInstanceID())||(this._uniqueNodes.add(e.getInstanceID()),this._nodeList.push(e)),this.nodePath.length>=2){var t=this.nodePath[this.nodePath.length-2].getInstanceID(),i=e.getInstanceID(),r=t+"+"+i;this._uniqueEdges.has(r)||(this._linkList.push({parentNode:t,childrenNode:i}),this._uniqueEdges.add(r))}this.traverse(e)}},createMatrixGrid:function(e,t){var i="";return i+="<table><tr><td>"+t[0]+"</td>",i+="<td>"+t[4]+"</td>",i+="<td>"+t[8]+"</td>",i+="<td>"+t[12]+"</td></tr>",i+="<tr><td>"+t[1]+"</td>",i+="<td>"+t[5]+"</td>",i+="<td>"+t[9]+"</td>",i+="<td>"+t[13]+"</td></tr>",i+="<tr><td>"+t[2]+"</td>",i+="<td>"+t[6]+"</td>",i+="<td>"+t[10]+"</td>",i+="<td>"+t[14]+"</td></tr>",i+="<tr><td>"+t[3]+"</td>",i+="<td>"+t[7]+"</td>",i+="<td>"+t[11]+"</td>",i+="<td>"+t[15]+"</td></tr></table>"},getLabel:function(e){var t=e.className()+" ("+e.getInstanceID()+")";return e.getName&&e.getName()&&(t+="\n"+e.getName()),t},generateNode:function(e,t){var i="";t.getMatrix&&t.getMatrix()&&(i+="<br /><br />"+this.createMatrixGrid(t,t.getMatrix())),this._selectables.set(t.getInstanceID().toString(),t),e.addNode(t.getInstanceID(),{label:this.getLabel(t),description:i,style:"fill: "+this.getColorFromClassName(t.className())+";stroke-width: 0px;"})},generateStateSet:function(e,t){var i=t.getStateSet(),r=i.getInstanceID(),n=this.getLabel(i);n+="\nNbTexture : "+i.getNumTextureAttributeLists(),e.hasNode(r)||(this._selectables.set(r.toString(),i),e.addNode(r,{label:n,style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"})),e.addEdge(null,t.getInstanceID(),r,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateSourceGeometry:function(e,t){var i=t.getSourceGeometry(),r=i.getInstanceID();this._selectables.set(r.toString(),i),e.addNode(r,{label:this.getLabel(i),style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"}),e.addEdge(null,t.getInstanceID(),r,{style:"stroke: "+this.getColorFromClassName(i.className())+";"})},generateNodeAndLink:function(e){for(var t=0,i=this._nodeList.length;t<i;t++){var r=this._nodeList[t];this.generateNode(e,r),r.getStateSet()&&this.generateStateSet(e,r),r.getSourceGeometry&&r.getSourceGeometry()instanceof a&&this.generateSourceGeometry(e,r)}for(var n=0,o=this._linkList.length;n<o;n++)e.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}}),"osgUtil","DisplayGraphNode"),e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(67),a=i(145),o=i(164),s=i(291),u=i(136),l=i(293),c=i(88),h=i(382),d=i(8).vec3,p=i(459),f=i(458),g=i(428),m=i(385),v=i(574),_=function(){f.apply(this,arguments)},b=f.cloneStateAttributeConfig(f);b.textureAttribute=[],f.setStateAttributeConfig(_,b),r.createPrototypeObject(_,r.objectInherit(f.prototype,{getCompilerName:function(){return"CompilerOffsetNormal"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var e=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:this.getOrCreateUniform("vec3","uColorDebug"),alpha:this.createVariable("float").setValue("1.0")}).outputs({color:e}),[e]},getOffsetDirection:function(){return this.getOrCreateModelNormal()},getOrCreateModelVertex:function(){var e=this.getVariable("vertexOffset");if(e)return e;e=this.createVariable("vec3","vertexOffset");return this.getNode("InlineCode").code("%out = %offset == 1.0 ? %vertex + normalize(%direction.xyz) * %scale: %vertex;").inputs({offset:this.getOrCreateAttribute("float","Offset"),direction:this.getOffsetDirection(),vertex:f.prototype.getOrCreateModelVertex.call(this),scale:this.getOrCreateUniform("float","uScale")}).outputs({out:e}),e},getOrCreateViewVertex:function(){var e=this._variables.FragEyeVector;return e&&!e.isEmpty()?e:(e=this._varyings.FragEyeVector||this.createVariable("vec4","FragEyeVector"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uViewMatrix"),vec:this.getOrCreateModelVertex()}).outputs({vec:e}),e)}}),"osgUtil","CompilerOffsetNormal");var x=function(){p.apply(this,arguments),this.setShaderCompiler(_)};r.createPrototypeObject(x,r.objectInherit(p.prototype,{}),"osgUtil","ShaderGeneratorCompilerOffsetNormal");var S=function(){_.apply(this,arguments)},y=b;f.setStateAttributeConfig(S,y),r.createPrototypeObject(S,r.objectInherit(_.prototype,{getCompilerName:function(){return"CompilerOffsetTangent"},getOffsetDirection:function(){return this.getOrCreateModelTangent()}}),"osgUtil","CompilerOffsetTangent");var C=function(){p.apply(this,arguments),this.setShaderCompiler(S)};r.createPrototypeObject(C,r.objectInherit(p.prototype,{}),"osgUtil","ShaderGeneratorCompilerOffsetTangent");var T=function(){n.call(this),this._unifScale=c.createFloat(1,"uScale");var e=this._normalStateSet=new l;e.addUniform(c.createFloat3(d.fromValues(1,0,0),"uColorDebug")),e.addUniform(this._unifScale),e.setAttributeAndModes(new h(h.NEVER)),e.setShaderGeneratorName("debugNormal");var t=this._tangentStateSet=new l;t.addUniform(c.createFloat3(d.fromValues(0,1,0),"uColorDebug")),t.addUniform(this._unifScale),t.setAttributeAndModes(new h(h.NEVER)),t.setShaderGeneratorName("debugTangent")};T.CompilerOffsetNormal=_,T.CompilerOffsetTangent=S,T.ShaderGeneratorCompilerOffsetNormal=x,T.ShaderGeneratorCompilerOffsetTangent=C,r.createPrototypeObject(T,r.objectInherit(n.prototype,{setScale:function(e){this._unifScale.setFloat(e)},setTangentVisibility:function(e){this._tangentStateSet.setAttributeAndModes(new h(e?h.LESS:h.NEVER))},setNormalVisibility:function(e){this._normalStateSet.setAttributeAndModes(new h(e?h.LESS:h.NEVER))},apply:function(e){for(var t=e.getUpdateCallbackList(),i=0,r=t.length;i<r;++i)t[i]instanceof v&&(t[i]._isInitialized=!1);if(!e._isVisitedNormalDebug){if(e._isVisitedNormalDebug=!0,e instanceof a==!1)return this.traverse(e);this._createDebugGeom(e,"Normal",this._normalStateSet),this._createDebugGeom(e,"Tangent",this._tangentStateSet)}},_createDoubleOffsetArray:function(e){for(var t=new Float32Array(2*e),i=0;i<e;++i)t[2*i]=1;return new o(o.ARRAY_BUFFER,t,1)},_createDoubledBufferArray:function(e){e.getInitialBufferArray&&(e=e.getInitialBufferArray());for(var t=e.getItemSize(),i=e.getElements(),r=i.length/t,n=i.constructor,a=new n(2*i.length),s=0;s<r;++s)for(var u=s*t,l=2*u,c=0;c<t;++c)a[l+c]=a[l+c+t]=i[u+c];return new o(o.ARRAY_BUFFER,a,t)},_addMorphTargets:function(e,t,i){var r=t.getMorphTargets();t.setName(e.getName());for(var n=e.getMorphTargets(),o=0,s=n.length;o<s;++o){var u=n[o],l=u.getVertexAttributeList(),c=new a;c.setName(u.getName());var h=c.getVertexAttributeList();h.Vertex=this._createDoubledBufferArray(l.Vertex),l[i]&&(h[i]=this._createDoubledBufferArray(l[i])),r.push(c)}return t.mergeChildrenVertexAttributeList(),t},_createDebugGeom:function(e,t,i){var r=e.getAttributes(),n=r[t];if(n){var o=r.Vertex;if(o){var l;e instanceof m?l=e:e.getSourceGeometry&&e.getSourceGeometry()instanceof m&&(l=e.getSourceGeometry());var c=o.getElements().length/o.getItemSize(),h=l?new m:new a;h.getAttributes().Vertex=this._createDoubledBufferArray(o),h.getAttributes().Offset=this._createDoubleOffsetArray(c),h.getAttributes()[t]=this._createDoubledBufferArray(n),h.getPrimitives().push(new s(u.LINES,0,2*c)),l&&this._addMorphTargets(l,h,t);var d;if(e instanceof g){var p=new g;p.setSourceGeometry(h),p.getVertexAttributeList().Bones=this._createDoubledBufferArray(r.Bones),p.getVertexAttributeList().Weights=this._createDoubledBufferArray(r.Weights),p._rigTransformImplementation=e._rigTransformImplementation,p._stateSetAnimation=e._stateSetAnimation,p.mergeChildrenData(),d=p}else d=h;var f=e.getParents(),v=f.length;d._isVisitedNormalDebug=!0,d._isNormalDebug=!0,d.setStateSet(i);for(var _=0;_<v;++_)f[_].addChild(d);return d}}}}),"osgUtil","DisplayNormalVisitor"),e.exports=T},function(e,t,i){"use strict";var r=i(8).vec3,n=i(655),a=i(424),o=i(431),s=function(){this._intersectionPoints=[],this._primitiveIndex=void 0,this._distance=0,this._maxDistance=0,this._nodePath=void 0,this._drawable=void 0,this._matrix=void 0,this._localIntersectionPoint=void 0,this._numIntersectionPoints=0},u=function(e){this._src=[],this._dest=[],this._settings=e,this._primitiveIndex=0,this._hit=!1,this._maxNumIntersectionsPoints=6,this._primitiveMask=o.ALL_PRIMITIVES};u.prototype={enter:function(e){return!!this._settings._polytopeIntersector.getPolytope().containsBoundingBox(e)&&(this._settings._polytopeIntersector.getPolytope().pushCurrentMask(),!0)},leave:function(){this._settings._polytopeIntersector.getPolytope().popCurrentMask()},addIntersection:function(){this._src=function(e){for(var t={},i=[],r=e.length,n=0,a=0;a<r;a++){var o=e[a];1!==t[o]&&(t[o]=1,i[n++]=o)}return i}(this._src);for(var e=r.create(),t=-Number.MAX_VALUE,i=this._settings._referencePlane,n=0;n<this._src.length;++n){r.add(e,e,this._src[n]);var o=a.distanceToPlane(i,this._src[n]);o>t&&(t=o)}r.scale(e,e,1/this._src.length);var u=new s;for(u._primitiveIndex=this._primitiveIndex,u._distance=a.distanceToPlane(i,e),u._maxDistance=t,u._nodePath=this._settings._intersectionVisitor.getNodePath().slice(),u._drawable=this._settings._geometry,u._matrix=this._settings._intersectionVisitor.getModelMatrix(),u._localIntersectionPoint=r.clone(e),u._numIntersectionPoints=this._src.length<this._maxNumIntersectionsPoints?this._src.length:this._maxNumIntersectionsPoints,n=0;n<u._numIntersectionPoints;++n)u._intersectionPoints.push(r.clone(this._src[n]));this._settings._polytopeIntersector.insertIntersection(u),this._hit=!0},contains:function(){var e=this._settings._polytopeIntersector.getPolytope(),t=e.getPlanes(),i=e.getCurrentMask();if(!i)return!0;for(var n=1,o=0;o<t.length;++o){if(i&n){this._dest=[];for(var s=t[o],u=this._src[1],l=a.distanceToPlane(s,u),c=0;c<this._src.length;++c){var h=this._src[c],d=a.distanceToPlane(s,h);if(l>=0&&this._dest.push(r.clone(u)),l*d<0){var p=l-d,f=l/p,g=r.add(r.create(),r.scale(r.create(),u,1-f),r.scale(r.create(),h,f));this._dest.push(g)}l=d,u=h}if(l>=0&&this._dest.push(r.clone(u)),this._dest.length<=1)return!1;var m=this._src.slice();this._src=this._dest.slice(),this._dest=m}n<<=1}return!0},containsPoint:function(e){return!!this._settings._polytopeIntersector.getPolytope().containsVertex(e)&&(this._src=[],this._src[0]=e,!0)},containsLine:function(e,t){return this._src=[],this._src[0]=e,this._src[1]=t,this.contains()},containsTriangle:function(e,t,i){return this._src=[],this._src[0]=e,this._src[1]=t,this._src[2]=i,this.contains()},operatorPoint:function(e){if(!this._settings._limitOneIntersection||!this._hit){if(0==(this._settings._primitiveMask&o.POINT_PRIMITIVES))return void this._primitiveIndex++;var t=this._settings._polytopeIntersector.getPolytope(),i=t.getPlanes(),r=t.getCurrentMask();if(r)for(var n=0,s=i.length;n<s;++n)if(1&r&&a.distanceToPlane(i[n],e)<0)return void this._primitiveIndex++;this._src[0]=e,this.addIntersection(),this._primitiveIndex++}},operatorLine:function(e,t){if(!this._settings._limitOneIntersection||!this._hit){if(0==(this._settings._primitiveMask&o.LINE_PRIMITIVES))return void this._primitiveIndex++;this._src=[],this._src[0]=e,this._src[1]=t,this._src[2]=e,this.contains()&&this.addIntersection(),this._primitiveIndex++}},operatorTriangle:function(e,t,i){if(!this._settings._limitOneIntersection||!this._hit){if(0==(this._settings._primitiveMask&o.TRIANGLE_PRIMITIVES))return void this._primitiveIndex++;this._src=[],this._src[0]=e,this._src[1]=t,this._src[2]=i,this._src[3]=e,this.contains()&&this.addIntersection(),this._primitiveIndex++}},intersectPoint:function(){var e=r.create();return function(t,i,n){this._settings._limitOneIntersection&&this._hit||0!=(this._settings._primitiveMask&o.POINT_PRIMITIVES)&&(r.set(e,t[3*n],t[3*n+1],t[3*n+2]),this.containsPoint(e)&&(this._primitiveIndex=i,this.addIntersection()))}}(),intersectLine:function(){var e=r.create(),t=r.create();return function(i,n,a,s){this._settings._limitOneIntersection&&this._hit||0!=(this._settings._primitiveMask&o.LINE_PRIMITIVES)&&(r.set(e,i[3*a],i[3*a+1],i[3*a+2]),r.set(t,i[3*s],i[3*s+1],i[3*s+2]),this.containsLine(e,t)&&(this._primitiveIndex=n,this.addIntersection()))}}(),intersectTriangle:function(){var e=r.create(),t=r.create(),i=r.create();return function(n,a,s,u,l){this._settings._limitOneIntersection&&this._hit||0!=(this._settings._primitiveMask&o.TRIANGLE_PRIMITIVES)&&(r.set(e,n[3*s],n[3*s+1],n[3*s+2]),r.set(t,n[3*u],n[3*u+1],n[3*u+2]),r.set(i,n[3*l],n[3*l+1],n[3*l+2]),this.containsTriangle(e,t,i)&&(this._primitiveIndex=a,this.addIntersection()))}}(),apply:function(e){if(e.getAttributes().Vertex){var t=e.getAttributes().Vertex.getElements(),i=this;new n(e,function(){return{operatorPoint:function(e){i.operatorPoint(e)},operatorLine:function(e,t){i.operatorLine(e,t)},operatorTriangle:function(e,t,r){i.operatorTriangle(e,t,r)}}},t).apply()}}},e.exports=u},function(e,t,i){"use strict";var r=i(8).vec4,n=i(8).vec3,a=i(569),o=i(710),s=i(424),u=i(431),l=function(){this._polytopeIntersector=void 0,this._intersectionVisitor=void 0,this._geometry=void 0,this._vertices=[],this._limitOneIntersection=!1,this._primitiveMask=u.ALL_PRIMITIVES},c=function(){this._intersections=[],this._index=0,this._polytope=new a,this._iPolytope=new a,this._referencePlane=r.create(),this._iReferencePlane=r.create(),this._intersectionLimit=u.NO_LIMIT,this._primitiveMask=u.ALL_PRIMITIVES},h=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3];e[0]=i[0]*r+i[1]*n+i[2]*a+i[3]*o,e[1]=i[4]*r+i[5]*n+i[6]*a+i[7]*o,e[2]=i[8]*r+i[9]*n+i[10]*a+i[11]*o,e[3]=i[12]*r+i[13]*n+i[14]*a+i[15]*o};c.prototype={setPolytope:function(e){this._polytope.setPlanes(e);for(var t=[],i=0;i<e.length;++i){var n=e[i];t[i]=r.copy(this._iPolytope.getPlanes()[i]||s.create(),n)}this._iPolytope.setPlanes(t),r.copy(this._referencePlane,e[e.length-1]),r.copy(this._iReferencePlane,this._referencePlane)},getPolytope:function(){return this._iPolytope},getPrimitiveMask:function(){return this._primitiveMask},setPolytopeFromWindowCoordinates:function(e,t,i,n){this.setPolytope([r.fromValues(1,0,0,-e),r.fromValues(-1,0,0,i),r.fromValues(0,1,0,-t),r.fromValues(0,-1,0,n),r.fromValues(0,0,1,0)])},setPrimitiveMask:function(e){this._primitiveMask=e},reset:function(){this._intersections.length=0},enter:function(e){return!this.reachedLimit()&&(!e.isCullingActive()||this._iPolytope.containsBoundingSphere(e.getBound()))},reachedLimit:function(){return this._intersectionLimit===u.LIMIT_ONE&&this._intersections.length>0},intersect:function(e,t){if(this.reachedLimit())return!1;if(this._iPolytope.containsBoundingBox(t.getBoundingBox())){var i=new l;i._intersectionVisitor=e,i._referencePlane=this._iReferencePlane,i._polytopeIntersector=this,i._limitOneIntersection=this._intersectionLimit===u.LIMIT_ONE_PER_DRAWABLE||this._intersectionLimit===u.LIMIT_ONE,i._primitiveMask=this._primitiveMask,i._geometry=t;var r=t.getShape(),n=new o(i);r?r.intersect(n,r.getNodes()[0]):n.apply(t)}},insertIntersection:function(e){this._intersections.push(e)},getIntersections:function(){return this._intersections},setIntersectionLimit:function(e){this._intersectionLimit=e},setCurrentTransformation:function(e){for(var t=this._polytope.getPlanes(),i=this._iPolytope.getPlanes(),a=0,o=t.length;a<o;a++){var s=i[a]=i[a]||r.create();h(s,t[a],e),r.scale(s,s,1/n.len(s))}h(this._iReferencePlane,this._referencePlane,e),r.scale(this._iReferencePlane,this._iReferencePlane,1/n.len(this._iReferencePlane))}},e.exports=c},function(e,t,i){"use strict";var r=i(384),n=function(e,t){var i,r;t?(i=t[0],r=t[1]):(i=e[14]/(e[10]-1),r=e[14]/(1+e[10]));var n=i*(e[8]-1)/e[0],a=i*(1+e[8])/e[0],o=i*(1+e[9])/e[5],s=i*(e[9]-1)/e[5],u=r*(e[8]-1)/e[0],l=r*(1+e[8])/e[0],c=r*(1+e[9])/e[5],h=r*(e[9]-1)/e[5],d=this.getAttributes().Vertex,p=d.getElements();p[0]=n,p[1]=s,p[2]=-i,p[3]=a,p[4]=s,p[5]=-i,p[6]=a,p[7]=o,p[8]=-i,p[9]=n,p[10]=o,p[11]=-i,p[12]=u,p[13]=h,p[14]=-r,p[15]=l,p[16]=h,p[17]=-r,p[18]=l,p[19]=c,p[20]=-r,p[21]=u,p[22]=c,p[23]=-r,d.dirty()},a=function(){var e=r.createBoundingBoxGeometry();return e.updateGeometry=n,e};e.exports={createDebugFrustumGeometry:a}},function(e,t,i){"use strict";var r,n,a,o=i(164),s=i(145),u=i(136),l=i(291),c=i(292),h=i(329),d=i(330),p=["#ifdef GL_ES","precision highp float;","#endif"].join("\n"),f=function(){if(r)return r;var e="#define SHADER_NAME GizmoLine3D",t=[p,"attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;",e,"","void main(void) {","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=[p,"uniform vec4 uColor;",e,"","void main(void) {","  gl_FragColor = uColor;","}"].join("\n");return r=new h(new d(d.VERTEX_SHADER,t),new d(d.FRAGMENT_SHADER,i))},g=function(){if(n)return n;var e="#define SHADER_NAME GizmoLine2D",t=[p,"attribute vec2 Vertex;",e,"","void main(void) {","  gl_Position = vec4(Vertex, 0.0, 1.0);","}"].join("\n"),i=[p,e,"","void main(void) {","  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","}"].join("\n");return n=new h(new d(d.VERTEX_SHADER,t),new d(d.FRAGMENT_SHADER,i))},m=function(){if(a)return a;var e="#define SHADER_NAME GizmoQuadCircle",t=[p,"attribute vec3 Vertex;","uniform mat4 uModelViewMatrix;","uniform mat4 uProjectionMatrix;","varying vec3 vViewVertex;",e,"","void main(void) {","  vViewVertex = Vertex;","  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);","}"].join("\n"),i=[p,"uniform float uAngle;","uniform vec3 uBase;","varying vec3 vViewVertex;","const float PI = 3.14159265358979323846264;","const float PI2 = PI * 2.0;",e,"","void main(void) {","  if(length(vViewVertex) > 0.5)","    discard;","  vec3 vn = normalize(vViewVertex);","  float angle = atan(uBase.y * vn.x - uBase.x * vn.y, dot(uBase, vn));","  if(angle > 0.0) {","    if(uAngle >= 0.0 && angle > uAngle) discard;","    if(uAngle < -PI && angle < uAngle + PI2) discard;","    if(uAngle < 0.0 && uAngle > -PI) discard;","  }","  if(angle < 0.0) {","    if(uAngle <= 0.0 && angle < uAngle) discard;","    if(uAngle > PI && angle > uAngle - PI2) discard;","    if(uAngle > 0.0 && uAngle < PI) discard;","  }","  gl_FragColor = vec4(1.0, 1.0, 0.0, 0.5);","}"].join("\n");return a=new h(new d(d.VERTEX_SHADER,t),new d(d.FRAGMENT_SHADER,i))},v=function(){var e=new s;e.getAttributes().Vertex=new o(o.ARRAY_BUFFER,new Float32Array(4),2);var t=new l(u.LINES,0,2);return e.getPrimitives().push(t),e.getOrCreateStateSet().setAttributeAndModes(g()),e},_=function(e,t,i,r,n){var a=void 0!==e?e:1,l=void 0!==t?t:.2,h=void 0!==i?i:6,d=void 0!==r?r:64,p=void 0!==n?n:2*Math.PI,g=(h+1)*(d+1),m=h*d*2,v=new s,_=new Float32Array(3*g),b=new Uint16Array(3*m);p=p||2*Math.PI;var x=0,S=0,y=0,C=0;for(C=0;C<=h;++C)for(y=0;y<=d;++y){var T=y/d*p,M=C/h*Math.PI*2;S=3*x,_[S]=(a+l*Math.cos(M))*Math.cos(T),_[S+1]=(a+l*Math.cos(M))*Math.sin(T),_[S+2]=l*Math.sin(M),x++}for(x=0,C=1;C<=h;++C)for(y=1;y<=d;++y)S=6*x,b[S]=(d+1)*C+y-1,b[S+1]=b[S+3]=(d+1)*(C-1)+y-1,b[S+2]=b[S+5]=(d+1)*C+y,b[S+4]=(d+1)*(C-1)+y,x++;return v.getAttributes().Vertex=new o(o.ARRAY_BUFFER,_,3),v.getOrCreateStateSet().setAttributeAndModes(f()),v.getPrimitives().push(new c(u.TRIANGLES,new o(o.ELEMENT_ARRAY_BUFFER,b,1))),v},b=function(e,t,i,r,n,a,l){var h=void 0!==e?e:1,d=void 0!==t?t:1,p=void 0!==i?i:5,g=void 0!==r?r:32,m=void 0!==n?n:1,v=void 0===a||a,_=void 0===l||l;v=v&&h>0,_=_&&d>0;var b=.5*p,x=(m+1)*(g+1),S=m*g*2;v&&(x+=1,S+=g),_&&(x+=1,S+=g);var y=new s,C=new Float32Array(3*x),T=new Uint16Array(3*S),M=0,w=0,A=0,E=0;for(A=0;A<=m;A++){var P=A/m,N=P*(d-h)+h;for(E=0;E<=g;E++){var F=E/g;w=3*M,C[w]=N*Math.sin(F*Math.PI*2),C[w+1]=N*Math.cos(F*Math.PI*2),C[w+2]=-P*p+b,M++}}for(M=0,E=0;E<g;E++)for(A=0;A<m;A++)w=6*M,T[w]=(g+1)*A+E,T[w+1]=T[w+3]=(g+1)*(A+1)+E,T[w+2]=T[w+5]=(g+1)*A+E+1,T[w+4]=(g+1)*(A+1)+E+1,M++;M*=2;var R;if(v)for(R=(_?C.length-6:C.length-3)/3,C[3*R+2]=b,E=0;E<g;E++)w=3*M,T[w]=E,T[w+1]=E+1,T[w+2]=R,M++;if(_){R=(C.length-3)/3,C[3*R+2]=-b;var I=(g+1)*A;for(E=0;E<g;E++)w=3*M,T[w]=I+E+1,T[w+1]=I+E,T[w+2]=R,M++}return y.getAttributes().Vertex=new o(o.ARRAY_BUFFER,C,3),y.getOrCreateStateSet().setAttributeAndModes(f()),y.getPrimitives().push(new c(u.TRIANGLES,new o(o.ELEMENT_ARRAY_BUFFER,T,1))),y},x=function(e,t,i){for(var r=new s,n=new Float32Array(3*e),a=i||2*Math.PI,c=0;c<e;++c){var h=3*c,d=a*c/e;n[h]=Math.cos(d)*t,n[h+1]=Math.sin(d)*t}r.getAttributes().Vertex=new o(o.ARRAY_BUFFER,n,3);var p=new l(u.LINE_STRIP,0,e);return r.getOrCreateStateSet().setAttributeAndModes(f()),r.getPrimitives().push(p),r},S=function(e,t){var i=e?.5*e:.5,r=t?.5*t:.5,n=new s,a=new Float32Array(12);a[0]=-i,a[1]=-r,a[3]=i,a[4]=-r,a[6]=-i,a[7]=r,a[9]=i,a[10]=r,n.getAttributes().Vertex=new o(o.ARRAY_BUFFER,a,3);var c=new l(u.TRIANGLE_STRIP,0,4);return n.getOrCreateStateSet().setAttributeAndModes(f()),n.getPrimitives().push(c),n},y=function(){var e=S();return e.getOrCreateStateSet().setAttributeAndModes(m()),e},C={};C.createCircleGeometry=x,C.createCylinderGeometry=b,C.createTorusGeometry=_,C.createDebugLineGeometry=v,C.createPlaneGeometry=S,C.createQuadCircleGeometry=y,e.exports=C},function(e,t,i){"use strict";var r=i(14),n=i(91),a=i(677),o=function(){n.call(this),this._databasePager=new a,this._sceneData=void 0};r.createPrototypeObject(o,r.objectInherit(n.prototype,{getSceneData:function(){return this._sceneData},setSceneData:function(e){this._sceneData=e},setDatabasePager:function(e){this._databasePager=e},getDatabasePager:function(){return this._databasePager},updateSceneGraph:function(e){this._databasePager&&this._databasePager.updateSceneGraph(e.getFrameStamp()),this._sceneData&&this._sceneData.accept(e)}}),"osgViewer","Scene"),e.exports=o},function(e,t,i){"use strict";var r=i(940),n=i(941),a=i(942),o=i(943),s=i(944),u=i(939);e.exports={GamePad:r,Hammer:n,LeapMotion:a,StandardMouseKeyboard:o,WebVR:s,DeviceOrientation:u}},function(e,t,i){"use strict";var r=function(){var e=function(e){return'<div style="margin: auto; width:500px;z-index:10000;margin-top:20em;text-align:center;">'+e+"</div>"},t='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',i='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org">Click here for more information.</a>',r=!0,n=function(n,a,s){function u(n){if(r){var a=document.getElementsByTagName("body")[0];if(a){var o=window.WebGLRenderingContext?i:t;n&&(o+="<br/><br/>Status: "+n),a.innerHTML=e(o)}}}s=s||u,n.addEventListener&&n.addEventListener("webglcontextcreationerror",function(e){s(e.statusMessage)},!1);var l=o(n,a);return l||s(""),l},a=function(e,t,i){for(var r=null,n=0;n<i.length;++n){try{r=e.getContext(i[n],t)}catch(e){}if(r)break}return r},o=function(e,t){var i;if(t&&t.webgl2){if(r=!1,i=a(e,t,["webgl2","experimental-webgl2"]))return i;r=!0}return a(e,t,["webgl","experimental-webgl","webkit-3d","moz-webgl"])};return{create3DContext:o,setupWebGL:n}}();window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),window.cancelRequestAnimFrame||(window.cancelRequestAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}()),Date.now||(Date.now=function(){return(new Date).getTime()}),e.exports=r},function(e,t,i){"use strict";var r=i(10),n=i(30),a=i(506),o=i(429),s=i(500),u=i(386),l=i(671),c=i(572),h=i(385),d=i(145),p={},f=function(){},g=u.registry();g.registerObject("osgAnimation.Vec3LerpChannel",f),g.registerObject("osgAnimation.FloatLerpChannel",f),g.registerObject("osgAnimation.QuatSlerpChannel",f),g.registerObject("osgAnimation.QuatLerpChannel",f),g.registerObject("osgAnimation.FloatCubicBezierChannel",f),g.registerObject("osgAnimation.Vec3CubicBezierChannel",f),g.registerObject("osgAnimation.StackedMatrixElement",l),g.registerObject("osgAnimation.StackedScaleElement",c),p.Animation=function(e){var t=e.getJSON();if(void 0===t.Name||!t.Channels||0===t.Channels.length)return r.reject();for(var i=[],n=0,a=t.Channels.length;n<a;n++){var o=e.setJSON(t.Channels[n]).readObject();i.push(o)}return r.all(i).then(function(e){return s.createAnimation(e,t.Name)})},p.StandardVec3Channel=function(e,t,i){var n=e.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&3===n.KeyFrames.Key.length))return r.reject();var a=e.setJSON(n.KeyFrames.Time).readBufferArray(),o=e.setJSON(n.KeyFrames.Key[0]).readBufferArray(),s=e.setJSON(n.KeyFrames.Key[1]).readBufferArray(),u=e.setJSON(n.KeyFrames.Key[2]).readBufferArray();return r.all([a,o,s,u]).then(function(e){for(var r=e[0].getElements(),a=e[1].getElements(),o=e[2].getElements(),s=e[3].getElements(),u=r.length,l=new Float32Array(new ArrayBuffer(4*(u+1)*3),0,3*u),c=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),h=0;h<u;h++){var d=3*h;c[h]=r[h],l[d++]=a[h],l[d++]=o[h],l[d]=s[h]}return i(l,c,n.TargetName,n.Name,t),t})},p.StandardQuatChannel=function(e,t,i){var n=e.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key&&4===n.KeyFrames.Key.length))return r.reject();var a=e.setJSON(n.KeyFrames.Time).readBufferArray(),o=e.setJSON(n.KeyFrames.Key[0]).readBufferArray(),s=e.setJSON(n.KeyFrames.Key[1]).readBufferArray(),u=e.setJSON(n.KeyFrames.Key[2]).readBufferArray(),l=e.setJSON(n.KeyFrames.Key[3]).readBufferArray();return r.all([a,o,s,u,l]).then(function(e){for(var r=e[0].getElements(),a=e[1].getElements(),o=e[2].getElements(),s=e[3].getElements(),u=e[4].getElements(),l=r.length,c=new Float32Array(new ArrayBuffer(4*(l+1)*4),0,4*l),h=new Float32Array(new ArrayBuffer(4*(l+1)),0,l),d=0;d<l;d++){var p=4*d;h[d]=r[d],c[p++]=a[d],c[p++]=o[d],c[p++]=s[d],c[p]=u[d]}return i(c,h,n.TargetName,n.Name,t),t})},p.StandardFloatChannel=function(e,t,i){var n=e.getJSON();if(!(void 0!==n.TargetName&&n.KeyFrames&&n.Name&&n.KeyFrames.Time&&n.KeyFrames.Key))return r.reject();var a=e.setJSON(n.KeyFrames.Time).readBufferArray(),o=e.setJSON(n.KeyFrames.Key).readBufferArray();return r.all([a,o]).then(function(e){for(var r=e[0].getElements(),a=e[1].getElements(),o=r.length,s=new Float32Array(new ArrayBuffer(4*(o+1)),0,o),u=new Float32Array(new ArrayBuffer(4*(o+1)),0,o),l=0;l<o;l++)u[l]=r[l],s[l]=a[l];return i(s,u,n.TargetName,n.Name,t),t})},p.Vec3LerpChannel=function(e,t){return p.StandardVec3Channel(e,t,o.createVec3Channel)},p.QuatLerpChannel=function(e,t){return p.StandardQuatChannel(e,t,o.createQuatChannel)},p.QuatSlerpChannel=function(e,t){return p.StandardQuatChannel(e,t,o.createQuatChannel)},p.FloatLerpChannel=function(e,t){return p.StandardFloatChannel(e,t,o.createFloatChannel)},p.FloatCubicBezierChannel=function(e,t){var i=e.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn))return r.reject();for(var n=[],a=window.Object.keys(i.KeyFrames),s=0;s<a.length;s++)n.push(e.setJSON(i.KeyFrames[a[s]]).readBufferArray());return r.all(n).then(function(e){for(var r=e[0].getElements(),n=e[1].getElements(),a=e[2].getElements(),s=e[3].getElements(),u=s.length,l=new Float32Array(new ArrayBuffer(4*(u+1)*3),0,3*u),c=new Float32Array(new ArrayBuffer(4*(u+1)),0,u),h=0;h<u;h++){var d=3*h;c[h]=s[h],l[d++]=a[h],l[d++]=r[h],l[d]=n[h]}return o.createFloatCubicBezierChannel(l,c,i.TargetName,i.Name,t),t})},p.Vec3CubicBezierChannel=function(e,t){var i=e.getJSON();if(!(void 0!==i.TargetName&&i.KeyFrames&&i.Name&&i.KeyFrames.Time&&i.KeyFrames.Position&&i.KeyFrames.ControlPointOut&&i.KeyFrames.ControlPointIn&&3===i.KeyFrames.Position.length&&3===i.KeyFrames.ControlPointIn.length&&3===i.KeyFrames.ControlPointOut.length))return r.reject();for(var n=[],a=window.Object.keys(i.KeyFrames),s=0;s<a.length;s++){var u=a[s],l=i.KeyFrames[u];"Time"!==u?(n.push(e.setJSON(l[0]).readBufferArray()),n.push(e.setJSON(l[1]).readBufferArray()),n.push(e.setJSON(l[2]).readBufferArray())):n.push(e.setJSON(l).readBufferArray())}return r.all(n).then(function(e){for(var r=e[0].getElements(),n=e[1].getElements(),a=e[2].getElements(),s=e[3].getElements(),u=e[4].getElements(),l=e[5].getElements(),c=e[6].getElements(),h=e[7].getElements(),d=e[8].getElements(),p=e[9].getElements(),f=p.length,g=new Float32Array(new ArrayBuffer(4*(f+1)*9),0,9*f),m=new Float32Array(new ArrayBuffer(4*(f+1)),0,f),v=0;v<f;v++){var _=9*v;m[v]=p[v],g[_++]=c[v],g[_++]=h[v],g[_++]=d[v],g[_++]=r[v],g[_++]=n[v],g[_++]=a[v],g[_++]=s[v],g[_++]=u[v],g[_]=l[v]}return o.createVec3CubicBezierChannel(g,m,i.TargetName,i.Name,t),t})},p.BasicAnimationManager=function(e,t){var i=e.getJSON();if(!i.Animations)return r.reject();a.Object(e,t);for(var o=[],s=0,u=i.Animations.length;s<u;s++){var l=e.setJSON(i.Animations[s]).readObject();l.isRejected()?n.warn("An Animation failed on the parsing!"):o.push(l)}return r.all(o).then(function(e){return t.init(e),t})},p.UpdateMatrixTransform=function(e,t){var i=e.getJSON();if(/*!jsonObj.Name ||*/!i.StackedTransforms)return r.reject();a.Object(e,t);for(var n=[],o=0,s=i.StackedTransforms.length;o<s;o++)n.push(e.setJSON(i.StackedTransforms[o]).readObject());return r.all(n).then(function(e){for(var i=t.getStackedTransforms(),r=0,n=e.length;r<n;r++)i.push(e[r]);return t.computeChannels(),t})},p.StackedTranslate=function(e,t){var i=e.getJSON();return i.Name&&i.Translate?(a.Object(e,t),t.init(i.Translate),r.resolve(t)):r.reject()},p.StackedQuaternion=function(e,t){var i=e.getJSON();return i.Name&&i.Quaternion?(a.Object(e,t),t.init(i.Quaternion),r.resolve(t)):r.reject()},p.StackedRotateAxis=function(e,t){var i=e.getJSON();return i.Axis&&void 0!==i.Angle?(a.Object(e,t),t.init(i.Axis,i.Angle),r.resolve(t)):r.reject()},p.StackedMatrix=function(e,t){var i=e.getJSON();return i.Name&&i.Matrix?(a.Object(e,t),t.init(i.Matrix),r.resolve(t)):r.reject()},p.StackedScale=function(e,t){var i=e.getJSON();return i.Name&&i.Scale?(a.Object(e,t),t.init(i.Scale),r.resolve(t)):r.reject()},p.Bone=function(e,t){var i=e.getJSON();if(!i.InvBindMatrixInSkeletonSpace)return r.reject();var n=a.MatrixTransform(e,t);if(t.setInvBindMatrixInSkeletonSpace(i.InvBindMatrixInSkeletonSpace),i.BoundingBox){var o=t.getBoneBoundingBox();o.setMax(i.BoundingBox.max),o.setMin(i.BoundingBox.min)}return n},p.UpdateBone=p.UpdateMatrixTransform,p.UpdateSkeleton=function(e,t){return a.Object(e,t),r.resolve(t)},p.Skeleton=a.MatrixTransform,p.RigGeometry=function(e,t){var i=e.getJSON();if(!i.SourceGeometry)return r.reject();i.BoneMap||n.warn("No boneMap found in a RigGeometry !");var o=a.Geometry(e,t);t._boneNameID=i.BoneMap;var s,u=i.SourceGeometry["osg.Geometry"];return u?(e.setJSON(u),t.setSourceGeometry(new d),s=a.Geometry(e,t.getSourceGeometry())):(u=i.SourceGeometry["osgAnimation.MorphGeometry"],u?(e.setJSON(u),t.setSourceGeometry(new h),s=p.MorphGeometry(e,t.getSourceGeometry())):n.warn("SourceGeometry type no recognized")),void 0===t._uniqueID&&(t._uniqueID=u.UniqueID),r.all([o,s]).then(function(){return t.mergeChildrenData(),t})},p.MorphGeometry=function(e,t){var i=e.getJSON();if(!i.MorphTargets)return r.reject();var n=i.MorphTargets,o=[];o.push(a.Geometry(e,t));for(var s=0,u=n.length;s<u;s++)o.push(e.setJSON(n[s]).readObject());return r.all(o).then(function(e){for(var t=e[0],i=t.getMorphTargets(),r=1,n=e.length;r<n;r++)i.push(e[r]);return t.mergeChildrenVertexAttributeList(),t})},p.UpdateMorph=function(e,t){var i=e.getJSON();if(!i.TargetMap)return r.reject();a.Object(e,t);for(var n=window.Object.keys(i.TargetMap),o=0,s=n.length;o<s;o++){var u=n[o];t.addTarget(i.TargetMap[u],parseInt(u,10))}return r.resolve(t)},p.StackedMatrixElement=p.StackedMatrix,p.StackedScaleElement=p.StackedScale,e.exports=p},function(e,t,i){"use strict";var r=i(10),n=i(506),a=i(30),o=i(706),s={};s.Text=function(e,t){var i=e.getJSON();if(!i.Text)return r.reject();var s=n.Node(e,t);if(t.setColor(i.Color),t.setText(i.Text),t.setAutoRotateToScreen(i.AutoRotateToScreen),t.setPosition(i.Position),t.setCharacterSize(i.CharacterSize),"VERTICAL"===i.Layout)return a.error("Vertical Alignment not supported"),r.reject();var u=i.Alignment;return i.Alignment.indexOf("BASE_LINE")>-1&&("LEFT_BASE_LINE"===i.Alignment?u=o.LEFT_CENTER:"CENTER_BASE_LINE"===i.Alignment?u=o.CENTER_CENTER:"RIGHT_BASE_LINE"===i.Alignment?u=o.RIGHT_CENTER:"LEFT_BOTTOM_BASE_LINE"===i.Alignment?u=o.LEFT_BOTTOM:"CENTER_BOTTOM_BASE_LINE"===i.Alignment?u=o.CENTER_BOTTOM:"RIGHT_BOTTOM_BASE_LINE"===i.Alignment&&(u=o.RIGHT_BOTTOM)),t.setAlignment(u),t.setLayout(i.Layout),s},e.exports=s},function(e,t,i){"use strict";var r=i(19),n=i.n(r),a=i(2),o=i.n(a),s=i(0),u=(i.n(s),i(149));t.a=u.a.extend({el:['<div class="widget slider-widget">','          <div class="widget-wrapper">','              <div class="bar">','                  <div class="slide">','                      <div class="cursor"></div>',"                  </div>","              </div>","          </div>","      </div>"].join(""),events:i.i(s.extend)({},u.a.prototype.events,{"mousedown .bar":"trackDrag","mousedown .cursor":"cursorDrag","touchstart .bar":"trackDrag","touchstart .cursor":"cursorDrag"}),constructor:function(e,t){t=i.i(s.defaults)(t||{},{model:new n.a.Model,name:"value",minimum:0,maximum:100,step:1,orientation:"horizontal"}),u.a.prototype.constructor.call(this,e,t),void 0===this.get()&&this.set(0)},initialize:function(){this.$slide=this.$(".slide"),"vertical"===this.options.orientation&&this.$el.addClass("--vertical"),this.render()},delegateEvents:function(){u.a.prototype.delegateEvents.apply(this,arguments),o()(window).on("mousemove.delegateEvents"+this.cid,this.moveEvent.bind(this)),o()(window).on("mouseup.delegateEvents"+this.cid,this.stopEvent.bind(this)),o()(window).on("touchmove.delegateEvents"+this.cid,this.moveEvent.bind(this)),o()(window).on("touchend.delegateEvents"+this.cid,this.stopEvent.bind(this))},undelegateEvents:function(){u.a.prototype.undelegateEvents.apply(this,arguments),o()(window).off(".delegateEvents"+this.cid)},render:function(){var e=this.options.maximum-this.options.minimum,t=(this.get()-this.options.minimum)/e*100,i={};"vertical"===this.options.orientation?i.height=t+"%":i.width=t+"%",this.$slide.css(i)},startEvent:function(e){e.preventDefault(),this.$el.addClass("fast"),this.started=!0},stopEvent:function(e){this.started&&(e.preventDefault(),this.$el.removeClass("fast"),this.started=!1)},moveEvent:function(e){this.started&&(e.preventDefault(),this.selectEvent(e))},selectEvent:function(e){e.preventDefault();var t,i;if("horizontal"===this.options.orientation){var r=this.$el.offset().left,n=this.$el.width();i=e.pageX,void 0===i&&(i=e.originalEvent.touches[0].pageX),t=(i-r)/n}else if("vertical"===this.options.orientation){var a=this.$el.offset().top,o=this.$el.height();i=e.pageY,i||(i=e.originalEvent.touches[0].pageY),t=(a+o-i)/o}t=Math.min(Math.max(0,t),1),t=this.options.minimum+t*(this.options.maximum-this.options.minimum),this.change(t)},cursorDrag:function(e){this.startEvent(e),e.stopPropagation()},trackDrag:function(e){this.startEvent(e),this.moveEvent(e)}})},function(e,t,i){"use strict";var r=i(0);i.n(r);t.a={addNewImage:function(e){if(!this.model)throw new Error("This collection must implement a model.");var t,n=e.uid;n?t=n.replace(/tmp_/,""):(t=e.id||i.i(r.uniqueId)(),n="tmp_"+t);var a=new this.model({images:[{uid:n,url:e.url,width:e.width,height:e.height}],uid:n,id:t,name:e.name||"newImage",imageFile:e.imageFile});return this.set(a,{merge:!0,add:!0,remove:!1}),a}}},function(e,t,i){"use strict";var r={};r.linearToSrgb1=function(e){var t=0;return e<.0031308?e>0&&(t=12.92*e):t=1.055*Math.pow(e,1/2.4)-.055,t},r.srgbToLinear1=function(e){var t=0;return e<.04045?e>=0&&(t=e*(1/12.92)):t=Math.pow((e+.055)*(1/1.055),2.4),t},r.linearToSrgb=function(e,t){var i=t||new Array(e.length);return i[0]=r.linearToSrgb1(e[0]),i[1]=r.linearToSrgb1(e[1]),i[2]=r.linearToSrgb1(e[2]),i.length>3&&e.length>3&&(i[3]=e[3]),i},r.srgbToLinear=function(e,t){var i=t||new Array(e.length);return i[0]=r.srgbToLinear1(e[0]),i[1]=r.srgbToLinear1(e[1]),i[2]=r.srgbToLinear1(e[2]),i.length>3&&e.length>3&&(i[3]=e[3]),i},r.encodeRGBM=function(e,t,i){i[3]=Math.min(1,Math.max(e[0]/t,i[1]/t,i[2]/t,1e-6)),i[3]=Math.ceil(255*i[3])/255;var r=1/(t*i[3]);return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i},r.decodeRGBM=function(e,t,i){var r=t*e[3];return i[0]=r*i[0],i[1]=r*i[1],i[2]=r*i[2],i},r.rgbToHex=function(e){var t={r:255*e.r,g:255*e.g,b:255*e.b};return"#"+(16777216|t.b|t.g<<8|t.r<<16).toString(16).substr(1)},t.a=r},,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=n.a.osg,o=function(e){this._model=void 0!==e?e.model:void 0,this._viewer=void 0!==e?e.viewer:void 0,this._scene=void 0!==e?e.scene:void 0,this._widgetAPI=void 0!==e?e.widgetAPI:void 0,this._features={}};o.prototype={getModel:function(){return this._model},getFeatures:function(){return this._features},getViewer:function(){return this._viewer},getScene:function(){return this._scene},getWidgetAPI:function(){return this._widgetAPI},addFeature:function(e){if(e){var t=e.getName();this._features[t]?a.error("Feature already added"+t):this._features[t]=e}return this._features},getModelByName:function(e){if(e){var t=i.i(r.find)(this._features,function(t){var i=t.getModel();return!(!i||!i.getName)&&i.getName()===e});return t?t.getModel():void 0}},getViewsByName:function(e){if(e){var t=[];return i.i(r.forEach)(this._features,function(i){if(i){var r=i._views.filter(function(t){return!!t.getName&&t.getName()===e});Array.prototype.push.apply(t,r)}}),t}}},t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(53),a=r.a.osg,o=r.a.osgUtil,s=o.NodeGizmo,u=function(){s.apply(this,arguments),this._forcePicking=!1};a.createPrototypeNode(u,a.objectInherit(s.prototype,{setForcePicking:function(e){this._forcePicking=e},onMouseUp:function(e){this.isEditing()&&n.a.draw();var t=this._attachedNode;s.prototype.onMouseUp.call(this,e),t!==this._attachedNode&&n.a.draw(),this._forcePicking&&!this._attachedNode&&(this._attachedNode=t)},onMouseMove:function(e){var t=this._hoverNode;s.prototype.onMouseMove.call(this,e),(this.isEditing()||t!==this._hoverNode)&&n.a.draw()}}),"osgSketchfab","NodeGizmo"),t.a=u},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(10)),a=i.n(n),o=i(5),s=i(298),u=i(847),l=i.n(u),c=i(848),h=i.n(c),d=i(129),p=i(46),f=i(53),g=i(603),m=i(156),v=o.a.osg,_=v.StateAttribute.OVERRIDE|v.StateAttribute.ON,b=v.createTexturedFullScreenFakeQuadGeometry(),x=function(e,t,n){v.Camera.call(this),this.addChild(b),this.setNodeMask(0),this._outTexture=e,this._packTextures=i.i(r.clone)(t),this._channels=n.slice(),this._lastHash="",this.initPacking()};x.AUTO_RELEASE_GL=!1;var S=function(e){e.generateMipmap=function(){this._rttPass||v.Texture.prototype.generateMipmap.apply(this,arguments),this._rttPass=!1}};v.createPrototypeNode(x,v.objectInherit(v.Camera.prototype,{getNbChannels:function(){return this._channels.length},disablePacking:function(){this.setNodeMask(0);for(var e=this.getStateSet(),t=this.getNbChannels(),i=0;i<t;++i){var r=e.getTextureAttribute(i,"Texture");r&&r!==s.a.dummyTexture&&r.releaseGLObjects()}x.AUTO_RELEASE_GL&&this.frameBufferObject.releaseGLObjects()},initPacking:function(){var e=this.getOrCreateStateSet(),t=this._packTextures,i=0,r=this._channels,n=r.length,a=v.Uniform.createInt4("uReadPacking"),o=a.getInternalArray();for(i=0;i<n;++i){var u=r[i],l=t[u].texture;3===m.a.getDefaultStringFormat(u).length?o[i]=2:o[i]=l.getInternalFormat()===v.Texture.ALPHA?1:0}for(i=0;i<4;++i)e.setTextureAttributeAndModes(i,s.a.dummyTexture,_);this._outTexture.setTextureSize(1,1),this.setRenderOrder(v.Camera.PRE_RENDER,0),this.attachTexture(v.FrameBufferObject.COLOR_ATTACHMENT0,this._outTexture,v.Texture.TEXTURE_2D);var c=new v.Viewport(0,0,1,1);this.setReferenceFrame(v.Transform.ABSOLUTE_RF),this.setViewport(c),e.addUniform(v.Uniform.createInt(0,"uTexture0"),_),e.addUniform(v.Uniform.createInt(1,"uTexture1"),_),e.addUniform(v.Uniform.createInt(2,"uTexture2"),_),e.addUniform(v.Uniform.createInt(3,"uTexture3"),_),e.addUniform(a,_)},updatePacking:function(){var e=this._packTextures,t=this._channels,i=t.length,r=0,n="";for(r=0;r<i;++r){var a=e[t[r]].texture;n+=""+a.getWidth()+a.getHeight()}if(n===this._lastHash)return 0;this._lastHash=n,this.setNodeMask(-1);var o=this.getStateSet(),s=0,u=0,l=0;for(r=0;r<i;++r){var c=e[t[r]].texture;s=Math.max(s,c.getWidth()),u=Math.max(u,c.getHeight()),o.setTextureAttributeAndModes(l++,c,_)}return this._outTexture.setTextureSize(s,u),this._outTexture.dirtyMipmap(),this._outTexture._rttPass=!0,this.setRenderOrder(v.Camera.PRE_RENDER,0),this.resetAttachments(),this.attachTexture(v.FrameBufferObject.COLOR_ATTACHMENT0,this._outTexture,v.Texture.TEXTURE_2D),this.getViewport().setViewport(0,0,s,u),s*u}}),"osgSketchfab","TexturePacker");var y=function(){v.Node.call(this),this.addUpdateCallback(this),this._program=d.a.createShader(h.a,l.a,"material-packer","MaterialPacker"),this._currentPackingCameras=[],this._cacheTextures={},this._frameCount=-1,this._checkResolveLowRes=!0,this._checkResolveHighRes=!1,a.a.all([p.a.getHighResLoaded(),p.a.getLowResBound()]).then(function(){this._checkResolveHighRes=!0,f.a.draw()}.bind(this))};v.createPrototypeNode(y,v.objectInherit(v.Node.prototype,{packTextures:function(e,t){var i=Object.keys(e),r=i.length;if(0===r)return v.Texture.textureNull;if(1===r)return e[i[0]].texture;var n,a="";for(var o in e)n=e[o].texture,a+=n.getInstanceID()+"-";if(this._cacheTextures[a])return this._cacheTextures[a];var u=this._cacheTextures[a]=new s.a;S(u),u.setImageFormat(v.Texture.RGBA),u.setWrapS(n.getWrapS()),u.setWrapT(n.getWrapT()),u.setMinFilter(n.getMinFilter()),u.setMagFilter(n.getMagFilter());var l=new x(u,e,t,i);return l.getOrCreateStateSet().setAttributeAndModes(this._program,_),this.addChild(l),u},update:function(){if(0===++this._frameCount)return!0;var e=0,t=this._currentPackingCameras,i=t.length;if(i){for(e=0;e<i;++e)t[e].disablePacking();t.length=0,f.a.draw()}var r=this.getChildren(),n=r.length,a=0;for(e=0;e<n;++e){var o=r[e].updatePacking();if(0!==o&&(this._currentPackingCameras.push(r[e]),(a+=o)>=1048576))break}if(this._frameCount>1&&0===i&&0===this._currentPackingCameras.length){if(this._checkResolveHighRes)for(this._checkResolveHighRes=!1,p.a.resolveHighResBound(),g.a.logMessage("Texture packing FBO Count : "+n),x.AUTO_RELEASE_GL=!0,e=0;e<n;++e)r[e].frameBufferObject.releaseGLObjects();this._checkResolveLowRes&&(this._checkResolveLowRes=!1,p.a.resolveLowResBound())}return!0}})),y.viewerInstance=new y,t.a=y},function(e,t,i){"use strict";var r=i(603),n=i(10),a=i.n(n),o=i(0),s=(i.n(o),i(419)),u=i.n(s),l=i(5),c=i(29),h=i(4),d=i(90),p=i(317),f=i(743),g=i(511),m=i(1107),v=i(92),_=i(723),b=i(992),x=i(977),S=i(464),y=i(31),C=i(53),T=i(1086),M=i(1092),w=i(1091),A=i(299),E=i(600),P=i(46),N=i(139),F=l.a.osg,R=l.a.osgViewer,I=new u.a({device:"VWR"}),O=function(e){var t=i.i(d.a)()||i.i(A.a)()?0:1;return void 0!==i.i(y.a)().modelOptimization&&(t=i.i(y.a)().modelOptimization?1:0),i.i(o.find)(e,{flag:t})||e[0]||e},L=function(e){if(e.byteLength)return Array.prototype.slice.call(e)},D=function(e){return i.i(o.cloneDeepWith)(e,L)},k=function(e){this._dataScene=e,this._modelFile=O(this._dataScene.files),this._root=new F.Node,this._root.setName("Scene - Root"),this._polygonNode=new F.Node,this._polygonNode.setName("Scene - PolygonNode"),this._wireframeNodes=[],this._resourcePromises=[];var t=function(e,t){return e.concat(t)},r=function(e){var t=e.lastIndexOf("/");return e.substr(0,t+1)}(this.getPolygonURL());this._dataScene.options&&this._dataScene.options.materials&&i.i(o.each)(this._dataScene.options.materials,function(e){i.i(o.each)(e.channels,function(e){e.texture&&(e.texture.image&&(e.texture.image=t(r,e.texture.image)),e.texture.url&&(e.texture.url=t(r,e.texture.url)))})})};k.prototype={addResourcePromise:function(e){this._resourcePromises.push(e)},getJSON:function(){return this._dataScene},getPolygonURL:function(){return this._modelFile.osgjsUrl},getWireframeURL:function(){return this._modelFile.wireframeUrl},getPolygonSize:function(){return this._modelFile.modelSize},getWireframeSize:function(){return this._modelFile.wireframeSize},getResourceManager:function(){return this._resourceManager||v.default.instance},getRoot:function(){return this._root},getPolygonNode:function(){return this._polygonNode},getWireframeNodes:function(){return this._wireframeNodes},loadPolygon:function(e,t,i,r){var n={progress:e,size:this.getPolygonSize(),secondary:!1,idChannel:1,node:this.getPolygonNode()};t&&(n.wireframeOptions={progress:!0===r?e:void 0,size:this.getWireframeSize(),secondary:!1,idChannel:2,startPromise:i,deferDownload:a.a.defer(),nodes:this.getWireframeNodes()});var o=this.getResourceManager().getOrCreateModel(this.getPolygonURL(),n);if(t){var s=F.Timer.instance().tick();n.wireframeOptions.deferDownload.promise.then(function(){P.a.resolveWireframe({time:F.Timer.instance().tick()-s})}.bind(this))}return this.getRoot().addChild(this.getPolygonNode()),this.getResourceManager().run(),o.promise},loadWireframe:function(e){var t={progress:e,size:this.getWireframeSize(),secondary:!1,idChannel:2,node:new F.Node},i=this.getResourceManager().getOrCreateModel(this.getWireframeURL(),t);return this.getWireframeNodes().push(t.node),this.getRoot().addChild(t.node),i.promise}};var B=h.a.extend({initialize:function(){if(h.a.prototype.initialize.apply(this,arguments),this._root=null,this._features=this.options.features,this._widgetAPI=this.options.widgetAPI,this._viewerAPI=this.options.viewerAPI,this._widgetAPI&&this._widgetAPI.getTabbedWidget().model.on("change",C.a.draw),!this.options.model)throw new Error("no model provided to ViewerWebGL");this._featuresInstancied={};var e=this.$(".canvas"),t=e[0];t.oncontextmenu=function(){return!1},F.time("processModelJSON"),i.i(b.a)(this.options.model),i.i(y.a)().processOptions&&this.options.model.set("options",{orientation:{},sound:{},wireframe:{},scene:{},materials:{},environment:{},hotspot:{},camera:{},lighting:{},background:{},shading:{}}),F.timeEnd("processModelJSON"),F.Geometry.enableVAO=i.i(y.a)().useVao;var r=this._viewer=new R.Viewer(t,{rstats:this.getOptionRStats(),powerPreference:i.i(y.a)().powerPreference,antialias:!1,depth:!1,stencil:!1,alpha:this._requireAlphaContext(),premultipliedAlpha:!0,fullscreen:!1,preserveDrawingBuffer:i.i(y.a)().preserveDrawingBuffer,enableFrustumCulling:!1,maxDevicePixelRatio:1.5,scrollwheel:i.i(y.a)().scrollwheel,EventBackend:{StandardMouseKeyboard:{keyboardEventNode:e[0]},GamePad:{enable:!1}}}),n=F.TimerGPU.instance();n.enable(),E.a.setTimerGPU(n),r.setContextLostCallback(function(){this._contextLost=!0,F.warn("Context Lost"),new(0,i(23).default)({title:"3D/WebGL context error",text:"Your browser seems to have hit its 3D capability limit. The page needs to be reloaded to fix this. <br/>If the problems persists, you can try to close other tabs with 3D/WebGL or restart your browser entirely.",safe:!0,buttons:{continue:!0,continueLabel:"Reload Current Page",cancel:!1}}).open().then(function(){window.location.reload()})}.bind(this));var a=r.getState().getShaderGeneratorProxy();a.addShaderGenerator("earlyZ",new T.a),a.addShaderGenerator("ShadowCastSkfb",new M.a),a.addShaderGenerator("shading-vr",new w.a);for(var o=i.i(S.a)(),s=r.getState(),u=0;u<o;u++)s.setGlobalDefaultTextureAttribute(u,F.Texture.textureNull);r.requestContinuousUpdate(i.i(y.a)().continuousRender),e[0].setAttribute("tabindex","0"),r.init(),this.getCamera().getRenderer().setCullVisitor(new g.a),r.setupManipulator(),this._root=new F.MatrixTransform,r.getCamera().setClearColor(F.vec4.create()),r.setSceneData(this._root),C.a.setViewer(r),this._superSample=new m.a(this),this._superSample.setCanBeEnabled(i.i(y.a)().supersample),C.a.setSuperSample(this._superSample),this._superSample.setRoot(this._root),r.getManipulator().computeHomePosition(),r._requestAnimationFrame=p.a.get(),r.run(),this._currentScene=void 0},getModelUID:function(){return this.model.get("uid")},_requireAlphaContext:function(){if(i.i(d.a)()||i.i(y.a)().transparent)return!0;var e=this.options.model.get("options");return"none"===(e&&e.background&&e.background.enable)},getOptionRStats:function(){var e=["EarlyOpaque","EarlyTransparency","ShadingOpaque","ShadingTransparency","Extra"],t=["ShadowMap0","ShadowMap1","ShadowMap2"],i=["MergeOpacity","DepthMipmap1","DepthMipmap2","DepthMipmap3","DepthMipmap4","DepthMipmap5","SsaoExtract","SsaoBlurH","SsaoBlurV","DofDownsampleCoC","DofDownsampleColor","DofNearDilateH","DofNearDilateV","DofBlurCircular","DofCombine","BloomExtractBright","VBlur4","HBlur4","VBlur6","HBlur6","VBlur8","HBlur8","VBlur10","HBlur10","VBlur12","HBlur12","BloomMergeAdditive","PostProcessMergeable","Antialias","DistortionVR","FinalPassVR","FinalPass"],r=["Total GL","Shading","PostProcess","ShadowMap"],n={},a=function(e){for(var t=[],i=0,r=e.length;i<r;++i)t[i]=e[i].toLowerCase(),n[t[i]]={caption:e[i],average:!0};return t},o=[{caption:"GL Total (ms)",values:a(r)},{caption:"GL Shading (ms)",values:a(e)},{caption:"GL PostProcess (ms)",values:a(i)},{caption:"GL ShadowMap (ms)",values:a(t)}];return{values:n,groups:o}},getRootUserData:function(){return this._currentScene?this.getRootModel().userDataMap||{}:{}},getRootModel:function(){return this._currentScene.getRoot()},getWidth:function(){return this.getCanvas().width},getHeight:function(){return this.getCanvas().height},getOptions:function(){return this.options},isViewerReady:function(){return P.a.getModelDisplayed()},getViewerAPI:function(){return this._viewerAPI},createContext:function(e){return new _.a({model:e.model,viewer:this,scene:e.scene,widgetAPI:this._widgetAPI})},updateProgress:function(e,t,i){var r=t?this._channelsSecondary:this._channelsPrimary,n=t?this._channelsSecondaryWeights:this._channelsPrimaryWeights;r[i]=e;for(var a=0,o=0;o<r.length;++o)a+=r[o]*n[o];this.trigger(t?"secondary-progress":"primary-progress",{progress:a})},initProgress:function(e){var t=i.i(y.a)().preload;this._channelsPrimary=[0,0],e&&this._channelsPrimary.push(0),this._channelsPrimaryWeights=[],this._channelsPrimaryWeights[0]=t?.5:.1,this._channelsPrimaryWeights[1]=t?.5:.9,e&&(this._channelsPrimaryWeights[2]=this._channelsPrimaryWeights[1]=.5*this._channelsPrimaryWeights[1]),this._channelsSecondary=[0],this._channelsSecondaryWeights=[1]},setFakeSecondaryProgress:function(e,t){this.setFakeProgress(e,!0,t)},setFakePrimaryProgress:function(e,t){this.setFakeProgress(e,!1,t)},setFakeProgress:function(e,t,i){void 0===this._idLastProgress&&(this._idLastProgress=0),i=i||0,e=void 0!==e.length?e:[e];var r=e.length;if(0===r)return void this.updateProgress(1,t,i);for(var n=0,a=++this._idLastProgress,o=function(){a===this._idLastProgress&&this.updateProgress(++n/r,t,i)}.bind(this),s=0;s<r;++s)e[s].finally(o);var u=0,l=0,c=function(){if(a===this._idLastProgress){if(u!==n){if(n===r)return;u=n,l=n/r}var e=(n+1)/r;l<e&&(l=Math.min(e-.01,l+.01/r),this.updateProgress(l,t,i)),window.setTimeout(c,100)}}.bind(this);window.setTimeout(c,100)},preloadWire:function(e,t){var i=e.loadWireframe(t),r=F.Timer.instance().tick();return i.then(function(){P.a.resolveWireframe({time:F.Timer.instance().tick()-r})}.bind(this)),i},run:function(){var e=this.options.model,t=this,r=this.getOrCreateScene(e.toJSON());r.getResourceManager().setModelUID(e.get("uid")),r.getResourceManager().setUserUID(e.get("user").uid),P.a.resolveHasAnimation(r.getJSON().animationCount>0||i.i(d.a)()&&e.get("options").animation&&e.get("options").animation.order&&e.get("options").animation.order.length>0);var n=this.createContext({model:e,scene:r}),o=r._resourcePromises,s=i.i(y.a)().preload,u=O(e.get("files")),l=!0===e.get("options").wireframe.enable&&!0===s&&void 0!==u.wireframeSize&&u.wireframeSize>0,c=!u.wireframeUrl||!u.wireframeSize,h=l?a.a.resolve():P.a.getHighResLoaded(),p=r.loadPolygon(this.updateProgress.bind(this),c,h,l);o.push(p);var f=F.Timer.instance().tick();return p.then(function(){P.a.resolvePolygon({time:F.Timer.instance().tick()-f})}),!c&&l&&o.push(this.preloadWire(r,this.updateProgress.bind(this))),F.time("createAndInitFeatures"),t._features.forEach(function(e){t.addFeature(e,n)}),F.timeEnd("createAndInitFeatures"),this.initProgress(l),a.a.all(o).then(this._launchViewer.bind(this,n,c,l,f)),this._featuresInstancied=n.getFeatures(),P.a.getModelDisplayed()},_launchViewer:function(e,t,n,a){F.time("featureFinished"),this.featureFinished(e,this._root),F.timeEnd("featureFinished"),t||n||P.a.getHighResLoaded().then(this.preloadWire.bind(this,this._currentScene,void 0)),this.trigger("primary-progress",{progress:1}),r.a.logBound(N.a.getModelBoxWithoutDisplacement()),r.a.showMessage(),(i.i(y.a)().preload?P.a.getHighResBound():P.a.getLowResBound()).then(this._onViewerLaunched.bind(this,a))},_onViewerLaunched:function(e){if(this._featuresManager.setInitialAnimation(),this.drawFrame(),P.a.resolveModelDisplayed({time:F.Timer.instance().tick()-e}),this.trigger("success"),this.trigger("viewerready"),i.i(y.a)().messaging){I.createMessage({data:"ready"}).appendToHash()}},onFail:function(e,t){F.error(t.stack),e.reject(t),this.trigger("failure")},addFeature:function(e,t){if(!e)return console.warn("Feature undefined!"),!0;var r=new e;if(r.init(t),i.i(d.a)()){var n=r.getModel(),a=r.getName();n.editorSetJSON&&!window.editorModels[a]&&(window.editorModels[a]={setJSON:this._makeCallbackSetJSON(n),getJSON:this._makeCallbackGetJSON(n)})}},_makeCallbackSetJSON:function(e){return function(t){var i=e.editorSetJSON(D(t));return i.then?i:i?a.a.reject(i):a.a.resolve()}},_makeCallbackGetJSON:function(e){return function(){var t=e.editorGetJSON();return a.a.resolve(D(t))}},drawFrame:function(){this._viewer.frame()},getCanvas:function(){return this._viewer.getGraphicContext().canvas},setTimeline:function(e){this._timeline=e},getTimeline:function(){return this._timeline},getScreenShot:function(e,t){return i.i(f.a)(e,t,this)},getCamera:function(){return this._viewer.getCamera()},getFeatures:function(){return this._featuresInstancied},getSuperSample:function(){return this._superSample},getFeaturesManager:function(){return this._featuresManager},getViewerOSGJS:function(){return this._viewer},getOrCreateScene:function(e){if(this._currentScene)return this._currentScene;var t=new k(e);return t.getResourceManager().setStateContextOSG(this._viewer.getState()),this._currentScene=t,t},featureFinished:function(e,t){return this._featuresManager=new x.a(this,e),this._featuresManager.finished(t)},getOptionsJSON:function(){var e=this.getFeatures(),t={};t.version=c.a.optionsVersion,t.background=e.background.getModel().getJSON(),t.environment=e.environment.getModel().getJSON(),t.lighting=e.lighting.getModel().getJSON(),t.scene=e.camera.getModel().getJSONFov(),t.materials=e.material.getModel().getJSON(),t.orientation=e.orientation.getModel().getJSON(),t.camera=e.camera.getModel().getJSON(),t.animation=e.animation.getModel().getJSON(),t.hotspot=e.hotspot.getModel().getJSON(),t.vr=e.webVR.getModel().getJSON(),t.scene=t.scene||{},t.scene.postProcess=e.postProcess.getModel().getJSON(),t.sound=e.sound.getModel().getJSON();var i=e.shadingStyle.getModel().getJSON();return t.shading=i.shading,t.wireframe=i.wireframe,b.a.readOptions(t)}});t.a=B},function(e,t,i){"use strict";var r=i(5),n=i(46),a=i(739),o=i(69),s=i(31),u=i(389),l=i(86),c=r.a.osg,h=r.a.osgUtil,d=r.a.osgAnimation,p=o.a.SHADOW_CAST|o.a.PICK_GEOMETRY_ANIMATED,f=h.IntersectionVisitor.prototype.enter;h.IntersectionVisitor.prototype.enter=function(e){return!!e._forceEnterIntersection||f.call(this,e)};var g=function(){};c.createPrototypeObject(g,{cull:function(){return!1}},"osgSketchfab","HideCullCallback");var m=new g,v=function(){var e=c.vec3.create(),t=c.vec3.create();return function(r){r.center(e),c.vec3.sub(t,r.getMax(),r.getMin());var n=c.createTexturedBoxGeometry(e[0],e[1],e[2],t[0],t[1],t[2]);return n.setName("BoneBox"),3!==i.i(s.a)().showBones&&n.setCullCallback(m),n._isBoneBox=!0,n.setNodeMask(o.a.PICK_GEOMETRY_RIG_BOX|o.a.SHADOW_BOUNDS),n}}(),_=function(e){for(var t=h.GizmoGeometry.createCylinderGeometry(.1*e,.02*e,e),i=t.getAttributes().Vertex.getElements(),r=0,n=i.length/3;r<n;++r)i[3*r+2]+=.5*e;return t._isSkeleton=!0,t},b=function(e){c.NodeVisitor.call(this),this._visitedNodes={},this._drawNames=e;var t=c.StateAttribute.OVERRIDE|c.StateAttribute.ON,i=this._geoStateSet=new c.StateSet;i.setShaderGeneratorName("skeleton",t),i.setAttributeAndModes(new c.Depth(c.Depth.ALWAYS),t),i.setRenderBinDetails(l.a.DEBUG_2,"RenderBin"),u.a.set("hasExtra",!0)};c.createPrototypeObject(b,c.objectInherit(c.NodeVisitor.prototype,{drawBone:function(){var e=c.vec3.create(),t=c.vec3.fromValues(0,0,1),i=c.quat.create();return function(r){var n=r.getChildren();if(n.length)for(var a=0;a<n.length;++a){var o=n[a];if(o instanceof d.Bone!=!1){c.vec3.transformMat4(e,c.vec3.set(e,0,0,0),o.getMatrix());var s=_(c.vec3.len(e));s.setStateSet(this._geoStateSet),s._boundingBoxComputed=!0,s._boundingSphereComputed=!0;var u=new c.MatrixTransform;c.quat.rotationTo(i,t,c.vec3.normalize(e,e)),c.mat4.fromRotationTranslation(u.getMatrix(),i,c.vec3.ZERO);var l=c.Uniform.createFloat4("uColor"),h=l.getInternalArray(),p=r.getOrCreateDebugColor();c.vec3.copy(h,p),h[0]=.9*p[0],h[1]=.9*p[1],h[2]=.9*p[2],h[3]=1,u.getOrCreateStateSet().addUniform(l);var f="Debug "+r.getName();u.setName(f),s.setName(f),u.addChild(s),r.addChild(u)}}}}(),apply:function(e){var t=e.getInstanceID();this._visitedNodes[t]||(this._visitedNodes[t]=!0,e instanceof d.Bone&&this._drawNames[e.getName()]&&this.drawBone(e),this.traverse(e))}}),"osgSketchfab","DrawBoneVisitor");var x=function(e,t){c.NodeVisitor.call(this),this._wirePromise=n.a.getWireframe(),this._wireNodes=t.getOrCreateScene().getWireframeNodes(),this.nodeMaskOverride=-1,this._visitedNodes={},this._drawBoneNames={},this._rigIndexed=[],this._boneGeomIndexed=[],this._skls=e;var i=c.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_UNIFORM_VECTORS");this._maxBones=Math.floor((i-21)/3),d.SkinningAttribute.maxBoneUniformAllowed=3*this._maxBones,this._maxVA=c.WebGLCaps.instance().getWebGLParameter("MAX_VERTEX_ATTRIBS")};c.createPrototypeObject(x,c.objectInherit(c.NodeVisitor.prototype,{createSplitRigGeometry:function(e){var t=new d.RigGeometry;t.setName("Split ("+e.getInstanceID()+")"),t.setStateSet(e.getStateSet()),t.setUserData(e.getUserData()),t.userDataMap=e.userDataMap,t.setSourceGeometry(e.getSourceGeometry()),t._forceEnterIntersection=!0;var i=e.getVertexAttributeList(),r=t.getVertexAttributeList();for(var n in i)r[n]=i[n];var a=i.Bones.getElements(),o=new a.constructor(a.length);r.Bones=new c.BufferArray(c.BufferArray.ARRAY_BUFFER,o,i.Bones.getItemSize(),!0),t.userDataMap.wireframe?this._wireNodes.push(t):t.setNodeMask(p);var s=t.userDataMap.rigIndex;return void 0!==s&&(this._rigIndexed[s]=t),t._boundingSphereComputed=!0,t._boundingBoxComputed=!0,t},checkVertex:function(e,t){var i=t.baseBones,r=t.baseWeights,n=t.mappedUsedBones,a=0;return r[e]&&!n[i[e]]&&a++,r[e+1]&&!n[i[e+1]]&&a++,r[e+2]&&!n[i[e+2]]&&a++,r[e+3]&&!n[i[e+3]]&&a++,a},tagBoneVertex:function(e,t){var i=t.baseBones,r=t.baseWeights,n=t.mappedUsedBones,a=t.boneNameID,o=t.boneToName,s=i[e];r[e]&&!n[s]&&(a[o[s]]=t.nbUsedBones,n[s]=++t.nbUsedBones),t.newBones[e]=n[s]-1,s=i[e+1],r[e+1]&&!n[s]&&(a[o[s]]=t.nbUsedBones,n[s]=++t.nbUsedBones),t.newBones[e+1]=n[s]-1,s=i[e+2],r[e+2]&&!n[s]&&(a[o[s]]=t.nbUsedBones,n[s]=++t.nbUsedBones),t.newBones[e+2]=n[s]-1,s=i[e+3],r[e+3]&&!n[s]&&(a[o[s]]=t.nbUsedBones,n[s]=++t.nbUsedBones),t.newBones[e+3]=n[s]-1},splitTriangle:function(e,t,i,r){if(r.currentIdPrimitive++,e===t||e===i||t===i||r.processedPrimitive[r.currentIdPrimitive-1])return!0;var n=r.nbUsedBones,a=this.checkVertex(4*e,r);if(n+a<this._maxBones&&(a+=this.checkVertex(4*t,r)),n+a<this._maxBones&&(a+=this.checkVertex(4*i,r)),n+a>=this._maxBones)return void(r.finished=!1);this.tagBoneVertex(4*e,r),this.tagBoneVertex(4*t,r),this.tagBoneVertex(4*i,r);var o=r.first+r.countIdPrimitive;r.countIdPrimitive+=3,r.newIndexesElements[o]=e,r.newIndexesElements[o+1]=t,r.newIndexesElements[o+2]=i,r.processedPrimitive[r.currentIdPrimitive-1]=1},splitLine:function(e,t,i){if(i.currentIdPrimitive++,e===t||i.processedPrimitive[i.currentIdPrimitive-1])return!0;var r=i.nbUsedBones,n=this.checkVertex(4*e,i);if(r+n<this._maxBones&&(n+=this.checkVertex(4*t,i)),r+n>=this._maxBones)return void(i.finished=!1);this.tagBoneVertex(4*e,i),this.tagBoneVertex(4*t,i);var a=i.first+i.countIdPrimitive;i.countIdPrimitive+=2,i.newIndexesElements[a]=e,i.newIndexesElements[a+1]=t,i.processedPrimitive[i.currentIdPrimitive-1]=1},callbackDrawElementsTriangles:function(e,t,i){for(var r=0;r<e;r+=3)this.splitTriangle(t[r],t[r+1],t[r+2],i)},callbackDrawElementsTriangleStrip:function(e,t,i){for(var r=2,n=0;r<e;++r,++n)r%2?this.splitTriangle(t[n],t[n+2],t[n+1],i):this.splitTriangle(t[n],t[n+1],t[n+2],i)},callbackDrawElementsLines:function(e,t,i){for(var r=0;r<e;r+=2)this.splitLine(t[r],t[r+1],i)},splitPrimitive:function(e,t){e.finished=!0;var i=e.baseRig,r=e.primitive,n=this.createSplitRigGeometry(i);e.boneNameID=n._boneNameID,e.newBones=n.getVertexAttributeList().Bones.getElements(),e.mappedUsedBones=new Uint32Array(t),e.nbUsedBones=0,e.currentIdPrimitive=0,e.countIdPrimitive=0;var a=r.getIndices().getElements(),o=r.getCount(),s=r.getMode();if(s===c.primitiveSet.TRIANGLE_STRIP?this.callbackDrawElementsTriangleStrip(o,a,e):s===c.primitiveSet.TRIANGLES?this.callbackDrawElementsTriangles(o,a,e):this.callbackDrawElementsLines(o,a,e),0===e.countIdPrimitive)return!1;var u=new c.DrawElements(s===c.primitiveSet.LINES?c.primitiveSet.LINES:c.primitiveSet.TRIANGLES,e.newIndexesBuffer);u.setFirst(e.first*e.newIndexesElements.BYTES_PER_ELEMENT),u.setCount(e.countIdPrimitive),e.first+=e.countIdPrimitive,n.getPrimitives().push(u);for(var l=i.getParents(),h=l.length,d=0;d<h;++d)l[d].addChild(n);return!e.finished},getBoneToNames:function(e,t){for(var i=t.length,r=new Array(i),n=0;n<i;++n){var a=t[n];r[e[a]]=a}return r},splitRigGeometry:function(e){for(var t=e._boneNameID,i=Object.keys(t),r=i.length,n=e.getPrimitives(),a=n.length,o={baseRig:e,baseWeights:e.getVertexAttributeList().Weights.getElements(),baseBones:e.getVertexAttributeList().Bones.getElements(),boneToName:this.getBoneToNames(e._boneNameID,i)},s=0;s<a;++s){var u=n[s],l=u.getMode();if(0!==u.getCount())if(u instanceof c.DrawElements!=!1)if(l===c.primitiveSet.TRIANGLE_STRIP||l===c.primitiveSet.TRIANGLES||l===c.primitiveSet.LINES){var h=u.getIndices(),d=h.getElements(),p=l===c.primitiveSet.TRIANGLE_STRIP?3:1;for(o.newIndexesElements=new d.constructor(u.getCount()*p),o.newIndexesBuffer=new c.BufferArray(c.BufferArray.ELEMENT_ARRAY_BUFFER,o.newIndexesElements,h.getItemSize(),!0),o.first=u.getFirst(),o.processedPrimitive=new Uint8Array(u.getCount()),o.primitive=u;this.splitPrimitive(o,r););o.newIndexesBuffer.setElements(o.newIndexesElements.subarray(0,o.first))}else c.error("Split rigged primitives mode not yet handled : ",l);else c.error("Split rigged primitives type not yet handled",u)}},handleRigGeometry:function(e){var t=e._boneNameID,r=i.i(s.a)().showBones,n=e.userDataMap.wireframe,a=e.userDataMap.rigIndex;if(void 0!==a&&(this._rigIndexed[a]=e),1===r||2===r)if(n)e.setCullCallback(m);else{2!==r&&e.setNodeMask(0);var o=this._drawBoneNames;for(var u in t)o[u]=!0}else this._maxBones<Object.keys(t).length&&(n?(e._boundingBoxComputed=!0,e._boundingSphereComputed=!0,e.setNodeMask(0),this._wirePromise.then(this.splitRigGeometry.bind(this,e))):this.splitRigGeometry(e),e.setCullCallback(m));this.tagForceIntersection()},tagForceIntersection:function(){for(var e=this._skls[this._skls.length-1],t=1+this.nodePath.indexOf(e);t<this.nodePath.length;++t)this.nodePath[t]._forceEnterIntersection=!0},popTargetAttribute:function(e,t,i){for(var r=t.getMorphTargets(),n=r.length,a=e.getVertexAttributeList(),o=t.getVertexAttributeList(),s=0;s<n;++s){delete r[s].getVertexAttributeList()[i];var u=i+"_"+s;delete a[u],a!==o&&delete o[u]}},computeUsedVA:function(e,t,i,r){var n=Object.keys(e).length-Object.keys(t).length*(i.length-Math.min(r,i.length));return e.Color||n++,n},handleMorphGeometry:function(e,t){var i=t.getMaximumPossibleMorphGPU(),r=t.getMorphTargets(),n=r[0].getVertexAttributeList(),a=e.getVertexAttributeList(),o=this.computeUsedVA(a,n,r,i),s=this._maxVA;if(!(o<=s||a.Tangent_1&&(this.popTargetAttribute(e,t,"Tangent"),(o=this.computeUsedVA(a,n,r,i))<=s)||a.Normal_1&&(this.popTargetAttribute(e,t,"Normal"),(o=this.computeUsedVA(a,n,r,i))<=s))){for(;i>0;)if(i--,t.setMaximumPossibleMorphGPU(i),(o=this.computeUsedVA(a,n,r,i))<=s)return;console.warn("Too much vertex attributes!")}},apply:function(e){var t=e.getInstanceID();if(!this._visitedNodes[t]){this._visitedNodes[t]=!0;var i=e instanceof d.RigGeometry,r=i?e.getSourceGeometry():e;if(r instanceof d.MorphGeometry&&(r.setNodeMask(p),this.handleMorphGeometry(e,r)),i)e.setNodeMask(p),this.handleRigGeometry(e);else if(e instanceof d.Bone){var n=e.getBoneBoundingBox();if(n.valid()){var a=v(n);e.addChild(a);var o=e.userDataMap.rigIndex;void 0!==o&&this._boneGeomIndexed.push(a)}}else e instanceof d.Skeleton&&this._skls.push(e);this.traverse(e)}}}),"osgSketchfab","InitVisitor");var S={};S.DrawBones=b,S.hideCullCallback=m,S.init=function(e,t,i){var r=new x(e,t),n=t.getOrCreateScene().getRoot();c.time("InitGraphAnimation"),n.accept(r),c.timeEnd("InitGraphAnimation");for(var o=r._boneGeomIndexed,s=r._rigIndexed,u=o.length,l=0;l<u;++l){var h=o[l];h._mostInfluencedRig=s[h.getParents()[0].userDataMap.rigIndex]}Object.keys(r._drawBoneNames).length>0&&(t.getViewerOSGJS().getState().getShaderGeneratorProxy().addShaderGenerator("skeleton",new a.a),n.accept(new b(r._drawBoneNames)),i.set("notSupported",!0))},t.a=S},function(e,t,i){"use strict";var r,n=i(5),a=n.a.osg,o=function(){return r||(r={environmentTransform:a.Uniform.createMatrix4(a.mat4.create(),"uEnvironmentTransform"),exposure:a.Uniform.createFloat1(1,"uEnvironmentExposure"),diffuseSPH:a.Uniform.createFloat3Array(new Float32Array(27),"uDiffuseSPH"),textureSpecular:a.Uniform.createInt1("sEnvironmentSpecular"),textureSpecularPBR:a.Uniform.createInt1("sSpecularPBR"),textureIntegrateBRDF:a.Uniform.createInt1("sIntegrateBRDF"),factorShadowEnv0:a.Uniform.createFloat(0,"uFactorShadowEnv0")})};t.a=o},function(e,t,i){"use strict";var r=function(e){var t=e||{};return window.location&&window.location.hash?(window.location.hash.substr(1).split(",").forEach(function(e){var i=e.split("="),r=i[0],n=i[1];if("debug3d"===r&&(t.debug3d=!0),"stats"===r&&(t.stats=!0),r.match("material_"))switch(r=r.substr(9)){case"showcase":t.materialShowcase=void 0===n?t.materialShowcase:"0"!==n;break;case"names":t.materialNames=n;break;case"normal":t.materialNormal=n;break;case"emissive":t.materialEmissive=n;break;case"transparency":t.materialTransparency=n;break;case"diffuse":t.materialDiffuse=n;break;case"metalness":t.materialMetalness=n;break;case"roughness":t.materialRoughness=n;break;case"glossiness":t.materialGlossiness=n;break;case"specular":t.materialSpecular=n;break;case"cavity":t.materialCavity=n;break;case"f0":t.materialF0=n;break;case"ao":t.materialAO=n;break;case"displacement":t.materialDisplacement=n;break;case"displacement_factor":t.materialDisplacementFactor=void 0===n?t.materialDisplacementFactor:Number(n)}}),t):t};t.a=r},function(e,t,i){"use strict";var r=i(5),n=i(69),a=i(86),o=i(1124),s=i(2),u=i.n(s),l=i(629),c=(i.n(l),r.a.osg),h=r.a.osgUtil,d=c.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),p=h.GizmoGeometry.createCylinderGeometry(.0025,.0025,1,8,1,!1,!1),f=new c.MatrixTransform;f.getMatrix()[14]=.5,f.addChild(p),p._boundingBoxComputed=!0,p._boundingSphereComputed=!0;var g=function(e,t){c.Node.call(this),this._idHotspot=e,this._viewer=t,this._hotspotMT=new c.MatrixTransform,this._cardPanel=new o.a,this._lineToCardMT=new c.MatrixTransform,this._hotspotMT.addChild(d),this.addChild(this._hotspotMT),this.addChild(this._lineToCardMT),this.addChild(this._cardPanel),this._cardPanel.setVisible(!1),this._lineToCardMT.setNodeMask(0),this._worldTeleportPos=void 0,this._cardInitialized=!1,this._texCard=new c.Texture,this._texCard.setTextureSize(1,1),this._canTeleport=!1,this._uAlpha=void 0,this._color=void 0,this._lineToCardMT.addChild(f),this._hotspotMT._boundingBoxComputed=!0,this._hotspotMT._boundingSphereComputed=!0,this.init()};g.COLOR_NORMAL=c.vec3.fromValues(1,1,1),g.COLOR_HOVERED=c.vec3.fromValues(0,.8,1),g.COLOR_DRAG_OK=c.vec3.fromValues(0,.4,1),g.COLOR_DRAG_FAIL=c.vec3.fromValues(.8,.2,.2),g.initLineShader=function(e){var t=p.getOrCreateStateSet();t.setAttributeAndModes(e),t.addUniform(c.Uniform.createFloat4(c.vec4.fromValues(.03,.59,.78,.4),"uLineColor")),t.setRenderBinDetails(a.a.TOOLTIP,"RenderBin")},c.createPrototypeNode(g,c.objectInherit(c.Node.prototype,{init:function(){var e=this.getOrCreateStateSet();e.addUniform(c.Uniform.createFloat(this._idHotspot,"uHotspotIndex"));var t=c.Uniform.createFloat3(c.vec3.fromValues(1,1,1),"uColor");this._color=t.getInternalArray(),e.addUniform(t)},getIndex:function(){return this._idHotspot},getHotspotMatrix:function(){return this._hotspotMT.getMatrix()},getColor:function(){return this._color},isFullyVisibleCard:function(){return this._cardPanel.isVisible()},isVisibleCard:function(){return this._cardPanel.isHinted()||this._cardPanel.isVisible()},canTeleport:function(){return this._canTeleport&&!this.isFullyVisibleCard()},setWorldTeleportPosition:function(){var e=c.vec3.create(),t=c.vec3.create(),i=c.vec3.create(),r=c.mat4.create();return function(n,a,o){if(!this.isFullyVisibleCard()){var s=this._cardPanel.getMatrix();this.getWorldMatrix(void 0,r),this._worldTeleportPos=c.vec3.copy(this._worldTeleportPos||c.vec3.create(),a),c.vec3.copy(i,a),i[2]+=1.5*o,c.vec3.sub(t,n,i),t[2]=0,c.vec3.normalize(t,t),c.vec3.scale(t,t,1*o),c.vec3.add(t,i,t),this.lookToWorld(s,t,i,o,r),c.vec3.sub(e,a,n);var u=c.vec3.length(e);c.vec3.sub(e,a,t);var l=c.vec3.length(e),h=u<l?-1:1;t[2]+=.5*h*.5625*o;var d=this._lineToCardMT.getMatrix();this.lookToWorld(d,n,t,1,r),c.mat4.scale(d,d,c.vec3.set(e,o,o,c.vec3.dist(t,n))),this._cardPanel.dirtyBound()}}}(),setCardVisibilityListener:function(e){this._cardVisibilityListener=e},setVisibleCard:function(e){this._isCardInitialized||this.initCard(),this._cardPanel.setVisible(e),this._lineToCardMT.setNodeMask(e?n.a.NO_PICK:0),this._cardVisibilityListener&&this._cardVisibilityListener(this,e)},setHovered:function(e){this._isCardInitialized||this.initCard(),c.vec3.copy(this.getColor(),e?g.COLOR_HOVERED:g.COLOR_NORMAL),this.isFullyVisibleCard()||(this._cardPanel.setHinted(e),this._lineToCardMT.setNodeMask(e?n.a.NO_PICK:0))},initCard:function(){var e=u()(".hotspots"),t=u()(e.get(0).childNodes[this._idHotspot]),i=this._viewer.getFeatures().hotspot._views[0]._hotspots;this._setDescriptionStyle(t,{width:"1024px",lineHeight:"2",fontSize:"38px"});var r=t.find(".description").outerHeight()+4*t.find(".title").outerHeight(),n=Math.max(1,Math.round(r/576)+(r%576>0?1:0));this._setDescriptionStyle(t,null),this._cardPanel.initialize("skfb_front/macros/hotspot",{hotspotIndex:this._idHotspot,displayNavigation:i.length&&i.length>1,column:n,widthContent:1024*n,title:t.find(".title")[0].innerText,description:t.find(".description").html()}),this._isCardInitialized=!0},_setDescriptionStyle:function(e,t){e.find(".description").css({width:null!==t?t.width:"",lineHeight:null!==t?t.lineHeight:"",fontSize:null!==t?t.fontSize:""})},updateCardHit:function(e){this._hoveredCard=this._cardPanel.updateHit(e)},onCardHit:function(e){this._isCallbackSetup||(this._setupCallback(e),this._isCallbackSetup=!0),this._hoveredCard?this._cardPanel.click():this._cardPanel.setVisible(!1)},_setupCallback:function(e){this._cardPanel.setClickAction("closeButton",function(){this.setVisibleCard(!1)}.bind(this)),this._cardPanel.setClickAction("nextButton",function(){e.goToNextHotspot()}),this._cardPanel.setClickAction("prevButton",function(){e.goToPrevHotspot()})},lookToWorld:function(){var e=c.vec3.create(),t=c.vec3.fromValues(0,0,-1),i=c.mat4.fromXRotation(c.mat4.create(),Math.PI);return function(r,n,a,o,s){c.mat4.lookAt(r,n,a,t),c.mat4.multiply(r,i,r),c.mat4.multiply(r,r,s),c.mat4.invert(r,r),c.mat4.scale(r,r,c.vec3.set(e,o,o,o))}}(),updatePositionVR:function(){var e=c.vec3.create();return function(t,i,r,n,a,o){var s=this._hotspotMT.getMatrix(),u=t.get("lastComputedScenePosition"),l=c.vec3.dist(u,r),h=l/i;c.vec3.transformMat4(e,u,o),h=Math.max(1.5*h,.1*a),h=Math.min(4*h,h),this.lookToWorld(s,e,n,h,o);var d=this._worldTeleportPos?c.vec2.dist(this._worldTeleportPos,n):1/0,p=d<.5*a;this._canTeleport=!p,this._hotspotMT.dirtyBound()}}(),updatePosition:function(){var e=c.vec3.create();return function(t,i,r,n){var a=this._hotspotMT.getMatrix(),o=t.get("lastComputedScenePosition"),s=c.vec3.dist(o,n)/r;c.mat4.copy(a,i),c.mat4.scale(a,a,c.vec3.set(e,s,s,s)),c.mat4.setTranslation(a,o),this.isVisibleCard()&&this.setVisibleCard(!1),this._hotspotMT.dirtyBound()}}()}),"osgSketchfab","Hotspot"),t.a=g},function(e,t,i){"use strict";var r=i(5),n=i(436),a=i(69),o=i(31),s=i(464),u=i(600),l=r.a.osg;r.a.osgShadow.ShadowMap.prototype._preventTextureBindingDuringShadowCasting=function(){for(var e=i.i(s.a)(),t=l.StateAttribute.OVERRIDE|l.StateAttribute.ON,r=0;r<e;r++)this._casterStateSet.setTextureAttributeAndModes(r,l.Texture.textureNull,t)};var c=function(e,t,c){var h=new l.MatrixTransform;h.setName(e+" - LightNode "+t),h.getOrCreateStateSet().setAttributeAndModes(new l.Depth(l.Depth.DISABLE));var d=new n.a(t);c&&d.setLightType(c),d.setName(e+" - Light "+t),l.vec3.copy(d.getAmbient(),l.vec3.ZERO),l.vec3.copy(d.getSpecular(),l.vec3.ZERO),d.setLinearAttenuation(0);var p=new l.LightSource;p.setName("skfb"+e+" - LightSource "+t),p.setLight(d);var f=new r.a.osgShadow.ShadowSettings;f.setLight(d),f.setShadowCastShaderGeneratorName("ShadowCastSkfb"),f.setCastsShadowDrawTraversalMask(a.a.SHADOW),f.setCastsShadowBoundsTraversalMask(a.a.SHADOW_BOUNDS),f.userShadowCasterVisitor=!1,f.kernelSizePCF=i.i(o.a)().shadowPcf,f.fakePCF=!1;var g=new r.a.osgShadow.ShadowMap(f);if(g.setTextureUnitBase(12),g.setEnabled(!1),i.i(o.a)().stats){var m=g.getCamera(),v=u.a.getTimerGPU();m.setInitialDrawCallback(function(){v.start("ShadowMap"),v.start("ShadowMap"+t)}),m.setFinalDrawCallback(function(){v.end("ShadowMap"+t),v.end("ShadowMap")})}return{node:h,light:d,lightSource:p,shadowSettings:f,shadowMap:g,enableShadow:i.i(s.a)()>12}};t.a={createLight:c}},function(e,t,i){"use strict";var r=i(5),n=i(92),a=i(129),o=i(462),s=i(643),u=i.n(s),l=i(642),c=i.n(l),h=r.a.osg,d={},p=function(e,t){if(d[e])return d[e];var i=e.toLowerCase();return d[e]=a.a.createShader(u.a,c.a,i,t,e),d[e]},f=function(){return p("LINE","LightingLineGizmo")},g=function(){return p("HEMI","LightingHemiGizmo")},m=function(){return p("ICON","LightingIcon")},v=new h.BlendFunc(h.BlendFunc.ONE,h.BlendFunc.ONE_MINUS_SRC_ALPHA),_={},b=function(e){if(_[e])return _[e];var t=o.a.iconsLight[e];t||(t=o.a.iconsLight.DIRECTION);var i=n.default.instance,r=i.getOrCreateTexture(t);return _[e]=r.texture,r.texture},x={};x.createIconGeometry=function(){var e=h.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),t=e.getOrCreateStateSet();return t.setTextureAttributeAndModes(1,b("DIRECTION")),t.addUniform(h.Uniform.createInt(1,"uTextureIcon")),t.setAttributeAndModes(v),t.setAttributeAndModes(m()),e.setLightType=function(e){t.setTextureAttributeAndModes(1,b(e))},e},x.createDirectionalGeometry=function(e){for(var t=void 0===e?-1:-e,i=t/15,r=2*Math.PI,n=new Float32Array(180),a=0;a<5;++a){var o=6*a,s=r*a/5;n[o]=n[o+3]=Math.cos(s)*i,n[o+1]=n[o+4]=Math.sin(s)*i,n[o+5]=t}var u=new h.DrawArrays(h.primitiveSet.LINES,0,30),l=new h.Geometry;return l.getAttributes().Vertex=new h.BufferArray(h.BufferArray.ARRAY_BUFFER,n,3),l.getPrimitives().push(u),l.getOrCreateStateSet().setAttributeAndModes(f()),l.getOrCreateStateSet().setAttributeAndModes(v),l},x.createSpotGeometry=function(e){var t=void 0===e?-1:-e,i=2*Math.PI,r=new h.Geometry,n=new Float32Array(300),a=r.getAttributes().Vertex=new h.BufferArray(h.BufferArray.ARRAY_BUFFER,n,3),o=0,s=new Uint16Array(50);for(o=0;o<50;++o)s[o]=2*o+1;var u=new h.DrawElements(h.primitiveSet.LINE_LOOP,new h.BufferArray(h.BufferArray.ELEMENT_ARRAY_BUFFER,s,1)),l=new Uint16Array(10);for(o=0;o<5;++o)l[2*o]=20*o,l[2*o+1]=20*o+1;var c=new h.DrawElements(h.primitiveSet.LINES,new h.BufferArray(h.BufferArray.ELEMENT_ARRAY_BUFFER,l,1));return r.getPrimitives().push(c,u),r.getOrCreateStateSet().setAttributeAndModes(f()),r.getOrCreateStateSet().setAttributeAndModes(v),r.updateCone=function(e,s){var u=s?2*-s:t,l=Math.cos(e)*u,c=Math.sin(e)*u;for(o=0;o<50;++o){var h=6*o,d=i*o/50;n[h+3]=Math.cos(d)*c,n[h+4]=Math.sin(d)*c,n[h+5]=l}a.dirty(),r.dirtyBound()},r.updateCone(.1),r},x.createHemiGeometry=function(e){for(var t=void 0===e?-1:-e,i=new h.Geometry,r=new Float32Array(450),n=Math.PI,a=0;a<50;++a){var o=3*a,s=n*a/49,u=Math.cos(s),l=Math.sin(s);r[o]=u*t,r[o+2]=-l*t,r[150+o+1]=u*t,r[150+o+2]=-l*t,s=2*n*a/49,r[300+o]=Math.cos(s)*t,r[300+o+1]=Math.sin(s)*t}i.getAttributes().Vertex=new h.BufferArray(h.BufferArray.ARRAY_BUFFER,r,3);var c=new h.DrawArrays(h.primitiveSet.LINE_STRIP,0,50),d=new h.DrawArrays(h.primitiveSet.LINE_STRIP,50,50),p=new h.DrawArrays(h.primitiveSet.LINE_STRIP,100,50);i.getPrimitives().push(c,d,p);var f=i.getOrCreateStateSet();return f.setAttributeAndModes(g()),f.setAttributeAndModes(v),f.addUniform(h.Uniform.createFloat(-t,"uRadius")),i},x.createPointGeometry=function(){var e=2*Math.PI,t=new h.Geometry,i=new Float32Array(1350),r=t.getAttributes().Vertex=new h.BufferArray(h.BufferArray.ARRAY_BUFFER,i,3),n=new h.DrawArrays(h.primitiveSet.LINE_STRIP,0,50),a=new h.DrawArrays(h.primitiveSet.LINE_STRIP,50,50),o=new h.DrawArrays(h.primitiveSet.LINE_STRIP,100,50);return t.getPrimitives().push(n,a,o),t.getOrCreateStateSet().setAttributeAndModes(f()),t.getOrCreateStateSet().setAttributeAndModes(v),t.updateRadius=function(n){for(var a=0;a<50;++a){var o=3*a,s=e*a/49;i[o]=i[150+o]=i[300+o+1]=Math.cos(s)*n,i[o+1]=i[150+o+2]=i[300+o+2]=Math.sin(s)*n}r.dirty(),t.dirtyBound()},t.updateRadius(1),t},t.a=x},function(e,t,i){"use strict";var r=i(5),n=i(336),a=i(1056),o=i(464),s=i(86),u=i(389),l=i(46),c=i(156),h=r.a.osg,d=h.Texture.textureNull,p=new h.CullFace(h.CullFace.BACK),f=new h.CullFace(h.CullFace.DISABLE),g=new h.PointSizeAttribute,m=new h.PointSizeAttribute;m.setCircleShape(!0);var v=function(e){this._stateSet=void 0,this._materialModel=e,this._material=new n.a,this._material.setMaterialModel(this._materialModel);var t=new h.Texture;t.setImage(new Uint8Array(12),h.Texture.RGB),t.setTextureSize(4,1),t.setMinFilter(h.Texture.NEAREST),t.setMagFilter(h.Texture.NEAREST),this._colorAtlas=new a.a(t),this._colorAtlas.setIsColorAtlas(!0),this._packedMaterialTextureCache={},this._maxTextureUnit=i.i(o.a)()};v.cachedSquarePoint=g,v.cachedCirclePoint=m,v.prototype={dirtyMaterial:function(){this._material&&this._material.dirtyMaterial()},getStateSet:function(){return this._stateSet},setStateSet:function(e){this._stateSet=e,e.getAttribute("SketchfabMaterial")||(this._material.setName(e.getName()),e.setAttributeAndModes(this._material));for(var t=0,i=e.getNumTextureAttributeLists();t<i;t++)e.removeTextureAttribute(t,"Texture")},enableAlphaBlending:function(){this._stateSet&&this.setStateSetAlphaBlending()},disableTransparency:function(){this._stateSet&&this.setStateSetOpaque()},setStateSetAlphaBlending:function(){this._stateSet&&(this._stateSet.setRenderBinDetails(s.a.TRANSPARENT_BIN,"DepthSortedBin"),u.a.registerStateSetTransparency(this._stateSet))},setStateSetOpaque:function(){this._stateSet&&(this._stateSet.setRenderBinDetails(s.a.OPAQUE_BIN,"RenderBin"),u.a.registerStateSetOpaque(this._stateSet))},setCullface:function(e){this._stateSet&&(this._stateSet.setAttributeAndModes(e?p:f),this._material.dirtyMaterial())},setPointCircle:function(e){this._stateSet&&(this._stateSet.setAttributeAndModes(e?m:g),this._material.dirtyMaterial())},isFreeSlot:function(e,t){return void 0===e||e===d||(!(!e.getChannelCount||0!==e.getChannelCount())||!(!t||e!==this._colorAtlas))},isProtectedUnit:function(e){return 6===e||8===e},getAvailableTextureUnit:function(e,t){var i=t===this._colorAtlas,r=t===d,n=this._stateSet,a=n.getNumTextureAttributeLists(),o=Math.min(this.isProtectedUnit(a)?a+2:a+1,this._maxTextureUnit),s=-1,u=0;for(u=0;u<o;++u)if(!this.isProtectedUnit(u)){var l=n.getTextureAttribute(u,"Texture");if(-1===s&&this.isFreeSlot(l,i)&&(s=u,i||r))break;if(!r&&!i&&l&&l.packChannelIfPossible&&l.packChannelIfPossible(e,t)){s=u;break}}return s},setPackedMaterialTextureToStateSet:function(e,t){var i=e.getName(),r=this._packedMaterialTextureCache[i];r&&r.removeChannel&&r.removeChannel(i);var n=this.getAvailableTextureUnit(i,t);if(!(n<0)){var o=this._stateSet.getTextureAttribute(n,"Texture"),s=o===this._colorAtlas,u=t===this._colorAtlas;u?o=this._colorAtlas:(!o||s&&!u)&&(o=new a.a),o.setName("Texture"+n),this._material.setChannelMapping(i,t===d?-1:n),this._packedMaterialTextureCache[i]=o,o&&o.addChannel&&t!==d&&o.addChannel(i,t);var l=o.isProtectedTexture&&o.isProtectedTexture()?h.StateAttribute.PROTECTED:h.StateAttribute.ON;this._stateSet.setTextureAttributeAndModes(n,o,l)}},setTexture:function(e){var t=e.getTextureModel(),i=t.getImageModel(),r=t.getMultiresTexture();if(i&&r){this.setPackedMaterialTextureToStateSet(e,r),r.isTextureNull()&&r.setTextureSize(1,1);var n=l.a.getLowResLoaded();if(n.isFulfilled())return r.setImageMaxSupported();r.setImageSmallest().promise.then(function(){n.then(r.setImageMaxSupported.bind(r))})}},setColor:function(e){var t=e.getColor(),i=c.a.getColorPacking(e.getName());if(i<0)return void this.setPackedMaterialTextureToStateSet(e,d);i*=3;var r=this._colorAtlas.getTexture(),n=r.getImage().getImage();n[i]=Math.round(255*t[0]),n[i+1]=Math.round(255*t[1]),n[i+2]=Math.round(255*t[2]),r.dirty(),this.setPackedMaterialTextureToStateSet(e,this._colorAtlas)},setChannelEnable:function(e,t){return!1===t?this.setPackedMaterialTextureToStateSet(e,d):e.getTextureModel()?this.setTexture(e):this.setColor(e)},setChannelOpacity:function(e,t){var i=e.getTransparency(),r="additive"===i,n="alphaBlend"===i,a="alphaMask"===i,o="dithering"===i;return this._material&&this._material.updateOpacity(),!1===t?this.disableTransparency():a||o?this.disableTransparency():n||r?this.enableAlphaBlending():void h.warn("Unknow alpha type : "+i)},updateChannel:function(e){if(this._stateSet){var t=e.isEffective();this.setChannelEnable(e,t),"Opacity"===e.getName()&&this.setChannelOpacity(e,t),this._material.dirtyMaterial()}}},t.a=v},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=i(366),o=n.a.osg,s=function(){a.a.apply(this,arguments)};o.createPrototypeObject(s,o.objectInherit(a.a.prototype,{verifyOpacity:function(e){var t=e.getChannels().Opacity.getFactor();t<.001&&(t=1),e.setChannelFactor("Opacity",t)},setChannelsFromMetaData:function(e,t,n,a){i.i(r.each)(a,function(i,r){if(void 0!==e[r]){var a=JSON.parse(e[r]);if(t[n](i,a),t.setChannelEnable(i,!0),"SpecularColor"===i&&t.setChannelFactor("SpecularColor",1),"SpecularHardness"===i){var o=void 0!==e.ks?JSON.parse(e.ks):[0,0,0];this.setGlossinessPBRFromSpecularGlossiness(t,o,a)}}}.bind(this))},processMaterial:function(e,t,i){var r=this.createMaterial(e,t),n={kd:"DiffuseColor",ka:"EmitColor",ks:"SpecularColor"},a={ns:"SpecularHardness",tr:"Opacity",d:"Opacity"};this.setChannelsFromMetaData(i,r,"setChannelColor",n),this.setChannelsFromMetaData(i,r,"setChannelFactor",a),this.verifyOpacity(r),t.removeAttribute("Material");var o,s,u=function(e){for(var t=[],i=0;i<e.getNumTextureAttributeLists();i++){var r=e.getTextureAttribute(i,"Texture");void 0!==r&&("PackedMaterialTexture"===r.className()&&(r=r.getTexture()),t[i]=r)}return t}(t),l=function(e,t,i,n){e.removeTextureAttribute(t,"Texture");var a=r.getChannels()[n];a.setTextureModel(this.createTextureModelFromTextureOSG(i)),a.resetTextureFormat(),a.setTexCoordUnit(0),a.setEnable(!0)}.bind(this);void 0!==i.map_ka&&(o=JSON.parse(i.map_ka),void 0!==(s=u[o])&&l(t,o,s,"EmitColor")),void 0!==i.map_kd&&(o=JSON.parse(i.map_kd),void 0!==(s=u[o])&&l(t,o,s,"DiffuseColor")),void 0!==i.map_occlusion&&(o=JSON.parse(i.map_occlusion),void 0!==(s=u[o])&&l(t,o,s,"DiffuseIntensity")),void 0!==i.map_d&&(o=JSON.parse(i.map_d),void 0!==(s=u[o])&&(l(t,o,s,"Opacity"),r.getChannels().Opacity.setTransparency("alphaBlend"))),void 0!==i.map_ks&&(o=JSON.parse(i.map_ks),void 0!==(s=u[o])&&l(t,o,s,"SpecularColor")),void 0!==i.map_ns&&(o=JSON.parse(i.map_ns),void 0!==(s=u[o])&&l(t,o,s,"SpecularHardness")),void 0!==i.map_normal&&(o=JSON.parse(i.map_normal),void 0!==(s=u[o])&&l(t,o,s,"NormalMap")),void 0!==i.bump&&(o=JSON.parse(i.bump),void 0!==(s=u[o])&&l(t,o,s,"BumpMap")),r.setStateSet(t)}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=function(){n.TextureCubeMap.call(this),this._imageProxy=void 0};n.createPrototypeStateAttribute(a,n.objectInherit(n.TextureCubeMap.prototype,{getHash:function(){return"osgSketchfabTexture"}}),"osgSketchfab","TextureCubeMap"),a.dummyTexture=new a,a.dummyTexture.setTextureSize(1,1),t.a=a},function(e,t,i){"use strict";var r=i(5),n=i(737),a=i(86),o=r.a.osg,s=function(){o.StateSet.call(this),this._colorUniform=o.Uniform.createFloat4(o.vec4.fromValues(1,0,0,0),"uColor"),this._callbackColor=new n.a(this._colorUniform,1),this.init()};o.createPrototypeObject(s,o.objectInherit(o.StateSet.prototype,{setRenderBinVR:function(e){this.setRenderBinDetails(e?a.a.TRANSPARENT_BIN_NO_EARLYZ_POST:a.a.WIREFRAME,"RenderBin")},init:function(){this.setRenderBinDetails(a.a.WIREFRAME,"RenderBin"),this.setAttributeAndModes(new o.Depth(o.Depth.LEQUAL)),this.setAttributeAndModes(new o.BlendFunc(o.BlendFunc.ONE,o.BlendFunc.ONE_MINUS_SRC_ALPHA)),this.setShaderGeneratorName("wireframe"),this.addUniform(this._colorUniform),this.addUpdateCallback(this._callbackColor)},setWireframeColorSmooth:function(e){this._callbackColor.setColorTarget(e)},setWireframeColor:function(e){this._colorUniform.setFloat4(e)},setWireframeEnable:function(e,t){e?(!0===this._callbackColor._finished&&(this._colorUniform.setFloat3(t),this._colorUniform.getInternalArray()[3]=0),this._callbackColor.show(t[3])):this._callbackColor.hide()}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(512),a=i(53),o=r.a.osg,s=function(e,t){this._colorUniform=e,this._colorDelta=o.vec4.create(),this._lastRatio=0,n.a.call(this,t),this._finished=!0,this._disableAfterFinished=!1,this._finishCallback=void 0,this._lastFrame=0};o.createPrototypeObject(s,o.objectInherit(n.a.prototype,{hide:function(){o.vec3.init(this._colorDelta,0,0,0)[3]=-this._colorUniform.getInternalArray()[3],this._disableAfterFinished=!0,this._lastRatio=0,this.reset()},show:function(e){o.vec3.set(this._colorDelta,0,0,0)[3]=void 0!==e?e:1-this._colorUniform.getInternalArray()[3],this._disableAfterFinished=!1,this._lastRatio=0,this.reset()},setColorTarget:function(e){o.vec4.sub(this._colorDelta,e,this._colorUniform.getInternalArray()),this._disableAfterFinished=!1,this._lastRatio=0,this.reset()},setFinishCallback:function(e){this._finishCallback=e},finished:function(){!0===this._disableAfterFinished&&this._finishCallback&&this._finishCallback()},update:function(e,t){if(!0===this._finished)return!0;a.a.draw();var i=t.getFrameStamp(),r=i.getFrameNumber();if(this._lastFrame===r)return!0;this._lastFrame=r;var n=i.getSimulationTime(),s=this.interpolate(n,e,t);s=o.smoothStep(0,1,s);var u=s-this._lastRatio;this._lastRatio=s;var l=this._colorUniform.getInternalArray(),c=this._colorDelta;return l[0]+=c[0]*u,l[1]+=c[1]*u,l[2]+=c[2]*u,l[3]+=c[3]*u,!0}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(297),a=i(515),o=r.a.osg,s=function(){n.a.apply(this,arguments),this._CompilerBlending=a.a,this._stackShader=[],this._indexShader=0,this._onSameShader=!0,this._gl=null};o.createPrototypeObject(s,o.objectInherit(n.a.prototype,{setGraphicContext:function(e){this._gl=e},getNextIndexShader:function(){return this._indexShader===this._stackShader.length-1?0:this._indexShader+1},onSameShader:function(){this._onSameShader=!0},toNextShader:function(){this._indexShader=this.getNextIndexShader(),this._onSameShader=!1},getNextShader:function(){return this._stackShader[this.getNextIndexShader()]},getCurrentShader:function(){return this._stackShader[this._indexShader]},addShader:function(e){this._stackShader.push(e)},compileAllShaders:function(e,t,i,r){for(var n=this._stackShader,a=n.length,s=this._gl,u={getGraphicContext:function(){return s},applyProgram:function(){}},l=this.getShaderProcessor(),c=0,h=2*a;c<h;++c){var d=n[c%a],p=c<a?d:n[(c+1)%a],f=e+d+p;if(!0!==this._cache.has(f)){var g=new this._CompilerBlending(i,r,l);g.setOutputs(d,p);var m=g.createFragmentShader(),v=g.createVertexShader(),_=new o.Program(new o.Shader(o.Shader.VERTEX_SHADER,v),new o.Shader(o.Shader.FRAGMENT_SHADER,m));_.hash=f,_.setActiveUniforms(this.getActiveUniforms(t,i,r)),_.generated=!0,_.apply(u),this._cache.set(f,_)}}},getOrCreateProgram:function(e){var t=this.getNextShader(),i=!0===this._onSameShader?t:this.getCurrentShader(),r="",n=[],a=[];r+=this.getActiveAttributeList(e,n),r+=this.getActiveTextureAttributeList(e,a);var o=r+i+t,s=this._cache.get(o);return void 0!==s?s:(this.compileAllShaders(r,e,n,a),this._cache.get(o))}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(297),a=i(1083),o=r.a.osg,s=function(){n.a.apply(this,arguments),this.setShaderCompiler(a.a)};o.createPrototypeObject(s,n.a.prototype),t.a=s},function(e,t,i){"use strict";var r=3.14159265359,n={},a=function(e,t,i,a,o,s){a=a||.25,o=o||720;var u=Math.cos(.01745329251*a),l=0,c=n.table;if(void 0===c)for(c=n.table=new Float32Array(1801779),l=0;l<1801779;++l)c[l]=1/0;var h=r/(o-1),d=1.57079632679/(o-1),p=s?3:2,f=e.length/p;for(l=0;l<f;++l){var g=l*i,m=l*p,v=e[m],_=e[m+1];4!==i||s||(t[g+3]=1024&v?-1:1,v&=-1025);var b,x,S,y=3*(v+o*_),C=y>=1801779;if(C||c[y]===1/0){var T=v*h,M=Math.cos(T),w=Math.sin(T);T+=d;var A=(u-M*Math.cos(T))/Math.max(1e-5,w*Math.sin(T));A>1?A=1:A<-1&&(A=-1);var E=6.28318530718*_/Math.ceil(r/Math.max(1e-5,Math.acos(A)));b=w*Math.cos(E),x=w*Math.sin(E),S=M,C||(c[y]=b,c[y+1]=x,c[y+2]=S)}else b=c[y],x=c[y+1],S=c[y+2];if(s){var P=47938362584151635e-21*e[m+2],N=Math.sin(P);t[g]=N*b,t[g+1]=N*x,t[g+2]=N*S,t[g+3]=Math.cos(P)}else t[g]=b,t[g+1]=x,t[g+2]=S}return t};t.a=a},function(e,t,i){"use strict";var r=function(e,t,i,r,n){for(var a=e.length/n,o=0;o<a;++o)for(var s=o*n,u=0;u<n;++u)t[s+u]=i[u]+e[s+u]*r[u];return t};t.a=r},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=function(e,t,i){for(var r=new n[i](t),a=0,o=0;a!==t;){var s=0,u=0;do{s|=(127&e[o])<<u,u+=7}while(0!=(128&e[o++]));r[a++]=s}if("U"!==i[0])for(var l=0;l<t;++l){var c=r[l];r[l]=c>>1^-(1&c)}return r};t.a=a},function(e,t,i){"use strict";var r,n,a,o=i(31),s=i(53),u=document.createElement("canvas"),l=document.createElement("canvas"),c=function(e,t,i){u.width===t&&u.height===i||(l.width=t,l.height=i,u.width=t,u.height=i,n=new Uint8Array(4*t*i));var r=e.getGraphicContext(),a=r.checkFramebufferStatus(r.FRAMEBUFFER);if(a!==r.FRAMEBUFFER_COMPLETE)return console.error("FRAMEBUFFER status invalid.",a);r.flush(),r.finish(),r.readPixels(0,0,t,i,r.RGBA,r.UNSIGNED_BYTE,n);var o=u.getContext("2d"),s=o.getImageData(0,0,t,i);s.data.set(n),o.putImageData(s,0,0);var c=l.getContext("2d");c.clearRect(0,0,t,i),c.fillStyle="transparent",c.fillRect(0,0,t,i),c.save(),c.globalCompositeOperation="copy",c.scale(1,-1),c.drawImage(u,0,0,t,i,0,-i,t,i),c.restore()},h=function(e,t,n){return c(e,t,n),i.i(o.a)().downloadPicture&&(r||(r=document.createElement("a"),document.body.appendChild(r),r.style.display="none"),r.href=l.toDataURL("image/jpeg"),r.download="image.jpg",r.click()),l},d=function(e){e.getScene().updateSceneGraph(e.getUpdateVisitor());var t=e.getCamera().getRenderer();t.cull(),t.draw()},p=function(e,t,i){var r=e.getFeatures(),n=e.getSuperSample(),o=e.getViewerOSGJS(),u=e.getFeaturesManager().getNodeGizmo(),l=o.getCamera();for(var c in r)r[c].prepareForScreenShot();a=void 0,u&&u.getNodeMask()&&(a=u.getNodeMask(),u.setNodeMask(0)),l.setFinalDrawCallback(function(e){n.isEnabled()||h(e,t,i)}),e.trigger("resize",t,i),o.updateViewport(),s.a.setPoseForScreenshot(!0)},f=function(e){var t=e.getFeatures(),i=e.getViewerOSGJS(),r=e.getFeaturesManager().getNodeGizmo(),n=i.getCamera();s.a.setPoseForScreenshot(!1),n.setFinalDrawCallback(void 0);for(var o in t)t[o].resetAfterScreenShot();a&&r.setNodeMask(a),e.trigger("resize",-1,-1)},g=function(e,t,i){var r=i.getSuperSample(),n=i.getViewerOSGJS();for(e&&t||(e=n.getCanvasWidth(),t=n.getCanvasHeight()),p(i,e,t),r.canBeEnabled()&&r.forceEnable(),d(n);r.isEnabled();)r.updateFrame(),d(n);return f(i),l};t.a=g},,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(39)),a=i(719),o=i(16);t.a=a.a.extend({el:['<div class="widget slider-widget volume-slider-widget">','          <div class="widget-wrapper">','              <a class="fa fa-volume-up"></a>','              <div class="bar">','                  <div class="slide">','                      <div class="cursor"></div>',"                  </div>","              </div>","          </div>","      </div>"].join(""),events:i.i(r.extend)({},a.a.prototype.events,{"click .fa":"onoff","touchstart .fa":"onoff"}),constructor:function(e,t){t=i.i(r.defaults)(t||{},{name:"volume",minimum:0,maximum:1,step:.1}),a.a.prototype.constructor.call(this,e,t)},initialize:function(){a.a.prototype.initialize.apply(this,arguments),this.isMute=0===this.get(),this.value=this.get(),this.model.on("change:"+this.options.name,i.i(n.a)(function(){0===this.get()?(this.isMute=!0,this.mute(this.$(".fa"))):this.isMute&&(this.isMute=!1,this.unmute(this.$(".fa")))}.bind(this)))},mute:function(e){e.removeClass("fa-volume-up").addClass("fa-volume-off")},unmute:function(e){e.removeClass("fa-volume-off").addClass("fa-volume-up")},onoff:function(){this.isMute?(0!==this.value&&null!==this.value||(this.value=1),this.set(this.value),this.model.set("playing",!0),o.a.modelViewerMuteButtonClicked(0)):(this.value=this.get(),this.set(0),o.a.modelViewerMuteButtonClicked(1))},cursorDrag:function(){a.a.prototype.cursorDrag.apply(this,arguments),this.value=null}})},function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(15),o=i(508),s=i(509),u=i(29);t.a=a.a.extend({save:function(e,t){null!=e&&"object"!=typeof e||(t=e);var i=new FormData;return i.append("imageFile",this.get("imageFile")),i.append("modelUid",t.modelUID),n.a.ajax({url:this.url(),data:i,processData:!1,contentType:!1,type:"POST"})},url:function(){return this.isNew()?"/i/backgrounds":"/i/backgrounds/"+this.get("uid")}},i.i(s.a)({fileTypes:u.a.backgroundFiletypes,maxFileSize:u.a.maxBackgroundFilesize})).extend(o.a)},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(15)),a=i(432),o=i(509),s=i(29);t.a=n.a.extend(i.i(r.extend)({},a.a,{url:function(){return"/i/environments/"+this.get("uid")}}),i.i(o.a)({fileTypes:s.a.environmentFiletypes,maxFileSize:s.a.maxEnvironmentFilesize}))},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(2),o=i.n(a),s=i(15),u=i(508),l=i(509),c=i(29);t.a=s.a.extend({url:function(){return this.isNew()?"/i/matcaps":"/i/matcaps/"+this.get("uid")},save:function(e,t){null!=e&&"object"!=typeof e||(t=e);var i=new FormData;return i.append("imageFile",this.get("imageFile"),this.get("name")),i.append("modelUid",t.modelUID),n.a.resolve(o.a.ajax({url:this.url(),data:i,processData:!1,contentType:!1,type:"POST"}))},getProxyImage:function(){var e=this.findImageSmallest();return e||console.error("MISSING IMAGE DATA!"),{label:this.get("name"),value:this.get("uid")||this.get("id"),image:e.url,imageModel:this,deletable:!this.get("isDefault")}}},i.i(l.a)({fileTypes:c.a.matcapFiletypes,maxFileSize:c.a.maxMatcapFilesize})).extend(u.a)},function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(15);t.a=a.a.extend({save:function(e,t){null!=e&&"object"!=typeof e||(t=e);var i=new FormData;return i.append("imageFile",this.get("imageFile")),i.append("source",this.get("source")),i.append("modelUid",t.modelUID),n.a.ajax({url:this.url(),data:i,processData:!1,contentType:!1,type:"POST"})},url:function(){return"/i/thumbnails"}})},function(e,t,i){"use strict";function r(e,t){var i,n,a=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,o=/(^[ ]*|[ ]*$)/g,s=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=/^0x[0-9a-f]+$/i,l=/^0/,c=function(e){return r.insensitive&&(""+e).toLowerCase()||""+e},h=c(e).slice(0,50).replace(o,"")||"",d=c(t).slice(0,50).replace(o,"")||"",p=h.replace(a,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),f=d.replace(a,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),g=parseInt(h.match(u))||1!==p.length&&h.match(s)&&Date.parse(h),m=parseInt(d.match(u))||g&&d.match(s)&&Date.parse(d)||null;if(m){if(g<m)return-1;if(g>m)return 1}for(var v=0,_=Math.max(p.length,f.length);v<_;v++){if(i=!(p[v]||"").match(l)&&parseFloat(p[v])||p[v]||0,n=!(f[v]||"").match(l)&&parseFloat(f[v])||f[v]||0,isNaN(i)!==isNaN(n))return isNaN(i)?1:-1;if(typeof i!=typeof n&&(i+="",n+=""),i<n)return-1;if(i>n)return 1}return 0}t.a=r},function(e,t,i){"use strict";t.a=["4024128cf8904b69946e891caac5f305","b83e3a8794ae47e0b4039e7fdb031602","16cdcddf277d423d99094f8db0c731e9","efd4ef0fc18a4ec0a1313d782fade965","675ff0f13b474c62947097939fe9aa1e","df5b82c5ccec42cbb9c5ba9528f0be52","491ddabd93aa49ecb5ad36538f7d00e3","02751cd893a14f3986fb17a90245f64f","78a54c2fd53a4ba4891a4bbdac7f30f7","956bb00775a044e7afdd1c17f6bdab63","003c1543cd754a19a0e14bc89726ccf5","268447ca0a954f44b06d1387863d114e","80fba9759ab94307a782f38d359b8ea8","e73867d210de4bc2b5eb261738cf3e79","2e9c3708feb74137b0436f946b8b66b8","591b2c2db5744df1803a09d477f5a2c7"]},function(e,t,i){"use strict";var r=i(89),n=i(1070),a={FeatureName:"saveUI",ModelName:"Material",ViewListType:[n.a]};t.a=r.a.create(a)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";t.a=function(e){return e=e.substring(e.lastIndexOf("/")+1),e=e.split("."),e=e[e.length>1?e.length-2:e.length-1],e.split("_").pop().toLowerCase()}},function(e,t,i){"use strict";t.a=function(e,t){var i,r,n=e.length,a=t.length,o=[];if(!n)return a;if(!a)return n;for(i=0;i<=n;i++)o[i]=[i];for(r=0;r<=a;r++)o[0][r]=r;for(r=1;r<=a;r++)for(i=1;i<=n;i++)e[i-1]===t[r-1]?o[i][r]=o[i-1][r-1]:o[i][r]=Math.min(o[i-1][r],o[i][r-1],o[i-1][r-1])+1;return o[n][a]}},,,,,function(e,t,i){"use strict";var r=i(31),n=window.navigator.userAgent,a=!i.i(r.a)().isApp&&(/constructor/i.test(window.HTMLElement)||function(e){return"[object SafariRemoteNotification]"===e.toString()}(!window.safari)||n.match(/iPad/i)||n.match(/iPhone/i));t.a=a},function(e,t,i){"use strict";var r=i(174);t.a=r.a.extend({})},function(e,t,i){e.exports=i.p+"Direction-da0354ccc70bc3322aa657cdcd356e39.png"},function(e,t,i){e.exports=i.p+"Hemi-069d53239a191b55450d472c13408320.png"},function(e,t,i){e.exports=i.p+"Point-7493691bc0625a4c8a09393c65c39e5c.png"},function(e,t,i){e.exports=i.p+"Sound-c9d6e5b9ed6c02f1dfaea84e549485c1.png"},function(e,t,i){e.exports=i.p+"Spot-7484bdcd407b8b2416471e8e6cd23770.png"},function(e,t,i){e.exports=i.p+"eye-slash-8e28e3d3425c918e878de1aba50dab7b.png"},function(e,t,i){e.exports=i.p+"target-0866e5fb9cf68854331bdbfb5fa4b4dc.png"},,function(e,t,i){e.exports=i.p+"Hotspot-091f212d5a1a99daeaa8089a72d1cb80.png"},,,,,,function(e,t){e.exports={devDependencies:{chai:"^3.5.0",eslint:"^4.1.1","eslint-config-google":"^0.8.0","eslint-config-standard":"^10.2.1","eslint-plugin-import":"^2.6.0","eslint-plugin-node":"^5.1.0","eslint-plugin-promise":"^3.5.0","eslint-plugin-standard":"^3.0.1","grunt-contrib-connect":"~0.9","grunt-documentation":"*","grunt-mocha":"^1.0.2","grunt-plato":"~0.2.1","grunt-release":"^0.10.0","grunt-update-submodules":"^0.4.1",mocha:"^2.5.3","webpack-strip-block":"0.0.1"},peerDependencies:{grunt:">=0.4.0"},dependencies:{"gl-matrix":"^2.3.2","grunt-lib-phantomjs":"^1.0.2","webpack-dev-server":"^1.7.0",webpack:"^1.7.3","raw-loader":"^0.5.1",path:"^0.11.14",leapjs:"^0.6.4","json-loader":"^0.5.4",jquery:"^2.1.3",hammerjs:"^2.0.4","grunt-webpack":"^1.0.8","grunt-shell":"*","grunt-git":"*","grunt-eslint":"*","grunt-copy-to":"0.0.12","grunt-contrib-uglify":"*","grunt-contrib-copy":"*","grunt-contrib-clean":"*",grunt:"> 1.0.0",glob:"*",extend:"*","eslint-plugin-private-variables":"*",eslint:">=4.1.1"},contributors:["Paul Cheyrou-Lagrze <tuan.kuranes@gmail.com>","Jordi Torres <jtorresfabra@gmail.com>","Matt Fontaine <tehqin@gmail.com>","Stephane Ginier <stephane.ginier@gmail.com>"],version:"0.2.7",author:"Cedric Pinson <trigrou@trigrou.com> (http://cedricpinson.com)",license:"MIT",description:"OpenSceneGraph implementation in javascript",repository:{url:"git@github.com:cedricpinson/osgjs.git",type:"git"},name:"OpenSceneGraph"}},function(e,t){e.exports="/*jshint worker: true */\n\nself.onmessage = function(event) {\n    var data = event.data;\n\n    var opt = {\n        imageOrientation: 'flipY',\n        premultiplyAlpha: 'none',\n        colorSpaceConversion: 'none'\n    };\n\n    self.fetch(data.url).then(function(response) {\n        response.blob().then(function(blob) {\n            self.createImageBitmap(blob, opt).then(function(bitmap) {\n                postMessage(\n                    {\n                        bitmap: bitmap,\n                        url: data.url,\n                        uid: data.uid\n                    },\n                    [bitmap]\n                );\n            });\n        });\n    });\n};\n\n/*jshint worker: false */\n"},function(e,t){e.exports="(function webpackUniversalModuleDefinition(root, factory) {\n  if(typeof exports === 'object' && typeof module === 'object')\n    module.exports = factory();\n  else if(typeof define === 'function' && define.amd)\n    define([], factory);\n  else {\n    var a = factory();\n    for(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n  }\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/  // The module cache\n/******/  var installedModules = {};\n\n/******/  // The require function\n/******/  function __webpack_require__(moduleId) {\n\n/******/    // Check if module is in cache\n/******/    if(installedModules[moduleId])\n/******/      return installedModules[moduleId].exports;\n\n/******/    // Create a new module (and put it into the cache)\n/******/    var module = installedModules[moduleId] = {\n/******/      exports: {},\n/******/      id: moduleId,\n/******/      loaded: false\n/******/    };\n\n/******/    // Execute the module function\n/******/    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/    // Flag the module as loaded\n/******/    module.loaded = true;\n\n/******/    // Return the exports of the module\n/******/    return module.exports;\n/******/  }\n\n\n/******/  // expose the modules object (__webpack_modules__)\n/******/  __webpack_require__.m = modules;\n\n/******/  // expose the module cache\n/******/  __webpack_require__.c = installedModules;\n\n/******/  // __webpack_public_path__\n/******/  __webpack_require__.p = \"\";\n\n/******/  // Load entry module and return exports\n/******/  return __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var decompressor = __webpack_require__( 1 );\n\n  /*jshint worker: true */\n\n  self.onmessage = function ( event ) {\n      var input = event.data;\n      var result = decompressor.decompress( input.buffer );\n\n      var img = new Uint8Array( result.img.buffer );\n      var width = result.width;\n      var height = result.height;\n\n      if ( input.swizzle ) {\n          var nbComponents = input.nbComponents || 3;\n          var nbPixel = width * height * 4;\n          for ( var i = 0, j = 0; i < nbPixel; i += 4, j += nbComponents ) {\n              var r = img[ i ];\n              var a = img[ i + 3 ];\n\n              var x = ( r / 255.0 ) * 2.0 - 1.0;\n              var y = ( a / 255.0 ) * 2.0 - 1.0;\n              var z = Math.sqrt( 1.0 - x * x - y * y );\n              z = Math.round( ( z * 0.5 + 0.5 ) * 255.0 );\n\n              img[ j ] = r;\n              img[ j + 1 ] = a;\n              img[ j + 2 ] = z;\n          }\n\n          img = img.subarray( 0, width * height * nbComponents );\n      }\n\n      postMessage( {\n          img: img,\n          width: width,\n          height: height,\n          uid: input.uid || 'uid'\n      }, [ img.buffer ] );\n  };\n\n  /*jshint worker: false */\n\n  module.exports = {\n      astcDecompressor: decompressor\n  };\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var precompute = __webpack_require__(2);\n  var cacheUnquantizeSimple = precompute.cacheUnquantizeSimple;\n  var cacheUnquantizeTrits = precompute.cacheUnquantizeTrits;\n  var cacheUnquantizeQuints = precompute.cacheUnquantizeQuints;\n  var cacheDecodeSimple = precompute.cacheDecodeSimple;\n  var cacheDecodeTrits = precompute.cacheDecodeTrits;\n  var cacheDecodeQuints = precompute.cacheDecodeQuints;\n\n  var bitUtils = __webpack_require__(3);\n  var popCount = bitUtils.popCount;\n  var readBits = bitUtils.readBits;\n  var writeBits = bitUtils.writeBits;\n  var extractBits = bitUtils.extractBits;\n  var replicateBits = bitUtils.replicateBits;\n  var bitTransferSigned = bitUtils.bitTransferSigned;\n  var reverseU8Array = bitUtils.reverseU8Array;\n\n\n  // Counting how many bits have been read for each block\n  // the value is reseted when computing a new block\n  var bitsReadCount = 0;\n  // Counting how many bits have been written\n  // useful when extracting color endpoint data\n  var bitsWrittenCount = 0;\n  // Counting how many bits have been read in the\n  // current block color data stream\n  var colorDataBitsRead = 0;\n  // Keeping track of the current index\n  // when calling the computeEndpoints routine\n  var decodedColorValuesIdx = 0;\n\n  // Contains the information\n  // of the current processed block\n  var CURRENT_BLOCK_INFO = {};\n  // Describes how trit/quint/bit is packed\n  // for a single encoded integer in the maxWeightQuintsTritsMapper\n  var TRIT_IDX = 0;\n  var QUINT_IDX = 1;\n  var BIT_IDX = 2;\n\n  // Maximum number of encoded values = 288\n  var resultDecodedStorage = new Uint16Array(288 * 6);\n  var subDecodedValue = new Array(8);\n  var classSelectorBitsArray = new Uint8Array(4);\n  var colorModeLSB = new Uint8Array(4);\n  var texelWeightData = new Uint8Array(16);\n  var colorEndpointData = new Uint8Array(16);\n  var endpoints = new Uint8Array(4 * 2 * 4);\n  var blockPixelsOutput = null;\n\n  /**\n   * Encodes a given value into its quints/trits/bits representation\n   * @param  {uint} val the value to encode\n   * @return {Object} contains the number of trits/quints/bits to encode the given value.\n   */\n  var getEncodedInteger = function(val) {\n    var encodedInt = {\n      trits: 0,\n      quints: 0,\n      bits: 0,\n      tritValue: 0,\n      quintValue: 0,\n      bitValue: 0\n    };\n    while (val > 0) {\n      var check = val + 1;\n\n      if (!(check & (check - 1))) {\n        encodedInt.bits = popCount(val);\n        return encodedInt;\n      }\n      if ((check % 3 === 0) && !(Math.floor(check / 3) & Math.floor((check / 3) - 1))) {\n        encodedInt.bits = popCount(Math.floor(check / 3 - 1));\n        encodedInt.trits = 1;\n        return encodedInt;\n      }\n      if ((check % 5 === 0) && !(Math.floor(check / 5) & Math.floor((check / 5) - 1))) {\n        encodedInt.bits = popCount(Math.floor(check / 5 - 1));\n        encodedInt.quints = 1;\n        return encodedInt;\n      }\n\n      val--;\n    }\n    return encodedInt;\n  };\n\n  var replicateBits0816Map = new Uint16Array(256);\n  for (var i = 0; i < 256; ++i)\n    replicateBits0816Map[i] = replicateBits(i, 8, 16);\n\n  var maxWeightQuintsTritsMapper = new Uint16Array(256 * 3);\n  var idx = 0;\n  for (var i = 0; i < 256; i++) {\n    var encodedInt = getEncodedInteger(i);\n    maxWeightQuintsTritsMapper[idx + TRIT_IDX] = encodedInt.trits;\n    maxWeightQuintsTritsMapper[idx + QUINT_IDX] = encodedInt.quints;\n    maxWeightQuintsTritsMapper[idx + BIT_IDX] = encodedInt.bits;\n\n    idx += 3;\n  }\n\n  /**\n   * Gives additional precision to RGB colors near gray\n   * pixel is changed in-place in the endpoints array\n   * Refers to ASTC specifications (Section 3.8)\n   * @param  {int} a the alpha channel component\n   * @param  {int} r the red channel component\n   * @param  {int} g the green channel component\n   * @param  {int} b the blue channel component\n   */\n  var blueContract = function(a, r, g, b) {\n    var idx = endpoints.currIdx;\n    endpoints[idx] = a;\n    endpoints[idx + 1] = (r + b) >> 1;\n    endpoints[idx + 2] = (g + b) >> 1;\n    endpoints[idx + 3] = b;\n  };\n\n  /**\n   * Expands a given seed\n   * Refers to ASTC specifications (Section 3.15)\n   * @param  {uint32} p the seed to expand\n   * @return {uint32} the processed expanded seed\n   */\n  var hash52 = function(p) {\n    p ^= (p >>> 15) >>> 0;\n    p -= (p << 17) >>> 0;\n    p += (p << 7) >>> 0;\n    p += (p << 4) >>> 0;\n    p ^= (p >>> 5) >>> 0;\n    p += (p << 16) >>> 0;\n    p ^= (p >>> 7) >>> 0;\n    p ^= (p >>> 3) >>> 0;\n    p ^= (p << 6) >>> 0;\n    p ^= (p >>> 17) >>> 0;\n\n    return p;\n  };\n\n  /**\n   * Computes the partition index for a given texel\n   * @param  {uint32} seed partition pattern index\n   * @param  {int} x texel x position withing the block\n   * @param  {int} y texel y position withing the block\n   * @param  {int} z texel z position withing the block\n   * @param  {uint} partitionCount maximum number of existing partitions\n   * @param  {bool} smallBlock set to true, number of texel in the block is less than 31\n   * @return {uint} the partition index of the given texel\n   */\n\n  var seedsPartitionTable = new Uint8Array(12);\n\n  var precomputeSelectPartition = function(seed, partitionCount) {\n\n    // Refers to ASTC specifications (Section 3.15)\n    seed += (partitionCount - 1) * 1024;\n    var seedUint32 = seed >>> 0;\n\n    var rnum = hash52(seedUint32);\n\n    // The seeds values should be saved in an uint8 variable\n    seedsPartitionTable[0] = rnum & 0xF;\n    seedsPartitionTable[1] = (rnum >> 4) & 0xF;\n    seedsPartitionTable[2] = (rnum >> 8) & 0xF;\n    seedsPartitionTable[3] = (rnum >> 12) & 0xF;\n    seedsPartitionTable[4] = (rnum >> 16) & 0xF;\n    seedsPartitionTable[5] = (rnum >> 20) & 0xF;\n    seedsPartitionTable[6] = (rnum >> 24) & 0xF;\n    seedsPartitionTable[7] = (rnum >> 28) & 0xF;\n    seedsPartitionTable[8] = (rnum >> 18) & 0xF;\n    seedsPartitionTable[9] = (rnum >> 22) & 0xF;\n    seedsPartitionTable[10] = (rnum >> 26) & 0xF;\n    seedsPartitionTable[11] = ((rnum >> 30) | (rnum << 2)) & 0xF;\n\n    seedsPartitionTable[0] *= seedsPartitionTable[0];\n    seedsPartitionTable[1] *= seedsPartitionTable[1];\n    seedsPartitionTable[2] *= seedsPartitionTable[2];\n    seedsPartitionTable[3] *= seedsPartitionTable[3];\n    seedsPartitionTable[4] *= seedsPartitionTable[4];\n    seedsPartitionTable[5] *= seedsPartitionTable[5];\n    seedsPartitionTable[6] *= seedsPartitionTable[6];\n    seedsPartitionTable[7] *= seedsPartitionTable[7];\n    seedsPartitionTable[8] *= seedsPartitionTable[8];\n    seedsPartitionTable[9] *= seedsPartitionTable[9];\n    seedsPartitionTable[10] *= seedsPartitionTable[10];\n    seedsPartitionTable[11] *= seedsPartitionTable[11];\n\n    var sh1 = 0;\n    var sh2 = 0;\n    var sh3 = 0;\n    if (seed & 1) {\n      sh1 = (seed & 2) ? 4 : 5;\n      sh2 = (partitionCount === 3) ? 6 : 5;\n    } else {\n      sh1 = (partitionCount === 3) ? 6 : 5;\n      sh2 = (seed & 2) ? 4 : 5;\n    }\n    sh3 = (seed & 0x10) ? sh1 : sh2;\n\n    seedsPartitionTable[0] >>= sh1;\n    seedsPartitionTable[1] >>= sh2;\n    seedsPartitionTable[2] >>= sh1;\n    seedsPartitionTable[3] >>= sh2;\n    seedsPartitionTable[4] >>= sh1;\n    seedsPartitionTable[5] >>= sh2;\n    seedsPartitionTable[6] >>= sh1;\n    seedsPartitionTable[7] >>= sh2;\n    seedsPartitionTable[8] >>= sh3;\n    seedsPartitionTable[9] >>= sh3;\n    seedsPartitionTable[10] >>= sh3;\n    seedsPartitionTable[11] >>= sh3;\n\n    return rnum;\n  };\n\n  var selectPartition = function(rnum, x, y, z, partitionCount, smallBlock) {\n    if (partitionCount === 1)\n      return 0;\n\n    if (smallBlock) {\n      x <<= 1;\n      y <<= 1;\n      z <<= 1;\n    }\n\n    var a = seedsPartitionTable[0] * x + seedsPartitionTable[1] * y + seedsPartitionTable[10] * z + (rnum >> 14);\n    var b = seedsPartitionTable[2] * x + seedsPartitionTable[3] * y + seedsPartitionTable[11] * z + (rnum >> 10);\n    var c = seedsPartitionTable[4] * x + seedsPartitionTable[5] * y + seedsPartitionTable[8] * z + (rnum >> 6);\n    var d = seedsPartitionTable[6] * x + seedsPartitionTable[7] * y + seedsPartitionTable[9] * z + (rnum >> 2);\n\n    a &= 0x3F;\n    b &= 0x3F;\n    c &= 0x3F;\n    d &= 0x3F;\n\n    if (partitionCount < 4)\n      d = 0;\n    if (partitionCount < 3)\n      c = 0;\n\n    if (a >= b && a >= c && a >= d)\n      return 0;\n    else if (b >= c && b >= d)\n      return 1;\n    else if (c >= d)\n      return 2;\n\n    return 3;\n  };\n\n  /**\n   * Simple swap util procedure swapping to cells in a given array\n   * @param  {array} array contains the cells to swap\n   * @param  {uint} i the first index\n   * @param  {uint} j the second index\n   */\n  var swapCell = function(array, i, j) {\n    var a = array[i];\n    array[i] = array[j];\n    array[j] = a;\n  };\n\n  /**\n   * Computes the total number of bits required to encoded\n   * the same encoded integer a given amount of times.\n   * @param  {uint} nbValues the number of encoded values\n   * @param  {[type]} encodedInteger the encoded value\n   * @return {uint} the number of bits to encoded nbValues of encodedInteger\n   */\n  var getBitsNbrFromEncodedInt = function(nbValues, trits, quints, bits) {\n    var totalBits = bits * nbValues;\n\n    if (trits)\n      totalBits += Math.floor((nbValues * 8 + 4) / 5);\n    else if (quints)\n      totalBits += Math.floor((nbValues * 7 + 2) / 3);\n\n    return totalBits;\n  };\n\n  /**\n   * Computes the number of weight values\n   * available in a given block\n   * @param  {Object} blockInfo the block info containing block size, max weight, etc...\n   * @return {uint} the number of weight values encoded inside the block\n   */\n  var getNumberWeightValues = function(blockInfo) {\n    var nbValues = blockInfo.width * blockInfo.height;\n    if (blockInfo.dualPlane)\n      nbValues *= 2;\n\n    // max nbValues = 12*12*2\n    return nbValues;\n  };\n\n\n  /**\n   * Computes the total number of bits needed to\n   * encode all the weights using Integer Sequence Encoding\n   * @param  {Object} blockInfo the block info containing block size, max weight, etc...\n   * @return {uint} the number of required bits to encoded the weights.\n   */\n  var getPackedBitSize = function(blockInfo) {\n    var nbValues = getNumberWeightValues(blockInfo);\n\n    var idx = blockInfo.maxWeight * 3;\n    var trits = maxWeightQuintsTritsMapper[idx + TRIT_IDX];\n    var quints = maxWeightQuintsTritsMapper[idx + QUINT_IDX];\n    var bits = maxWeightQuintsTritsMapper[idx + BIT_IDX];\n\n    return getBitsNbrFromEncodedInt(nbValues, trits, quints, bits);\n  };\n\n  /**\n   * Reads n values from a given array\n   * @param  {array} decodedColorValues the array to read\n   * @param  {uint} n the number of array cells to read\n   * @return {array} sub-array containing the read data\n   */\n  var readNDecodedColor = function(decodedColorValues, n) {\n    for (var i = 0; i < n; ++i)\n      subDecodedValue[i] = decodedColorValues[decodedColorValuesIdx++];\n    return subDecodedValue;\n  };\n\n  /**\n   * Clamps a pixel to the [0...255] range\n   * @param  {uint} beginIdx the index of the pixel alpha channel\n   * in the endpoints global array\n   */\n  var clampPixel = function(beginIdx) {\n    for (var i = 0; i < 4; ++i)\n      endpoints[beginIdx + i] = Math.max(0, Math.min(255, endpoints[beginIdx + i]));\n  };\n\n  /**\n   * Fills the endpoints global array with the given channel colors\n   * @param  {int} a the alpha channel component\n   * @param  {int} r the red channel component\n   * @param  {int} g the green channel component\n   * @param  {int} b the blue channel component\n   */\n  var fillEndpointsWithPixel = function(a, r, g, b) {\n    var idx = endpoints.currIdx;\n    endpoints[idx] = a;\n    endpoints[idx + 1] = r;\n    endpoints[idx + 2] = g;\n    endpoints[idx + 3] = b;\n  };\n\n  /**\n   * Parses the first 16 bytes a buffer\n   * considering it as an ASTC file buffer.\n   * @param  {ArrayBuffer} imgBuffer buffer containing the ASTC raw data\n   * @return {Object} contains data about the compressed image\n   */\n  var parseHeader = function(imgBuffer) {\n    var header = {};\n\n    var u8buffer = new Uint8Array(imgBuffer);\n    var u32Buffer = new Uint32Array(imgBuffer);\n\n    header.magic = u32Buffer[0];\n\n    var littleEndian = u8buffer[0] === (header.magic & 0xFF);\n\n    var isFormatCorrect = false;\n    if (littleEndian && header.magic === 0x5CA1AB13)\n      isFormatCorrect = true;\n    else if (!littleEndian && header.magic === 0x13ABA15C)\n      isFormatCorrect = true;\n\n    if (!isFormatCorrect)\n      console.error('The ASTC header does not meet the requirements.');\n\n    header.blockDimX = u8buffer[4];\n    header.blockDimY = u8buffer[5];\n    header.blockDimZ = u8buffer[6];\n\n    if (header.blockDimX > 12 || header.blockDimY > 12)\n      console.error('Incorrect ASTC file: block can not be larger than 12x12 pixels.');\n    if (header.blockDimZ > 1)\n      console.error('3D ASTC file are not supported.');\n\n    // Image width\n    header.xSize = u8buffer[7] + (u8buffer[8] << 8) + (u8buffer[9] << 16);\n    // Image height\n    header.ySize = u8buffer[10] + (u8buffer[11] << 8) + (u8buffer[12] << 16);\n    // Image depth\n    header.zSize = u8buffer[13] + (u8buffer[14] << 8) + (u8buffer[15] << 16);\n\n    if (header.zSize > 1)\n      console.error('3D ASTC file are not supported.');\n\n    return header;\n  };\n\n  /**\n   * Computes the layout of 2D block\n   * @param  {uint} blockModeBits extracted 11 first bit of the block\n   * @return {int} contains the layout of the block [0...9]\n   */\n  var findBlockLayout = function(blockModeBits) {\n    var layout = -1;\n\n    // Layout is in [0-4]\n    if ((blockModeBits & 0x1) || blockModeBits & 0x2) {\n      // layout is in [2-4]\n      if (blockModeBits & 0x8) {\n        // layout is in [3-4]\n        if (blockModeBits & 0x4)\n          layout = (blockModeBits & 0x100) ? 4 : 3;\n        else\n          layout = 2;\n      }\n      // layout is in [0-1]\n      else\n        layout = blockModeBits & 0x4 ? 1 : 0;\n\n      return layout;\n    }\n\n    // Layout is in [7-9]\n    if (blockModeBits & 0x100) {\n      // Layout [7-8]\n      if (blockModeBits & 0x80) {\n        if ((blockModeBits & 0x40))\n          console.error('Invalid block layout found.');\n        layout = (blockModeBits & 0x20) ? 8 : 7;\n      } else\n        layout = 9;\n\n      return layout;\n    }\n\n    layout = (blockModeBits & 0x80) ? 6 : 5;\n    return layout;\n  };\n\n  /**\n   * Extracts data regarding how block data are organized\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the first byte id of the current block\n   * @return {Object} contains block related data (void extent, maximum weight, etc;..)\n   */\n  var getBlockInfo = function(u8buffer, blockId) {\n    var blockInfo = CURRENT_BLOCK_INFO;\n    blockInfo.isVoidExtent = false;\n    blockInfo.error = false;\n\n    // Get the 'block mode' represented by the last 11 bits\n    var blockModeBits = readBits(u8buffer, blockId, bitsReadCount, 11);\n    bitsReadCount += 11;\n\n    // Checks the 9 least significant bits\n    // allowing to know if the block is a void-extent block (uniform color)\n    if ((blockModeBits & 0x01FF) === 0x1FC) {\n      blockInfo.isVoidExtent = true;\n      return blockInfo;\n    }\n\n    // Checks the first reserved pattern\n    // (xxxxx0000)\n    if ((blockModeBits & 0xF) === 0) {\n      blockInfo.error = true;\n      console.log('Warning: Block layout is reserved (xxxxx0000)');\n    }\n\n    // Checks the second reserved pattern\n    // (111xxxx00)\n    if ((blockModeBits & 0x3) === 0 &&\n      (blockModeBits & 0x1C0) === 0x1C0) {\n      blockInfo.error = true;\n      console.log('Warning: Block layout is reserved (111xxxx00)');\n    }\n\n    var layout = findBlockLayout(blockModeBits);\n    if (layout < 0)\n      console.error('Invalid block layout found.');\n\n    // Retrieves the R least significant bit according\n    // to the current block layout\n    var R = !!(blockModeBits & 0x10);\n    if (layout < 5)\n      R |= (blockModeBits & 0x3) << 1;\n    else\n      R |= (blockModeBits & 0xC) >> 1;\n\n    if (R < 2 || R > 7)\n      console.error('Invalid block mode. The file is not encoded in ASTC or corrupted.');\n\n    var a = 0;\n    var b = 0;\n    // Computes weights grid dimension\n    // Refers to ASTC specifications(Table 11)\n    switch (layout) {\n      case 0:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = b + 4;\n        blockInfo.height = a + 2;\n        break;\n      case 1:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = b + 8;\n        blockInfo.height = a + 2;\n        break;\n      case 2:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x3;\n        blockInfo.width = a + 2;\n        blockInfo.height = b + 8;\n        break;\n      case 3:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x1;\n        blockInfo.width = a + 2;\n        blockInfo.height = b + 6;\n        break;\n      case 4:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 7) & 0x1;\n        blockInfo.width = b + 2;\n        blockInfo.height = a + 2;\n        break;\n      case 5:\n        a = (blockModeBits >> 5) & 0x3;\n        blockInfo.width = 12;\n        blockInfo.height = a + 2;\n        break;\n      case 6:\n        a = (blockModeBits >> 5) & 0x3;\n        blockInfo.width = a + 2;\n        blockInfo.height = 12;\n        break;\n      case 7:\n        blockInfo.width = 6;\n        blockInfo.height = 10;\n        break;\n      case 8:\n        blockInfo.width = 10;\n        blockInfo.height = 6;\n        break;\n      case 9:\n        a = (blockModeBits >> 5) & 0x3;\n        b = (blockModeBits >> 9) & 0x3;\n        blockInfo.width = a + 6;\n        blockInfo.height = b + 6;\n        break;\n      default:\n        console.error('The block layout is not recognized. Layout should be [0-9].');\n    }\n\n    // The dual plane mode bit is the most significant bit\n    blockInfo.dualPlane = (layout !== 9) && (blockModeBits & 0x400);\n    // The high precision mode bit is the second most significant bit\n    blockInfo.highPrecisionRange = (layout !== 9) && (blockModeBits & 0x200);\n\n    // Selects the appropriate weight range\n    if (blockInfo.highPrecisionRange) {\n      var highWeightRanges = [9, 11, 15, 19, 23, 31];\n      blockInfo.maxWeight = highWeightRanges[R - 2];\n    } else {\n      var weightRanges = [1, 2, 3, 4, 5, 7];\n      blockInfo.maxWeight = weightRanges[R - 2];\n    }\n\n    return blockInfo;\n  };\n\n  /**\n   * Decodes a trit in colorData raw data\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} nbBitsPerValue number of bits\n   * on which the integer is encoded\n   * @param  {array} resultStorage contains decoded integer,\n   * the decoded trit will be pushed back at the end of this procedure\n   */\n\n  var lsbDecodingValues = new Uint8Array(5);\n  var msbDecodingValues = new Uint8Array(5);\n\n  var decodeTrit = function(colorData, nbBitsPerValue) {\n    var m = lsbDecodingValues;\n    var t = msbDecodingValues;\n    var T = 0;\n\n    // Refers to ASTC specifications (Table 17)\n    m[0] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T = readBits(colorData, 0, colorDataBitsRead, 2);\n    colorDataBitsRead += 2;\n\n    m[1] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 2) << 2;\n    colorDataBitsRead += 2;\n\n    m[2] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 1) << 4;\n    colorDataBitsRead += 1;\n\n    m[3] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 2) << 5;\n    colorDataBitsRead += 2;\n\n    m[4] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    T |= readBits(colorData, 0, colorDataBitsRead, 1) << 7;\n    colorDataBitsRead += 1;\n\n    var C = 0 >>> 0;\n    if (extractBits(T, 2, 4) === 7) {\n      C = (extractBits(T, 5, 7) << 2) | extractBits(T, 0, 1);\n      t[3] = 2;\n      t[4] = 2;\n    } else {\n      C = extractBits(T, 0, 4);\n      if (extractBits(T, 5, 6) === 3) {\n        t[4] = 2;\n        t[3] = extractBits(T, 7, 7);\n      } else {\n        t[4] = extractBits(T, 7, 7);\n        t[3] = extractBits(T, 5, 6);\n      }\n    }\n\n    if (extractBits(C, 0, 1) === 3) {\n      t[2] = 2;\n      t[1] = extractBits(C, 4, 4);\n      t[0] = (extractBits(C, 3, 3) << 1) | (extractBits(C, 2, 2) & ~extractBits(C, 3, 3));\n    } else if (extractBits(C, 2, 3) === 3) {\n      t[2] = 2;\n      t[1] = 2;\n      t[0] = extractBits(C, 0, 1);\n    } else {\n      t[2] = extractBits(C, 4, 4);\n      t[1] = extractBits(C, 2, 3);\n      t[0] = (extractBits(C, 1, 1) << 1) | (extractBits(C, 0, 0) & ~extractBits(C, 1, 1));\n    }\n\n    for (var i = 0; i < 5; ++i) {\n      var idx = resultDecodedStorage.currIndex;\n      resultDecodedStorage[idx] = 1;\n      resultDecodedStorage[idx + 1] = 0;\n      resultDecodedStorage[idx + 2] = nbBitsPerValue;\n      resultDecodedStorage[idx + 3] = t[i];\n      resultDecodedStorage[idx + 4] = 0;\n      resultDecodedStorage[idx + 5] = m[i];\n\n      resultDecodedStorage.currIndex += 6;\n    }\n  };\n\n  /**\n   * Decodes a quint in colorData raw data\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} nbBitsPerValue number of bits\n   * on which the integer is encoded\n   * @param  {array} resultStorage contains decoded integer,\n   * the decoded quint will be pushed back at the end of this procedure\n   */\n  var decodeQuint = function(colorData, nbBitsPerValue) {\n    var m = lsbDecodingValues;\n    var q = msbDecodingValues;\n    var Q = 0;\n\n    // Refers to ASTC specifications (Table 18)\n    m[0] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q = readBits(colorData, 0, colorDataBitsRead, 3);\n    colorDataBitsRead += 3;\n\n    m[1] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q |= readBits(colorData, 0, colorDataBitsRead, 2) << 3;\n    colorDataBitsRead += 2;\n\n    m[2] = readBits(colorData, 0, colorDataBitsRead, nbBitsPerValue);\n    colorDataBitsRead += nbBitsPerValue;\n\n    Q |= readBits(colorData, 0, colorDataBitsRead, 2) << 5;\n    colorDataBitsRead += 2;\n\n    if (extractBits(Q, 1, 2) === 3 && extractBits(Q, 5, 6) === 0) {\n      q[0] = 4;\n      q[1] = 4;\n      q[2] = (extractBits(Q, 0, 0) << 2) | ((extractBits(Q, 4, 4) & ~extractBits(Q, 0, 0)) << 1) | (extractBits(Q, 3, 3) & ~extractBits(Q, 0, 0));\n    } else {\n      var C = 0 >>> 0;\n      if (extractBits(Q, 1, 2) === 3) {\n        q[2] = 4;\n        C = (extractBits(Q, 3, 4) << 3) | ((~extractBits(Q, 5, 6) & 3) << 1) | (extractBits(Q, 0, 0));\n      } else {\n        q[2] = extractBits(Q, 5, 6);\n        C = extractBits(Q, 0, 4);\n      }\n\n      if (extractBits(C, 0, 2) === 5) {\n        q[1] = 4;\n        q[0] = extractBits(C, 3, 4);\n      } else {\n        q[1] = extractBits(C, 3, 4);\n        q[0] = extractBits(C, 0, 2);\n      }\n    }\n\n    for (var i = 0; i < 3; ++i) {\n      var idx = resultDecodedStorage.currIndex;\n      resultDecodedStorage[idx] = 0;\n      resultDecodedStorage[idx + 1] = 1;\n      resultDecodedStorage[idx + 2] = nbBitsPerValue;\n      resultDecodedStorage[idx + 3] = 0;\n      resultDecodedStorage[idx + 4] = q[i];\n      resultDecodedStorage[idx + 5] = m[i];\n\n      resultDecodedStorage.currIndex += 6;\n    }\n  };\n\n  /**\n   * Decodes nbValues of colorData raw data\n   * according to its max range value\n   * @param  {Uint8Array} colorData encoded raw data\n   * @param  {uint} range max value of the Integere Sequence\n   * @param  {uint} nbValues contains the number of values to decode\n   * @return {array} contains decoded integer\n   */\n  var decodeIntegerSequence = function(colorData, range, nbValues) {\n    var baseIdx = range * 3;\n    var trits = maxWeightQuintsTritsMapper[baseIdx + TRIT_IDX];\n    var quints = maxWeightQuintsTritsMapper[baseIdx + QUINT_IDX];\n    var bits = maxWeightQuintsTritsMapper[baseIdx + BIT_IDX];\n\n    resultDecodedStorage.currIndex = 0;\n\n    var nbDecodedValues = 0;\n    while (nbDecodedValues < nbValues) {\n\n      if (quints === 0 && trits === 0) {\n        var idx = resultDecodedStorage.currIndex;\n        resultDecodedStorage[idx] = trits;\n        resultDecodedStorage[idx + 1] = quints;\n        resultDecodedStorage[idx + 2] = bits;\n        resultDecodedStorage[idx + 3] = 0;\n        resultDecodedStorage[idx + 4] = 0;\n        resultDecodedStorage[idx + 5] = readBits(colorData, 0, colorDataBitsRead, bits);\n        colorDataBitsRead += bits;\n\n        resultDecodedStorage.currIndex += 6;\n\n        nbDecodedValues++;\n      } else if (quints === 1 && trits === 0) {\n        decodeQuint(colorData, bits);\n        nbDecodedValues += 3;\n      } else {\n        decodeTrit(colorData, bits);\n        nbDecodedValues += 5;\n      }\n    }\n  };\n\n  /**\n   * Decodes color from the colorData encoded Integer Sequence\n   * @param  {Uint8Array} colorData encoded color raw data\n   * @param  {array} colorModes contains the color for each partition\n   * @param  {uint} nbPartitions Number of available partitions\n   * @param  {uint} colorDataBits remaining bits number on which color data are encoded\n   * @return {array} decoded endpoints value in the [0...255] range\n   */\n\n  var endpointValuesOutput = new Uint8Array(32);\n\n  var decodeColorValues = function(colorData, colorModes, nbPartitions, colorDataBits) {\n    var trits = 0;\n    var quints = 0;\n    var bits = 0;\n    var i = 0;\n    // Computes the number of endpoint by using the associated class\n    // max endpoint values = 32\n    var nbEndpointValues = 0;\n    for (i = 0; i < nbPartitions; ++i)\n      nbEndpointValues += ((colorModes[i] >> 2) + 1) << 1;\n\n    // Finds the max range for each color endpoints\n    var range = 256;\n    while (--range > 0) {\n\n      var idx = range * 3;\n      trits = maxWeightQuintsTritsMapper[idx + TRIT_IDX];\n      quints = maxWeightQuintsTritsMapper[idx + QUINT_IDX];\n      bits = maxWeightQuintsTritsMapper[idx + BIT_IDX];\n\n      var bitsNbr = getBitsNbrFromEncodedInt(nbEndpointValues, trits, quints, bits);\n      if (bitsNbr <= colorDataBits) {\n        // Some integers share the same encoding\n        // this piece of code finds the smallest one\n        while (--range > 0) {\n          var newIdx = range * 3;\n          var newTrits = maxWeightQuintsTritsMapper[newIdx + TRIT_IDX];\n          var newQuints = maxWeightQuintsTritsMapper[newIdx + QUINT_IDX];\n          var newBits = maxWeightQuintsTritsMapper[newIdx + BIT_IDX];\n\n          if (newTrits !== trits || newQuints !== quints || newBits !== bits)\n            break;\n        }\n\n        range++;\n        break;\n      }\n    }\n\n    // Decodes the integer sequence based on the range and\n    // the number of values\n    var endpointIdx = 0;\n    decodeIntegerSequence(colorData, range, nbEndpointValues);\n\n    for (i = 0; i < nbEndpointValues * 6; i += 6) {\n      var bitLength = resultDecodedStorage[i + BIT_IDX];\n      var bitValue = resultDecodedStorage[i + BIT_IDX + 3];\n\n      // Refers to ASTC specifications(Section 3.11)\n      var result;\n      if (resultDecodedStorage[i + TRIT_IDX]) result = cacheDecodeTrits[bitLength + resultDecodedStorage[i + TRIT_IDX + 3] * 7 + bitValue * 21];\n      else if (resultDecodedStorage[i + QUINT_IDX]) result = cacheDecodeQuints[bitLength + resultDecodedStorage[i + QUINT_IDX + 3] * 6 + bitValue * 30];\n      else result = cacheDecodeSimple[bitLength + bitValue * 9];\n\n      endpointValuesOutput[endpointIdx++] = result;\n    }\n\n    // Makes sure each decoded value is not ambiguous\n    for (i = 0; i < nbEndpointValues; ++i)\n      if (endpointValuesOutput[i] > 255)\n        console.error('Decoded endpoint value can not be above 255.');\n  };\n\n  /**\n   * Computes the two color endpoint values\n   * from the decoded Integer Sequence data\n   * @param  {[type]} endpointColorValues [description]\n   * @param  {[type]} colorMode           [description]\n   */\n  var computeColorEndpointsLDR = function(endpointColorValues, colorMode) {\n    var v = 0;\n    var currIdx = 0;\n\n    switch (colorMode) {\n      case 0:\n        v = readNDecodedColor(endpointColorValues, 2);\n        fillEndpointsWithPixel(0xFF, v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, v[1], v[1], v[1]);\n        endpoints.currIdx += 4;\n        break;\n      case 1:\n        v = readNDecodedColor(endpointColorValues, 2);\n        var L0 = (v[0] >> 2) | (v[1] & 0xC0);\n        var L1 = Math.max(L0 + (v[1] & 0x3F), 0xFF);\n\n        fillEndpointsWithPixel(0xFF, L0, L0, L0);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, L1, L1, L1);\n        endpoints.currIdx += 4;\n        break;\n      case 4:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        fillEndpointsWithPixel(v[2], v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(v[3], v[1], v[1], v[1]);\n        endpoints.currIdx += 4;\n        break;\n      case 5:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n\n        currIdx = endpoints.currIdx;\n\n        fillEndpointsWithPixel(v[2], v[0], v[0], v[0]);\n        endpoints.currIdx += 4;\n\n        fillEndpointsWithPixel(v[2] + v[3], v[0] + v[1], v[0] + v[1], v[0] + v[1]);\n        endpoints.currIdx += 4;\n\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      case 6:\n        v = readNDecodedColor(endpointColorValues, 4);\n\n        fillEndpointsWithPixel(0xFF, v[0] * v[3] >> 8, v[1] * v[3] >> 8, v[2] * v[3] >> 8);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(0xFF, v[0], v[1], v[2]);\n        endpoints.currIdx += 4;\n        break;\n      case 8:\n        v = readNDecodedColor(endpointColorValues, 6);\n        if (v[1] + v[3] + v[5] >= v[0] + v[2] + v[4]) {\n          fillEndpointsWithPixel(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n          fillEndpointsWithPixel(0xFF, v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(0xFF, v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n          blueContract(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        break;\n      case 9:\n        v = readNDecodedColor(endpointColorValues, 6);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n        bitTransferSigned(v, 5, 4);\n\n        currIdx = endpoints.currIdx;\n\n        if (v[1] + v[3] + v[5] >= 0) {\n          fillEndpointsWithPixel(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n\n          fillEndpointsWithPixel(0xFF, v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(0xFF, v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n\n          blueContract(0xFF, v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      case 10:\n        v = readNDecodedColor(endpointColorValues, 6);\n\n        fillEndpointsWithPixel(v[4], v[0] * v[3] >> 8, v[1] * v[3] >> 8, v[2] * v[3] >> 8);\n        endpoints.currIdx += 4;\n        fillEndpointsWithPixel(v[5], v[0], v[1], v[2]);\n        endpoints.currIdx += 4;\n        break;\n      case 12:\n        v = readNDecodedColor(endpointColorValues, 8);\n        if (v[1] + v[3] + v[5] >= v[0] + v[2] + v[4]) {\n          fillEndpointsWithPixel(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n          fillEndpointsWithPixel(v[7], v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(v[7], v[1], v[3], v[5]);\n          endpoints.currIdx += 4;\n          blueContract(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        break;\n      case 13:\n        v = readNDecodedColor(endpointColorValues, 8);\n\n        bitTransferSigned(v, 1, 0);\n        bitTransferSigned(v, 3, 2);\n        bitTransferSigned(v, 5, 4);\n        bitTransferSigned(v, 7, 6);\n\n        currIdx = endpoints.currIdx;\n\n        if (v[1] + v[3] + v[5] >= 0) {\n          fillEndpointsWithPixel(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n\n          fillEndpointsWithPixel(v[7] + v[6], v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n        } else {\n          blueContract(v[6] + v[7], v[0] + v[1], v[2] + v[3], v[4] + v[5]);\n          endpoints.currIdx += 4;\n\n          blueContract(v[6], v[0], v[2], v[4]);\n          endpoints.currIdx += 4;\n        }\n        clampPixel(currIdx);\n        clampPixel(currIdx + 4);\n        break;\n      default:\n        console.error('Unsupported color endpoint mode. Only LDR modes are supported.');\n    }\n  };\n\n  /**\n   * Unquantizes a single texel returning it to a standard\n   * [0...64] range according to its trit/quint/bit encoding\n   * @param  {uint} val the decoded integer\n   * @return {uint} the unquantized weight in the range [0...64]\n   */\n  var unquantizeTexel = function(i) {\n    var bitLength = resultDecodedStorage[i + BIT_IDX];\n    var bitValue = resultDecodedStorage[i + BIT_IDX + 3];\n\n    // Refers to ASTC specifications (Section 3.11)\n    if (resultDecodedStorage[i + TRIT_IDX]) return cacheUnquantizeTrits[bitLength + resultDecodedStorage[i + TRIT_IDX + 3] * 4 + bitValue * 12];\n    if (resultDecodedStorage[i + QUINT_IDX]) return cacheUnquantizeQuints[bitLength + resultDecodedStorage[i + QUINT_IDX + 3] * 3 + bitValue * 15];\n    return cacheUnquantizeSimple[bitLength + bitValue * 8];\n  };\n\n  /**\n   * Returns weights in a standard range [0...64]\n   * @param  {array} weightValues contains the decoded\n   * Integer Sequence of the weight data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} multidimensional array containing the weights\n   * for both planes\n   */\n\n  var unquantizedOutput = new Uint8Array(2 * 144);\n  var infilledWeightsOutput = new Uint8Array(2 * 144);\n\n  var unquantizeWeights = function(blockInfo, blockWidth, blockHeight, nbWeightValues) {\n\n    var bw = blockInfo.width;\n    var bh = blockInfo.height;\n    var bwh = bw * bh;\n\n    var i = 0;\n    var end = 0;\n\n    if (blockInfo.dualPlane) {\n      end = Math.min(nbWeightValues * 2, bwh);\n      for (i = 0; i < end; ++i) {\n        unquantizedOutput[i] = unquantizeTexel(i * 12);\n        unquantizedOutput[i + 144] = unquantizeTexel(i * 12 + 6);\n      }\n\n    } else {\n      // Unquantizes the whole weight grid\n      end = Math.min(nbWeightValues, bwh);\n      for (i = 0; i < end; ++i) {\n        unquantizedOutput[i] = unquantizeTexel(i * 6);\n      }\n    }\n\n    // Applies the weight infill procedure\n    // Refers to ASTC specifications (Section 3.12)\n    // 3D blocks are not handled for the moment\n    var Ds = ((1024 + (blockWidth / 2)) / (blockWidth - 1)) >>> 0;\n    var Dt = ((1024 + (blockHeight / 2)) / (blockHeight - 1)) >>> 0;\n    var dPlane = (blockInfo.dualPlane) ? 2 : 1;\n\n    for (var planeId = 0; planeId < dPlane; ++planeId) {\n      var idp = planeId * 144;\n      for (var t = 0; t < blockHeight; ++t) {\n        for (var s = 0; s < blockWidth; ++s) {\n          var cs = Ds * s;\n          var ct = Dt * t;\n\n          var gs = (cs * (bw - 1) + 32) >> 6;\n          var gt = (ct * (bh - 1) + 32) >> 6;\n\n          var js = gs >> 4;\n          var fs = gs & 0xF;\n\n          var jt = gt >> 4;\n          var ft = gt & 0x0F;\n\n          var w11 = (fs * ft + 8) >> 4;\n          var w10 = (ft - w11) >>> 0;\n          var w01 = (fs - w11) >>> 0;\n          var w00 = (16 - fs - ft + w11) >>> 0;\n\n          var v0 = js + jt * bw;\n\n          var val = 8;\n          var vid = v0;\n          if (vid < bwh) val += w00 * unquantizedOutput[vid + idp];\n\n          vid = v0 + 1;\n          if (vid < bwh) val += w01 * unquantizedOutput[vid + idp];\n\n          vid = v0 + bw;\n          if (vid < bwh) val += w10 * unquantizedOutput[vid + idp];\n\n          vid = v0 + bw + 1;\n          if (vid < bwh) val += w11 * unquantizedOutput[vid + idp];\n\n          infilledWeightsOutput[t * blockWidth + s + idp] = val >> 4;\n        }\n      }\n    }\n  };\n\n  /**\n   * Decompresses a single void-extent block,\n   * in other words, a block containing only one color\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var decompressVoidExtent = function(u8buffer, blockId, blockInfo, blockWidth, blockHeight) {\n    // Do not read extra data\n    bitsReadCount += 53;\n\n    var r16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var g16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var b16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n    var a16 = readBits(u8buffer, blockId, bitsReadCount, 16);\n    bitsReadCount += 16;\n\n    if (bitsReadCount !== 128)\n      console.error('Invalid void-extent bits reading.');\n\n    var nbPixel = blockWidth * blockHeight * 4;\n    for (var i = 0; i < nbPixel; i += 4) {\n      blockPixelsOutput[i] = extractBits(a16, 0, 7);\n      blockPixelsOutput[i + 1] = extractBits(r16, 0, 7);\n      blockPixelsOutput[i + 2] = extractBits(g16, 0, 7);\n      blockPixelsOutput[i + 3] = extractBits(b16, 0, 7);\n    }\n  };\n\n  /**\n   * Decompresses a single block by returning\n   * the error color (0xFF, 0xFF, 0x00, 0xFF)\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var getErrorPixelBlock = function(blockWidth, blockHeight) {\n    var nbPixel = blockWidth * blockHeight * 4;\n    for (var i = 0; i < nbPixel; i += 4) {\n      blockPixelsOutput[i] = 0xFF;\n      blockPixelsOutput[i + 1] = 0xFF;\n      blockPixelsOutput[i + 2] = 0x00;\n      blockPixelsOutput[i + 3] = 0xFF;\n    }\n  };\n\n  /**\n   * Decompresses a single block by retrieving\n   * the block layout as well as the number of partitions,\n   * the color endpoints and weights data.\n   * @param  {Uint8Array} u8buffer the ASTC raw data\n   * @param  {uint} blockId the current block index\n   * @param  {uint} blockWidth the width of the blocks\n   * @param  {uint} blockHeight the height of the blocks\n   * @return {array} containing blockWidth * blockHeight Pixels\n   */\n  var decompressBlock = function(u8buffer, blockId, blockWidth, blockHeight) {\n    bitsReadCount = 0;\n    bitsWrittenCount = 0;\n    colorDataBitsRead = 0;\n    decodedColorValuesIdx = 0;\n\n    var i = 0;\n    var CEM = 0;\n    var blockInfo = getBlockInfo(u8buffer, blockId);\n\n    if (blockInfo.error)\n      return getErrorPixelBlock(blockWidth, blockHeight);\n\n    // Handles the case whenever the block is filled with only one color\n    if (blockInfo.isVoidExtent)\n      return decompressVoidExtent(u8buffer, blockId, blockInfo, blockWidth, blockHeight);\n\n    if (blockInfo.width > blockWidth)\n      console.error('Texel weight grid width can not be larger than the block width.');\n    if (blockInfo.height > blockHeight)\n      console.error('Texel weight grid height can not be larger than the block height.');\n\n    // Extracts the partitions number\n    var nbPartitions = readBits(u8buffer, blockId, bitsReadCount, 2) + 1;\n    bitsReadCount += 2;\n\n    if (nbPartitions > 4)\n      console.error('The block partitions number is too high.');\n    if (nbPartitions === 4 && blockInfo.dualPlane)\n      return getErrorPixelBlock(blockWidth, blockHeight);\n\n    // Reads the extra configuration field\n    // At most 4 modes describing how color data is encoded\n    var colorEndpointModes = [0, 0, 0, 0];\n    var partitionIndex = -1;\n    var planeIndex = -1;\n    var cemBits = 0;\n    if (nbPartitions === 1) {\n      colorEndpointModes[0] = readBits(u8buffer, blockId, bitsReadCount, 4);\n      bitsReadCount += 4;\n      partitionIndex = 0;\n    } else {\n      // Reads 10 bits containing the partition index\n      partitionIndex = readBits(u8buffer, blockId, bitsReadCount, 10);\n      bitsReadCount += 10;\n      // Reads 6 bits containing the cem extra\n      cemBits = readBits(u8buffer, blockId, bitsReadCount, 6);\n      bitsReadCount += 6;\n    }\n    var baseMode = (cemBits & 3);\n\n    // Computes remaining bits containing color endpoint data\n    //var numberWeightBits = getPackedBitSize(blockInfo);\n    var remainingBits = 128 - getPackedBitSize(blockInfo) - bitsReadCount;\n    var dualPlaneSelectorBits = (blockInfo.dualPlane) ? 2 : 0;\n    remainingBits -= dualPlaneSelectorBits;\n\n    // Gets extra bits number according to CEM\n    // mode 0 does not need any extra CEM bits\n    var extraCEMbitsNb = 0;\n    if (baseMode) {\n      if (nbPartitions === 2)\n        extraCEMbitsNb = 2;\n      else if (nbPartitions === 3)\n        extraCEMbitsNb = 5;\n      else if (nbPartitions === 4)\n        extraCEMbitsNb = 8;\n    }\n    remainingBits -= extraCEMbitsNb;\n\n    // Reads color data\n    // read data are written to a buffer for later use\n    var colorDataBits = remainingBits;\n    for (i = 0; i < 16; ++i)\n      colorEndpointData[i] = 0;\n\n    while (remainingBits > 0) {\n      var bitsNb = Math.min(remainingBits, 8);\n      var bits = readBits(u8buffer, blockId, bitsReadCount, bitsNb);\n      bitsReadCount += bitsNb;\n\n      writeBits(colorEndpointData, bits, bitsNb, bitsWrittenCount);\n      bitsWrittenCount += bitsNb;\n\n      remainingBits -= 8;\n    }\n\n    planeIndex = readBits(u8buffer, blockId, bitsReadCount, dualPlaneSelectorBits);\n    bitsReadCount += dualPlaneSelectorBits;\n\n    // Reads extra CEM data\n    if (baseMode) {\n      var extraCEMbits = readBits(u8buffer, blockId, bitsReadCount, extraCEMbitsNb);\n      bitsReadCount += extraCEMbitsNb;\n\n      CEM = (extraCEMbits << 6) | cemBits;\n      CEM >>= 2;\n\n      // Extracts the class selector bit by bit\n      var C = classSelectorBitsArray;\n      var M = colorModeLSB;\n      for (i = 0; i < nbPartitions; ++i) {\n        C[i] = CEM & 1;\n        CEM >>= 1;\n      }\n      // Extracts the color endoint mode low bits\n      /*for (i = 0; i < nbPartitions; ++i) {\n        M[i] = CEM & 3;\n        CEM >>= 2;\n        if (M[i] > 3)\n          console.error(  'Error while extracting the color endpoint mode LSB.'); \n      }*/\n      for (i = 0; i < nbPartitions; ++i) {\n        M[i] = CEM & 3;\n        CEM >>= 2;\n        if (M[i] > 3)\n          console.error('Error while extracting the color endpoint mode LSB.');\n\n        colorEndpointModes[i] = baseMode;\n        if (!(C[i]))\n          colorEndpointModes[i] -= 1;\n        colorEndpointModes[i] <<= 2;\n        colorEndpointModes[i] |= M[i];\n      }\n    } else if (nbPartitions > 1) {\n      CEM = cemBits >> 2;\n      for (i = 0; i < nbPartitions; ++i)\n        colorEndpointModes[i] = CEM;\n    }\n\n    // Makes sure the extracted data obtained until here is correct\n    var blockBitsRead = bitsReadCount + getPackedBitSize(blockInfo);\n\n    for (i = 0; i < nbPartitions; ++i)\n      if (colorEndpointModes[i] >= 16)\n        console.error('The color endpoint mode ' + colorEndpointModes[i] + ' is not correct.');\n\n    if (blockBitsRead < 128)\n      console.error('The current block as not been read entirely. (' + blockBitsRead + ' read)');\n    else if (blockBitsRead > 128)\n      console.error('Too many bits have been read for the current block. (' + blockBitsRead + ' read)');\n\n    // Decodes color data\n    decodeColorValues(colorEndpointData, colorEndpointModes, nbPartitions, colorDataBits);\n\n    // Computes endpoint for all partitions\n    endpoints.currIdx = 0;\n    for (i = 0; i < nbPartitions; i++)\n      computeColorEndpointsLDR(endpointValuesOutput, colorEndpointModes[i]);\n\n    // Reads remaining bits containing packed texel weight data\n    // This code can be factorized with the color data reading above\n    var texelWeightDataIndex = 0;\n    for (i = 0; i < 16; ++i)\n      texelWeightData[texelWeightDataIndex++] = u8buffer[blockId + i];\n\n    // Reverses the textWeightData array\n    // and each byte\n    reverseU8Array(texelWeightData);\n\n    var weightPackedSize = getPackedBitSize(blockInfo);\n    var clearByteStart = (weightPackedSize >> 3) + 1;\n    var nbBytesToClean = 16 - clearByteStart;\n    texelWeightData[clearByteStart - 1] &= (1 << (weightPackedSize % 8)) - 1;\n    for (i = 0; i < nbBytesToClean; ++i)\n      texelWeightData[clearByteStart + i] = 0;\n\n    // Decodes the weight\n    colorDataBitsRead = 0;\n    var nbWeightValues = getNumberWeightValues(blockInfo);\n    decodeIntegerSequence(texelWeightData, blockInfo.maxWeight, nbWeightValues);\n\n    unquantizeWeights(blockInfo, blockWidth, blockHeight, nbWeightValues);\n\n    // Interpolates colors\n    var smallBlock = (blockHeight * blockWidth) < 32;\n    var rnum = precomputeSelectPartition(partitionIndex, nbPartitions);\n    for (var j = 0; j < blockHeight; j++) {\n      for (i = 0; i < blockWidth; i++) {\n        var partition = selectPartition(rnum, i, j, 0, nbPartitions, smallBlock);\n        if (partition >= nbPartitions)\n          console.error('The block partition index can not be larger or equal to the number of partitions.');\n\n        var rowIndex = (j * blockWidth + i) * 4;\n        var endpointBaseIdx = partition * 8;\n        for (var c = 0; c < 4; ++c) {\n          var C0 = endpoints[endpointBaseIdx + c] >>> 0;\n          C0 = replicateBits0816Map[C0];\n\n          var C1 = endpoints[endpointBaseIdx + c + 4] >>> 0;\n          C1 = replicateBits0816Map[C1];\n\n          var plane = 0 >>> 0;\n          if (blockInfo.dualPlane && (((planeIndex + 1) & 3) === c))\n            plane = 1;\n\n          var weight = infilledWeightsOutput[j * blockWidth + i + plane * 144];\n          var color = Math.floor(((C0 * (64 - weight) + C1 * weight + 32) / 64));\n\n          if (color === 65535)\n            blockPixelsOutput[rowIndex + c] = 255;\n          else\n            blockPixelsOutput[rowIndex + c] = Math.round(255.0 * (color / 65536.0));\n        }\n      }\n    }\n  };\n\n  /**\n   * Decompresses a complete buffer containing ASTC file raw data\n   * @param  {ArrayBuffer} contains the compressed ASTC raw data\n   * @return {Object} contains the uncompressed image buffer\n   * as well as the image dimensions\n   */\n  // TODO export\n  var decompress = function(imgBuffer) {\n    var u8buffer = new Uint8Array(imgBuffer);\n\n    // Retrieves the header\n    var header = parseHeader(imgBuffer);\n\n    var imgWidth = header.xSize;\n    var imgHeight = header.ySize;\n    var halfImgHeight = (imgHeight >> 1);\n\n    var blockWidth = header.blockDimX;\n    var blockHeight = header.blockDimY;\n\n    var firstBlockIndex = 16;\n    var blockNb = 0;\n\n    // Initializes temp storages used\n    // in helper functions\n    blockPixelsOutput = new Uint8Array(blockWidth * blockHeight * 4);\n\n    var j = 0;\n    var i = 0;\n    var resultImg = new Uint8ClampedArray(imgWidth * imgHeight * 4);\n\n    for (j = 0; j < imgHeight; j += blockHeight) {\n      for (i = 0; i < imgWidth; i += blockWidth) {\n\n        var currentBlockIndex = firstBlockIndex + blockNb * 16;\n        // Decompresses the current block\n        decompressBlock(u8buffer, currentBlockIndex, blockWidth, blockHeight);\n\n        var widthBound = Math.min(blockWidth, imgWidth - i);\n        var heightBound = Math.min(blockHeight, imgHeight - j);\n        var rowIndex = (j * imgWidth + i) * 4;\n        for (var jj = 0; jj < heightBound; jj++) {\n          var destId = rowIndex + jj * imgWidth * 4;\n          var srcId = jj * blockWidth * 4;\n\n          for (var x = 0; x < widthBound * 4; x += 4) {\n            resultImg[destId + x] = blockPixelsOutput[srcId + x + 1];\n            resultImg[destId + x + 1] = blockPixelsOutput[srcId + x + 2];\n            resultImg[destId + x + 2] = blockPixelsOutput[srcId + x + 3];\n            resultImg[destId + x + 3] = blockPixelsOutput[srcId + x];\n          }\n        }\n\n        ++blockNb;\n      }\n    }\n\n    // Flips the image using the Y-axis\n    for (j = 0; j < halfImgHeight; j++) {\n      for (i = 0; i < imgWidth; i++) {\n        var beginByte = (j * imgWidth + i) * 4;\n        var endByte = ((imgHeight - j - 1) * imgWidth + i) * 4;\n\n        swapCell(resultImg, beginByte, endByte);\n        swapCell(resultImg, beginByte + 1, endByte + 1);\n        swapCell(resultImg, beginByte + 2, endByte + 2);\n        swapCell(resultImg, beginByte + 3, endByte + 3);\n      }\n    }\n\n    var result = {};\n    result.img = resultImg;\n    result.width = imgWidth;\n    result.height = imgHeight;\n\n    return result;\n  };\n\n  module.exports = {\n    decompress: decompress\n  };\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n  'use strict';\n\n  var replicateBits = __webpack_require__(3).replicateBits;\n\n  // Describes how to unpack trit/quint\n  // with no additional bits\n  var WEIGHT_TRIT_RANGE = [0, 32, 63];\n  var WEIGHT_QUINT_RANGE = [0, 16, 32, 47, 63];\n\n  ///////////////////\n  // CACHE UNQUANTIZE\n  ///////////////////\n\n  // -----------------\n  // UNQUANTIZE SIMPLE\n  // -----------------\n  var cacheUnquantizeSimple = new Uint8Array(256 * 8);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var bitLength = 1; bitLength < 8; ++bitLength) {\n\n      var result = replicateBits(bitValue, bitLength, 6);\n      if (result > 32) result++;\n\n      cacheUnquantizeSimple[bitLength + bitValue * 8] = result;\n    }\n  }\n\n  // ----------------\n  // UNQUANTIZE TRITS\n  // ----------------\n  var cacheUnquantizeTrits = new Uint8Array(256 * 3 * 4);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var tri = 0; tri < 3; ++tri) {\n      for (var bitLength = 0; bitLength < 4; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 0:\n            result = WEIGHT_TRIT_RANGE[tri];\n            break;\n          case 1:\n            C = 50;\n            break;\n          case 2:\n            C = 23;\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 6) | (bBit << 2) | bBit;\n            break;\n          case 3:\n            C = 11;\n            var cbBits = (bitValue >> 1) & 3;\n            B = (cbBits << 5) | cbBits;\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 127 : 0;\n          result = tri * C + B;\n          result ^= A;\n          result = (A & 0x20) | (result >> 2);\n        }\n\n        if (result > 32) result++;\n\n        cacheUnquantizeTrits[bitLength + tri * 4 + bitValue * 12] = result;\n      }\n    }\n  }\n\n  // -----------------\n  // UNQUANTIZE QUINTS\n  // -----------------\n  var cacheUnquantizeQuints = new Uint8Array(256 * 5 * 3);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var quint = 0; quint < 5; ++quint) {\n      for (var bitLength = 0; bitLength < 3; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 0:\n            result = WEIGHT_QUINT_RANGE[quint];\n            break;\n          case 1:\n            C = 28;\n            break;\n          case 2:\n            C = 13;\n            var bBits = (bitValue >> 1) & 1;\n            B = (bBits << 6) | (bBits << 1);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 127 : 0;\n          result = quint * C + B;\n          result ^= A;\n          result = (A & 0x20) | (result >> 2);\n        }\n\n        if (result > 32) result++;\n\n        cacheUnquantizeQuints[bitLength + quint * 3 + bitValue * 15] = result;\n      }\n    }\n  }\n\n  ///////////////\n  // CACHE DECODE\n  ///////////////\n\n  // -------------\n  // DECODE SIMPLE\n  // -------------\n  var cacheDecodeSimple = new Uint8Array(256 * 9);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var bitLength = 1; bitLength < 9; ++bitLength) {\n      cacheDecodeSimple[bitLength + bitValue * 9] = replicateBits(bitValue, bitLength, 8);\n    }\n  }\n\n  // ----------------\n  // UNQUANTIZE TRITS\n  // ----------------\n  var cacheDecodeTrits = new Uint8Array(256 * 3 * 7);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var tri = 0; tri < 3; ++tri) {\n      for (var bitLength = 0; bitLength < 7; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 1:\n            C = 204;\n            break;\n          case 2:\n            C = 93;\n            // b000b0bb0\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 8) | (bBit << 4) | (bBit << 2) | (bBit << 1);\n            break;\n          case 3:\n            C = 44;\n            // cb000cbcb\n            var cbBit = (bitValue >> 1) & 3;\n            B = (cbBit << 7) | (cbBit << 2) | cbBit;\n            break;\n          case 4:\n            C = 22;\n            // dcb000dcb\n            var dcbBit = (bitValue >> 1) & 7;\n            B = (dcbBit << 6) | dcbBit;\n            break;\n          case 5:\n            C = 11;\n            // edcb000ed\n            var edcbBit = (bitValue >> 1) & 0xF;\n            B = (edcbBit << 5) | (edcbBit >> 2);\n            break;\n          case 6:\n            C = 5;\n            // fedcb000f\n            var fedcbBit = (bitValue >> 1) & 0x1F;\n            B = (fedcbBit << 4) | (fedcbBit >> 4);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 511 : 0;\n          result = (tri * C + B) >>> 0;\n          result ^= A;\n          result = (A & 0x80) | (result >> 2);\n        }\n\n        cacheDecodeTrits[bitLength + tri * 7 + bitValue * 21] = result;\n      }\n    }\n  }\n\n  // -----------------\n  // UNQUANTIZE QUINTS\n  // -----------------\n  var cacheDecodeQuints = new Uint8Array(256 * 5 * 6);\n  for (var bitValue = 0; bitValue < 256; ++bitValue) {\n    for (var quint = 0; quint < 5; ++quint) {\n      for (var bitLength = 0; bitLength < 6; ++bitLength) {\n\n        var C = 0;\n        var B = 0;\n        var result;\n        switch (bitLength) {\n          case 1:\n            C = 113;\n            break;\n          case 2:\n            C = 54;\n            // b0000bb00\n            var bBit = (bitValue >> 1) & 1;\n            B = (bBit << 8) | (bBit << 3) | (bBit << 2);\n            break;\n          case 3:\n            C = 26;\n            // cb0000cbc\n            var cbBit = (bitValue >> 1) & 3;\n            B = (cbBit << 7) | (cbBit << 1) | (cbBit >> 1);\n            break;\n          case 4:\n            C = 13;\n            // dcb0000dc\n            var dcbBit = (bitValue >> 1) & 7;\n            B = (dcbBit << 6) | (dcbBit >> 1);\n            break;\n          case 5:\n            C = 6;\n            // edcb0000e\n            var edcbBit = (bitValue >> 1) & 0xF;\n            B = (edcbBit << 5) | (edcbBit >> 3);\n            break;\n        }\n\n        if (bitLength > 0) {\n          var A = bitValue % 2 ? 511 : 0;\n          result = (quint * C + B) >>> 0;\n          result ^= A;\n          result = (A & 0x80) | (result >> 2);\n        }\n\n        cacheDecodeQuints[bitLength + quint * 6 + bitValue * 30] = result;\n      }\n    }\n  }\n\n\n  // TOTO module exports\n  module.exports = {\n    cacheUnquantizeSimple: cacheUnquantizeSimple,\n    cacheUnquantizeTrits: cacheUnquantizeTrits,\n    cacheUnquantizeQuints: cacheUnquantizeQuints,\n    cacheDecodeSimple: cacheDecodeSimple,\n    cacheDecodeTrits: cacheDecodeTrits,\n    cacheDecodeQuints: cacheDecodeQuints\n  };\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n  'use strict';\n\n  /**\n   * Creates a binary mask between two given bounds\n   * @param  {int} a starting bit\n   * @param  {int} b ending bit\n   * @return {int} mask integer containing binary 1 between a and b\n   */\n  var createMask = function(a, b) {\n    var r = 0;\n    for (var i = a; i <= b; ++i)\n      r |= 1 << i;\n\n    return r;\n  };\n\n  /**\n   * Applies the Hamming weight algorithm: looks for the number of bits set to 1\n   * @param  {int} value\n   * @return {int} the number of bits set to 1\n   */\n  var popCount = function(value) {\n    var i = 0;\n    for (; value; ++i)\n      value &= value - 1;\n    return i;\n  };\n\n  /**\n   * Extracts bits from a bounded range\n   * @param  {int} value representing the integer value where the bits are extracted\n   * @param  {int} start the index of the starting bit\n   * @param  {int} stop  the index of the ending bit\n   * @return {int} the integer composed by the extracted bits\n   */\n  var extractBits = function(value, start, stop) {\n    return (value & createMask(start, stop)) >> start;\n  };\n\n\n  /**\n   * Replicates the n lower bits until the given bit index\n   * @param  {int} val contains the bits to replicate\n   * @param  {int} bitsNb describes the number of lower bits to replicate\n   * @param  {int} endBit the \"index\" of the included final bit\n   * @return {int} result containing a number made of the replicated bits\n   */\n  var replicateBits = function(val, bitsNb, endBit) {\n    // Extracts the bitsNb lower bits from the val value\n    var extractedBits = val & ((1 << bitsNb) - 1);\n    var result = extractedBits;\n    var resultLength = bitsNb;\n\n    while (resultLength < endBit) {\n\n      var extractedBitsShift = 0;\n      if (bitsNb > endBit - resultLength) {\n        var newShift = endBit - resultLength;\n        extractedBitsShift = bitsNb - newShift;\n        bitsNb = newShift;\n      }\n\n      // Shifts the result to \"add\" the pattern\n      result <<= bitsNb;\n      result |= extractedBits >> extractedBitsShift;\n      resultLength += bitsNb;\n    }\n\n    return result;\n  };\n\n  /**\n   * Transfers one bit from an integer to another\n   * @param  {array} array containing the two cells to transfer\n   * @param  {uint} i1 the index of the first cell\n   * @param  {uint} i2 the index of the second cell\n   */\n  var bitTransferSigned = function(array, i1, i2) {\n    var a = array[i1];\n    var b = array[i2];\n\n    b >>= 1;\n    b |= a & 0x80;\n    a >>= 1;\n    a &= 0x3F;\n    if (a & 0x20)\n      a -= 0x40;\n\n    array[i1] = a;\n    array[i2] = b;\n  };\n\n  /**\n   * Reads at most 30 bits from the given U8Int array\n   * @param  {U8IntArray} u8buffer buffer containing data to read\n   * @param  {int} beginByteId first byte at which the reading should begin\n   * @param  {int} bitsOffset nth bits at which the reading should begin\n   * @param  {int} bitsNb number of bits to read\n   * @return {int} an integer containing the read bits\n   */\n  var readBits = function(u8buffer, beginByteId, bitsOffset, bitsNb) {\n    if (bitsNb > 30)\n      console.error('The reader can not read more than 30 bits in a row.');\n    if (bitsNb <= 0)\n      return 0;\n\n    // Updates the total number of extracted bits\n    // for the current block\n    //bitsReadCount += bitsNb;\n\n    var bitsReadResult = 0;\n    var offsetByteId = beginByteId + Math.floor(bitsOffset / 8);\n    var endByteId = beginByteId + Math.floor((bitsOffset + bitsNb) / 8);\n    var bornInfBit = bitsOffset % 8;\n    var bornSupBit = (bitsOffset + bitsNb - 1) % 8;\n\n    // Simple reading where data lies on the same byte\n    if (offsetByteId === endByteId)\n      return (u8buffer[offsetByteId] & createMask(bornInfBit, bornSupBit)) >> bornInfBit;\n\n    // Recreates the integer by shifting bytes\n    // the created integer is at most a 24bits integer\n    var shift = 8;\n    bitsReadResult += u8buffer[offsetByteId];\n    for (var i = offsetByteId + 1; i <= endByteId; ++i) {\n      bitsReadResult += u8buffer[i] << shift;\n      shift *= 2;\n    }\n\n    bitsReadResult = (bitsReadResult & createMask(bornInfBit, bornInfBit + bitsNb - 1)) >> bornInfBit;\n\n    return bitsReadResult;\n  };\n\n  /**\n   * Write a given value in colorEndpointData at the byte index\n   * computed from the number of bits currently written.\n   * It is important to note that the number of bits to write in\n   * a row never exceed the size of a byte (8 bits)\n   * @param  {Uint8Array} colorEndpointData destination byte array\n   * @param  {int} bits the value to write\n   * @param  {uint} bitsNb the number of bits to write\n   * @param  {uint} bitsWritten the current number of bits written\n   */\n  var writeBits = function(colorEndpointData, bits, bitsNb, bitsWritten) {\n    colorEndpointData[Math.floor(bitsWritten / 8)] = bits;\n  };\n\n  /**\n   * Reverses the bits in a byte\n   * @param  {uint8} b the byte to reverse\n   * @return {uint32} the reversed byte not casted\n   */\n  var reverseByte = function(b) {\n    // Converts x to a 32 bits unsigned integer\n    b = b >>> 0;\n    return ((b * 0x0802 & 0x22110) | (b * 0x8020 & 0x88440)) * 0x10101 >> 16;\n  };\n\n  /**\n   * Reverses each byte just as the global bytes order\n   * @param  {Uint8Array} u8array the array to reverse\n   */\n  var reverseU8Array = function(u8array) {\n    for (var i = 0; i < u8array.length / 2; ++i) {\n      var a = reverseByte(u8array[i]);\n      var b = reverseByte(u8array[u8array.length - 1 - i]);\n\n      u8array[i] = b;\n      u8array[u8array.length - 1 - i] = a;\n    }\n  };\n\n  module.exports = {\n    popCount: popCount,\n    readBits: readBits,\n    writeBits: writeBits,\n    extractBits: extractBits,\n    replicateBits: replicateBits,\n    bitTransferSigned: bitTransferSigned,\n    reverseU8Array: reverseU8Array\n  };\n\n/***/ }\n/******/ ])\n});\n;"},function(e,t){e.exports="vec3 getScale( const in mat4 matrix ) {\n      // Only working with positive scales.\n      float xs = matrix[0][0] * matrix[0][1] * matrix[0][2] * matrix[0][3] < 0. ? -1. : 1.;\n      float ys = matrix[1][0] * matrix[1][1] * matrix[1][2] * matrix[1][3] < 0. ? -1. : 1.;\n      float zs = matrix[2][0] * matrix[2][1] * matrix[2][2] * matrix[2][3] < 0. ? -1. : 1.;\n      vec3 scale;\n      scale.x = xs * sqrt( matrix[0][0] * matrix[0][0] + matrix[0][1] * matrix[0][1] + matrix[0][2] * matrix[0][2]);\n      scale.y = ys * sqrt( matrix[1][0] * matrix[1][0] + matrix[1][1] * matrix[1][1] + matrix[1][2] * matrix[1][2]);\n      scale.z = zs * sqrt( matrix[2][0] * matrix[2][0] + matrix[2][1] * matrix[2][1] + matrix[2][2] * matrix[2][2]);\n      return scale;\n}\n\nvec4 billboard( const in vec3 vertex, const in mat4 modelViewMatrix, const in mat4 projectionMatrix ) {\n      vec3 scale = getScale( modelViewMatrix );\n      return projectionMatrix * ( vec4( scale.x* vertex.x , scale.y * vertex.y, scale.z * vertex.z, 1.0 ) + vec4( modelViewMatrix[ 3 ].xyz, 0.0 ) );\n}\n"},function(e,t){e.exports="\nfloat decodeFloatRGBA( vec4 rgba ) {\n    return dot( rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0) );\n}\n\nvec4 encodeFloatRGBA( float v ) {\n    vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\n    enc = fract(enc);\n    enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\n    return enc;\n}\n\nvec2 decodeHalfFloatRGBA( vec4 rgba ) {\n    return vec2(rgba.x + (rgba.y / 255.0), rgba.z + (rgba.w / 255.0));\n}\n\nvec4 encodeHalfFloatRGBA( vec2 v ) {\n    const vec2 bias = vec2(1.0 / 255.0, 0.0);\n    vec4 enc;\n    enc.xy = vec2(v.x, fract(v.x * 255.0));\n    enc.xy = enc.xy - (enc.yy * bias);\n\n    enc.zw = vec2(v.y, fract(v.y * 255.0));\n    enc.zw = enc.zw - (enc.ww * bias);\n    return enc;\n}\n"},function(e,t){e.exports="// the approximation :\n// http://chilliant.blogspot.fr/2012/08/srgb-approximations-for-hlsl.html\n// introduced slightly darker colors and more slight banding in the darks.\n// The reference implementation (or even a single pow approx) did not introduced these effects.\n\n// so for now we stick with the reference implementation :\n// https://www.khronos.org/registry/gles/extensions/EXT/EXT_sRGB.txt\n// with the slight changes :\n// - we always assume the color is >= 0.0 (so no check)\n// - unlike the previous approximation, linear to srgb is monotonic so we don't need to check if the color is > 1\n\n#define LIN_SRGB(x) x < 0.0031308 ? x * 12.92 : 1.055 * pow(x, 1.0/2.4) - 0.055\nfloat linearTosRGB(const in float c) {\n    return LIN_SRGB(c);\n}\nvec3 linearTosRGB(const in vec3 c) {\n    return vec3(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b));\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(LIN_SRGB(c.r), LIN_SRGB(c.g), LIN_SRGB(c.b), c.a);\n}\n\n#define SRGB_LIN(x) x < 0.04045 ? x * (1.0 / 12.92) : pow((x + 0.055) * (1.0 / 1.055), 2.4)\nfloat sRGBToLinear(const in float c) {\n    return SRGB_LIN(c);\n}\nvec3 sRGBToLinear(const in vec3 c) {\n    return vec3(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b));\n}\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(SRGB_LIN(c.r), SRGB_LIN(c.g), SRGB_LIN(c.b), c.a);\n}\n\n//http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec3 RGBMToRGB( const in vec4 rgba ) {\n    const float maxRange = 8.0;\n    return rgba.rgb * maxRange * rgba.a;\n}\n\nconst mat3 LUVInverse = mat3( 6.0013,    -2.700,   -1.7995,\n                              -1.332,    3.1029,   -5.7720,\n                              0.3007,    -1.088,    5.6268 );\n\nvec3 LUVToRGB( const in vec4 vLogLuv ) {\n    float Le = vLogLuv.z * 255.0 + vLogLuv.w;\n    vec3 Xp_Y_XYZp;\n    Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n    Xp_Y_XYZp.z = Xp_Y_XYZp.y / vLogLuv.y;\n    Xp_Y_XYZp.x = vLogLuv.x * Xp_Y_XYZp.z;\n    vec3 vRGB = LUVInverse * Xp_Y_XYZp;\n    return max(vRGB, 0.0);\n}\n\n// http://graphicrants.blogspot.fr/2009/04/rgbm-color-encoding.html\nvec4 encodeRGBM(const in vec3 col, const in float range) {\n    if(range <= 0.0)\n        return vec4(col, 1.0);\n    vec4 rgbm;\n    vec3 color = col / range;\n    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );\n    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;\n    rgbm.rgb = color / rgbm.a;\n    return rgbm;\n}\n\nvec3 decodeRGBM(const in vec4 col, const in float range) {\n    if(range <= 0.0)\n        return col.rgb;\n    return range * col.rgb * col.a;\n}"},function(e,t){e.exports="////////////////\n// ATTENUATION\n/////////////\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation) {\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\n    // TODO find a vector alu instead of 4 scalar\n    float constant = lightAttenuation.x;\n    float linear = lightAttenuation.y*dist;\n    float quadratic = lightAttenuation.z*dist*dist;\n    return 1.0 / ( constant + linear + quadratic );\n}\n//\n// LIGHTING EQUATION TERMS\n///\nvoid specularCookTorrance(const in vec3 n, const in vec3 l, const in vec3 v, const in float hard, const in vec3 materialSpecular, const in vec3 lightSpecular, out vec3 specularContrib) {\n    vec3 h = normalize(v + l);\n    float nh = dot(n, h);\n    float specfac = 0.0;\n\n    if(nh > 0.0) {\n        float nv = max( dot(n, v), 0.0 );\n        float i = pow(nh, hard);\n        i = i / (0.1 + nv);\n        specfac = i;\n    }\n    // ugly way to fake an energy conservation (mainly to avoid super bright stuffs with low glossiness)\n    float att = hard > 100.0 ? 1.0 : smoothstep(0.0, 1.0, hard * 0.01);\n    specularContrib = specfac*materialSpecular*lightSpecular*att;\n}\n\nvoid lambert(const in float ndl,  const in vec3 materialDiffuse, const in vec3 lightDiffuse, out vec3 diffuseContrib) {\n    diffuseContrib = ndl*materialDiffuse*lightDiffuse;\n}\n////////////////////////\n/// Main func\n///////////////////////\n\n/// for each light\n//direction, dist, NDL, attenuation, compute diffuse, compute specular\n\nvec3 computeSpotLightShading(\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightDiffuse,\n    const in vec3 lightSpecular,\n    const in vec3  lightSpotDirection,\n    const in vec4  lightAttenuation,\n    const in vec4  lightSpotPosition,\n    const in float lightCosSpotCutoff,\n    const in float lightSpotBlend,\n    const in mat4 lightMatrix,\n    const in mat4 lightInvMatrix,\n\n    out bool lighted) {\n\n    lighted = false;\n    vec3 eyeLightPos = vec3(lightMatrix * lightSpotPosition);\n    vec3 eyeLightDir = eyeLightPos - vViewVertex.xyz;\n    // compute dist\n    float dist = length(eyeLightDir);\n    // compute attenuation\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\n    if (attenuation != 0.0) {\n        // compute direction\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n        if (lightCosSpotCutoff > 0.0) {\n            //compute lightSpotBlend\n            vec3 lightSpotDirectionEye = normalize(mat3(vec3(lightInvMatrix[0]), vec3(lightInvMatrix[1]), vec3(lightInvMatrix[2]))*lightSpotDirection);\n\n            float cosCurAngle = dot(-eyeLightDir, lightSpotDirectionEye);\n            float diffAngle = cosCurAngle - lightCosSpotCutoff;\n            float spot = 1.0;\n            if ( diffAngle < 0.0 ) {\n                spot = 0.0;\n            } else if ( lightSpotBlend > 0.0 ) {\n                spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightCosSpotCutoff) / (lightSpotBlend));\n            }\n\n            if (spot > 0.0) {\n                // compute NdL\n                float NdotL = dot(eyeLightDir, normal);\n                if (NdotL > 0.0) {\n                    lighted = true;\n                    vec3 diffuseContrib;\n                    lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n                    vec3 specularContrib;\n                    specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n                    return spot * attenuation * (diffuseContrib + specularContrib);\n                }\n            }\n        }\n    }\n\n    return vec3(0.0);\n}\n\nvec3 computePointLightShading(\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightDiffuse,\n    const in vec3 lightSpecular,\n    const in vec4 lightPosition,\n    const in vec4 lightAttenuation,\n    const in mat4 lightMatrix,\n\n    out bool lighted) {\n\n    lighted = false;\n    vec3 eyeLightPos =  vec3(lightMatrix * lightPosition);\n    vec3 eyeLightDir = eyeLightPos - vViewVertex.xyz;\n    float dist = length(eyeLightDir);\n    // compute dist\n    // compute attenuation\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\n    if (attenuation != 0.0) {\n        // compute direction\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\n        // compute NdL\n        float NdotL = dot(eyeLightDir, normal);\n        if (NdotL > 0.0) {\n            lighted = true;\n            vec3 diffuseContrib;\n            lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n            vec3 specularContrib;\n            specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n            return attenuation * (diffuseContrib + specularContrib);\n        }\n    }\n\n    return vec3(0.0);\n}\n\nvec3 computeSunLightShading(\n\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightDiffuse,\n    const in vec3 lightSpecular,\n    const in vec4 lightPosition,\n    const in mat4 lightMatrix,\n\n    out bool lighted) {\n\n    lighted = false; \n    vec3 eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    // compute NdL   // compute NdL\n    float NdotL = dot(eyeLightDir, normal);\n    if (NdotL > 0.0) {\n        lighted = true;\n        vec3 diffuseContrib;\n        lambert(NdotL, materialDiffuse, lightDiffuse, diffuseContrib);\n        vec3 specularContrib;\n        specularCookTorrance(normal, eyeLightDir, eyeVector, materialShininess, materialSpecular, lightSpecular, specularContrib);\n        return (diffuseContrib + specularContrib);\n    }\n\n    return vec3(0.0);\n}\n\nvec3 computeHemiLightShading(\n\n    const in vec3 normal,\n    const in vec3 eyeVector,\n\n    const in vec3 materialDiffuse,\n    const in vec3 materialSpecular,\n    const in float materialShininess,\n\n    const in vec3 lightDiffuse,\n    const in vec3 lightGround,\n    const in vec4 lightPosition,\n    const in mat4 lightMatrix,\n\n    out bool lighted) {\n\n    lighted = false;\n    vec3 eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\n    float NdotL = dot(eyeLightDir, normal);\n    float weight = 0.5 * NdotL + 0.5;\n    vec3 diffuseContrib = materialDiffuse * mix(lightGround, lightDiffuse, weight);\n\n    // same cook-torrance as above for sky/ground\n    float skyWeight = 0.5 * dot(normal, normalize(eyeVector + eyeLightDir)) + 0.5;\n    float gndWeight = 0.5 * dot(normal, normalize(eyeVector - eyeLightDir)) + 0.5;\n    float skySpec = pow(skyWeight, materialShininess);\n    float skyGround = pow(gndWeight, materialShininess);\n    float divisor = (0.1 + max( dot(normal, eyeVector), 0.0 ));\n    float att = materialShininess > 100.0 ? 1.0 : smoothstep(0.0, 1.0, materialShininess * 0.01);\n    vec3 specularContrib = lightDiffuse * materialSpecular * weight * att * (skySpec + skyGround) / divisor;\n\n    return diffuseContrib + specularContrib;\n}\n"},function(e,t){e.exports='#pragma include "hash.glsl"\n\n//// noise glsl\n\n// Based on Morgan McGuire @morgan3d\n// https://www.shadertoy.com/view/4dS3Wd\nfloat noise2D(const in vec2 x) {\n    vec2 i = floor(x);\n    vec2 f = fract(x);\n\n    // Four corners in 2D of a tile\n    float a = hash21(i);\n    float b = hash21(i + vec2(1.0, 0.0));\n    float c = hash21(i + vec2(0.0, 1.0));\n    float d = hash21(i + vec2(1.0, 1.0));\n\n    vec2 u = f * f * (3.0 - 2.0 * f);\n    return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;\n}\n\n//// end noise glsl\n'},function(e,t){e.exports="//////////////////////////////\n// OPTIMIZED VERSION (NO IF)\n//////////////////////////////\nmat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n    mat4 outMat_1;\n    mat4 tmpMat_2;\n    highp ivec4 tmpvar_3;\n    tmpvar_3 = (3 * ivec4(bonesIdx));\n    tmpMat_2 = mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0);\n    vec4 tmpvar_4;\n    tmpvar_4 = -(abs(weightsVec));\n    tmpMat_2[0] = uBones[tmpvar_3.x];\n    tmpMat_2[1] = uBones[(tmpvar_3.x + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.x + 2)];\n    outMat_1 = ((float(\n    ((tmpvar_4.x + tmpvar_4.y) >= -((tmpvar_4.z + tmpvar_4.w)))\n    ) * mat4(1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0)) + (weightsVec.x * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.y];\n    tmpMat_2[1] = uBones[(tmpvar_3.y + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.y + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.y * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.z];\n    tmpMat_2[1] = uBones[(tmpvar_3.z + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.z + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.z * tmpMat_2));\n    tmpMat_2[0] = uBones[tmpvar_3.w];\n    tmpMat_2[1] = uBones[(tmpvar_3.w + 1)];\n    tmpMat_2[2] = uBones[(tmpvar_3.w + 2)];\n    outMat_1 = (outMat_1 + (weightsVec.w * tmpMat_2));\n\n    return outMat_1;\n}\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (WITH IF)\n//////////////////////////////\n\n// //http://http.developer.nvidia.com/GPUGems/gpugems_ch04.html\n// mat4 getMat4FromVec4( const int index, inout mat4 myMat ) {\n//     // We have to use a global variable because we can't access dynamically\n//     // matrix is transpose so we should do vec * matrix\n//     myMat[0] = uBones[ index ];\n//     myMat[1] = uBones[ index + 1];\n//     myMat[2] = uBones[ index + 2];\n//     return myMat;\n// }\n\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n//     ivec4 idx =  3 * ivec4(bonesIdx);\n//     mat4 tmpMat = mat4(1.0);\n//     mat4 outMat = mat4(0.0);\n\n//     // we handle negative weights\n//     if(all(equal(weightsVec, vec4(0.0)))) return tmpMat;\n\n//     if(weightsVec.x != 0.0) outMat += weightsVec.x * getMat4FromVec4( idx.x, tmpMat );\n//     if(weightsVec.y != 0.0) outMat += weightsVec.y * getMat4FromVec4( idx.y, tmpMat );\n//     if(weightsVec.z != 0.0) outMat += weightsVec.z * getMat4FromVec4( idx.z, tmpMat );\n//     if(weightsVec.w != 0.0) outMat += weightsVec.w * getMat4FromVec4( idx.w, tmpMat );\n//     return outMat;\n// }\n\n//////////////////////////////\n// UN-OPTIMIZED VERSION (NO IF)\n//////////////////////////////\n\n// mat4 skeletalTransform( const in vec4 weightsVec, const in vec4 bonesIdx ) {\n//     ivec4 idx =  3 * ivec4(bonesIdx);\n//     mat4 tmpMat = mat4(1.0);\n\n//     // if sum is 0, return identity\n//     vec4 absWeights = -abs(weightsVec);\n//     mat4 outMat = step(0.0, absWeights.x + absWeights.y + absWeights.z + absWeights.w) * tmpMat;\n\n//     // we handle negative weights\n//     // outMat[3][3] += weightsVec.x + weightsVec.y + weightsVec.z + weightsVec.w;\n\n//     tmpMat[0] = uBones[ idx.x ];\n//     tmpMat[1] = uBones[ idx.x + 1];\n//     tmpMat[2] = uBones[ idx.x + 2];\n//     outMat += weightsVec.x * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.y ];\n//     tmpMat[1] = uBones[ idx.y + 1];\n//     tmpMat[2] = uBones[ idx.y + 2];\n//     outMat += weightsVec.y * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.z ];\n//     tmpMat[1] = uBones[ idx.z + 1];\n//     tmpMat[2] = uBones[ idx.z + 2];\n//     outMat += weightsVec.z * tmpMat;\n\n//     tmpMat[0] = uBones[ idx.w ];\n//     tmpMat[1] = uBones[ idx.w + 1];\n//     tmpMat[2] = uBones[ idx.w + 2];\n//     outMat += weightsVec.w * tmpMat;\n\n//     return outMat;\n// }\n"},function(e,t){e.exports="vec3 textureRGB(const in sampler2D tex, const in vec2 uv) {\n    return texture2D(tex, uv.xy ).rgb;\n}\n\nvec4 textureRGBA(const in sampler2D tex, const in vec2 uv) {\n    return texture2D(tex, uv.xy ).rgba;\n}\n\nfloat textureIntensity(const in sampler2D tex, const in vec2 uv) {\n    return texture2D(tex, uv).r;\n}\n\nfloat textureAlpha(const in sampler2D tex, const in vec2 uv) {\n    return texture2D(tex, uv.xy ).a;\n}\n"},function(e,t){e.exports="//// hash glsl\n\n// Dave Hoskins: hash without sin\n//https://www.shadertoy.com/view/4djSRW\n#define MOD2 vec2(443.8975,397.2973)\n//----------------------------------------------------------------------------------------\n//  1 out, 1 in...\n//note: normalized uniform random, [0;1[\nfloat hash11(const in float p)\n{\n    vec2 p2 = fract(vec2(p) * MOD2);\n    p2 += dot(p2.yx, p2.xy+19.19);\n    return fract(p2.x * p2.y);\n}\n//note: normalized uniform random, [0;1[\n//  2 out, 1 in...\nfloat hash21(const in vec2 p)\n{\n    vec2 p2 = fract(p * MOD2);\n    p2 += dot(p2.yx, p2.xy+19.19);\n    return fract(p2.x * p2.y);\n}\n\n\n// Based on Morgan McGuire @morgan3d\n// https://www.shadertoy.com/view/4dS3Wd\n// using Sin\n//  1 out, 1 in...\nfloat hashSin11( const in float n )\n{\n    return fract(sin(n)*43758.5453);\n}\n\n//note: normalized uniform random, [0;1[\n//  2 out, 1 in...\nfloat hashSin21( const in vec2 n ) {\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453);\n}\n\n// note: [-1;1]\n// iq: https://www.shadertoy.com/view/Xsl3Dl\n// note: value noise\n//  2 out, 2 in...\nvec2 hashSin22( const in vec2 n )\n{\n    return fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* vec2(43758.5453,35458.5734));\n}\n//  3 out, 3 in...\nvec3 hashSin33( in vec3 p )\n{\n    p = vec3( dot(p,vec3(127.1,311.7, 74.7)),\n              dot(p,vec3(269.5,183.3,246.1)),\n              dot(p,vec3(113.5,271.9,124.6)));\n    return fract(sin(p)*43758.5453123);\n}\n\n// Returns a random number based on a vec3 and an int.\nfloat hashSin41(const in vec4 seed){\n    return fract(sin(dot(seed, vec4(12.9898,78.233,45.164,94.673)) * 43758.5453));\n}\n\n/////// end hash\n"},function(e,t){e.exports='\n#pragma include "tapPCF.glsl"\n\n#ifdef _ATLAS_SHADOW\n\nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowMapSize,\n                    const in vec4 shadowTextureSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in vec3 normalWorld,\n                    const in vec3 vertexWorld,                    \n                    const in float bias\n#ifdef _NORMAL_OFFSET\n                    ,const in float normalBias\n#endif //_NORMAL_OFFSET\n                    \n    )\n#else\n    \nfloat computeShadow(const in bool lighted,\n                    const in sampler2D tex,\n                    const in vec4 shadowTextureSize,\n                    const in mat4 shadowProjectionMatrix,\n                    const in mat4 shadowViewMatrix,\n                    const in vec4 depthRange,\n                    const in vec3 normalWorld,\n                    const in vec3 vertexWorld,\n                    const in float bias\n#ifdef _NORMAL_OFFSET\n                    ,const in float normalBias\n#endif //_NORMAL_OFFSET\n\n   )\n    \n#endif\n{\n                        \n    #pragma include "shadowsReceiveMain.glsl"\n\n}\n\n'},function(e,t){e.exports="\n// simulation of texture2Dshadow glsl call on HW\n// http://codeflow.org/entries/2013/feb/15/soft-shadow-mapping/\nfloat texture2DCompare(const in sampler2D depths, const in vec2 uv, const in float compare, const in vec4 clampDimension){\n\n    float depth = getSingleFloatFromTex(depths, clamp(uv, clampDimension.xy, clampDimension.zw));\n    return step(compare, depth);\n\n}\n\n// simulates linear fetch like texture2d shadow\nfloat texture2DShadowLerp(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare, const in vec4 clampDimension){\n\n    vec2 f = fract(uv*size.xy+0.5);\n    vec2 centroidUV = floor(uv*size.xy+0.5)*size.zw;\n\n    float lb = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 0.0), compare, clampDimension);\n    float lt = texture2DCompare(depths, centroidUV+size.zw*vec2(0.0, 1.0), compare, clampDimension);\n    float rb = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 0.0), compare, clampDimension);\n    float rt = texture2DCompare(depths, centroidUV+size.zw*vec2(1.0, 1.0), compare, clampDimension);\n    float a = mix(lb, lt, f.y);\n    float b = mix(rb, rt, f.y);\n    float c = mix(a, b, f.x);\n    return c;\n\n}\n"},function(e,t){e.exports='\n#pragma include "colorEncode.glsl"\n\n\nvec4 computeShadowDepth(const in vec4 fragEye,\n                        const in vec4 shadowRange){\n    // distance to camera\n    float depth =  -fragEye.z * fragEye.w;\n    // most precision near 0, make sure we are near 0 and in  [0,1]\n    depth = (depth - shadowRange.x ) * shadowRange.w;\n\n    vec4 outputFrag;\n\n#if defined (_FLOATTEX) \n    outputFrag = vec4(depth, 0.0, 0.0, 1.0);\n#else\n    outputFrag = encodeFloatRGBA(depth);\n#endif\n\n    return outputFrag;\n}\n'},function(e,t){e.exports='//begin shadows\n\n#pragma include "colorEncode.glsl"\n\n// end Float codec\nfloat getSingleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return  decodeFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).x;\n#endif\n}\n\nvec2 getDoubleFloatFromTex(const in sampler2D depths, const in vec2 uv){\n#ifndef _FLOATTEX\n    return decodeHalfFloatRGBA(texture2D(depths, uv));\n#else\n    return texture2D(depths, uv).xy;\n#endif\n}\n\nvec4 getQuadFloatFromTex(const in sampler2D depths, const in vec2 uv){\n    return texture2D(depths, uv).xyzw;\n}\n// end Float codec\n\n#pragma include "pcf.glsl" '},function(e,t){e.exports="// 0 for early out\nbool earlyOut = false;\n\n// Calculate shadow amount\nfloat shadow = 1.0;\n\nif(!lighted) {\n    shadow = 0.0;\n    earlyOut = true;\n}\n\nif (depthRange.x == depthRange.y) {\n    earlyOut = true;\n}\n\nvec4 shadowVertexEye;\nvec4 shadowNormalEye;\nfloat shadowReceiverZ = 0.0;\nvec4 shadowVertexProjected;\nvec2 shadowUV;\nfloat N_Dot_L;\n\nif(!earlyOut) {\n\n    shadowVertexEye =  shadowViewMatrix *  vec4(vertexWorld, 1.0);\n\n    vec3 shadowLightDir = vec3(0.0, 0.0, 1.0); // in shadow view light is camera\n    vec4 normalFront = vec4(normalWorld, 0.0);\n    shadowNormalEye =  shadowViewMatrix * normalFront;\n    N_Dot_L = dot(shadowNormalEye.xyz, shadowLightDir);\n\n    if(!earlyOut) {\n\n#ifdef _NORMAL_OFFSET\n\n        // http://www.dissidentlogic.com/old/images/NormalOffsetShadows/GDC_Poster_NormalOffset.png\n        float normalOffsetScale = clamp(1.0  - N_Dot_L, 0.0 , 1.0);\n\n        normalOffsetScale *= abs((shadowVertexEye.z - depthRange.x) * depthRange.w) * max(shadowProjectionMatrix[0][0], shadowProjectionMatrix[1][1]);\n\n        normalOffsetScale *= normalBias*depthRange.w;\n\n        shadowNormalEye =  shadowViewMatrix *  (normalFront * normalOffsetScale);\n\n        shadowVertexProjected = shadowProjectionMatrix * (shadowVertexEye + shadowNormalEye);\n\n#else\n\n        shadowVertexProjected = shadowProjectionMatrix * shadowVertexEye;\n\n#endif\n\n        if (shadowVertexProjected.w < 0.0) {\n            earlyOut = true; // notably behind camera\n        }\n\n    }\n\n\n\n\n    if(!earlyOut) {\n\n        shadowUV.xy = shadowVertexProjected.xy / shadowVertexProjected.w;\n        shadowUV.xy = shadowUV.xy * 0.5 + 0.5;// mad like\n\n        if(any(bvec4 ( shadowUV.x > 1., shadowUV.x < 0., shadowUV.y > 1., shadowUV.y < 0.))) {\n            earlyOut = true;// limits of light frustum\n        }\n\n        // most precision near 0, make sure we are near 0 and in [0,1]\n        shadowReceiverZ = - shadowVertexEye.z;\n        shadowReceiverZ =  (shadowReceiverZ - depthRange.x)* depthRange.w;\n\n        if(shadowReceiverZ < 0.0) {\n            earlyOut = true; // notably behind camera\n        }\n\n    }\n}\n\n\n\n\n\n\n// pcf pbias to add on offset\nvec2 shadowBiasPCF = vec2 (0.);\n\n#ifdef GL_OES_standard_derivatives\n\n\n//#define _RECEIVERPLANEDEPTHBIAS\n#ifdef _RECEIVERPLANEDEPTHBIAS\nvec2 biasUV;\n\nvec3 texCoordDY = dFdx(shadowVertexEye.xyz);\nvec3 texCoordDX = dFdy(shadowVertexEye.xyz);\n\nbiasUV.x = texCoordDY.y * texCoordDX.z - texCoordDX.y * texCoordDY.z;\nbiasUV.y = texCoordDX.x * texCoordDY.z - texCoordDY.x * texCoordDX.z;\nbiasUV *= 1.0 / ((texCoordDX.x * texCoordDY.y) - (texCoordDX.y * texCoordDY.x));\n\n// Static depth biasing to make up for incorrect fractional sampling on the shadow map grid\nfloat fractionalSamplingError = dot(vec2(1.0, 1.0) * shadowTextureSize.zw, abs(biasUV));\nfloat receiverDepthBias = min(fractionalSamplingError, 0.01);\n\nshadowBiasPCF.x = biasUV.x;\nshadowBiasPCF.y = biasUV.y;\n\n\nshadowReceiverZ += receiverDepthBias;\n\n#else\n\nshadowBiasPCF.x = clamp(dFdx(shadowReceiverZ)* shadowTextureSize.z, -1.0, 1.0 );\nshadowBiasPCF.y = clamp(dFdy(shadowReceiverZ)* shadowTextureSize.w, -1.0, 1.0 );\n\n#endif\n#endif\n\n\nvec4 clampDimension;\n\n#ifdef _ATLAS_SHADOW\n\nshadowUV.xy  = ((shadowUV.xy * shadowMapSize.zw ) + shadowMapSize.xy) / shadowTextureSize.xy;\n\n// clamp uv bias/filters by half pixel to avoid point filter on border\nclampDimension.xy = shadowMapSize.xy + vec2(0.5);\nclampDimension.zw = (shadowMapSize.xy + shadowMapSize.zw) - vec2(0.5);\n\nclampDimension = clampDimension / (shadowTextureSize.xyxy);\n\n\n#else\n\nclampDimension = vec4(0.0, 0.0, 1.0, 1.0);\n\n#endif\n\n\n// now that derivatives is done\n// and we don't access any mipmapped/texgrad texture\n// we can early out\n// see http://teknicool.tumblr.com/post/77263472964/glsl-dynamic-branching-and-texture-samplers\nif (earlyOut) {\n    // empty statement because of weird gpu intel bug\n} else {\n\n\n// depth bias: fighting shadow acne (depth imprecsion z-fighting)\nfloat shadowBias = 0.0;\n\n\n\n\n// cosTheta is dot( n, l ), clamped between 0 and 1\n//float shadowBias = 0.005*tan(acos(N_Dot_L));\n// same but 4 cycles instead of 15\nshadowBias += 0.05 *  sqrt( 1. -  N_Dot_L*N_Dot_L) / clamp(N_Dot_L, 0.0005,  1.0);\n\n//That makes sure that plane perpendicular to light doesn't flicker due to\n//selfshadowing and 1 = dot(Normal, Light) using a min bias\nshadowBias = clamp(shadowBias, 0.00005,  2.0*bias);\n\n// shadowZ must be clamped to [0,1]\n// otherwise it's not comparable to\n// shadow caster depth map\n// which is clamped to [0,1]\n// Not doing that makes ALL shadowReceiver > 1.0 black\n// because they ALL becomes behind any point in Caster depth map\nshadowReceiverZ = clamp(shadowReceiverZ, 0., 1. - shadowBias);\n\nshadowReceiverZ -= shadowBias;\n\n// Now computes Shadow\n\nshadow = getShadowPCF(tex, shadowTextureSize, shadowUV, shadowReceiverZ, shadowBiasPCF, clampDimension);\n\n}\n\nreturn shadow;\n"},function(e,t){e.exports='\n#pragma include "shadowLinearSoft.glsl"\n\nfloat getShadowPCF(const in sampler2D depths, const in vec4 size, const in vec2 uv, const in float compare, const in vec2 biasPCF, const in vec4 clampDimension)\n{\n\n     float res = 0.0;\n     res += texture2DShadowLerp(depths, size,   uv + biasPCF, compare, clampDimension);\n\n#if defined(_PCFx1)\n\n#else\n\n    float dx0 = -size.z;\n    float dy0 = -size.w;\n    float dx1 = size.z;\n    float dy1 = size.w;\n\n#define TSF(o1,o2) texture2DShadowLerp(depths, size, uv + vec2(o1, o2) + biasPCF,  compare, clampDimension)\n\n    res += TSF(dx0, dx0);\n    res += TSF(dx0, .0);\n    res += TSF(dx0, dx1);\n\n#if defined(_PCFx4)\n\n    res /=4.0;\n\n#elif defined(_PCFx9)\n    res += TSF(.0, dx0);\n    res += TSF(.0, dx1);\n\n    res += TSF(dx1, dx0);\n    res += TSF(dx1, .0);\n    res += TSF(dx1, dx1);\n\n\n    res /=9.0;\n\n#elif defined(_PCFx25)\n\n    float dx02 = -2.0*size.z;\n    float dy02 = -2.0*size.w;\n    float dx2 = 2.0*size.z;\n    float dy2 = 2.0*size.w;\n\n    // complete row above\n    res += TSF(dx0, dx02);\n    res += TSF(dx0, dx2);\n\n    res += TSF(.0, dx02);\n    res += TSF(.0, dx2);\n\n    res += TSF(dx1, dx02);\n    res += TSF(dx1, dx2);\n\n    // two new col\n    res += TSF(dx02, dx02);\n    res += TSF(dx02, dx0);\n    res += TSF(dx02, .0);\n    res += TSF(dx02, dx1);\n    res += TSF(dx02, dx2);\n\n    res += TSF(dx2, dx02);\n    res += TSF(dx2, dx0);\n    res += TSF(dx2, .0);\n    res += TSF(dx2, dx1);\n    res += TSF(dx2, dx2);\n\n\n    res/=25.0;\n\n#endif\n\n#undef TSF\n\n#endif\n    return res;\n}\n/////// end Tap\n'},function(e,t){e.exports='varying vec3 vLocalVertex;\n\n// common stuffs\nuniform int uOutputLinear;\nuniform float uRGBMRange;\n\nuniform float uEnvironmentExposure;\nuniform float uBackgroundExposure;\n\nuniform vec3 uDiffuseSPH[9];\nuniform samplerCube uTexture0;\nuniform float uSize;\nuniform int uAmbient;\n\n#pragma include "functions.glsl"\n#pragma include "sketchfabTextures.glsl"\n\n// sph env\nvec3 evaluateDiffuseSphericalHarmonics(const in vec3 s[9], const in vec3 n) {\n    // https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\n    vec3 result = (s[0]+s[1]*n.y+s[2]*n.z+s[3]*n.x+s[4]*n.y*n.x+s[5]*n.y*n.z+s[6]*(3.0*n.z*n.z-1.0)+s[7]*(n.z*n.x)+s[8]*(n.x*n.x-n.y*n.y));\n    return max(result, vec3(0.0));\n}\n\nvoid main(void) {\n\n    vec3 normal = normalize(vLocalVertex);\n\n    vec3 color;\n    if(uAmbient == 1) color = evaluateDiffuseSphericalHarmonics(uDiffuseSPH, normal) ;\n    else color = textureCubeFixed(uTexture0, normal, uSize);\n\n    color *= uEnvironmentExposure * uBackgroundExposure;\n\n    if( uOutputLinear == 0 ) color = linearTosRGB(color);\n\n    gl_FragColor = encodeRGBM(color, uRGBMRange);\n}\n'},function(e,t){e.exports="attribute vec3 Vertex;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\n\nuniform vec4 uHalton;\nuniform vec2 RenderSize;\n\nvarying vec3 vLocalVertex;\n\nvoid main(void)\n{\n    vLocalVertex = Vertex.rgb;\n\n    mat4 projectionMatrix = uProjectionMatrix;\n    vec2 halt = uHalton.xy / RenderSize;\n    projectionMatrix[2][0] += halt.x;\n    projectionMatrix[2][1] += halt.y;\n\n    gl_Position = (projectionMatrix * (uModelViewMatrix * vec4(Vertex, 1.0))).xyww;\n}\n"},function(e,t){e.exports="varying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform sampler2D uTextureHotspot;\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\nuniform vec3 uColor;\n\nconst float BIAS_VISIBILITY = 0.05;\n\nvoid main(void) {\n  float fragDepth = clamp((-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x), 0.0, 1.0);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize).rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n  float alpha = (fragDepth - BIAS_VISIBILITY < depth) ? 1.0 : 0.1;\n\n  gl_FragColor = vec4(uColor, 1.0) * texture2D(uTextureHotspot, vTexCoord0);\n  gl_FragColor.a *= alpha;\n\n  gl_FragColor.rgb *= gl_FragColor.a;\n}\n"},function(e,t){e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform float uHotspotIndex;\n\n// icon size 48 pixel width and 2 pixel padding between them\nconst vec2 ICON_SIZE = 48.0 / vec2(512.0, -256.0);\nconst vec2 ICON_AND_PADDING = ICON_SIZE + 2.0 / vec2(512.0, -256.0);\n\nvoid main(void) {\n  vec2 offset = vec2(mod(uHotspotIndex, 10.0), floor(uHotspotIndex / 10.0));\n  vTexCoord0 = vec2(TexCoord0.x, 1.0 - TexCoord0.y) * ICON_SIZE + offset * ICON_AND_PADDING;\n\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = uProjectionMatrix * vViewPos;\n}\n"},function(e,t){e.exports='uniform vec4 uLineColor;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n    vec4 color = sRGBToLinear(uLineColor);\n    color.rgb *= color.a;\n    gl_FragColor = linearTosRGB(color);\n}\n'},function(e,t){e.exports="attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},function(e,t){e.exports="uniform sampler2D uTexture0;\nuniform sampler2D uTexture1;\nuniform sampler2D uTexture2;\nuniform sampler2D uTexture3;\n\n// vec4 (up to 4 textures input)\n// int meaning :\n// 0 -> read R\n// 1 -> read A\n// 2 -> read RGB\nuniform ivec4 uReadPacking;\n\nvarying vec2 vTexCoord0;\n\nvoid main(void) {\n    // check if we are in a 2 or 4 texture packing pattern\n    if ( uReadPacking.x == 2 ) {\n        gl_FragColor.rgb = texture2D( uTexture0, vTexCoord0 ).rgb;\n        gl_FragColor.a = uReadPacking.y == 0 ? texture2D( uTexture1, vTexCoord0 ).r : texture2D( uTexture1, vTexCoord0 ).a;\n    } else {\n        gl_FragColor.r = uReadPacking.x == 0 ? texture2D( uTexture0, vTexCoord0 ).r : texture2D( uTexture0, vTexCoord0 ).a;\n        gl_FragColor.g = uReadPacking.y == 0 ? texture2D( uTexture1, vTexCoord0 ).r : texture2D( uTexture1, vTexCoord0 ).a;\n        gl_FragColor.b = uReadPacking.z == 0 ? texture2D( uTexture2, vTexCoord0 ).r : texture2D( uTexture2, vTexCoord0 ).a;\n        gl_FragColor.a = uReadPacking.w == 0 ? texture2D( uTexture3, vTexCoord0 ).r : texture2D( uTexture3, vTexCoord0 ).a;\n    }\n}"},function(e,t){e.exports="attribute vec3 Vertex;\nvarying vec2 vTexCoord0;\n\nvoid main(void) {\n    gl_Position = vec4(Vertex * 2.0 - 1.0, 1.0);\n    vTexCoord0 = Vertex.xy;\n}\n"},function(e,t){e.exports="uniform vec4 uColor;\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vec4( vec3(vColor) * uColor.a, uColor.a);\n}\n"},function(e,t){e.exports="attribute vec3 Vertex;\nattribute vec4 Color;\nvarying vec4 vColor;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n    vColor = Color;\n    gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);\n}\n"},function(e,t){e.exports="uniform vec4 uColor;\n\nvoid main(void) {\n  gl_FragColor = vec4(uColor.xyz * uColor.a, uColor.a);\n}\n"},function(e,t){e.exports="attribute vec3 Vertex;\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex, 1.0);\n}\n"},function(e,t){e.exports="// has to be before anything else, just after glsl language version\r\n// it's require. enable just allow\r\nvec3 textureCubemapLod(const in samplerCube texture, const in vec3 dir, const in float lod ) {\r\n    vec4 rgba = textureCubeLodEXT( texture, dir, lod );\r\n#ifdef FLOAT\r\n    return rgba.rgb;\r\n#endif\r\n#ifdef RGBM\r\n    return RGBMToRGB( rgba );\r\n#endif\r\n#ifdef LUV\r\n    return LUVToRGB( rgba );\r\n#endif\r\n}\r\n\r\nvec3 textureCubeLodEXTFixed(const in samplerCube texture, const in vec2 size, const in vec3 direction, const in float lodInput, const in float maxLod ) {\r\n    vec3 dir = direction;\r\n    float lod = min( maxLod, lodInput );\r\n\r\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\r\n    float scale = 1.0 - exp2(lod) / size.x;\r\n    vec3 absDir = abs(dir);\r\n    float M = max(max(absDir.x, absDir.y), absDir.z);\r\n\r\n    if (absDir.x != M) dir.x *= scale;\r\n    if (absDir.y != M) dir.y *= scale;\r\n    if (absDir.z != M) dir.z *= scale;\r\n\r\n    return textureCubemapLod( texture, dir, lod );\r\n}\r\n\r\nvec3 prefilterEnvMapCube( const in float rLinear, const in vec3 R, const in samplerCube tex, const in vec2 lodRange, const in vec2 size ){\r\n    float lod = linRoughnessToMipmap(rLinear) * lodRange[1]; //( uEnvironmentMaxLod - 1.0 );\r\n    return textureCubeLodEXTFixed( tex, size, R, lod, lodRange[0] );\r\n}\r\n"},function(e,t){e.exports="// http://madebyevan.com/shaders/curvature/\nvec3 applyCurvature(const in vec3 viewNormal, const in vec3 baseColor, const in float str) {\n  if(str == 0.0)\n    return baseColor;\n\n#ifndef GL_OES_standard_derivatives\n    return baseColor;\n#else\n  vec3 n = normalize(viewNormal);\n  // Compute curvature\n  vec3 dx = dFdx(n);\n  vec3 dy = dFdy(n);\n  vec3 xneg = n - dx;\n  vec3 xpos = n + dx;\n  vec3 yneg = n - dy;\n  vec3 ypos = n + dy;\n\n  float curvature = (cross(xneg, xpos).y - cross(yneg, ypos).x) * str;\n\n  float curvDirt = clamp(-curvature * 1.5, 0.0, 1.0);\n  float curvEdge = clamp(curvature * 2.5, 0.0, 1.0);\n\n  float factorDirt = mix(1.0, 0.3, curvDirt);\n  float factorEdge = 2.0;\n\n  return baseColor * mix(factorDirt, factorEdge, curvEdge);\n#endif\n}\n"},function(e,t){e.exports="\r\n// math.glsl\r\n#define PI 3.141593\r\n#define HALF_PI 1.570796\r\n#define EPS .0000001\r\n\r\n// dxtogl.glsl ?\r\n#define saturate(_x) clamp(_x, 0., 1.)\r\n#define atan2(_x, _y) atan(_x, _y)\r\n#define frac(_x) fract(_x)\r\n#define lerp(_x, _y, _t) mix(_x, _y, _t)\r\n\r\n// light_common.glsl\r\n// ATTENUATION\r\nfloat getLightAttenuation(const in float dist, const in vec4 lightAttenuation) {\r\n    // lightAttenuation(constantEnabled, linearEnabled, quadraticEnabled)\r\n    // TODO find a vector alu instead of 4 scalar\r\n    float constant = lightAttenuation.x;\r\n    float linear = lightAttenuation.y*dist;\r\n    float quadratic = lightAttenuation.z*dist*dist;\r\n    return 1.0 / ( constant + linear + quadratic );\r\n}\r\n\r\n// light PBR glsl\r\n#define G1V(dotNV, k) (1./(dotNV*(1.-k)+k))\r\n\r\nvec4 LightingFuncPrep(const in vec3 N, const in vec3 V, const in float roughness) {\r\n\r\n    float dotNV = saturate(dot(N,V));\r\n    float alpha = roughness * roughness;\r\n    float k = alpha * .5;\r\n    float visNV = G1V(dotNV,k);\r\n\r\n    vec4 prepSpec;\r\n\r\n    prepSpec.x = alpha;\r\n    prepSpec.y = alpha * alpha;\r\n    prepSpec.z = k;\r\n    prepSpec.w = visNV;\r\n\r\n    return prepSpec;\r\n}\r\n\r\nvec3 LightingFuncUsePrepGGX(const vec4 prepSpec, const vec3 N, const vec3 V, const vec3 L, const vec3 F0, const float dotNL) {\r\n\r\n    vec3 H = normalize(V+L);\r\n    float dotNH = saturate(dot(N,H));\r\n    // D\r\n    float alphaSqr = prepSpec.y;\r\n    float denom = dotNH * dotNH *(alphaSqr-1.) + 1.;\r\n    float D = alphaSqr / (PI * denom * denom);\r\n    // F\r\n    float dotLH = saturate(dot(L,H));\r\n    float dotLH5 = pow(1.-dotLH,5.);\r\n    vec3 F = vec3(F0) + (vec3(1.)-F0)*(dotLH5);\r\n    // V\r\n    float visNL = G1V(dotNL, prepSpec.z);\r\n    vec3 specular = D * F * visNL * prepSpec.w;\r\n    return specular;\r\n}\r\n\r\n// pure compute Light PBR\r\nvec3 computeLight(const in vec3 lightColor,\r\n                  const in vec3 albedo,\r\n                  const in vec3 normal,\r\n                  const in vec3 viewDir,\r\n                  const in vec3 lightDir,\r\n                  const in vec3 specular,\r\n                  const in vec4 prepSpec,\r\n                  const in float dotNL) {\r\n\r\n    vec3 cSpec = LightingFuncUsePrepGGX(prepSpec, normal, viewDir, lightDir, specular, dotNL);\r\n    return lightColor * dotNL * (albedo + cSpec);\r\n}\r\n\r\n// STANDARD call for each light\r\n//direction, dist, NDL, attenuation, compute diffuse, compute specular\r\nvec3 computeSpotLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n    const in vec3 lightSpotDirection,\r\n    const in vec4 lightAttenuation,\r\n    const in vec4 lightSpotPosition,\r\n    const in float lightCosSpotCutoff,\r\n    const in float lightSpotBlend,\r\n    const in mat4 lightMatrix,\r\n    const in mat4 lightInvMatrix,\r\n\r\n    out bool lighted) {\r\n\r\n    lighted = false;\r\n    vec3 eyeLightPos = vec3(lightMatrix * lightSpotPosition);\r\n    vec3 eyeLightDir = eyeLightPos - vViewVertex.xyz;\r\n    // compute dist\r\n    float dist = length(eyeLightDir);\r\n    // compute attenuation\r\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    if (attenuation != 0.0) {\r\n        // compute direction\r\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n\r\n        if (lightCosSpotCutoff > 0.0) {\r\n            //compute lightSpotBlend\r\n            vec3 lightSpotDirectionEye = normalize(mat3(vec3(lightInvMatrix[0]), vec3(lightInvMatrix[1]), vec3(lightInvMatrix[2]))*lightSpotDirection);\r\n\r\n            float cosCurAngle = dot(-eyeLightDir, lightSpotDirectionEye);\r\n            float diffAngle = cosCurAngle - lightCosSpotCutoff;\r\n            float spot = 1.0;\r\n            if ( diffAngle < 0.0 ) {\r\n                spot = 0.0;\r\n            } else if ( lightSpotBlend > 0.0 ) {\r\n                spot = cosCurAngle * smoothstep(0.0, 1.0, (cosCurAngle - lightCosSpotCutoff) / (lightSpotBlend));\r\n            }\r\n\r\n            if (spot > 0.0) {\r\n                // compute NdL\r\n                float NdotL = dot(eyeLightDir, normal);\r\n                if (NdotL > 0.0) {\r\n                    lighted = true;\r\n                    return spot * attenuation *computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir, specular, prepSpec,  NdotL);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computePointLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n    const in vec4 lightPosition,\r\n    const in vec4 lightAttenuation,\r\n    const in mat4 lightMatrix,\r\n\r\n    out bool lighted) {\r\n\r\n    lighted = false;\r\n    vec3 eyeLightPos =  vec3(lightMatrix * lightPosition);\r\n    vec3 eyeLightDir = eyeLightPos - vViewVertex.xyz;\r\n    float dist = length(eyeLightDir);\r\n    // compute dist\r\n    // compute attenuation\r\n    float attenuation = getLightAttenuation(dist, lightAttenuation);\r\n    if (attenuation != 0.0) {\r\n        // compute direction\r\n        eyeLightDir = dist > 0.0 ? eyeLightDir / dist :  vec3( 0.0, 1.0, 0.0 );\r\n        // compute NdL\r\n        float NdotL = dot(eyeLightDir, normal);\r\n        if (NdotL > 0.0) {\r\n            lighted = true;\r\n            return  attenuation * computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir,  specular, prepSpec,  NdotL);\r\n        }\r\n    }\r\n\r\n    return vec3(0.0);\r\n}\r\n\r\nvec3 computeSunLightPBRShading(\r\n    const in vec3 normal,\r\n    const in vec3 eyeVector,\r\n\r\n    const in vec3 albedo,\r\n    const in vec4 prepSpec,\r\n    const in vec3 specular,\r\n\r\n    const in vec3 lightColor,\r\n    const in vec4 lightPosition,\r\n    const in mat4 lightMatrix,\r\n\r\n    out bool lighted) {\r\n\r\n    lighted = false;\r\n    vec3 eyeLightDir = normalize( vec3(lightMatrix * lightPosition ) );\r\n    // compute NdL\r\n    float NdotL = dot(eyeLightDir, normal);\r\n    if (NdotL > 0.0) {\r\n        lighted = true;\r\n        return computeLight(lightColor, albedo, normal, eyeVector, eyeLightDir, specular, prepSpec,  NdotL);\r\n    }\r\n\r\n    return vec3(0.0);\r\n}\r\n"},function(e,t){e.exports="vec2 computeUVForMipmap( const in float level, const in vec2 uv, const in float size, const in float maxLOD ) {\r\n\r\n    // width for level\r\n    float widthForLevel = exp2( maxLOD-level);\r\n\r\n    // the height locally for the level in pixel\r\n    // to opimitize a bit we scale down the v by two in the inputs uv\r\n    float heightForLevel = widthForLevel * 0.5;\r\n\r\n\r\n    // compact version\r\n    float texelSize = 1.0/size;\r\n    vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, heightForLevel - 2.0);\r\n    uvSpaceLocal.y += size - widthForLevel;\r\n    return uvSpaceLocal * texelSize;\r\n}\r\n\r\n//for y up\r\nvec2 normalToPanoramaUVY( const in vec3 dir ) {\r\n    float n = length(dir.xz);\r\n\r\n    // to avoid bleeding the max(-1.0,dir.x / n) is needed\r\n    vec2 pos = vec2( (n>0.0000001) ? max(-1.0,dir.x / n) : 0.0, dir.y);\r\n\r\n    // fix edge bleeding\r\n    if ( pos.x > 0.0 ) pos.x = min( 0.999999, pos.x );\r\n\r\n    pos = acos(pos) * 0.3183098861837907; // inv_pi\r\n\r\n    pos.x = (dir.z > 0.0) ? pos.x*0.5 : 1.0-(pos.x*0.5);\r\n\r\n    // shift u to center the panorama to -z\r\n    pos.x = mod(pos.x-0.25+1.0, 1.0 );\r\n    pos.y = 1.0-pos.y;\r\n    return pos;\r\n}\r\n\r\nvec3 texturePanorama(const in sampler2D tex, const in vec2 uv) {\r\n    vec4 rgba = texture2D(tex, uv );\r\n#ifdef FLOAT\r\n    return rgba.rgb;\r\n#endif\r\n#ifdef RGBM\r\n    return RGBMToRGB( rgba );\r\n#endif\r\n#ifdef LUV\r\n    return LUVToRGB( rgba );\r\n#endif\r\n}\r\n\r\nvec3 texturePanoramaLod(const in sampler2D tex, const in vec2 size, const in vec3 direction, const in float lodInput, const in float maxLOD ) {\r\n    float lod = min( maxLOD, lodInput );\r\n    vec2 uvBase = normalToPanoramaUVY( direction );\r\n\r\n    // // we scale down v here because it avoid to do twice in sub functions\r\n    // uvBase.y *= 0.5;\r\n\r\n    float lod0 = floor(lod);\r\n    vec2 uv0 = computeUVForMipmap(lod0, uvBase, size.x, maxLOD );\r\n    vec3 texel0 = texturePanorama( tex, uv0.xy);\r\n\r\n    float lod1 = ceil(lod);\r\n    vec2 uv1 = computeUVForMipmap(lod1, uvBase, size.x, maxLOD );\r\n    vec3 texel1 = texturePanorama( tex, uv1.xy);\r\n\r\n    return mix(texel0, texel1, fract( lod ) );\r\n}\r\n\r\nvec3 prefilterEnvMapPanorama( const in float rLinear, const in vec3 R, const in sampler2D tex, const in vec2 lodRange, const in vec2 size ){\r\n    return texturePanoramaLod( tex, size, R, linRoughnessToMipmap(rLinear) * lodRange[1], lodRange[0] );\r\n}\r\n"},function(e,t){e.exports='#pragma include "functions.glsl"\r\n#define LUV\r\n\r\nfloat specularOcclusion(const in int occlude, const in float ao, const in vec3 N, const in vec3 V) {\r\n    if(occlude == 0)\r\n        return 1.0;\r\n    // Yoshiharu Gotanda\'s specular occlusion approximation:\r\n    // cf http://research.tri-ace.com/Data/cedec2011_RealtimePBR_Implementation_e.pptx pg59\r\n    float d = dot( N, V ) + ao;\r\n    return clamp((d * d) - 1.0 + ao, 0.0, 1.0);\r\n}\r\n\r\nfloat adjustRoughnessNormalMap( const in float roughness, const in vec3 normal ) {\r\n    // Based on The Order : 1886 SIGGRAPH course notes implementation (page 21 notes)\r\n    float normalLen = length(normal);\r\n    if ( normalLen < 1.0) {\r\n        float normalLen2 = normalLen * normalLen;\r\n        float kappa = ( 3.0 * normalLen -  normalLen2 * normalLen )/( 1.0 - normalLen2 );\r\n        // http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/\r\n        // page 91 : they use 0.5/kappa instead\r\n        return min(1.0, sqrt( roughness * roughness + 1.0/kappa ));\r\n    }\r\n    return roughness;\r\n}\r\n\r\nfloat adjustRoughnessGeometry( const in float roughness, const in vec3 normal ) {\r\n    // Geometric Specular Aliasing (slide 43)\r\n    // http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf\r\n// #ifdef GL_OES_standard_derivatives\r\n//     vec3 vDx = dFdx( normal.xyz );\r\n//     vec3 vDy = dFdy( normal.xyz );\r\n//     return max(roughness, pow( clamp( max( dot( vDx, vDx ), dot( vDy, vDy ) ), 0.0, 1.0 ), 0.333 ));\r\n// #else\r\n    return roughness;\r\n// #endif\r\n}\r\n\r\nmat3 environmentTransformPBR( const in mat4 tr ) {\r\n    // TODO trick from animation matrix transpose?\r\n    vec3 x = vec3(tr[0][0], tr[1][0], tr[2][0]);\r\n    vec3 y = vec3(tr[0][1], tr[1][1], tr[2][1]);\r\n    vec3 z = vec3(tr[0][2], tr[1][2], tr[2][2]);\r\n    mat3 m = mat3(x, y, z);\r\n    return m;\r\n}\r\n\r\nvec3 evaluateDiffuseSphericalHarmonics( const in vec3 s[9], const in mat3 envTrans, const in vec3 N ) {\r\n    vec3 n = envTrans * N;\r\n    // https://github.com/cedricpinson/envtools/blob/master/Cubemap.cpp#L523\r\n    vec3 result = (s[0]+s[1]*n.y+s[2]*n.z+s[3]*n.x+s[4]*n.y*n.x+s[5]*n.y*n.z+s[6]*(3.0*n.z*n.z-1.0)+s[7]*(n.z*n.x)+s[8]*(n.x*n.x-n.y*n.y));\r\n    return max(result, vec3(0.0));\r\n}\r\n\r\n// Frostbite, Lagarde paper p67\r\n// http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf\r\nfloat linRoughnessToMipmap( const in float roughnessLinear ) {\r\n    return sqrt(roughnessLinear);\r\n}\r\n\r\nvec3 integrateBRDF( const in vec3 specular, const in float r, const in float NoV, const in sampler2D tex ) {\r\n    vec4 rgba = texture2D( tex, vec2(NoV, r) );\r\n    float b = (rgba[3] * 65280.0 + rgba[2] * 255.0);\r\n    float a = (rgba[1] * 65280.0 + rgba[0] * 255.0);\r\n    const float div = 1.0/65535.0;\r\n    return (specular * a + b) * div;\r\n}\r\n\r\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\r\n// TODO should we use somehow specular f0 ?\r\nvec3 integrateBRDFApprox( const in vec3 specular, const in float roughness, const in float NoV ) {\r\n    const vec4 c0 = vec4( -1, -0.0275, -0.572, 0.022 );\r\n    const vec4 c1 = vec4( 1, 0.0425, 1.04, -0.04 );\r\n    vec4 r = roughness * c0 + c1;\r\n    float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\r\n    vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\r\n    return specular * AB.x + AB.y;\r\n}\r\n\r\nvec3 computeIBLDiffuseUE4( const in vec3 normal, const in vec3 albedo, const in mat3 envTrans, const in vec3 sphHarm[9] ) {\r\n    return albedo * evaluateDiffuseSphericalHarmonics( sphHarm, envTrans, normal ) ;\r\n}\r\n\r\n// basically whether it\'s panorama or cubemap we load the adequate glsl\r\n// and we set samplerEnv and prefilterEnvMap\r\n#ifdef CUBEMAP\r\n#pragma include "cubemapSampler.glsl" "CUBEMAP"\r\n#define samplerEnv samplerCube\r\n#define prefilterEnvMap prefilterEnvMapCube\r\n\r\n#else\r\n#ifdef PANORAMA\r\n#pragma include "panoramaSampler.glsl" "PANORAMA"\r\n#define samplerEnv sampler2D\r\n#define prefilterEnvMap prefilterEnvMapPanorama\r\n\r\n#else\r\n// in case there is no environment node ?\r\nvec3 prefilterEnvMap( const in float rLinear, const in vec3 R, const in sampler2D tex, const in vec2 lodRange, const in vec2 size ) {\r\n    return vec3(0.0);\r\n}\r\n#define samplerEnv sampler2D\r\n#endif // PANORAMA\r\n\r\n#endif // CUBEMAP\r\n\r\nvec3 getSpecularDominantDir( const in vec3 N, const in vec3 R, const in float realRoughness ) {\r\n    float smoothness = 1.0 - realRoughness;\r\n    float lerpFactor = smoothness * ( sqrt( smoothness ) + realRoughness );\r\n    // The result is not normalized as we fetch in a cubemap\r\n    return mix( N, R, lerpFactor );\r\n}\r\n\r\n// samplerEnv and prefilterEnvMap are both defined above (cubemap or panorama)\r\nvec3 computeIBLSpecularUE4(\r\n    const in vec3 N,\r\n    const in vec3 V,\r\n    const in float rLinear,\r\n    const in vec3 specular,\r\n    const in mat3 envTrans,\r\n    const in samplerEnv texEnv,\r\n    const in vec2 lodRange,\r\n    const in vec2 size,\r\n    const in vec3 frontNormal\r\n    #ifdef MOBILE\r\n    ){\r\n    #else\r\n    ,const in sampler2D texBRDF ) {\r\n    #endif\r\n\r\n    float rough = max( rLinear, 0.0);\r\n\r\n    float NoV = dot( N, V );\r\n    vec3 R = normalize( NoV * 2.0 * N - V);\r\n    R = getSpecularDominantDir(N, R, rLinear);\r\n    // could use that, especially if NoV comes from shared preCompSpec\r\n    //vec3 R = reflect(-V, N);\r\n\r\n    vec3 prefilteredColor = prefilterEnvMap( rough, envTrans * R, texEnv, lodRange, size );\r\n    // http://marmosetco.tumblr.com/post/81245981087\r\n    // marmoset uses 1.3, we force it to 1.0\r\n    float factor = clamp( 1.0 + dot(R, frontNormal), 0.0, 1.0 );\r\n    prefilteredColor *= factor * factor;\r\n    #ifdef MOBILE\r\n    return prefilteredColor * integrateBRDFApprox( specular, rough, NoV );\r\n    #else\r\n    return prefilteredColor * integrateBRDF( specular, rough, NoV, texBRDF );\r\n    #endif\r\n}\r\n'},function(e,t){e.exports="float adjustSpecular( const in float specular, const in vec3 normal ) {\n    // Based on The Order : 1886 SIGGRAPH course notes implementation (page 21 notes)\n    float normalLen = length(normal);\n    if ( normalLen < 1.0) {\n        float normalLen2 = normalLen * normalLen;\n        float kappa = ( 3.0 * normalLen -  normalLen2 * normalLen )/( 1.0 - normalLen2 );\n        // http://www.frostbite.com/2014/11/moving-frostbite-to-pbr/\n        // page 91 : they use 0.5/kappa instead\n        return 1.0-min(1.0, sqrt( (1.0-specular) * (1.0-specular) + 1.0/kappa ));\n    }\n    return specular;\n}\n\nvec3 mtexNspaceTangent(const in vec4 tangent, const in vec3 normal, const in vec3 texnormal) {\n    vec3 tang = vec3(0.0,1.0,0.0);\n    float l = length(tangent.xyz);\n    if (l != 0.0) {\n        //normalize reusing length computations\n        // tang =  normalize(tangent.xyz);\n        tang =  tangent.xyz / l;\n    }\n    vec3 B = tangent.w * normalize(cross(normal, tang));\n    return normalize( texnormal.x*tang + texnormal.y*B + texnormal.z*normal);\n}\n\nvec2 normalMatcap(const in vec3 normal, const in vec3 nm_z) {\n    vec3 nm_x = vec3(-nm_z.z, 0.0, nm_z.x);\n    vec3 nm_y = cross(nm_x, nm_z);\n    return vec2(dot(normal.xz, -nm_x.xz), dot(normal, nm_y)) * vec2(0.5) + vec2(0.5);\n}\n\nvec3 rgbToNormal(const in vec3 texel, const in int flipNormalY) {\n    vec3 rgb = texel * vec3(2.0) + vec3(-1.0); // MADD vec form\n    rgb[1] = flipNormalY == 1 ? -rgb[1] : rgb[1];\n    return rgb;\n}\n\nvec3 bumpMap(const in vec4 tangent, const in vec3 normal, const in vec2 gradient) {\n    vec3 outnormal;\n    float l = length(tangent.xyz);\n    if (l != 0.0) {\n        //normalize reusing length computations\n        // vec3 tang =  normalize(tangent.xyz);\n        vec3 tang =  tangent.xyz / l;\n        vec3 binormal = tangent.w * normalize(cross(normal, tang));\n        outnormal = normal + gradient.x * tang + gradient.y * binormal;\n    }\n    else {\n       outnormal = vec3(normal.x + gradient.x, normal.y + gradient.y, normal.z);\n    }\n    return normalize(outnormal);\n}\n"},function(e,t){e.exports='#pragma include "functions.glsl"\n\nvec3 cubemapSeamlessFixDirection(const in vec3 direction, const in float size ) {\n    vec3 dir = direction;\n    float scale = 1.0 - 1.0 / size;\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\n    vec3 absDir = abs(dir);\n    float M = max(max(absDir.x, absDir.y), absDir.z);\n\n    if (absDir.x != M) dir.x *= scale;\n    if (absDir.y != M) dir.y *= scale;\n    if (absDir.z != M) dir.z *= scale;\n\n    return dir;\n}\n\n// seamless cubemap for background ( no lod )\nvec3 textureCubeFixed(const in samplerCube tex, const in vec3 direction, const in float scale ) {\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\n    vec3 dir = cubemapSeamlessFixDirection( direction, scale);\n    return LUVToRGB( textureCube( tex, dir ) );\n}\n\nvec3 textureEnvironmentCube( const in samplerCube tex, const in mat3 envTrans, const in vec3 N, const in vec3 V, const in vec2 size ){\n    vec3 R = normalize( (2.0 * clamp( dot( N, V ), 0.0, 1.0 ) ) * N - V);\n    return textureCubeFixed( tex, envTrans * R, size[0] );\n}\n\n#ifndef TEX_BUMP\n#define TEX_BUMP(tex, uv) 1.0\n#endif\n\n// Todo use #idfef and derivatives (dDFx, dDFy, fwidth) extension ?\n// float valuetexture2D(tex, uv);\n// return vec2(dFdx(value), dFdy(value));\nvec2 textureGradient(in sampler2D tex, const in vec2 uv, const in vec2 size) {\n    vec2 step = 1.0 / size;\n    float dx = TEX_BUMP(tex, uv - vec2(step.x, 0.0)) - TEX_BUMP(tex, uv + vec2(step.x, 0.0));\n    float dy = TEX_BUMP(tex, uv - vec2(0.0, step.y)) - TEX_BUMP(tex, uv + vec2(0.0, step.y));\n    return vec2(dx, dy);\n}\n'},function(e,t){e.exports="\n#pragma include \"functions.glsl\"\n\n// G3D version of FXAA\n// green (y) as luma\n// Quality 12\nvec3 fxaa(const in sampler2D tex, const in vec2 pos, const in vec2 texSize) {\n\n    vec2 fxaaQualityRcpFrame = 1.0 / texSize.xy;\n    float fxaaQualitySubpix = 0.75;\n    float fxaaQualityEdgeThreshold = 0.125;\n    float fxaaQualityEdgeThresholdMin = 0.0625;\n\n    vec2 posM = pos.xy;\n    vec4 rgbyM = texture2D(tex, posM);\n    float lumaM = rgbyM.y;\n\n    // Swizzler Offseter Util\n    vec4 sw = vec4(-1.0, 1.0, 1.0, -1.0) * fxaaQualityRcpFrame.xxyy;\n\n    float lumaS = texture2D(tex, posM + vec2(0.0, sw.z)).y;\n    float lumaE = texture2D(tex, posM + vec2(sw.y, 0.0)).y;\n    float lumaN = texture2D(tex, posM + vec2(0.0, sw.w)).y;\n    float lumaW = texture2D(tex, posM + vec2(sw.x, 0.0)).y;\n\n    float maxSM = max(lumaS, lumaM);\n    float minSM = min(lumaS, lumaM);\n\n    float maxESM = max(lumaE, maxSM);\n    float minESM = min(lumaE, minSM);\n\n    float maxWN = max(lumaN, lumaW);\n    float minWN = min(lumaN, lumaW);\n\n    float rangeMax = max(maxWN, maxESM);\n    float rangeMin = min(minWN, minESM);\n\n    float rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n    float range = rangeMax - rangeMin;\n    float rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n\n    bool earlyExit = range < rangeMaxClamped;\n    if(earlyExit)\n        return rgbyM.rgb;\n\n    float lumaNW = texture2D(tex, posM + sw.xw).y;\n    float lumaSE = texture2D(tex, posM + sw.yz).y;\n    float lumaNE = texture2D(tex, posM + sw.yw).y;\n    float lumaSW = texture2D(tex, posM + sw.xy).y;\n\n    float lumaNS = lumaN + lumaS;\n    float lumaWE = lumaW + lumaE;\n    float subpixRcpRange = 1.0/range;\n    float subpixNSWE = lumaNS + lumaWE;\n    float edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n    float edgeVert1 = (-2.0 * lumaM) + lumaWE;\n\n    float lumaNESE = lumaNE + lumaSE;\n    float lumaNWNE = lumaNW + lumaNE;\n    float edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n    float edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n\n    float lumaNWSW = lumaNW + lumaSW;\n    float lumaSWSE = lumaSW + lumaSE;\n    float edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n    float edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n    float edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n    float edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n    float edgeHorz = abs(edgeHorz3) + edgeHorz4;\n    float edgeVert = abs(edgeVert3) + edgeVert4;\n\n    float subpixNWSWNESE = lumaNWSW + lumaNESE;\n    float lengthSign = fxaaQualityRcpFrame.x;\n    bool horzSpan = edgeHorz >= edgeVert;\n    float subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n\n    if(!horzSpan) lumaN = lumaW;\n    if(!horzSpan) lumaS = lumaE;\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n    float subpixB = (subpixA * (1.0/12.0)) - lumaM;\n\n    float gradientN = lumaN - lumaM;\n    float gradientS = lumaS - lumaM;\n    float lumaNN = lumaN + lumaM;\n    float lumaSS = lumaS + lumaM;\n    bool pairN = abs(gradientN) >= abs(gradientS);\n    float gradient = max(abs(gradientN), abs(gradientS));\n    if(pairN) lengthSign = -lengthSign;\n    float subpixC = clamp(abs(subpixB) * subpixRcpRange, 0.0, 1.0);\n\n    vec2 posB = posM.xy;\n    vec2 offNP;\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n    if(!horzSpan) posB.x += lengthSign * 0.5;\n    if( horzSpan) posB.y += lengthSign * 0.5;\n\n    vec2 posN;\n    posN.x = posB.x - offNP.x;\n    posN.y = posB.y - offNP.y;\n    vec2 posP;\n    posP.x = posB.x + offNP.x;\n    posP.y = posB.y + offNP.y;\n    float subpixD = ((-2.0)*subpixC) + 3.0;\n    float lumaEndN = texture2D(tex, posN).y;\n    float subpixE = subpixC * subpixC;\n    float lumaEndP = texture2D(tex, posP).y;\n\n    if(!pairN) lumaNN = lumaSS;\n    float gradientScaled = gradient * 1.0/4.0;\n    float lumaMM = lumaM - lumaNN * 0.5;\n    float subpixF = subpixD * subpixE;\n    bool lumaMLTZero = lumaMM < 0.0;\n\n    lumaEndN -= lumaNN * 0.5;\n    lumaEndP -= lumaNN * 0.5;\n    bool doneN = abs(lumaEndN) >= gradientScaled;\n    bool doneP = abs(lumaEndP) >= gradientScaled;\n    if(!doneN) posN.x -= offNP.x * 1.5;\n    if(!doneN) posN.y -= offNP.y * 1.5;\n    bool doneNP = (!doneN) || (!doneP);\n    if(!doneP) posP.x += offNP.x * 1.5;\n    if(!doneP) posP.y += offNP.y * 1.5;\n\n    if(doneNP) {\n        if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n        if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if(!doneN) posN.x -= offNP.x * 2.0;\n        if(!doneN) posN.y -= offNP.y * 2.0;\n        doneNP = (!doneN) || (!doneP);\n        if(!doneP) posP.x += offNP.x * 2.0;\n        if(!doneP) posP.y += offNP.y * 2.0;\n\n        if(doneNP) {\n            if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n            if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if(!doneN) posN.x -= offNP.x * 4.0;\n            if(!doneN) posN.y -= offNP.y * 4.0;\n            doneNP = (!doneN) || (!doneP);\n            if(!doneP) posP.x += offNP.x * 4.0;\n            if(!doneP) posP.y += offNP.y * 4.0;\n\n            if(doneNP) {\n                if(!doneN) lumaEndN = texture2D(tex, posN.xy).y;\n                if(!doneP) lumaEndP = texture2D(tex, posP.xy).y;\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if(!doneN) posN.x -= offNP.x * 12.0;\n                if(!doneN) posN.y -= offNP.y * 12.0;\n                doneNP = (!doneN) || (!doneP);\n                if(!doneP) posP.x += offNP.x * 12.0;\n                if(!doneP) posP.y += offNP.y * 12.0;\n\n            }\n\n        }\n\n    }\n\n    float dstN = posM.x - posN.x;\n    float dstP = posP.x - posM.x;\n    if(!horzSpan) dstN = posM.y - posN.y;\n    if(!horzSpan) dstP = posP.y - posM.y;\n\n    bool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n    float spanLength = (dstP + dstN);\n    bool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n    float spanLengthRcp = 1.0/spanLength;\n\n    bool directionN = dstN < dstP;\n    float dst = min(dstN, dstP);\n    bool goodSpan = directionN ? goodSpanN : goodSpanP;\n    float subpixG = subpixF * subpixF;\n    float pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n    float subpixH = subpixG * fxaaQualitySubpix;\n\n    float pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n    float pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n\n    return texture2D(tex, posM).xyz;\n}\n\nfloat unpackDepth(const in sampler2D texDepth, const in vec2 uv) {\n    return dot(texture2D(texDepth, uv).rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n}\n\nvec3 reconstructWSPosition(const in vec2 uv, const in vec3 corners[4], const in mat4 invView, const in float depth) {\n    vec2 finalUv = uv;\n#ifdef VR_ENABLED\n    float xViewportOffset = uv.x >= 0.5 ? -0.5 : 0.0;\n    finalUv = vec2( ( uv.x + xViewportOffset ) * 2.0, uv.y );\n#endif\n\n    // the corners are in view space, it means if we interpolate between them we can retrieve the view space direction of the fragment\n    vec3 A = mix(corners[0], corners[1], finalUv.x);\n    vec3 B = mix(corners[2], corners[3], finalUv.x);\n\n    // multiply this view space direction by the depth gives us the view space position\n    vec3 vsPos = mix( A, B, finalUv.y ) * depth;\n\n    // multiply by the inverse of the view matrix gives us the world space position\n    return (invView * vec4(vsPos, 1.0)).xyz;\n}\n\n// access a linear texture as if a nearest texture\nvec4 textureNearest2D(const in sampler2D tex, const in vec2 uv, const in vec2 texSize)\n{\n  return texture2D(tex, (floor(uv*texSize)+0.5) / texSize, -99999.0);\n}\n\n#define NEIGHBOUR_CREATE_FROM_OFFSET(x,y) vec3(x, y, unpackDepth(texDepth, uv + vec2(x,y) * texelSize) )\n#define NEIGHBOUR_SET_IF_DMIN_Z_GREATER(neighbour) if(neighbour.z < dmin.z) dmin = neighbour;\n\n// Neighbourhood clamping from Tiago Sousa\nvec3 closestFragment(const in sampler2D texDepth, const in vec2 uv, const in vec2 texelSize) {\n    const float size = 2.0;\n\n    vec3 tl = NEIGHBOUR_CREATE_FROM_OFFSET(-size, size);\n    vec3 t = NEIGHBOUR_CREATE_FROM_OFFSET(0.0, size);\n    vec3 tr = NEIGHBOUR_CREATE_FROM_OFFSET(size, size);\n    vec3 ml = NEIGHBOUR_CREATE_FROM_OFFSET(-size, 0.0);\n    vec3 m = NEIGHBOUR_CREATE_FROM_OFFSET(0.0, 0.0);\n    vec3 mr = NEIGHBOUR_CREATE_FROM_OFFSET(size, 0.0);\n    vec3 bl = NEIGHBOUR_CREATE_FROM_OFFSET(-size, -size);\n    vec3 b = NEIGHBOUR_CREATE_FROM_OFFSET(0.0, -size);\n    vec3 br = NEIGHBOUR_CREATE_FROM_OFFSET(size, -size);\n\n    vec3 dmin = tl;\n\n    //NEIGHBOUR_SET_IF_DMIN_Z_GREATER(t)\n    NEIGHBOUR_SET_IF_DMIN_Z_GREATER(tr)\n    //NEIGHBOUR_SET_IF_DMIN_Z_GREATER(ml)\n    NEIGHBOUR_SET_IF_DMIN_Z_GREATER(m)\n    //NEIGHBOUR_SET_IF_DMIN_Z_GREATER(mr)\n    NEIGHBOUR_SET_IF_DMIN_Z_GREATER(bl)\n    //NEIGHBOUR_SET_IF_DMIN_Z_GREATER(b)\n    NEIGHBOUR_SET_IF_DMIN_Z_GREATER(br)\n\n    return vec3(uv + dmin.xy * texelSize, dmin.z);\n}\n\n// weighting by unbiased luminance diff from https://www.youtube.com/watch?v=WzpLWzGvFK4&t=18m\nfloat luminance(vec3 color) {\n    return dot(color, vec3(0.22, 0.707, 0.071));\n}\n\nvec3 clip_aabb(const in vec3 bbmin, const in vec3 bbmax, vec3 p, vec3 q) {\n    const float eps = 0.00000001;\n\n    // unoptimized version\n    vec3 r = q - p;\n    vec3 rmax = bbmax - p;\n    vec3 rmin = bbmin - p;\n\n    if( r.x > rmax.x + eps )\n        r *= ( rmax.x / r.x );\n    if( r.y > rmax.y + eps )\n        r *= ( rmax.y / r.y );\n    if( r.z > rmax.z + eps )\n        r *= ( rmax.z / r.z );\n\n    if( r.x < rmin.x - eps )\n        r *= ( rmin.x / r.x );\n    if( r.y < rmin.y - eps )\n        r *= ( rmin.y / r.y );\n    if( r.z < rmin.z - eps )\n        r *= ( rmin.z / r.z );\n\n    return p + r;\n}\n\n// this function is a version with less branches than clip_aabb\n// no visual differences as been observed between the two version, thus this one is used\nvec3 clip_aabb_opti(const in vec3 bbmin, const in vec3 bbmax, const in vec3 p, const in vec3 q ) {\n    const float eps = 0.00000001;\n\n    vec3 p_clip = 0.5 * ( bbmax + bbmin );\n    vec3 e_clip = 0.5 * ( bbmax - bbmin ) + eps;\n\n    vec3 v_clip = q - p_clip;\n    vec3 v_unit = v_clip / e_clip;\n    vec3 a_unit = abs( v_unit );\n\n    float ma_unit = max(a_unit.x, max(a_unit.y, a_unit.z));\n\n    if(ma_unit > 1.0)\n        return p_clip + v_clip / ma_unit;\n\n    return q;\n}\n\nvec3 taa(const in sampler2D currentTex, const in sampler2D prevTex, const in vec2 uv, const in vec2 ssVel, const in vec2 texelSize, const in vec2 jitter,\n    const in bool useSharpen) {\n\n    vec2 unjittered_uv = uv - jitter;\n\n    vec3 texel0 = texture2D(currentTex, unjittered_uv).rgb;\n    vec3 texel1 = texture2D(prevTex, uv - ssVel).rgb;\n\n    unjittered_uv = uv;\n\n    vec3 tl = texture2D(currentTex, unjittered_uv + vec2(-texelSize.x, texelSize.y)).rgb;\n    vec3 t = texture2D(currentTex, unjittered_uv + vec2(0.0, texelSize.y)).rgb;\n    vec3 tr = texture2D(currentTex, unjittered_uv + vec2(texelSize.x, texelSize.y)).rgb;\n    vec3 ml = texture2D(currentTex, unjittered_uv + vec2(-texelSize.x, 0.0)).rgb;\n    vec3 m = texture2D(currentTex, unjittered_uv + vec2(0.0, 0.0 )).rgb;\n    vec3 mr = texture2D(currentTex, unjittered_uv + vec2(texelSize.x, 0.0)).rgb;\n    vec3 bl = texture2D(currentTex, unjittered_uv + vec2(-texelSize.x, -texelSize.y)).rgb;\n    vec3 b = texture2D(currentTex, unjittered_uv + vec2(0.0, -texelSize.y)).rgb;\n    vec3 br = texture2D(currentTex, unjittered_uv + vec2(texelSize.x, -texelSize.y)).rgb;\n\n    // https://github.com/Unity-Technologies/PostProcessing/blob/v1/PostProcessing/Resources/Shaders/TAA.cginc#L143\n    // reduces blurring, but increases flickering with dense geometry\n    if(useSharpen){\n        vec3 corners = 2.0 * (tr + bl + br + tl) - 2.0 * texel0;\n        texel0 += (texel0 - (corners * 0.166667)) * 2.718282 * 0.3;\n        texel0 = max(vec3(0.0), texel0);\n    }\n\n    vec3 cmin = min(tl, min(t, min(tr, min(ml, min(m, min(mr, min(bl, min(b, br))))))));\n    vec3 cmax = max(tl, max(t, max(tr, max(ml, max(m, max(mr, max(bl, max(b, br))))))));\n\n    vec3 cavg = tl + t + tr + ml + m + mr + bl + b + br;\n    cavg /= 9.0;\n\n    // Brian Karis neighbourhood rounding: http://advances.realtimerendering.com/s2014/epic/TemporalAA.pptx\n    vec3 cmin5 = min(mr, min(m, min(ml, min(t, b))));\n    vec3 cmax5 = max(mr, max(m, max(ml, max(t, b))));\n    vec3 cavg5 = (mr + m + ml + t + b) / 5.0;\n\n    cmin = 0.5 * (cmin + cmin5);\n    cmax = 0.5 * (cmax + cmax5);\n    cavg = 0.5 * (cavg + cavg5);\n\n    texel1 = clip_aabb_opti(cmin, cmax, clamp(cavg, cmin, cmax), texel1);\n\n#ifndef FEEDBACK_MIN\n#define FEEDBACK_MIN 0.0\n#define FEEDBACK_MAX 1.0\n#endif\n    const vec2 feedbackRange = vec2(FEEDBACK_MIN, FEEDBACK_MAX); // playdead's default values\n\n    float lum0 = luminance(texel0.rgb);\n    float lum1 = luminance(texel1.rgb);\n\n    float diff = abs(lum0 - lum1) / max(lum0, max(lum1, 0.2));\n    float unbiased_weight = 1.0 - diff;\n    float feedback = mix(feedbackRange.x, feedbackRange.y, unbiased_weight * unbiased_weight);\n\n    vec3 color = mix(texel0, texel1, feedback);\n    return color;\n}\n\nvec2 computeSSVelocity(const in vec3 wsPos, const in mat4 currentFrameProjView, const in mat4 lastFrameProjView, const in bool rightEye)\n{\n    vec4 ssCurrentPos = currentFrameProjView * vec4(wsPos, 1.0);\n    vec4 ssPrevPos = lastFrameProjView * vec4(wsPos, 1.0);\n\n    vec2 ndcCurrent = ssCurrentPos.xy / ssCurrentPos.w;\n    vec2 ndcPrev = ssPrevPos.xy / ssPrevPos.w;\n\n    //ndcPrev = clamp(ndcPrev, vec2(-1.0), vec2(1.0));\n    if( ndcPrev.x >= 1.0 || ndcPrev.x <= -1.0 || ndcPrev.x >= 1.0 || ndcPrev.y <= -1.0 )\n        return vec2(0.0);\n\n#ifdef VR_ENABLED\n    ndcCurrent.x /= 2.0;\n    ndcPrev.x /= 2.0;\n\n    if( rightEye ) {\n        ndcCurrent.x += 0.5;\n        ndcPrev.x += 0.5;\n    }\n#endif\n\n    return 0.5 * (ndcCurrent - ndcPrev);\n}\n\n// static in place amortized supersampling\nvec3 supersample(const in sampler2D currentTex, const in sampler2D prevTex, const in vec2 uv,\n    const in vec2 texSize, const in vec4 halton) {\n\n    vec3 currFragColor = texture2D(currentTex, uv).rgb;\n\n    float haltz = abs(halton.z);\n    if(haltz == 1.0) {\n        // just return the color.\n        return currFragColor;\n    }\n\n    // same pixel for same projected interpolated vertex on prev frame\n    vec3 accumColorN = textureNearest2D(prevTex, uv.xy, texSize).rgb;\n\n    // mix frames\n    float lerpFac = 1.0 / halton.w;\n\n#ifdef TAA_ACCUM\n    if(uHalton.w == 1.0) lerpFac = 0.0;\n#endif\n\n    if (haltz == 3.0) {\n        // No supersample, crude motion blur by accumulation\n        return mix(currFragColor, accumColorN, lerpFac);\n    }\n\n    // Supsersample, accumulation + jittering\n    // http://en.wikipedia.org/wiki/Moving_average#Cumulative_moving_average\n    // cumulative moving average over frameNum (which starts at 2)\n    // n is previous frame\n    // accumColorN = Accum(n)\n    // return value is accumColor( n +1 )\n    // Accum(n+1) = Accum(n) + ((x(n+1) - Accum(n)) / (n + 1)))\n    // formula above is equal to glsl  mix\n    return mix(accumColorN, currFragColor, lerpFac);\n}\n\nvec3 computeTaa(const in sampler2D currentTex, const in sampler2D prevTex, const in vec2 uv, const in vec2 texSize, const in vec4 halton,\n    const in sampler2D texDepth, const in vec2 nearFar, const in mat4 invView, const in mat4 currentFrameProjView, const in mat4 lastFrameProjView,\n    const in vec3 corners[4], const in float alpha, const in bool useSharpen) {\n\n    vec2 texelSize = vec2(1.0) / texSize;\n\n    // halton offsets vertices in ndc space, thus we have to convert them to screenspace in order to use it\n    vec2 jitter = ( halton.xy * vec2(0.5) ) * texelSize;\n\n    float haltz = abs(halton.z);\n\n    if (haltz == 1.0) {\n        vec3 closest = closestFragment(texDepth, uv, texelSize);\n\n        // discard background fragments to save fillrate\n        // make sure the mesh isn't transparent\n        if( closest.z >= 1.0\n#ifdef TAA_TRANSPARENT\n            && alpha == 0.0\n#endif\n        )\n#ifdef TAA_VR_FXAA\n            return fxaa(currentTex, uv-jitter, texSize);\n#else\n            return texture2D(currentTex, uv-jitter).rgb;\n#endif\n\n        float depth = -(nearFar.x + (nearFar.y - nearFar.x) * closest.z);\n        vec3 ws = reconstructWSPosition(closest.xy, corners, invView, depth);\n\n        vec2 ssVel = computeSSVelocity(ws, currentFrameProjView, lastFrameProjView, uv.x >= 0.5);\n\n        return taa(currentTex, prevTex, uv, ssVel, texelSize, jitter, useSharpen);\n    }\n\n    return supersample(currentTex, prevTex, uv, texSize, halton);\n}\n\n// temporal anti-aliasing from Playdead's Inside\n// slides: http://www.gdcvault.com/play/1022970/Temporal-Reprojection-Anti-Aliasing-in\n// sources: https://github.com/playdeadgames/temporal\nvec3 supersampleTaa(const in sampler2D currentTex, const in sampler2D prevTex, const in vec2 uv, const in vec2 texSize, const in vec4 halton,\n    const in sampler2D texDepth, const in vec2 nearFar, const in float enableTaa, const in float alpha, const in mat4 invViewLeft,\n    const in mat4 currentFrameProjViewLeft, const in mat4 lastFrameProjViewLeft, const in vec3 cornersLeft[4]\n#ifdef VR_ENABLED\n    , const in mat4 invViewRight, const in mat4 currentFrameProjViewRight, const in mat4 lastFrameProjViewRight, const in vec3 cornersRight[4]\n#endif\n    ) {\n\n    if( enableTaa == 0.0 )\n        return supersample(currentTex, prevTex, uv, texSize, halton);\n\n#ifdef VR_ENABLED\n    // left and right eyes have different matrices\n    if( uv.x >= 0.5 )\n        return computeTaa(currentTex, prevTex, uv, texSize, halton, texDepth, nearFar, invViewRight, currentFrameProjViewRight, lastFrameProjViewRight, cornersRight, alpha, true);\n    else\n        return computeTaa(currentTex, prevTex, uv, texSize, halton, texDepth, nearFar, invViewLeft, currentFrameProjViewLeft, lastFrameProjViewLeft, cornersLeft, alpha, true);\n#else\n#ifdef TAA_SPLIT_SCREEN\n    if( uv.x > 0.5015 ) {\n        return supersample(currentTex, prevTex, uv, texSize, halton);\n    }\n    else if( uv.x > 0.4985 )\n        return vec3( 0.0 );\n    else\n        return computeTaa(currentTex, prevTex, uv, texSize, halton, texDepth, nearFar, invViewLeft, currentFrameProjViewLeft, lastFrameProjViewLeft,\n            cornersLeft, alpha, true);\n#endif\n    return computeTaa(currentTex, prevTex, uv, texSize, halton, texDepth, nearFar, invViewLeft, currentFrameProjViewLeft, lastFrameProjViewLeft,\n            cornersLeft, alpha, true);\n#endif\n}"},function(e,t){e.exports="// https://github.com/borismus/webvr-boilerplate/blob/master/src/distortion/barrel-distortion-fragment-v2.js\n\nvec2 barrel(const in vec2 v, const in vec4 projection, const in vec4 unprojection, const in vec2 distort) {\n  vec2 w = (v + unprojection.zw) / unprojection.xy;\n  float val = dot(w, w);\n  // float poly = (showCenter == 1 && val < 0.00010) ? 10000.0 : 1.0 + (distort.x + distort.y * val) * val;\n  float poly = 1.0 + (distort.x + distort.y * val) * val;\n  return projection.xy * (poly * w) - projection.zw;\n}\n\nvec2 distortion(const in vec2 texCoord, const in vec2 distort, const in vec4 projectionLeft, const in vec4 unprojectionLeft) {\n\n  if (abs(texCoord.x - 0.5) < .001) {\n    discard;\n  }\n\n  vec2 a;\n\n  if (texCoord.x < 0.5){\n    a = barrel(vec2(texCoord.x / 0.5, texCoord.y), projectionLeft, unprojectionLeft, distort);\n  } else {\n    // right projections are shifted and vertically mirrored relative to left\n    const vec3 swi = vec3(1.0, -1.0, 0.0);\n    vec4 projectionRight = (projectionLeft + swi.zzxz) * swi.xxyx;\n    vec4 unprojectionRight = (unprojectionLeft + swi.zzxz) * swi.xxyx;\n    a = barrel(vec2((texCoord.x - 0.5) / 0.5, texCoord.y), projectionRight, unprojectionRight, distort);\n  }\n\n  if (a.x < 0.0 || a.x > 1.0 || a.y < 0.0 || a.y > 1.0) {\n    discard;\n  }\n\n  return vec2(a.x * 0.5 + (texCoord.x < 0.5 ? 0.0 : 0.5), a.y);\n}"},function(e,t){e.exports='#pragma include "functions.glsl"\n\nconst float MAX_BLUR = 16.0;\nconst float EPS_EARLY_OUT = 0.01; // early out (typically when we move the camera fast and the dof might be not effective)\n\nfloat texDepthToCoC(const in sampler2D texDepth, const in vec2 uv, const in vec4 dofBlurNearFarFocal) {\n    vec3 fetch = texture2D(texDepth, uv).rgb;\n    // background should be always max blurred so that the near blur can expand onto the background (because of special dilate background codepath below)\n    if(fetch.x == 1.0) return max(dofBlurNearFarFocal.x, dofBlurNearFarFocal.y);\n\n    float coc = dot(fetch.rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n    coc = clamp((coc - dofBlurNearFarFocal.z) / coc, -1.0, 1.0);\n    return (coc < 0.0 ? coc * dofBlurNearFarFocal.x : coc * dofBlurNearFarFocal.y);\n}\n\n// ------- DOWNSAMPLE COC ---------\nvec4 dofDownsampleCoC(const in sampler2D texDepth, const in vec2 uv, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    return vec4(vec3(0.0), texDepthToCoC(texDepth, uv, dofBlurNearFarFocal) * 0.5 + 0.5);\n}\n\n// ------- DOWNSAMPLE COLOR ---------\nvec4 dofDownsampleColor(const in sampler2D texColor, const in vec2 uv) {\n    return texture2D(texColor, uv);\n}\n\nvec4 dofDownsampleColor(const in sampler2D texColor, const in vec2 uv, const in sampler2D texCoC) {\n    return vec4(decodeRGBM(texture2D(texColor, uv), 7.0), texture2D(texCoC, uv).a);\n}\n\nfloat dilateNear(const in sampler2D texCoC, const in vec2 uv, const in vec2 offset, const in bool isBG) {\n    // TODO DOF both the weights and the formula can be tweaked, also we could add a bit of jitter or something\n\n    float coc = 0.0;\n    vec2 ofs = MAX_BLUR * offset / 5.0;\n\n    float coc0 = texture2D(texCoC, uv).a * 2.0 - 1.0;\n    float coc1 = texture2D(texCoC, uv - 5.0 * ofs).a * 2.0 - 1.0;\n    float coc2 = texture2D(texCoC, uv - 4.0 * ofs).a * 2.0 - 1.0;\n    float coc3 = texture2D(texCoC, uv - 3.0 * ofs).a * 2.0 - 1.0;\n    float coc4 = texture2D(texCoC, uv - 2.0 * ofs).a * 2.0 - 1.0;\n    float coc5 = texture2D(texCoC, uv - 1.0 * ofs).a * 2.0 - 1.0;\n    float coc6 = texture2D(texCoC, uv + 1.0 * ofs).a * 2.0 - 1.0;\n    float coc7 = texture2D(texCoC, uv + 2.0 * ofs).a * 2.0 - 1.0;\n    float coc8 = texture2D(texCoC, uv + 3.0 * ofs).a * 2.0 - 1.0;\n    float coc9 = texture2D(texCoC, uv + 4.0 * ofs).a * 2.0 - 1.0;\n    float coc10 = texture2D(texCoC, uv + 5.0 * ofs).a * 2.0 - 1.0;\n\n    if(isBG == true){\n        // avoid "shrink" effect on the out of focus far part on the model edges\n        // gaussian weights (sigma 10), (doesn\'t have to be gaussian though), but the sum must be 1.0\n        // http://dev.theomader.com/gaussian-kernel-calculator/\n        coc = abs(coc0) * 0.095474 +\n        (abs(coc1) + abs(coc10)) * 0.084264 +\n        (abs(coc2) + abs(coc9)) * 0.088139 +\n        (abs(coc3) + abs(coc8)) * 0.091276 +\n        (abs(coc4) + abs(coc7)) * 0.093585 +\n        (abs(coc5) + abs(coc6)) * 0.094998;\n    } else {\n        // blur only near field (expand)\n        coc = min(coc0, 0.0);\n        coc = min(coc1 * 0.3, coc);\n        coc = min(coc2 * 0.5, coc);\n        coc = min(coc3 * 0.75, coc);\n        coc = min(coc4 * 0.8, coc);\n        coc = min(coc5 * 0.95, coc);\n        coc = min(coc6 * 0.95, coc);\n        coc = min(coc7 * 0.8, coc);\n        coc = min(coc8 * 0.75, coc);\n        coc = min(coc9 * 0.5, coc);\n        coc = min(coc10 * 0.3, coc);\n        if(abs(coc0) > abs(coc))\n            coc = coc0;\n    }\n\n    return coc;\n}\n\n// ------- DILATE NEAR H ---------\nvec4 dofDilateNearH(const in sampler2D texCoC, const in sampler2D texDepth, const in vec2 uv, const in vec2 texSize,\n    const in float dofScale, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    vec2 offset = vec2( dofScale / texSize.x, 0.0);\n    float coc = dilateNear(texCoC, uv, offset, texture2D(texDepth, uv).x == 1.0);\n\n    return vec4(0.0, 0.0, 0.0, coc * 0.5 + 0.5);\n}\n\n// ------- DILATE NEAR V ---------\nvec4 dofDilateNearV(const in sampler2D texCoC, const in sampler2D texDepth,  const in vec2 uv, const in vec2 texSize,\n    const in float dofScale, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n    \n    vec2 offset = vec2(0.0, dofScale / texSize.y);\n    float coc = dilateNear(texCoC, uv, offset, texture2D(texDepth, uv).x == 1.0);\n\n    return vec4(0.0, 0.0, 0.0, coc * 0.5 + 0.5);\n}\n\nfloat nrand(const in vec3 uvt) {\n  vec3 p3 = fract(uvt * 443.8975);\n  p3 += dot(p3, p3.yzx + 19.19);\n  return fract((p3.x + p3.y) * p3.z);\n}\n\n#ifndef DOF_TAP\n#define DOF_TAP(id)  \n#endif\n\nvec4 dofBlur16(const in sampler2D texColor, const in sampler2D texCoC, const in vec2 uv, const in vec2 blurDist, const in float ntime) {\n    float rnd = 6.28318 * nrand(vec3(uv, 0.07 * fract(ntime)));\n    float cosa = cos(rnd);\n    float sina = sin(rnd);\n    vec4 basis = vec4(cosa, -sina, sina, cosa);\n\n    vec4 sumcol = vec4(0.0);\n\n    float total = 0.0;\n\n    vec2 fTaps_Poisson[17];\n    // https://github.com/bartwronski/PoissonSamplingGenerator\n    fTaps_Poisson[0] = vec2(0.343280198355, 0.921191856785);\n    fTaps_Poisson[1] = vec2(-0.116859107262, 0.873056831344);\n    fTaps_Poisson[2] = vec2(-0.646421287853, 0.760425284853);\n    fTaps_Poisson[3] = vec2(-0.0437332058416, 0.47196719804);\n    fTaps_Poisson[4] = vec2(0.48240473891, 0.464894594736);\n    fTaps_Poisson[5] = vec2(-0.718897237297, 0.352191304304);\n    fTaps_Poisson[6] = vec2(-0.939061387886, -0.0387376698953);\n    fTaps_Poisson[7] = vec2(0.546569494557, -0.0169516524446);\n    fTaps_Poisson[8] = vec2(-0.182644095652, -0.0702667761349);\n    fTaps_Poisson[9] = vec2(-0.576191305396, -0.252368997099);\n    fTaps_Poisson[10] = vec2(0.921914032366, -0.366530187909);\n    fTaps_Poisson[11] = vec2(-0.0582053944545, -0.510617206206);\n    fTaps_Poisson[12] = vec2(-0.783101528934, -0.601411360136);\n    fTaps_Poisson[13] = vec2(0.430604354377, -0.729559481383);\n    fTaps_Poisson[14] = vec2(-0.350716524868, -0.809522919973);\n    fTaps_Poisson[15] = vec2(0.0600898835968, -0.952568587297);\n    fTaps_Poisson[16] = vec2(0.0, 0.0); // dummy because of intel off-by-one bug\n\n    // for (int i = 0; i < 16; i++) {\n    //     vec2 ofs = fTaps_Poisson[i];\n\n    //     ofs = vec2(dot(ofs, basis.xy), dot(ofs, basis.zw) );\n\n    //     vec3 sample = decodeRGBM(texture2D(texColor, uv + blurDist * ofs), 7.0);\n\n    //     // TODO DOF premult to avoid bleeding, can be tweaked (currently x^3)\n    //     // tradeoff between bleeding dof and out of focus object that shrinks too much\n    //     float cocWeight = abs(sample.a * 2.0 - 1.0);\n    //     cocWeight *= cocWeight * cocWeight;\n\n    //     sumcol.rgb += decodeRGBM(texture2D(texColor, ofs), 7.0) * cocWeight;\n    //     sumcol.a += cocWeight;\n    // }\n\n    vec2 ofs;\n    vec4 sampleTex;\n    float cocWeight;\n\n    DOF_TAP(0);\n    DOF_TAP(1);\n    DOF_TAP(2);\n    DOF_TAP(3);\n    DOF_TAP(4);\n    DOF_TAP(5);\n    DOF_TAP(6);\n    DOF_TAP(7);\n    DOF_TAP(8);\n    DOF_TAP(9);\n    DOF_TAP(10);\n    DOF_TAP(11);\n    DOF_TAP(12);\n    DOF_TAP(13);\n    DOF_TAP(14);\n    DOF_TAP(15);\n\n    return sumcol;\n}\n\n// ------- BLUR CIRCULAR ---------\nvec4 dofBlurCircular(const in sampler2D texColor, const in sampler2D texCoC, const in vec2 uv, const in vec2 texSize, const in float ntime,\n    const in float dofScale, const in vec4 dofBlurNearFarFocal) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return vec4(0.0);\n\n    vec2 blurDist = (1.0 / texSize.xy) * MAX_BLUR * abs(texture2D(texCoC, uv).a * 2.0 - 1.0) * dofScale;\n\n    // TODO optimize dofBlur16 (unroll...)\n    vec4 sumcol = dofBlur16(texColor, texCoC, uv, blurDist, ntime); // 16\n    if(dofBlurNearFarFocal.w > 0.5) sumcol += dofBlur16(texColor, texCoC, uv, blurDist, ntime + 0.532524); // 32\n    if(dofBlurNearFarFocal.w > 1.5) sumcol += dofBlur16(texColor, texCoC, uv, blurDist, ntime + 0.798742); // 48\n    if(dofBlurNearFarFocal.w > 2.5) sumcol += dofBlur16(texColor, texCoC, uv, blurDist, ntime + 0.175857); // 64\n\n    return encodeRGBM(sumcol.rgb / sumcol.a, 7.0);\n}\n\n// ------- DOF COMBINE ---------\nvec3 dofCombine(const in vec3 color, const in sampler2D texBlur, const in sampler2D texCoC, const in sampler2D texDepth, const in vec2 uv,\n    const in float range, const in vec2 texSize, const in float dofScale, const in vec4 dofBlurNearFarFocal, const in float blurDiv) {\n\n    if(dofBlurNearFarFocal.x < EPS_EARLY_OUT && dofBlurNearFarFocal.y < EPS_EARLY_OUT) return color;\n\n    // half res color\n    vec3 blur = decodeRGBM(texture2D(texBlur, uv), range);\n    vec2 off = vec2(1.0, -1.0) * dofScale * blurDiv;\n    blur += decodeRGBM(texture2D(texBlur, uv + off.xx / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.yy / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.xy / texSize), range);\n    blur += decodeRGBM(texture2D(texBlur, uv + off.yx / texSize), range);\n    blur /= 5.0;\n\n    // merge full res and half res coc\n    float coc = abs(min(texture2D(texCoC, uv).a * 2.0 - 1.0, texDepthToCoC(texDepth, uv, dofBlurNearFarFocal)));\n\n    // merge half res blurred color and full res pixels\n    float cocLower = 0.05;\n    float cocHigher = 0.3;\n    return mix(color, blur, smoothstep(cocLower, cocHigher, coc));\n}\n'},function(e,t){e.exports='#pragma include "functions.glsl"\n\nfloat getLuminance(const in vec3 color) {\n    // http://stackoverflow.com/questions/596216/formula-to-determine-brightness-of-rgb-color\n    const vec3 colorBright = vec3(0.2126, 0.7152, 0.0722);\n    return dot(color, colorBright);\n}\n\nfloat RGBToL(const in vec3 color) {\n    float fmin = min(min(color.r, color.g), color.b);\n    float fmax = max(max(color.r, color.g), color.b);\n    return (fmax + fmin) / 2.0;\n}\n\n// ------- TONE MAPPING ---------\n\nvec3 toneMapping(const in vec3 color, const in float expos, const in float bright, const in float contr, const in float satur, const in int method) {\n    vec3 col = color * expos;\n    float luminance = dot(col * (1.0 + bright), vec3(0.2126, 0.7152, 0.0722));\n    col = mix(vec3(luminance), col * (1.0 + bright), vec3(satur));\n    if (contr > 0.0)\n        col = (col - 0.5) / (1.0 - contr) + 0.5;\n    else if(contr < 0.0)\n        col = (col - 0.5) * (1.0 + contr) + 0.5;\n\n    // simple reinhard and filmic\n    // http://filmicgames.com/archives/190\n    if(method == 1) { // reinhard (on luminance)\n        col /= 1.0 + getLuminance(col);\n    } else if( method == 2) { // filmic\n        vec3 x = max(vec3(0.0), col - 0.004);\n        col = (x * (6.2 * x + 0.5) ) / ( x * (6.2 * x + 1.7) + 0.06);\n        col = pow(col, vec3(2.2)); // filmic curve already encode srgb to linear\n    }\n    return col;\n}\n\n// ------- COLOR BALANCE ---------\n\nvec3 colorBalance(const in vec3 color, const in vec3 lrgb, const in vec3 mrgb, const in vec3 hrgb) {\n    float cLen = length(color);\n    if(cLen < 1e-5)\n        return color;\n\n    // TODO : I have no idea what I am doing, we should use a curve widge\n    float lightness = RGBToL(color);\n    // \'  lightness=(lightness*0.9-1.0)/(lightness*2.0+1.0) +1.0;\n    lightness = (1.5 * lightness) / (lightness + 0.5);\n    // https://github.com/liovch/GPUImage/blob/master/framework/Source/GPUImageColorBalanceFilter\n    float a = 0.25;\n    float b = 0.333;\n    float scale = 0.7;\n    vec3 low = lrgb * clamp((lightness - b) / -a + 0.5, 0.0, 1.0);\n    vec3 mid = mrgb * clamp((lightness - b) / a + 0.5, 0.0, 1.0) * clamp((lightness + b - 1.0) / -a + 0.5, 0.0, 1.0);\n    vec3 high = hrgb * clamp((lightness + b - 1.0) / a + 0.5, 0.0, 1.0);\n    vec3 newColor = max(color + (low + mid + high) * scale, vec3(0.0));\n    // newColor can be negative\n    float len = length(newColor);\n    return len < 1e-5 ? newColor * cLen : newColor * cLen / len;\n}\n\n// ------- BLOOM ---------\n\nvec3 extractBright(const in vec3 color, const in float threshold) {\n    // TODO manage hdr pixel with high frequency? (use derivative??), for now we clamp the extracted pixel :(\n    return clamp(color * clamp(getLuminance(color) - threshold, 0.0, 1.0), 0.0, 1.0);\n}\n\nvec3 extractBright(const in vec3 color, const in float threshold, const in float alpha) {\n    return alpha == 0.0 ? vec3(0.0) : extractBright(color * alpha, threshold);\n}\n\n// ------- VIGNETTE ---------\n\nfloat vignetteDithered(const in vec2 uv, in vec2 lens){\n    // smoothesp is not realiable with edge0 == edge1\n    lens.y = min(lens.y, lens.x - 1e-4);\n\n    // same nrand as dof and noise, a blue noise might be better\n    vec3 p3 = fract(uv.xyx * 443.8975);\n    p3 += dot(p3, p3.yzx + 19.19);\n    float jitter = fract((p3.x + p3.y) * p3.z);\n\n    // jitter a bit the uv to remove the banding in some cases\n    // (lens.x - lens.y) reduce flickering when the vignette is harder (hardness)\n    // (lens.x + lens.y) reduce the flickering when the vignette has a strong radius\n    jitter = (lens.x - lens.y) * (lens.x + lens.y) * 0.03 * (jitter - 0.5);\n    return smoothstep(lens.x, lens.y, jitter + distance(uv, vec2(0.5)));\n}\n\nvec3 vignette(const in vec3 color, const in vec2 uv, const in vec2 lens) {\n    return color.rgb * vignetteDithered(uv, lens);\n}\n\n// when applied in the aa/ss pass srgb (no background case, also for performance reason if vignette is the ONLY mergeable postprocess)\n// there is a colorspace conversion to match the exact same vignette behaviour as with the other vignette (mergeable pass)\nvec4 vignette(const in vec4 color, const in vec2 uv, const in vec2 lens) {\n    float factor = vignetteDithered(uv, lens);\n    return vec4( linearTosRGB(sRGBToLinear(color.rgb) * factor), clamp(color.a + (1.0 - factor), 0.0, 1.0));\n}\n\n// ------- CHROMA ---------\n\nvec3 chromaticAberration(const in sampler2D tex, const in vec2 uv, const in float factor, const in float range) {\n    vec2 dist = uv - 0.5;\n    vec2 offset = factor * dist * length(dist);\n    vec3 col;\n    col.r = decodeRGBM(texture2D(tex, uv - offset), range).r;\n    col.g = decodeRGBM(texture2D(tex, uv), range).g;\n    col.b = decodeRGBM(texture2D(tex, uv + offset), range).b;\n    return col;\n}\n\n// ------- SHARPEN ---------\n\nvec3 sharpen(const in vec3 color, const in sampler2D tex,  const in vec2 uv, const in vec2 texSize, const in float sharp,\n    const in float pixelRatio) {\n    vec4 sw = pixelRatio * vec4(-1.0, 1.0, 1.0, -1.0) / texSize.xxyy;\n\n    // use useAA, 4 texFetch already in cache. perhaps we could cache ourself.\n    vec3 rgbNW = texture2D(tex, uv + sw.xw).rgb;\n    vec3 rgbNE = texture2D(tex, uv + sw.yw).rgb;\n    vec3 rgbSW = texture2D(tex, uv + sw.xz).rgb;\n    vec3 rgbSE = texture2D(tex, uv + sw.yz).rgb;\n\n    return color.rgb + sharp * (4.0 * color.rgb - rgbNW - rgbNE - rgbSW - rgbSE);\n}\n\nvec3 sharpen(const in vec3 color, const in sampler2D tex,  const in vec2 uv, const in vec2 texSize, const in float sharp,\n    const in float pixelRatio, const in float alpha) {\n    if(alpha == 0.0) return color;\n    return sharpen(color, tex, uv, texSize, sharp * alpha, pixelRatio);\n}\n\n// ------- COMPOSITION ---------\n\nvec4 composeExtra(const in vec3 color, const in float alpha, const in vec4 extra) {\n    vec4 outCol = extra + vec4(color.rgb, alpha) * (1.0 - extra.a);\n    return outCol;\n}\n\nvec3 composeBackgroundColor(const in vec3 color, const in float alpha, const in vec3 background) {\n    return color + background * (1.0 - alpha);\n}\n\n// ------- GRAIN ---------\n\n// https://www.shadertoy.com/view/4djSRW\n// quote : "[...] it gives the same result on PCs and Macs/iOS etc. [...] The sine stuff varies a lot between GPUs."\n\n// integer : 0.1031, uv (0,1 range): 443.8975\nfloat nrand(const in vec3 uvt) {\n  vec3 p3 = fract(uvt * 443.8975);\n  p3 += dot(p3, p3.yzx + 19.19);\n  return fract((p3.x + p3.y) * p3.z);\n}\n\nfloat nrandTriangle(const in vec3 n) {\n    float nrnd0 = nrand( n );\n\n    // Convert uniform distribution into triangle-shaped distribution.\n    float orig = nrnd0 * 2.0 - 1.0;\n    nrnd0 = orig * inversesqrt(abs(orig));\n    nrnd0 = max(-1.0, nrnd0); // Nerf the NaN generated by 0 * rsqrt(0). Thanks @FioraAeterna!\n    nrnd0 = nrnd0 - sign(orig) + 0.5;\n\n    // Result is range [-0.5,1.5] which is useful for actual dithering. convert to [0,1] for histogram.\n    return (nrnd0 + 0.5) * 0.5;\n    // return nrnd0;\n}\n\nvec3 grain(const in vec3 color, const in vec2 uv, const in float time, const in float factor) {\n    float grainFactor = nrandTriangle(vec3(uv, fract(time) * 0.07));\n    return mix(color, color * (color + (1.0 - color) * 2.0 * grainFactor), factor);\n}\n\n// ------- DOF CROSS ---------\n\nvec3 dofCross(const in vec3 color, const in vec2 uv, const in vec2 renderSize, const in float pixelRatio, const in vec3 dofCrossUniforms) {\n    float ratio = renderSize.y / renderSize.x;\n    float dist = distance(vec2(dofCrossUniforms.x, dofCrossUniforms.y * ratio), vec2(uv.x, uv.y * ratio));\n    float widthCircle = pixelRatio / renderSize.x;\n    return mix(color, vec3(1.0), abs(dist - 60.0 * widthCircle) > widthCircle ? 0.0 : dofCrossUniforms.z);\n}'},function(e,t){e.exports='#pragma include "functions.glsl"\n\n#define NB_SAMPLES 11\n// Constant used to scale the depth view value that is given to the blur pass\n#define MIN_RADIUS 1.0\n#define NB_SPIRAL_TURNS 3.0\n\nfloat zValueFromScreenSpacePosition(const in sampler2D texDepth, const in vec2 uv, const in vec2 nearFar) {\n    float d = dot(texture2D(texDepth, uv).rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n    return nearFar.x + (nearFar.y - nearFar.x) * d;\n}\n\nvec3 reconstructCSPosition(const in vec2 ssP, const in float z, const in vec4 projInfo) {\n    return vec3((ssP.xy * projInfo.xy + projInfo.zw) * z, z);\n}\n\nvec3 getPosition(const in sampler2D texDepth, const in vec2 uv, const in vec2 texSize, const in vec4 projInfo, const in vec2 nearFar) {\n    return reconstructCSPosition(uv * texSize, zValueFromScreenSpacePosition(texDepth, uv, nearFar), projInfo);\n}\n\n# define MAX_MIP_LEVEL 5\n// Determines at which point we should switch mip level\n// if number is too small (~3) will lead to flashing (bad variance as many taps give same pixel)\n// if number is too high, mip level are not used well and the cache is not used efficiently\n# define LOG_MAX_OFFSET 3\n\nvec3 getOffsetedPixelPos(\n    const in sampler2D texmip0,\n    const in sampler2D texmip1,\n    const in sampler2D texmip2,\n    const in sampler2D texmip3,\n    const in sampler2D texmip4,\n    const in sampler2D texmip5,\n    const in vec2 uv,\n    const in vec2 unitOffset,\n    const in float screenSpaceRadius,\n    const in vec4 projInfo,\n    const in vec2 texSize,\n    const in vec2 nearFar ) {\n\n    int mipLevel = int(clamp(floor(log2(screenSpaceRadius)) - float(LOG_MAX_OFFSET), 0.0, float(MAX_MIP_LEVEL)));\n    vec2 uvOff = uv + floor(screenSpaceRadius * unitOffset) / texSize;\n\n    float d;\n    if (mipLevel == 1) d = zValueFromScreenSpacePosition(texmip1, uvOff, nearFar);\n    else if (mipLevel == 2) d = zValueFromScreenSpacePosition(texmip2, uvOff, nearFar);\n    else if (mipLevel == 3) d = zValueFromScreenSpacePosition(texmip3, uvOff, nearFar);\n    else if (mipLevel == 4) d = zValueFromScreenSpacePosition(texmip4, uvOff, nearFar);\n    else if (mipLevel == 5) d = zValueFromScreenSpacePosition(texmip5, uvOff, nearFar);\n    else d = zValueFromScreenSpacePosition(texmip0, uvOff, nearFar);\n\n    return reconstructCSPosition(uvOff * texSize, d, projInfo);\n}\n\nfloat nrand(const in vec3 uvt) {\n  vec3 p3 = fract(uvt * 443.8975);\n  p3 += dot(p3, p3.yzx + 19.19);\n  return fract((p3.x + p3.y) * p3.z);\n}\n\n#define PIOVER8 0.39269908169\nvec3 unpackNormal1(const in float pack1) {\n    float pack8 = floor(pack1 * 255.0);\n    float th = PIOVER8 * float(pack8 / 16.0);\n    float len = sqrt(mod(float(pack8), 16.0) / 15.001);\n    vec2 nv = vec2(cos(th), sin(th)) * len;\n    return -vec3(nv.x, nv.y, sqrt(max(0.0, 1.0 - nv.x * nv.x - nv.y * nv.y)));\n}\n\nvec3 unpackNormal2(const in vec2 pack2) {\n    vec3 nv = pack2.rgg * 2.0 - 1.0;\n    return -vec3(nv.x, nv.y, sqrt(max(0.0, 1.0 - nv.x * nv.x - nv.y * nv.y)));\n}\n\n#ifndef SSAO_TAP_EXTRACT\n#define SSAO_TAP_EXTRACT(id)  \n#endif\n\nvec4 ssaoExtract(\n        const in sampler2D texDepth,\n        const in vec2 uv,\n        const in vec2 nearFar,\n        const in float radius,\n        const in float intensity,\n        const in float bias,\n        const in vec4 projInfo,\n        const in float projScale,\n        const in vec2 texSize,\n        const in float time,\n        const in sampler2D texDepth1,\n        const in sampler2D texDepth2,\n        const in sampler2D texDepth3,\n        const in sampler2D texDepth4,\n        const in sampler2D texDepth5) {\n\n    vec3 depthPacked = texture2D(texDepth, uv).rgb;\n    vec3 cameraSpacePosition = getPosition(texDepth, uv, texSize, projInfo, nearFar);\n    float ssRadius = -projScale * radius / cameraSpacePosition.z;\n\n#ifdef SSAO_NORMAL\n    vec3 normal = unpackNormal2(texture2D(texDepth, uv).ba); // g buffer normal 2 component on ba\n#elif defined(GL_OES_standard_derivatives) && !defined(MOBILE)\n    vec3 normal = cross(dFdy(cameraSpacePosition), dFdx(cameraSpacePosition));\n#else\n    vec3 cam0 = getPosition(texDepth, uv - vec2(1.0, 0.0) / texSize, texSize, projInfo, nearFar);\n    vec3 cam1 = getPosition(texDepth, uv + vec2(1.0, 0.0) / texSize, texSize, projInfo, nearFar);\n    vec3 cam2 = getPosition(texDepth, uv - vec2(0.0, 1.0) / texSize, texSize, projInfo, nearFar);\n    vec3 cam3 = getPosition(texDepth, uv + vec2(0.0, 1.0) / texSize, texSize, projInfo, nearFar);\n    vec3 normal = cross(cam0 - cam1, cam3 - cam2);\n#endif\n\n    // early return background or radius too small (should be check after derivatives usage)\n    if (depthPacked.x == 1.0 || ssRadius < MIN_RADIUS) {\n        return vec4(1.0, depthPacked);\n    }\n\n    normal = normalize(normal);\n    float nFalloff = mix(1.0, max(0.0, 1.5 * normal.z), 0.35);\n\n    float randomAngle = nrand(vec3(uv, 0.07 * fract(time))) * 6.3; // needs to be > 2PI\n\n    float invRadius2 = 1.0 / (radius * radius);\n    float contrib = 0.0;\n    // for (int i = 0; i < NB_SAMPLES; ++i) {\n    //     float screenSpaceRadius = (float(i) + 0.5) * (1.0 / float(NB_SAMPLES));\n    //     float angle = screenSpaceRadius * (NB_SPIRAL_TURNS * 6.28) + randomAngle;\n    //     screenSpaceRadius = max(0.75, screenSpaceRadius * ssRadius);\n    //     vec2 offsetUnitVec = vec2(cos(angle), sin(angle));\n    //     vec3 occludingPoint = getOffsetedPixelPos(texDepth, texDepth1, texDepth2, texDepth3, texDepth4, texDepth5, uv, offsetUnitVec, screenSpaceRadius, projInfo, texSize, nearFar);\n    //     occludingPoint -= cameraSpacePosition;\n    //     float vv = dot(occludingPoint, occludingPoint);\n    //     float vn = dot(occludingPoint, normal);\n    //     contrib += max(1.0 - vv * invRadius2, 0.0) * max((vn - bias) * inversesqrt(vv), 0.0);\n    // }\n\n    // ---- UNROLL ----\n    float vv;\n    float vn;\n    float screenSpaceRadius;\n    float angle;\n    vec3 occludingPoint;\n    vec2 offsetUnitVec;\n    SSAO_TAP_EXTRACT(0);\n    SSAO_TAP_EXTRACT(1);\n    SSAO_TAP_EXTRACT(2);\n    SSAO_TAP_EXTRACT(3);\n    SSAO_TAP_EXTRACT(4);\n    SSAO_TAP_EXTRACT(5);\n    SSAO_TAP_EXTRACT(6);\n    SSAO_TAP_EXTRACT(7);\n    SSAO_TAP_EXTRACT(8);\n    SSAO_TAP_EXTRACT(9);\n    SSAO_TAP_EXTRACT(10);\n    // ---- UNROLL ----\n\n    float aoValue = max(0.0, 1.0 - sqrt(contrib * nFalloff / float(NB_SAMPLES)));\n    aoValue = pow(aoValue, 10.0 * intensity);\n\n    vec4 aoDepth;\n    aoDepth.r = mix(1.0, aoValue, clamp(ssRadius - MIN_RADIUS, 0.0, 1.0));\n    aoDepth.gba = depthPacked;\n\n    return aoDepth;\n}\n\n#define SSAO_FILTER_RADIUS 3\n\n#ifndef SSAO_TAP_BLUR\n#define SSAO_TAP_BLUR(id, absid)  \n#endif\n\nvec4 ssaoBlur(const in sampler2D texSsao, const in vec2 uv, const in vec2 axis, const in vec2 nearFar) {\n\n    vec4 aoDepth = texture2D(texSsao, uv);\n\n    // background\n    if(aoDepth.y == 1.0){\n        return aoDepth;\n    }\n\n    float initialZ = dot(aoDepth.gba, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n\n    float gaussian[SSAO_FILTER_RADIUS + 2]; // dummy because of intel off-by-one bug\n    gaussian[0] = 0.153170;\n    gaussian[1] = 0.144893;\n    gaussian[2] = 0.122649;\n    gaussian[3] = 0.092902;\n    gaussian[4] = 0.0;\n\n    float totalWeight = gaussian[0];\n    float sum = aoDepth.r * totalWeight;\n    float sharpnessFactor = 400.0;\n\n    // for (int r = - SSAO_FILTER_RADIUS; r <= SSAO_FILTER_RADIUS; ++r) {\n    //     if (r != 0) {\n    //         vec4 sample = texture2D(texSsao, uv + axis * float(r) * SSAO_SCALE);\n    //         float z = dot(sample.gba, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n    //         float weight = 0.3 + gaussian[int(abs(float(r)))];\n    //         weight *= max(0.0, 1.0 - sharpnessFactor * abs(z - initialZ));\n    //         sum += sample.r * weight;\n    //         totalWeight += weight;\n    //     }\n    // }\n\n    // ---- UNROLL ----\n    vec2 ofs;\n    float z;\n    float weight;\n    vec4 sampleTex;\n\n    SSAO_TAP_BLUR(-3, 3);\n    SSAO_TAP_BLUR(-2, 2);\n    SSAO_TAP_BLUR(-1, 1);\n    SSAO_TAP_BLUR(1, 1);\n    SSAO_TAP_BLUR(2, 2);\n    SSAO_TAP_BLUR(3, 3);\n    // ---- UNROLL ----\n\n    aoDepth.r = sum / totalWeight;\n    return aoDepth;\n}\n\nvec4 ssaoBlurH(const in sampler2D texSsao, const in vec2 uv, const in vec2 texSize, const in vec2 nearFar) {\n    return ssaoBlur(texSsao, uv, vec2(1.0, 0.0) / texSize, nearFar);\n}\n\nvec3 ssaoBlurV(const in sampler2D texSsao, const in vec2 uv, const in vec2 texSize, const in vec2 nearFar, const in vec3 color) {\n    return color * ssaoBlur(texSsao, uv, vec2(0.0, 1.0) / texSize, nearFar).rrr;\n}'},function(e,t){e.exports='varying vec2 vTexCoord0;\n\nuniform sampler2D uTexturePanel;\nuniform vec4 uHoveredArea;\nuniform float uHoveredOpaque;\nuniform float uAlpha;\nuniform float uRatio;\nuniform float uRound;\nuniform float uVeilFactor;\n\n#pragma include "functions.glsl"\n\n// signed distance to a 2D rounded box\nfloat sdRoundBox( const in vec2 p, const in vec2 b, const in float r ) {\n    vec2 q = abs(p) - b;\n    vec2 m = vec2( min(q.x,q.y), max(q.x,q.y) );\n    float d = (m.x > 0.0) ? length(q) : m.y;\n    return d - r;\n}\n\nvoid main(void) {\n  vec4 color = texture2D(uTexturePanel, vTexCoord0);\n\n  float lerpValue = step(0.0, -vTexCoord0.x);\n  lerpValue += step(1.0, vTexCoord0.x);\n\n  float round = uRound;\n  float left = uHoveredArea.x + round;\n  float right = uHoveredArea.y - round;\n  float top = uHoveredArea.z - round;\n  float bottom = uHoveredArea.w + round;\n\n  vec2 halfSize = abs(vec2(left - right, top - bottom) * 0.5);\n  vec2 center = vec2(halfSize.x + left, halfSize.y + bottom);\n\n  lerpValue += max(0.0, -sign(sdRoundBox( vTexCoord0 - center, halfSize, round)));\n\n  color.rgba = mix(color.rgba, color.rgba + vec4(0.109, 0.664, 0.848, step(0.1, uHoveredOpaque)), lerpValue);\n\n  color.a *= uAlpha;\n  color.rgb *= (color.a * uVeilFactor);\n\n  gl_FragColor = color;\n}\n'},function(e,t){e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\n\n// uniform mat4 uModelMatrix;\n// uniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat4 uModelViewMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n}\n"},function(e,t){e.exports='varying vec2 vLocalVertex;\n\nuniform float uAlpha;\nuniform int uOutputLinear;\nuniform vec3 uCursorColor;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uCursorColor, 1.0) * uAlpha * smoothstep(0.0, 1.0, 1.0 - 2.0 * length(vLocalVertex));\n\n  gl_FragColor = linearTosRGB(color);\n}\n'},function(e,t){e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vLocalVertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vLocalVertex = Vertex.xy;\n\n  vec3 posLocal = Vertex.xyz * 0.5;\n  posLocal += vec3(0.0, 0.0, 0.1);\n\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(posLocal, 1.0));\n}\n"},function(e,t){e.exports='varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureFloor;\nuniform float uScaleToMeter;\nuniform int uOutputLinear;\n\nvarying vec4 vViewPos;\nuniform sampler2D uTextureDepth;\nuniform vec2 RenderSize;\nuniform vec2 uNearFar;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  //manual depth test\n  float fragDepth = clamp( (-vViewPos.z * vViewPos.w - uNearFar.x) / (uNearFar.y - uNearFar.x), 0.0, 1.0);\n  float depth = dot(texture2D(uTextureDepth, gl_FragCoord.xy / RenderSize).rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));\n  if( depth <= fragDepth) discard;\n\n  float fade = smoothstep(0.0, 1.0, 1.0 - length(vTexCoord0 * 2.0 - 1.0));\n  vec4 color = vec4(fade * sRGBToLinear(texture2D(uTextureFloor, (vTexCoord0 * 1.0 - 0.5) * uScaleToMeter).r));\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},function(e,t){e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nvarying vec4 vViewPos;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n  vViewPos = uModelViewMatrix * vec4(Vertex.xyz, 1.0);\n  gl_Position = (uProjectionMatrix * vViewPos).xyww;\n}\n"},function(e,t){e.exports='uniform vec3 uColor;\nuniform int uOutputLinear;\n\nvarying float vHeight;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = vec4(uColor, 1.0) * smoothstep(1.0, 0.0, vHeight + 1.0);\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},function(e,t){e.exports="attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying float vHeight;\n\nvoid main(void) {\n  vHeight = Vertex.z;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},function(e,t){e.exports='varying vec3 vLocalVertex;\n\nuniform int uOutputLinear;\nuniform float uAlpha;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec4 color = linearTosRGB(vec4(0.1, 0.66, 0.85, 1.0)) * (smoothstep(1.0, 0.0, vLocalVertex.y) * smoothstep(1.0, 0.0, abs(vLocalVertex.x * 4.0))) * uAlpha;\n\n  gl_FragColor = color;\n}\n'},function(e,t){e.exports="attribute vec3 Vertex;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec3 vLocalVertex;\n\nvoid main(void) {\n  vLocalVertex = Vertex;\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(Vertex.xyz, 1.0));\n}\n"},function(e,t){e.exports='varying vec2 vTexCoord0;\n\nuniform sampler2D uTextureTeleportCircle;\nuniform float uScale;\nuniform float uAlpha;\nuniform int uOutputLinear;\n\n#pragma include "functions.glsl"\n\nvoid main(void) {\n  vec3 tex = sRGBToLinear(texture2D(uTextureTeleportCircle, vTexCoord0).rgb);\n  vec4 color = uScale == 1.0 ? vec4(tex.rrr, 1.0) * uAlpha * tex.g : vec4(uAlpha * tex.b);\n\n  gl_FragColor = uOutputLinear == 0 ? linearTosRGB(color) : color;\n}\n'},function(e,t){e.exports="attribute vec2 TexCoord0;\nattribute vec3 Vertex;\n\nvarying vec2 vTexCoord0;\nuniform float uScale;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main(void) {\n  vTexCoord0 = TexCoord0;\n\n  vec3 posLocal = Vertex.xyz * vec3(uScale, uScale, 1.0 - uScale);\n  gl_Position = uProjectionMatrix * (uModelViewMatrix * vec4(posLocal, 1.0));\n}\n"},function(e,t,i){!function(){var i,r=Array.prototype.forEach,n=Object.prototype.hasOwnProperty,a=Array.prototype.slice,o=0,s=function(){return{keys:Object.keys||function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("keys() called on a non-object");var t,i=[];for(t in e)e.hasOwnProperty(t)&&(i[i.length]=t);return i},uniqueId:function(e){var t=++o+"";return e?e+t:t},has:function(e,t){return n.call(e,t)},each:function(e,t,i){if(null!=e)if(r&&e.forEach===r)e.forEach(t,i);else if(e.length===+e.length)for(var n=0,a=e.length;n<a;n++)t.call(i,e[n],n,e);else for(var o in e)this.has(e,o)&&t.call(i,e[o],o,e)},once:function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments),e=null,t)}}}}();i={on:function(e,t,i){return l(this,"on",e,[t,i])&&t?(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:i,ctx:i||this}),this):this},once:function(e,t,i){if(!l(this,"once",e,[t,i])||!t)return this;var r=this,n=s.once(function(){r.off(e,n),t.apply(this,arguments)});return n._callback=t,this.on(e,n,i)},off:function(e,t,i){var r,n,a,o,u,c,h,d;if(!this._events||!l(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events={},this;for(o=e?[e]:s.keys(this._events),u=0,c=o.length;u<c;u++)if(e=o[u],a=this._events[e]){if(this._events[e]=r=[],t||i)for(h=0,d=a.length;h<d;h++)n=a[h],(t&&t!==n.callback&&t!==n.callback._callback||i&&i!==n.context)&&r.push(n);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=a.call(arguments,1);if(!l(this,"trigger",e,t))return this;var i=this._events[e],r=this._events.all;return i&&c(i,t),r&&c(r,arguments),this},stopListening:function(e,t,i){var r=this._listeners;if(!r)return this;var n=!t&&!i;"object"==typeof t&&(i=this),e&&((r={})[e._listenerId]=e);for(var a in r)r[a].off(t,i,this),n&&delete this._listeners[a];return this}};var u=/\s+/,l=function(e,t,i,r){if(!i)return!0;if("object"==typeof i){for(var n in i)e[t].apply(e,[n,i[n]].concat(r));return!1}if(u.test(i)){for(var a=i.split(u),o=0,s=a.length;o<s;o++)e[t].apply(e,[a[o]].concat(r));return!1}return!0},c=function(e,t){var i,r=-1,n=e.length,a=t[0],o=t[1],s=t[2];switch(t.length){case 0:for(;++r<n;)(i=e[r]).callback.call(i.ctx);return;case 1:for(;++r<n;)(i=e[r]).callback.call(i.ctx,a);return;case 2:for(;++r<n;)(i=e[r]).callback.call(i.ctx,a,o);return;case 3:for(;++r<n;)(i=e[r]).callback.call(i.ctx,a,o,s);return;default:for(;++r<n;)(i=e[r]).callback.apply(i.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};s.each(h,function(e,t){i[t]=function(t,i,r){return(this._listeners||(this._listeners={}))[t._listenerId||(t._listenerId=s.uniqueId("l"))]=t,"object"==typeof i&&(r=this),t[e](i,r,this),this}}),i.bind=i.on,i.unbind=i.off,i.mixin=function(e){var t=["on","once","off","trigger","stopListening","listenTo","listenToOnce","bind","unbind"];return s.each(t,function(t){e[t]=this[t]},this),e},void 0!==e&&e.exports&&(t=e.exports=i),t.BackboneEvents=i}()},function(e,t,i){e.exports=i(877)},function(e,t,i){t.glMatrix=i(328),t.mat2=i(880),t.mat2d=i(881),t.mat3=i(646),t.mat4=i(882),t.quat=i(883),t.vec2=i(884),t.vec3=i(647),t.vec4=i(648)},function(e,t,i){var r=i(328),n={};n.create=function(){var e=new r.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},n.clone=function(e){var t=new r.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},n.fromValues=function(e,t,i,n){var a=new r.ARRAY_TYPE(4);return a[0]=e,a[1]=t,a[2]=i,a[3]=n,a},n.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},n.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},n.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i*a-n*r;return o?(o=1/o,e[0]=a*o,e[1]=-r*o,e[2]=-n*o,e[3]=i*o,e):null},n.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},n.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},n.multiply=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[0],u=i[1],l=i[2],c=i[3];return e[0]=r*s+a*u,e[1]=n*s+o*u,e[2]=r*l+a*c,e[3]=n*l+o*c,e},n.mul=n.multiply,n.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),u=Math.cos(i);return e[0]=r*u+a*s,e[1]=n*u+o*s,e[2]=r*-s+a*u,e[3]=n*-s+o*u,e},n.scale=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[0],u=i[1];return e[0]=r*s,e[1]=n*s,e[2]=a*u,e[3]=o*u,e},n.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},n.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},n.LDU=function(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]},n.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},n.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e},n.sub=n.subtract,n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},n.equals=function(e,t){var i=e[0],n=e[1],a=e[2],o=e[3],s=t[0],u=t[1],l=t[2],c=t[3];return Math.abs(i-s)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-u)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(a-l)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-c)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))},n.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},n.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},e.exports=n},function(e,t,i){var r=i(328),n={};n.create=function(){var e=new r.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},n.clone=function(e){var t=new r.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},n.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},n.fromValues=function(e,t,i,n,a,o){var s=new r.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=i,s[3]=n,s[4]=a,s[5]=o,s},n.set=function(e,t,i,r,n,a,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e},n.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],u=i*a-r*n;return u?(u=1/u,e[0]=a*u,e[1]=-r*u,e[2]=-n*u,e[3]=i*u,e[4]=(n*s-a*o)*u,e[5]=(r*o-i*s)*u,e):null},n.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},n.multiply=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=i[0],c=i[1],h=i[2],d=i[3],p=i[4],f=i[5];return e[0]=r*l+a*c,e[1]=n*l+o*c,e[2]=r*h+a*d,e[3]=n*h+o*d,e[4]=r*p+a*f+s,e[5]=n*p+o*f+u,e},n.mul=n.multiply,n.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=Math.sin(i),c=Math.cos(i);return e[0]=r*c+a*l,e[1]=n*c+o*l,e[2]=r*-l+a*c,e[3]=n*-l+o*c,e[4]=s,e[5]=u,e},n.scale=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=i[0],c=i[1];return e[0]=r*l,e[1]=n*l,e[2]=a*c,e[3]=o*c,e[4]=s,e[5]=u,e},n.translate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=i[0],c=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=r*l+a*c+s,e[5]=n*l+o*c+u,e},n.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},n.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},n.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},n.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},n.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e},n.sub=n.subtract,n.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},n.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},n.equals=function(e,t){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=t[0],c=t[1],h=t[2],d=t[3],p=t[4],f=t[5];return Math.abs(i-l)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-c)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-h)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-d)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-p)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-f)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(f))},e.exports=n},function(e,t,i){var r=i(328),n={scalar:{},SIMD:{}};n.create=function(){var e=new r.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.clone=function(e){var t=new r.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.fromValues=function(e,t,i,n,a,o,s,u,l,c,h,d,p,f,g,m){var v=new r.ARRAY_TYPE(16);return v[0]=e,v[1]=t,v[2]=i,v[3]=n,v[4]=a,v[5]=o,v[6]=s,v[7]=u,v[8]=l,v[9]=c,v[10]=h,v[11]=d,v[12]=p,v[13]=f,v[14]=g,v[15]=m,v},n.set=function(e,t,i,r,n,a,o,s,u,l,c,h,d,p,f,g,m){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=g,e[15]=m,e},n.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.scalar.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=n,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},n.SIMD.transpose=function(e,t){var i,r,n,a,o,s,u,l,c,h;return i=SIMD.Float32x4.load(t,0),r=SIMD.Float32x4.load(t,4),n=SIMD.Float32x4.load(t,8),a=SIMD.Float32x4.load(t,12),o=SIMD.Float32x4.shuffle(i,r,0,1,4,5),s=SIMD.Float32x4.shuffle(n,a,0,1,4,5),u=SIMD.Float32x4.shuffle(o,s,0,2,4,6),l=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(e,0,u),SIMD.Float32x4.store(e,4,l),o=SIMD.Float32x4.shuffle(i,r,2,3,6,7),s=SIMD.Float32x4.shuffle(n,a,2,3,6,7),c=SIMD.Float32x4.shuffle(o,s,0,2,4,6),h=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(e,8,c),SIMD.Float32x4.store(e,12,h),e},n.transpose=r.USE_SIMD?n.SIMD.transpose:n.scalar.transpose,n.scalar.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15],_=i*s-r*o,b=i*u-n*o,x=i*l-a*o,S=r*u-n*s,y=r*l-a*s,C=n*l-a*u,T=c*g-h*f,M=c*m-d*f,w=c*v-p*f,A=h*m-d*g,E=h*v-p*g,P=d*v-p*m,N=_*P-b*E+x*A+S*w-y*M+C*T;return N?(N=1/N,e[0]=(s*P-u*E+l*A)*N,e[1]=(n*E-r*P-a*A)*N,e[2]=(g*C-m*y+v*S)*N,e[3]=(d*y-h*C-p*S)*N,e[4]=(u*w-o*P-l*M)*N,e[5]=(i*P-n*w+a*M)*N,e[6]=(m*x-f*C-v*b)*N,e[7]=(c*C-d*x+p*b)*N,e[8]=(o*E-s*w+l*T)*N,e[9]=(r*w-i*E-a*T)*N,e[10]=(f*y-g*x+v*_)*N,e[11]=(h*x-c*y-p*_)*N,e[12]=(s*M-o*A-u*T)*N,e[13]=(i*A-r*M+n*T)*N,e[14]=(g*b-f*S-m*_)*N,e[15]=(c*S-h*b+d*_)*N,e):null},n.SIMD.invert=function(e,t){var i,r,n,a,o,s,u,l,c,h,d=SIMD.Float32x4.load(t,0),p=SIMD.Float32x4.load(t,4),f=SIMD.Float32x4.load(t,8),g=SIMD.Float32x4.load(t,12);return o=SIMD.Float32x4.shuffle(d,p,0,1,4,5),r=SIMD.Float32x4.shuffle(f,g,0,1,4,5),i=SIMD.Float32x4.shuffle(o,r,0,2,4,6),r=SIMD.Float32x4.shuffle(r,o,1,3,5,7),o=SIMD.Float32x4.shuffle(d,p,2,3,6,7),a=SIMD.Float32x4.shuffle(f,g,2,3,6,7),n=SIMD.Float32x4.shuffle(o,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,o,1,3,5,7),o=SIMD.Float32x4.mul(n,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.mul(r,o),u=SIMD.Float32x4.mul(i,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),s),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),o=SIMD.Float32x4.mul(r,n),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),s),c=SIMD.Float32x4.mul(i,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(a,o)),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),o=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(r,2,3,0,1),a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),n=SIMD.Float32x4.swizzle(n,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),s),l=SIMD.Float32x4.mul(i,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(n,o)),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),o=SIMD.Float32x4.mul(i,r),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),l),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,o),c),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,o),l),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(n,o)),o=SIMD.Float32x4.mul(i,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(n,o)),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,o),l),o=SIMD.Float32x4.swizzle(o,2,3,0,1),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,o),u),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(r,o)),o=SIMD.Float32x4.mul(i,n),o=SIMD.Float32x4.swizzle(o,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),u),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(r,o)),o=SIMD.Float32x4.swizzle(o,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(a,o)),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,o),c),h=SIMD.Float32x4.mul(i,s),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,2,3,0,1),h),h=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(h,1,0,3,2),h),o=SIMD.Float32x4.reciprocalApproximation(h),h=SIMD.Float32x4.sub(SIMD.Float32x4.add(o,o),SIMD.Float32x4.mul(h,SIMD.Float32x4.mul(o,o))),(h=SIMD.Float32x4.swizzle(h,0,0,0,0))?(SIMD.Float32x4.store(e,0,SIMD.Float32x4.mul(h,s)),SIMD.Float32x4.store(e,4,SIMD.Float32x4.mul(h,u)),SIMD.Float32x4.store(e,8,SIMD.Float32x4.mul(h,l)),SIMD.Float32x4.store(e,12,SIMD.Float32x4.mul(h,c)),e):null},n.invert=r.USE_SIMD?n.SIMD.invert:n.scalar.invert,n.scalar.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],g=t[13],m=t[14],v=t[15];return e[0]=s*(d*v-p*m)-h*(u*v-l*m)+g*(u*p-l*d),e[1]=-(r*(d*v-p*m)-h*(n*v-a*m)+g*(n*p-a*d)),e[2]=r*(u*v-l*m)-s*(n*v-a*m)+g*(n*l-a*u),e[3]=-(r*(u*p-l*d)-s*(n*p-a*d)+h*(n*l-a*u)),e[4]=-(o*(d*v-p*m)-c*(u*v-l*m)+f*(u*p-l*d)),e[5]=i*(d*v-p*m)-c*(n*v-a*m)+f*(n*p-a*d),e[6]=-(i*(u*v-l*m)-o*(n*v-a*m)+f*(n*l-a*u)),e[7]=i*(u*p-l*d)-o*(n*p-a*d)+c*(n*l-a*u),e[8]=o*(h*v-p*g)-c*(s*v-l*g)+f*(s*p-l*h),e[9]=-(i*(h*v-p*g)-c*(r*v-a*g)+f*(r*p-a*h)),e[10]=i*(s*v-l*g)-o*(r*v-a*g)+f*(r*l-a*s),e[11]=-(i*(s*p-l*h)-o*(r*p-a*h)+c*(r*l-a*s)),e[12]=-(o*(h*m-d*g)-c*(s*m-u*g)+f*(s*d-u*h)),e[13]=i*(h*m-d*g)-c*(r*m-n*g)+f*(r*d-n*h),e[14]=-(i*(s*m-u*g)-o*(r*m-n*g)+f*(r*u-n*s)),e[15]=i*(s*d-u*h)-o*(r*d-n*h)+c*(r*u-n*s),e},n.SIMD.adjoint=function(e,t){var i,r,n,a,o,s,u,l,c,h,d,p,f,i=SIMD.Float32x4.load(t,0),r=SIMD.Float32x4.load(t,4),n=SIMD.Float32x4.load(t,8),a=SIMD.Float32x4.load(t,12);return c=SIMD.Float32x4.shuffle(i,r,0,1,4,5),s=SIMD.Float32x4.shuffle(n,a,0,1,4,5),o=SIMD.Float32x4.shuffle(c,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,c,1,3,5,7),c=SIMD.Float32x4.shuffle(i,r,2,3,6,7),l=SIMD.Float32x4.shuffle(n,a,2,3,6,7),u=SIMD.Float32x4.shuffle(c,l,0,2,4,6),l=SIMD.Float32x4.shuffle(l,c,1,3,5,7),c=SIMD.Float32x4.mul(u,l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.mul(s,c),d=SIMD.Float32x4.mul(o,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,c),h),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),c=SIMD.Float32x4.mul(s,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),h),f=SIMD.Float32x4.mul(o,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(l,c)),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),c=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),u=SIMD.Float32x4.swizzle(u,2,3,0,1),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),h),p=SIMD.Float32x4.mul(o,c),c=SIMD.Float32x4.swizzle(c,2,3,0,1),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(u,c)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,c),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),c=SIMD.Float32x4.mul(o,s),c=SIMD.Float32x4.swizzle(c,1,0,3,2),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),p),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,c),f),c=SIMD.Float32x4.swizzle(c,2,3,0,1),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,c),p),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(u,c)),c=SIMD.Float32x4.mul(o,l),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(u,c)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),p),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,c),d),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.mul(o,u),c=SIMD.Float32x4.swizzle(c,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,c),d),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(s,c)),c=SIMD.Float32x4.swizzle(c,2,3,0,1),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(l,c)),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,c),f),SIMD.Float32x4.store(e,0,h),SIMD.Float32x4.store(e,4,d),SIMD.Float32x4.store(e,8,p),SIMD.Float32x4.store(e,12,f),e},n.adjoint=r.USE_SIMD?n.SIMD.adjoint:n.scalar.adjoint,n.determinant=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],g=e[14],m=e[15];return(t*o-i*a)*(h*m-d*g)-(t*s-r*a)*(c*m-d*f)+(t*u-n*a)*(c*g-h*f)+(i*s-r*o)*(l*m-d*p)-(i*u-n*o)*(l*g-h*p)+(r*u-n*s)*(l*f-c*p)},n.SIMD.multiply=function(e,t,i){var r=SIMD.Float32x4.load(t,0),n=SIMD.Float32x4.load(t,4),a=SIMD.Float32x4.load(t,8),o=SIMD.Float32x4.load(t,12),s=SIMD.Float32x4.load(i,0),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),o))));SIMD.Float32x4.store(e,0,u);var l=SIMD.Float32x4.load(i,4),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),o))));SIMD.Float32x4.store(e,4,c);var h=SIMD.Float32x4.load(i,8),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),o))));SIMD.Float32x4.store(e,8,d);var p=SIMD.Float32x4.load(i,12),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,0,0,0,0),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,1,1,1,1),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(p,3,3,3,3),o))));return SIMD.Float32x4.store(e,12,f),e},n.scalar.multiply=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],g=t[12],m=t[13],v=t[14],_=t[15],b=i[0],x=i[1],S=i[2],y=i[3];return e[0]=b*r+x*s+S*h+y*g,e[1]=b*n+x*u+S*d+y*m,e[2]=b*a+x*l+S*p+y*v,e[3]=b*o+x*c+S*f+y*_,b=i[4],x=i[5],S=i[6],y=i[7],e[4]=b*r+x*s+S*h+y*g,e[5]=b*n+x*u+S*d+y*m,e[6]=b*a+x*l+S*p+y*v,e[7]=b*o+x*c+S*f+y*_,b=i[8],x=i[9],S=i[10],y=i[11],e[8]=b*r+x*s+S*h+y*g,e[9]=b*n+x*u+S*d+y*m,e[10]=b*a+x*l+S*p+y*v,e[11]=b*o+x*c+S*f+y*_,b=i[12],x=i[13],S=i[14],y=i[15],e[12]=b*r+x*s+S*h+y*g,e[13]=b*n+x*u+S*d+y*m,e[14]=b*a+x*l+S*p+y*v,e[15]=b*o+x*c+S*f+y*_,e},n.multiply=r.USE_SIMD?n.SIMD.multiply:n.scalar.multiply,n.mul=n.multiply,n.scalar.translate=function(e,t,i){var r,n,a,o,s,u,l,c,h,d,p,f,g=i[0],m=i[1],v=i[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*v+t[12],e[13]=t[1]*g+t[5]*m+t[9]*v+t[13],e[14]=t[2]*g+t[6]*m+t[10]*v+t[14],e[15]=t[3]*g+t[7]*m+t[11]*v+t[15]):(r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*g+s*m+h*v+t[12],e[13]=n*g+u*m+d*v+t[13],e[14]=a*g+l*m+p*v+t[14],e[15]=o*g+c*m+f*v+t[15]),e},n.SIMD.translate=function(e,t,i){var r=SIMD.Float32x4.load(t,0),n=SIMD.Float32x4.load(t,4),a=SIMD.Float32x4.load(t,8),o=SIMD.Float32x4.load(t,12),s=SIMD.Float32x4(i[0],i[1],i[2],0);t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,0,0,0,0)),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,1,1,1,1)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,2,2,2,2));var u=SIMD.Float32x4.add(r,SIMD.Float32x4.add(n,SIMD.Float32x4.add(a,o)));return SIMD.Float32x4.store(e,12,u),e},n.translate=r.USE_SIMD?n.SIMD.translate:n.scalar.translate,n.scalar.scale=function(e,t,i){var r=i[0],n=i[1],a=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.SIMD.scale=function(e,t,i){var r,n,a,o=SIMD.Float32x4(i[0],i[1],i[2],0);return r=SIMD.Float32x4.load(t,0),SIMD.Float32x4.store(e,0,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(o,0,0,0,0))),n=SIMD.Float32x4.load(t,4),SIMD.Float32x4.store(e,4,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(o,1,1,1,1))),a=SIMD.Float32x4.load(t,8),SIMD.Float32x4.store(e,8,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(o,2,2,2,2))),e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},n.scale=r.USE_SIMD?n.SIMD.scale:n.scalar.scale,n.rotate=function(e,t,i,n){var a,o,s,u,l,c,h,d,p,f,g,m,v,_,b,x,S,y,C,T,M,w,A,E,P=n[0],N=n[1],F=n[2],R=Math.sqrt(P*P+N*N+F*F);return Math.abs(R)<r.EPSILON?null:(R=1/R,P*=R,N*=R,F*=R,a=Math.sin(i),o=Math.cos(i),s=1-o,u=t[0],l=t[1],c=t[2],h=t[3],d=t[4],p=t[5],f=t[6],g=t[7],m=t[8],v=t[9],_=t[10],b=t[11],x=P*P*s+o,S=N*P*s+F*a,y=F*P*s-N*a,C=P*N*s-F*a,T=N*N*s+o,M=F*N*s+P*a,w=P*F*s+N*a,A=N*F*s-P*a,E=F*F*s+o,e[0]=u*x+d*S+m*y,e[1]=l*x+p*S+v*y,e[2]=c*x+f*S+_*y,e[3]=h*x+g*S+b*y,e[4]=u*C+d*T+m*M,e[5]=l*C+p*T+v*M,e[6]=c*C+f*T+_*M,e[7]=h*C+g*T+b*M,e[8]=u*w+d*A+m*E,e[9]=l*w+p*A+v*E,e[10]=c*w+f*A+_*E,e[11]=h*w+g*A+b*E,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},n.scalar.rotateX=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+l*r,e[5]=o*n+c*r,e[6]=s*n+h*r,e[7]=u*n+d*r,e[8]=l*n-a*r,e[9]=c*n-o*r,e[10]=h*n-s*r,e[11]=d*n-u*r,e},n.SIMD.rotateX=function(e,t,i){var r=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var a=SIMD.Float32x4.load(t,4),o=SIMD.Float32x4.load(t,8);return SIMD.Float32x4.store(e,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(o,r))),SIMD.Float32x4.store(e,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(a,r))),e},n.rotateX=r.USE_SIMD?n.SIMD.rotateX:n.scalar.rotateX,n.scalar.rotateY=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],o=t[1],s=t[2],u=t[3],l=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-l*r,e[1]=o*n-c*r,e[2]=s*n-h*r,e[3]=u*n-d*r,e[8]=a*r+l*n,e[9]=o*r+c*n,e[10]=s*r+h*n,e[11]=u*r+d*n,e},n.SIMD.rotateY=function(e,t,i){var r=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var a=SIMD.Float32x4.load(t,0),o=SIMD.Float32x4.load(t,8);return SIMD.Float32x4.store(e,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(o,r))),SIMD.Float32x4.store(e,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,r),SIMD.Float32x4.mul(o,n))),e},n.rotateY=r.USE_SIMD?n.SIMD.rotateY:n.scalar.rotateY,n.scalar.rotateZ=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],o=t[1],s=t[2],u=t[3],l=t[4],c=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+l*r,e[1]=o*n+c*r,e[2]=s*n+h*r,e[3]=u*n+d*r,e[4]=l*n-a*r,e[5]=c*n-o*r,e[6]=h*n-s*r,e[7]=d*n-u*r,e},n.SIMD.rotateZ=function(e,t,i){var r=SIMD.Float32x4.splat(Math.sin(i)),n=SIMD.Float32x4.splat(Math.cos(i));t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]);var a=SIMD.Float32x4.load(t,0),o=SIMD.Float32x4.load(t,4);return SIMD.Float32x4.store(e,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,n),SIMD.Float32x4.mul(o,r))),SIMD.Float32x4.store(e,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(a,r))),e},n.rotateZ=r.USE_SIMD?n.SIMD.rotateZ:n.scalar.rotateZ,n.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},n.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromRotation=function(e,t,i){var n,a,o,s=i[0],u=i[1],l=i[2],c=Math.sqrt(s*s+u*u+l*l);return Math.abs(c)<r.EPSILON?null:(c=1/c,s*=c,u*=c,l*=c,n=Math.sin(t),a=Math.cos(t),o=1-a,e[0]=s*s*o+a,e[1]=u*s*o+l*n,e[2]=l*s*o-u*n,e[3]=0,e[4]=s*u*o-l*n,e[5]=u*u*o+a,e[6]=l*u*o+s*n,e[7]=0,e[8]=s*l*o+u*n,e[9]=u*l*o-s*n,e[10]=l*l*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},n.fromXRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromYRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromZRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.fromRotationTranslation=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=r+r,u=n+n,l=a+a,c=r*s,h=r*u,d=r*l,p=n*u,f=n*l,g=a*l,m=o*s,v=o*u,_=o*l;return e[0]=1-(p+g),e[1]=h+_,e[2]=d-v,e[3]=0,e[4]=h-_,e[5]=1-(c+g),e[6]=f+m,e[7]=0,e[8]=d+v,e[9]=f-m,e[10]=1-(c+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},n.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},n.getRotation=function(e,t){var i=t[0]+t[5]+t[10],r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e},n.fromRotationTranslationScale=function(e,t,i,r){var n=t[0],a=t[1],o=t[2],s=t[3],u=n+n,l=a+a,c=o+o,h=n*u,d=n*l,p=n*c,f=a*l,g=a*c,m=o*c,v=s*u,_=s*l,b=s*c,x=r[0],S=r[1],y=r[2];return e[0]=(1-(f+m))*x,e[1]=(d+b)*x,e[2]=(p-_)*x,e[3]=0,e[4]=(d-b)*S,e[5]=(1-(h+m))*S,e[6]=(g+v)*S,e[7]=0,e[8]=(p+_)*y,e[9]=(g-v)*y,e[10]=(1-(h+f))*y,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},n.fromRotationTranslationScaleOrigin=function(e,t,i,r,n){var a=t[0],o=t[1],s=t[2],u=t[3],l=a+a,c=o+o,h=s+s,d=a*l,p=a*c,f=a*h,g=o*c,m=o*h,v=s*h,_=u*l,b=u*c,x=u*h,S=r[0],y=r[1],C=r[2],T=n[0],M=n[1],w=n[2];return e[0]=(1-(g+v))*S,e[1]=(p+x)*S,e[2]=(f-b)*S,e[3]=0,e[4]=(p-x)*y,e[5]=(1-(d+v))*y,e[6]=(m+_)*y,e[7]=0,e[8]=(f+b)*C,e[9]=(m-_)*C,e[10]=(1-(d+g))*C,e[11]=0,e[12]=i[0]+T-(e[0]*T+e[4]*M+e[8]*w),e[13]=i[1]+M-(e[1]*T+e[5]*M+e[9]*w),e[14]=i[2]+w-(e[2]*T+e[6]*M+e[10]*w),e[15]=1,e},n.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,s=r+r,u=n+n,l=i*o,c=r*o,h=r*s,d=n*o,p=n*s,f=n*u,g=a*o,m=a*s,v=a*u;return e[0]=1-h-f,e[1]=c+v,e[2]=d-m,e[3]=0,e[4]=c-v,e[5]=1-l-f,e[6]=p+g,e[7]=0,e[8]=d+m,e[9]=p-g,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.frustum=function(e,t,i,r,n,a,o){var s=1/(i-t),u=1/(n-r),l=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*u,e[6]=0,e[7]=0,e[8]=(i+t)*s,e[9]=(n+r)*u,e[10]=(o+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*l,e[15]=0,e},n.perspective=function(e,t,i,r,n){var a=1/Math.tan(t/2),o=1/(r-n);return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+r)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*r*o,e[15]=0,e},n.perspectiveFromFieldOfView=function(e,t,i,r){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(o+s),l=2/(n+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(o-s)*u*.5,e[9]=(n-a)*l*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e},n.ortho=function(e,t,i,r,n,a,o){var s=1/(t-i),u=1/(r-n),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+i)*s,e[13]=(n+r)*u,e[14]=(o+a)*l,e[15]=1,e},n.lookAt=function(e,t,i,a){var o,s,u,l,c,h,d,p,f,g,m=t[0],v=t[1],_=t[2],b=a[0],x=a[1],S=a[2],y=i[0],C=i[1],T=i[2];return Math.abs(m-y)<r.EPSILON&&Math.abs(v-C)<r.EPSILON&&Math.abs(_-T)<r.EPSILON?n.identity(e):(d=m-y,p=v-C,f=_-T,g=1/Math.sqrt(d*d+p*p+f*f),d*=g,p*=g,f*=g,o=x*f-S*p,s=S*d-b*f,u=b*p-x*d,g=Math.sqrt(o*o+s*s+u*u),g?(g=1/g,o*=g,s*=g,u*=g):(o=0,s=0,u=0),l=p*u-f*s,c=f*o-d*u,h=d*s-p*o,g=Math.sqrt(l*l+c*c+h*h),g?(g=1/g,l*=g,c*=g,h*=g):(l=0,c=0,h=0),e[0]=o,e[1]=l,e[2]=d,e[3]=0,e[4]=s,e[5]=c,e[6]=p,e[7]=0,e[8]=u,e[9]=h,e[10]=f,e[11]=0,e[12]=-(o*m+s*v+u*_),e[13]=-(l*m+c*v+h*_),e[14]=-(d*m+p*v+f*_),e[15]=1,e)},n.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},n.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},n.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},n.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e},n.sub=n.subtract,n.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},n.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},n.equals=function(e,t){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],d=e[9],p=e[10],f=e[11],g=e[12],m=e[13],v=e[14],_=e[15],b=t[0],x=t[1],S=t[2],y=t[3],C=t[4],T=t[5],M=t[6],w=t[7],A=t[8],E=t[9],P=t[10],N=t[11],F=t[12],R=t[13],I=t[14],O=t[15];return Math.abs(i-b)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(n-x)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-S)<=r.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(o-y)<=r.EPSILON*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(s-C)<=r.EPSILON*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(u-T)<=r.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(l-M)<=r.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-w)<=r.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(h-A)<=r.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-E)<=r.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(p-P)<=r.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(f-N)<=r.EPSILON*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(g-F)<=r.EPSILON*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(m-R)<=r.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(v-I)<=r.EPSILON*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(_-O)<=r.EPSILON*Math.max(1,Math.abs(_),Math.abs(O))},e.exports=n},function(e,t,i){var r=i(328),n=i(646),a=i(647),o=i(648),s={};s.create=function(){var e=new r.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},s.rotationTo=function(){var e=a.create(),t=a.fromValues(1,0,0),i=a.fromValues(0,1,0);return function(r,n,o){var u=a.dot(n,o);return u<-.999999?(a.cross(e,t,n),a.length(e)<1e-6&&a.cross(e,i,n),a.normalize(e,e),s.setAxisAngle(r,e,Math.PI),r):u>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(a.cross(e,n,o),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+u,s.normalize(r,r))}}(),s.setAxes=function(){var e=n.create();return function(t,i,r,n){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-i[0],e[5]=-i[1],e[8]=-i[2],s.normalize(t,s.fromMat3(t,e))}}(),s.clone=o.clone,s.fromValues=o.fromValues,s.copy=o.copy,s.set=o.set,s.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},s.setAxisAngle=function(e,t,i){i*=.5;var r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e},s.getAxisAngle=function(e,t){var i=2*Math.acos(t[3]),r=Math.sin(i/2);return 0!=r?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i},s.add=o.add,s.multiply=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[0],u=i[1],l=i[2],c=i[3];return e[0]=r*c+o*s+n*l-a*u,e[1]=n*c+o*u+a*s-r*l,e[2]=a*c+o*l+r*u-n*s,e[3]=o*c-r*s-n*u-a*l,e},s.mul=s.multiply,s.scale=o.scale,s.rotateX=function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),u=Math.cos(i);return e[0]=r*u+o*s,e[1]=n*u+a*s,e[2]=a*u-n*s,e[3]=o*u-r*s,e},s.rotateY=function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),u=Math.cos(i);return e[0]=r*u-a*s,e[1]=n*u+o*s,e[2]=a*u+r*s,e[3]=o*u-n*s,e},s.rotateZ=function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),u=Math.cos(i);return e[0]=r*u+n*s,e[1]=n*u-r*s,e[2]=a*u+o*s,e[3]=o*u-a*s,e},s.calculateW=function(e,t){var i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e},s.dot=o.dot,s.lerp=o.lerp,s.slerp=function(e,t,i,r){var n,a,o,s,u,l=t[0],c=t[1],h=t[2],d=t[3],p=i[0],f=i[1],g=i[2],m=i[3];return a=l*p+c*f+h*g+d*m,a<0&&(a=-a,p=-p,f=-f,g=-g,m=-m),1-a>1e-6?(n=Math.acos(a),o=Math.sin(n),s=Math.sin((1-r)*n)/o,u=Math.sin(r*n)/o):(s=1-r,u=r),e[0]=s*l+u*p,e[1]=s*c+u*f,e[2]=s*h+u*g,e[3]=s*d+u*m,e},s.sqlerp=function(){var e=s.create(),t=s.create();return function(i,r,n,a,o,u){return s.slerp(e,r,o,u),s.slerp(t,n,a,u),s.slerp(i,e,t,2*u*(1-u)),i}}(),s.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i*i+r*r+n*n+a*a,s=o?1/o:0;return e[0]=-i*s,e[1]=-r*s,e[2]=-n*s,e[3]=a*s,e},s.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},s.length=o.length,s.len=s.length,s.squaredLength=o.squaredLength,s.sqrLen=s.squaredLength,s.normalize=o.normalize,s.fromMat3=function(e,t){var i,r=t[0]+t[4]+t[8];if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*a+a]-t[3*o+o]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*a+o]-t[3*o+a])*i,e[a]=(t[3*a+n]+t[3*n+a])*i,e[o]=(t[3*o+n]+t[3*n+o])*i}return e},s.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},s.exactEquals=o.exactEquals,s.equals=o.equals,e.exports=s},function(e,t,i){var r=i(328),n={};n.create=function(){var e=new r.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e},n.clone=function(e){var t=new r.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},n.fromValues=function(e,t){var i=new r.ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},n.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},n.set=function(e,t,i){return e[0]=t,e[1]=i,e},n.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},n.subtract=function(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e},n.sub=n.subtract,n.multiply=function(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e},n.mul=n.multiply,n.divide=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e},n.div=n.divide,n.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},n.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},n.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},n.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},n.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},n.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},n.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e},n.distance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)},n.dist=n.distance,n.squaredDistance=function(e,t){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r},n.sqrDist=n.squaredDistance,n.length=function(e){var t=e[0],i=e[1];return Math.sqrt(t*t+i*i)},n.len=n.length,n.squaredLength=function(e){var t=e[0],i=e[1];return t*t+i*i},n.sqrLen=n.squaredLength,n.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},n.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},n.normalize=function(e,t){var i=t[0],r=t[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},n.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},n.cross=function(e,t,i){var r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e},n.lerp=function(e,t,i,r){var n=t[0],a=t[1];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e},n.random=function(e,t){t=t||1;var i=2*r.RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},n.transformMat2=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e},n.transformMat2d=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n+i[4],e[1]=i[1]*r+i[3]*n+i[5],e},n.transformMat3=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[3]*n+i[6],e[1]=i[1]*r+i[4]*n+i[7],e},n.transformMat4=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e},n.forEach=function(){var e=n.create();return function(t,i,r,n,a,o){var s,u;for(i||(i=2),r||(r=0),u=n?Math.min(n*i+r,t.length):t.length,s=r;s<u;s+=i)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}(),n.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},n.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},n.equals=function(e,t){var i=e[0],n=e[1],a=t[0],o=t[1];return Math.abs(i-a)<=r.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-o)<=r.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))},e.exports=n},function(e,t,i){var r;!function(n,a,o){function s(e,t,i){if(e.addEventListener)return void e.addEventListener(t,i,!1);e.attachEvent("on"+t,i)}function u(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return S[e.which]?S[e.which]:y[e.which]?y[e.which]:String.fromCharCode(e.which).toLowerCase()}function l(e,t){return e.sort().join(",")===t.sort().join(",")}function c(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function h(e){if(e.preventDefault)return void e.preventDefault();e.returnValue=!1}function d(e){if(e.stopPropagation)return void e.stopPropagation();e.cancelBubble=!0}function p(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function f(){if(!x){x={};for(var e in S)e>95&&e<112||S.hasOwnProperty(e)&&(x[S[e]]=e)}return x}function g(e,t,i){return i||(i=f()[e]?"keydown":"keypress"),"keypress"==i&&t.length&&(i="keydown"),i}function m(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus"),e.split("+"))}function v(e,t){var i,r,n,a=[];for(i=m(e),n=0;n<i.length;++n)r=i[n],T[r]&&(r=T[r]),t&&"keypress"!=t&&C[r]&&(r=C[r],a.push("shift")),p(r)&&a.push(r);return t=g(r,a,t),{key:r,modifiers:a,action:t}}function _(e,t){return null!==e&&e!==a&&(e===t||_(e.parentNode,t))}function b(e){function t(e){e=e||{};var t,i=!1;for(t in x)e[t]?i=!0:x[t]=0;i||(C=!1)}function i(e,t,i,r,n,a){var o,s,u=[],c=i.type;if(!m._callbacks[e])return[];for("keyup"==c&&p(e)&&(t=[e]),o=0;o<m._callbacks[e].length;++o)if(s=m._callbacks[e][o],(r||!s.seq||x[s.seq]==s.level)&&c==s.action&&("keypress"==c&&!i.metaKey&&!i.ctrlKey||l(t,s.modifiers))){var h=!r&&s.combo==n,d=r&&s.seq==r&&s.level==a;(h||d)&&m._callbacks[e].splice(o,1),u.push(s)}return u}function r(e,t,i,r){m.stopCallback(t,t.target||t.srcElement,i,r)||!1===e(t,i)&&(h(t),d(t))}function n(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=u(e);if(t)return"keyup"==e.type&&S===t?void(S=!1):void m.handleKey(t,c(e),e)}function o(){clearTimeout(_),_=setTimeout(t,1e3)}function f(e,i,n,a){function s(i){r(n,i,e),"keyup"!==a&&(S=u(i)),setTimeout(t,10)}x[e]=0;for(var l=0;l<i.length;++l){var c=l+1===i.length,h=c?s:function(t){return function(){C=t,++x[e],o()}}(a||v(i[l+1]).action);g(i[l],h,a,e,l)}}function g(e,t,r,n,a){m._directMap[e+":"+r]=t,e=e.replace(/\s+/g," ");var o,s=e.split(" ");if(s.length>1)return void f(e,s,t,r);o=v(e,r),m._callbacks[o.key]=m._callbacks[o.key]||[],i(o.key,o.modifiers,{type:o.action},n,e,a),m._callbacks[o.key][n?"unshift":"push"]({callback:t,modifiers:o.modifiers,action:o.action,seq:n,level:a,combo:e})}var m=this;if(e=e||a,!(m instanceof b))return new b(e);m.target=e,m._callbacks={},m._directMap={};var _,x={},S=!1,y=!1,C=!1;m._handleKey=function(e,n,a){var o,s=i(e,n,a),u={},l=0,c=!1;for(o=0;o<s.length;++o)s[o].seq&&(l=Math.max(l,s[o].level));for(o=0;o<s.length;++o)if(s[o].seq){if(s[o].level!=l)continue;c=!0,u[s[o].seq]=1,r(s[o].callback,a,s[o].combo,s[o].seq)}else c||r(s[o].callback,a,s[o].combo);var h="keypress"==a.type&&y;a.type!=C||p(e)||h||t(u),y=c&&"keydown"==a.type},m._bindMultiple=function(e,t,i){for(var r=0;r<e.length;++r)g(e[r],t,i)},s(e,"keypress",n),s(e,"keydown",n),s(e,"keyup",n)}if(n){for(var x,S={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},y={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},C={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},T={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},M=1;M<20;++M)S[111+M]="f"+M;for(M=0;M<=9;++M)S[M+96]=M.toString();b.prototype.bind=function(e,t,i){var r=this;return e=e instanceof Array?e:[e],r._bindMultiple.call(r,e,t,i),r},b.prototype.unbind=function(e,t){var i=this;return i.bind.call(i,e,function(){},t)},b.prototype.trigger=function(e,t){var i=this;return i._directMap[e+":"+t]&&i._directMap[e+":"+t]({},e),i},b.prototype.reset=function(){var e=this;return e._callbacks={},e._directMap={},e},b.prototype.stopCallback=function(e,t){var i=this;return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&(!_(t,i.target)&&("INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable))},b.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},b.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(S[t]=e[t]);x=null},b.init=function(){var e=b(a);for(var t in e)"_"!==t.charAt(0)&&(b[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},b.init(),n.Mousetrap=b,void 0!==e&&e.exports&&(e.exports=b),void 0!==(r=function(){return b}.call(t,i,t,e))&&(e.exports=r)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},function(e,t,i){"use strict";e.exports={ArrayType:Float64Array}},function(e,t,i){"use strict";var r=i(14),n=i(68),a=function(){n.call(this),this._attributeEnable=!1};r.createPrototypeStateAttribute(a,r.objectInherit(n.prototype,{attributeType:"Billboard",cloneType:function(){return new a},setEnabled:function(e){this._attributeEnable=e},isEnabled:function(){return this._attributeEnable},apply:function(){}}),"osg","Billboard"),e.exports=a},function(e,t,i){"use strict";var r=i(14),n=i(68),a=i(8).vec4,o=function(e){n.call(this),this._constantColor=a.create(),a.set(this._constantColor,1,1,1,1),void 0!==e&&this.setConstantColor(e)};r.createPrototypeStateAttribute(o,r.objectInherit(n.prototype,{attributeType:"BlendColor",cloneType:function(){return new o},setConstantColor:function(e){a.copy(this._constantColor,e)},getConstantColor:function(){return this._constantColor},apply:function(e){e.getGraphicContext().blendColor(this._constantColor[0],this._constantColor[1],this._constantColor[2],this._constantColor[3])}}),"osg","BlendColor"),e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(68),a=function(e,t,i,r){n.call(this),this._colorMask=[!0,!0,!0,!0],this.setMask(e,t,i,r)};r.createPrototypeStateAttribute(a,r.objectInherit(n.prototype,{attributeType:"ColorMask",cloneType:function(){return new a},setMask:function(e,t,i,r){void 0!==e&&void 0!==t&&void 0!==i&&void 0!==r&&(this._colorMask[0]=e,this._colorMask[1]=t,this._colorMask[2]=i,this._colorMask[3]=r)},apply:function(e){var t=e.getGraphicContext(),i=this._colorMask;t.colorMask(i[0],i[1],i[2],i[3])}}),"osg","ColorMask"),e.exports=a},function(e,t,i){"use strict";var r=i(8).mat4,n=i(8).vec3,a=function(){this._radiusEquator=a.WGS_84_RADIUS_EQUATOR,this._radiusPolar=a.WGS_84_RADIUS_POLAR,this.computeCoefficients()};a.WGS_84_RADIUS_EQUATOR=6378137,a.WGS_84_RADIUS_POLAR=6356752.3142,a.prototype={setRadiusEquator:function(e){this._radiusEquator=e,this.computeCoefficients()},getRadiusEquator:function(){return this._radiusEquator},setRadiusPolar:function(e){this._radiusPolar=e,this.computeCoefficients()},getRadiusPolar:function(){return this._radiusPolar},convertLatLongHeightToXYZ:function(e,t,i,r){var n=Math.sin(e),a=Math.cos(e),o=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*n*n),s=(o+i)*a*Math.cos(t),u=(o+i)*a*Math.sin(t),l=(o*(1-this._eccentricitySquared)+i)*n;return r[0]=s,r[1]=u,r[2]=l,r},convertXYZToLatLongHeight:function(e,t,i,r){var n=Math.sqrt(e*e+t*t),a=Math.atan2(i*this._radiusEquator,n*this._radiusPolar),o=(this._radiusEquator*this._radiusEquator-this._radiusPolar*this._radiusPolar)/(this._radiusPolar*this._radiusPolar),s=Math.sin(a),u=Math.cos(a),l=Math.atan((i+o*this._radiusPolar*s*s*s)/(n-this._eccentricitySquared*this._radiusEquator*u*u*u)),c=Math.atan2(t,e),h=Math.sin(l),d=this._radiusEquator/Math.sqrt(1-this._eccentricitySquared*h*h),p=Math.cos(l);0===p&&(p=1);var f=n/p-d;return r[0]=l,r[1]=c,r[2]=f,r},computeLocalUpVector:function(e,t,i){var r,a,o=this.convertXYZToLatLongHeight(e,t,i,n.create());return r=o[0],a=o[1],[Math.cos(a)*Math.cos(r),Math.sin(a)*Math.cos(r),Math.sin(r)]},isWGS84:function(){return this._radiusEquator===a.WGS_84_RADIUS_EQUATOR&&this._radiusPolar===a.WGS_84_RADIUS_POLAR},computeCoefficients:function(){var e=(this._radiusEquator-this._radiusPolar)/this._radiusEquator;this._eccentricitySquared=2*e-e*e},computeLocalToWorldTransformFromLatLongHeight:function(e,t,i,n){var a=this.convertLatLongHeightToXYZ(e,t,i,n);return r.fromTranslation(n,a),this.computeCoordinateFrame(e,t,n),n},computeLocalToWorldTransformFromXYZ:function(e,t,i){var a=this.convertXYZToLatLongHeight(e,t,i,n.create()),o=r.fromTranslation(r.create(),n.fromValues(e,t,i));return this.computeCoordinateFrame(a[0],a[1],o),o},computeCoordinateFrame:function(){var e=n.create(),t=n.create(),i=n.create();return function(a,o,s){e[0]=Math.cos(o)*Math.cos(a),e[1]=Math.sin(o)*Math.cos(a),e[2]=Math.sin(a),t[0]=-Math.sin(o),t[1]=-Math.cos(o),n.cross(i,e,t),r.set(s,t[0],t[1],t[2],0,i[0],i[1],i[2],0,e[0],e[1],e[2],0,0,0,0,1)}}()},e.exports=a},function(e,t,i){"use strict";var r=i(10),n=i(14),a=i(452),o=function(e){a.call(this,e),this._canPlayDefered=void 0};o.PAUSE=0,o.PLAYING=1,n.createPrototypeObject(o,n.objectInherit(a.prototype,{isDirty:function(){return this._status===o.PLAYING},setImage:function(e){a.prototype.setImage.call(this,e),this._status=o.STOP,e.addEventListener("ended",function(){this._imageObject.loop||this.stop()}.bind(this),!0),this.dirty()},setLooping:function(e){this._imageObject.loop=e},play:function(){this._imageObject.play(),this._status=o.PLAYING},stop:function(){this._imageObject.pause(),this._status=o.PAUSE},whenReady:function(){return this._imageObject?(this._canPlayDefered||(this._canPlayDefered=r.defer(),this._imageObject.readyState>3?this._canPlayDefered.resolve(this):this._imageObject.addEventListener("canplaythrough",this._canPlayDefered.resolve.bind(this._canPlayDefered,this),!0)),this._canPlayDefered.promise):r.reject()}}),"osg","ImageStream"),e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(67),a=i(654),o=function(e){n.call(this),this._buildOptions=void 0!==e?e:{_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:20}};r.createPrototypeObject(o,r.objectInherit(n.prototype,{apply:function(e){if(e.getShape){if(void 0===e.getShape()){var t=new a;t.build(this._buildOptions,e)&&e.setShape(t)}}this.traverse(e)}}),"osg","KdTreeBuilder"),e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(68),a=function(e){n.call(this),this.lineWidth=1,void 0!==e&&(this.lineWidth=e)};r.createPrototypeStateAttribute(a,r.objectInherit(n.prototype,{attributeType:"LineWidth",cloneType:function(){return new a},apply:function(e){e.getGraphicContext().lineWidth(this.lineWidth)}}),"osg","LineWidth"),e.exports=a},function(e,t,i){"use strict";var r=i(14),n=i(68),a=i(88),o=function(e){n.call(this),this._enable=!e,this._pointSize=1,this._circleShape=!1};r.createPrototypeStateAttribute(o,r.objectInherit(n.prototype,{attributeType:"PointSize",cloneType:function(){return new o(!0)},setCircleShape:function(e){this._circleShape=e},isCircleShape:function(){return this._circleShape},setEnabled:function(e){this._enable=e},isEnabled:function(){return this._enable},setPointSize:function(e){this._pointSize=e},getOrCreateUniforms:function(){var e=o;return e.uniforms?e.uniforms:(e.uniforms={pointSize:a.createFloat(1,"uPointSize")},e.uniforms)},getHash:function(){return this.getTypeMember()+(this.isEnabled()?"1":"0")+(this._circleShape?"1":"0")},apply:function(){if(this._enable){this.getOrCreateUniforms().pointSize.setFloat(this._pointSize)}}}),"osg","PointSizeAttribute"),e.exports=o},function(e,t,i){"use strict";var r=i(14),n=i(452),a=i(30),o=i(97),s=function(){o.call(this),this._images={};for(var e=0;e<6;e++)this._images[o.TEXTURE_CUBE_MAP_POSITIVE_X+e]=new n};r.createPrototypeStateAttribute(s,r.objectInherit(o.prototype,{setDefaultParameters:function(){o.prototype.setDefaultParameters.call(this),this._textureTarget=o.TEXTURE_CUBE_MAP,this._flipY=!1},cloneType:function(){return new s},setImage:function(e,t,i){var r=e;"string"==typeof r&&(r=o[r]),this._images[r].setImage(t,i),this.setImageFormat(i),this.setTextureSize(this._images[r].getWidth(),this._images[r].getHeight()),this._textureNull=!1,this.dirty()},getImage:function(e){return this._images[e].getImage()},initCubemapContent:function(e){var t=this._internalFormat;return this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_POSITIVE_X,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,t,this._textureWidth,this._textureHeight,0,t,this._type,null),!0},generateMipmap:function(e,t){if(this.hasMipmapFilter()){if(this._images[o.TEXTURE_CUBE_MAP_POSITIVE_X].hasMipmap())for(var i=0;i<6;i++){var r=this._images[o.TEXTURE_CUBE_MAP_POSITIVE_X+i];r.hasMipmap()||a.error("mipmap not set correctly for TextureCubemap");for(var n=this._internalFormat,s=1;s<r.getMipmap().length;s++){var u=r.getMipmap()[s].getWidth();this.applyTexImage2D(e,e.TEXTURE_CUBE_MAP_POSITIVE_X+i,s,n,u,u,0,n,this._type,r.getMipmap()[s].getImage())}}else e.generateMipmap(t);this._dirtyMipmap=!1}},applyImageTarget:function(e,t,i){var r=this._images[i];return r.getImage()&&r.isReady()?r.isDirty()?(this.setTextureSize(r.getWidth(),r.getHeight()),r.setDirty(!1),r.isTypedArray()?this.applyTexImage2D(e,i,0,t,this._textureWidth,this._textureHeight,0,t,this._type,r.getImage()):this.applyTexImage2D(e,i,0,t,t,this._type,r.getImage()),!this._unrefImageDataAfterApply||this.hasMipmap()&&r.hasMipmap()||r.release(),1):1:0},initCubemapContentImage:function(e){var t=this._internalFormat,i=0;return i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_POSITIVE_X),i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_NEGATIVE_X),i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_POSITIVE_Y),i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_NEGATIVE_Y),i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_POSITIVE_Z),6===(i+=this.applyImageTarget(e,t,e.TEXTURE_CUBE_MAP_NEGATIVE_Z))},apply:function(e){var t=e.getGraphicContext();if(this._dirtyTextureObject&&this.releaseGLObjects(),void 0===this._textureObject||this.isDirty())if(this._textureNull)t.bindTexture(this._textureTarget,null);else{this._textureObject||(this.computeTextureFormat(),this.init(e)),this._textureObject.bind(t);var i;i=this._images[o.TEXTURE_CUBE_MAP_POSITIVE_X].getImage()?this.initCubemapContentImage(t):this.initCubemapContent(t),i&&(this._dirty=!1,this.applyFilterParameter(t,this._textureTarget),this.generateMipmap(t,this._textureTarget))}else this._textureObject.bind(t),this.isDirtyMipmap()&&this.generateMipmap(t,this._textureTarget)}}),"osg","TextureCubeMap"),e.exports=s},function(e,t,i){"use strict";var r=i(30),n=i(331),a=function(e,t,i,r){this._target=e,this._internalFormat=t,this._width=i,this._height=r,this._size=0,this.computeSize()};a.prototype={match:function(e){return e._target===this._target&&e._internalFormat===this._internalFormat&&e._width===this._width&&e._height===this._height},computeSize:function(){var e=i(97),t=0;switch(this._internalFormat){case 1:case e.ALPHA:case e.LUMINANCE:t=8;break;case e.LUMINANCE_ALPHA:case 2:t=16;break;case e.RGB:case 3:t=24;break;case e.RGBA:case 4:t=32}var r=Math.ceil(this._width*this._height*t)/8;this._target===e.TEXTURE_CUBE_MAP&&(r*=6),r+=r/3,this._size=r},getSize:function(){return this._size}},a.getHash=function(){var e=Array.prototype.slice.call(arguments),t="";return e.forEach(function(e){t+=e}),t};var o=function(e,t,i){this._texture=e,this._id=t,this._textureSet=i};o.prototype={target:function(){return this._textureSet._profile._target},id:function(){return this._id},getTextureSet:function(){return this._textureSet},reset:function(){this._textureObject=null,this._texture=void 0},bind:function(e){e.bindTexture(this.target(),this._id)}};var s=function(e){this._profile=e,this._usedTextureObjects=[],this._orphanedTextureObjects=[]};s.prototype={getProfile:function(){return this._profile},getUsedTextureObjects:function(){return this._usedTextureObjects},getOrphanedTextureObjects:function(){return this._orphanedTextureObjects},takeOrGenerate:function(e,t){var i;if(this._orphanedTextureObjects.length>0)return i=this.takeFromOrphans(),i._texture=t,this._usedTextureObjects.push(i),i;var r=e.createTexture();return i=new o(t,r,this),this._usedTextureObjects.push(i),i},takeFromOrphans:function(){if(this._orphanedTextureObjects.length)return this._orphanedTextureObjects.pop()},orphan:function(e){var t=this._usedTextureObjects.indexOf(e);-1!==t&&(this._orphanedTextureObjects.push(this._usedTextureObjects[t]),this._usedTextureObjects.splice(t,1))},flushDeletedTextureObjects:function(e,t){if(t<=0)return t;var i,r=this._orphanedTextureObjects.length,a=0,o=n.instance().tick();for(i=0;i<r&&a<t;i++)e.deleteTexture(this._orphanedTextureObjects[i].id()),this._orphanedTextureObjects[i].reset(),a=n.instance().deltaS(o,n.instance().tick());return this._orphanedTextureObjects.splice(0,i),t-a},flushAllDeletedTextureObjects:function(e){for(var t=this._orphanedTextureObjects.length,i=this.getProfile().getSize(),n=0,a=t;n<a;++n)e.deleteTexture(this._orphanedTextureObjects[n].id()),this._orphanedTextureObjects[n].reset();this._orphanedTextureObjects.length=0,r.info("TextureManager: released "+t+" with "+t*i/1048576+" MB")}};var u=function(){this._textureSetMap={}};u.prototype={generateTextureObject:function(e,t,i,r,n,o){var u=a.getHash(i,r,n,o);return void 0===this._textureSetMap[u]&&(this._textureSetMap[u]=new s(new a(i,r,n,o))),this._textureSetMap[u].takeOrGenerate(e,t)},updateStats:function(e,t){var i=0,r=0;for(var n in this._textureSetMap){var a=this._textureSetMap[n].getProfile(),o=a.getSize(),s=this._textureSetMap[n].getUsedTextureObjects().length,u=this._textureSetMap[n].getOrphanedTextureObjects().length;i+=s*o,r+=u*o}var l=1048576;t("textureused").set(i/l),t("texturereserved").set(r/l),t("texturetotal").set((i+r)/l)},reportStats:function(){var e=0;for(var t in this._textureSetMap){var i=this._textureSetMap[t].getProfile(),n=i.getSize()/1048576,a=this._textureSetMap[t].getUsedTextureObjects().length;n*=a,e+=n,r.notice(String(n)+" MB with "+a+" texture of "+i._width+"x"+i._height+" "+i._internalFormat)}r.notice(String(e)+" MB in total")},flushAllDeletedTextureObjects:function(e){for(var t in this._textureSetMap)this._textureSetMap[t].flushAllDeletedTextureObjects(e)},flushDeletedTextureObjects:function(e,t){var i=t;for(var r in this._textureSetMap)if((i=this._textureSetMap[r].flushDeletedTextureObjects(e,i))<=0)break;return i},releaseTextureObject:function(e){if(e){e.getTextureSet().orphan(e)}}},e.exports=u},function(e,t,i){"use strict";!function(){if(!new window.Set(["test"]).has("test")){var e=window.Set;window.Set=function(t){var i=new e;if(t)for(var r=0;r<t.length;++r)i.add(t[r]);return i}}}();!function(){if(!Float32Array.prototype.slice){var e=function(e,t){return new this.constructor(this.subarray(e,t))};Int8Array.prototype.slice=e,Uint8Array.prototype.slice=e,Uint8ClampedArray.prototype.slice=e,Int16Array.prototype.slice=e,Uint16Array.prototype.slice=e,Int32Array.prototype.slice=e,Uint32Array.prototype.slice=e,Float32Array.prototype.slice=e,Float64Array.prototype.slice=e}}()},function(e,t,i){"use strict";var r=i(14),n=i(67),a=i(30),o=i(427),s=function(){n.call(this,n.TRAVERSE_ALL_CHILDREN),this._boneMap={}};r.createPrototypeObject(s,r.objectInherit(n.prototype,{apply:function(e){if(e.typeID===o.typeID){var t=e.getName();t?this._boneMap[t]=e:a.warn("found Bone without name")}this.traverse(e)},getBoneMap:function(){return this._boneMap}}),"osgAnimation","CollectBoneVisitor"),e.exports=s},function(e,t,i){"use strict";var r=i(14),n=i(67),a=i(498),o=function(){n.call(this,n.TRAVERSE_PARENTS),this._root=void 0,this._pathToRoot=void 0};r.createPrototypeObject(o,r.objectInherit(n.prototype,{apply:function(e){if(!this._root)return e.typeID===a.typeID?(this._root=e,void(this._pathToRoot=this.nodePath.slice(1))):void this.traverse(e)}}),"osgAnimation","FindNearestParentSkeleton"),e.exports=o},function(e,t,i){"use strict";var r=i(8).mat4,n=i(68),a=i(670),o=i(898),s=function(){this._isInitialized=!1,this._bones=[]};s.prototype={computeBonePalette:function(e,t){var i=this._bones;for(var r in e){var n=t[r],a=e[r];void 0!==n&&(i[n]=a)}return i},init:function(e){var t=new o;e.getSkeleton().accept(t);var i=t.getBoneMap();this.computeBonePalette(i,e._boneNameID);var r=3*this._bones.length,s=this._skinningAttribute=new a;return s.setMatrixPalette(new Float32Array(4*r)),e.getStateSetAnimation().setAttributeAndModes(s,n.ON),this._isInitialized=!0,!0},computeMatrixPalette:function(){var e=r.create();return function(t,i){for(var n=this._bones,a=this._skinningAttribute.getMatrixPalette(),o=0,s=0,u=n.length;s<u;s++){var l=n[s],c=l.getInvBindMatrixInSkeletonSpace(),h=l.getMatrixInSkeletonSpace();r.mul(e,h,c),r.mul(e,i,e),r.mul(e,e,t),a[o++]=e[0],a[o++]=e[4],a[o++]=e[8],a[o++]=e[12],a[o++]=e[1],a[o++]=e[5],a[o++]=e[9],a[o++]=e[13],a[o++]=e[2],a[o++]=e[6],a[o++]=e[10],a[o++]=e[14]}}}(),update:function(e){this._isInitialized||this.init(e),this.computeMatrixPalette(e.getMatrixFromSkeletonToGeometry(),e.getInvMatrixFromSkeletonToGeometry())}},e.exports=s},function(e,t,i){"use strict";var r=i(14),n=i(91),a=i(8).mat4,o=i(8).vec3,s=i(8).quat,u=i(364),l=function(e,t,i){n.call(this),this._axis=o.fromValues(0,0,1),t&&o.copy(this._axis,t),this._target=u.createFloatTarget("number"==typeof i?i:0),e&&this.setName(e)};r.createPrototypeObject(l,r.objectInherit(n.prototype,{init:function(e,t){this.setAxis(e),this.setAngle(t),this._target.defaultValue=t},setAxis:function(e){o.copy(this._axis,e)},setAngle:function(e){this._target.value=e},getTarget:function(){return this._target},resetToDefaultValue:function(){this.setAngle(this._target.defaultValue)},applyToMatrix:function(){var e=a.create(),t=s.create();return function(i){var r=this._axis,n=t,o=e,u=this._target.value;s.setAxisAngle(n,r,u),a.fromQuat(o,n),a.mul(i,i,o)}}()}),"osgAnimation","StackedRotateAxis"),e.exports=l},function(e,t,i){"use strict";var r=i(14),n=i(30),a=i(91),o=i(899),s=function(){a.call(this)};r.createPrototypeObject(s,r.objectInherit(a.prototype,{init:function(e){var t=new o;if(e.getParents().length>1&&n.warn("A RigGeometry should not have multi parent ( "+e.getName()+" )"),e.getParents()[0].accept(t),!t._root)return void n.warn("A RigGeometry did not find a parent skeleton for RigGeometry ( "+e.getName()+" )");e.setSkeleton(t._root),e.setPathToSkeleton(t._pathToRoot)},update:function(e){if(e&&"RigGeometry"!==e.className())return!0;var t=e;return t.getSkeleton()||0===t.getParents().length||this.init(t),!t.getSkeleton()||(t.getNeedToComputeMatrix()&&t.computeMatrixFromRootSkeleton(),t.update(),!0)}}),"osgAnimation","UpdateRigGeometry"),e.exports=s},function(e,t,i){"use strict";var r=function(e){return-e*(e-2)},n=function(e){return e*e},a=function(e){return(e-=1)*e*e+1},o=function(e){return e*e*e},s=function(e){return-((e-=1)*e*e*e-1)},u=function(e){return e*e*e*e},l=function(e){return Math.pow(2,-10*e)*Math.sin((e-.075)*(2*Math.PI)/.3)+1},c=function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375};e.exports={easeOutQuad:r,easeInQuad:n,easeOutCubic:a,easeInCubic:o,easeOutQuart:s,easeInQuart:u,easeOutElastic:l,easeOutBounce:c,EaseOutQuad:r,EaseInQuad:n,EaseOutCubic:a,EaseInCubic:o,EaseOutQuart:s,EaseInQuart:u,EaseOutElastic:l,EaseOutBounce:c}},function(e,t,i){"use strict";var r=i(14),n=i(500),a=i(670),o=i(456),s=i(667),u=i(427),l=i(429),c=i(668),h=i(903),d=i(676),p=i(669),f=i(385),g=i(428),m=i(498),v=i(671),_=i(672),b=i(901),x=i(572),S=i(673),y=i(573),C=i(499),T=i(574),M=i(674),w={};r.objectMix(w,h),r.objectMix(w,d),w.Animation=n,w.SkinningAttribute=a,w.AnimationUpdateCallback=o,w.BasicAnimationManager=s,w.Bone=u,w.Channel=l,w.CollectAnimationUpdateCallbackVisitor=c,w.MorphAttribute=p,w.MorphGeometry=f,w.RigGeometry=g,w.Skeleton=m,w.StackedMatrix=v,w.StackedQuaternion=_,w.StackedRotateAxis=b,w.StackedScale=x,w.StackedTranslate=S,w.UpdateBone=y,w.UpdateMatrixTransform=C,w.UpdateMorph=T,w.UpdateSkeleton=M,e.exports=w},function(e,t,i){"use strict";var r={prefixURL:"",databasePath:"",progressXHRCallback:void 0,readNodeURL:void 0,readImageURL:void 0,readBinaryArrayURL:void 0,imageLoadingUsePromise:!0,imageOnload:void 0,imageCrossOrigin:void 0};e.exports=r},function(e,t,i){"use strict";var r=i(14),n=i(576),a=i(386),o=i(677),s=i(506),u=i(717),l=i(718),c=i(457),h=i(575),d={};d.Input=n,r.objectMix(d,a),d.DatabasePager=o,d.ObjectWrapper.serializers.osg=s,d.ObjectWrapper.serializers.osgAnimation=u,d.ObjectWrapper.serializers.osgText=l,d.Registry=c,d.FileHelper=h,d.requestFile=i(430);var p=i(560);r.objectMix(d,p),e.exports=d},function(e,t,i){"use strict";var r=i(14),n=i(501),a=i(503),o=i(504),s=i(711),u=i(455),l=i(8).mat4,c=i(8).vec2,h=i(8).vec3,d=i(8).quat,p=i(679),f=i(678),g=i(502),m=i(431),v=function(){n.call(this),this._tmpHomePosition=h.create(),this._intersectionVisitor=new a,this._lineSegmentIntersector=new o,this._polytopeIntersector=void 0,this._usePolytopeIntersector=!1,this._dimensionMask=m.ALL_PRIMITIVES,this.init()};v.Interpolator=function(){this._current=c.create(),this._target=c.create(),this._delta=c.create(),this._reset=!1,this.reset(),this._width=void 0,this._height=void 0},v.Interpolator.prototype={setWidth:function(e){this._width=e},setHeight:function(e){this._height=e},reset:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=0;this._reset=!0},update:function(){var e,t;return e=void 0===this._width?0:(this._target[0]-this._current[0])/this._width,this._delta[0]=e,this._current[0]=this._target[0],t=void 0===this._height?0:(this._target[1]-this._current[1])/this._height,this._delta[1]=t,this._current[1]=this._target[1],this._delta},set:function(){for(var e=0,t=this._current.length;e<t;e++)this._current[e]=this._target[e]=arguments[e];this._reset=!1},isReset:function(){return this._reset},getCurrent:function(){return this._current},setTarget:function(){for(var e=0,t=this._target.length;e<t;e++)this._reset?this._target[e]=this._current[e]=arguments[e]:this._target[e]=arguments[e];this._reset=!1},addTarget:function(){for(var e=0;e<arguments.length;e++)this._target[e]+=arguments[e]},getTarget:function(){return this._target},getDelta:function(){return this._delta}},v.AvailableControllerList=["StandardMouseKeyboard","Hammer"],v.ControllerList=["StandardMouseKeyboard","Hammer"],r.createPrototypeObject(v,r.objectInherit(n.prototype,{init:function(){this._distance=25,this._target=h.create(),this._upz=h.fromValues(0,0,1),this._right=h.fromValues(1,0,0),h.init(this._target);var e=l.fromRotation(l.create(),-Math.PI,this._upz),t=l.fromRotation(l.create(),Math.PI/10,this._right);this._rotation=l.create(),l.mul(this._rotation,e,t),this._time=0,this._rotate=new v.Interpolator,this._pan=new v.Interpolator,this._zoom=new g(1),this._panFactor=1.5,this._rotateFactor=1,this._zoomFactor=1,this._inverseMatrix=l.create(),this._homeEye=void 0,this._homeCenter=void 0,this._homeUp=h.fromValues(0,0,1),this._orientation=d.create(),this._pivotPoint=h.create(),this._eye=void 0,this._zoomDir=h.create();var i=this;v.ControllerList.forEach(function(e){void 0!==v[e]&&(i._controllerList[e]=new v[e](i))})},setViewer:function(e){this._viewer=e},reset:function(){this.init()},setNode:function(e){this._node=e},setPivotPoint:function(e){h.copy(this._pivotPoint,e)},setTarget:function(){var e=h.create();return function(t){h.copy(this._target,t),this.getEyePosition(e),this._distance=h.distance(t,e)}}(),setEyePosition:function(e){h.copy(this._eye,e),this._distance=h.distance(this._target,e)},setHomePosition:function(e,t,i){this._homeEye=e,this._homeCenter=t,this._homeUp=i},computeHomePosition:function(){var e=h.create(),t=h.create(),i=h.create(),r=l.create();return function(n){var a=this.getHomeBound(n);if(a){this.setDistance(this.getHomeDistance(a)),this.setTarget(a.center()),this.setPivotPoint(a.center()),void 0===this._homeEye&&(this._homeEye=h.create(),this.getEyePosition(this._homeEye)),void 0===this._homeCenter&&(this._homeCenter=h.create(),h.copy(this._homeCenter,a.center())),void 0===this._eye&&(this._eye=h.create()),h.copy(this._eye,this._homeEye),h.copy(this._target,this._homeCenter),h.copy(this._upz,this._homeUp),l.copy(r,this._rotation);var o=this._target,s=this._eye;h.sub(e,o,s),h.normalize(e,e),h.cross(t,e,this._upz),h.normalize(t,t),h.cross(i,t,e),h.normalize(i,i),r[0]=t[0],r[1]=i[0],r[2]=-e[0],r[3]=0,r[4]=t[1],r[5]=i[1],r[6]=-e[1],r[7]=0,r[8]=t[2],r[9]=i[2],r[10]=-e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,l.getRotation(this._orientation,r),d.invert(this._orientation,this._orientation)}}}(),setZoomFactor:function(e){this._zoomFactor=e},setRotateFactor:function(e){this._rotateFactor=e},setPanFactor:function(e){this._panFactor=e},setDistance:function(e){this._distance=e},setUsePolytopeIntersector:function(e){this._usePolytopeIntersector=e},getUsePolytopeIntersector:function(){return this._usePolytopeIntersector},getDistance:function(){return this._distance},zoom:function(e){this._distance=e},getRotateInterpolator:function(){return this._rotate},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getIntersectionVisitor:function(){return this._intersectionVisitor},getLineSegmentIntersector:function(){return this._lineSegmentIntersector},getOrCreatePolytopeIntersector:function(){return void 0===this._polytopeIntersector&&(this._polytopeIntersector=new s,this._polytopeIntersector.setIntersectionLimit(m.LIMIT_ONE_PER_DRAWABLE),this._polytopeIntersector.setDimensionMask(m.POINT_PRIMITIVES|m.LINE_PRIMITIVES)),this._polytopeIntersector},getTarget:function(e){return h.copy(e,this._target),e},getEyePosition:function(e){void 0===this._eye?this.computeEyePosition(this._target,this._distance,e):h.copy(e,this._eye)},computeEyePosition:function(){var e=h.create(),t=l.create();return function(i,r,n){l.invert(t,this._rotation),e[1]=r,h.transformMat4(n,e,t),h.add(n,i,n)}}(),computePan:function(){var e=h.create(),t=h.create(),i=h.create();return function(r,n,a){var o=h.length(h.sub(i,this._eye,this._pivotPoint))/this._panFactor;o<10&&(o=10),e[0]=r*o/2,e[1]=n*o/2,e[2]=0,h.transformMat4(t,e,a),h.add(this._eye,this._eye,t)}}(),computeZoom:function(){var e=h.create(),t=h.create();return function(i){var r=i*this._zoomFactor;h.sub(e,this._pivotPoint,this._eye),h.add(this._eye,this._eye,h.scale(t,e,r))}}(),computeRotation:function(){var e=h.create(),t=h.create(),i=h.create(),r=h.create(),n=d.create(),a=d.create(),o=d.create(),s=h.create(),u=h.create();return function(l,c){h.transformQuat(t,this._right,this._orientation),h.normalize(e,t),h.sub(i,this._eye,this._pivotPoint);var p=h.dot(e,i);h.sub(r,i,h.scale(u,e,p));var f=h.fromValues(-r[0],-r[1],0),g=Math.atan2(-r[2],h.length(f));c=Math.max(-Math.PI/2+.01,Math.min(Math.PI/2-.01,g+c))-g,d.setAxisAngle(n,t,c*this._rotateFactor),d.setAxisAngle(a,this._upz,l*this._rotateFactor),d.mul(o,a,n),h.transformQuat(s,i,o),h.add(this._eye,s,this._pivotPoint),d.mul(this._orientation,a,this._orientation),h.transformQuat(t,this._right,this._orientation),d.setAxisAngle(n,t,c*this._rotateFactor),d.mul(this._orientation,n,this._orientation)}}(),update:function(){var e=l.create(),t=l.create();return function(i){var r=i.getFrameStamp().getDeltaTime(),n=this._rotate.update();this.computeRotation(10*-n[0],10*n[1]),l.fromQuat(e,this._orientation);var a=this._pan.update();this.computePan(10*-a[0],10*-a[1],e),n=this._zoom.update(r),this.computeZoom(-n[0]/10),l.fromTranslation(t,this._eye),l.mul(this._inverseMatrix,t,e),l.invert(this._inverseMatrix,this._inverseMatrix)}}(),getInverseMatrix:function(){return this._inverseMatrix},computeIntersections:function(){var e=[],t=h.create();return function(i){var r=this._camera.getView(),n=this._camera,a=n.getViewport().width(),o=n.getViewport().height();this._rotate.setWidth(a),this._rotate.setHeight(o),this._pan.setWidth(a),this._pan.setHeight(o);var s,l;if(0!=(this._dimensionMask&m.TRIANGLE_PRIMITIVES)&&(e=r.computeIntersections(i[0],i[1]),e.length>0&&(s=e[0]._localIntersectionPoint,e[0]._nodePath.shift(),l=u.computeLocalToWorld(e[0]._nodePath),h.transformMat4(t,s,l),this.setPivotPoint(t))),0===e.length&&this._usePolytopeIntersector){var c=this.getOrCreatePolytopeIntersector();c.reset(),c.setPolytopeFromWindowCoordinates(i[0]-5,i[1]-5,i[0]+5,i[1]+5);var d=this._intersectionVisitor;d.setIntersector(c),r.getCamera().accept(d),e=c.getIntersections(),e.sort(function(e,t){return e._distance-t._distance}),e.length>0&&(s=e[0]._localIntersectionPoint,e[0]._nodePath.shift(),l=u.computeLocalToWorld(e[0]._nodePath),h.transformMat4(t,s,l),this.setPivotPoint(t))}}}(),getPositionRelativeToCanvas:function(){var e=c.create(),t=c.create();return function(i,r){var n=this._camera._graphicContext.canvas;this.getOffsetRect(n,e);var a=n.width/n.clientWidth,o=n.height/n.clientHeight;return t[0]=(i-e[1])*a,t[1]=(n.clientHeight-(r-e[0]))*o,t}}(),getCanvasCenter:function(){var e=c.create(),t=c.create();return function(){var i=this._camera.getGraphicContext().canvas;this.getOffsetRect(i,e);var r=i.width/i.clientWidth,n=i.height/i.clientHeight;return t[0]=i.clientWidth/2*r,t[1]=i.clientHeight/2*n,t}}(),getOffsetRect:function(e,t){var i=e.getBoundingClientRect(),r=document.body,n=document.documentElement,a=window.pageYOffset||n.scrollTop||r.scrollTop,o=window.pageXOffset||n.scrollLeft||r.scrollLeft,s=n.clientTop||r.clientTop||0,u=n.clientLeft||r.clientLeft||0,l=i.top+a-s,c=i.left+o-u;return t[0]=Math.round(l),t[1]=Math.round(c),t}}),"osgGA","CADManipulator"),v.StandardMouseKeyboard=p,v.Hammer=f,e.exports=v},function(e,t,i){"use strict";var r=i(14),n=i(501),a=i(8).mat4,o=i(8).vec2,s=i(8).vec3,u=i(8).quat,l=i(577),c=i(680),h=i(682),d=i(681),p=i(502),f=function(e){n.call(this,e),this.init()};f.AvailableControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],f.ControllerList=["StandardMouseKeyboard","WebVR","DeviceOrientation","Hammer"],r.createPrototypeObject(f,r.objectInherit(n.prototype,{computeHomePosition:function(e){var t=this.getHomeBound(e);if(t&&t.valid()){this._distance=this.getHomeDistance(t);var i=t.center();s.scale(this._eye,this._direction,-this._distance),s.add(this._eye,i,this._eye),this.setTarget(i)}},init:function(){this._direction=s.fromValues(0,1,0),this._eye=s.fromValues(0,25,10),this._up=s.fromValues(0,0,1),this._distance=1,this._forward=new p(1),this._side=new p(1),this._lookPosition=new p(2),this._pan=new p(2),this._zoom=new p(1),this._stepFactor=1,this._angleVertical=0,this._angleHorizontal=0,this._tmpGetTargetDir=s.create(),this._vrEnable=!1,this._vrRot=u.create(),this._vrPos=s.create(),this._vrTrans=s.create();var e=this;this._controllerList={},f.ControllerList.forEach(function(t){void 0!==f[t]&&(e._controllerList[t]=new f[t](e))})},setDelay:function(e){this._forward.setDelay(e),this._side.setDelay(e),this._lookPosition.setDelay(e),this._pan.setDelay(e),this._zoom.setDelay(e)},getEyePosition:function(e){return e[0]=this._eye[0],e[1]=this._eye[1],e[2]=this._eye[2],e},setEyePosition:function(e){return this._eye[0]=e[0],this._eye[1]=e[1],this._eye[2]=e[2],this},getTarget:function(e){var t=s.scale(this._tmpGetTargetDir,this._direction,this._distance);return s.add(e,this._eye,t),e},setTarget:function(e){var t=this._tmpGetTargetDir;s.sub(t,e,this._eye),t[2]=0,s.normalize(t,t),this._angleHorizontal=Math.acos(t[1]),t[0]<0&&(this._angleHorizontal=-this._angleHorizontal),s.sub(t,e,this._eye),s.normalize(t,t),this._angleVertical=-Math.asin(t[2]),s.copy(this._direction,t)},getLookPositionInterpolator:function(){return this._lookPosition},getSideInterpolator:function(){return this._side},getForwardInterpolator:function(){return this._forward},getPanInterpolator:function(){return this._pan},getZoomInterpolator:function(){return this._zoom},getRotateInterpolator:function(){return this._lookPosition},computeRotation:function(){var e=a.create(),t=a.create(),i=s.fromValues(1,0,0),r=s.fromValues(0,1,0),n=s.fromValues(0,0,1),o=.5*Math.PI;return function(u,l){this._angleVertical+=.01*l,this._angleHorizontal-=.01*u,this._angleVertical>o?this._angleVertical=o:this._angleVertical<-o&&(this._angleVertical=-o),this._vrEnable?(s.transformQuat(this._direction,r,this._vrRot),s.normalize(this._direction,this._direction),s.transformQuat(this._up,n,this._vrRot)):(a.fromRotation(e,-this._angleVertical,i),a.fromRotation(t,-this._angleHorizontal,n),a.mul(t,t,e),s.transformMat4(this._direction,r,t),s.normalize(this._direction,this._direction),s.transformMat4(this._up,n,t))}}(),reset:function(){this.init()},setDistance:function(e){this._distance=e},getDistance:function(){return this._distance},setStepFactor:function(e){this._stepFactor=e},computePosition:function(){var e=o.create();return function(t){this._forward.update(t),this._side.update(t);var i=this._distance<.001?.001:this._distance,r=this._camera.getProjectionMatrix(),n=1===r[15]?1:2/r[5];e[0]=this._forward.getCurrent()[0],e[1]=this._side.getCurrent()[0];var a=o.sqrLen(e);a>1&&o.scale(e,e,1/Math.sqrt(a));var u=this._pan.update(t),l=this._zoom.update(t),c=this._stepFactor*i*n*t,h=this._stepFactor*i*n*.005;this.moveForward(e[0]*c-l[0]*h*20),this.strafe(e[1]*c-u[0]*h),this.strafeVertical(-u[1]*h),this._vrEnable&&(s.add(this._eye,this._eye,this._vrTrans),s.init(this._vrTrans))}}(),update:function(){var e=s.create();return function(t){var i=t.getFrameStamp().getDeltaTime(),r=this._lookPosition.update(i);this.computeRotation(.5*-r[0],.5*-r[1]),this.computePosition(i),s.add(e,this._eye,this._direction),a.lookAt(this._inverseMatrix,this._eye,e,this._up),this._vrEnable=!1}}(),setPoseVR:function(e,t){this._vrEnable=!0,u.copy(this._vrRot,e),s.sub(this._vrTrans,t,this._vrPos),s.copy(this._vrPos,t)},moveForward:function(){var e=s.create();return function(t){s.normalize(e,this._direction),s.scale(e,e,t),s.add(this._eye,this._eye,e)}}(),strafe:function(){var e=s.create();return function(t){s.cross(e,this._direction,this._up),s.normalize(e,e),s.scale(e,e,t),s.add(this._eye,this._eye,e)}}(),strafeVertical:function(){var e=s.create();return function(t){s.normalize(e,this._up),s.scale(e,e,t),s.add(this._eye,this._eye,e)}}()}),"osgGA","FirstPersonManipulator"),f.DeviceOrientation=l,f.Hammer=c,f.WebVR=h,f.StandardMouseKeyboard=d,e.exports=f},function(e,t,i){"use strict";var r=function(){this._manipulatorList=[],this._currentManipulator=void 0};r.prototype={getCamera:function(){return this.getCurrentManipulator().getCamera()},setCamera:function(e){for(var t=this.getManipulatorList(),i=0,r=t.length;i<r;++i)t[i].setCamera(e)},update:function(e){var t=this.getCurrentManipulator();if(void 0!==t)return t.update(e)},getNode:function(){return this.getCurrentManipulator()._node},setNode:function(e){for(var t=this.getManipulatorList(),i=0,r=t.length;i<r;++i)t[i].setNode(e)},getControllerList:function(){return this.getCurrentManipulator().getControllerList()},getNumManipulator:function(){return this._manipulatorList.length},addManipulator:function(e){this._manipulatorList.push(e),void 0===this._currentManipulator&&this.setManipulatorIndex(0)},getManipulatorList:function(){return this._manipulatorList},setManipulatorIndex:function(e){this._currentManipulator=e},getCurrentManipulatorIndex:function(){return this._currentManipulator},getCurrentManipulator:function(){return this._manipulatorList[this._currentManipulator]},reset:function(){this.getCurrentManipulator().reset()},computeHomePosition:function(e){var t=this.getCurrentManipulator();void 0!==t&&t.computeHomePosition(e)},getInverseMatrix:function(){var e=this.getCurrentManipulator();if(void 0!==e)return e.getInverseMatrix()},getHomeBound:function(e){return this.getCurrentManipulator().getHomeBound(e)},getHomeDistance:function(e){return this.getCurrentManipulator().getHomeDistance(e)}},e.exports=r},function(e,t,i){"use strict";var r=i(338),n=i(907),a=i(679),o=i(678),s=i(908),u=i(577),l=i(680),c=i(681),h=i(682),d=i(501),p=i(578),f=i(683),g=i(684),m=i(579),v=i(685),_=i(686),b=i(687),x=i(909),S=i(688),y={};r.NO_MOUSEEVENTS=!0,y.CADManipulator=n,y.getCADManipulatorStandardMouseKeyboardController=function(){return a},y.getCADManipulatorHammerController=function(){return o},y.FirstPersonManipulator=s,y.getFirstPersonDeviceOrientationController=function(){return u},y.getFirstPersonManipulatorHammerController=function(){return l},y.getFirstPersonStandardMouseKeyboardControllerClass=function(){return c},y.getFirstPersonWebVRControllerClass=function(){return h},y.Manipulator=d,y.OrbitManipulator=p,y.getOrbitManipulatorDeviceOrientationController=function(){return f},y.getOrbitManipulatorGamePadController=function(){return g},y.getOrbitManipulatorHammerController=function(){return m},y.getOrbitManipulatorLeapMotionController=function(){return v},y.getOrbitManipulatorStandardMouseKeyboardController=function(){return _},y.getOrbitManipulatorWebVRController=function(){return b},y.SwitchManipulator=x,y.OrbitManipulator.Rotate=S.ROTATE,y.OrbitManipulator.Pan=S.PAN,y.OrbitManipulator.Zoom=S.ZOOM,e.exports=y},function(e,t,i){"use strict";var r=i(10),n=i(430),a=i(576),o=i(457),s=i(500),u=i(667),l=i(498),c=i(427),h=i(673),d=i(672),p=i(572),f=i(428),g=i(429),m=g.createQuatChannel,v=g.createVec3Channel,_=i(381),b=i(145),x=i(97),S=i(165),y=i(566),C=i(292),T=i(136),M=i(164),w=i(573),A=i(499),E=i(575),P=i(88),r=i(10),N=i(8).vec3,F=i(8).quat,R=i(8).mat4,I=function(){this._filesMap=void 0,this._loadedFiles=void 0,this._bufferViewCache=void 0,this._basicAnimationManager=void 0,this._visitedNodes=void 0,this._animatedNodes=void 0,this._skeletons=void 0,this._bones=void 0,this._skeletonToInfluenceMap=void 0,this._inputImgReader=void 0,this._localPath="",this.init()};I.WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},I.TYPE_TABLE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},I.TEXTURE_FORMAT={6406:x.ALPHA,6407:x.RGB,6408:x.RGBA,6409:x.LUMINANCE,6410:x.LUMINANCE_ALPHA},I.PBR_SPEC_EXT="KHR_materials_pbrSpecularGlossiness",I.PBR_SPEC_MODE="PBR_specular_glossiness",I.PBR_METAL_MODE="PBR_metal_roughness",I.ALBEDO_TEXTURE_UNIT=2,I.DIFFUSE_TEXTURE_UNIT=2,I.SPECULAR_GLOSSINESS_TEXTURE_UNIT=3,I.METALLIC_ROUGHNESS_TEXTURE_UNIT=3,I.SPECULAR_TEXTURE_UNIT=4,I.NORMAL_TEXTURE_UNIT=5,I.AO_TEXTURE_UNIT=6,I.ALBEDO_UNIFORM="albedoMap",I.METALLIC_ROUGHNESS_UNIFORM="metallicRoughnessMap",I.SPECULAR_UNIFORM="specularMap",I.NORMAL_UNIFORM="normalMap",I.AO_UNIFORM="aoMap",I.prototype={init:function(){this._glTFJSON=void 0,this._bufferViewCache={},this._basicAnimationManager=void 0,this._localPath="",this._visitedNodes={},this._animatedNodes={},this._skeletons={},this._bones={},this._skeletonToInfluenceMap={},this._stateSetMap={},this._filesMap=new window.Map,this._inputReader=new a},loadFile:r.method(function(e){if(this._filesMap.has(e))return this._filesMap.get(e);var t,i=e.substr(e.lastIndexOf(".")+1),r=E.getTypeForExtension(i),n=this._localPath+e;return"blob"===r?t=this._inputReader.readImageURL(n,{imageLoadingUsePromise:!0}):"arraybuffer"===r&&(t=this._inputReader.readBinaryArrayURL(n,{fileType:r})),this._filesMap.set(e,t),t.then(function(e){return e}),t}),loadAccessorBuffer:function(e,t){var i=this._glTFJSON,r=i.bufferViews[e.bufferView],n=i.buffers[r.buffer],a=this;return this.loadFile(n.uri).then(function(i){return a.assignBuffers(i,e,t,r)})},assignBuffers:r.method(function(e,t,i,r){if(!e)return null;var n=I.WEBGL_COMPONENT_TYPES[t.componentType],a=null;return this._bufferViewCache[t.bufferView]||(this._bufferViewCache[t.bufferView]=e.slice(r.byteOffset,r.byteOffset+r.byteLength)),a=new n(this._bufferViewCache[t.bufferView],t.byteOffset,t.count*I.TYPE_TABLE[t.type]),i?new M(i,a,I.TYPE_TABLE[t.type],!0):a}),findByKey:function(e,t){return e&&e[t]},registerUpdateCallback:function(e,t){var i=this._glTFJSON,r=null;r=i.nodes[e].jointName?new w:new A,r.setName(e);var n=N.create();R.getTranslation(n,t.getMatrix());var a=F.create();R.getRotation(a,t.getMatrix());var o=N.create();R.getScale(o,t.getMatrix()),r.getStackedTransforms().push(new h("translation",n)),r.getStackedTransforms().push(new d("rotation",a)),r.getStackedTransforms().push(new p("scale",o)),t.addUpdateCallback(r)},createTextureAndSetAttrib:r.method(function(e,t,i,r){if(e){var n=this._glTFJSON,a=n.textures[e.index];if(a){var o=n.images[a.source];if(o){var s=new x;s.setFlipY(!1),s.setWrapS("REPEAT"),s.setWrapT("REPEAT"),this.loadFile(o.uri).then(function(e){e&&(s.setImage(e,I.TEXTURE_FORMAT[a.format]),t.setTextureAttributeAndModes(i,s),r&&t.addUniform(P.createInt(i,r)))})}}}}),loadTransform:function(e){var t=R.create();if(e.matrix)return R.copy(t,e.matrix),t;var i=e.scale||N.ONE,r=e.rotation||F.IDENTITY,n=e.translation||N.ZERO;return R.fromRotationTranslationScale(t,r,n,i),t},preprocessChannel:function(e,t){var i=this._glTFJSON,n=[],a=t.samplers[e.sampler],o=i.accessors[a.input],s=i.accessors[a.output],u=this.loadAccessorBuffer(o,null),l=this.loadAccessorBuffer(s,null);n.push(u,l);var c=this;return r.all(n).then(function(t){var i=t[0],r=t[1],n=null;return 4===I.TYPE_TABLE[s.type]?n=m(r,i,e.target.node,e.target.path,null):3===I.TYPE_TABLE[s.type]&&(n=v(r,i,e.target.node,e.target.path,null)),c._animatedNodes[e.target.node]=!0,n})},createAnimationFromChannels:function(e,t){return r.all(e).then(function(e){return s.createAnimation(e,t)})},preprocessAnimations:r.method(function(){var e=this._glTFJSON;if(e.animations){for(var t=[],i=window.Object.keys(e.animations),n=0;n<i.length;++n){for(var a=e.animations[i[n]],o=[],s=0;s<a.channels.length;++s){var l=a.channels[s],c=this.preprocessChannel(l,a);o.push(c)}var h=this.createAnimationFromChannels(o,i[n]);t.push(h)}var d=this;return r.all(t).then(function(e){var t=new u;t.init(e),d._basicAnimationManager=t,t.playAnimation(e[0].name)})}}),loadBone:function(e,t){var i=this._glTFJSON,r=i.nodes[e],n=this,a=i.accessors[t.inverseBindMatrices];return this.loadAccessorBuffer(a,null).then(function(i){for(var a=0;a<t.joints.length&&t.joints[a]!==r.jointName;++a);var o=new c(r.jointName),s=i.subarray(16*a,16*a+16);return o.setInvBindMatrixInSkeletonSpace(s),n._bones[e]=o,o})},buildInfluenceMap:function(e,t){if(!this._skeletonToInfluenceMap[e]){this._skeletonToInfluenceMap[e]={};for(var i=0;i<t.joints.length;i++){var r=t.joints[i];this._skeletonToInfluenceMap[e][r]=i}}},mapBonesToSkin:function(){for(var e=this._glTFJSON,t={},i=window.Object.keys(e.skins),r=0;r<i.length;++r)for(var n=e.skins[i[r]],a=0;a<n.joints.length;++a)for(var o=n.joints[a],s=window.Object.keys(e.nodes),u=0;u<s.length;++u){var l=e.nodes[s[u]];l.jointName&&l.jointName===o&&(t[s[u]]=n)}return t},preprocessBones:function(e){for(var t=this._glTFJSON,i=window.Object.keys(t.nodes),n=[],a=0;a<i.length;++a){var o=i[a];if(t.nodes[o].jointName){var s=this.loadBone(o,e[o]);n.push(s)}}return r.all(n)},preprocessSkeletons:r.method(function(){var e=this._glTFJSON;if(e.skins){for(var t=this.mapBonesToSkin(),i=window.Object.keys(e.nodes),r=0;r<i.length;++r){var n=i[r],a=e.nodes[n],o=e.skins[a.skin];if(a.skeletons)for(var s=0;s<a.skeletons.length;++s){for(var u=null,c=a.skeletons[s],h=0;h<i.length;++h){var d=i[h],p=e.nodes[d];if(p.jointName){var f=e.nodes[c];if(p.jointName===f.jointName){u=d;break}}}u&&!this._skeletons[u]&&(this._skeletons[c]=new l,t[u]=o),this.buildInfluenceMap(c,o)}}return this.preprocessBones(t)}}),loadPBRMaterial:r.method(function(e,t,i,n){var a=t.pbrMetallicRoughness,o=i.getOrCreateStateSet(),s=[],u="";return a&&(a.baseColorTexture&&s.push(this.createTextureAndSetAttrib(a.baseColorTexture,o,I.ALBEDO_TEXTURE_UNIT,I.ALBEDO_UNIFORM)),a.metallicRoughnessTexture&&s.push(this.createTextureAndSetAttrib(a.metallicRoughnessTexture,o,I.METALLIC_ROUGHNESS_TEXTURE_UNIT,I.METALLIC_ROUGHNESS_UNIFORM)),u=I.PBR_METAL_MODE),n&&(n.diffuseTexture&&s.push(this.createTextureAndSetAttrib(n.diffuseTexture,o,I.DIFFUSE_TEXTURE_UNIT,I.ALBEDO_UNIFORM)),n.specularGlossinessTexture&&s.push(this.createTextureAndSetAttrib(n.specularGlossinessTexture,o,I.SPECULAR_GLOSSINESS_TEXTURE_UNIT,I.METALLIC_ROUGHNESS_UNIFORM)),u=I.PBR_SPEC_MODE),t.normalTexture&&s.push(this.createTextureAndSetAttrib(t.normalTexture,o,I.NORMAL_TEXTURE_UNIT,I.NORMAL_UNIFORM)),t.occlusionTexture&&s.push(this.createTextureAndSetAttrib(t.occlusionTexture,o,I.AO_TEXTURE_UNIT,I.AO_UNIFORM)),i.setUserData({pbrWorklow:u}),i.stateset=o,o.setRenderingHint("TRANSPARENT_BIN"),o.setRenderBinDetails(1e3,"RenderBin"),o.setAttributeAndModes(new _("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")),this._stateSetMap[e]=o,r.all(s)}),loadMaterial:r.method(function(e,t){var i=this._glTFJSON,r=i.materials[e];if(this._stateSetMap[e])return void(t.stateset=this._stateSetMap[e]);var n=this.findByKey(r.extensions,I.PBR_SPEC_EXT);if(r.pbrMetallicRoughness||n)return this.loadPBRMaterial(e,r,t,n);var a=r.values;if(a){var o=new y,s=t.getOrCreateStateSet();if(s.setAttribute(o),a.ambient&&o.setAmbient(a.ambient),a.emission&&o.setEmission(a.emission),a.shininess&&o.setShininess(a.shininess),a.specular&&o.setSpecular(a.specular),a.diffuse){if("string"==typeof a.diffuse)return this.createTextureAndSetAttrib(a.diffuse,s,0);o.setDiffuse(a.diffuse)}t.stateset=s,this._stateSetMap[e]=s}}),createGeometry:function(e,t){var i=this._glTFJSON,n=[],a=new b,o=a,s=function(e,t){t&&(this.getVertexAttributeList()[e]=t)};t&&(o=new f,o._boneNameID=this._skeletonToInfluenceMap[t]);for(var u=function(e){if(e){o.getAttributes().Weights=e;for(var t=o.getAttributes().Weights.getElements(),i=0,r=t.length/4;i<r;++i){var n=t[4*i]+t[4*i+1]+t[4*i+2]+t[4*i+3],a=1/n;t[4*i]*=a,t[4*i+1]*=a,t[4*i+2]*=a,t[4*i+3]*=a}}},l=window.Object.keys(e.attributes),c=0;c<l.length;++c){var h=i.accessors[e.attributes[l[c]]],d=this.loadAccessorBuffer(h,M.ARRAY_BUFFER);if(-1!==l[c].indexOf("POSITION"))d.then(s.bind(a,"Vertex"));else if(-1!==l[c].indexOf("NORMAL"))d.then(s.bind(a,"Normal"));else if(-1!==l[c].indexOf("TANGENT"))d.then(s.bind(a,"Tangent"));else if(-1!==l[c].indexOf("JOINT"))d.then(s.bind(o,"Bones"));else if(-1!==l[c].indexOf("WEIGHT"))d.then(u);else if(-1!==l[c].indexOf("TEXCOORD")){var p=l[c].substr(9);d.then(s.bind(a,"TexCoord"+p))}n.push(d)}var g=i.accessors[e.indices],m=this.loadAccessorBuffer(g,M.ELEMENT_ARRAY_BUFFER);return m.then(function(e){if(e){var t=new C(T.TRIANGLES,e);a.getPrimitives().push(t)}}),n.push(m),void 0!==e.material&&n.push(this.loadMaterial(e.material,a)),r.all(n).then(function(){return t&&(o.setSourceGeometry(a),o.mergeChildrenData(),o.computeBoundingBox=a.computeBoundingBox),o})},loadGLTFPrimitives:function(e,t,i){for(var n=this._glTFJSON,a=n.meshes[e],o=a.primitives,s=[],u=0;u<o.length;++u){var l=o[u],c=this.createGeometry(l,i);s.push(c)}return r.all(s).then(function(e){for(var i=0;i<e.length;++i)t.addChild(e[i]);return e})},loadGLTFNode:r.method(function(e,t){if(!this._visitedNodes[e]){var i=this._glTFJSON,n=i.nodes[e],a=n.jointName?this._bones[e]:new S;if(a.setName(e),R.copy(a.getMatrix(),this.loadTransform(n)),n.jointName&&this._skeletons[n.joinName]){var o=this._skeletons[n.jointName];o.addChild(a),t.addChild(o)}var s,u=n.children,l=[];if(u)for(s=0;s<u.length;++s){var c=this.loadGLTFNode(u[s],a);l.push(c)}if(void 0!==n.mesh){var h=n.mesh;if(n.skeletons)for(var d=0;d<n.skeletons.length;++d){var p=n.skeletons[d],f=this._skeletons[p],g=new S;R.copy(g.getMatrix(),a.getMatrix());var m=this.loadGLTFPrimitives(h,g,p);f.addChild(g),l.push(m)}else{var v=this.loadGLTFPrimitives(h,a,null);l.push(v)}}return this._animatedNodes[e]&&this.registerUpdateCallback(e,a),this._skeletons[e]||t.addChild(a),this._visitedNodes[e]=!0,r.all(l)}}),readNodeURL:function(e,t){var i=r.defer(),a=this;if(this.init(),t&&void 0!==t.filesMap&&t.filesMap.size>0){this._filesMap=t.filesMap;var o=this._filesMap.get(e);return this.readJSON(o,e)}var s=e.lastIndexOf("/");return this._localPath=-1===s?"":e.substr(0,s+1),n(e).then(function(e){i.resolve(a.readJSON(e))}),i.promise},readJSON:r.method(function(e,t){var i=new S;i.setName(t);var n=JSON.parse(e);if(n){this._glTFJSON=n;var a=[],o=this.preprocessAnimations(),s=this.preprocessSkeletons();a.push(s,o);var u=this;return r.all(a).then(function(){for(var e=[],t=window.Object.keys(n.scenes),a=0;a<t.length;++a){var o=n.scenes[t[a]];if(o)for(var s=0;s<o.nodes.length;++s){var l=u.loadGLTFNode(o.nodes[s],i);e.push(l)}}return u._basicAnimationManager&&i.addUpdateCallback(u._basicAnimationManager),r.all(e).then(function(){return i})})}})},o.instance().addReaderWriter("gltf",new I),e.exports=I},function(e,t,i){"use strict";var r=i(10),n=i(430),a=i(30),o=i(457),s=i(386),u=i(575),l=window.JSZip,c=function(){this._options=void 0,this._filesMap=new window.Map,this._fileName=""};c.prototype={readNodeURL:function(e,t){var i=r.defer();if(void 0===l)return a.error("You need to add JSZip as a dependency"),i.reject();a.log("starting to read: "+e);var o=this;if(t&&void 0!==t.filesMap&&t.filesMap.has(e)){var u=t.filesMap.get(e);return this.readZipFile(u).then(function(){return o._fileName.length?s.readNodeURL(o._fileName,{filesMap:o._filesMap}):r.reject(o)})}return n(e,{responseType:"blob"}).then(function(e){o.readZipFile(e).then(function(){i.resolve(s.readNodeURL(o._fileName,{filesMap:o._filesMap}))})}),i.promise},_registerZipImage:function(e,t,i,r){var n=r;"base64"===t&&(n=new window.Image,n.src="data:image/"+i+";base64,"+r),this._filesMap.set(e,n)},readZipFile:function(e){var t=r.defer();return l.loadAsync(e).then(function(e){var i=[];for(var n in e.files){var a=n.substr(n.lastIndexOf(".")+1);void 0===o.instance().getReaderWriterForExtension(a)&&"osgjs"!==a||(this._fileName=n);var s=u.getTypeForExtension(a);if(void 0!==s){"blob"===s&&(s="base64");var l=e.file(n).async(s).then(this._registerZipImage.bind(this,n,s,a));i.push(l)}}r.all(i).then(function(){t.resolve()})}.bind(this)),t.promise}},o.instance().addReaderWriter("zip",new c),e.exports=c},function(e,t,i){"use strict";var r=i(911),n=i(912),a={};a.ReaderWriterGLTF=r,a.ReaderWriterZIP=n,e.exports=a},function(e,t,i){"use strict";var r=i(453),n=i(30),a={_createFragmentShader:function(){var e=this.createFragmentShaderGraph(),t=this.getFragmentShaderName();t&&e.push(this.getNode("Define","SHADER_NAME").setValue(t));var i=this.createShaderFromGraphs(e);return n.debug(this.getDebugIdentifier()),n.debug(i),this.cleanAfterFragment(),i},applyPointSizeCircle:function(e){return this._pointSizeAttribute&&this._pointSizeAttribute.isEnabled()&&this._pointSizeAttribute.isCircleShape()?(this.getNode("InlineCode").code("if (length(2.0 * gl_PointCoord - 1.0) > %radius) discard;").inputs({radius:this.getOrCreateConstantOne("float")}).outputs({output:e}),e):e},cleanAfterFragment:function(){this._variables={},this._activeNodeList={};for(var e in this._texturesByName)this._texturesByName[e].variable=void 0;for(var t in this._varyings){var i=this._varyings[t];i.reset(),this._activeNodeList[i.getID()]=i,this._variables[t]=i}},createDefaultFragmentShaderGraph:function(){var e=this.getOrCreateConstant("vec4","fofd").setValue("vec4(1.0, 0.0, 1.0, 0.7)"),t=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(e).outputs(t),t},createFragmentShaderGraph:function(){var e=[];if(!this._material)return e.push(this.createDefaultFragmentShaderGraph()),e;var t=this._lights.length>0?this.createLighting():this.getOrCreateMaterialDiffuseColor(),i=this.getOrCreateMaterialEmission();if(i){var r=this.createVariable("vec3");this.getNode("Add").inputs(t,i).outputs(r),t=r}var n=this.getDiffuseColorFromTextures();if(n){var a=this.createVariable("vec3");this.getNode("Mult").inputs(t,n).outputs(a),t=a}var o=this.getAlpha();t=this.getPremultAlpha(t,o);var s=this.getNode("glFragColor");return this.getNode("SetAlpha").inputs({color:t,alpha:o}).outputs({color:s}),e.push(s),e},getAlpha:function(){var e=this.createVariable("float"),t=this.getFirstValidTexture(),i={color:this.getOrCreateMaterialDiffuseColor()};t&&(i.texelAlpha=t);var r=t?"%alpha = %color.a * %texelAlpha.a;":"%alpha = %color.a;";return this._isBillboard&&(r+="if ( %alpha == 0.0) discard;"),this.getNode("InlineCode").code(r).inputs(i).outputs({alpha:e}),e},getOrCreateFrontViewTangent:function(){var e=this._variables.frontViewTangent;return e||(e=this.createVariable("vec4","frontViewTangent"),this.getNode("FrontNormal").inputs({normal:this.getOrCreateVarying("vec4","vViewTangent")}).outputs({normal:e}),e)},getOrCreateFrontViewNormal:function(){var e=this._variables.frontViewNormal;return e||(e=this.createVariable("vec3","frontViewNormal"),this.getNode("FrontNormal").inputs({normal:this.getOrCreateVarying("vec3","vViewNormal")}).outputs({normal:e}),e)},getOrCreateNormalizedViewEyeDirection:function(){var e=this._variables.eyeVector;if(e)return e;var t=this.createVariable("vec3"),i=this.createVariable("vec3");this.getNode("SetFromNode").inputs(this.getOrCreateVarying("vec4","vViewVertex")).outputs(i),this.getNode("Normalize").inputs({vec:i}).outputs({vec:t});var r=this.createVariable("vec3","eyeVector");return this.getNode("Mult").inputs(t,this.createVariable("float").setValue("-1.0")).outputs(r),r},getOrCreateNormalizedFrontViewNormal:function(){var e=this._variables.nFrontViewNormal;return e||(e=this.createVariable("vec3","nFrontViewNormal"),this.getNode("Normalize").inputs({vec:this.getOrCreateFrontViewNormal()}).outputs({vec:e}),e)},getOrCreateFrontModelNormal:function(){var e=this._variables.frontModelNormal;return e||(e=this.createVariable("vec3","frontModelNormal"),this.getNode("FrontNormal").inputs({normal:this.getOrCreateVarying("vec3","vModelNormal")}).outputs({normal:e}),e)},getOrCreateNormalizedFrontModelNormal:function(){var e=this._variables.nFrontModelNormal;return e||(e=this.createVariable("vec3","nFrontModelNormal"),this.getNode("Normalize").inputs({vec:this.getOrCreateFrontModelNormal()}).outputs({vec:e}),e)},getPremultAlpha:function(e,t){if(void 0===t)return e;var i=this.createVariable("vec4");return this.getNode("PreMultAlpha").inputs({color:e,alpha:t}).outputs({color:i}),i},getColorsRGB:function(e){var t=this.createVariable("vec3");return this.getNode("LinearTosRGB").inputs({color:e}).outputs({color:t}),t},multiplyDiffuseWithVertexColor:function(e){var t=this.getOrCreateVarying("vec4","vVertexColor"),i=this.getOrCreateUniform("float","uArrayColorEnabled"),r=this.createVariable("vec4"),n=["","%color = %diffuse;","if ( %hasVertexColor == 1.0)","  %color *= %vertexColor;"].join("\n");return this.getNode("InlineCode").code(n).inputs({diffuse:e,hasVertexColor:i,vertexColor:t}).outputs({color:r}).comment("diffuse color = diffuse color * vertex color"),r},getDiffuseColorFromTextures:function(){var e=[],t=this._texturesByName;for(var i in t){t[i].shadow||e.push(this.getTextureByName(i).variable)}if(e.length>1){var r=this.createVariable("vec3","texDiffuseAccum");return this.getNode("Mult").inputs(e).outputs(r),r}if(1===e.length)return e[0]},getFirstValidTexture:function(){for(var e=this._textures,t=0,i=e.length;t<i;++t){var r=e[t];if(r)return this.getTextureByName(r.getName()).variable}},_getShadowFromLightNum:function(e,t){for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.getLightNumber()===t)return r}},getInputsFromShadow:function(e,t,i){var r=e.getOrCreateUniforms(),n=this._shadowsTextures.indexOf(t),a=t.getOrCreateUniforms(n),o={lighted:i,shadowTexture:this.getOrCreateSampler("sampler2D","Texture"+n),shadowTextureRenderSize:this.getOrCreateUniform(a.RenderSize),shadowTextureProjectionMatrix:this.getOrCreateUniform(a.ProjectionMatrix),shadowTextureViewMatrix:this.getOrCreateUniform(a.ViewMatrix),shadowTextureDepthRange:this.getOrCreateUniform(a.DepthRange),normalWorld:this.getOrCreateNormalizedFrontModelNormal(),vertexWorld:this.getOrCreateVarying("vec3","vModelVertex"),shadowBias:this.getOrCreateUniform(r.bias)};return e.getAtlas()&&(o.shadowTextureMapSize=this.getOrCreateUniform(a.MapSize)),e.getNormalBias()&&(o.shadowNormalBias=this.getOrCreateUniform(r.normalBias)),o},createShadowingLight:function(e,t){var i=e.getLightNumber(),r=this._getShadowFromLightNum(this._shadowsTextures,i),n=this._getShadowFromLightNum(this._shadows,i);if(r&&n){var a=this.getInputsFromShadow(n,r,t),o=this.createVariable("float");return this.getNode("ShadowReceive").setShadowAttribute(n).inputs(a).outputs({float:o}),o}},getOrCreateMaterialNormal:function(){return this.getOrCreateNormalizedFrontViewNormal()},getOrCreateMaterialDiffuseColor:function(){var e=this.getVariable("materialDiffuseColor");if(e)return e;e=this.createVariable("vec4","materialDiffuseColor");var t=this.getOrCreateUniform(this._material.getOrCreateUniforms().diffuse);return this.getNode("Mult").inputs(this.multiplyDiffuseWithVertexColor(t)).outputs(e),e},getOrCreateMaterialEmission:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().emission)},getOrCreateMaterialSpecularColor:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().specular)},getOrCreateMaterialSpecularHardness:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().shininess)},getOrCreateMaterialAmbient:function(){return this.getOrCreateUniform(this._material.getOrCreateUniforms().ambient)},getInputsFromLight:function(e){var t=e.getOrCreateUniforms(),i={normal:this.getOrCreateMaterialNormal(),eyeVector:this.getOrCreateNormalizedViewEyeDirection(),materialdiffuse:this.getOrCreateMaterialDiffuseColor(),materialspecular:this.getOrCreateMaterialSpecularColor(),materialshininess:this.getOrCreateMaterialSpecularHardness(),lightdiffuse:this.getOrCreateUniform(t.diffuse),lightposition:this.getOrCreateUniform(t.position),lightmatrix:this.getOrCreateUniform(t.matrix)},n=e.getLightType();return n===r.POINT?(i.lightspecular=this.getOrCreateUniform(t.specular),i.lightattenuation=this.getOrCreateUniform(t.attenuation)):n===r.SPOT?(i.lightspecular=this.getOrCreateUniform(t.specular),i.lightattenuation=this.getOrCreateUniform(t.attenuation),i.lightdirection=this.getOrCreateUniform(t.direction),i.lightspotCutOff=this.getOrCreateUniform(t.spotCutOff),i.lightspotBlend=this.getOrCreateUniform(t.spotBlend),i.lightinvMatrix=this.getOrCreateUniform(t.invMatrix)):n===r.DIRECTION?i.lightspecular=this.getOrCreateUniform(t.specular):n===r.HEMI&&(i.lightground=this.getOrCreateUniform(t.ground)),i},getOutputsFromLight:function(){return{color:this.createVariable("vec3"),lighted:this.createVariable("bool")}},getEnumLightToNodeName:function(){return{DIRECTION:"SunLight",SPOT:"SpotLight",POINT:"PointLight",HEMI:"HemiLight"}},createLighting:function(){for(var e=[],t=this.getEnumLightToNodeName(),i=0;i<this._lights.length;i++){var r=this._lights[i],n=t[r.getLightType()],a=this.getInputsFromLight(r),o=this.getOutputsFromLight(r);this.getNode(n).inputs(a).outputs(o);var s=o.color,u=this.createShadowingLight(r,o.lighted);u&&(s=this.createVariable("vec3"),this.getNode("Mult").inputs(o.color,u).outputs(s)),e.push(s)}if(this.addAmbientLighting(e),0===e.length)return this.getOrCreateConstantZero("vec3");if(1===e.length)return e[0];var l=this.createVariable("vec3");return this.getNode("Add").inputs(e).outputs(l),l},addAmbientLighting:function(e){for(var t=0;t<this._lights.length;t++){var i=this._lights[t],r=this.createVariable("vec3"),n=this.getOrCreateUniform(i.getOrCreateUniforms().ambient),a=this.getOrCreateMaterialAmbient();this.getNode("Mult").inputs(a,n).outputs(r),e.push(r)}},createTextureRGBA:function(e,t,i){var r=this.createVariable("vec4");return this.getNode("TextureRGBA").inputs({sampler:t,uv:i}).outputs({color:r}),r}};for(var o in a)a[o]=function(e,t){return function(){return this._fragmentShaderMode||this.logError("This function should not be called from vertex shader : "+t),e.apply(this,arguments)}}(a[o],o);e.exports=a},function(e,t,i){"use strict";var r=i(30),n={_createVertexShader:function(){var e=this.declareVertexMain(),t=this.getVertexShaderName();t&&e.push(this.getNode("Define","SHADER_NAME").setValue(t));var i=this.createShaderFromGraphs(e);return r.debug(this.getDebugIdentifier()),r.debug(i),i},declareVertexMain:function(){var e=[this.declarePointSize(),this.declareVertexPosition()];return this.declareVertexVaryings(e),e},declarePointSize:function(){var e=this.getNode("glPointSize");return this._pointSizeAttribute&&this._pointSizeAttribute.isEnabled()?(this.getNode("InlineCode").code("%pointSize = min(64.0, max(1.0, -%size / %position.z));").inputs({position:this.getOrCreateViewVertex(),size:this.getOrCreateUniform("float","uPointSize")}).outputs({pointSize:e}),e):(this.getNode("SetFromNode").inputs(this.getOrCreateConstantOne("float")).outputs(e),e)},declareVertexVaryings:function(e){var t=this._varyings;t.vModelVertex&&this.getNode("SetFromNode").inputs(this.getOrCreateModelVertex()).outputs(t.vModelVertex),t.vModelNormal&&this.getNode("SetFromNode").inputs(this.getOrCreateModelNormal()).outputs(t.vModelNormal),t.vModelTangent&&this.getNode("SetFromNode").inputs(this.getOrCreateModelTangent()).outputs(t.vModelTangent),t.vViewVertex&&this.getNode("SetFromNode").inputs(this.getOrCreateViewVertex()).outputs(t.vViewVertex),t.vViewNormal&&this.getNode("SetFromNode").inputs(this.getOrCreateViewNormal()).outputs(t.vViewNormal),t.vViewTangent&&this.getNode("SetFromNode").inputs(this.getOrCreateViewTangent()).outputs(t.vViewTangent),t.vVertexColor&&this.getNode("InlineCode").code("%vcolor = %venabled == 1.0 ? %acolor : vec4(1.0, 1.0, 1.0, 1.0);").inputs({venabled:this.getOrCreateUniform("float","uArrayColorEnabled"),acolor:this.getOrCreateAttribute("vec4","Color")}).outputs({vcolor:this.getOrCreateVarying("vec4","vVertexColor")});for(var i in t){var r=t[i];e.push(r);var n=r.getVariable();-1!==n.indexOf("vTexCoord")&&this.getNode("SetFromNode").inputs(this.getOrCreateAttribute("vec2",n.substring(1))).outputs(r)}},declareVertexPosition:function(){var e=this.getNode("glPosition");return this._isBillboard?this.declareVertexTransformBillboard(e):this.declareScreenVertex(e),e},getOrCreateModelVertex:function(){var e=this._variables.modelVertex;return e||(e=this.createVariable("vec3","modelVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:e}),e)},getOrCreateModelNormal:function(){var e=this._variables.modelNormal;return e||(e=this.createVariable("vec3","modelNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat3","uModelNormalMatrix"),vec:this.getOrCreateLocalNormal()}).outputs({vec:e}),e)},getOrCreateModelTangent:function(){var e=this._variables.modelTangent;return e||(e=this.createVariable("vec4","modelTangent"),this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({matrix:this.getOrCreateUniform("mat3","uModelNormalMatrix"),vec:this.getOrCreateLocalTangent()}).outputs({vec:e}),e)},getOrCreateViewVertex:function(){var e=this._variables.viewVertex;return e||(e=this.createVariable("vec4","viewVertex"),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uModelViewMatrix"),vec:this.getOrCreateLocalVertex()}).outputs({vec:e}),e)},getOrCreateViewNormal:function(){var e=this._variables.viewNormal;return e||(e=this.createVariable("vec3","viewNormal"),this.getNode("MatrixMultDirection").inputs({matrix:this.getOrCreateUniform("mat3","uModelViewNormalMatrix"),vec:this.getOrCreateLocalNormal()}).outputs({vec:e}),e)},getOrCreateViewTangent:function(){var e=this._variables.viewTangent;return e||(e=this.createVariable("vec4","viewTangent"),this.getNode("MatrixMultDirection").setOverwriteW(!1).inputs({matrix:this.getOrCreateUniform("mat3","uModelViewNormalMatrix"),vec:this.getOrCreateLocalTangent()}).outputs({vec:e}),e)},declareScreenVertex:function(e){this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateProjectionMatrix(),vec:this.getOrCreateViewVertex()}).outputs({vec:e})},declareVertexTransformBillboard:function(e){this.getNode("Billboard").inputs({Vertex:this.getOrCreateAttribute("vec3","Vertex"),ModelViewMatrix:this.getOrCreateUniform("mat4","uModelViewMatrix"),ProjectionMatrix:this.getOrCreateUniform("mat4","uProjectionMatrix")}).outputs({vec:e})},getOrCreateBoneMatrix:function(){var e=this._variables.boneMatrix;if(e)return e;e=this.createVariable("mat4","boneMatrix");var t=this.getOrCreateAttribute("vec4","Weights"),i=this.getOrCreateAttribute("vec4","Bones"),r=this.getOrCreateUniform("vec4","uBones",this._skinningAttribute.getBoneUniformSize());return this.getNode("Skinning").inputs({weights:t,bonesIndex:i,matrixPalette:r}).outputs({mat4:e}),e},getTarget:function(e,t){var i=-1!==e.indexOf("Tangent")?"vec4":"vec3";return this.getOrCreateAttribute(i,e+"_"+t)},morphTangentApproximation:function(e,t){var i=this.getOrCreateLocalNormal();return this._skinningAttribute&&(i=this.createVariable("vec3"),this.getNode("Normalize").inputs({vec:this.getOrCreateMorphNormal()}).outputs({vec:i})),this.getNode("InlineCode").code("%out = %tangent.rgb - dot(%tangent.rgb, %normal) * %normal;").inputs({tangent:e,normal:i}).outputs({out:t}),t},morphTransformVec3:function(e,t){for(var i={vertex:e,weights:this.getOrCreateUniform("vec4","uTargetWeights")},r=this._morphAttribute.getNumTargets(),n=0;n<r;n++)i["target"+n]=this.getTarget(e.getVariable(),n);return this.getNode("Morph").inputs(i).outputs({out:t}),t},skinTransformVertex:function(e,t){return this.getNode("MatrixMultPosition").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:e}).outputs({vec:t}),t},skinTransformNormal:function(e,t){return this.getNode("MatrixMultDirection").setInverse(!0).inputs({matrix:this.getOrCreateBoneMatrix(),vec:e}).outputs({vec:t}),t},getOrCreateMorphVertex:function(){var e=this.getVariable("morphVertex");if(e)return e;var t=this.getOrCreateAttribute("vec3","Vertex");return this._morphAttribute&&this._morphAttribute.hasTarget("Vertex")?this.morphTransformVec3(t,this.createVariable("vec3","morphVertex")):t},getOrCreateMorphNormal:function(){var e=this.getVariable("morphNormal");if(e)return e;var t=this.getOrCreateAttribute("vec3","Normal");return this._morphAttribute&&this._morphAttribute.hasTarget("Normal")?this.morphTransformVec3(t,this.createVariable("vec3","morphNormal")):t},getOrCreateMorphTangent:function(){var e=this.getVariable("morphTangent");if(e)return e;var t=this.getOrCreateAttribute("vec4","Tangent");return this._morphAttribute&&this._morphAttribute.hasTarget("Tangent")?this.morphTransformVec3(t,this.createVariable("vec3","morphTangent")):t},getOrCreateSkinVertex:function(){var e=this.getVariable("skinVertex");if(e)return e;var t=this.getOrCreateMorphVertex();return this._skinningAttribute?this.skinTransformVertex(t,this.createVariable("vec3","skinVertex")):t},getOrCreateSkinNormal:function(){var e=this.getVariable("skinNormal");if(e)return e;var t=this.getOrCreateMorphNormal();return this._skinningAttribute?this.skinTransformNormal(t,this.createVariable("vec3","skinNormal")):t},getOrCreateSkinTangent:function(){var e=this.getVariable("skinTangent");if(e)return e;var t=this.getOrCreateMorphTangent();return this._skinningAttribute?this.skinTransformNormal(t,this.createVariable("vec3","skinTangent")):t},getOrCreateLocalVertex:function(){return this.getOrCreateSkinVertex()},getOrCreateLocalNormal:function(){var e=this.getVariable("localNormal");if(e)return e;var t=this.getOrCreateSkinNormal();return t===this.getOrCreateAttribute("vec3","Normal")?t:(e=this.createVariable("vec3","localNormal"),this.getNode("Normalize").inputs({vec:t}).outputs({vec:e}),e)},getOrCreateLocalTangent:function(){var e=this.getVariable("localTangent");if(e)return e;var t=this.getOrCreateAttribute("vec4","Tangent"),i=this.getOrCreateSkinTangent();return i===t?i:this.normalizeAndSetAlpha(i,t,this.createVariable("vec4","localTangent"))},normalizeAndSetAlpha:function(e,t,i){var r=this.createVariable("vec3");return this.getNode("Normalize").inputs({vec:e}).outputs({vec:r}),this.getNode("SetAlpha").inputs({color:r,alpha:t}).outputs({color:i}),i}};for(var a in n)n[a]=function(e,t){return function(){return this._fragmentShaderMode&&this.logError("This function should not be called from fragment shader : "+t),e.apply(this,arguments)}}(n[a],a);e.exports=n},function(e,t,i){"use strict";var r=i(30),n=i(459),a=i(700),o=i(709),s=i(707),u=function(){return this._generators={},this.addShaderGenerator("default",new n),this.addShaderGenerator("ShadowCast",new a),this.addShaderGenerator("debugNormal",new o.ShaderGeneratorCompilerOffsetNormal),this.addShaderGenerator("debugTangent",new o.ShaderGeneratorCompilerOffsetTangent),this.addShaderGenerator("debugGeometry",new s.ShaderGeneratorCompilerColorGeometry),this.addShaderGenerator("debugSkinning",new s.ShaderGeneratorCompilerColorSkinning),this};u.prototype={getShaderGenerator:function(e){if(!e)return this._generators.default;var t=this._generators[e];return t||(r.error("ShaderGenerator "+e+" does not exist in ShaderGeneratorProxy"),this._generators.default)},addShaderGenerator:function(e,t){this._generators[e]=t}},e.exports=u},function(e,t,i){"use strict";var r=[i(695),i(693),i(690),i(696),i(691),i(692),i(694)],n={};r.forEach(function(e){for(var t in e){var i=e[t];if(void 0!==this[t])throw"duplicate entry in node library";this[t]=i}},n),e.exports=n},function(e,t,i){"use strict";var r=i(14),n=i(294),a=i(334),o=function(){a.apply(this)};r.createPrototypeObject(o,r.objectInherit(a.prototype,{type:"Billboard",validInputs:["Vertex","ModelViewMatrix","ProjectionMatrix"],validOutputs:["vec"],globalFunctionDeclaration:function(){return'#pragma include "billboard.glsl"'},computeShader:function(){return n.callFunction("billboard",this._outputs.vec,[this._inputs.Vertex,this._inputs.ModelViewMatrix,this._inputs.ProjectionMatrix])}}),"osgShader","Billboard"),e.exports={Billboard:o}},function(e,t,i){"use strict";var r=i(14),n=i(294),a=i(334),o=function(){a.call(this)};r.createPrototypeObject(o,r.objectInherit(a.prototype,{type:"ShadowReceiveNode",validInputs:["lighted","shadowTexture","shadowTextureRenderSize","shadowTextureProjectionMatrix","shadowTextureViewMatrix","shadowTextureDepthRange","normalWorld","vertexWorld","shadowBias"],validOutputs:["float"],globalFunctionDeclaration:function(){return'#pragma include "shadowsReceive.glsl"'},setShadowAttribute:function(e){return this._shadow=e,this},getDefines:function(){return this._shadow.getDefines()},getExtensions:function(){return this._shadow.getExtensions()},computeShader:function(){var e=this._inputs,t=[e.lighted,e.shadowTexture];return this._shadow.getAtlas()&&t.push(e.shadowTextureMapSize),t=t.concat([e.shadowTextureRenderSize,e.shadowTextureProjectionMatrix,e.shadowTextureViewMatrix,e.shadowTextureDepthRange,e.normalWorld,e.vertexWorld,e.shadowBias]),this._shadow.getNormalBias()&&t.push(e.shadowNormalBias),n.callFunction("computeShadow",this._outputs.float,t)}}),"osgShader","ShadowReceive");var s=function(){a.call(this)};r.createPrototypeObject(s,r.objectInherit(a.prototype,{type:"ShadowCast",validInputs:["shadowDepthRange","fragEye"],validOutputs:["color"],globalFunctionDeclaration:function(){return'#pragma include "shadowsCastFrag.glsl"'},setShadowCastAttribute:function(e){return this._shadowCast=e,this},getDefines:function(){return this._shadowCast.getDefines()},computeShader:function(){var e=this._inputs;return n.callFunction("computeShadowDepth",this._outputs.color,[e.fragEye,e.shadowDepthRange])}}),"osgShader","ShadowCast"),e.exports={ShadowCast:s,ShadowReceive:o}},function(e,t,i){"use strict";var r=i(829),n=i(830),a=i(832),o=i(833),s=i(828),u=i(831),l=i(827);e.exports={"functions.glsl":r,"lights.glsl":n,"skinning.glsl":a,"textures.glsl":o,"colorEncode.glsl":s,"noise.glsl":u,"billboard.glsl":l}},function(e,t,i){"use strict";var r=i(363),n=i(421),a=i(274),o=i(145),s=i(453),u=i(8).mat4,l=i(423),c=i(165),h=i(67),d=i(424),p=i(14),f=function(){h.call(this,h.TRAVERSE_ALL_CHILDREN),this._matrixStack=[u.create()],this._reservedMatrixStack=new l,this._bb=new r,this._bs=new n};p.createPrototypeObject(f,p.objectInherit(h.prototype,{reset:function(e,t,i,r,n){this.setTraversalMask(e),this._cameraFrustum=i,this._lightFrustum=n,this.getCameraPlaneMaskForLightNear(t,i,r?6:4),this._reservedMatrixStack.reset(),this._matrixStack.length=1,this._bb.init()},getBoundingBox:function(){return this._bb},getCameraPlaneMaskForLightNear:function(e,t,i){var r,n=1,a=15;for(r=0;r<i;++r)a=a<<1|1;var o=t.getPlanes();for(r=0;r<i;++r)d.distanceToPlane(o[r],e)<0&&(a^=n),n<<=1;return this._cameraPlaneMaskedByLightNear=a,t.setResultMask(a),t.pushCurrentMask(a),a},applyTransform:function(e){var t=this._reservedMatrixStack.get(),i=this._matrixStack.length;u.copy(t,this._matrixStack[i-1]),e.computeLocalToWorldMatrix(t,this);var r=this._bs;e.getBound().transformMat4(this._bs,t),(0===this._cameraFrustum.getCurrentMask()||this._cameraFrustum.containsBoundingSphere(r))&&(0===this._lightFrustum.getCurrentMask()||this._lightFrustum.containsBoundingSphere(r))&&(this._cameraFrustum.pushCurrentMask(),this._lightFrustum.pushCurrentMask(),this.pushMatrix(t),this.traverse(e),this._cameraFrustum.popCurrentMask(),this._lightFrustum.popCurrentMask(),this.popMatrix())},applyBoundingBox:function(){var e=new r;return function(t){var i=this._matrixStack.length,r=this._matrixStack[i-1];u.exactEquals(r,u.IDENTITY)?this._bb.expandByBoundingBox(t):t.valid()&&(t.transformMat4(e,r),this._bb.expandByBoundingBox(e))}}(),apply:function(e){var t=e.getTypeID();if(e instanceof c)return void this.applyTransform(e);if(t===o.getTypeID()){var i=this._bs,r=this._matrixStack[this._matrixStack.length-1];if(e.getBound().transformMat4(i,r),0!==this._cameraFrustum.getCurrentMask()&&!this._cameraFrustum.containsBoundingSphere(i))return;if(0!==this._lightFrustum.getCurrentMask()&&!this._lightFrustum.containsBoundingSphere(i))return;return void this.applyBoundingBox(e.getBoundingBox())}t===a.getTypeID()||s.getTypeID(),this.traverse(e)},pushMatrix:function(e){this._matrixStack.push(e)},popMatrix:function(){this._matrixStack.pop()}}),"osgShadow","ComputeMultiFrustumBoundsVisitor"),e.exports=f},function(e,t,i){"use strict";var r=i(30),n=i(68),a=i(97),o=i(88),s=i(14),u=i(658),l=i(8).vec4,c=i(582),h=i(705),d=i(702),p=function(e){this._lights=[],this._shadowMaps=[],this._viewportDimension=[],c.apply(this,arguments),this._shadowSettings=e,this._texture=new h,this._textureUnitBase=4,this._textureUnit=this._textureUnitBase,this._textureMagFilter=void 0,this._textureMinFilter=void 0,this._textureSize=1024,this._shadowMapSize=256,this._receivingStateset=void 0,this._shaderProcessor=void 0,e&&(this.setShadowSettings(e),e.atlasSize&&(this._textureSize=e.atlasSize),e.textureSize&&(this._shadowMapSize=e.textureSize)),this._texelSizeUniform=o.createFloat1(1/this._textureSize,"texelSize");var t=o.createFloat2("RenderSize");this._renderSize=t.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize};s.createPrototypeObject(p,s.objectInherit(c.prototype,{getTexture:function(){return this._texture},isDirty:function(e){if(void 0!==e)return this._shadowMaps[e].isDirty();for(var t=0,i=this._shadowMaps.length;t<i;t++)if(this._shadowMaps[t].isDirty())return!0;return!1},setTextureUnitBase:function(e){this._textureUnitBase=e,this._textureUnit=e;for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setTextureUnitBase(e)},setShadowSettings:function(e){if(e){this._shadowSettings=e;for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setShadowSettings(e);this.setTextureSize(e.textureSize),this.setTexturePrecision(e.textureType)}},setCastsShadowDrawTraversalMask:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setCastsShadowDrawTraversalMask(e)},getCastsShadowDrawTraversalMask:function(e){return void 0!==e?this._shadowMaps[e].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},setCastsShadowBoundsTraversalMask:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setCastsShadowBoundsTraversalMask(e)},getCastsShadowBoundsTraversalMask:function(e){return void 0!==e?this._shadowMaps[e].getCastsShadowDrawTraversalMask():0!==this._shadowMaps.length?this._shadowMaps[0].getCastsShadowDrawTraversalMask():void 0},getNormalBias:function(e){return void 0!==e?this._shadowMaps[e].getNormalBias():0!==this._shadowMaps.length?this._shadowMaps[0].getNormalBias():void 0},setNormalBias:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setNormalBias(e)},getBias:function(e){return void 0!==e?this._shadowMaps[e].getBias():0!==this._shadowMaps.length?this._shadowMaps[0].getBias():void 0},setBias:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setBias(e)},getKernelSizePCF:function(e){return void 0!==e?this._shadowMaps[e].getKernelSizePCF():1!==this._shadowMaps.length?this._shadowMaps[0].getKernelSizePCF():void 0},setKernelSizePCF:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setKernelSizePCF(e)},setShadowedScene:function(e){c.prototype.setShadowedScene.call(this,e),this._receivingStateset=this._shadowedScene.getReceivingStateSet();for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setShadowedScene(e)},setTexturePrecision:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].setTexturePrecision(e)},getTexturePrecision:function(e){return void 0!==e?this._shadowMaps[e].getTexturePrecision():1!==this._shadowMaps.length?this._shadowMaps[0].getTexturePrecision():void 0},setTextureSize:function(e){e!==this._textureSize&&(this._shadowMapSize=e,this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize,this.dirty())},getShadowMap:function(e){return this._shadowMaps[e]},addLight:function(e){if(!e||-1!==this._lights.indexOf(e))return r.warn("no light or light already added"),-1;var t=this._lights.length;if(t===this._numShadowWidth*this._numShadowHeight)return void r.warn("can't allocate shadow for light "+e.getLightNumber()+" ShadowAtlas already full ");this._lights.push(e),this._shadowSettings.setLight(e);var i=new d(this._shadowSettings,this._texture);this._shadowMaps.push(i);var n=this._shadowMapSize,a=n*(t%this._numShadowWidth),o=n*Math.floor(t/this._numShadowHeight);return i.setShadowedScene(this._shadowedScene),this._viewportDimension.push(l.fromValues(o,a,n,n)),i},init:function(){if(this._shadowedScene){this.initTexture();for(var e=[],t=0;t<this._lights.length;t++)e.push(this._lights[t].getLightNumber());this._texture.setLightNumberArray(e),this._textureUnit=this._textureUnitBase,this._texture.setName("ShadowTexture"+this._textureUnit),this._numShadowWidth=this._textureSize/this._shadowMapSize,this._numShadowHeight=this._textureSize/this._shadowMapSize;var i=o.createFloat2("RenderSize");this._texelSizeUniform=o.createFloat1(1/this._textureSize,"texelSize"),this._renderSize=i.getInternalArray(),this._renderSize[0]=this._renderSize[1]=this._textureSize;for(var r=0,a=this._shadowMaps.length;r<a;r++){var s=this._shadowMapSize,c=s*(r%this._numShadowWidth),h=s*Math.floor(r/this._numShadowHeight);this._viewportDimension[r]=l.fromValues(h,c,s,s),this._shadowMaps[r].init(this._texture,r,this._textureUnitBase),this._texture.setLightShadowMapSize(r,this._viewportDimension[r]);var d=this._shadowMaps[r].getCamera().getOrCreateStateSet(),p=new u(h,c,s,s);d.setAttributeAndModes(p,n.ON|n.OVERRIDE)}}},valid:function(){return!0},updateShadowTechnique:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].updateShadowTechnique(e,this._viewportDimension[t])},initTexture:function(){if(this._dirty){this._texture||(this._texture=new h,this._textureUnit=this._textureUnitBase),this._texture.setTextureSize(this._textureSize,this._textureSize),this._texelSizeUniform.setFloat(1/this._textureSize),this._renderSize[0]=this._textureSize,this._renderSize[1]=this._textureSize;var e;e=a.RGBA,d.prototype.setTextureFiltering.call(this),this._texture.setInternalFormat(e),this._texture.setWrapS(a.CLAMP_TO_EDGE),this._texture.setWrapT(a.CLAMP_TO_EDGE),this._texture.dirty()}},cullShadowCasting:function(e){for(var t=0,i=this._shadowMaps.length;t<i;t++)this._shadowMaps[t].cullShadowCasting(e)},cleanReceivingStateSet:function(){if(this._receivingStateset){this._texture&&this._receivingStateset.getTextureAttribute(this._textureUnit,this._texture.getTypeMember())===this._texture&&this._receivingStateset.removeTextureAttribute(this._textureUnit,this._texture.getTypeMember());for(var e=0,t=this._shadowMaps.length;e<t;e++)this._shadowMaps[e].cleanReceivingStateSet()}},cleanSceneGraph:function(){this._texture=void 0,this._shadowedScene=void 0},setDebug:function(e,t){if(t)this._shadowMaps[t].setDebug(e);else for(var i=0,r=this._shadowMaps.length;i<r;i++)this._shadowMaps[i].setDebug(e)}}),"osgShadow","ShadowMapAtlas"),e.exports=p},function(e,t,i){"use strict";var r=i(14),n=i(97),a=["1Tap(4texFetch)","4Tap(16texFetch)","9Tap(36texFetch)","16Tap(64texFetch)"],o=function(e){this.castsShadowDrawTraversalMask=4294967295,this.castsShadowBoundsTraversalMask=4294967295,this.textureSize=1024,this.textureType="UNSIGNED_BYTE",this.textureFormat=n.RGBA,this.shadowProjection="fov",this.fov=50,this.kernelSizePCF="4Tap(4texFetch)",this.bias=.005,this.normalBias=void 0,this.shadowCastShaderGeneratorName="ShadowCast",r.objectMix(this,e)};o.kernelSizeList=a,o.prototype={setCastsShadowDrawTraversalMask:function(e){this.castsShadowDrawTraversalMask=e},getCastsShadowDrawTraversalMask:function(){return this.castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(e){this.castsShadowBoundsTraversalMask=e},getCastsShadowBoundsTraversalMask:function(){return this.castsShadowBoundsTraversalMask},setLight:function(e){this.light=e},getLight:function(){return this.light},setTextureSize:function(e){this.textureSize=e},getTextureSize:function(){return this.textureSize},setTextureType:function(e){this.textureType=e},getTextureType:function(){return this.textureType},setTextureFormat:function(e){this.textureFormat=e},getTextureFormat:function(){return this.textureFormat},setShadowCastShaderGeneratorName:function(e){this.shadowCastShaderGeneratorName=e},getShadowCastShaderGeneratorName:function(){return this.shadowCastShaderGeneratorName}},e.exports=o},function(e,t,i){"use strict";var r=i(451),n=i(8).mat4,a=i(135),o=i(67),s=i(293),u=i(14),l=i(8).vec4,c=i(496),h=i(701),d=function(e){a.call(this),this._shadowTechniques=[],this._optimizedFrustum=!1,this._frustumReceivers=[l.create(),l.create(),l.create(),l.create(),l.create(),l.create()],this._tmpMat=n.create(),this._receivingStateset=new s,this._computeBoundsVisitor=new c,this._castsShadowDrawTraversalMask=4294967295,this._castsShadowBoundsTraversalMask=4294967295,e&&this.setShadowSettings(e)};u.createPrototypeNode(d,u.objectInherit(a.prototype,{getReceivingStateSet:function(){return this._receivingStateset},getShadowTechniques:function(){return this._shadowTechniques},addShadowTechnique:function(e){this._shadowTechniques.length>0&&-1!==this._shadowTechniques.indexOf(e)||(this._shadowTechniques.push(e),e.valid()&&(e.setShadowedScene(this),e.dirty()))},removeShadowTechnique:function(e){if(this._shadowTechniques.length>0){var t=this._shadowTechniques.indexOf(e);-1!==t&&(this._shadowTechniques[t].valid()&&this._shadowTechniques[t].cleanSceneGraph(),this._shadowTechniques.splice(t,1))}},cleanSceneGraph:function(){for(var e=0,t=this._shadowTechniques.length;e<t;e++)this._shadowTechniques[e]&&this._shadowTechniques[e].valid()&&this._shadowTechniques[e].cleanSceneGraph()},dirty:function(){for(var e=0;e<this._shadowTechniques.length;e++)this._shadowTechniques[e].dirty()},nodeTraverse:function(e){a.prototype.traverse.call(this,e)},setShadowSettings:function(e){this._settings=e,this.setCastsShadowDrawTraversalMask(e.castsShadowDrawTraversalMask),this.setCastsShadowBoundsTraversalMask(e.castsShadowBoundsTraversalMask),!1!==e.userShadowCasterVisitor&&(this._removeNodesNeverCastingVisitor=e.userShadowCasterVisitor||new h(this._castsShadowTraversalMask))},setCastsShadowDrawTraversalMask:function(e){this._castsShadowDrawTraversalMask=e},getCastsShadowDrawTraversalMask:function(){return this._castsDrawShadowTraversalMask},setCastsShadowBoundsTraversalMask:function(e){this._castsShadowBoundsTraversalMask=e},getCastsShadowBoundsTraversalMask:function(){return this._castsShadowBoundsTraversalMask},computeShadowedSceneBounds:function(){return this._removeNodesNeverCastingVisitor&&(this._removeNodesNeverCastingVisitor.setNoCastMask(~(this._castsShadowBoundsTraversalMask|this._castsShadowDrawTraversalMask)),this._removeNodesNeverCastingVisitor.reset(),this.accept(this._removeNodesNeverCastingVisitor)),this._computeBoundsVisitor.setTraversalMask(this._castsShadowBoundsTraversalMask),this._computeBoundsVisitor.reset(),this.accept(this._computeBoundsVisitor),!!this._computeBoundsVisitor.getBoundingBox().valid()||(this.noDraw(),this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore(),!1)},traverse:function(e){if(e.getVisitorType()===o.CULL_VISITOR){var t,i,r=this._shadowTechniques.length;r&&e.pushStateSet(this._receivingStateset),this.nodeTraverse(e),r&&e.popStateSet();var n=!1;for(t=0;t<r;t++)(i=this._shadowTechniques[t])&&i.valid()&&(i.isDirty()&&(n=!0,i.init()),!i.isEnabled()&&i.isFilledOnce()||(n=!0));if(!n)return;if(!this.computeShadowedSceneBounds(e)){for(t=0;t<r;t++)i=this._shadowTechniques[t],i.noDraw();return void(this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore())}var a=this._computeBoundsVisitor.getBoundingBox(),s=e.getCurrentModelMatrix();for(a.transformMat4(a,s),t=0;t<r;t++)i=this._shadowTechniques[t],!i.isEnabled()&&i.isFilledOnce()||(i.updateShadowTechnique(e),i.cullShadowCasting(e,a));this._removeNodesNeverCastingVisitor&&this._removeNodesNeverCastingVisitor.restore()}else this.nodeTraverse(e)}}),"osgShadow","ShadowedScene"),r.registerApplyFunction(d.nodeTypeID,r.getApplyFunction(a.nodeTypeID)),e.exports=d},function(e,t,i){"use strict";var r=i(698),n=i(699),a=i(700),o=i(701),s=i(921),u=i(702),l=i(922),c=i(703),h=i(923),d=i(582),p=i(704),f=i(705),g=i(924),m={};m.ShadowCastAttribute=r,m.ShadowCastCompiler=n,m.ShadowReceiveAttribute=c,m.ShadowCasterVisitor=o,m.ShadowFrustumIntersection=s,m.ShadowMap=u,m.ShadowMapAtlas=l,m.ShadowedScene=g,m.ShadowSettings=h,m.ShadowCastShaderGenerator=a,m.ShadowTechnique=d,m.ShadowTexture=p,m.ShadowTextureAtlas=f,e.exports=m},function(e,t,i){"use strict";var r=i(837),n=i(838),a=i(839),o=i(836),s=i(835),u=i(840),l=i(834);e.exports={"shadowsCastFrag.glsl":r,"shadowsReceive.glsl":n,"shadowsReceiveMain.glsl":a,"shadowLinearSoft.glsl":o,"pcf.glsl":s,"tapPCF.glsl":u,"hash.glsl":l}},function(e,t,i){"use strict";var r=i(706),n={};n.Text=r,e.exports=n},function(e,t,i){"use strict";var r=i(708),n=i(497),a=function(e){this._selectables=e,this._nodeList=[],this._linkList=[],this._renderBinMap=new window.Map,this._renderBinStack=[],this._generatorID=0,this._refID=0,this._uniqueEdges=new window.Set};a.prototype={getColorFromClassName:r.prototype.getColorFromClassName,createGraph:function(e){this.reset(),this.apply(e)},reset:function(){this._renderBinMap.clear(),this._renderBinStack.length=0,this._generatorID=0,this._refID++,this._nodeList.length=0,this._linkList.length=0,this._uniqueEdges.clear()},apply:function(e){var t=e.getInstanceID();if(this._renderBinMap.has(t)||this._renderBinMap.set(t,e),this._renderBinStack.push(e),e.getPreRenderStageList)for(var i=e.getPreRenderStageList(),r=0,n=i.length;r<n;++r)this.apply(i[r].renderStage);if(this.registerNode(e),e.getPostRenderStageList)for(var a=e.getPostRenderStageList(),o=0,s=a.length;o<s;++o)this.apply(a[o].renderStage);this._renderBinStack.pop()},registerNode:function(e){var t=e.getInstanceID();this._nodeList.push(e);var i=e._bins;for(var r in i)this.apply(i[r]);if(e._leafs.length)for(var n=0,a=e._leafs.length;n<a;n++)this.createNodeAndSetID(t,e._leafs[n]);for(var o=0,s=e.stateGraphList.length;o<s;o++){var u=e.stateGraphList[o];this.createNodeAndSetID(t,u);for(var l=u._instanceID,c=0,h=u.leafs.length;c<h;c++)this.createNodeAndSetID(l,u.leafs[c])}if(!(this._renderBinStack.length<2)){var d=this._renderBinStack[this._renderBinStack.length-2].getInstanceID();this.createLink(d,t)}},createLink:function(e,t){var i=e+"+"+t;this._uniqueEdges.has(i)||(this._linkList.push({parentNode:e,childrenNode:t}),this._uniqueEdges.add(i))},createNodeAndSetID:function(e,t){this._nodeList.push(t),(void 0===t._instanceID||t._instanceID<0&&t._refID!==this._refID)&&(t._instanceID=-1-this._generatorID++,t._refID=this._refID),this.createLink(e,t._instanceID)},generateRenderLeaf:function(e,t){var i=t._instanceID,r=t._geometry&&t._geometry.getName()?"\n"+t._geometry.getName():"Geometry",n="RenderLeaf ( "+t._instanceID+" )";n+="\n"+r+" ( "+t._geometry.getInstanceID()+" )",this._selectables.set(i.toString(),t),e.addNode(i,{label:n,description:"",style:"fill: "+this.getColorFromClassName("RenderLeaf")+";stroke-width: 0px;"})},generateStateGraph:function(e,t){var i=t._instanceID,r="StateGraph ( "+t._instanceID+" )";r+="\n"+t.leafs.length+" leafs",this._selectables.set(i.toString(),t),e.addNode(i,{label:r,description:"",style:"fill: "+this.getColorFromClassName("StateGraph")+";stroke-width: 0px;"})},generateRenderStage:function(e,t){var i=t.className()+" ( "+t._instanceID+" )";t.getName()&&(i+="\n"+t.getName()),i+="\nViewport ( "+t.getViewport().width()+" x "+t.getViewport().height()+" )",this._selectables.set(t.getInstanceID().toString(),t),e.addNode(t.getInstanceID(),{label:i,description:"",style:"fill: "+this.getColorFromClassName(t.className())+";stroke-width: 0px;"})},generateRenderBin:function(e,t){var i=t.className()+" ( "+t.getInstanceID()+" )";t.getName()&&(i+="\n"+t.getName());var r="";t.getSortMode()===n.SORT_BACK_TO_FRONT&&(r="SortMode: BackToFront");var a="BinNumber: "+t.getBinNumber()+"\n"+r;this._selectables.set(t.getInstanceID().toString(),t),e.addNode(t.getInstanceID(),{label:i,description:a,style:"fill: "+this.getColorFromClassName(t.className())+";stroke-width: 0px;"})},generateNodeAndLink:function(e){for(var t=0,i=this._nodeList.length;t<i;t++){var r=this._nodeList[t];r._geometry&&void 0!==r._depth?this.generateRenderLeaf(e,r):void 0!==r.depth&&r.leafs&&r.children?this.generateStateGraph(e,r):"RenderStage"===r.className()?this.generateRenderStage(e,r):this.generateRenderBin(e,r)}for(var n=0,a=this._linkList.length;n<a;n++)e.addEdge(null,this._linkList[n].parentNode,this._linkList[n].childrenNode)}},e.exports=a},function(e,t,i){"use strict";var r=i(135),n=i(165),a=i(382),o=i(381),s=i(563),u=i(88),l=i(8).vec2,c=i(8).vec3,h=i(8).vec4,d=i(8).mat4,p=i(8).quat,f=i(503),g=i(504),m=i(713),v=i(146),_=i(14),b=function(e,t){e[0]=void 0===t.offsetX?t.layerX:t.offsetX,e[1]=void 0===t.offsetY?t.layerY:t.offsetY},x=function(){};x.prototype={cull:function(){return!1}};var S=new o(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),y=function(e){this._testPlane=e,this._inter=c.create(),g.call(this)};_.createPrototypeObject(y,_.objectInherit(g.prototype,{setTestPlane:function(e){this._testPlane=e},getTranslateDistance:function(){return this._inter},enter:function(){var e=c.create(),t=c.create();return function(i){if(void 0===i._nbAxis)return!0;if(c.init(e),e[i._nbAxis]=1,this._testPlane){var r=c.dot(this._iStart,e),n=c.dot(this._iEnd,e);if(r===n)return!1;var a=-r/(n-r);this._inter[0]=this._iStart[0]+(this._iEnd[0]-this._iStart[0])*a,this._inter[1]=this._iStart[1]+(this._iEnd[1]-this._iStart[1])*a,this._inter[2]=this._iStart[2]+(this._iEnd[2]-this._iStart[2])*a}else{c.normalize(t,c.sub(t,this._iEnd,this._iStart));var o=-c.dot(t,e),s=c.dot(this._iStart,t),u=Math.abs(1-o*o),l=-c.dot(this._iStart,e);c.init(this._inter),this._inter[i._nbAxis]=(o*s-l)/u}return!1}}(),intersect:function(){return!1}}),"osgUtil","LineCustomIntersector");var C=function(e){n.call(this),this._tmask=1,this._autoInsertMT=!1,this._viewer=e,this._canvas=e.getGraphicContext().canvas,this._manipulator=e.getManipulator(),this._rotateNode=new n,this._translateNode=new n,this._planeNode=new n,this._rotateInLocal=!0,this._translateInLocal=!0,this._showAngle=new n,this._downCanvasCoord=l.create(),this._hoverNode=null,this._keepHoverColor=h.create(),this._isEditing=!1,this._editLineOrigin=c.create(),this._editLineDirection=c.create(),this._editOffset=c.create(),this._editLocal=d.create(),this._editWorldTrans=d.create(),this._editWorldScaleRot=d.create(),this._editInvWorldScaleRot=d.create(),this._debugNode=new r,this._lastDistToEye=0,this._attachedNode=null,this.attachToGeometry(null),this._lsi=new y,this._origIntersect=c.create(),this._dstIntersect=c.create(),this._iv=new f,this._iv.setIntersector(this._lsi),this._eventMouse=e._eventProxy.StandardMouseKeyboard,this._enableMouseBack=!1,this.init()};C.NO_PICK=1,C.PICK_ARC_X=2,C.PICK_ARC_Y=4,C.PICK_ARC_Z=8,C.PICK_ARROW_X=16,C.PICK_ARROW_Y=32,C.PICK_ARROW_Z=64,C.PICK_PLANE_X=128,C.PICK_PLANE_Y=256,C.PICK_PLANE_Z=512,C.NO_FULL_CIRCLE=1024,C.PICK_ARC=C.PICK_ARC_X|C.PICK_ARC_Y|C.PICK_ARC_Z,C.PICK_ARROW=C.PICK_ARROW_X|C.PICK_ARROW_Y|C.PICK_ARROW_Z,C.PICK_PLANE=C.PICK_PLANE_X|C.PICK_PLANE_Y|C.PICK_PLANE_Z,C.PICK_GIZMO=C.PICK_ARC|C.PICK_ARROW|C.PICK_PLANE,_.createPrototypeNode(C,_.objectInherit(n.prototype,{setRotateInLocal:function(e){this._rotateInLocal=e},setTranslateInLocal:function(e){this._translateInLocal=e},setTraversalMask:function(e){this._tmask=e},isEditing:function(){return this._isEditing},init:function(){this.getOrCreateStateSet().setAttributeAndModes(new a(a.DISABLE)),this.getOrCreateStateSet().setAttributeAndModes(new s(s.DISABLE));var e=function(){};e.prototype={update:this.updateGizmo.bind(this)},this.addUpdateCallback(new e),this.addChild(this.initNodeTranslate()),this.addChild(this.initNodeTranslatePlane()),this.addChild(this.initNodeRotate()),this._debugNode&&(this._debugNode.addChild(m.createDebugLineGeometry()),this.addChild(this._debugNode),this._debugNode.setNodeMask(0));var t=this._canvas;t.addEventListener("mousemove",this.onMouseMove.bind(this)),t.addEventListener("mousedown",this.onMouseDown.bind(this)),t.addEventListener("mouseup",this.onMouseUp.bind(this)),t.addEventListener("mouseout",this.onMouseUp.bind(this))},attachToNodePath:function(e){var t;if(e)for(var i=e.length-1;i>=0;--i){var r=e[i].editMask||0;if(r&C.PICK_GIZMO){t=e[i];break}}if(!t)return this._attachedNode=null,void this.setNodeMask(0);this._attachedNode=t,this.updateGizmoMask()},attachToMatrixTransform:function(e){if(!e)return this._attachedNode=null,void this.setNodeMask(0);void 0===e.editMask&&(e.editMask=C.PICK_GIZMO),this._attachedNode=e,this.updateGizmoMask()},attachToGeometry:function(e){var t=e;if(!t)return this._attachedNode=null,void this.setNodeMask(0);var i=t.getParents();if(void 0===i[0].editMask){for(var r=new n;i.length>0;)i[0].addChild(r),i[0].removeChild(t);r.addChild(t),r.editMask=C.PICK_GIZMO,t=r}else t=i[0];this._attachedNode=t,this.updateGizmoMask()},updateGizmoMask:function(){if(!this._attachedNode)return void this.setNodeMask(0);var e=this._attachedNode.editMask;this.setNodeMask(e&C.PICK_GIZMO?C.NO_PICK:0),this._translateNode.setNodeMask(e&C.PICK_ARROW?C.PICK_ARROW:0),this._rotateNode.setNodeMask(e&C.PICK_ARC?C.PICK_ARC:0),this._planeNode.setNodeMask(e&C.PICK_PLANE?C.PICK_PLANE:0);var t=this._translateNode.getChildren();t[0].setNodeMask(e&C.PICK_ARROW_X?C.PICK_ARROW_X:0),t[1].setNodeMask(e&C.PICK_ARROW_Y?C.PICK_ARROW_Y:0),t[2].setNodeMask(e&C.PICK_ARROW_Z?C.PICK_ARROW_Z:0);var i=this._rotateNode.getChildren();i[0].setNodeMask(e&C.NO_FULL_CIRCLE?0:C.NO_PICK),i[1].setNodeMask(e&C.PICK_ARC_X?C.PICK_ARC_X:0),i[2].setNodeMask(e&C.PICK_ARC_Y?C.PICK_ARC_Y:0),i[3].setNodeMask(e&C.PICK_ARC_Z?C.PICK_ARC_Z:0);var r=this._planeNode.getChildren();r[0].setNodeMask(e&C.PICK_PLANE_X?C.PICK_PLANE_X:0),r[1].setNodeMask(e&C.PICK_PLANE_Y?C.PICK_PLANE_Y:0),r[2].setNodeMask(e&C.PICK_PLANE_Z?C.PICK_PLANE_Z:0)},onNodeHovered:function(){var e=h.fromValues(1,1,0,1);return function(t){if(this._hoverNode&&this._hoverNode.getStateSet().getUniform("uColor").setFloat4(this._keepHoverColor),!t)return void(this._hoverNode=null);for(var i=t._nodePath,r=i.length-1,n=i[r];void 0===n._nbAxis;){if(0===r)return;n=i[--r]}var a=n.getStateSet().getUniform("uColor");this._hoverNode=n,h.copy(this._keepHoverColor,a.getInternalArray()),a.setFloat4(e)}}(),initNodeRotate:function(){var e=m.createTorusGeometry(1,.01,6,64,2*Math.PI),t=m.createTorusGeometry(1,.01,6,64,Math.PI),i=m.createTorusGeometry(1,.1,6,64,Math.PI),a=new n,o=new n,s=new n,l=new n;o._nbAxis=0,s._nbAxis=1,l._nbAxis=2;var d=new r;d.setCullCallback(new x),d.addChild(i),e.setNodeMask(C.NO_PICK),t.setNodeMask(C.NO_PICK),o.setNodeMask(C.PICK_ARC_X),s.setNodeMask(C.PICK_ARC_Y),l.setNodeMask(C.PICK_ARC_Z),a.addChild(e),o.addChild(t),s.addChild(t),l.addChild(t),o.addChild(d),s.addChild(d),l.addChild(d),a.getOrCreateStateSet().addUniform(u.createFloat4(h.fromValues(.2,.2,.2,1),"uColor")),o.getOrCreateStateSet().addUniform(u.createFloat4(h.fromValues(1,0,0,1),"uColor")),s.getOrCreateStateSet().addUniform(u.createFloat4(h.fromValues(0,1,0,1),"uColor")),l.getOrCreateStateSet().addUniform(u.createFloat4(h.fromValues(0,0,1,1),"uColor"));var p=this._showAngle;p.getOrCreateStateSet().setAttributeAndModes(S),p.setNodeMask(0),p.getOrCreateStateSet().addUniform(u.createFloat3(c.fromValues(1,0,0),"uBase")),p.getOrCreateStateSet().addUniform(u.createFloat(0,"uAngle")),p.addChild(m.createQuadCircleGeometry());var f=this._rotateNode;return f.setNodeMask(C.PICK_ARC),f.addChild(a),f.addChild(o),f.addChild(s),f.addChild(l),f.addChild(p),f},initNodeTranslate:function(){var e=new n;d.fromTranslation(e.getMatrix(),c.fromValues(0,0,1.65)),e.addChild(m.createCylinderGeometry(0,.07,.3,32,1,!0,!0));var t=new n;d.fromTranslation(t.getMatrix(),c.fromValues(0,0,.75)),t.addChild(m.createCylinderGeometry(.01,.01,1.5,32,1,!0,!0));var i=new r;i.addChild(t),i.addChild(e);var a=m.createCylinderGeometry(.1,.1,1.3*1.1,32,1,!0,!0),o=new n,s=new n,l=new n;o._nbAxis=0,s._nbAxis=1,l._nbAxis=2,d.fromRotation(o.getMatrix(),.5*Math.PI,c.fromValues(0,1,0)),d.fromRotation(s.getMatrix(),.5*-Math.PI,c.fromValues(1,0,0));var p=new n;p.setCullCallback(new x),d.fromTranslation(p.getMatrix(),c.fromValues(0,0,1.215)),p.addChild(a),i.setNodeMask(C.NO_PICK),o.setNodeMask(C.PICK_ARROW_X),s.setNodeMask(C.PICK_ARROW_Y),l.setNodeMask(C.PICK_ARROW_Z),o.addChild(i),s.addChild(i),l.addChild(i),o.addChild(p),s.addChild(p),l.addChild(p),o.getOrCreateStateSet().addUniform(u.createFloat4(h.fromValues(1,0,0,1),"uColor")),s.getOrCreateStateSet().addUniform(u.createFloat4(h.fromValues(0,1,0,1),"uColor")),l.getOrCreateStateSet().addUniform(u.createFloat4(h.fromValues(0,0,1,1),"uColor"));var f=this._translateNode;return f.setNodeMask(C.PICK_ARROW),f.addChild(o),f.addChild(s),f.addChild(l),f},initNodeTranslatePlane:function(){var e=new n;d.fromTranslation(e.getMatrix(),c.fromValues(.5,.5,0)),d.mul(e.getMatrix(),d.fromScaling(d.create(),c.fromValues(.5,.5,1)),e.getMatrix()),e.addChild(m.createPlaneGeometry());var t=new n,i=new n,r=new n;t._nbAxis=0,i._nbAxis=1,r._nbAxis=2,d.fromRotation(t.getMatrix(),.5*-Math.PI,c.fromValues(0,1,0)),d.fromRotation(i.getMatrix(),.5*Math.PI,c.fromValues(1,0,0)),t.setNodeMask(C.PICK_PLANE_X),i.setNodeMask(C.PICK_PLANE_Y),r.setNodeMask(C.PICK_PLANE_Z),t.addChild(e),i.addChild(e),r.addChild(e),t.getOrCreateStateSet().addUniform(u.createFloat4(h.fromValues(1,0,0,.3),"uColor")),i.getOrCreateStateSet().addUniform(u.createFloat4(h.fromValues(0,1,0,.3),"uColor")),r.getOrCreateStateSet().addUniform(u.createFloat4(h.fromValues(0,0,1,.3),"uColor"));var a=this._planeNode;return a.setNodeMask(C.PICK_PLANE),a.getOrCreateStateSet().setAttributeAndModes(S),a.addChild(t),a.addChild(i),a.addChild(r),a},updateArcRotation:function(){var e=p.create(),t=p.setAxisAngle(p.create(),[0,1,0],.5*-Math.PI),i=p.setAxisAngle(p.create(),[1,0,0],.5*-Math.PI);return function(r){var n=this._rotateNode,a=n.getChildren();e[0]=-r[1],e[1]=r[0],e[2]=0,e[3]=1+r[2],p.normalize(e,e),d.fromQuat(a[0].getMatrix(),e),p.setAxisAngle(e,[1,0,0],Math.atan2(r[2],r[1])),p.mul(e,e,t),d.fromQuat(a[1].getMatrix(),e),p.setAxisAngle(e,[0,1,0],Math.atan2(-r[0],-r[2])),p.mul(e,e,i),d.fromQuat(a[2].getMatrix(),e),p.setAxisAngle(e,[0,0,1],Math.atan2(-r[0],r[1])),d.fromQuat(a[3].getMatrix(),e),a[1].dirtyBound(),a[2].dirtyBound(),a[3].dirtyBound()}}(),getTransformType:function(e){for(var t=e;t.getParents().length>0;){if(void 0!==t.referenceFrame&&t.referenceFrame===v.ABSOLUTE_RF)return v.ABSOLUTE_RF;t=t.getParents()[0]}return v.RELATIVE_RF},updateGizmo:function(){var e=c.create(),t=c.create(),i=c.create(),r=d.create(),n=d.create(),a=d.create(),o=d.create();return function(){if(this._attachedNode){var s=this.getTransformType(this._attachedNode);this.setReferenceFrame(s),this.setCullingActive(s===v.RELATIVE_RF);var u=this._attachedNode.getWorldMatrices()[0];d.getTranslation(t,u),d.fromTranslation(n,t);var l=3;if(s===v.ABSOLUTE_RF)e[0]=e[1]=e[2]=0,i[0]=i[1]=i[2]=1;else{var h=this._viewer.getCamera().getProjectionMatrix(),p=.023*this._canvas.clientWidth*h[0];this._manipulator.getEyePosition(e),this._lastDistToEye=this._isEditing?this._lastDistToEye:c.distance(t,e),l*=this._lastDistToEye/p}d.fromScaling(o,[l,l,l]),d.mul(this.getMatrix(),n,o),c.sub(e,e,t),c.normalize(e,e),this._rotateInLocal||this._translateInLocal?(d.getScale(i,u),d.fromScaling(a,i),d.invert(a,a),d.mul(r,u,a),r[12]=r[13]=r[14]=0,this._translateInLocal&&(d.copy(this._translateNode.getMatrix(),r),d.copy(this._planeNode.getMatrix(),r)),this._rotateInLocal&&(d.copy(this._rotateNode.getMatrix(),r),d.invert(r,r),c.transformMat4(e,e,r))):d.identity(this._rotateNode.getMatrix()),this.updateArcRotation(e),this._rotateNode.dirtyBound(),this._translateNode.dirtyBound(),this._planeNode.dirtyBound(),this._isEditing&&d.copy(this._showAngle.getMatrix(),this._hoverNode.getMatrix())}}}(),computeNearestIntersection:function(){var e=function(e,t){return e._ratio-t._ratio},t=l.create();return function(i,r){b(t,i);var n=this._viewer,a=this._canvas,o=t[0]*(n._canvasWidth/a.clientWidth),s=(a.clientHeight-t[1])*(n._canvasHeight/a.clientHeight),u=this._viewer.computeIntersections(o,s,r);if(0!==u.length)return u.sort(e),u[0]}}(),setOnlyGizmoPicking:function(){this._viewer.getCamera().addChild(this),this._viewer.getSceneData().setNodeMask(0),this.setNodeMask(-1)},setOnlyScenePicking:function(){this._viewer.getCamera().removeChild(this),this._viewer.getSceneData().setNodeMask(-1),this.setNodeMask(C.NO_PICK)},pickGizmo:function(e,t){this.setOnlyGizmoPicking();var i=this.computeNearestIntersection(e,t);return this.setOnlyScenePicking(),i},getCanvasPositionFromWorldPoint:function(){var e=d.create();return function(t,i){var r=this._viewer.getCamera(),n=i;r.getViewport()?r.getViewport().computeWindowMatrix(e):d.identity(e),d.mul(e,e,r.getProjectionMatrix()),this.getReferenceFrame()===v.RELATIVE_RF&&d.mul(e,e,r.getViewMatrix()),c.transformMat4(n,t,e);var a=this._viewer,o=this._canvas;return n[0]=n[0]/(a._canvasWidth/o.clientWidth),n[1]=o.clientHeight-n[1]/(a._canvasHeight/o.clientHeight),n}}(),onMouseDown:function(e){if(b(this._downCanvasCoord,e),this._hoverNode&&this._attachedNode){this._enableMouseBack=this._eventMouse.getEnable(),this._eventMouse.setEnable(!1),this.saveEditMatrices();var t=this._hoverNode.getParents()[0].getNodeMask();this._isEditing=!0,t&C.PICK_ARC?(this._translateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startRotateEdit(e)):t&C.PICK_ARROW?(this._rotateNode.setNodeMask(0),this._planeNode.setNodeMask(0),this.startTranslateEdit(e)):t&C.PICK_PLANE&&(this._rotateNode.setNodeMask(0),this._translateNode.setNodeMask(0),this.startPlaneEdit(e))}},saveEditMatrices:function(){d.copy(this._editLocal,this._attachedNode.getMatrix());var e=this._attachedNode.getWorldMatrices()[0];d.fromTranslation(this._editWorldTrans,c.fromValues(e[12],e[13],e[14])),d.copy(this._editWorldScaleRot,e),this._editWorldScaleRot[12]=this._editWorldScaleRot[13]=this._editWorldScaleRot[14]=0,d.invert(this._editInvWorldScaleRot,this._editWorldScaleRot)},startRotateEdit:function(e){var t=this._rotateNode.getWorldMatrices()[0],i=c.create();c.transformMat4(i,i,t),this.getCanvasPositionFromWorldPoint(i,i);var r=this.pickGizmo(e,this._hoverNode.getNodeMask()|C.PICK_ARC);if(r){var n=0===this._hoverNode._nbAxis?-1:1,a=c.create();a[0]=n*r._localIntersectionPoint[1],a[1]=-n*r._localIntersectionPoint[0],a[2]=r._localIntersectionPoint[2];var o=c.create();c.transformMat4(o,a,this._hoverNode.getMatrix()),c.transformMat4(o,o,t),this.getCanvasPositionFromWorldPoint(o,o);var s=this._editLineDirection;l.sub(s,o,i),l.normalize(s,s),this._showAngle.setNodeMask(C.NO_PICK),r._localIntersectionPoint[2]=0;var u=this._showAngle.getStateSet();u.getUniform("uAngle").setFloat(0),u.getUniform("uBase").setVec3(c.normalize(r._localIntersectionPoint,r._localIntersectionPoint)),b(this._editLineOrigin,e)}},startTranslateEdit:function(e){var t=this._editLineOrigin,i=this._editLineDirection,r=this._translateNode.getWorldMatrices()[0];d.getTranslation(t,r),c.init(i),i[this._hoverNode._nbAxis]=1,this._translateInLocal&&(c.transformMat4(i,i,this._editWorldScaleRot),c.normalize(i,i)),c.add(i,t,i),this.getCanvasPositionFromWorldPoint(t,t),this.getCanvasPositionFromWorldPoint(i,i),l.sub(i,i,t),l.normalize(i,i);var n=this._editOffset;b(n,e),l.sub(n,n,t)},startPlaneEdit:function(e){var t=this._editLineOrigin,i=this._planeNode.getWorldMatrices()[0];d.getTranslation(t,i),this.getCanvasPositionFromWorldPoint(t,t);var r=this._editOffset;b(r,e),l.sub(r,r,t)},drawLineCanvasDebug:function(e,t,i,r){this._debugNode.setNodeMask(C.NO_PICK);var n=this._debugNode.getChildren()[0].getAttributes().Vertex;n.getElements()[0]=e/this._canvas.clientWidth*2-1,n.getElements()[1]=(this._canvas.clientHeight-t)/this._canvas.clientHeight*2-1,n.getElements()[2]=i/this._canvas.clientWidth*2-1,n.getElements()[3]=(this._canvas.clientHeight-r)/this._canvas.clientHeight*2-1,n.dirty()},pickAndSelect:function(e){this.setNodeMask(0);var t=this.computeNearestIntersection(e,this._tmask);this._autoInsertMT?this.attachToGeometry(t?t._nodePath[t._nodePath.length-1]:t):this.attachToNodePath(t?t._nodePath:t)},onMouseUp:function(e){this._enableMouseBack&&(this._enableMouseBack=!1,this._eventMouse.setEnable(!0),this._eventMouse.mouseup(e)),this._debugNode&&this._debugNode.setNodeMask(0);var t=l.create();b(t,e),0===l.distance(t,this._downCanvasCoord)&&this.pickAndSelect(e),this._showAngle.setNodeMask(0),this._isEditing=!1,this._hoverNode&&this.updateGizmoMask()},onMouseMove:function(e){if(this._attachedNode){var t;if(!1===this._isEditing)return t=this.pickGizmo(e,C.PICK_GIZMO),void this.onNodeHovered(t);if(this._hoverNode){var i=this._hoverNode.getParents()[0];i===this._rotateNode?this.updateRotateEdit(e):i===this._translateNode?this.updateTranslateEdit(e):i===this._planeNode&&this.updatePlaneEdit(e)}}},updateRotateEdit:function(){var e=d.create(),t=l.create(),i=c.fromValues(1,0,0),r=c.fromValues(0,1,0),n=c.fromValues(0,0,1);return function(a){var o=this._editLineOrigin,s=this._editLineDirection;b(t,a),l.sub(t,t,o);var u=l.dot(t,s);this._debugNode&&this.drawLineCanvasDebug(o[0],o[1],o[0]+s[0]*u,o[1]+s[1]*u);var c=7*u/Math.min(this._canvas.clientWidth,this._canvas.clientHeight);c%=2*Math.PI;var h=this._hoverNode._nbAxis;0===h?d.fromRotation(e,-c,i):1===h?d.fromRotation(e,-c,r):2===h&&d.fromRotation(e,-c,n),this._showAngle.getOrCreateStateSet().getUniform("uAngle").setFloat(0===h?-c:c),this._rotateInLocal||(d.mul(e,this._editInvWorldScaleRot,e),d.mul(e,e,this._editWorldScaleRot)),d.mul(this._attachedNode.getMatrix(),this._editLocal,e),this._attachedNode.dirtyBound()}}(),updateTranslateEdit:function(){var e=l.create(),t=c.create();return function(i){var r=this._editLineOrigin,n=this._editLineDirection;b(e,i),l.sub(e,e,r),l.sub(e,e,this._editOffset);var a=l.dot(e,n);e[0]=r[0]+n[0]*a,e[1]=r[1]+n[1]*a,this._debugNode&&this.drawLineCanvasDebug(r[0],r[1],e[0],e[1]);var o=this._viewer,s=this._canvas,u=e[0]*(o._canvasWidth/s.clientWidth),h=(s.clientHeight-e[1])*(o._canvasHeight/s.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!1),this._lsi.set(c.set(this._origIntersect,u,h,0),c.set(this._dstIntersect,u,h,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),d.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){d.getScale(t,this._editInvWorldScaleRot);var p=this._lsi.getTranslateDistance();c.mul(t,t,p)}else c.transformMat4(t,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);d.translate(this._attachedNode.getMatrix(),this._editLocal,t),this._attachedNode.dirtyBound()}}(),updatePlaneEdit:function(){var e=l.create(),t=c.create();return function(i){b(e,i),l.sub(e,e,this._editOffset);var r=this._viewer,n=this._canvas,a=e[0]*(r._canvasWidth/n.clientWidth),o=(n.clientHeight-e[1])*(r._canvasHeight/n.clientHeight);if(this._lsi.reset(),this._lsi.setTestPlane(!0),this._lsi.set(c.set(this._origIntersect,a,o,0),c.set(this._dstIntersect,a,o,1)),this._iv.reset(),this._iv.setTraversalMask(this._hoverNode.getNodeMask()),d.copy(this.getMatrix(),this._editWorldTrans),this.setOnlyGizmoPicking(),this._viewer._camera.accept(this._iv),this.setOnlyScenePicking(),this._translateInLocal){d.getScale(t,this._editInvWorldScaleRot);var s=this._lsi.getTranslateDistance();c.mul(t,t,s)}else c.transformMat4(t,this._lsi.getTranslateDistance(),this._editInvWorldScaleRot);d.translate(this._attachedNode.getMatrix(),this._editLocal,t),this._attachedNode.dirtyBound()}}()}),"osgUtil","NodeGizmo"),e.exports=C},function(e,t,i){"use strict";var r=i(14),n=i(8).vec3,a=i(8).mat4,o=i(585),s=function(e,t,i,r,n,a){this._primitiveIndex=void 0,this._ratio=0,this._maxDistance=0,this._nodePath=void 0,this._drawable=void 0,this._matrix=void 0,this._localIntersectionPoint=void 0,this._localIntersectionNormal=void 0,this._numIntersectionPoints=0,this._zone=void 0,this._i1=e,this._i2=t,this._i3=i,this._r1=r,this._r2=n,this._r3=a},u=function(){o.apply(this),this._center=void 0,this._radius=0};r.createPrototypeObject(u,r.objectInherit(o.prototype,{set:function(e,t,i){this._center=e,this._radius=t,this._settings=i},enter:function(e){for(var t=this._radius*this._radius,i=0,r=e.getMin(),n=e.getMax(),a=0,o=0;o<3;o++)this._center[o]<r[o]?(a=this._center[o]-r[o],i+=a*a):this._center[o]>n[o]&&(a=this._center[o]-n[o],i+=a*a);return i<=t},intersect:function(){var e=n.create(),t=n.create(),i=n.create();return function(r,o,u,l,c,h){if(!this._settings._limitOneIntersection||!this._hit){n.sub(e,o,r),n.sub(t,u,r);var d=n.sqrLen(e),p=n.dot(e,t),f=n.sqrLen(t);n.sub(i,r,this._center);var g=n.dot(i,e),m=n.dot(i,t),v=n.sqrLen(i),_=Math.abs(d*f-p*p);if(!(_<1e-10)){var b,x=p*m-f*g,S=p*g-d*m,y=4;if(x+S<=_)if(x<0)S<0?(y=4,g<0?(S=0,-g>=d?(x=1,b=d+2*g+v):(x=-g/d,b=g*x+v)):(x=0,m>=0?(S=0,b=v):-m>=f?(S=1,b=f+2*m+v):(S=-m/f,b=m*S+v))):(y=3,x=0,m>=0?(S=0,b=v):-m>=f?(S=1,b=f+2*m+v):(S=-m/f,b=m*S+v));else if(S<0)y=5,S=0,g>=0?(x=0,b=v):-g>=d?(x=1,b=d+2*g+v):(x=-g/d,b=g*x+v);else{y=0;var C=1/_;x*=C,S*=C,b=x*(d*x+p*S+2*g)+S*(p*x+f*S+2*m)+v}else{var T,M,w,A;x<0?(y=2,T=p+g,M=f+m,M>T?(w=M-T,A=d-2*p+f,w>=A?(x=1,S=0,b=d+2*g+v):(x=w/A,S=1-x,b=x*(d*x+p*S+2*g)+S*(p*x+f*S+2*m)+v)):(x=0,M<=0?(S=1,b=f+2*m+v):m>=0?(S=0,b=v):(S=-m/f,b=m*S+v))):S<0?(y=6,T=p+m,M=d+g,M>T?(w=M-T,A=d-2*p+f,w>=A?(S=1,x=0,b=f+2*m+v):(S=w/A,x=1-S,b=x*(d*x+p*S+2*g)+S*(p*x+f*S+2*m)+v)):(S=0,M<=0?(x=1,b=d+2*g+v):g>=0?(x=0,b=v):(x=-g/d,b=g*x+v))):(y=1,w=f+m-p-g,w<=0?(x=0,S=1,b=f+2*m+v):(A=d-2*p+f,w>=A?(x=1,S=0,b=d+2*g+v):(x=w/A,S=1-x,b=x*(d*x+p*S+2*g)+S*(p*x+f*S+2*m)+v)))}if(b<0&&(b=0),!(b>this._radius*this._radius)){var E=n.create();E&&(E[0]=r[0]+x*e[0]+S*t[0],E[1]=r[1]+x*e[1]+S*t[1],E[2]=r[2]+x*e[2]+S*t[2]);var P=n.create();n.cross(P,e,t),n.normalize(P,P);var N=new s(l,c,h,1-x-S,x,S);N._ratio=Math.sqrt(b),N._matrix=a.clone(this._settings._intersectionVisitor.getModelMatrix()),N._nodePath=this._settings._intersectionVisitor.getNodePath().slice(),N._drawable=this._settings._drawable,N._primitiveIndex=this._primitiveIndex,N._localIntersectionPoint=E,N._localIntersectionNormal=P,N._zone=y,this._settings._sphereIntersector.getIntersections().push(N),this._hit=!0}}}}}()}),"osgUtil","TriangleSphereIntersector"),e.exports=u},function(e,t,i){"use strict";var r=i(8).vec3,n=i(8).mat4,a=i(930),o=i(431),s=function(){this._sphereIntersector=void 0,this._intersectionVisitor=void 0,this._geometry=void 0,this._vertices=[],this._limitOneIntersection=!1},u=function(){this._center=r.create(),this._iCenter=r.create(),this._radius=1,this._iRadius=1,this._intersections=[]};u.prototype={set:function(e,t){r.copy(this._center,e),r.copy(this._iCenter,e),this._radius=this._iRadius=t,this.reset()},setCenter:function(e){r.copy(this._center,e),r.copy(this._iCenter,e)},setRadius:function(e){this._radius=this._iRadius=e},reset:function(){this._intersections.length=0},enter:function(e){return!e.isCullingActive()||this.intersects(e.getBound())},setIntersectionLimit:function(e){this._intersectionLimit=e},getIntersectionLimit:function(){return this._intersectionLimit},intersects:function(e){if(!e.valid())return!1;var t=this._iRadius+e.radius();return r.sqrDist(e.center(),this._iCenter)<=t*t},intersect:function(){var e=new s,t=new a;return function(i,r){e._sphereIntersector=this,e._intersectionVisitor=i,r.getPrimitives&&(e._geometry=r,e._vertices=r.getVertexAttributeList()),e._limitOneIntersection=this._intersectionLimit===o.LIMIT_ONE_PER_DRAWABLE||this._intersectionLimit===o.LIMIT_ONE,t.set(this._iCenter,this._iRadius,e);var n=r.getShape();if(n)return n.intersect(t,n.getNodes()[0]);if(r.computeTransformedVertices){var a=r.getVertexAttributeList(),s=a.Vertex.getElements();a.Vertex._elements=r.computeTransformedVertices(),t.apply(r),a.Vertex._elements=s}else t.apply(r);return this._intersections>0}}(),getIntersections:function(){return this._intersections},setCurrentTransformation:function(){var e=r.create();return function(t){n.invert(t,t),r.transformMat4(this._iCenter,this._center,t),n.getScale(e,t);var i=e[0],a=e[1],o=e[2],s=i>a?i>o?i:o:a>o?a:o;this._iRadius=this._radius*s}}()},e.exports=u},function(e,t,i){"use strict";var r=i(14),n=i(164),a=i(145),o=i(67),s=i(136),u=i(8).vec3,l=r,c=function(){o.call(this),this._T=void 0,this._B=void 0,this._N=void 0,this._texCoordUnit=0};r.createPrototypeObject(c,r.objectInherit(o.prototype,{apply:function(e){e.getTypeID()===a.getTypeID()?this.generate(e,this._texCoordUnit):this.traverse(e)},setTexCoordUnit:function(e){this._texCoordUnit=e},computePrimitiveSet:function(e,t){if(t.getIndices){var i,r=t.getNumIndices(),n=e.getAttributes().Vertex,a=e.getAttributes().Normal,o=e.getAttributes()["TexCoord"+this._texCoordUnit];if(t.getMode()===s.TRIANGLES)for(i=0;i<r;i+=3)this.compute(t,n,a,o,i,i+1,i+2);else if(t.getMode()===s.TRIANGLE_STRIP)for(i=0;i<r-2;++i)i%2==0?this.compute(t,n,a,o,i,i+1,i+2):this.compute(t,n,a,o,i+1,i,i+2)}},generate:function(e,t){this._texCoordUnit=t,void 0===this._texCoordUnit&&(this._texCoordUnit=0);var i=e.getAttributes().Vertex.getElements().length;this._T=new l.Float32Array(i),this._B=new l.Float32Array(i),this._N=new l.Float32Array(i),e.getPrimitiveSetList().forEach(function(t){this.computePrimitiveSet(e,t)},this);for(var r=i/3,a=new l.Float32Array(4*r),o=u.create(),s=u.create(),c=u.create(),h=0;h<r;h++){var d=this._T.subarray(3*h,3*h+3),p=this._N.subarray(3*h,3*h+3),f=this._B.subarray(3*h,3*h+3);u.normalize(p,p);var g=u.dot(p,d);u.scale(s,p,g),u.sub(o,d,s),u.normalize(c,o),u.cross(o,p,d);var m=u.dot(o,f);m=m<0?-1:0,a[4*h]=c[0],a[4*h+1]=c[1],a[4*h+2]=c[2],a[4*h+3]=m}e.getAttributes().Normal.setElements(this._N),e.getAttributes().Tangent=new n("ARRAY_BUFFER",a,4)},compute:function(e,t,i,r,n,a,o){var s,l,c=e.index(n),h=e.index(a),d=e.index(o),p=t.getElements().subarray(3*c,3*c+3),f=t.getElements().subarray(3*h,3*h+3),g=t.getElements().subarray(3*d,3*d+3),m=i.getElements().subarray(3*c,3*c+3),v=i.getElements().subarray(3*h,3*h+3),_=i.getElements().subarray(3*d,3*d+3),b=r.getElements().subarray(2*c,2*c+2),x=r.getElements().subarray(2*h,2*h+2),S=r.getElements().subarray(2*d,2*d+2),y=u.create(),C=u.create(),T=u.create(),M=u.create(),w=u.create(),A=u.create(),E=u.create(),P=u.create(),N=u.create();u.set(P,f[0]-p[0],x[0]-b[0],x[1]-b[1]),u.set(N,g[0]-p[0],S[0]-b[0],S[1]-b[1]),u.cross(y,P,N),0!==y[0]&&(u.normalize(y,y),l=-y[1]/y[0],s=-y[2]/y[0],w[0]+=l,C[0]+=s,A[0]+=l,T[0]+=s,E[0]+=l,M[0]+=s),u.set(P,f[1]-p[1],x[0]-b[0],x[1]-b[1]),u.set(N,g[1]-p[1],S[0]-b[0],S[1]-b[1]),u.cross(y,P,N),0!==y[0]&&(u.normalize(y,y),l=-y[1]/y[0],s=-y[2]/y[0],w[1]+=l,C[1]+=s,A[1]+=l,T[1]+=s,E[1]+=l,M[1]+=s),u.set(P,f[2]-p[2],x[0]-b[0],x[1]-b[1]),u.set(N,g[2]-p[2],S[0]-b[0],S[1]-b[1]),u.cross(y,P,N),0!==y[0]&&(u.normalize(y,y),l=-y[1]/y[0],s=-y[2]/y[0],w[2]+=l,C[2]+=s,A[2]+=l,T[2]+=s,E[2]+=l,M[2]+=s);var F,R,I,O=u.create(),L=u.create();u.cross(O,m,w),u.cross(L,O,m),F=this._T.subarray(3*c,3*c+3),u.add(F,L,F),u.cross(O,C,m),u.cross(L,m,O),R=this._B.subarray(3*c,3*c+3),u.add(R,L,R),u.cross(O,v,A),u.cross(L,O,v),F=this._T.subarray(3*h,3*h+3),u.add(F,L,F),u.cross(O,T,v),u.cross(L,v,O),R=this._B.subarray(3*h,3*h+3),u.add(R,L,R),u.cross(O,_,E),u.cross(L,O,_),F=this._T.subarray(3*d,3*d+3),u.add(F,L,F),u.cross(O,M,_),u.cross(L,_,O),R=this._B.subarray(3*d,3*d+3),u.add(R,L,R),I=this._N.subarray(3*c,3*c+3),u.add(I,m,I),I=this._N.subarray(3*h,3*h+3),u.add(I,v,I),I=this._N.subarray(3*d,3*d+3),u.add(I,_,I)}}),"osgUtil","TangentSpaceGenerator"),e.exports=c},function(e,t,i){"use strict";var r=i(274),n=i(383),a=i(8).mat4,o=i(135),s=i(329),u=i(330),l=i(384),c=i(97),h=i(332),d=i(88),p=i(8).vec3,f=i(8).vec4,g=i(425),m=i(583),v=function(e,t){this._rootView=e,this._offsetView=t};v.prototype={update:function(e){var t=e.getViewMatrix();return a.mul(t,this._offsetView,this._rootView),!0}};var _=function(e){var t=new c;return t.setTextureSize(e.width,e.height),t.setMinFilter("LINEAR"),t.setMagFilter("LINEAR"),t},b=function(){var e=["#ifdef GL_ES","   precision highp float;","#endif","varying vec2 vTexCoord0;","uniform sampler2D TextureLeft;","uniform sampler2D TextureRight;","void main() {","   if (vTexCoord0.x < 0.5)","       gl_FragColor = texture2D(TextureLeft, vec2(vTexCoord0.x * 2.0, vTexCoord0.y));","   else","       gl_FragColor = texture2D(TextureRight, vec2(vTexCoord0.x * 2.0 - 1.0, vTexCoord0.y));","}"].join("\n");return new s(new u(u.VERTEX_SHADER,m.Filter.defaultVertexShader),new u(u.FRAGMENT_SHADER,e))},x=function(e,t,i){var n=new r;n.setViewport(i),n.setRenderOrder(r.NESTED_RENDER,0),n.setReferenceFrame(h.ABSOLUTE_RF),a.ortho(n.getProjectionMatrix(),0,1,0,1,-5,5);var o=n.getOrCreateStateSet();return o.addUniform(d.createInt(0,"TextureLeft")),o.addUniform(d.createInt(1,"TextureRight")),o.setTextureAttributeAndModes(0,e),o.setTextureAttributeAndModes(1,t),o.setAttributeAndModes(b()),n.addChild(l.createTexturedFullScreenFakeQuadGeometry()),n},S=function(e,t){var i=new r;return i.setName("rtt camera"),i.setViewport(new g(0,0,e.getWidth(),e.getHeight())),i.setProjectionMatrix(t),i.setClearColor(f.fromValues(.3,.3,.3,0)),i.setRenderOrder(r.POST_RENDER,0),i.attachTexture(n.COLOR_ATTACHMENT0,e),i.attachRenderBuffer(n.DEPTH_ATTACHMENT,n.DEPTH_COMPONENT16),i.setReferenceFrame(h.ABSOLUTE_RF),i},y={};y.createScene=function(e,t,i,r,n){var s=r||new o,u=void 0!==n?n:1,l=i.getEyeParameters("left"),c=i.getEyeParameters("right"),h=new window.VRFrameData;i.getFrameData(h);var d=a.fromTranslation(a.create(),p.fromValues(-u*l.offset[0],l.offset[1],l.offset[2])),f=a.fromTranslation(a.create(),p.fromValues(-u*c.offset[0],c.offset[1],c.offset[2])),g={width:Math.max(l.renderWidth,c.renderWidth),height:Math.max(l.renderHeight,c.renderHeight)},m=_(g),b=_(g),y=S(m,h.leftProjectionMatrix),C=S(b,h.rightProjectionMatrix),T=e.getCamera().getViewMatrix();y.addUpdateCallback(new v(T,d)),C.addUpdateCallback(new v(T,f));var M=x(m,b,e.getCamera().getViewport());return y.addChild(t),C.addChild(t),s.addChild(y),s.addChild(C),s.addChild(M),s},e.exports=y},function(e,t,i){"use strict";var r=i(274),n=i(383),a=i(8).mat4,o=i(135),s=i(329),u=i(330),l=i(384),c=i(97),h=i(332),d=i(88),p=i(8).vec2,f=i(8).vec3,g=i(8).vec4,m=i(425),v=i(583),_={},b=function(e,t,i,r,n){this._viewer=e,this._rttScene=t,this._hmdConfig=i,this._root=r,this._canvas=n,this._width=n.width,this._height=n.height};b.prototype={update:function(){var e=this._canvas,t=e.width,i=e.height;if(t!==this._width||i!==this._height){this._root.removeChildren();var r=this._hmdConfig;r&&r.isCardboard&&(r.hResolution=t,r.vResolution=i),this._width=t,this._height=i,_.createScene(this._viewer,this._rttScene,r,this._root)}return!0}};var x=function(e,t){this._rootView=e,this._offsetView=t};x.prototype={update:function(e){var t=e.getViewMatrix();return a.mul(t,this._offsetView,this._rootView),!0}};var S=function(e,t,i,r){var n=t.hResolution/(2*t.vResolution),o=-1-4*(.25*t.hScreenSize-.5*t.lensSeparationDistance)/t.hScreenSize,s=t.distortionK[0]+t.distortionK[1]*Math.pow(o,2)+t.distortionK[2]*Math.pow(o,4)+t.distortionK[3]*Math.pow(o,6),u=180/Math.PI*2*Math.atan2(t.vScreenSize*s,2*t.eyeToScreenDistance),l=a.perspective(a.create(),Math.PI/180*u,n,.3,1e4),c=4*(.25*t.hScreenSize-.5*t.interpupillaryDistance)/t.hScreenSize,h=4*(.25*t.hScreenSize-.5*t.lensSeparationDistance)/t.hScreenSize,d=a.create(),g=a.create();r.projectionLeft=a.mul(d,a.fromTranslation(d,f.fromValues(c,0,0)),l),r.projectionRight=a.mul(g,a.fromTranslation(g,f.fromValues(-c,0,0)),l),r.viewLeft=a.fromTranslation(a.create(),f.fromValues(e*t.interpupillaryDistance*.5,0,0)),r.viewRight=a.fromTranslation(a.create(),f.fromValues(-e*t.interpupillaryDistance*.5,0,0)),i.lensCenterLeft=p.fromValues(h,0),i.lensCenterRight=p.fromValues(-h,0),i.hmdWarpParam=t.distortionK,i.chromAbParam=t.chromaAbParameter,i.scaleIn=p.fromValues(1,1/n),i.scale=p.fromValues(1/s,1*n/s)},y=function(){var e=["","#ifdef GL_ES","precision highp float;","#endif","uniform vec2 uScale;","uniform vec2 uScaleIn;","uniform vec2 uLensCenter;","uniform vec4 uHmdWarpParam;","uniform vec4 uChromAbParam;","uniform sampler2D Texture0;","varying vec2 vTexCoord0;","void main(void) {","  vec2 uv = (vTexCoord0 * 2.0) - 1.0;","  vec2 theta = (uv - uLensCenter) * uScaleIn;","  float rSq = theta.x * theta.x + theta.y * theta.y;","  vec2 rvector = theta * (uHmdWarpParam.x + uHmdWarpParam.y * rSq + uHmdWarpParam.z * rSq * rSq + uHmdWarpParam.w * rSq * rSq * rSq);","  vec2 rBlue = rvector * (uChromAbParam.z + uChromAbParam.w * rSq);","  vec2 tcBlue = (uLensCenter + uScale * rBlue);","  tcBlue = (tcBlue + 1.0) * 0.5;","  if (any(bvec2(clamp(tcBlue, vec2(0.0, 0.0), vec2(1.0, 1.0)) - tcBlue))) {","    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","    return;","  }","  vec2 tcGreen = uLensCenter + uScale * rvector;","  tcGreen = (tcGreen + 1.0) * 0.5;","  vec2 rRed = rvector * (uChromAbParam.x + uChromAbParam.y * rSq);","  vec2 tcRed = uLensCenter + uScale * rRed;","  tcRed = (tcRed + 1.0) * 0.5;","  gl_FragColor = vec4(texture2D(Texture0, tcRed).r, texture2D(Texture0, tcGreen).g, texture2D(Texture0, tcBlue).b, 1);","}",""].join("\n");return new s(new u(u.VERTEX_SHADER,v.Filter.defaultVertexShader),new u(u.FRAGMENT_SHADER,e))},C=function(e){var t=new c;return t.setTextureSize(e[0],e[1]),t.setMinFilter("LINEAR"),t.setMagFilter("LINEAR"),t},T=function(e,t,i,n,o,s){var u=new r,l=t[0],c=t[1],p=i[0],f=i[1];!0===n?e?u.setViewport(new m(0,0,p/2,f)):u.setViewport(new m(p/2,0,p/2,f)):e?u.setViewport(new m(.5*p-l,.5*(f-c),l,c)):u.setViewport(new m(.5*p,.5*(f-c),l,c)),a.ortho(u.getProjectionMatrix(),-.5,.5,-.5,.5,-5,5),u.setRenderOrder(r.NESTED_RENDER,0),u.setReferenceFrame(h.ABSOLUTE_RF);var g=u.getOrCreateStateSet();return g.setTextureAttributeAndModes(0,o),g.setAttributeAndModes(y()),g.addUniform(d.createFloat2(s.scale,"uScale")),g.addUniform(d.createFloat2(s.scaleIn,"uScaleIn")),g.addUniform(d.createFloat2(e?s.lensCenterLeft:s.lensCenterRight,"uLensCenter")),g.addUniform(d.createFloat4(s.hmdWarpParam,"uHmdWarpParam")),g.addUniform(d.createFloat4(s.chromAbParam,"uChromAbParam")),u},M=function(e,t){var i=new r;return i.setName("rtt camera"),i.setViewport(new m(0,0,e.getWidth(),e.getHeight())),i.setProjectionMatrix(t),i.setClearColor(g.fromValues(.3,.3,.3,0)),i.setRenderOrder(r.POST_RENDER,0),i.attachTexture(n.COLOR_ATTACHMENT0,e),i.attachRenderBuffer(n.DEPTH_ATTACHMENT,n.DEPTH_COMPONENT16),i.setReferenceFrame(h.ABSOLUTE_RF),i};_.createScene=function(e,t,i,r,n){var a=_.getDefaultConfig(i),s=p.fromValues(.5*a.hResolution,a.vResolution),u=p.fromValues(.5*a.hResolution,a.vResolution),c=e.getCamera().getViewport(),h=p.fromValues(c.width(),c.height()),d=e.getGraphicContext().canvas;a.isCardboard&&(h[0]=d.width,h[1]=d.height);var f=void 0!==n?n:1,g={},m={};S(f,a,g,m);var v=e.getCamera().getViewMatrix(),y=r||new o;y.addUpdateCallback(new b(e,t,i,y,d));var w=C(s),A=M(w,m.projectionLeft),E=T(!0,u,h,a.isCardboard,w,g);A.addUpdateCallback(new x(v,m.viewLeft));var P=C(s),N=M(P,m.projectionRight),F=T(!1,u,h,a.isCardboard,P,g);return N.addUpdateCallback(new x(v,m.viewRight)),A.addChild(t),N.addChild(t),E.addChild(l.createTexturedFullScreenFakeQuadGeometry()),F.addChild(l.createTexturedFullScreenFakeQuadGeometry()),y.addChild(A),y.addChild(N),y.addChild(E),y.addChild(F),y},_.getDefaultConfig=function(e){var t={hResolution:1920,vResolution:1080,hScreenSize:.1296,vScreenSize:.0729,interpupillaryDistance:.064,lensSeparationDistance:.0635,eyeToScreenDistance:.04,distortionK:g.fromValues(1,.22,.13,.02),chromaAbParameter:g.fromValues(.996,-.004,1.014,0),isCardboard:!1};return 2===e||void 0===e?t:1===e?(t.hResolution=1280,t.vResolution=800,t.hScreenSize=.14976,t.vScreenSize=.0936,t.lensSeparationDistance=.064,t.eyeToScreenDistance=.041,t.distortionK=g.fromValues(1,.22,.24,0),t):(void 0!==e.hResolution&&(t.hResolution=e.hResolution),void 0!==e.vResolution&&(t.vResolution=e.vResolution),void 0!==e.hScreenSize&&(t.hScreenSize=e.hScreenSize),void 0!==e.vScreenSize&&(t.vScreenSize=e.vScreenSize),void 0!==e.interpupillaryDistance&&(t.interpupillaryDistance=e.interpupillaryDistance),void 0!==e.lensSeparationDistance&&(t.lensSeparationDistance=e.lensSeparationDistance),void 0!==e.eyeToScreenDistance&&(t.eyeToScreenDistance=e.eyeToScreenDistance),void 0!==e.distortionK&&(t.distortionK=e.distortionK),void 0!==e.chromaAbParameter&&(t.chromaAbParameter=e.chromaAbParameter),void 0!==e.isCardboard&&(t.isCardboard=e.isCardboard),t)},e.exports=_},function(e,t,i){"use strict";var r=i(583),n=i(712),a=i(502),o=i(709),s=i(707),u=i(584),l=i(503),c=i(504),h=i(585),d=i(14),p=i(929),f=i(713),g=i(711),m=i(710),v=i(931),_=i(932),b=i(934),x=i(933),S=i(431),y={};y.Composer=r,d.objectMix(y,n),y.DelayInterpolator=a,y.DisplayNormalVisitor=o,y.DisplayGeometryVisitor=s,y.DisplayGraph=u,y.IntersectionVisitor=l,y.LineSegmentIntersector=c,y.LineSegmentIntersectFunctor=h,y.NodeGizmo=p,y.GizmoGeometry=f,y.WebVRCustom=b,y.PolytopeIntersector=g,y.PolytopeIntersectFunctor=m,y.SphereIntersector=v,y.TangentSpaceGenerator=_,y.WebVR=x,y.NO_LIMIT=S.NO_LIMIT,y.LIMIT_ONE_PER_DRAWABLE=S.LIMIT_ONE_PER_DRAWABLE,y.LIMIT_ONE=S.LIMIT_ONE,y.POINT_PRIMITIVES=S.POINT_PRIMITIVES,y.LINE_PRIMITIVES=S.LINE_PRIMITIVES,y.TRIANGLE_PRIMITIVES=S.TRIANGLE_PRIMITIVES,y.ALL_PRIMITIVES=S.ALL_PRIMITIVES,e.exports=y},function(e,t,i){"use strict";var r=i(8).mat4;"getVRDisplays"in navigator&&("depthNear"in window.VRDisplay.prototype||(window.VRDisplay.prototype.depthNear=.01),"depthFar"in window.VRDisplay.prototype||(window.VRDisplay.prototype.depthFar=1e4),"VRFrameData"in window||(window.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},window.VRDisplay.prototype.getFrameData=function(){function e(e,n,a,o,s){r.perspectiveFromFieldOfView(e,o.fieldOfView,s.depthNear,s.depthFar);var u=a.orientation,l=a.position;u||(u=t),l||(l=i),r.fromRotationTranslation(n,u,l),r.translate(n,n,o.offset),r.invert(n,n)}var t=new Float32Array([0,0,0,1]),i=new Float32Array([0,0,0]);return function(t){var i=this.getPose();return!!i&&(t.pose=i,t.timestamp=i.timestamp,e(t.leftProjectionMatrix,t.leftViewMatrix,i,this.getEyeParameters("left"),this),e(t.rightProjectionMatrix,t.rightViewMatrix,i,this.getEyeParameters("right"),this),!0)}}()))},function(module,exports,__webpack_require__){"use strict";var Notify=__webpack_require__(30),mat4=__webpack_require__(8).mat4,Options=__webpack_require__(567),P=__webpack_require__(10),Timer=__webpack_require__(331),TimerGPU=__webpack_require__(662),UpdateVisitor=__webpack_require__(664),MACROUTILS=__webpack_require__(14),Texture=__webpack_require__(97),OrbitManipulator=__webpack_require__(578),createStats=__webpack_require__(938),EventProxy=__webpack_require__(715),View=__webpack_require__(587),WebGLUtils=__webpack_require__(716),WebGLDebugUtils=__webpack_require__(946),requestFile=__webpack_require__(430),getGLSLOptimizer=function(){var deferOptimizeGLSL=P.defer();window.deferOptimizeGLSL=deferOptimizeGLSL;var mod=["        var Module = {","            preRun: [],","            postRun: [ function () {",'                var func = Module.cwrap( "optimize_glsl", "string", [ "string", "number", "number" ] );',"                window.deferOptimizeGLSL.resolve( func );","            } ],","            print: function ( text ) {","                Notify.debug( text );","            },","            printErr: function ( text ) {","                Notify.debug( text );","            },","            setStatus: function ( text ) {","                Notify.debug( text );","            },","            totalDependencies: 0,","            monitorRunDependencies: function ( left ) {","                this.totalDependencies = Math.max( this.totalDependencies, left );",'                Module.setStatus( left ? "GLSL optimizer preparing... (" + ( this.totalDependencies - left ) + "/" + this.totalDependencies + ")" : "All downloads complete." );',"            },",'            memoryInitializerPrefixURL: "https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/"',"        };"].join("\n");Notify.log("try to load glsl optimizer");var url="https://raw.githubusercontent.com/zz85/glsl-optimizer/gh-pages/glsl-optimizer.js",promise=requestFile(url);return promise.then(function(script){eval(mod+script)}).catch(function(){deferOptimizeGLSL.reject()}),deferOptimizeGLSL.promise},Viewer=function(e,t,i){View.call(this),this._startTick=Timer.instance().tick(),this._stats=void 0,this._done=!1,this._runPromise=P.resolve();var r=this.initOptions(t),n=this.initWebGLContext(e,r,i);if(!n)throw"No WebGL implementation found";MACROUTILS.init(),this.initDeviceEvents(r,e),this.initStats(r,e),this.initRun(r),this._updateVisitor=new UpdateVisitor,this.setUpView(n.canvas,r),this._hmd=null,this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._contextLost=!1};MACROUTILS.createPrototypeObject(Viewer,MACROUTILS.objectInherit(View.prototype,{initDeviceEvents:function(e,t){var i=e.mouseEventNode||t,r=e.EventBackend||{};e.EventBackend||(e.EventBackend=r),r.StandardMouseKeyboard=e.EventBackend.StandardMouseKeyboard||{};var n=r.StandardMouseKeyboard.mouseEventNode||i;r.StandardMouseKeyboard.mouseEventNode=n,r.StandardMouseKeyboard.keyboardEventNode=r.StandardMouseKeyboard.keyboardEventNode||document,"ontouchstart"in window&&(r.Hammer=r.Hammer||{},r.Hammer.eventNode=r.Hammer.eventNode||i),r.GamePad=r.GamePad||{},this._eventProxy=this.initEventProxy(e)},initOptions:function(e){var t=new Options;return e&&t.extend(e),t.extendWithOptionsURL(),!0===t.getBoolean("traceLogCall")&&(Notify.traceLogCall=!0),!0===t.getBoolean("enableFrustumCulling")&&this.getCamera().getRenderer().getCullVisitor().setEnableFrustumCulling(!0),t},initWebGLContext:function(e,t,i){t.get("SimulateWebGLLostContext")&&(e=WebGLDebugUtils.makeLostContextSimulatingCanvas(e),e.loseContextInNCalls(t.get("SimulateWebGLLostContext")));var r=WebGLUtils.setupWebGL(e,t,i);return e.addEventListener("webglcontextlost",function(e){this.contextLost(),e.preventDefault()}.bind(this),!1),e.addEventListener("webglcontextrestored",function(){this.contextRestored()}.bind(this),!1),(Notify.reportWebGLError||t.get("reportWebGLError"))&&(r=WebGLDebugUtils.makeDebugContext(r)),this.initWebGLCaps(r),this.setGraphicContext(r),r},initRun:function(e){if(!0===e.getBoolean("GLSLOptimizer")){var t=__webpack_require__(330);t.enableGLSLOptimizer=!0,this._runPromise=getGLSLOptimizer(),this._runPromise.then(function(e){t.glslOptimizer=e,t.glslOptimizer?Notify.log("uses glsl optimizer, use ?log=info to see shader output"):Notify.error("failed to load glsl optimizer")}).catch(function(e){Notify.error(e)})}},setContextLostCallback:function(e){this._contextLostCallback=e,this._contextLost&&e()},contextLost:function(){Notify.log("webgl context lost"),this._contextLostCallback&&this._contextLostCallback(),this._contextLost=!0,window.cancelAnimationFrame(this._requestID)},contextRestored:function(){Notify.log("webgl context restored, but not supported - reload the page")},init:function(){},getUpdateVisitor:function(){return this._updateVisitor},getState:function(){return this.getCamera().getRenderer().getState()},initStats:function(e){var t=TimerGPU.instance(this.getGraphicContext());if(!e.getBoolean("stats"))return void t.disable();this._stats=createStats(e),t.setCallback(this.callbackTimerGPU.bind(this))},callbackTimerGPU:function(e,t){this._stats&&this._stats.rStats(t).set(e/1e6)},getViewerStats:function(){return this._stats},renderingTraversal:function(){if(this.getState()._frameStamp=this._frameStamp,this.getScene().getSceneData()&&this.getScene().getSceneData().getBound(),this.getCamera()){var e=this._stats,t=TimerGPU.instance(this.getGraphicContext()),i=this.getCamera().getRenderer();if(e&&e.rStats("cull").start(),i.cull(),e&&e.rStats("cull").end(),t.pollQueries(),t.start("glframe"),e&&e.rStats("render").start(),i.draw(),e&&e.rStats("render").end(),t.end("glframe"),e){var r=i.getCullVisitor();e.rStats("cullcamera").set(r._numCamera),e.rStats("cullmatrixtransform").set(r._numMatrixTransform),e.rStats("cullprojection").set(r._numProjection),e.rStats("cullnode").set(r._numNode),e.rStats("cullightsource").set(r._numLightSource),e.rStats("cullgeometry").set(r._numGeometry),e.rStats("pushstateset").set(i.getState()._numPushStateSet),e.rStats("state.apply").set(i.getState()._numApply)}}},updateTraversal:function(){var e=this._stats;e&&e.rStats("update").start(),this._updateVisitor.resetStats(),this.getScene().updateSceneGraph(this._updateVisitor),e&&e.rStats("updatecallback").set(this._updateVisitor._numUpdateCallback),this.getDatabasePager().releaseGLExpiredSubgraphs(.005),this.flushDeletedGLObjects(.005),e&&e.rStats("update").end()},advance:function(e){var t=e;void 0===t&&(t=Number.MAX_VALUE);var i=this._frameStamp,r=i.getFrameNumber();i.setFrameNumber(r+1);var n=Timer.instance().deltaS(this._startTick,Timer.instance().tick());i.setReferenceTime(n);var a=i.getSimulationTime();i.setSimulationTime(t===Number.MAX_VALUE?n:t),i.setDeltaTime(i.getSimulationTime()-a)},beginFrame:function(){var e=this._stats;e&&(e.rStats("frame").start(),e.glS.start(),e.rStats("rAF").tick(),e.rStats("FPS").frame())},endFrame:function(){var e=this.getFrameStamp().getFrameNumber(),t=this._stats,i=t?t.rStats:void 0;i&&(Texture.getTextureManager(this.getGraphicContext()).updateStats(e,i),i("frame").end(),i("rStats").start(),i().update(),i("rStats").end())},checkNeedToDoFrame:function(){return this._requestContinousUpdate||this._requestRedraw},frame:function(){if(!this._contextLost){this.beginFrame(),this.advance();var e=this.updateViewport();this.updateEventProxy(this._eventProxy,this.getFrameStamp()),this._updateVisitor.setFrameStamp(this.getFrameStamp()),this.getManipulator()&&(this.getManipulator().update(this._updateVisitor),mat4.copy(this.getCamera().getViewMatrix(),this.getManipulator().getInverseMatrix())),(this.checkNeedToDoFrame()||e)&&(this._requestRedraw=!1,this.updateTraversal(),this.renderingTraversal()),this.endFrame(),this._hmd&&this._hmd.isPresenting&&this._hmd.submitFrame()}},setDone:function(e){this._done=e},done:function(){return this._done},_runImplementation:function(){var e=this,t=function(){e.done()||(e._requestID=e._requestAnimationFrame(t,e.getGraphicContext().canvas),e.frame())};t()},run:function(){var e=this;this._runPromise.then(function(){e._runImplementation()}).catch(function(){e._runImplementation()})},setVRDisplay:function(e){this._hmd=e},getVRDisplay:function(){return this._hmd},setPresentVR:function(e){if(!this._hmd)return Notify.warn("no hmd device provided to the viewer!"),P.reject();if(!this._hmd.capabilities.canPresent)return P.reject();if(e){this._requestAnimationFrame=this._hmd.requestAnimationFrame.bind(this._hmd);var t=[{source:this.getGraphicContext().canvas}];return this._hmd.requestPresent(t)}return this._requestAnimationFrame=window.requestAnimationFrame.bind(window),this._hmd.exitPresent()},setupManipulator:function(e){void 0===e&&(e=new OrbitManipulator),void 0!==e.setNode?e.setNode(this.getSceneData()):e.view=this,e.setCamera(this.getCamera()),this.setManipulator(e)},updateViewport:function(){var e=this.getGraphicContext(),t=e.canvas;if(!this.computeCanvasSize(t))return!1;var i=this.getCamera(),r=i.getViewport(),n=r.width(),a=r.height(),o=t.width/n,s=t.height/a,u=o/s;return r.setViewport(Math.round(r.x()*o),Math.round(r.y()*s),Math.round(r.width()*o),Math.round(r.height()*s)),1!==u&&mat4.mul(i.getProjectionMatrix(),i.getProjectionMatrix(),mat4.fromScaling(mat4.create(),[1/u,1,1])),!0},initEventProxy:function(e){var t=e||{},i={},r=EventProxy,n=t.EventBackend;for(var a in r){var o=!0,s={};if(n&&void 0!==n[a]){var u=n[a].enable;o=void 0===u||u,s=n[a]}var l=new Options;if(l.extend(s).extend(e),delete l.EventBackend,o){var c=new r[a](this);c.init(l),i[a]=c}}return i},updateEventProxy:function(e,t){for(var i in e){var r=e[i];r.update&&r.update(t)}},setManipulator:function(e){this._manipulator&&this.removeEventProxy(),e.getCamera()||e.setCamera(this.getCamera()),View.prototype.setManipulator.call(this,e)},removeEventProxy:function(){var e=this._eventProxy;for(var t in e){var i=e[t];i.remove&&i.remove()}},getEventProxy:function(){return this._eventProxy}}),"osgViewer","Viewer"),module.exports=Viewer},function(e,t,i){"use strict";var r=i(14),n=window.BrowserStats,a=window.glStats,o=window.rStats,s=function(e){this.bS=new n,this.glS=new a;var t={frame:{caption:"Total frame time (ms)",over:16,average:!0},fps:{caption:"Framerate (FPS)",below:30},calls:{caption:"Calls (three.js)",over:3e3},raf:{caption:"Time since last rAF (ms)",average:!0,avgMs:500},rstats:{caption:"rStats update (ms)",average:!0,avgMs:100},update:{caption:"update",average:!0},cull:{caption:"cull",average:!0},render:{caption:"render",average:!0},glframe:{caption:"glframe",average:!0},textureused:{caption:"texture used"},texturereserved:{caption:"texture reserved"},texturetotal:{caption:"texture total"},pushstateset:{caption:"num pushStateSet"},updatecallback:{caption:"num updateCallback"},cullcamera:{caption:"camera"},cullmatrixtransform:{caption:"matrixTransform"},cullprojection:{caption:"projection"},cullnode:{caption:"node"},culllightsource:{caption:"lightSource"},cullgeometry:{caption:"geometry"}},i=[{base:"frame",steps:["update","cull","render"]}],s=[{caption:"Framerate",values:["fps","raf"]},{caption:"Frame Budget",values:["frame","update","cull","render","glframe"]},{caption:"Scene Graph",values:["pushstateset","updatecallback","state.apply"]},{caption:"Cull",values:["cullnode","cullmatrixtransform","cullgeometry","cullcamera","culllighsource","cullprojection"]},{caption:"Texture Memory",values:["texturereserved","textureused","texturetotal"]}],u=[this.bS,this.glS];e&&(e.values&&r.objectMix(t,e.values),e.groups&&Array.prototype.unshift.apply(s,e.groups),e.fractions&&Array.prototype.push.apply(i,e.fractions),e.plugins&&Array.prototype.push.apply(u,e.plugins)),this.rStats=new o({values:t,groups:s,fractions:i,plugins:u,colours:["#cc9933","#f20041","#69818c","#d90074","#b6f2ee","#660044","#50664d","#330022","#f2eeb6","#ee00ff","#806460","#1600a6","#994d57","#00004d","#f279da","#002933","#395073","#00eeff","#79baf2","#008066","#79f2aa","#00ff66","#1a331d","#004d14","#8c6c46","#388c00","#602080","#ff8800","#6d3df2","#995200","#0d1233","#402200","#3d6df2","#330e00","#e6f23d","#730000"]})},u=function(e){if(o){var t=".rs-base{ position: absolute; z-index: 10000; padding: 10px; background-color: #222; font-size: 12px; line-height: 1.2em; width: 350px; font-family: 'Roboto Condensed', tahoma, sans-serif; left: 0; top: 0; overflow: hidden; } .rs-base h1{ margin: 0; padding: 0; font-size: 1.4em; color: #fff; margin-bottom: 5px; cursor: pointer; } .rs-base div.rs-group{ margin-bottom: 10px; } .rs-base div.rs-group.hidden{ display: none; } .rs-base div.rs-fraction{ position: relative; margin-bottom: 5px; } .rs-base div.rs-fraction p{ width: 145px; text-align: right; margin: 0; padding: 0; } .rs-base div.rs-legend{ position: absolute; line-height: 1em; } .rs-base div.rs-counter-base{ position: relative; margin: 2px 0; height: 1em; } .rs-base span.rs-counter-id{ position: absolute; left: 0; top: 0; } .rs-base div.rs-counter-value{ position: absolute; left: 115px; width: 30px; height: 1em; top: 0; text-align: right; } .rs-base canvas.rs-canvas{ position: absolute; right: 0; } ",i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");return r.type="text/css",r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t)),i.appendChild(r),new s(e.rstats)}};e.exports=u},function(e,t,i){"use strict";var r=function(e){this._viewer=e,this._type="DeviceOrientation",this._enable=!1,this._deviceOrientation=void 0,this._screenOrientation=window.orientation||90};r.prototype={setEnable:function(e){this._enable=e},getEnable:function(){return this._enable},init:function(){var e=this;window.addEventListener("deviceorientation",function(t){null!==t.alpha&&void 0!==t.alpha&&(e._deviceOrientation=t)},!1),window.addEventListener("orientationchange",function(){null!==window.orientation&&void 0!==window.orientation&&(e._screenOrientation=window.orientation)},!1)},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},isValid:function(){if(!this._enable)return!1;if(!this._deviceOrientation)return!1;var e=this._viewer.getManipulator();return!!e&&!!e.getControllerList()[this._type]},update:function(){if(this.isValid()){var e=this.getManipulatorController();e.update&&e.update(this._deviceOrientation,this._screenOrientation)}}},e.exports=r},function(e,t,i){"use strict";var r=i(30),n=function(e){this._viewer=e,this._type="GamePad",this._enable=!0,this._gamepadIndex=-1};n.prototype={setEnable:function(e){this._enable=e},getEnable:function(){return this._enable},init:function(){},isValid:function(){if(!this._enable)return!1;var e=this._viewer.getManipulator();return!!e&&!!e.getControllerList()[this._type]},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},gamepadPoll:function(){if(!navigator.getGamepads)return null;var e=navigator.getGamepads(),t=e[this._gamepadIndex];if(t)return t;for(var i=0,r=e.length;i<r;++i){var n=e[i];if(n&&n.id&&-1===n.id.indexOf("Unknown Gamepad"))return this._gamepadIndex=i,this.onGamepadConnect(n),n}return this._gamepadIndex>=0&&(this._gamepadIndex=-1,this.onGamepadConnect()),null},onGamepadConnect:function(e){r.log("Detected new gamepad!",e)},onGamepadDisconnect:function(){r.log("Gamepad disconnected")},update:function(){if(this.isValid()){var e=this.gamepadPoll();if(e){var t=this.getManipulatorController();t.update&&t.update(e)}}}},e.exports=n},function(e,t,i){"use strict";var r=i(338),n=function(e){this._enable=!0,this._viewer=e,this._type="Hammer",this._eventNode=void 0};n.prototype={setEnable:function(e){this._enable=e},getEnable:function(){return this._enable},init:function(e){var t={prevent_default:!0,drag_max_touches:2,transform_min_scale:.08,transform_min_rotation:180,transform_always_block:!0,hold:!1,release:!1,swipe:!1,tap:!1};this._eventNode=e.eventNode,this._eventNode&&(this._hammer=new r(this._eventNode,t),!1===e.getBoolean("scrollwheel")?this._hammer.get("pinch").set({enable:!1}):this._hammer.get("pinch").set({enable:!0}))},isValid:function(){return!!(this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type])},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this._hammer)},remove:function(){this.isValid()&&this.getManipulatorController().removeEventProxy(this._hammer)}},e.exports=n},function(e,t,i){"use strict";var r=i(1140),n=i(30),a=function(e){this._viewer=e,this._type="LeapMotion",this._enable=!0};a.prototype={setEnable:function(e){this._enable=e},getEnable:function(){return this._enable},init:function(e){if(void 0!==r&&r.Controller){var t=this;this._controller=new r.Controller({enableGestures:e.gestures||!0,tryReconnectOnDisconnect:!0,connectAttempts:3}),this._controller.on("ready",function(){e.readyCallback&&e.readyCallback(t._controller),t._leapMotionReady=!0,n.info("leapmotion ready")}),this._controller.loop(this._update.bind(this))}},isValid:function(){if(!this._enable)return!1;var e=this._viewer.getManipulator();return!!e&&!!e.getControllerList()[this._type]},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},_update:function(e){if(e.valid&&this.isValid()){var t=this.getManipulatorController();t.update&&t.update(e)}}},e.exports=a},function(e,t,i){"use strict";var r=i(8).vec2,n=function(e){this._enable=!0,this._viewer=e,this._type="StandardMouseKeyboard",this._mouseEventNode=void 0,this._wheelEventNode=void 0,this._keyboardEventNode=void 0,this._eventList=["mousedown","mouseup","mouseout","mousemove","dblclick"],this._mousePosition=r.create()};n.prototype={setEnable:function(e){this._enable=e},getEnable:function(){return this._enable},init:function(e){var t=e.mouseEventNode,i=e.wheelEventNode||t,r=e.keyboardEventNode||t;!1===e.getBoolean("scrollwheel")&&(i=null),this._mouseEventNode=t,this._wheelEventNode=i,this._keyboardEventNode=r,this._callbacks={mousedown:this.mousedown.bind(this),mouseup:this.mouseup.bind(this),mouseout:this.mouseout.bind(this),mousemove:this.mousemove.bind(this),dblclick:this.dblclick.bind(this),mousewheel:this.mousewheel.bind(this),preventDefault:this.preventDefault.bind(this),keydown:this.keydown.bind(this),keyup:this.keyup.bind(this)},this.addEventListeners()},_addOrRemoveEventListeners:function(e){var t=this._callbacks,i=e?"removeEventListener":"addEventListener",r=this._mouseEventNode&&this._mouseEventNode[i].bind(this._mouseEventNode),n=this._wheelEventNode&&this._wheelEventNode[i].bind(this._wheelEventNode),a=this._keyboardEventNode&&this._keyboardEventNode[i].bind(this._keyboardEventNode);if(r)for(var o=0,s=this._eventList.length;o<s;o++){var u=this._eventList[o];r(u,t[u],!1)}n&&(n("DOMMouseScroll",t.mousewheel,!1),n("mousewheel",t.mousewheel,!1),n("MozMousePixelScroll",t.preventDefault,!1)),a&&(a("keydown",t.keydown,!1),a("keyup",t.keyup,!1))},addEventListeners:function(){return this._addOrRemoveEventListeners(!1)},removeEventListeners:function(){return this._addOrRemoveEventListeners(!0)},isValid:function(){return!!(this._enable&&this._viewer.getManipulator()&&this._viewer.getManipulator().getControllerList()[this._type])},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},keyup:function(e){if(this.isValid()&&this.getManipulatorController().keyup)return this.getManipulatorController().keyup(e)},keydown:function(e){if(this.isValid()&&this.getManipulatorController().keydown)return this.getManipulatorController().keydown(e)},mousedown:function(e){if(this.isValid()&&this.getManipulatorController().mousedown)return 1===e.button&&e.preventDefault(),this.getManipulatorController().mousedown(e)},mouseup:function(e){if(this.isValid()&&this.getManipulatorController().mouseup)return this.getManipulatorController().mouseup(e)},mouseout:function(e){if(this.isValid()&&this.getManipulatorController().mouseout)return this.getManipulatorController().mouseout(e)},mousemove:function(e){if(this.isValid()&&this.getManipulatorController().mousemove)return this.getManipulatorController().mousemove(e)},dblclick:function(e){if(this.isValid()&&this.getManipulatorController().dblclick)return this.getManipulatorController().dblclick(e)},mousewheel:function(e){if(this.isValid()){var t=this.getManipulatorController();if(t.mousewheel){e.preventDefault();var i=e||window.event,r=[].slice.call(arguments,1),n=0,a=0,o=0;return e.wheelDelta&&(n=e.wheelDelta/120),e.detail&&(n=-e.detail/3),o=n,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(o=0,a=-1*n),void 0!==i.wheelDeltaY&&(o=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(a=-1*i.wheelDeltaX/120),r.unshift(e,n,a,o),this.getManipulatorController().mousewheel.apply(t,r)}}},preventDefault:function(e){e.preventDefault()},divGlobalOffset:function(e){var t=0,i=0;t=e.offsetLeft,i=e.offsetTop;for(var r=document.getElementsByTagName("body")[0];e.offsetParent&&e!==r;)t+=e.offsetParent.offsetLeft,i+=e.offsetParent.offsetTop,e=e.offsetParent;return this._mousePosition[0]=t,this._mousePosition[1]=i,this._mousePosition},getPositionRelativeToCanvas:function(e,t){var i,r,n=e.target;e.pageX||e.pageY?(i=e.pageX,r=e.pageY):(e.clientX||e.clientY)&&(i=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,r=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);var a=this.divGlobalOffset(n);return i-=a[0],r=n.height-(r-a[1]),void 0===t&&(t=this._mousePosition),t[0]=i,t[1]=r,t},update:function(){this.isValid()&&this.getManipulatorController().setEventProxy(this)}},e.exports=n},function(e,t,i){"use strict";var r=i(30),n=i(8).quat,a=i(8).vec3,o=i(8).mat4;i(936);var s=function(e){this._viewer=e,this._type="WebVR",this._enable=!1,this._hmd=void 0,this._sensor=void 0,this._frameData=void 0,this._quat=n.create(),this._pos=a.create(),this._worldScale=1};s.prototype={setWorldScale:function(e){this._worldScale=e},setEnable:function(e){this._enable=e},getEnable:function(){return this._enable},init:function(){if(navigator.getVRDisplays){var e=this;navigator.getVRDisplays().then(function(t){t.length>0&&(e._hmd=t[0],e._frameData=new window.VRFrameData,r.log("Found a VR display"),e._viewer.setVRDisplay(e._hmd))})}},getManipulatorController:function(){return this._viewer.getManipulator().getControllerList()[this._type]},isValid:function(){if(!this._enable)return!1;var e=this._viewer.getManipulator();return!!e&&(!!e.getControllerList()[this._type]&&!!this._hmd)},update:function(){var e=n.create(),t=a.create();return function(){if(this.isValid()){var i=this.getManipulatorController();if(i.update){this._hmd.getFrameData(this._frameData);var r=this._frameData.pose;if(r){var s=this._hmd.stageParameters&&this._hmd.stageParameters.sittingToStandingTransform,u=r.orientation;u&&(s&&(u=o.getRotation(e,s),n.mul(u,u,r.orientation)),this._quat[0]=u[0],this._quat[1]=-u[2],this._quat[2]=u[1],this._quat[3]=u[3]);var l=r.position;l&&(s&&(l=a.transformMat4(t,l,s)),this._pos[0]=l[0]*this._worldScale,this._pos[1]=-l[2]*this._worldScale,this._pos[2]=l[1]*this._worldScale),i.update(this._quat,this._pos)}}}}}(),getHmd:function(){return this._hmd}},e.exports=s},function(e,t,i){"use strict";var r=i(586),n=i(587),a=i(937),o=i(715),s=i(714),u={};u.Renderer=r,u.View=n,u.Viewer=a,u.EventProxy=o,u.Scene=s,e.exports=u},function(e,t,i){"use strict";var r=(i(30),function(){function e(e){if(null==p){p={},f={};for(var t in e)"number"==typeof e[t]&&(p[e[t]]=t,f[t]=e[t])}}function t(){if(null==p)throw"WebGLDebugUtils.init(ctx) not called"}function i(e){return t(),void 0!==p[e]}function r(e){t();var i=p[e];return void 0!==i?"gl."+i:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function n(e,t,i,n){var a=d[e];if(void 0!==a){var a=a[t];if(void 0!==a&&a[i]){if("object"==typeof a[i]&&void 0!==a[i].enumBitwiseOr){for(var o=a[i].enumBitwiseOr,s=0,u=[],l=0;l<o.length;++l){var c=f[o[l]];0!=(n&c)&&(s|=c,u.push(r(c)))}return s===n?u.join(" | "):r(n)}return r(n)}}return null===n?"null":void 0===n?"undefined":n.toString()}function a(e,t){for(var i="",r=t.length,a=0;a<r;++a)i+=(0==a?"":", ")+n(e,r,a,t[a]);return i}function o(e,t,i){e.__defineGetter__(i,function(){return t[i]}),e.__defineSetter__(i,function(e){t[i]=e})}function s(t,i,a,u){function l(e,t){return function(){a&&a(t,arguments);var r=e[t].apply(e,arguments),n=u.getError();return 0!=n&&(c[n]=!0,i(n,t,arguments)),r}}u=u||t,e(t),i=i||function(e,t,i){for(var a="",o=i.length,s=0;s<o;++s)a+=(0==s?"":", ")+n(t,o,s,i[s]);h("WebGL error "+r(e)+" in "+t+"("+a+")")};var c={},d={};for(var p in t)if("function"==typeof t[p])if("getExtension"!=p)d[p]=l(t,p);else{var f=l(t,p);d[p]=function(){var e=f.apply(t,arguments);return e?s(e,i,a,u):null}}else o(d,t,p);return d.getError=function(){for(var e in c)if(c.hasOwnProperty(e)&&c[e])return c[e]=!1,e;return t.NO_ERROR},d}function u(e){var t=!!e.createTransformFeedback;t&&e.bindVertexArray(null);var i=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r);for(var n=0;n<i;++n)e.disableVertexAttribArray(n),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(n,0),t&&e.vertexAttribDivisor(n,0);e.deleteBuffer(r);for(var a=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),n=0;n<a;++n)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null),t&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(n,null));if(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),t){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);for(var o=e.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS),n=0;n<o;++n)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,n,null);for(var s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),n=0;n<s;++n)e.bindBufferBase(e.UNIFORM_BUFFER,n,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}for(;e.getError(););}function l(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function i(){for(var e=Object.keys(y),t=0;t<e.length;++t)delete y[e[t]]}function r(){++b,m||_==b&&e.loseContext()}function n(e,t){var i=e[t];return function(){if(r(),!m){return i.apply(e,arguments)}}}function a(){for(var e=0;e<v.length;++e){var t=v[e];t instanceof WebGLBuffer?c.deleteBuffer(t):t instanceof WebGLFramebuffer?c.deleteFramebuffer(t):t instanceof WebGLProgram?c.deleteProgram(t):t instanceof WebGLRenderbuffer?c.deleteRenderbuffer(t):t instanceof WebGLShader?c.deleteShader(t):t instanceof WebGLTexture?c.deleteTexture(t):d&&(t instanceof WebGLQuery?c.deleteQuery(t):t instanceof WebGLSampler?c.deleteSampler(t):t instanceof WebGLSync?c.deleteSync(t):t instanceof WebGLTransformFeedback?c.deleteTransformFeedback(t):t instanceof WebGLVertexArrayObject&&c.deleteVertexArray(t))}}function s(e){return{statusMessage:e,preventDefault:function(){x=!0}}}function l(e){for(var t in e)"function"==typeof e[t]?h[t]=n(e,t):o(h,e,t);h.getError=function(){if(r(),!m)for(var e;e=c.getError();)y[e]=!0;for(var e in y)if(y[e])return delete y[e],e;return h.NO_ERROR};var i=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];d&&i.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var a=0;a<i.length;++a){var s=i[a];h[s]=function(t){return function(){if(r(),m)return null;var i=t.apply(e,arguments);return i.__webglDebugContextLostId__=g,v.push(i),i}}(e[s])}var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];d&&u.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(var a=0;a<u.length;++a){var s=u[a];h[s]=function(t){return function(){return r(),m?null:t.apply(e,arguments)}}(h[s])}var l=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];d&&l.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(var a=0;a<l.length;++a){var s=l[a];h[s]=function(t){return function(){return r(),!m&&t.apply(e,arguments)}}(h[s])}return h.checkFramebufferStatus=function(t){return function(){return r(),m?h.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(h.checkFramebufferStatus),h.getAttribLocation=function(t){return function(){return r(),m?-1:t.apply(e,arguments)}}(h.getAttribLocation),h.getVertexAttribOffset=function(t){return function(){return r(),m?0:t.apply(e,arguments)}}(h.getVertexAttribOffset),h.isContextLost=function(){return m},d&&(h.getFragDataLocation=function(t){return function(){return r(),m?-1:t.apply(e,arguments)}}(h.getFragDataLocation),h.clientWaitSync=function(t){return function(){return r(),m?h.WAIT_FAILED:t.apply(e,arguments)}}(h.clientWaitSync),h.getUniformBlockIndex=function(t){return function(){return r(),m?h.INVALID_INDEX:t.apply(e,arguments)}}(h.getUniformBlockIndex)),h}var c,h,d,p=[],f=[],h={},g=1,m=!1,v=[],_=0,b=0,x=!1,S=0,y={};e.getContext=function(t){return function(){var i=t.apply(e,arguments);if(i instanceof WebGLRenderingContext||window.WebGL2RenderingContext&&i instanceof WebGL2RenderingContext){if(i!=c){if(c)throw"got different context";d=window.WebGL2RenderingContext&&i instanceof WebGL2RenderingContext,c=i,h=l(c)}return h}return i}}(e.getContext);var C=function(e){p.push(t(e))},T=function(e){f.push(t(e))};return function(e){var t=e.addEventListener;e.addEventListener=function(i,r,n){switch(i){case"webglcontextlost":C(r);break;case"webglcontextrestored":T(r);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!m){for(m=!0,_=0,++g;c.getError(););i(),y[c.CONTEXT_LOST_WEBGL]=!0;var t=s("context lost"),r=p.slice();setTimeout(function(){for(var i=0;i<r.length;++i)r[i](t);S>=0&&setTimeout(function(){e.restoreContext()},S)},0)}},e.restoreContext=function(){m&&f.length&&setTimeout(function(){if(!x)throw"can not restore. webglcontestlost listener did not call event.preventDefault";a(),u(c),m=!1,b=0,x=!1;for(var e=f.slice(),t=s("context restored"),i=0;i<e.length;++i)e[i](t)},0)},e.loseContextInNCalls=function(e){if(m)throw"You can not ask a lost contet to be lost";_=b+e},e.getNumCalls=function(){return b},e.setRestoreTimeout=function(e){S=e},e}var c=function(e){window.console&&window.console.log&&window.console.log(e)},h=function(e){window.console&&window.console.error?window.console.error(e):c(e)},d={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},p=null,f=null;return{init:e,mightBeEnum:i,glEnumToString:r,glFunctionArgToString:n,glFunctionArgsToString:a,makeDebugContext:s,makeLostContextSimulatingCanvas:l,resetToInitialState:u}}());e.exports=r},function(e,t,i){"use strict";var r=i(506),n=i(717),a=i(718),o={};o.osg=r,o.osgAnimation=n,o.osgText=a,e.exports=o},,,,,,,,,,,function(e,t,i){"use strict";var r=i(965),n=i(44),a=i(21);t.a=n.a.extend({comparator:"order",model:r.a,_trashbin:[],url:function(){return"/i/models/"+this.options.filters.get("modelUID")+"/animations"+a.a.craft("?",{})}})},function(e,t,i){"use strict";var r=i(763),n=i(44),a=i(21);t.a=n.a.extend({model:r.a,url:function(){return(this.options.filters.get("userUID")?"/i/users/"+this.options.filters.get("userUID")+"/backgrounds":"/i/backgrounds")+a.a.craft("?",{offset:this.options.offset})}})},function(e,t,i){"use strict";var r=i(764),n=i(44);t.a=n.a.extend({model:r.a,url:function(){return void 0===this.options.filters?"/i/environments":"/i/users/"+this.options.filters.get("userUID")+"/environments"}})},function(e,t,i){"use strict";var r=i(44),n=i(967);t.a=r.a.extend({model:n.a,parse:function(e){return e.results.images},url:function(){return"/i/models/"+this.options.uid+"/fallback"}})},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(765)),a=i(44),o=i(21),s=i(720);t.a=a.a.extend(i.i(r.extend)({model:n.a,url:function(){var e=this.options.filters.get("userUID");return(e?"/i/users/"+e+"/matcaps":"/i/matcaps")+o.a.craft("?",{offset:this.options.offset})}},s.a))},function(e,t,i){"use strict";var r=i(592),n=i(44);t.a=n.a.extend({comparator:"order",model:r.a,url:function(){return"/i/models/"+this.options.modelUID+"/sounds"},triggerEditTrack:function(e){this.trigger("editTrack",e)},triggerDeleteTrack:function(e){this.trigger("removeTrack",e)},triggerDuplicateTrack:function(e){this.trigger("duplicateTrack",e)},triggerSelectTrack:function(e){this.trigger("select",e)}})},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(537)),a=i(44),o=i(21),s=i(767),u=i(720);t.a=a.a.extend(i.i(r.extend)({model:n.a,url:function(){return(this.options.filters.get("modelUID")?"/i/models/"+this.options.filters.get("modelUID")+"/textures":"/i/textures")+o.a.craft("?",{offset:this.options.offset})},comparator:function(e,t){return e.get("value")?i.i(s.a)(e.get("name"),t.get("name")):-1},isValid:function(){this.each(function(e){e.isValid()})},getImageFromURL:function(e){var t=e.split("/").pop();return this.find(function(e){var i=!1;return e.get("images").forEach(function(e){i||-1!==e.url.indexOf(t)&&(i=!0)}),i})}},u.a))},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(2),o=i.n(a),s=i(15);t.a=s.a.extend({defaults:{name:"",uid:"",duration:0,isLoop:!1,isEnabled:!0},url:function(){return"/i/animations/"+this.get("uid")},save:function(){var e=new FormData;e.append("name",this.get("name")),e.append("isLoop",this.get("isLoop")),e.append("isEnabled",this.get("isEnabled"));var t=o.a.ajax({type:"PATCH",url:this.url(),data:e,cache:!1,contentType:!1,processData:!1});return n.a.resolve(t)}})},,function(e,t,i){"use strict";var r=i(15);t.a=r.a.extend({})},,function(e,t,i){"use strict";var r=i(15);t.a=r.a.extend({})},function(e,t,i){"use strict";var r=i(15);t.a=r.a.extend({})},function(e,t,i){"use strict";var r=i(15);t.a=r.a.extend({})},function(e,t,i){"use strict";var r=i(15);t.a=r.a.extend({})},function(e,t,i){"use strict";var r=i(15);t.a=r.a.extend({})},,,,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=i(338),o=i.n(a),s=i(90),u=i(596),l=i(46),c=i(513),h=i(92),d=i(724),p=i(1003),f=i(69),g=i(86),m=i(31),v=i(729),_=i(299),b=i(725),x=i(601),S=i(163),y=i(139),C=i(476),T=i(465),M=n.a.osg,w=n.a.osgUtil,A=function(e,t){this._viewerWebGL=e,this._viewerOSGJS=e.getViewerOSGJS(),this._urlOptions=e.options,this._features=e.getFeatures(),this._context=t,this._canvas=e.getCanvas(),this._nodeGizmo=null,this._mouseKeyboard=this._viewerOSGJS.getEventProxy().StandardMouseKeyboard;var i=this.onPointerUp.bind(this);window.addEventListener("touchend",i,!0),window.addEventListener("touchcancel",i,!0),window.addEventListener("mouseup",i,!0),window.addEventListener("mouseout",i,!0),l.a.getHasAnimation().then(function(e){e&&(this._hasAnimation=e)}.bind(this))},E=function(){M.NodeVisitor.call(this),this.setNodeMaskOverride(-1)};E.prototype=M.objectInherit(M.NodeVisitor.prototype,{apply:function(e){e.setShape&&e.setShape(null),this.traverse(e)}}),A.prototype={getFeatures:function(){return this._features},getCanvas:function(){return this._canvas},getViewerWebGL:function(){return this._viewerWebGL},getViewerOSGJS:function(){return this._viewerOSGJS},getResourceManager:function(){return this._resourceManager||h.default.instance},onPointerUp:function(){this._mouseKeyboard.setEnable(!0)},focusOnTargetAndEye:function(){var e=M.vec3.create();return function(t,i,r,n){var a=this._features.camera;if(a){var o=this._viewerOSGJS.getManipulator();if(!r||r<0)return void o.setTargetAndEye(t,i);var s=a.getModel();t||(t=o.getTarget(e)),i||(i=o.getEyePosition(e)),s.setTargetAndEye(t,i,n),s.set("animationDuration",r)}}}(),focusOnHomePosition:function(e){var t=this._features,i=t.camera;if(i&&i.getModel()){var r=i.getManipulator().getCurrentManipulator(),n=r.getHomeBound(),a=n.center(),o=r.getEyePosition(M.vec3.create());M.vec3.sub(o,a,o),M.vec3.normalize(o,o),M.vec3.scale(o,o,r.getHomeDistance(n)),M.vec3.sub(o,a,o),this.focusOnTargetAndEye(a,o,e)}},focusOnSavedCamera:function(e){var t=this._context.getModel().get("options"),r=i.i(m.a)(),n=this._viewerOSGJS.getManipulator(),a=r.cameraTarget||t.camera.target,o=r.cameraEye||t.camera.position,s=o&&null!==o[0];return s?s&&!this._features.camera.getModel().validateEyeTarget(o,a)?n.computeHomePosition():void this.focusOnTargetAndEye(a,o,e):n.computeHomePosition()},updateFocusOnAutoHit:function(){if(!this._autoHit.get("focus"))return!0;var e=i.i(T.a)(this._autoHit,this._features.hotspot.getNode()),t=this._features.camera.getManipulator().getCurrentManipulator(),r=t.getEyePosition(M.vec3.create()),n=t.getTarget(M.vec3.create()),a=M.vec3.create(),o=M.vec3.create();return 1===i.i(m.a)().cameraFollowBones?(M.vec3.sub(o,e,n),M.vec3.add(a,r,o),M.vec3.copy(o,e)):(M.vec3.sub(a,e,r),M.vec3.normalize(a,a),M.vec3.scale(a,a,M.vec3.dist(r,n)),M.vec3.sub(a,e,a),M.vec3.copy(o,e)),M.vec3.lerp(o,n,o,.25),M.vec3.lerp(a,r,a,.25),this.focusOnTargetAndEye(o,a,0),!0},setInitialAnimation:function(){if(this._features.camera){var e=i.i(m.a)().camera;if(void 0!==e&&!1===e)return void l.a.resolveFirstCameraAnimation();var t=M.vec3.create(),r=M.vec3.create(),n=this._viewerOSGJS.getManipulator();n.getEyePosition(r),n.getTarget(t);var a=[t[0]-r[0],t[1]-r[1],0],o=a[0]>a[1]?0:1,s=0===o?1:0,u=M.vec3.create();u[s]=1;var c=a[o]<0?-1:1;u[2]=.2*c;var h=1.5*n.getNode().getMinimumBound().radius();M.vec3.scale(u,u,10*h*c);var d=M.vec3.add(M.vec3.create(),r,u);n.setEyePosition(d),this.focusOnTargetAndEye(t,r,2.5);var p=this._features.autospin;if(p){var f=p.getModel();f.set("speed",-f.get("speed")*c)}}},linkAutospinWithEvents:function(){var e=this._features,t=e.autospin,i=e.camera,r=i?i.getModel():void 0,n=t.getModel(),a=0,o=function(){clearTimeout(a),n.set("paused",!0)},s=function(){!0==(void 0===r||r.get("indexManipulator")===u.a.ORBIT)&&(a=setTimeout(function(){n.set("paused",!1)},12500))},l=this._canvas;if(l.addEventListener("mousedown",o),l.addEventListener("touchstart",o),l.addEventListener("dragstart",o),l.addEventListener("mouseup",s),l.addEventListener("mouseout",s),l.addEventListener("touchend",s),l.addEventListener("touchcancel",s),l.addEventListener("touchleave",s),l.addEventListener("dragend",s),i){var c=function(){clearTimeout(a),n.set("paused",r.get("indexManipulator")!==u.a.ORBIT)};r.bind("change:indexManipulator",c),c()}},linkSelectMaterialUI:function(e){var t=this._features,i=t.materialUI,r=t.outline;if(i){var n=function(e){M.NodeVisitor.call(this),this._stateSet=e,this._pushIfGeo=!1,this._paths=[]};M.createPrototypeObject(n,M.objectInherit(M.NodeVisitor.prototype,{apply:function(e){var t=e.getStateSet(),i=this._pushIfGeo;t&&void 0!==t._materialID&&(this._pushIfGeo=t===this._stateSet),e instanceof M.Geometry&&this._pushIfGeo&&this._paths.push(this.nodePath.slice(0)),this.traverse(e),this._pushIfGeo=i}}));var a=function(t){var i=new n(t);e.accept(i);var a=i._paths;if(0===a.length)return void M.error("Cound not find nodes attached to the stateset.");for(var o=e.getParents()[0].getWorldMatrices()[0],s=M.vec3.create(),u=M.vec3.create(),l=0,c=a.length;l<c;++l){var h=a[l],d=h[h.length-1].getMinimumBound().center();M.vec3.transformMat4(u,d,M.computeLocalToWorld(h)),M.vec3.transformMat4(u,u,o),M.vec3.add(s,u,s)}if(M.vec3.scale(s,s,1/c),this.focusOnTargetAndEye(s,void 0,2),r){var p=r.getNode();p.setScene(a),p.showOutline()}}.bind(this);i.getModel().bind("displayOutline",a)}},initEventsOnClick:function(){var e=new o.a.Manager(this.getCanvas());e.add(new o.a.Tap({event:"doubletap",pointers:1,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),e.add(new o.a.Tap({event:"doubletap2fingers",pointers:2,taps:2,time:250,interval:450,threshold:5,posThreshold:50})),e.add(new o.a.Tap({event:"singletap",pointers:1,taps:1,time:250,interval:450,threshold:5,posThreshold:20})),e.on("doubletap",this.onDoubleClick.bind(this)),e.on("doubletap2fingers",this.onDoubleClick.bind(this)),e.on("singletap",this.onSingleClick.bind(this))},focusOnHit:function(e,t,i){var r=M.vec3.create();this.getWorldPositionFromHit(e,r);var n=this._features.camera.getManipulator().getCurrentManipulator(),a=n.getEyePosition(M.vec3.create()),o=n.getHomeDistance(n.getHomeBound()),s=M.vec3.dist(r,a),u=i*o;s>u&&(M.vec3.sub(a,r,a),M.vec3.normalize(a,a),M.vec3.scale(a,a,u),M.vec3.sub(a,r,a)),this.focusOnTargetAndEye(r,a,t,!0)},onSingleClick:function(){var e=M.vec3.create(),t=M.vec3.create(),r=M.vec2.create();return function(n){var a=this._features.postProcess,o=a?a.getModel():void 0,s=o&&o.get("enable")&&o.get("dofEnable"),u=this._viewerWebGL.getViewerAPI();if(u||s){var l=i.i(x.a)(n),c=l[0],h=l[1],d=this.computeNearestIntersection2D(c,h);if(d){var p=s?o.get("dofFocusPoint"):t,f=u&&u.intersectPoint?e:void 0;this.getWorldPositionFromHit(d,p,f),u&&u.intersectPoint&&(r[0]=c,r[1]=h,u.intersectPoint(d,p,r,f)),s&&o.trigger("change:dofFocusPoint",p)}}}}(),onDoubleClick:function(e){if(i.i(m.a)().doubleClick){var t=this._features.camera;if(!t||!t.getModel().get("webVR")&&!t.getManipulator().isConstrainPan()){if(this._autoHit&&this._autoHit.get("focus")&&this._autoHit.set("focus",!1),e.pointers.length>1)return void this.focusOnHomePosition(1);var r=i.i(x.a)(e),n=r[0],a=r[1],o=this.computeNearestIntersection2D(n,a);if(!o)return void this.focusOnHomePosition(1);if(this._urlOptions.widgetAPI){var s=this._urlOptions.widgetAPI.getTabbedWidget().get();if("virtual reality"===s)return void this._features.webVR.getModel().trigger("doubleTap",o);if("materials"===s){var u=this._features.material.getModel(),l=u.findFirstMaterial(o._nodePath);if(!l)return;var h=l.get("id");return void(u.uiModel.get("material")===h?u.trigger("displayOutline",l.get("stateSet")):u.uiModel.set("material",h))}if("annotations"===s||"sound"===s)return}i.i(m.a)().cameraFollowBones&&i.i(c.a)(o._nodePath)?(this._features.hotspot.getModel().updateHotspotHit(this._autoHit,o),this._autoHit.set("focus",!0)):this.focusOnHit(o,1,.2)}}},canvasCoordToGL:function(e,t,i){var r=this._canvas,n=i||M.vec2.create(),a=this._viewerOSGJS.getCanvasPixelRatio();return n[0]=e*a,n[1]=(r.clientHeight-t)*(this._viewerOSGJS.getCanvasHeight()/r.clientHeight),n},glCoordToCanvas:function(e,t,i){var r=this._canvas,n=i||M.vec2.create(),a=this._viewerOSGJS.getCanvasPixelRatio();return n[0]=e/a,n[1]=r.clientHeight-t/a,n},computeIntersections3DPolytope:function(){var e=new w.PolytopeIntersector;e.setPrimitiveMask(w.POINT_PRIMITIVES),e.setIntersectionLimit(w.LIMIT_ONE);var t=M.vec3.create(),i=M.vec3.create(),r=M.vec3.create(),n=M.vec3.create(),a=M.mat4.create(),o=[M.vec4.create(),M.vec4.create(),M.vec4.create(),M.vec4.create(),M.vec4.create(),M.vec4.create()];return function(s,u,l,c){M.vec3.sub(r,u,s),M.vec3.normalize(r,r),M.vec3.set(n,Math.random(),Math.random(),Math.random()),M.vec3.cross(t,r,n),M.vec3.cross(i,r,t),M.vec3.normalize(t,t),M.vec3.normalize(i,i);var h=.005*y.a.getModelBoxWithoutDisplacement().radius(),d=M.vec3.dot(M.vec3.sub(n,s,M.vec3.scale(n,t,h)),t),p=M.vec3.dot(M.vec3.add(n,s,M.vec3.scale(n,t,h)),t),f=M.vec3.dot(M.vec3.sub(n,s,M.vec3.scale(n,i,h)),i),g=M.vec3.dot(M.vec3.add(n,s,M.vec3.scale(n,i,h)),i);M.vec4.set(o[0],r[0],r[1],r[2],-M.vec3.dot(s,r)),M.vec4.set(o[1],-r[0],-r[1],-r[2],M.vec3.dot(u,r)),M.vec4.set(o[2],t[0],t[1],t[2],-d),M.vec4.set(o[3],-t[0],-t[1],-t[2],p),M.vec4.set(o[4],i[0],i[1],i[2],-f),M.vec4.set(o[5],-i[0],-i[1],-i[2],g),e.reset(),c.setIntersector(e),e.setPolytope(o),l.accept(c),M.vec3.sub(r,u,s);for(var m=e.getIntersections(),v=0,_=m.length;v<_;++v){var b=m[v];b._backface=!1,b._i1=-1,b._i2=-1,b._i3=-1,b._r1=0,b._r2=0,b._r3=0,b._localIntersectionNormal=M.vec3.ONE;var x=b._localIntersectionPoint;M.mat4.identity(a),M.computeLocalToWorld(b._nodePath,!0,a),M.vec3.transformMat4(x,x,a);var S=M.vec3.dot(r,M.vec3.sub(x,x,s));M.vec3.scaleAndAdd(x,s,r,S/M.vec3.sqrLen(r)),b._ratio=b._distance,M.mat4.invert(a,a),M.vec3.transformMat4(x,x,a)}return m}}(),computeIntersections3D:function(){var e=new w.IntersectionVisitor,t=new w.LineSegmentIntersector;return function(i,r,n,a){a||(a=this._features.webVR.getNode()),void 0===n&&(n=f.a.PICK_GEOMETRY_SLOW),e.reset(),t.reset();var o=this._features.shadingStyle;if(o&&o.getModel().get("hasTriangles")&&(e.setTraversalMask(n),e.setIntersector(t),t.set(i,r),a.accept(e)),o&&o.getModel().get("hasPoints")&&n&f.a.PICK_GEOMETRY_ANIMATED)for(var s=this.computeIntersections3DPolytope(i,r,a,e),u=t.getIntersections(),l=0;l<s.length;++l)u.push(s[l]);return t.getIntersections()}}(),computeNearestIntersection3D:function(e,t,i,r){var n=this.computeIntersections3D(e,t,i,r);return this.sortIntersections(n)},computeNearestIntersection3DHotspotFirst:function(e,t,i,r){var n=this.computeIntersections3D(e,t,i,r);if(0!==n.length){n.sort(function(e,t){return e._ratio-t._ratio});var a=0,o=n.length,s=this._features.hotspot.getWidgetNode();for(a=0;a<o;++a)if(-1!==n[a]._nodePath.indexOf(s))return n[a];return this.getFirstVisibleHit(n)}},pickNearestSurface:function(e){var t=void 0===e.offsetX?e.layerX:e.offsetX,i=void 0===e.offsetY?e.layerY:e.offsetY;return this.computeNearestIntersection2D(t,i,f.a.PICK_GEOMETRY_SLOW,this._context.getScene().getRoot())},computeIntersections2D:function(){var e=M.vec3.create(),t=M.vec3.create(),i=M.mat4.create();return function(r,n,a,o){return o||(o=this._features.webVR.getNode()),this.canvasCoordToGL(r,n,e),this.canvasCoordToGL(r,n,t),e[2]=0,t[2]=1,this.getWorldPositionFromScreenPoint(e,e),this.getWorldPositionFromScreenPoint(t,t),o.getWorldMatrix(void 0,i),M.mat4.invert(i,i),M.vec3.transformMat4(e,e,i),M.vec3.transformMat4(t,t,i),this.computeIntersections3D(e,t,a,o)}}(),computeNearestIntersection2D:function(e,t,i,r){var n=this.computeIntersections2D(e,t,i,r);return this.sortIntersections(n)},sortIntersections:function(e){if(0!==e.length)return e.sort(function(e,t){return e._ratio-t._ratio}),this.getFirstVisibleHit(e)},getFirstVisibleHit:function(e){for(var t=0,i=e.length;t<i;++t){var r=e[t];if(!r._backface)return r;for(var n=r._nodePath,a=n.length-1;a>=0;--a){var o=n[a].getStateSet(),s=o&&o.getAttribute("CullFace");if(void 0!==s){if(s.getMode()===M.CullFace.DISABLE)return r;break}}}},getRelativePositionFromHit:function(){var e=M.mat4.create(),t=M.mat3.create();return function(i,r,n,a){for(var o=i._nodePath,s=!1,u=0,l=o.length;u<l;++u)if(o[u]===a){o=o.slice(u),s=!0;break}return M.mat4.identity(e),!1===s&&o[0].getWorldMatrix(a,e),M.computeLocalToWorld(o,!0,e),M.vec3.transformMat4(r,i._localIntersectionPoint,e),n&&(M.mat3.normalFromMat4(t,e),M.vec3.transformMat3(n,i._localIntersectionNormal,t),M.vec3.normalize(n,n)),r}}(),getWorldPositionFromHit:function(e,t,i){return this.getRelativePositionFromHit(e,t,i,this._viewerOSGJS.getSceneData())},getScenePositionFromHit:function(e,t,i){return this.getRelativePositionFromHit(e,t,i,this._context.getScene().getRoot())},getWorldPositionFromScenePoint:function(e,t){var i=t||M.vec3.create(),r=this._features.orientation,n=this._features.autospin;return r&&M.vec3.transformMat4(i,e,r.getNode().getMatrix()),n&&M.vec3.transformMat4(i,i,n.getNode().getMatrix()),i},getScenePositionFromWorldPoint:function(){var e=M.mat4.create();return function(t,i){var r=i||M.vec3.create(),n=this._features.orientation,a=this._features.autospin;return M.mat4.identity(e),n&&M.mat4.multiply(e,e,n.getNode().getMatrix()),a&&M.mat4.multiply(e,e,a.getNode().getMatrix()),M.mat4.invert(e,e),M.vec3.transformMat4(r,t,e)}}(),getScreenPositionFromScenePoint:function(e,t){var i=this.getWorldPositionFromScenePoint(e,t);return this.getScreenPositionFromWorldPoint(i,i)},getScreenPositionFromWorldPoint:function(){var e=M.mat4.create();return function(t,i){var r=this._viewerOSGJS.getCamera();M.mat4.identity(e),r.getViewport()&&r.getViewport().computeWindowMatrix(e),M.mat4.multiply(e,e,r.getProjectionMatrix()),M.mat4.multiply(e,e,r.getViewMatrix());var n=i||M.vec3.create();return M.vec3.transformMat4(n,t,e)}}(),getWorldPositionFromScreenPoint:function(){var e=M.mat4.create();return function(t,i){var r=this._viewerOSGJS.getCamera();M.mat4.identity(e),r.getViewport()&&r.getViewport().computeWindowMatrix(e),M.mat4.multiply(e,e,r.getProjectionMatrix()),M.mat4.multiply(e,e,r.getViewMatrix()),M.mat4.invert(e,e);var n=i||M.vec3.create();return M.vec3.transformMat4(n,t,e)}}(),getScenePositionFromScreenPoint:function(e,t){var i=this.getWorldPositionFromScreenPoint(e,t);return this.getScenePositionFromWorldPoint(i,i)},computeKdTree:function(e){for(var t=this._context.getScene().getWireframeNodes(),i=new E,r=t.length,n=0;n<r;++n)t[n].accept(i);new M.KdTreeBuilder({_numVerticesProcessed:0,_targetNumTrianglesPerLeaf:50,_maxNumLevels:50}).apply(e)},preloadMaxBackground:function(){var e=this._features.background;if(e){var t=e.getModel();if(t&&"fixed"===t.get("enable")){var i=t.getBackground();if(i){var r=i.findImageNearestUpToResolution(window.screen.width,window.screen.height);r&&this.getResourceManager().getOrCreateTexture(r.url,{minFilter:M.Texture.LINEAR,magFilter:M.Texture.LINEAR,transferToGPU:!1,convertNPOT:!1})}}}},applyAutospinToCamera:function(e,t){var i=this._features.autospin;if(i){var r=i.getNode().getMatrix();M.vec3.transformMat4(e,e,r),M.vec3.transformMat4(t,t,r)}},getCameraWithoutAutospin:function(){var e=M.mat4.create();return function(t,i){var r=this._viewerOSGJS.getManipulator();r.getEyePosition(t),r.getTarget(i);var n=this._features.autospin;n&&(M.mat4.invert(e,n.getNode().getMatrix()),M.vec3.transformMat4(t,t,e),M.vec3.transformMat4(i,i,e))}}(),createGizmoNode:function(){var e=new M.Camera;e.getOrCreateStateSet().setRenderBinDetails(g.a.EDITOR_GIZMO,"RenderBin");var t=this._nodeGizmo=new d.a(this._viewerOSGJS);t.setTraversalMask(f.a.PICK_GIZMO_LIGHT),e.addChild(t);var i=this._urlOptions.widgetAPI;if(i){var r=this._features.orientation;i.getTabbedWidget().model.on("change:value",function(){t.attachToGeometry(null),r&&r.getModel().set("showGizmo",!1)})}return e},setManipulatorNode:function(e){this._features.camera?this._features.camera.getModel().set("node",e):this._viewerOSGJS.getManipulator().setNode(e)},getNodeGizmo:function(){return this._nodeGizmo},initializePreciseBoundManager:function(){var e=this._viewerOSGJS.getManipulator().getNode();y.a.computePreciseBox(e);var t=y.a.getModelBoxWithDisplacement();e.getBoundingBox().copy(t);var i=e.getBoundingSphere();i.set(t.center(i.center()),t.radius())},initGraph:function(e){var t=this._features,i=new M.Node;i.getOrCreateStateSet().setAttributeAndModes(new M.CullFace(M.CullFace.DISABLE)),i.setName("FeatureManager - Root"),i.addChild(b.a.viewerInstance);var r=t.orientation,n=t.autospin,a=t.outline,o=t.shadingStyle,s=t.environment,u=t.lighting,l=t.camera,c=t.sound,h=t.hotspot,d=t.postProcess,p=t.webVR,f=u.getNodeShadow(),g=i;d&&(i.addChild(d.getNodeIn()),g=d.getNodeOut()),g.addChild(this.createGizmoNode(g)),g.addChild(f),g=f;for(var m=[l,s,u,c,p,n,r,h,a,o],v=0,_=m.length;v<_;++v){var x=m[v];x&&(g.addChild(x.getNode()),g=x.getNode())}return g.addChild(e),i},finished:function(e){var t=this._features,r=this._context.getScene().getRoot();r.setNodeMask(f.a.PICK_GEOMETRY_SHADOW),r.setName("rootModel"),C.a.setCamera(this._viewerOSGJS.getCamera()),r.addUpdateCallback(C.a);var n=this.initGraph(r);return e.addChild(n),this.setManipulatorNode(t.autospin.getNode()),this.preloadMaxBackground(),this.linkAutospinWithEvents(),this.linkSelectMaterialUI(r),t.lighting&&t.lighting.getModel().initLights(t.material.getSceneLights()),t.environment&&t.environment.getNode().init(r.getOrCreateStateSet(),this._viewerOSGJS.getCamera(),t.lighting.getNodeShadow()),M.time("compute KdTree"),this.computeKdTree(r),M.timeEnd("compute KdTree"),this.focusOnSavedCamera(),this._features.camera&&this._features.camera.getModel().saveCameraPosition(),this.initEventsOnClick(),M.time("drawFirstFrame"),this._viewerWebGL.drawFrame(),M.timeEnd("drawFirstFrame"),this.initializePreciseBoundManager(),t.webVR&&t.webVR.getModel().initAfterFirstFrame(),t.postProcess&&t.postProcess.getModel().initAfterFirstFrame(),t.camera&&t.camera.getModel().initAfterFirstFrame(),t.lighting&&t.lighting.getModel().set("forceShadowRedraw",!0),M.time("drawSecondFrame"),this._viewerWebGL.drawFrame(),M.timeEnd("drawSecondFrame"),t.lighting&&t.lighting.getModel().set("forceShadowRedraw",!1),i.i(s.a)()&&(l.a.getFirstAnimation().then(function(){this.registerOptionsJSON(this._viewerWebGL.getOptionsJSON())}.bind(this)),window.addEventListener("beforeunload",this.onBeforeUnload.bind(this),!1)),!i.i(_.a)()&&"onhashchange"in window&&window.addEventListener("hashchange",this._hashChanged.bind(this),!1),i.i(m.a)().debug3D&&i.i(p.a)(this,n),i.i(m.a)().cameraFollowBones&&(this._autoHit=new S.a,n.addUpdateCallback({update:this.updateFocusOnAutoHit.bind(this)})),n},registerOptionsJSON:function(e){this._lastOptions=i.i(r.cloneDeep)(e)},onBeforeUnload:function(e){var t=this._viewerWebGL.getOptionsJSON(),n=i.i(r.reduce)(this._lastOptions,function(e,n,a){return i.i(r.isEqual)(n,t[a])?e:e.concat(a)},[]);if(0!==n.length){var a="You have unsaved changes:\n";return a+="- "+n.join("\n- "),a+="\n\nYou might want to save your changes before leaving.",e.returnValue=a,a}},_hashChanged:function(){var e={};e=i.i(v.a)(e),this._features.material.getModel().overrideMaterialChannels(e);var t=i.i(m.a)();!t.debug3d&&Boolean(e.debug3d)&&(t.debug3d=!0,i.i(p.a)(this,this._context.getScene().getRoot())),!t.stats&&Boolean(e.stats)&&(t.continuousRender=!0,t.stats=!0,this._viewerOSGJS.initStats({getBoolean:function(e){return"stats"===e}}))},getShadowForcedUpdate:function(){var e=this._features.lighting.getModel(),t=e.get("forceShadowRedraw")||this._viewerWebGL.getSuperSample().isEnabled(),i=!!this._hasAnimation;return!0===this._features.autospin.getModel().get("enable")&&(i=!0),i||t}},t.a=A},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(5),o=i(740),s=i(1101),u=i(1102),l=i(1104),c=i(741),h=i(742),d=i(1105),p=i(31),f=a.a.osg,g=a.a.osgWrappers.osg.functionSortAttributes,m={Vertex:1,Normal:2,TexCoord:4,Color:8,Triangle:16,Tangent:32},v={quantization:1,prediction:2,delta:4},_={delta:1,highWatermark:2,implicit:4},b=function(e){return-1!==e.indexOf("TexCoord")?m.TexCoord:m[e]},x=function(e,t,r,n){var a,o=e.vb,l=o.Offset?o.Offset:0,c=this.getIndices();a=o.Encoding&&"varint"===o.Encoding?i.i(h.a)(new Uint8Array(n,l),c.getItemSize()*o.Size,e.type):new f[e.type](n,l,c.getItemSize()*o.Size),1===a.BYTES_PER_ELEMENT&&(a=new Uint16Array(a));var p=t.attributes,g=b("Triangle"),m=a,v=this.getMode()===f.primitiveSet.TRIANGLE_STRIP;if(0==(p&g)||!v&&this.getMode()!==f.primitiveSet.TRIANGLES)return a instanceof Uint16Array==!1&&(m=new Uint16Array(a.buffer,a.byteOffset,a.length),m.set(a)),c.setElements(m),this.setIndices(c),this;var x=t.triangle_mode,S=0;if(x&_.implicit&&v&&(S=u.a.IMPLICIT_HEADER_LENGTH+a[u.a.IMPLICIT_HEADER_MASK_LENGTH],m=new Uint16Array(a[u.a.IMPLICIT_HEADER_PRIMITIVE_LENGTH])),x&_.delta&&i.i(s.a)(a,S),x&_.implicit&&v&&i.i(u.a)(a,m,S,x&_.highWatermark),x&_.highWatermark&&i.i(d.a)(m,m,r),m instanceof Uint16Array==!1){var y=m;m=new Uint16Array(y.buffer,y.byteOffset,y.length),m.set(y)}return c.setElements(m),this.setIndices(c),this},S=f.vec3.create(),y=f.vec3.create(),C=function(e,t,r,n,a){var o="Vertex"===n?"vtx_":"uv_"+n.substr(8)+"_",s=e&v.quantization&&void 0!==a[o+"bbl_x"],u=t instanceof Float32Array==!0;if(!s&&u)return t;var l=4===t.BYTES_PER_ELEMENT?new Float32Array(t.buffer,t.byteOffset,t.length):new Float32Array(t.length);return s?(S[0]=a[o+"bbl_x"],S[1]=a[o+"bbl_y"],y[0]=a[o+"h_x"],y[1]=a[o+"h_y"],3===r&&(S[2]=a[o+"bbl_z"],y[2]=a[o+"h_z"]),i.i(c.a)(t,l,S,y,r)):(l.set(t),l)},T=function(e,t,r,n,a,s){var u,c=e.vb,d=this.getItemSize(),g=c.Size,m=c.Offset?c.Offset:0;if(u=c.Encoding&&"varint"===c.Encoding?i.i(h.a)(new Uint8Array(s,m),d*g,e.type):new f[e.type](s,m,d*g),0==(r.attributes&b(t))){if("Color"===t&&1===u.BYTES_PER_ELEMENT&&this.setNormalize(!0),"Color"===t&&4===u.BYTES_PER_ELEMENT&&i.i(p.a)().convertVertexColor8Bit){for(var _=u.length,x=new Uint8Array(u.buffer,u.byteOffset,_),S=0;S<_;++S)x[S]=Math.round(255*Math.max(0,Math.min(1,u[S])));u=x,this.setNormalize(!0)}return this.setElements(u),this}if("Normal"===t)return this.setElements(i.i(o.a)(u,new Float32Array(3*g),3,r.epsilon,r.nphi)),this.setItemSize(3),this;if("Tangent"===t)return this.setElements(i.i(o.a)(u,new Float32Array(4*g),4,r.epsilon,r.nphi)),this.setItemSize(4),this;var y=null;if("Vertex"===t)y=r.vertex_mode;else if(-1!==t.indexOf("TexCoord")){var T="uv_"+t.substr(8)+"_mode";y=void 0!==r[T]?r[T]:r.vertex_mode}return y&v.prediction&&void 0!==a?n.then(function(){return i.i(l.a)(u,d,a.getElements()),this.setElements(C(y,u,d,t,r)),this}.bind(this)):(this.setElements(C(y,u,d,t,r)),this)},M=function(e,t,i){f.NodeVisitor.call(this),this._emptyGeometries=[],this._resourceLoader=e,this._options=t,this._promises=i,this._wireframesPromises=[]};f.createPrototypeObject(M,f.objectInherit(f.NodeVisitor.prototype,{apply:function(e){if(e instanceof f.Geometry==!1)return this.traverse(e);if(0===e.getPrimitiveSetList().length&&!i.i(p.a)().keepEmptyGeometries)return void this._emptyGeometries.push(e);var t=this._options,r=t.wireframeOptions;if(r&&1===e.userDataMap.wireframe){e.setNodeMask(0);var a=n.a.defer();this._wireframesPromises.push(a.promise),r.nodes.push(e);var o=this;r.startPromise.then(function(){o.processGeometry(e,r).then(a.resolve.bind(a))})}else this._promises.push(this.processGeometry(e,t))},processGeometry:function(e,t){var i,r,a=e.userDataMap,o=0,s=this._options,u=this._resourceLoader,l=s.prefixURL,c=s.bufferMap,h=[],d=e.getPrimitiveSetList(),p=d.length,m=[0];for(o=0;o<p;++o){var v=d[o];if(!(v instanceof f.DrawArrays||v instanceof f.DrawArrayLengths)){var _=v.getIndices();_.getInitialBufferArray&&(_=_.getInitialBufferArray());var b=c[_.getInstanceID()];if(!0!==b.visited)if(b.visited=!0,b.inlined)_.setElements(new Uint16Array(b.inlined)),v.setIndices(_);else{var S=u.getBinaryArray(l+b.vb.File,t).getPromise();h.push(S),S.then(x.bind(v,b,a,m)),v.getMode()===f.primitiveSet.TRIANGLE_STRIP&&(r=S,i=_)}}}var y=e.getVertexAttributeList(),C=Object.keys(y);C.sort(g);var M=C.length;for(o=0;o<M;++o){var w=C[o],A=y[w];A.getInitialBufferArray&&(A=A.getInitialBufferArray());var E=c[A.getInstanceID()];if(!0!==E.visited)if(E.visited=!0,E.inlined)A.setElements(new Float32Array(E.inlined));else{var P=a,N=w.indexOf("_");if(-1!==N){var F=w.slice(N+1);P=a["morph_"+F],w=w.slice(0,N)}var R=u.getBinaryArray(l+E.vb.File,t).getPromise(),I=R.then(T.bind(A,E,w,P,r,i));h.push(I)}}return n.a.all(h)},removeEmptyGeometries:function(){for(var e=this._emptyGeometries,t=0,i=e.length;t<i;++t)for(var r=e[t],n=r.getParents(),a=n.length-1;a>=0;--a)n[a].removeChild(r)}}));var w={};w.postParse=function(e,t,i){var r=[],a=new M(t,i,r);e.accept(a),a.removeEmptyGeometries();var o=i.wireframeOptions;if(o){var s=o.deferDownload;n.a.all(a._wireframesPromises).then(s.resolve.bind(s))}return n.a.all(r)},t.a=w},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=i(514),o=i(1069),s=i(1068),u=i(1067),l=n.a.osg,c=function(e,t,i){i?l.error("ResourceLoader: "+e+" failed "+t+" error "+i):l.error("ResourceLoader: "+e+" failed "+t)},h=function(){this._nbThreads=5,this._processing=[],this._queue=[],this._finished=[],this._running=!1};h.prototype={checkResource:function(e){var t;return[this._processing,this._queue,this._finished].forEach(function(n){t||(t=i.i(r.find)(n,function(t){return t._url===e}))}),t},run:function(){this._running=!0,this.runPendingProcess()},runPendingProcess:function(){for(;this._processing.length<this._nbThreads&&this._queue.length>0;){var e=this._queue.shift();this._processing.push(e),e.start()}},queue:function(e){var t=e;e.start||(console.log(e.url),t=new a.a(e.url,e.response)),this._queue.push(t);var i=function(){this._processing.splice(this._processing.indexOf(t),1),this._finished.push(t),this.runPendingProcess()}.bind(this),r=function(){this._processing.splice(this._processing.indexOf(t),1),this.runPendingProcess()}.bind(this);return t.getPromise().then(i).catch(r).done(),this._running&&this.runPendingProcess(),t},getModel:function(e,t){var i=this.checkResource(e);return i||(i=this.queue(new o.a(e,"text",t)),i.getPromise().then(function(){}).catch(function(t){c(e,"model",t)}).done(),i)},getImage:function(e,t){var i=this.checkResource(e);if(i)return i;var r=t||{};return"data:image"===e.substr(0,"data:image".length)||(r.crossOrigin="anonymous"),i=this.queue(new s.a(e,r)),i.getPromise().then(function(){}).catch(function(){c(e,"image")}).done(),i},getBinaryArray:function(e,t){var i=this.checkResource(e);return i||(i=this.queue(new u.a(e,t)),i.getPromise().then(function(){}).catch(function(t){c(e,"binary array",t)}).done(),i)}},t.a=h},function(e,t,i){"use strict";var r=i(89),n=i(981),a=i(982),o=i(46),s={FeatureName:"animation",ModelType:n.a,ViewListType:[a.a]},u=!1;o.a.getHasAnimation().then(function(e){e&&(u=e)});var l=r.a.create(s);l.prototype.prepareForScreenShot=function(){return!!u&&(this._oldPlayingAnimation=this.getModel().get("playing"),this.getModel().set("playing",!1),!0)},l.prototype.resetAfterScreenShot=function(){this._oldPlayingAnimation&&this.getModel().set("playing",!0)},t.a=l},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(19)),a=i.n(n),o=i(92),s=i(90),u=i(31),l=i(299),c=a.a.Model.extend({defaults:function(){var e=this.getResourceManager().getOrCreateAnimationCollection().resource;return i.i(s.a)()||e.remove(e.where({isEnabled:!1})),{animations:e,currentUID:"-1",speed:1,autoplay:!0,playing:!0,cycleMode:"one",fps:-1,progress:0}},getName:function(){return"Animation"},getResourceManager:function(){return this._resourceManager||o.default.instance},getAnimationByUID:function(e){return this.get("animations").find(function(t){return t.get("uid")===e})},getCurrentAnimation:function(){return this.getAnimationByUID(this.get("currentUID"))},getEnabledAnimationsCount:function(){return this.get("animations").where({isEnabled:!0}).length},getFirstEnabledAnimation:function(){for(var e=this.get("animations"),t=e.length,i=0;i<t;++i){var r=e.at(i);if(r&&r.get("isEnabled"))return r}},init:function(e){this._viewer=e.getViewer();var t=e.getModel().get("options"),n=t.animation;if(n&&n.order){var a=this.get("animations");this.set("speed",n.speed),this.set("cycleMode",n.cycleMode),this.set("autoplay",n.autoplay),this.set("playing",i.i(u.a)().animationAutoplay);var o=i.i(r.invert)(n.order);a.forEach(function(e){e.set("order",parseInt(o[e.get("uid")],10))}),a.sort()}},getJSON:function(){return{order:this.get("animations").pluck("uid"),speed:this.get("speed"),cycleMode:this.get("cycleMode"),autoplay:!!i.i(l.a)()||"-1"!==this.get("currentUID")}}});t.a=c},function(e,t,i){"use strict";var r=(i(983),i(10)),n=i.n(r),a=i(5),o=i(46),s=i(4),u=i(727),l=i(53),c=i(388),h=i(31),d=i(16),p=a.a.osg,f=a.a.osgAnimation,g=a.a.osgWrappers,m=g.osg,v=s.a.extend({initialize:function(){s.a.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:playing",this.onPlayingChanged,this),e.bind("change:speed",this.onSpeedChanged,this),e.bind("change:currentUID",this.onCurrentAnimationChanged,this),e.bind("seek",this.onSeek,this),this._manager=null,this._idLoop=0,this._skeletons=[],this._viewer=this.options.context.getViewer(),this._firstAnimationPlayed=!1,this._animationPromises=[],this._hookBasicAnimationManager(o.a.getPolygon()),o.a.getMaterial().then(this._initAnimation.bind(this)),o.a.getModelDisplayed().then(this._resolveAllAnimations.bind(this))},_resolveAllAnimations:function(){0===this._animationPromises.length?(o.a.resolveFirstAnimation(),o.a.resolveAllAnimations()):n.a.all(this._animationPromises).then(o.a.resolveAllAnimations.bind(o.a))},_initAnimation:function(){this._manager&&(this.onSpeedChanged(),u.a.init(this._skeletons,this._viewer,this.model))},_getHookUpdate:function(){var e=this;return function(t,i){var r=e.getCurrentInstanceAnimation();(-1!==this._seekTime||!this._pause&&r)&&l.a.draw();var n=f.BasicAnimationManager.prototype.update.call(this,t,i);if(r){var a=Math.max(0,this.getSimulationTime()*this.getTimeFactor()-r.start),o=a%r.duration*100/r.duration,s=Math.floor(a/r.duration);s>this._idLoop&&(o=100,e.end(),"one"!==e.model.get("cycleMode")&&(n=f.BasicAnimationManager.prototype.update.call(this,t,i))),this._idLoop=s,e.model.set("progress",o)}return n}},_getHookUpdateManager:function(){var e=this;return function(t){var i=e.getCurrentInstanceAnimation(),r=e.model.get("fps");if(i&&r>0){var n=1/r,a=(t-i.start)%n;a>.5*n?t+=n-a:t-=a}return f.BasicAnimationManager.prototype.updateManager.call(this,t)}},_hookUpdateChannelType:function(){i.i(h.a)().snapKeyframe&&(f.BasicAnimationManager.prototype._updateChannelsType=function(e,t,i){for(var r=0,n=t.length;r<n;r++){var a=t[r],o=a.instanceAnimation,s=o.loop,u=e-a.t;s&&o.duration>0&&(u%=o.duration),u+=o.firstKeyTime;var l=a.channel;if(u>l.start&&u<l.end){var c=l.times,h=a.key;if(u>c[h])for(;c[h+1]<u;)h++;else if(u<c[h])for(;c[h]>u;)h--;var d=c[h],p=c[h+1];u=Math.abs(u-d)<Math.abs(u-p)?d:p}i(u,a)}})},_hookBasicAnimationManager:function(e){var t=this,i=this._animationPromises,r=this._getHookUpdate(),a=this._getHookUpdateManager();this._hookUpdateChannelType(),g.osgAnimation.BasicAnimationManager=function(s,u){var l=s.getJSON();return l.Animations?(m.Object(s,u),o.a.OSG_VERSION<8?n.a.resolve(u):t._manager?(p.error("More than one basicAnimationManager !"),n.a.resolve(u)):(t._manager=u,t.model.get("playing")||u.togglePause(),u.update=r,u.updateManager=a,e.then(function(){var e=s.getOptions();e.progress=void 0;for(var r=l.Animations.length,n=0;n<r;++n){var a=l.Animations[n],o=s.setJSON(a["osgAnimation.Animation"].UserDataContainer).readUserDataContainer(),u=c.a.convertUserDataToObject(o),h=t.model.getAnimationByUID(u.AnimationUID);if(h){e.currentAnimationUID=h.get("url");var d=s.setJSON(a).readObject();d.isRejected()?p.Notify.warn("An Animation failed on the parsing!"):(d.then(t.onAddAnimation.bind(t,n,u)),i.push(d))}}}),n.a.resolve(u))):n.a.reject()}},onAddAnimation:function(e,t,i){var r=t.AnimationUID;i.name=r,i.duration||(i.duration=2.5,i.still=!0),this._manager.addAnimations([i]),0===i.duration&&(this._manager.getAnimations()[r].duration=2.5);var n=this.model;n.trigger("change:animations");var a=n.getAnimationByUID(r);a.on("change:isLoop",this.onAnimationChangeLoop.bind(this)),a.get("isLoop")&&this.onAnimationChangeLoop(a),this.model.get("currentUID")===r&&this.onCurrentAnimationChanged(),this._firstAnimationPlayed||(this._playFirstAnimation(r)&&(this._firstAnimationPlayed=!0,this.model.set("currentUID",r)),o.a.resolveFirstAnimation())},_playFirstAnimation:function(e){if(!this.model.get("autoplay"))return!1;var t=this.model.getFirstEnabledAnimation();return t&&e===t.get("uid")},onAnimationChangeLoop:function(e){var t=this._manager.getAnimations()[e.get("uid")];this._manager.setAnimationLerpEndStart(t,e.get("isLoop")?1/30:0)},onCurrentAnimationChanged:function(){this._idLoop=0;var e=this._manager;if(e.stopAllAnimation(),e.resetAllStackedTransforms(),this.getCurrentAnimation()){var t=this.getCurrentInstanceAnimation();t&&(e.playAnimation(t),e.setSeekTime(t.start))}l.a.draw()},getCurrentAnimation:function(){return this.model.getCurrentAnimation()},getCurrentInstanceAnimation:function(){var e=this.getCurrentAnimation();return e?this._manager.getAnimations()[e.get("uid")]:void 0},onPlayingChanged:function(){if(this._playlistNoLoopEnd){var e=this.model.getFirstEnabledAnimation().get("uid")||"-1";this._playlistNoLoopEnd=!1,e===this.getCurrentAnimation().get("uid")?this.model.trigger("seek",0):this.model.set("currentUID",e)}this._manager.togglePause(),l.a.draw()},onSeek:function(e){var t=this.getCurrentInstanceAnimation();if(t){var i=this._manager;i.setSeekTime(t.start+t.duration*(e/100)/i.getTimeFactor()),l.a.draw()}},onSpeedChanged:function(){this._manager.setTimeFactor(this.model.get("speed")),d.a.modelViewerAnimationSpeedSelected(this.model.get("speed"))},end:function(){var e=this.model.get("cycleMode");if("one"===e)this.model.trigger("cycleMode");else if("all"===e||"none"===e){var t,i=this.model.get("animations"),r=i.indexOf(this.getCurrentAnimation()),n="-1",a=0,o=i.length;for(a=r+1;a<o;++a)if((t=i.at(a))&&t.get("isEnabled")){n=t.get("uid");break}"-1"===n&&"all"===e&&(n=this.model.getFirstEnabledAnimation()?this.model.getFirstEnabledAnimation().get("uid"):"-1"),"-1"!==n?this.model.set("currentUID",n):(this.model.set("playing",!1),this.model.trigger("seek",99.99),this._playlistNoLoopEnd=!0)}}});t.a=v},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(5),o=i(388),s=i(92),u=i(1103),l=i(1099),c=i(1100),h=i(742),d=i(741),p=i(740),f=a.a.osg,g=a.a.osgDB,m=a.a.osgAnimation,v=a.a.osgWrappers.osgAnimation,_=m.Channel,b=function(){},x=g.registry();x.registerObject("osgAnimation.Vec3LerpChannelCompressedPacked",b),x.registerObject("osgAnimation.Vec3LerpChannelCompressed",b),x.registerObject("osgAnimation.Vec3LerpChannelPacked",b),x.registerObject("osgAnimation.QuatSlerpChannelCompressedPacked",b),x.registerObject("osgAnimation.QuatSlerpChannelCompressed",b),x.registerObject("osgAnimation.QuatSlerpChannelPacked",b),x.registerObject("osgAnimation.FloatLerpChannelCompressedPacked",b),x.registerObject("osgAnimation.FloatLerpChannelCompressed",b),x.registerObject("osgAnimation.FloatLerpChannelPacked",b);var S={},y=(new s.default)._resourceLoader,C={quantization:1,prediction:2,delta:4,quat:8,deltaTime:16},T=function(e,t,r,n,a,o){var s,g=t.ItemSize,m=Object.keys(t.Array)[0],v=t.Array[m],_=v.Offset?v.Offset:0,b=v.Size,x=r.channel_mode||0,S=!!(1===o?x&C.deltaTime:x&C.delta),y=new ArrayBuffer(4*(S?b+2:b+1)*o),T=new Float32Array(y,S?4*o:0,b*o);return s=v.Encoding&&"varint"===v.Encoding?i.i(h.a)(new Uint8Array(e,_),g*b,m):new f[m](e,_,g*b),4===o&&x&C.quat?(a&&(s=i.i(u.a)(s,new Float32Array(s.length),g)),i.i(p.a)(s,T,o,r.epsilon,r.nphi,!0),S&&(T=new Float32Array(y,0,(b+1)*o),T[0]=r.ox,T[1]=r.oy,T[2]=r.oz,T[3]=r.ow,i.i(c.a)(T)),T):(a&&1!==o?i.i(u.a)(s,T,g):T.set(s),n?(3===o&&x&C.quantization&&i.i(d.a)(T,T,[r.bx,r.by,r.bz],[r.hx,r.hy,r.hz],o),S&&(T=new Float32Array(y,0,(b+1)*o),3===o?(T[0]=r.ox,T[1]=r.oy,T[2]=r.oz):T[0]=r.ot,i.i(l.a)(T,g)),T):T)},M=function(e,t,i,r,a,s){var u=e.getJSON();if(!(void 0!==u.TargetName&&u.KeyFrames&&u.Name&&u.KeyFrames.Time&&u.KeyFrames.Key))return n.a.reject();var l=u.UserDataContainer,c=l?o.a.convertUserDataToObject(e.setJSON(l).readUserDataContainer()):S;return y.getBinaryArray(e.getOptions().currentAnimationUID).getPromise().then(function(e){var n=T(e,u.KeyFrames.Time,c,r,!1,1),o=T(e,u.KeyFrames.Key,c,r,a,s);return i(o,n,u.TargetName,u.Name,t),t})};v.Vec3LerpChannel=function(e,t){return M(e,t,_.createVec3Channel,!1,!1,3)},v.Vec3LerpChannelCompressedPacked=function(e,t){return M(e,t,_.createVec3Channel,!0,!0,3)},v.Vec3LerpChannelCompressed=function(e,t){return M(e,t,_.createVec3Channel,!0,!1,3)},v.Vec3LerpChannelPacked=function(e,t){return M(e,t,_.createVec3Channel,!1,!0,3)},v.QuatSlerpChannel=function(e,t){return M(e,t,_.createQuatChannel,!1,!1,4)},v.QuatSlerpChannelCompressedPacked=function(e,t){return M(e,t,_.createQuatChannel,!0,!0,4)},v.QuatSlerpChannelCompressed=function(e,t){return M(e,t,_.createQuatChannel,!0,!1,4)},v.QuatSlerpChannelPacked=function(e,t){return M(e,t,_.createQuatChannel,!1,!0,4)},v.FloatLerpChannel=function(e,t){return M(e,t,_.createFloatChannel,!1,!1,1)},v.FloatLerpChannelCompressedPacked=function(e,t){return M(e,t,_.createFloatChannel,!0,!0,1)},v.FloatLerpChannelCompressed=function(e,t){return M(e,t,_.createFloatChannel,!0,!1,1)},v.FloatLerpChannelPacked=function(e,t){return M(e,t,_.createFloatChannel,!1,!0,1)}},function(e,t,i){"use strict";var r=i(89),n=i(985),a=i(987),o={FeatureName:"autospin",ModelType:n.a,ViewListType:[a.a]},s=r.a.create(o);s.prototype.getNode=function(){return this._views[0]._nodeAutospin},t.a=s},function(e,t,i){"use strict";var r=i(19),n=i.n(r),a=i(31),o=n.a.Model.extend({defaults:{enable:!1,paused:!1,speed:.6},getName:function(){return"Autospin"},init:function(){var e=i.i(a.a)();void 0!==e.autospin&&(this.set("enable",!!e.autospin),this.set("speed",e.autospin))}});t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(53),a=r.a.osg,o=function(e,t,i){this._speed=void 0!==e?e:-.6,this._fadeStart=void 0!==t?t:2,this._fadeEnd=void 0!==i?i:2,this._enable=!0,this._rotation=0,this._lastTime=-1,this._startTime=0,this._endTime=0,this._checkIfFinished=!1,this._fixedCenter=void 0};a.createPrototypeObject(o,{setSpeed:function(e){this._speed=e},setFadeStart:function(e){this._fadeStart=e},setFadeEnd:function(e){this._fadeEnd=e},deactivate:function(){this._enable=!1},resume:function(){this._enable=!0,this._checkIfFinished=!1;var e=Math.max((this._endTime-this._lastTime)/this._fadeEnd,0);this._startTime=this._lastTime-this._fadeStart*e,this._endTime=this._lastTime,n.a.draw()},pause:function(){var e=Math.min((this._lastTime-this._startTime)/this._fadeStart,1);this._endTime=this._lastTime+this._fadeEnd*e,this._checkIfFinished=!0},update:function(){var e=a.mat4.create();return function(t,i){if(!1===this._enable)return!0;n.a.draw();var r=i.getFrameStamp().getSimulationTime();if(!0===this._checkIfFinished&&this._endTime<r)return this._enable=!1,this._checkIfFinished=!1,this._lastTime=-1,!0;if(this._lastTime<0)return this._lastTime=r,this._startTime=r,!0;var o=r-this._lastTime;this._lastTime=r,this._endTime>r?this._rotation+=o*a.smoothStep(0,1,(this._endTime-r)/this._fadeEnd):r-this._startTime<this._fadeStart?this._rotation+=o*a.smoothStep(0,1,(r-this._startTime)/this._fadeStart):this._rotation+=o;var s=t.getMatrix();a.mat4.fromZRotation(s,-this._rotation*this._speed);var u=t.getChildren();if(u.length>0){if(!this._fixedCenter){var l=u[0].getMinimumBound();l.valid()&&(this._fixedCenter=a.vec3.create(),a.vec3.copy(this._fixedCenter,l.center()))}var c=this._fixedCenter||u[0].getMinimumBound().center();a.vec3.negate(c,c),a.mat4.fromTranslation(e,c),a.mat4.multiply(s,s,e),a.vec3.negate(c,c),a.mat4.fromTranslation(e,c),a.mat4.multiply(s,e,s)}return t.dirtyBound(),!0}}()},"osgSketchfab","UpdateCallbackAutospin"),t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(4),a=i(986),o=r.a.osg,s=n.a.extend({initialize:function(){n.a.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:enable",this.onEnableChanged,this),e.bind("change:paused",this.onPausedChanged,this),e.bind("change:speed",this.onSpeedChanged,this),this._nodeAutospin=new o.MatrixTransform,this._nodeAutospin.setName("Feature - Autospin"),this._callbackAutospin=new a.a(e.get("speed"),1,1),this._nodeAutospin.addUpdateCallback(this._callbackAutospin),!1===e.get("enable")&&this._callbackAutospin.deactivate()},onEnableChanged:function(){!0===this.model.get("enable")?this._callbackAutospin.resume():this._callbackAutospin.deactivate()},onPausedChanged:function(){!1!==this.model.get("enable")&&(!0===this.model.get("paused")?this._callbackAutospin.pause():this._callbackAutospin.resume())},onSpeedChanged:function(){this._callbackAutospin.setSpeed(this.model.get("speed"))}});t.a=s},function(e,t,i){"use strict";var r=i(89),n=i(989),a=i(990),o={FeatureName:"background",ModelType:n.a,ViewListType:[a.a]};t.a=r.a.create(o)},function(e,t,i){"use strict";var r=i(5),n=i(46),a=i(15),o=i(959),s=i(970),u=i(31),l=i(299),c=i(337),h=r.a.osg,d=h.vec3.fromValues(.2,.2,.2),p=a.a.extend({_trashbin:[],defaults:function(){return{enable:i.i(l.a)()?"ambient":"fixed",enableVR:!1,uid:"51af6a870cce449eb75b0345feebaebb",color:h.vec3.fromValues(.2,.2,.2),webVR:!1}},init:function(e){var t=e.getModel().get("user").uid;this.backgroundCollection=this.createCollection(t),this.backgroundCollection.fetch({remove:!1});var r=e.getModel().get("options").background;r&&(r.enable&&this.set("enable",r.enable),void 0!==r.enableVR&&this.set("enableVR",r.enableVR),r.uid&&this.set("uid",r.uid),r.color&&this.set("color",r.color)),i.i(u.a)().transparent&&this.set("enable","none");var a=e.getViewer();i.i(l.a)()&&n.a.getPolygon().then(function(){"Tilt Brush"===a.getRootUserData().authoringTool&&(this.set("enable","color"),this.set("color",h.vec3.create()))}.bind(this))},createCollection:function(e){return new o.a([],{filters:new s.a({userUID:e})})},getName:function(){return"Background"},setBackground:function(e){return this.setBackgroundUID(e.uid)},setBackgroundUID:function(e){e&&this.set("uid",e)},getBackground:function(){if(this.backgroundCollection){var e=this.get("uid"),t=this.backgroundCollection.find(function(t){return t.get("uid")===e||t.get("id")===e});if(t)return t;this.set("uid","51af6a870cce449eb75b0345feebaebb")}},getEnableType:function(){var e=this.get("enable");return!this.get("webVR")||this.get("enableVR")&&"environment"===e?e:"color"},getColor:function(){return!this.get("webVR")||this.get("enableVR")&&"color"===this.get("enable")?this.get("color"):d},getJSON:function(){var e={},t=this.getBackground();return e.enable=this.get("enable"),e.enableVR=this.get("enableVR"),e.uid=t?t.get("uid"):"51af6a870cce449eb75b0345feebaebb",e.color=this.get("color"),e},editorGetJSON:function(){return this.getJSON()},validateJSON:function(e){var t=[];return c.a.isEnumString(e.enable,["ambient","environment","fixed","color","none"])||t.push("Background.editorSetJSON enable must be an enum in values [ environment, fixed, color, none ]"),c.a.isBoolean(e.enableVR)||t.push("Background.editorSetJSON enableVR must be a boolean"),void 0!==e.uid&&(c.a.isString(e.uid)||t.push("Background.editorSetJSON uid must be a string")),void 0!==e.color&&(c.a.isArrayNumber(e.color,3,0,1)||t.push("Background.editorSetJSON color must be a vec3 with value in range [0,1]")),t.join("\n")},editorSetJSON:function(e){var t=this.validateJSON(e);return t?(this.set("enable",e.enable),this.set("enableVR",e.enableVR),void 0!==e.uid&&this.set("uid",e.uid),void 0!==e.color&&this.set("color",e.color),t):t}});t.a=p},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(10)),a=i.n(n),o=i(5),s=i(46),u=i(4),l=i(92),c=i(602),h=i(53),d=o.a.osg,p=u.a.extend({initialize:function(){u.a.prototype.initialize.apply(this,arguments),this.model.bind("change:enable",this.onEnableChanged,this),this.model.bind("change:enableVR",this.onEnableChanged,this),this.model.bind("change:webVR",this.onEnableChanged,this),this.model.bind("change:uid",this.onBackgroundChanged,this),this.model.bind("change",h.a.draw),this._viewer=this.options.context.getViewer();var e=this.options.context.getFeatures().environment;e&&(this._resourceDefer=a.a.defer(),this.options.context.getScene().addResourcePromise(this._resourceDefer.promise),this._modelEnvironment=e.getModel(),this._nodeBackground=e.getNode().getBackground(),this._nodeBackground.addUpdateCallback(this),s.a.getMaterial().then(this.onEnableChanged.bind(this)))},getResourceManager:function(){return this._resourceManager||l.default.instance},onBackgroundChanged:function(){var e=this.model.getBackground();if(e){var t=this.options.context.getViewer(),r=Math.max(i.i(c.a)(t.getWidth()),i.i(c.a)(t.getHeight())),n=e.findImageNearestToResolution(r,r),a=n.url;return this.getResources(a)}},getResources:function(e){for(var t={minFilter:d.Texture.LINEAR,magFilter:d.Texture.LINEAR,transferToGPU:!0,convertNPOT:!1},n=this.getResourceManager()._resourceLoader._processing,a=0;a<n.length;++a){var o=n[a];o._options&&o._options.cancelableBackground&&o._options.uid!==this.model.get("uid")&&o.abortImage()}var u=this.getResourceManager().getOrCreateTexture(e,i.i(r.extend)({},t,{cancelableBackground:!0,uid:this.model.get("uid")}));u.promise.then(function(e){this._nodeBackground.setBackground(e),this._nodeBackground.rescale(this._viewWidth,this._viewHeight),this.model.trigger("backgroundUpdated",e),"fixed"===this.model.getEnableType()&&this._nodeBackground.showBackground()}.bind(this));var l=this.options.context.getViewer();return this._resourceDefer?(u.promise.finally(this._resourceDefer.resolve.bind(this._resourceDefer)),this._resourceDefer=void 0):s.a.getHighResLoaded().then(l.setFakeSecondaryProgress.bind(l,u.promise,0)),u.promise},onEnableChanged:function(){var e=this.model.getEnableType();"color"===e?this._nodeBackground.showColor():"fixed"===e?this._nodeBackground.getBackground()?this._nodeBackground.showBackground():void 0!==this.model.get("uid")&&this.onBackgroundChanged():"environment"===e?(this._modelEnvironment.trigger("updateBackground"),this._nodeBackground.showEnvironment()):"ambient"===e?(this._modelEnvironment.trigger("updateBackground"),this._nodeBackground.showAmbient()):"none"===e&&this._nodeBackground.hide(),this._resourceDefer&&this._resourceDefer.resolve()},requireBiggerTexture:function(){var e=this.options.context.getViewer(),t=Math.max(i.i(c.a)(e.getWidth()),i.i(c.a)(e.getHeight())),r=this.model.getBackground();if(r){var n=r.findImageNearestUpToResolution(t,t);if(void 0!==this._nodeBackground&&!this._nodeBackground.getBackground())return!1;if(n.width<this._nodeBackground.getBackground().getWidth())return!1}return!0},update:function(){if("fixed"!==this.model.getEnableType())return!0;var e=this._viewer.getCamera().getViewport(),t=e.width(),i=e.height();return this._viewWidth===t&&this._viewHeight===i||(this._viewWidth=t,this._viewHeight=i,!0===this.requireBiggerTexture()&&this.onBackgroundChanged(),this._nodeBackground.rescale(t,i)),!0}});t.a=p},function(e,t,i){"use strict";var r=i(5),n=i(0),a=(i.n(n),i(156)),o=r.a.osg,s=i.i(n.invert)(o.Texture),u=["magFilter","minFilter","wrapS","wrapT","textureTarget","internalFormat"],l=function(e){e.image&&(e.url=e.image,delete e.image);for(var t=0,i=u.length;t<i;++t){var r=u[t];"number"==typeof e[r]&&(e[r]=s[e[r]])}void 0===e.texCoordUnit?e.texCoordUnit=0:"string"==typeof e.texCoordUnit&&(e.texCoordUnit=parseInt(e.texCoordUnit,10)),e.format&&delete e.format},c=function(e){return Math.max(0,Math.min(1,e))},h=function(e,t,i){if(void 0!==e.factor){var r=0,n=1;i<=2&&("Opacity"===t?"alphaMask"===e.type?r=.01:"alphaBlend"===e.type&&e.factor>=.99&&(e.factor=1):e.factor<.01&&(e.factor=0)),"BumpMap"===t||"EmitColor"===t?n=10:"SpecularHardness"===t?n=1e4:"Displacement"===t&&(n=1e15),e.factor=Math.max(r,Math.min(n,e.factor))}if(e.color){var s=e.color;e.color=o.vec3.fromValues(c(s[0]),c(s[1]),c(s[2]))}void 0===e.enable&&(e.enable=!0);var u=e.texture;if(u){l(u);var h=u.internalFormat;if(!h)return void(u.internalFormat=a.a.getDefaultFormat(t));switch(t){case"NormalMap":case"SpecularPBR":u.internalFormat="RGB";break;case"DiffuseColor":case"DiffuseIntensity":case"SpecularColor":case"EmitColor":case"DiffusePBR":case"AlbedoPBR":case"Matcap":"RGBA"===h&&(u.internalFormat="RGB");break;case"Displacement":case"SpecularHardness":case"BumpMap":case"GlossinessPBR":case"RoughnessPBR":case"MetalnessPBR":case"SpecularF0":case"AOPBR":case"CavityPBR":u.internalFormat="LUMINANCE";break;default:case"Opacity":"RGBA"===h?u.internalFormat="ALPHA":"RGB"===h&&(u.internalFormat="LUMINANCE")}}},d=function(e){var t=e.channels;t.Geometry&&(t.NormalMap=t.Geometry,delete t.Geometry),t.Reflection&&(void 0===e.reflection&&(e.reflection=t.Reflection.factor),delete t.Reflection),e.cullFace||e.cullFaceMode&&(e.cullFace=e.cullFaceMode,delete e.cullFaceMode),e.depthCheckMode&&(t.Opacity&&!t.Opacity.type&&(t.Opacity.type="alphaBlend"),delete e.depthCheckMode);var i=e.version||0;if(t)for(var r in t)h(t[r],r,i)};t.a=d},function(e,t,i){"use strict";var r=i(5),n=i(0),a=(i.n(n),i(155)),o=i(991),s=r.a.osg,u=function(e,t){var r=[],a={},o=function(e,i){if(!a[i]){a[i]=i;var n="https://media.sketchfab.com/urls/"+t+"/"+i,o={uid:i,name:i,images:[{url:n,uid:i,width:4096,height:4096}]};e.uid=a[i],delete e.image,delete e.url,r.push(o)}e.uid=a[i],delete e.image,delete e.url};i.i(n.each)(e,function(e){i.i(n.each)(e.channels,function(e){if(e.texture){var t=e.texture.url||e.texture.image;!t&&e.texture.uid&&(t=e.texture.uid),t&&o(e.texture,t)}})}),window.prefetchedData["/i/models/"+t+"/textures"]={results:r}},l=function(e,t,i){return Math.max(t,Math.min(i,e))},c=function(e){var t=e.materials;for(var r in t){var n=t[r];"object"==typeof n?void 0===n.stateSetID?delete t[n.id]:i.i(o.a)(n):delete t[r]}},h=function(e){if(e.orientation.axis){var t=e.orientation.axis;t=s.vec3.fromValues(l(t[0],0,3),l(t[1],0,3),l(t[2],0,3)),delete e.orientation.axis,t[0]=(4-t[0])%4,t[1]=(4-t[1])%4,t[2]=(4-t[2])%4,e.orientation.matrix=s.mat4.fromRotation(s.mat4.create(),.5*Math.PI*(t[0]+t[1]+t[2]),t)}},d=function(e){switch(e.shading.type){case"lit":case"matcap":case"shadeless":break;case"blending":case"default":case"default-shading":case"predefined-shading":case"shading":case void 0:e.shading.type="lit";break;default:case"no-shading":e.shading.type="shadeless"}e.shading.vertexColor||"pbr"!==e.shading.renderer||(e.shading.vertexColor={enable:!1,colorSpace:"linear"})},p=function(e){var t=e.environment;void 0!==t.exposure&&(t.exposure*=void 0!==t.light&&t.light>0?t.light:1);var i=e.environment.backgroundEnable;void 0!==i&&!0===e.environment.enable?e.background.enable=!0===i?"environment":!0===e.background.enable?"fixed":"none":void 0!==e.background.enable&&(!0===e.background.enable?e.background.enable="fixed":!1===e.background.enable&&(e.background.enable="none"))},f=function(e){if(e.lighting.lights)for(var t=e.lighting.lights,i=0,r=t.length;i<r;++i){var n=t[i];n.hardness=Math.max(Math.min(n.hardness,1),0)}else e.lighting={}},g=function(e){var t=e.scene&&e.scene.postProcess;if(t){var i=t.ssao;2===e.version&&t.enable&&i&&i.enable&&0===i.bias&&0===i.radius&&(i.ssaoBias=-1,i.ssaoRadius=-1,e.vr.scale=-1)}},m=function(e,t){return h(e),d(e),p(e),c(e),f(e),g(e),t?e:i.i(n.cloneDeepWith)(e,function(e){if(e.byteLength)return Array.prototype.slice.call(e)})},v=function(e){var t=e.toJSON();if(void 0===e.get("vertexCount")&&e.set("vertexCount",t.nbVertexes),void 0===e.get("faceCount")&&e.set("faceCount",t.nbTriangles),void 0===t.options&&(t.options={}),e.set("options",m(t.options,!0)),e.set("files",t.files),!t.options.version){var i=e.get("uid"),r=a.a.get("/i/models/"+i+"/textures");(!r||!r.results||!r.results.length)&&u(t.options.materials,i)}return e};v.readOptions=m,t.a=v},function(e,t,i){"use strict";var r=i(89),n=i(995),a=i(999),o={FeatureName:"camera",ModelType:n.a,ViewListType:[a.a]},s=r.a.create(o);s.prototype.getManipulator=function(){return this._views[0]._switchManipulator},s.prototype.getNode=function(){return this._views[0].getNode()},s.prototype.getWidgetNode=function(){return this._views[0].getWidgetNode()},t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(31),a=r.a.osg,o=r.a.osgGA,s=function(e){o.FirstPersonManipulator.call(this,e);var t=Math.max(0,Math.min(4,i.i(n.a)().fpsSpeed/25));this._stepFactor=t,this.getControllerList().StandardMouseKeyboard._stepFactor=t,this._postMultRotate=a.quat.create(),this._resetInitialVR=!1,this._lookPosition._delay=.25};a.createPrototypeObject(s,a.objectInherit(o.FirstPersonManipulator.prototype,{getPostMultRotate:function(){return this._postMultRotate},setResetInitialRotationVR:function(e){this._resetInitialVR=e,e||a.quat.identity(this._postMultRotate)},setNode:function(e){o.FirstPersonManipulator.prototype.setNode.call(this,e);var t=this.getHomeBound();t&&t.valid()&&(this._distance=this.getHomeDistance(t))},setInitialPoseVR:function(){var e=a.quat.create(),t=a.mat4.create(),i=a.vec3.fromValues(0,0,1);return function(r,n){a.mat4.lookAt(t,r,n,i),a.mat4.invert(t,t),a.mat4.getRotation(e,t),e[1]=e[0]=0,a.quat.normalize(e,e),a.quat.copy(this._postMultRotate,e),this.setEyePosition(r),this.setTarget(n),this.setResetInitialRotationVR(!0)}}(),setPoseVR:function(){var e=a.vec3.create();return function(t,i){this._resetInitialVR&&(a.quat.invert(this._vrRot,t),this._vrRot[0]=this._vrRot[1]=0,a.quat.normalize(this._vrRot,this._vrRot),a.quat.multiply(this._postMultRotate,this._vrRot,this._postMultRotate)),a.quat.multiply(this._vrRot,this._postMultRotate,t),a.vec3.transformQuat(e,i,this._postMultRotate),this._resetInitialVR?(a.vec3.set(this._vrTrans,0,0,0),this._resetInitialVR=!1):a.vec3.sub(this._vrTrans,e,this._vrPos),a.vec3.copy(this._vrPos,e),this._vrEnable=!0}}()}),"osgSketchfab","FirstPersonManipulator"),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(15),a=i(31),o=i(337),s=i(10),u=i.n(s),l=i(139),c=r.a.osg,h=Math.PI/2,d=n.a.extend({defaults:{webVR:!1,indexManipulator:"fps"===i.i(a.a)().navigation?1:0,node:void 0,eyeCamera:c.vec3.create(),targetCamera:c.vec3.create(),minSpeed:.1,displayGizmo:!1,animationEye:c.vec3.create(),animationTarget:c.vec3.create(),animationDuration:1,enableCameraConstraints:!0,offset:0,angle:2*Math.PI,useCameraConstraints:!1,useZoomConstraints:!1,zoomIn:0,zoomOut:-1,usePitchConstraints:!1,left:-Math.PI,right:Math.PI,useYawConstraints:!1,up:.99*h,down:.99*-h,fov:45,nearFarRatio:.005},getName:function(){return"Camera"},setTargetAndEye:function(e,t,i){return this.set("animationTarget",e),this.set("animationEye",t),this.trigger("setTargetAndEye",i)},init:function(e){this._viewer=e.getViewer();var t=e.getModel().get("options"),r=t.camera,n=t.scene;this.set("enableCameraConstraints",i.i(a.a)().cameraConstraints),n.fov&&this.set("fov",n.fov),n.nearFarRatio&&this.set("nearFarRatio",n.nearFarRatio);var o=this._getUrlOptions();this.set("useCameraConstraints",o.useCameraConstraints||!!r.useCameraConstraints),this.set("useZoomConstraints",o.useZoomConstraints||!!r.useZoomConstraints),this.set("useYawConstraints",o.useYawConstraints||!!r.useYawConstraints),this.set("usePitchConstraints",o.usePitchConstraints||!!r.usePitchConstraints),this._initValue("zoomIn",o.zoomIn,r.zoomIn),this._initValue("zoomOut",o.zoomOut,r.zoomOut),this._initValue("left",o.left,r.left),this._initValue("right",o.right,r.right),this._initValue("up",o.up,r.up),this._initValue("down",o.down,r.down),this.yawLeftRightToAngleOffset(),this.on("change:zoomIn",this.checkOverLap.bind(this,"zoomOut","zoomIn","zoomOut")),this.on("change:zoomOut",this.checkOverLap.bind(this,"zoomOut","zoomIn","zoomIn")),this.on("change:up",this.checkOverLap.bind(this,"up","down","down")),this.on("change:down",this.checkOverLap.bind(this,"up","down","up")),this.on("change:offset",this.yawAngleOffsetToLeftRight.bind(this)),this.on("change:angle",this.yawAngleOffsetToLeftRight.bind(this))},_initValue:function(e,t,i){var r=void 0!==t?t:i;void 0!==r&&this.set(e,r)},initAfterFirstFrame:function(){var e=Math.floor(20*l.a.getModelBoxWithoutDisplacement().radius());-1===this.get("zoomOut")&&this.set("zoomOut",e),-1===this.get("zoomIn")&&this.set("zoomIn",e),this.set("maxZoom",e),this.trigger("uiReady")},_getUrlOptions:function(){var e={zoomIn:i.i(a.a)().orbitConstraintZoomIn,zoomOut:i.i(a.a)().orbitConstraintZoomOut,left:i.i(a.a)().orbitConstraintYawLeft,right:i.i(a.a)().orbitConstraintYawRight,up:i.i(a.a)().orbitConstraintPitchUp,down:i.i(a.a)().orbitConstraintPitchDown};return e.useZoomConstraints=void 0!==e.zoomOut||void 0!==e.zoomIn,e.useYawConstraints=void 0!==e.left||void 0!==e.right,e.usePitchConstraints=void 0!==e.up||void 0!==e.down,e.useCameraConstraints=e.useZoomConstraints||e.useYawConstraints||e.usePitchConstraints||i.i(a.a)().orbitConstraintPan,e},getCameraPosition:function(e,t){var i=this._viewer.getFeaturesManager();if(i&&(i.getCameraWithoutAutospin(e,t),0!==this.get("indexManipulator")&&this.get("node"))){var r=this.get("node").getMinimumBound(),n=c.vec3.dist(e,r.center()),a=Math.max(.1*r.radius(),n);c.vec3.sub(t,t,e),c.vec3.normalize(t,t),c.vec3.scale(t,t,a),c.vec3.add(t,e,t)}},saveCameraPosition:function(){this.getCameraPosition(this.get("eyeCamera"),this.get("targetCamera"))},validateEyeTarget:function(e,t){var i=c.vec3.dist(e,t);if(i<=1e-8)return!1;var r=this.get("node").getMinimumBound().radius();return i<=.001*r&&(c.vec3.sub(t,t,e),c.vec3.scale(t,t,.01*r/i),c.vec3.add(t,e,t)),!0},getJSON:function(){return{position:c.vec3.copy(c.vec3.create(),this.get("eyeCamera")),target:c.vec3.copy(c.vec3.create(),this.get("targetCamera")),useCameraConstraints:this.get("useCameraConstraints"),useZoomConstraints:this.get("useZoomConstraints"),zoomIn:this.get("zoomIn"),zoomOut:this.get("zoomOut"),usePitchConstraints:this.get("usePitchConstraints"),left:this.get("left"),right:this.get("right"),useYawConstraints:this.get("useYawConstraints"),up:this.get("up"),down:this.get("down")}},editorGetJSON:function(){var e=[],t=[];this.getCameraPosition(e,t);var i=this.getJSONFov(),r=this.getJSON();return r.position=e,r.target=t,r.fov=i.fov,r.nearFarRatio=i.nearFarRatio,r},validateJSON:function(e){var t=[];o.a.isArrayNumber(e.position,3)||t.push("Camera.editorSetJSON position must be a vec3"),o.a.isArrayNumber(e.target,3)||t.push("Camera.editorSetJSON target must be a vec3"),this.validateEyeTarget(e.position,e.target)||t.push("Camera.editorSetJSON position and target are too close");var i=this.limits();return o.a.isNumber(e.zoomIn,i.zoomIn.min,i.zoomIn.max)||t.push("Camera.editorSetJSON zoomIn must be a number in range "+this.range(i.zoomIn)),o.a.isNumber(e.zoomOut,i.zoomOut.min,i.zoomOut.max)||t.push("Camera.editorSetJSON zoomOut must be a number in range "+this.range(i.zoomOut)),o.a.isNumber(e.offset,i.offset.min,i.offset.max)||t.push("Camera.editorSetJSON yaw offset must be a number in range "+this.range(i.offset)),o.a.isNumber(e.angle,i.angle.min,i.angle.max)||t.push("Camera.editorSetJSON yaw angle must be a number in range "+this.range(i.angle)),o.a.isNumber(e.up,i.up.min,i.up.max)||t.push("Camera.editorSetJSON pitch up must be a number in range "+this.range(i.up)),o.a.isNumber(e.down,i.down.min,i.down.max)||t.push("Camera.editorSetJSON pitch down must be a number in range "+this.range(i.down)),o.a.isNumber(e.fov,i.fov.min,i.fov.max)||t.push("Fov.editorSetJSON fov must be a number in range "+this.range(i.fov)),o.a.isNumber(e.nearFarRatio,i.nearFarRatio.min,i.nearFarRatio.max)||t.push("Fov.editorSetJSON nearFarRatio must be a number in range "+this.range(i.nearFarRatio)),t.join("\n")},range:function(e){return"["+e.min+", "+e.max+"]"},limits:function(){return{zoomIn:{min:0,max:this.get("maxZoom")},zoomOut:{min:0,max:this.get("maxZoom")},offset:{min:0,max:2*Math.PI},angle:{min:0,max:2*Math.PI},up:{min:-h,max:h},down:{min:-h,max:h},fov:{min:1,max:179},nearFarRatio:{min:1e-4,max:.005}}},editorSetJSON:function(e){var t=this._viewer.getFeaturesManager(),i=this.validateJSON(e);return i||(t.getViewerOSGJS().getManipulator().setTargetAndEye(e.target,e.position),this.set("useCameraConstraints",e.useCameraConstraints),this.set("useZoomConstraints",e.useZoomConstraints),this.set("zoomIn",e.zoomIn),this.set("zoomOut",e.zoomOut),this.set("usePitchConstraints",e.usePitchConstraints),this.set("left",e.left),this.set("right",e.right),this.set("useYawConstraints",e.useYawConstraints),this.set("up",e.up),this.set("down",e.down),this.set("fov",e.fov),this.set("nearFarRatio",e.nearFarRatio),u.a.resolve(!0))},getJSONFov:function(){return{fov:this.get("fov"),nearFarRatio:this.get("nearFarRatio")}},yawAngleOffsetToLeftRight:function(){var e=this.get("offset"),t=this.get("angle"),i=e-t/2,r=0;t===2*Math.PI&&(r=-.001);var n=e+t/2+r;i>=Math.PI&&(i-=2*Math.PI),n>=Math.PI&&(n-=2*Math.PI),this.set("left",i),this.set("right",n)},yawLeftRightToAngleOffset:function(){var e=this.get("left"),t=this.get("right"),i=t-e;i<0&&(i+=2*Math.PI);var r=e+i/2;r<0&&(r+=2*Math.PI),this.set("angle",i),this.set("offset",r)},checkOverLap:function(e,t,i){var r=this.get(e),n=this.get(t);n>r&&this.set(i,i===e?n:r)}});t.a=d},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=r.a.osgGA,o=function(e){a.OrbitManipulator.call(this,e),this.setLimitPitchUp(.5*Math.PI*.99),this.setLimitPitchDown(.5*-Math.PI*.99)};n.createPrototypeObject(o,n.objectInherit(a.OrbitManipulator.prototype,{setEyePosition:function(){var e=n.vec3.create(),t=n.vec3.create(),i=n.vec3.create();return function(r,a){var o=this._rotation,s=this._target;if(n.vec3.sub(e,r,s),n.vec3.normalize(e,e),a){var u=n.vec3.dot(e,this._upz);if(Math.abs(u)>.99){var l=Math.sqrt((1-.9801)/(e[0]*e[0]+e[1]*e[1]));e[0]*=l,e[1]*=l,e[2]=.99*Math.sign(u)}}n.vec3.cross(t,e,this._upz),n.vec3.normalize(t,t),n.vec3.cross(i,t,e),n.vec3.normalize(i,i),o[0]=t[0],o[1]=e[0],o[2]=i[0],o[3]=0,o[4]=t[1],o[5]=e[1],o[6]=i[1],o[7]=0,o[8]=t[2],o[9]=e[2],o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this._distance=n.vec3.dist(s,r)}}()}),"osgSketchfab","OrbitManipulator"),t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(46),a=i(512),o=i(596),s=i(53),u=r.a.osg,l=r.a.osgAnimation,c=function(e,t){this._fpsDist=-1,this._manipulator=e,this._eyeEnd=u.vec3.create(),this._eyeDeltaLen=0,this._targetEnd=u.vec3.create(),this._targetDeltaLen=0,this._lastRatio=0,this._preventFlip=!1,a.a.call(this,t),this._finished=!0};u.createPrototypeObject(c,u.objectInherit(a.a.prototype,{setTargetAndEye:function(){var e=u.vec3.create();return function(t,i,r){if(this._preventFlip=r,this._finished){var n=this._manipulator.getManipulatorList()[o.a.FPS];this._fpsDist=n.getDistance()}u.vec3.copy(this._eyeEnd,i),this._manipulator.getEyePosition(e),this._eyeDeltaLen=u.vec3.len(u.vec3.sub(e,i,e)),u.vec3.copy(this._targetEnd,t),this._manipulator.getTarget(e),this._targetDeltaLen=u.vec3.len(u.vec3.sub(e,t,e)),this._lastRatio=0,this.reset()}}(),update:function(){var e=u.vec3.create(),t=u.vec3.create(),i=u.vec3.create(),r=u.vec3.create();return function(a,c){if(!0===this._finished)return!0;s.a.draw();var h=this._manipulator,d=h.getCurrentManipulatorIndex();d===o.a.FPS&&h.setManipulatorIndex(o.a.ORBIT);var p=c.getFrameStamp().getSimulationTime(),f=this.interpolate(p,a,c);f=l.easeOutQuart(f);var g=f-this._lastRatio;this._lastRatio=f;var m=this._manipulator;if(m.getEyePosition(e),m.getTarget(t),u.vec3.sub(i,this._targetEnd,t),u.vec3.normalize(i,i),u.vec3.add(r,t,u.vec3.scale(r,i,g*this._targetDeltaLen)),m.setTarget(r),u.vec3.sub(i,this._eyeEnd,e),u.vec3.normalize(i,i),u.vec3.add(r,e,u.vec3.scale(r,i,g*this._eyeDeltaLen)),m.setEyePosition(r,this._preventFlip),d===o.a.FPS){var v=h.getDistance();h.setManipulatorIndex(d),h.getCurrentManipulator().setDistance(this._finished?this._fpsDist:v)}return!0===this._finished&&n.a.resolveFirstCameraAnimation(),!0}}()}),"osgSketchfab","UpdateCallbackCameraAnimation"),t.a=c},function(e,t,i){"use strict";var r=i(5),n=i(53),a=r.a.osgUtil,o=function(e,t,i,r){this._switchManipulator=e,this._model=t,this._alphaInterpolator=new a.DelayInterpolator(1,.1),this._camera=i,this._gizmo=r,this._resetTimer()};o.prototype={update:function(e,t){if(!this._model.get("useCameraConstraints")||!this._model.get("enableCameraConstraints")||!this._model.get("useZoomConstraints"))return!0;var i=t.getFrameStamp(),r=i.getDeltaTime();this._alphaInterpolator.update(r);var a=this._switchManipulator.getOrbitManipulator();if(this._gizmo.getOrCreateStateSet().getUniform("uAlpha").getInternalArray()[0]=this._alphaInterpolator.getCurrent()[0],this._alphaInterpolator.isDone()){this._gizmo.setVisible(!1);var o=this._model.get("zoomIn");0===o&&(o=.001*this._switchManipulator.getHomeBound().radius()),a.getDistance()===o&&a.getDistance()!==this._lastDistance&&(this._gizmo.setVisible(!0),this._resetTimer(),this._gizmo.update(this._camera)),this._lastDistance=a.getDistance()}else this._gizmo.update(this._camera),n.a.draw();return!0},_resetTimer:function(){this._alphaInterpolator.getCurrent()[0]=.5,this._alphaInterpolator.setTarget(0)}},t.a=o},function(e,t,i){"use strict";var r=i(4),n=i(596),a=i(1e3),o=i(46),s=i(90),u=i(53),l=i(0),c=(i.n(l),i(5)),h=i(69),d=i(997),p=i(1001),f=i(998),g=c.a.osg,m=Math.PI/180,v=r.a.extend({initialize:function(){r.a.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:indexManipulator",this.onIndexManipulatorChanged,this),e.bind("change:node",this.onNodeChanged,this),e.bind("change:minSpeed",this.onNodeChanged,this),e.bind("change:webVR",this.setVR,this),e.bind("change:fov",this.onFov,this),e.bind("change:nearFarRatio",this.onNearFarRatio,this),e.bind("change:animationDuration",this.onDurationChanged,this),e.bind("setTargetAndEye",this.onTargetAndEyeChanged,this),e.bind("change:useCameraConstraints",this._onUseCamConstrainsToggle,this),e.bind("change:useZoomConstraints",this.refreshConstraints,this),e.bind("change:zoomIn",this.refreshConstraints,this),e.bind("change:zoomOut",this.refreshConstraints,this),e.bind("change:usePitchConstraints",this.refreshConstraints,this),e.bind("change:right",this.refreshConstraints,this),e.bind("change:useYawConstraints",this.refreshConstraints,this),e.bind("change:up",this.refreshConstraints,this),e.bind("change:down",this.refreshConstraints,this),e.bind("targetCameraChanged",this.focusOnTarget,this),e.bind("refreshConstraints",this.refreshConstraints,this),e.bind("saveZoomIn",this._saveZoom.bind(this,"zoomIn")),e.bind("saveZoomOut",this._saveZoom.bind(this,"zoomOut")),e.bind("change:displayGizmo",this._updateGizmoDisplay.bind(this)),this._switchManipulator=new n.a,this._viewer=this.options.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._viewerOSGJS.setupManipulator(this._switchManipulator),this._featureNode=new g.Node("Camera"),this._callbackCameraAnimation=new d.a(this._switchManipulator,e.get("animationDuration")),this._featureNode.addUpdateCallback(this._callbackCameraAnimation),this.model.bind("change:enableCameraConstraints",this.focusOnTarget,this),this.onIndexManipulatorChanged(),this._dolly=!1,this.onFov(),this.onNearFarRatio(),this._dolly=!0,this._initZoomHint(),o.a.getFirstCameraAnimation().then(function(){!e.get("webVR")&&this.model.get("useCameraConstraints")&&(this._updateGizmoDisplay(),this.focusOnTarget())}.bind(this))},setVR:function(){var e=this._viewerOSGJS.getManipulator(),t=this.model.get("webVR");e.setDelay(t?1:.15);var i=this._viewerOSGJS.getEventProxy();if(this._viewerOSGJS.requestContinuousUpdate(!0),t){this.lastMode=this.model.get("indexManipulator");var r=i.WebVR.getHmd(),a=!!r,o=!a;if(!o){var s=r.displayName.toLowerCase();-1===s.indexOf("cardboard")&&-1===s.indexOf("samsung")||(o=!0)}i.Hammer.setEnable(!1),i.WebVR.setEnable(a),i.DeviceOrientation.setEnable(!a),this.model.set("indexManipulator",n.a.FPS)}else i.DeviceOrientation.setEnable(!1),i.WebVR.setEnable(!1),i.Hammer.setEnable(!0),void 0!==this.lastMode&&this.model.set("indexManipulator",this.lastMode);var u=this._viewer.getFeatures();!u||u.webVR&&u.webVR.getModel().get("modeLauncher")||e.computeHomePosition()},onDurationChanged:function(){this._callbackCameraAnimation.setDuration(this.model.get("animationDuration"))},onTargetAndEyeChanged:function(e){this._callbackCameraAnimation.setTargetAndEye(this.model.get("animationTarget"),this.model.get("animationEye"),e)},onFov:function(){var e=this._viewer.getCamera(),t=e.getViewport(),i=t.width()/t.height();if(g.mat4.perspective(e.getProjectionMatrix(),this.model.get("fov")*m,i,1,1e3),this._dolly){var r=this.options.context.getViewer().getViewerOSGJS().getManipulator(),n=r.getCurrentManipulator();if(n){var a=n.getHomeBound();a&&r.setDistance(n.getHomeDistance(a))}}this.model.saveCameraPosition(),u.a.draw()},onNearFarRatio:function(){this.model.set("minSpeed",15*this.model.get("nearFarRatio")),u.a.draw()},getNode:function(){return this._featureNode},getWidgetNode:function(){return this._widgetNode||(this._widgetNode=new g.Node,this._widgetNode.setNodeMask(0)),this._widgetNode},onIndexManipulatorChanged:function(){this._switchManipulator.setManipulatorIndex(this.model.get("indexManipulator"))},onNodeChanged:function(){if(this._dolly){var e=this._switchManipulator;e.setNode(this.model.get("node"));var t=e.getOrbitManipulator(),i=this._switchManipulator.getHomeBound().radius();t.setMinSpeed(this.model.get("minSpeed")*i),this.refreshConstraints()}},focusOnTarget:function(){var e=g.vec3.create();return function(){this.model.get("enableCameraConstraints")&&(this._switchManipulator.getOrbitManipulator().getEyePosition(e),this._viewer.getFeaturesManager().focusOnTargetAndEye(this.model.get("targetCamera"),e,.3,!0)),this.refreshConstraints()}}(),_initZoomHint:function(){!this._zoomHintGizmo&&this.model.get("useCameraConstraints")&&this.model.get("useZoomConstraints")&&(this._zoomHintGizmo=new p.a(this._switchManipulator,this.model),this._featureNode.addChild(this._zoomHintGizmo),this._featureNode.addUpdateCallback(new f.a(this._switchManipulator,this.model,this._viewer.getCamera(),this._zoomHintGizmo)))},_initGizmo:function(){this._widgetNode=new g.Camera,this._widgetNode.setName("Camera - Constraints - Widgets"),this._featureNode.addChild(this._widgetNode),this._widgetNode.setNearFarRatio(5e-5),this._widgetNode.setNodeMask(h.a.NO_SHADOW),this._gizmo=new a.a(this._switchManipulator.getOrbitManipulator(),this.model),this._widgetNode.addChild(this._gizmo),this._widgetNode.addUpdateCallback(this)},_updateGizmoDisplay:function(){if(o.a.getFirstCameraAnimation().isFulfilled()){var e=this.model.get("displayGizmo");!this._gizmo&&e&&(this._initGizmo(),this.refreshConstraints(),i.i(s.a)()&&this._gizmo.setPivotSelected(this.model.get("useCameraConstraints"))),this._gizmo&&this._gizmo.setVisible(e)}},_onUseCamConstrainsToggle:function(){this._gizmo&&this._gizmo.setPivotSelected(this.model.get("useCameraConstraints")),this.refreshConstraints()},refreshConstraints:function(){o.a.getFirstCameraAnimation().isFulfilled()&&this.applyConstraints()},applyConstraints:function(){if(!this._hasHotSpots()){var e=this.model,t=i.i(l.clone)(e.defaults);e.get("enableCameraConstraints")&&this._applyModel(t);var r=this._switchManipulator.getOrbitManipulator();r.setLimitYawLeft(t.left),r.setLimitYawRight(t.right),r.setLimitPitchDown(t.down),r.setLimitPitchUp(t.up),-1===t.zoomOut&&(t.zoomOut=1/0),r.setLimitZoomOut(t.zoomOut);var n=!(t.useCameraConstraints&&e.get("enableCameraConstraints"));if(t.zoomIn>0)r.setLimitZoomIn(t.zoomIn);else{var a=this._switchManipulator.getHomeBound().radius();r.setLimitZoomIn(.001*a)}r.setAutoPushTarget(n),this._switchManipulator.setConstrainPan(!n),this._gizmo&&this._gizmo.updateConstraints(),u.a.draw()}},update:function(){if(this._hasHotSpots())return!1;var e=this._viewer.getOptions().widgetAPI,t=e&&e.getTabbedWidget().get();return this.model.get("displayGizmo")&&this._gizmo.update(this._viewer.getCamera()),"scene"===t?this._currentTab!==t&&this.model.trigger("TabEnter"):this._currentTab!==t&&(this.model.trigger("TabLeave"),this.model.set("displayGizmo",!1)),this._currentTab=t,!0},_hasHotSpots:function(){var e=this._viewer.getFeatures().hotspot.getModel(),t=e.get("hotspots").length;return t&&this.model.get("useCameraConstraints")&&(this.model.set("useCameraConstraints",!1),i.i(s.a)()&&this.model.trigger("ForceDisable")),t},_applyModel:function(e){var t=this.model;t.get("useCameraConstraints")&&(e.useCameraConstraints=!0,t.get("useZoomConstraints")&&(e.zoomIn=t.get("zoomIn"),e.zoomOut=t.get("zoomOut")),t.get("useYawConstraints")&&(e.left=t.get("left"),e.right=t.get("right")),t.get("usePitchConstraints")&&(e.up=t.get("up"),e.down=t.get("down")))},_saveZoom:function(e){var t=this.model.limits(),i=g.clamp(this._switchManipulator.getOrbitManipulator().getDistance(),t[e].min,t[e].max);this.model.set(e,i)}});t.a=v},function(e,t,i){"use strict";var r=i(5),n=i(69),a=i(129),o=i(641),s=i.n(o),u=i(640),l=i.n(u),c=i(86),h=i(92),d=i(53),p=i(601),f=i(462),g=r.a.osg,m=r.a.osgUtil,v=g.vec4.fromValues(.309375,.8640625,1,1),_=g.vec4.fromValues(1,1,0,1),b=g.vec3.fromValues(-1,0,0),x=g.vec3.fromValues(.05,.05,.05),S=2*Math.PI,y=new g.BlendFunc(g.BlendFunc.ONE,g.BlendFunc.ONE_MINUS_SRC_ALPHA),C=new g.Depth(g.Depth.DISABLE),T=g.StateAttribute.ON,M=function(e,t){return(e%t+t)%t},w=function(e,t){g.MatrixTransform.call(this),this.setName("Camera - Constraints Gizmo"),this._manipulator=e,this._model=t,this._circleGeom=m.GizmoGeometry.createCircleGeometry(128,1,2.015*Math.PI),this._arcGeom=m.GizmoGeometry.createCircleGeometry(64,1,1.015*Math.PI),this._pivotNode=new g.MatrixTransform,this._arcNode=new g.MatrixTransform,this._circleNode=new g.MatrixTransform,this._circleNode.setName("Camera - Constraints Gizmo - circleNode"),this._pivotNode.addChild(this._arcNode),this._pivotNode.addChild(this._circleNode),this._arcCenter=this._makeArc(this._arcGeom),this._arcLeft=this._makeArc(this._arcGeom,-Math.PI),this._arcRight=this._makeArc(this._arcGeom,Math.PI),this._arcHalfLeft=this._makeArc(this._arcGeom,.5*-Math.PI),this._arcHalfRight=this._makeArc(this._arcGeom,.5*Math.PI),this._circleCenter=this._makeCircle(),this._circleUp=this._makeCircle(),this._circleDown=this._makeCircle(),this._pivotNode.editMask=m.NodeGizmo.PICK_ARROW|m.NodeGizmo.PICK_PLANE,this.addChild(this._pivotNode),this.setGizmoStateset(v),this._makeCenter(),this._geomHandle=new g.createTexturedBoxGeometry(0,0,0,.02,.02,.02),this._handleCenter=this._makeHandle("handleCenter"),this._handleUp=this._makeHandle("handleUp"),this._handleDown=this._makeHandle("handleDown"),this._handleLeft=this._makeHandle("handleLeft"),this._handleRight=this._makeHandle("handleRight"),this._onMouseMoveHandler=this._onMouseMove.bind(this),this._onDragStartHandler=this._onDragStart.bind(this),this._onDragEndHandler=this._onDragEnd.bind(this),this._startCoord=g.vec2.create(),this._proxyMouse=this._model._viewer.getViewerOSGJS().getEventProxy().StandardMouseKeyboard,this.setVisible(!1)};w.prototype=g.objectInherit(g.MatrixTransform.prototype,{_makeArc:function(e,t){var i=new g.MatrixTransform,r=new g.MatrixTransform;return r.addChild(e),g.mat4.fromRotation(r.getMatrix(),.5*-Math.PI,g.vec3.fromValues(0,1,0)),t&&g.mat4.fromZRotation(i.getMatrix(),t),i.addChild(r),this._arcNode.addChild(i),i},_makeCircle:function(){var e=new g.MatrixTransform;return this._circleNode.addChild(e),e.addChild(this._circleGeom),e},_makeCenter:function(){this._centerNode=new g.MatrixTransform,this._pivotNode.addChild(this._centerNode);var e=this._centerNode.getOrCreateStateSet(),t=a.a.getOrCreateShader(s.a,l.a,"icon","CamConstraintsIcon","ICON");e.setAttributeAndModes(t),this._centerIcon=this._addIcon(this._centerNode,f.a.iconCamCenter,"center")},_makeHandle:function(e){var t=new g.MatrixTransform;t.setName(e),t.setNodeMask(-1),t.addChild(this._geomHandle),g.mat4.fromTranslation(t.getMatrix(),b);var i=t.getOrCreateStateSet();return this._setupColorAndAlpha(v,1,i),i.addUniform(g.Uniform.createFloat(1,"uUp")),i.addUniform(g.Uniform.createFloat(-1,"uDown")),this._circleNode.addChild(t),t},_getIconGeom:function(){return this._quadGeom||(this._quadGeom=g.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._quadGeom.setNodeMask(-1),this._quadGeom.setName("iconGeom")),this._quadGeom},_addIcon:function(e,t,i){var r=new g.MatrixTransform;r.addChild(this._getIconGeom()),r.setName(i+"Icon"),e.addChild(r);var n=h.default.instance.getOrCreateTexture(t),a=r.getOrCreateStateSet();return a.setTextureAttributeAndModes(0,n.texture,T),a.addUniform(g.Uniform.createInt(0,"uTextureIcon")),this._setupColorAndAlpha(v,1,a),r},_getGizmo:function(){var e=this._model._viewer.getFeaturesManager();return e?e.getNodeGizmo():null},setPivotSelected:function(e){this._getGizmo().attachToGeometry(e?this._centerNode:void 0)},setGizmoStateset:function(e){this._circleGeom.getOrCreateStateSet().removeAttribute("Program"),this._arcGeom.getOrCreateStateSet().removeAttribute("Program");var t=this._pivotNode.getOrCreateStateSet();t.setRenderBinDetails(c.a.EDITOR_GIZMO,"RenderBin"),t.setAttributeAndModes(a.a.getOrCreateShader(s.a,l.a,"gizmo","CamConstraintsGizmo"),T),t.setAttributeAndModes(y,T),t.setAttributeAndModes(C,T),this._setupColorAndAlpha(e,.4,t),this._setupColorAndAlpha(e,1,this._circleDown.getOrCreateStateSet()),this._setupColorAndAlpha(e,1,this._circleUp.getOrCreateStateSet()),this._setupColorAndAlpha(e,1,this._arcLeft.getOrCreateStateSet()),this._setupColorAndAlpha(e,1,this._arcRight.getOrCreateStateSet());var i=this._arcNode.getOrCreateStateSet();this._uUp=g.Uniform.createFloat(1,"uUp"),i.addUniform(this._uUp),this._uDown=g.Uniform.createFloat(-1,"uDown"),i.addUniform(this._uDown);var r=this._circleNode.getOrCreateStateSet();this._uHUp=g.Uniform.createFloat(1,"uUp"),r.addUniform(this._uHUp),r.addUniform(g.Uniform.createFloat(-1,"uDown"))},_setupColorAndAlpha:function(e,t,i){i.addUniform(g.Uniform.createFloat4(e,"uColor")),i.addUniform(g.Uniform.createFloat(t,"uAlpha"))},setVisible:function(e){this.setNodeMask(e?n.a.NO_SHADOW:0),e?this._registerEvents():this._unregisterEvents()},_registerEvents:function(){var e=this._model._viewer.getCanvas();e.addEventListener("mousemove",this._onMouseMoveHandler),e.addEventListener("mousedown",this._onDragStartHandler),e.addEventListener("mouseleave",this._onDragEndHandler),e.addEventListener("mouseup",this._onDragEndHandler)},_unregisterEvents:function(){var e=this._model._viewer.getCanvas();e.removeEventListener("mousemove",this._onMouseMoveHandler),e.removeEventListener("mousedown",this._onDragStartHandler),e.removeEventListener("mouseleave",this._onDragEndHandler),e.removeEventListener("mouseup",this._onDragEndHandler)},_onMouseMove:function(e){var t=i.i(p.a)(e);if(this._dragging)return void this._onDrag(t);var r=this._model._viewer.getFeaturesManager();if(r){var a=r.computeNearestIntersection2D(t[0],t[1],n.a.PICK,this);if(!a)return void this._onHover();var o=a._nodePath.length,s=a._nodePath[o-1];if(s===this._getIconGeom()||s===this._geomHandle){var u=a._nodePath[o-2];this._onHover(u)}}},_onDrag:function(){var e=g.vec3.create(),t=g.vec3.create();return function(i){var r=this._model._viewer.getCanvas(),n=r.height,a=this._model.get("usePitchConstraints"),o=this._model.get("useYawConstraints");if(a){var s=(this._startCoord[1]-i[1])/n*2;if(this._dragging===this._handleUp)return void this._model.set("up",Math.asin(g.clamp(this._startModel.up+s,-1,1)));if(this._dragging===this._handleDown)return void this._model.set("down",Math.asin(g.clamp(this._startModel.down+s,-1,1)))}if(o){this._getDragPosition(t,i),g.vec3.sub(e,t,this._model.get("targetCamera")),g.vec3.normalize(e,e);var u=this._startModel.a1,l=Math.atan2(e[0],e[1]),c=Math.sign(g.vec3.cross(e,this._startModel.baseDir,e)[2]),h=0,d=this._model.get("angle");if(this._dragging===this._handleLeft)return h=this._clampAngle(2*(l-u),-c,d),void this._model.set("angle",h);if(l>0&&(l-=S),this._dragging===this._handleRight)return h=this._clampAngle(2*(u-l),c,d),void this._model.set("angle",h);this._dragging===this._handleCenter&&this._model.set("offset",M(this._startModel.offset+(u-l),S))}}}(),_getDragPosition:function(){var e=g.vec3.create(),t=g.vec3.create(),i=g.vec3.create(),r=g.vec3.create(),n=g.vec3.create(),a=g.vec3.create();return function(o,s){var u=this._model._viewer.getFeaturesManager();u.canvasCoordToGL(s[0],s[1],r),r[2]=0,u.getWorldPositionFromScreenPoint(r,e),r[2]=1,u.getWorldPositionFromScreenPoint(r,t),g.vec3.sub(a,t,e),g.vec3.normalize(a,a),g.vec3.set(n,0,0,1);var l=-this._startModel.startPosition[2],c=g.vec3.dot(n,a);if(Math.abs(c)<.05){var h=this._startModel.startPosition;g.vec3.sub(n,h,this._model.get("targetCamera")),n[2]=0,g.vec3.normalize(n,n),g.vec3.set(i,h[0],h[1],0),i[2]=0,l=-g.vec3.dot(n,i),c=g.vec3.dot(n,a)}var d=-(g.vec3.dot(n,e)+l),p=d/c;return g.vec3.scaleAndAdd(o,e,a,p),o}}(),_clampAngle:function(e,t,i){return e=M(e,S),t<0?i<S-i?0:S:e},_onDragStart:function(){var e=g.vec3.create(),t=g.vec3.create(),r=g.mat4.create();return function(n){this._hovered&&this._hovered!==this._centerNode&&(this._dragging=this._hovered,i.i(p.a)(n,this._startCoord),this._handleCenter.getWorldMatrix(this,r),g.mat4.getTranslation(e,r),g.vec3.sub(t,e,this._model.get("targetCamera")),g.vec3.normalize(t,t),this._dragging.getWorldMatrix(this,r),g.mat4.getTranslation(e,r),this._startModel={up:Math.sin(this._model.get("up")),down:Math.sin(this._model.get("down")),offset:this._model.get("offset"),angle:this._model.get("angle"),startPosition:e,baseDir:t,a1:Math.atan2(t[0],t[1])},this._proxyMouse.mouseup(n),this._proxyMouse._enable=!1,this._savedEnableState=this._model.get("enableCameraConstraints"),this._model.set("enableCameraConstraints",!1))}}(),_onDragEnd:function(e){this._dragging&&(this._proxyMouse._enable=!0,this._dragging=void 0,this._onMouseMove(e),this._model.set("enableCameraConstraints",this._savedEnableState))},_onHover:function(e){if(e!==this._hovered){if(this._hovered&&(this._changeColor(this._hovered.getStateSet(),v),this._changeColor(this._circleUp.getStateSet(),v),this._changeColor(this._arcLeft.getStateSet(),v),this._changeColor(this._arcRight.getStateSet(),v),this._changeColor(this._circleDown.getStateSet(),v),d.a.draw()),!e)return void(this._hovered=void 0);switch(this._hovered=e,this._changeColor(e.getStateSet(),_),e){case this._handleCenter:this._changeColor(this._circleDown.getStateSet(),_),this._changeColor(this._circleUp.getStateSet(),_),this._changeColor(this._arcLeft.getStateSet(),_),this._changeColor(this._arcRight.getStateSet(),_);break;case this._handleUp:this._changeColor(this._circleUp.getStateSet(),_);break;case this._handleDown:this._changeColor(this._circleDown.getStateSet(),_);break;case this._handleLeft:this._changeColor(this._arcLeft.getStateSet(),_);break;case this._handleRight:this._changeColor(this._arcRight.getStateSet(),_)}d.a.draw()}},_changeColor:function(e,t){var i=e.getUniform("uColor").getInternalArray();g.vec4.copy(i,t)},update:function(){var e=g.vec4.create(),t=g.vec3.create(),i=g.vec3.create();return function(r){var n=r.getViewport(),a=n.width()/n.height(),o=g.mat4.getScale(e,r.getProjectionMatrix())[0],s=Math.max(1.2,a*(1.1+.2/o)*o);this._manipulator.getEyePosition(t);var u=this._model.get("targetCamera"),l=this._getGizmo();l.isEditing()?(g.mat4.getTranslation(u,l.getMatrix()),this._needsCameraUpdate=!0):this._needsCameraUpdate&&(this._needsCameraUpdate=!1,this._model.trigger("targetCameraChanged"));var c=g.vec3.dist(t,u)/s,h=this._pivotNode.getMatrix();g.vec3.set(i,c,c,c),g.mat4.fromTranslation(h,u),g.mat4.scale(h,h,i);var d=this._centerNode.getMatrix();g.mat4.invert(d,r.getViewMatrix()),g.mat4.setTranslation(d,g.vec3.ZERO),g.mat4.scale(d,d,x),this._pivotNode.dirtyBound(),this._centerNode.dirtyBound()}}(),updateConstraints:function(){var e=this._model.get("usePitchConstraints"),t=this._model.get("useYawConstraints"),i=e?this._model.get("up"):this._model.defaults.up,r=e?this._model.get("down"):this._model.defaults.down,n=.5*(i+r);this._updatePitchWidget(this._circleUp,i),this._updatePitchWidget(this._circleDown,r),this._updatePitchWidget(this._circleCenter,n);var a=t?this._model.get("offset"):this._model.defaults.offset,o=t?this._model.get("angle"):this._model.defaults.angle,s=.5*o;e||t?(this._circleNode.setNodeMask(-1),this._arcNode.setNodeMask(-1),g.mat4.fromZRotation(this._circleNode.getMatrix(),a-.5*Math.PI),g.mat4.fromZRotation(this._arcCenter.getMatrix(),a),g.mat4.fromZRotation(this._arcLeft.getMatrix(),a-s),g.mat4.fromZRotation(this._arcRight.getMatrix(),a+s),g.mat4.fromZRotation(this._arcHalfLeft.getMatrix(),a-.5*s),g.mat4.fromZRotation(this._arcHalfRight.getMatrix(),a+.5*s)):(this._circleNode.setNodeMask(0),this._arcNode.setNodeMask(0)),this._updateHandles(e,t,i,r,n,s),g.mat4.fromTranslation(this._pivotNode.getMatrix(),this._model.get("targetCamera")),this._uUp.getInternalArray()[0]=Math.sin(i),this._uDown.getInternalArray()[0]=Math.sin(r),this._uHUp.getInternalArray()[0]=-Math.cos(.5*o),this.dirtyBound(),this._pivotNode.dirtyBound(),this._circleNode.dirtyBound(),d.a.draw()},_updateHandles:function(e,t,i,r,n,a){if(e){this._handleUp.setNodeMask(-1),this._handleDown.setNodeMask(-1);var o=i-r;this._updateHandleWidget(this._handleUp,o<.07?n+.035:i,0),this._updateHandleWidget(this._handleDown,o<.07?n-.035:r,0)}else this._handleUp.setNodeMask(0),this._handleDown.setNodeMask(0);t?(this._handleRight.setNodeMask(-1),this._handleLeft.setNodeMask(-1),this._handleCenter.setNodeMask(-1),a=a<.035?.035:a,a=a>Math.PI-.035?Math.PI-.035:a,this._updateHandleWidget(this._handleRight,n,a),this._updateHandleWidget(this._handleLeft,n,-a),this._updateHandleWidget(this._handleCenter,n,0)):(this._handleRight.setNodeMask(0),this._handleLeft.setNodeMask(0),this._handleCenter.setNodeMask(0))},_updateHandleWidget:function(e,t,i){var r=e.getMatrix();g.mat4.fromZRotation(r,i),g.mat4.rotateY(r,r,t),g.mat4.translate(r,r,b),e.dirtyBound()},_updatePitchWidget:function(){var e=g.vec3.create(),t=g.vec3.create();return function(i,r){var n=i.getMatrix(),a=Math.sin(r),o=Math.cos(r);g.vec3.set(e,0,0,a),g.vec3.set(t,o,o,1),g.mat4.fromTranslation(n,e),g.mat4.scale(n,n,t)}}()}),t.a=w},function(e,t,i){"use strict";var r=i(5),n=i(69),a=i(129),o=i(641),s=i.n(o),u=i(640),l=i.n(u),c=i(86),h=i(92),d=i(462),p=i(389),f=r.a.osg,g=new f.BlendFunc(f.BlendFunc.ONE,f.BlendFunc.ONE_MINUS_SRC_ALPHA),m=new f.Depth(f.Depth.DISABLE),v=f.StateAttribute.ON,_=function(e,t){f.MatrixTransform.call(this),p.a.setGizmo(!0),this.setName("Camera - ZoomHint Gizmo"),this._manipulator=e.getOrbitManipulator(),this._switchManipulator=e,this._model=t,this._cameraNode=new f.Camera,this.addChild(this._cameraNode),this._cameraNode.setNearFarRatio(5e-5),this._makeZoomHint(),this.setVisible(!1)};_.prototype=f.objectInherit(f.MatrixTransform.prototype,{_makeZoomHint:function(){this._zoomHintNode=new f.MatrixTransform,this._cameraNode.addChild(this._zoomHintNode);var e=this.getOrCreateStateSet();e.setRenderBinDetails(c.a.EXTRA,"RenderBin"),e.setAttributeAndModes(a.a.getOrCreateShader(s.a,l.a,"gizmo","ZoomHintGizmo","ICON"),v),e.setAttributeAndModes(g,v),e.setAttributeAndModes(m,v),e.addUniform(f.Uniform.createFloat4(f.vec4.fromValues(1,1,1,1),"uColor")),e.addUniform(f.Uniform.createFloat(1,"uAlpha")),this._makeIcon(this._zoomHintNode,d.a.iconZoomHint,"zoomHint")},_getIconGeom:function(){return this._quadGeom||(this._quadGeom=f.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._quadGeom.setNodeMask(-1),this._quadGeom.setName("iconGeom")),this._quadGeom},_makeIcon:function(e,t,i){var r=new f.MatrixTransform;r.addChild(this._getIconGeom()),r.setName(i+"Icon"),e.addChild(r);var n=h.default.instance.getOrCreateTexture(t),a=r.getOrCreateStateSet();return a.setTextureAttributeAndModes(0,n.texture,v),a.addUniform(f.Uniform.createInt(0,"uTextureIcon")),r},setVisible:function(e){this.setNodeMask(e?n.a.NO_SHADOW:0)},update:function(){var e=f.vec4.create(),t=f.vec3.create(),i=f.vec3.create(),r=f.vec3.create();return function(n){var a=n.getViewport(),o=a.width()/a.height(),s=f.mat4.getScale(e,n.getProjectionMatrix())[0],u=Math.max(1.2,o*(1.1+.2/s)*s);this._manipulator.getEyePosition(t),this._manipulator.getTarget(r);var l=f.vec3.dist(t,r)/u/3;f.vec3.set(i,l,l,l);var c=this._zoomHintNode.getMatrix();f.mat4.invert(c,n.getViewMatrix()),f.mat4.setTranslation(c,r),f.mat4.scale(c,c,i)}}()}),t.a=_},,function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(2)),a=i.n(n),o=i(5),s=i(46),u=i(724),l=i(53),c=i(86),h=i(727),d=i(739),p=i(743),f=o.a.osg,g=o.a.osgAnimation,m=o.a.osgUtil,v=f.StateAttribute.OVERRIDE|f.StateAttribute.ON,_=function(){m.DisplayNormalVisitor.call(this),this._tangentStateSet.setRenderBinDetails(c.a.DEBUG,"RenderBin"),this._normalStateSet.setRenderBinDetails(c.a.DEBUG,"RenderBin")};f.createPrototypeObject(_,f.objectInherit(m.DisplayNormalVisitor.prototype,{apply:function(e,t){e instanceof f.Geometry&&e.getCullCallback()||m.DisplayNormalVisitor.prototype.apply.call(this,e,t)}}));var b=function(e){f.NodeVisitor.call(this),this._cullCallback=e?void 0:h.a.hideCullCallback};f.createPrototypeObject(b,f.objectInherit(f.NodeVisitor.prototype,{apply:function(e){e instanceof f.Geometry&&e._isBoneBox&&e.setCullCallback(this._cullCallback),this.traverse(e)}}));var x=function(){var e=m.DisplayGeometryVisitor.prototype.apply;m.DisplayGeometryVisitor.prototype.apply=function(t){if(!t._isBoneBox&&!t._isSkeleton){e.apply(this,arguments);var i=t._originalStateSet;void 0!==i&&t.getStateSet()&&i!==t.getStateSet()&&t.getStateSet().setRenderBinDetails(c.a.DEBUG,"RenderBin")}}},S=function(e){var t=i.i(r.invert)(c.a);e._graphRender.generateRenderBin=function(e,i){var r=i.className()+" ( "+i.getInstanceID()+" )";i.getName()&&(r+="\n"+i.getName());var n=i.getBinNumber();r+="\n"+t[n]||n,this._selectables.set(i.getInstanceID().toString(),i),e.addNode(i.getInstanceID(),{label:r,description:"",style:"fill: "+this.getColorFromClassName(i.className())+";stroke-width: 0px;"})}},y=function(){var e=g.UpdateMorph.prototype.updateWeights;g.UpdateMorph.prototype.updateWeights=function(){if(void 0!==this._debugActiveTarget){var t=parseInt(this._debugActiveTarget,0);if(-2===t){var i=this._weights;return void(i[0]=i[1]=i[2]=i[3]=0)}if(-1!==t)for(var r=this._targets,n=0,a=r.length;n<a;++n)r[n].value=n===t?1:0}return e.call(this)}},C=function(e,t){var i=function(){f.NodeVisitor.call(this,f.NodeVisitor.TRAVERSE_ALL_CHILDREN)};f.createPrototypeObject(i,f.objectInherit(f.NodeVisitor.prototype,{apply:function(t){for(var i=t.getUpdateCallbackList(),r=0,n=i.length;r<n;++r){var a=i[r];if(a instanceof g.UpdateMorph){var o={};o.___DEFAULT=-1,o["___NO MORPH"]=-2;for(var s=a._targetNames,u=0,c=s.length;u<c;++u)o[s[u]]=u;a._debugActiveTarget=-1;e.add(a,"_debugActiveTarget",o).name("Name "+a.getName()).onChange(l.a.draw)}}this.traverse(t)}}));var r=new i;t._rootModel.accept(r)},T=function(){h.a.DrawBones.prototype.apply=function(e){var t=e.getInstanceID();this._visitedNodes[t]||(this._visitedNodes[t]=!0,e instanceof g.Bone&&this.drawBone(e),this.traverse(e))}},M=function(e,t){this._fManager=e,this._rootModel=e._context.getScene().getRoot(),this._rootFeature=t,this._debugNormal=!1,this._debugTangent=!1,this._debugScale=.5,this._baseScale=.07*this._rootModel.getMinimumBound().radius(),this._normalVisitor=new _,this._normalVisitor.setScale(this._baseScale*this._debugScale),this._geoColorVisitor=new m.DisplayGeometryVisitor,this._geoColorVisitor._stCenter.setRenderBinDetails(c.a.DEBUG_2,"RenderBin"),x(),this._debugGeometry=!1,this._debugSkinning=!1,this._debugShadow=!1,this._useGizmo=!1,this._useSync=!1,this._protoUpdateWeights=g.UpdateMorph.prototype.updateWeights,this._protoComputeChannels=g.UpdateMatrixTransform.prototype.computeChannels,this._enableRig=!0,e.getViewerOSGJS().getState().getShaderGeneratorProxy().addShaderGenerator("skeleton",new d.a),this._drawBonesVisitor=new h.a.DrawBones([]),T(),this._showSkeleton=!1,this._showBoneBoxes=!1,this._graphVisitor=m.DisplayGraph.instance(),S(this._graphVisitor),this._debugGraphNode="Model",this._debugGraphRenderer=!1,this._displayGraph=!1;var i=this._fManager.getFeatures().camera.getModel();this._enabledConstraints=i.get("enableCameraConstraints"),this._showConstraintsWidget=!1,this._cbPick=this.onPickSelect.bind(this),this._fManager.getCanvas().addEventListener("dblclick",this.onTrianglePick.bind(this))};M.prototype={_getSaveAElement:function(){return this._aSave?this._aSave:(this._aSave=document.createElement("a"),document.body.appendChild(this._aSave),this._aSave.style.display="none",this._aSave)},_download:function(e,t){var i=this._fManager._context.getModel("uid").get("uid")+"_";i+=(new Date).toString().split(" ").splice(1,4).join("_").replace(/:/g,"_"),i+=".";var r=this._getSaveAElement();r.href=e,r.download=i+t,r.click()},_getCameraModel:function(){return this._fManager.getFeatures().camera.getModel()},onTakeScreenShot:function(){i.i(p.a)(2048,2048,this._fManager.getViewerWebGL()).toBlob(function(e){this._download(URL.createObjectURL(e),"png")}.bind(this),"png",1)},onStartMovieRecord:function(){var e=a()(".canvas"),t=e[0],i=t.captureStream(25),r={mimeType:"video/webm; codecs=vp9"};this._recorder=new window.MediaRecorder(i,r);var n=[],o=function(e){var t=window.URL.createObjectURL(e);this._download(t,"webm")}.bind(this);this._recorder.ondataavailable=function(e){e.data&&e.data.size>0&&n.push(e.data)},this._recorder.onstop=function(){o(new Blob(n,{type:"video/webm"}))}.bind(this),this._recorder.start()},onEndMovieRecord:function(){this._recorder&&this._recorder.stop()},onTrianglePick:function(e){if(!this._displayGraph){var t=void 0===e.offsetX?e.layerX:e.offsetX,i=void 0===e.offsetY?e.layerY:e.offsetY,r=this._fManager.computeNearestIntersection2D(t,i);if(r){window.hit=r;var n=r._nodePath[r._nodePath.length-1];console.log("Active hit : window.hit"),console.log("Name geometry : "+n.getName()),console.log("Vertex indices : "+r._i1+", "+r._i2+", "+r._i3),console.log("Unique id : "+n._uniqueID);var a={};a[r._i1]={},a[r._i2]={},a[r._i3]={};var o=n.getVertexAttributeList();for(var s in a){var u=a[s];s=parseInt(s);for(var l in o)for(var c=o[l],h=c.getItemSize(),d=c.getElements(),p=u[l]=[],f=0;f<h;++f)p[f]=d[s*h+f]}r.verts=a,console.log("\n")}}},onDebugScale:function(e){this._normalVisitor.setScale(this._baseScale*e),l.a.draw()},testCreateNormalVisitor:function(){this._normalVisitor._alreadyRun||(this._normalVisitor._alreadyRun=!0,this._normalVisitor.apply(this._rootModel))},onDebugNormal:function(e){this.testCreateNormalVisitor(),this._normalVisitor.setNormalVisibility(e),l.a.draw()},onDebugTangent:function(e){this.testCreateNormalVisitor(),this._normalVisitor.setTangentVisibility(e),l.a.draw()},onDebugGeometry:function(){this._debugGeometry?this._geoColorVisitor.setGeometryDebug(this._rootModel):this._debugSkinning?this._geoColorVisitor.setSkinningDebug(this._rootModel):this._geoColorVisitor.disableDebug(this._rootModel),l.a.draw()},onEnableCamConstraints:function(){var e=this._getCameraModel();e.set("enableCameraConstraints",!e.get("enableCameraConstraints"))},onShowConstraintsWidget:function(){var e=this._getCameraModel();e.set("displayGizmo",!e.get("displayGizmo")),e.trigger("refreshConstraints"),l.a.draw()},resetGraph:function(){this._fManager.getCanvas().removeEventListener("dblclick",this._cbPick),this._graphVisitor.reset()},onDisplayGraph:function(){this.resetGraph(),this._displayGraph&&(this._fManager.getCanvas().addEventListener("dblclick",this._cbPick),s.a.getModelDisplayed().then(this.createDebugGraph.bind(this)))},createDebugGraph:function(){var e;"Model"===this._debugGraphNode?e=this._rootModel:"Feature"===this._debugGraphNode&&(e=this._rootFeature),this._graphVisitor.setDisplayGraphRenderer(this._debugGraphRenderer),this._graphVisitor.createGraph(e),this._graphVisitor.setCallbackSelect(this.onNodeSelect.bind(this)),l.a.draw()},onDebugShadow:function(e){var t=this._fManager.getFeatures().lighting;if(t){t.getModel().set("forceShadowRedraw",e);for(var i=t.getModel().get("lights"),r=0,n=i.length;r<n;++r){var a=i[r];a.getShadowMap()&&(a.getShadowMap().setDebug(e),a.dirty())}l.a.draw()}},onPickSelect:function(e){var t=void 0===e.offsetX?e.layerX:e.offsetX,i=void 0===e.offsetY?e.layerY:e.offsetY,r=this._fManager.computeNearestIntersection2D(t,i);if(r){this._graphVisitor.selectNode(r._nodePath[r._nodePath.length-1]);var n=this._fManager.getFeatures().outline.getNode();n.setScene([r._nodePath]),n.showOutline(),this._graphVisitor.focusOnGraph()}},onNodeSelect:function(e){if(!e.getParents)return void this._fManager.getFeatures().materialUI.getModel().trigger("displayOutline",e);for(var t=[e];e.getParents().length>0;)t.unshift(e.getParents()[0]),e=e.getParents()[0];var i=f.vec3.create(),r=this._rootModel.getParents()[0].getWorldMatrices()[0],n=t[t.length-1].getMinimumBound().center();f.vec3.transformMat4(i,n,f.computeLocalToWorld(t)),f.vec3.transformMat4(i,i,r),this._fManager.focusOnTargetAndEye(i,void 0,1);var a=this._fManager.getFeatures().outline.getNode();a.setScene([t]),a.showOutline()},pasteCamera:function(){var e=f.vec3.create(),t=f.vec3.create();this._fManager.getCameraWithoutAutospin(e,t);var i=window.href+"&camera_eye="+e.join(",")+"&camera_target="+t.join(","),r=document.createTextNode(i);document.body.appendChild(r);var n=document.createRange();n.selectNode(r),window.getSelection().removeAllRanges(),window.getSelection().addRange(n),document.execCommand("copy"),document.body.removeChild(r)},onEnableRig:function(e){g.UpdateMatrixTransform.prototype.computeChannels=e?this._protoComputeChannels:function(){this._dirty=!0;var e=this._matrix;f.mat4.identity(e);for(var t=this._stackedTransforms,i=0,r=t.length;i<r;i++){var n=t[i];n.resetToDefaultValue(),n.applyToMatrix(e)}},l.a.draw()},onShowSkeleton:function(e){l.a.draw();var t=this._drawBonesVisitor;if(!e)return void t._geoStateSet.setAttributeAndModes(new f.Depth(f.Depth.NEVER),v);t._geoStateSet.setAttributeAndModes(new f.Depth(f.Depth.ALWAYS),v),t._alreadyRun||(t._alreadyRun=!0,this._rootModel.accept(t))},onShowBoneBoxes:function(e){this._rootModel.accept(new b(e)),l.a.draw()},onUseGizmo:function(e){this._gizmo||(this._gizmo=new u.a(this._fManager.getViewerOSGJS()),this._rootFeature.addChild(this._gizmo)),this._gizmo.attachToGeometry(null),this._gizmo._autoInsertMT=e,this._gizmo.setTraversalMask(e?1:0),l.a.draw()}};var w=function(e,t,i){var r=e.addFolder("Debug graph"),n={Model:"Model",Feature:"Feature",None:"None"};return i._graphNode=r.add(t,"_debugGraphNode",n).name("Root"),i._graphNode.onChange(t.onDisplayGraph.bind(t)),i._graphRenderer=r.add(t,"_debugGraphRenderer").name("Renderer"),i._graphRenderer.onChange(t.onDisplayGraph.bind(t)),i._displayGraph=r.add(t,"_displayGraph").name("Display graph"),i._displayGraph.onChange(t.onDisplayGraph.bind(t)),r.open(),r},A=function(e,t,i){var r=e.addFolder("Display vectors");return i._showNormal=r.add(t,"_debugNormal").name("Display normal"),i._showNormal.onChange(t.onDebugNormal.bind(t)),i._showTangent=r.add(t,"_debugTangent").name("Display tangent"),i._showTangent.onChange(t.onDebugTangent.bind(t)),i._vectorScale=r.add(t,"_debugScale").min(0).max(2).name("Scale vectors"),i._vectorScale.onChange(t.onDebugScale.bind(t)),r.open(),r},E=function(e,t,i){var r=e.addFolder("Animation");return i._useRig=r.add(t,"_enableRig").name("Use rig"),i._useRig.onChange(t.onEnableRig.bind(t)),y(),C(r,t),i._showSkeleton=r.add(t,"_showSkeleton").name("Show skeleton"),i._showSkeleton.onChange(t.onShowSkeleton.bind(t)),i._showBoxes=r.add(t,"_showBoneBoxes").name("Show boxes"),i._showBoxes.onChange(t.onShowBoneBoxes.bind(t)),i._showSkinning=r.add(t,"_debugSkinning").name("Display skinning"),i._showSkinning.onChange(function(e){e&&t._debugGeometry&&i._showGeometry.setValue(!1),t.onDebugGeometry()}),r.open(),r},P=function(e,t,i){var r=e.addFolder("Camera");return i._enableConstraints=r.add(t,"_enabledConstraints").name("Constraints"),i._enableConstraints.onChange(t.onEnableCamConstraints.bind(t)),i._showConstraintsWidget=r.add(t,"_showConstraintsWidget").name("Show widget"),i._showConstraintsWidget.onChange(t.onShowConstraintsWidget.bind(t)),r.open(),r},N=function(e,t,i){var r=e.addFolder("Misc");return i._showGeometry=r.add(t,"_debugGeometry").name("Display geometry"),i._showGeometry.onChange(function(e){e&&t._debugSkinning&&i._showSkinning.setValue(!1),t.onDebugGeometry(),i._showSkinning.updateDisplay()}),i._gizmo=r.add(t,"_useGizmo").name("Use gizmo"),i._gizmo.onChange(t.onUseGizmo.bind(t)),i._pasteCamera=r.add(t,"pasteCamera").name("Camera to url clipboard"),e.add(t,"_debugShadow").name("Debug Shadow").onChange(t.onDebugShadow.bind(t)),e.add({ScreenShot:t.onTakeScreenShot.bind(t)},"ScreenShot"),e.add({StartRec:t.onStartMovieRecord.bind(t)},"StartRec"),e.add({StopRec:t.onEndMovieRecord.bind(t)},"StopRec"),r.open(),r},F=function(e){var t=new window.dat.GUI;t.domElement.style.paddingTop="50px";var i=new M(this,e),r={};w(t,i,r),A(t,i,r),E(t,i,r),P(t,i,r),N(t,i,r)},R=function(e,t){var i=F.bind(e,t);a.a.getScript("https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.5/dat.gui.min.js").done(i)};t.a=R},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(89)),a=i(1005),o=i(1010),s={FeatureName:"environment",ModelType:a.a,ViewListType:[o.a]},u=n.a.create(s);u.prototype=i.i(r.extend)({},n.a.prototype,{getNode:function(){return this._views[0].getNodeEnvironment()}}),t.a=u},function(e,t,i){"use strict";var r=i(46),n=i(19),a=i.n(n),o=i(960),s=i(971),u=i(299),l=i(1011),c=i(337),h=i(768),d=i(31),p={uid:"2fa15e0b1cee45a5b02605a288934e1b",brightness:4.063},f=a.a.Model.extend({_trashbin:[],getRandomEnvironment:function(){var e=[];return this.environmentCollection.each(function(t){t.get("isDefault")&&-1===h.a.indexOf(t.get("uid"))&&e.push({uid:t.get("uid"),brightness:t.get("brightness")})}),0===e.length?p:e[Math.round(Math.random()*(e.length-1))]},defaults:function(){return{enable:i.i(u.a)(),uid:p.uid,exposure:p.brightness,backgroundExposure:1,rotation:0,shadowEnable:i.i(u.a)(),shadowBias:.005,lightIntensity:1,blur:.1}},init:function(e){this._context=e,this._viewer=e.getViewer();var t=e.getModel().get("options"),n=t.environment,a=!0;n&&(void 0!==n.enable&&this.set("enable",n.enable),void 0!==n.exposure&&this.set("exposure",n.exposure),void 0!==n.rotation&&this.set("rotation",n.rotation),void 0!==n.uid&&(this.set("uid",n.uid),a=!1),void 0!==n.blur&&this.set("blur",n.blur),void 0!==n.backgroundExposure&&this.set("backgroundExposure",n.backgroundExposure),void 0!==n.shadowEnable&&t.version>3&&i.i(d.a)().shadowEnv&&this.set("shadowEnable",n.shadowEnable),void 0!==n.shadowBias&&this.set("shadowBias",n.shadowBias),void 0!==n.lightIntensity&&this.set("lightIntensity",n.lightIntensity));var o=e.getModel().get("user").uid;if(this.environmentCollection=this.createCollection(o),this.environmentCollection.fetch({remove:!1}),a){var s=this.getRandomEnvironment();this.set("uid",s.uid),this.set("exposure",s.brightness)}this.checkEnvironmentValidity(),i.i(u.a)()&&r.a.getPolygon().then(this.updateEnvironmentConfig.bind(this))},updateEnvironmentConfig:function(){var e=this.getEnvironment();if(!e)return void this.checkEnvironmentValidity();var t=i.i(l.a)(this._viewer.getRootUserData().source)[e.get("uid")];t?(this.set("exposure",parseFloat(t.environmentExposure)),this.set("backgroundExposure",parseFloat(t.brightness)),this.set("rotation",parseFloat(t.rotation))):this.set("exposure",parseFloat(e.get("brightness"))||1);var r=this._viewer.getRootUserData();i.i(u.a)()&&"Tilt Brush"===r.authoringTool&&(this.set("uid","3e2ad3e1f1ea47679f045a7eb0e6af49"),this.set("exposure",.5))},getEnvironmentCollection:function(){return this.environmentCollection},checkEnvironmentValidity:function(){this.getEnvironment()||(this.set("uid",p.uid),this.set("exposure",p.brightness))},createCollection:function(e){return new o.a([],{filters:new s.a({userUID:e})})},getName:function(){return"Environment"},getEnvironment:function(){var e=this.get("uid");return this.environmentCollection.find(function(t){return t.get("uid")===e})},isShadowEnable:function(){return this.get("shadowEnable")},getJSON:function(){var e={};return e.uid=this.get("uid"),e.enable=this.get("enable"),e.exposure=this.get("exposure"),e.rotation=this.get("rotation"),e.blur=this.get("blur"),e.backgroundExposure=this.get("backgroundExposure"),e.shadowEnable=this.get("shadowEnable"),e.shadowBias=this.get("shadowBias"),e.lightIntensity=this.get("lightIntensity"),e},editorGetJSON:function(){return this.getJSON()},validateJSON:function(e){var t=[];return c.a.isBoolean(e.enable)||t.push("Environment.editorSetJSON enable must be a boolean"),c.a.isNumber(e.exposure,0,35)||t.push("Environment.editorSetJSON exposure must be a number [0,35]"),c.a.isNumber(e.backgroundExposure,0,2)||t.push("Environment.editorSetJSON backgroundExposure must be a number between [0,2]"),c.a.isNumber(e.rotation,0,360)||t.push("Environment.editorSetJSON rotation must be a number between [0,360]"),c.a.isNumber(e.blur,0,1)||t.push("Environment.editorSetJSON blur must be a number between [0,1]"),c.a.isString(e.uid)||t.push("Environment.editorSetJSON uid must be a string"),t.join("\n")},editorSetJSON:function(e){var t=this.validateJSON(e);return t||(this.set(e),this.set("exposure",e.exposure),t)}});t.a=f},function(e,t,i){"use strict";var r=i(5),n=i(129),a=i(842),o=i.n(a),s=i(841),u=i.n(s),l=i(735),c=i(1009),h=i(86),d=i(53),p=r.a.osg,f=function(){p.Node.call(this),this._geometry=p.createTexturedBoxGeometry(0,0,0,5,5,5),this._uniforms=i.i(c.a)(),this._show="NONE",this._bgEnv=null,this._bgFixed=null,this._texRatio=1,this._canvasWidth=1,this._canvasHidth=1,this.init(),this.hide()};p.createPrototypeNode(f,p.objectInherit(p.Node.prototype,{init:function(){var e=this._geometry,t=e.getOrCreateStateSet();t.setAttributeAndModes(new p.Depth(p.Depth.LEQUAL,1,1,!1),p.StateAttribute.PROTECTED),t.setRenderBinDetails(h.a.BACKGROUND,"RenderBin"),t.setAttributeAndModes(n.a.createShader(o.a,u.a,"environment-background","Environment")),t.setTextureAttributeAndModes(0,l.a.dummyTexture);var i=this._uniforms;for(var r in i)t.addUniform(i[r]);this.addChild(e)},getUniforms:function(){return this._uniforms},rescale:function(e,t){e&&(this._canvasWidth=e),t&&(this._canvasHeight=t);var i=this._canvasWidth/this._canvasHeight,r=this._uniforms.scale.getInternalArray();i>=this._texRatio?(r[0]=1,r[1]=this._texRatio/i):(r[0]=i/this._texRatio,r[1]=1)},getBackground:function(){return this._bgFixed},getEnvironment:function(){return this._bgEnv},hide:function(){this._show="NONE",this._update()},showColor:function(){this._show="COLOR",this._update()},showEnvironment:function(){this._show="ENV",this._update()},setEnvironment:function(e,t){this._bgEnv=e,void 0!==t&&this._uniforms.size.setFloat(t),this._update()},setExposure:function(e){this._uniforms.backgroundExposure.setFloat(e)},showAmbient:function(){this._show="AMBIENT",this._update()},showBackground:function(){this._show="FIXED",this._update()},setBackground:function(e){this._texRatio=e.getWidth()/e.getHeight(),this._bgFixed=e,this._update()},_update:function(){if(d.a.draw(),"ENV"!==this._show&&"AMBIENT"!==this._show)return void this._geometry.setNodeMask(0);this._geometry.setNodeMask(-1),this._uniforms.ambient.getInternalArray()[0]="AMBIENT"===this._show,this._bgEnv&&"ENV"===this._show&&this._geometry.getOrCreateStateSet().setTextureAttributeAndModes(0,this._bgEnv)}}),"osgSketchfab","Background"),t.a=f},function(e,t,i){"use strict";var r=i(5),n=i(31),a=i(436),o=i(732),s=i(731),u=i(1006),l=i(69),c=i(1008),h=i(728),d=i(464),p=i(46),f=i(53),g=r.a.osg,m=function(e){g.Node.call(this),this.getOrCreateStateSet(),this._viewer=e,this._isPBR=!1,this._textureSpecular=void 0,this._textureSpecularUnit=6,this._textureSpecularPBR=void 0,this._textureIntegrateBRDF=void 0,this._textureSpecularPBRUnit=6,this._textureIntegrateBRDFUnit=8,this._nodeBackground=new u.a,this._uniforms=i.i(h.a)(),this._adjustRotation=g.mat4.fromXRotation(g.mat4.create(),Math.PI/2),this._root=new g.MatrixTransform,g.mat4.multiply(this._root.getMatrix(),this._root.getMatrix(),this._adjustRotation),this._lightProbes=[],this._light=void 0,this._lightNode=void 0,this._shadow=void 0,this._lightDirection=void 0,this._lightNodeRoot=new g.MatrixTransform,this._lightNodeRoot.setName("Env Lighting - Light"),g.mat4.copy(this._lightNodeRoot.getMatrix(),this._root.getMatrix()),this._activatedShadow=i.i(d.a)()>12,this._enabledShadow=!1,this._shadowBias=5e-4,this._enabledShadowsNum=1,this._hasAnimation=!1,p.a.getHasAnimation().then(function(e){e&&(this._hasAnimation=e)}.bind(this)),this.addUpdateCallback(this),this._up=g.vec3.fromValues(0,0,1),this._eye=g.vec3.fromValues(0,0,0)};g.createPrototypeNode(m,g.objectInherit(g.Node.prototype,{getBackground:function(){return this._nodeBackground},getUniforms:function(){return this._uniforms},setBackgroundExposure:function(e){this._nodeBackground.setExposure(e),f.a.draw()},setBackgroundTexture:function(e,t){this._nodeBackground.setEnvironment(e,t)},createCameraNode:function(){var e={},t=this,i=function(){this.cull=function(i,r){g.mat4.getPerspective(e,t._mainCamera.getProjectionMatrix()),g.mat4.perspective(r.getCurrentProjectionMatrix(),e.fovy*Math.PI/180,e.aspectRatio,1,1e3),g.mat4.copy(r.getCurrentModelViewMatrix(),t._mainCamera.getViewMatrix()),g.mat4.setTranslation(r.getCurrentModelViewMatrix(),g.vec3.ZERO);var n=r.getCurrentModelViewMatrix();return g.mat4.multiply(t._uniforms.environmentTransform.getInternalArray(),n,t._root.getMatrix()),!0}},r=new g.Camera;return r.setName("Environment - Camera"),r.setCullCallback(new i),r.setReferenceFrame(g.Transform.ABSOLUTE_RF),r},init:function(e,t,i){this._mainCamera=t,this._rootLights=i,this._rootLights.addChild(this._lightNodeRoot);for(var r in this._uniforms)this.getStateSet().addUniform(this._uniforms[r]);var n=this.createCameraNode();n.setNodeMask(l.a.NO_PICK_NO_SHADOW),this.addChild(n),n.addChild(this._root),this._root.addChild(this._nodeBackground),this.updateTextureUnits();var a=this._viewer.getFeaturesManager().getFeatures().autospin;a&&!0===a.getModel().get("enable")&&(this._hasAnimation=!0),this.setShadowEnabled(this._enabledShadow)},enable:function(e,t,i){this.setTexturesStateSet(),this._shadowBias=t,this._lightIntensity=i,this.setShadowEnabled(e),f.a.draw()},setShadowEnabled:function(e){if(this._enabledShadow=e,this._enabledShadow){if(!this._lightProbes||0===this._lightProbes.length)return!1;this.activateLightsAndShadowsNumber(this._enabledShadowsNum)}else this.activateLightsAndShadowsNumber(0);return f.a.draw(),!0},removeTexturesStateSet:function(){var e=this.getStateSet();e&&(this._isPBR?(this._textureSpecularPBR&&e.removeTextureAttribute(this._textureSpecularPBRUnit,this._textureSpecularPBR.getTypeMember()),this._textureIntegrateBRDF&&e.removeTextureAttribute(this._textureIntegrateBRDFUnit,this._textureIntegrateBRDF.getTypeMember())):this._textureSpecular&&e.removeTextureAttribute(this._textureSpecularUnit,this._textureSpecular.getTypeMember()))},setTexturesStateSet:function(){var e=this.getStateSet();e&&(this._isPBR?(this._textureSpecularPBR&&e.setTextureAttributeAndModes(this._textureSpecularPBRUnit,this._textureSpecularPBR),this._textureIntegrateBRDF&&e.setTextureAttributeAndModes(this._textureIntegrateBRDFUnit,this._textureIntegrateBRDF)):this._textureSpecular&&e.setTextureAttributeAndModes(this._textureSpecularUnit,this._textureSpecular))},hide:function(){this.removeTexturesStateSet(),this.setShadowEnabled(!1)},disable:function(){this.hide()},computeLightColorIntensity:function(e,t){if(this._lightProbes&&0!==this._lightProbes.length){t*=this._uniforms.exposure.getInternalArray()[0]/this._defaultExposure;var i=this._lightProbes[0].color;g.vec3.normalize(i,i),g.vec3.scale(e.getDiffuse(),i,t)}},setDefaultExposure:function(e){this._defaultExposure=e},setExposure:function(e){this._uniforms.exposure.setFloat(e),this._light&&this.computeLightColorIntensity(this._light,this._lightIntensity)},setLightIntensity:function(e){this._lightIntensity=e,this._light&&(this.computeLightColorIntensity(this._light,e),f.a.draw())},setShadowBias:function(e){this._shadowBias=e,this._light&&(this._shadow.setBias(e),this._shadow.requestRedraw(),f.a.draw())},addLightAndShadow:function(){if(!this._lightProbes||0===this._lightProbes.length)return!1;if(!this._viewer.getFeaturesManager())return!1;var e,t,r,u,c;e=s.a.createLight("Environment",3,a.a.DIRECTION),t=e.shadowMap,r=e.light,u=e.node,u.addChild(e.lightSource),t.setEnabled(this._hasAnimation&&e.enableShadow),this._lightNodeRoot.addChild(u),this._lightNode=u,this._light=r,this._shadow=t,c=g.vec3.create(),this._lightDirection=c,t.setBias(this._shadowBias),this._rootLights.addShadowTechnique(t),g.vec3.copy(c,this._lightProbes[0].direction);var h=u.getMatrix();if(Math.abs(g.vec3.dot(this._up,c))>.999&&(this._up=1!==this._up[1]?g.vec3.set(0,1,0,this._up):g.vec3.set(1,0,0,this._up)),g.mat4.lookAtDirection(h,this._eye,c,this._up),g.mat4.invert(h,h),i.i(n.a)().debugEnvShadow){var d=g.createAxisGeometry(),p=new g.MatrixTransform;p.setMatrix(g.mat4.fromScaling(g.mat4.create(),[100,100,-500])),g.mat4.setTranslation(p.getMatrix(),[0,0,500]),p.addChild(d);var f=new o.a.createDirectionalGeometry(5);p.addChild(f),p.setNodeMask(l.a.NO_PICK_NO_SHADOW),u.addChild(p)}return this.computeLightColorIntensity(r,this._lightIntensity),!0},removeLightAndShadow:function(){if(!this._viewer.getFeaturesManager())return!1;this._light.setEnabled(!1);var e=this._lightNode;e.editMask=0,e.setNodeMask(0),this._lightNodeRoot.removeChild(e);var t=this._rootLights,i=this._shadow;return t.removeShadowTechnique(i),this._lightNode=void 0,this._light=void 0,this._shadow=void 0,this._lightDirection=void 0,!0},setLightsAndShadowsNumber:function(){this._enabledShadow&&this._lightProbes.length>=this._enabledShadowsNum?this.activateLightsAndShadowsNumber(this._enabledShadowsNum):this.activateLightsAndShadowsNumber(0)},activateLightsAndShadowsNumber:function(e){return!!this._activatedShadow&&(this._light&&this.removeLightAndShadow(),0===e||!!this.addLightAndShadow()&&(this._shadow.requestRedraw(),g.mat4.copy(this._lightNodeRoot.getMatrix(),this._root.getMatrix()),f.a.draw(),!0))},update:function(){if(!this._light)return!0;var e=this._viewer.getFeaturesManager();return!e||(e.getShadowForcedUpdate()&&this._shadow&&this._shadow.requestRedraw(),!0)},updateRotation:function(e){g.mat4.fromZRotation(this._root.getMatrix(),-e),g.mat4.multiply(this._root.getMatrix(),this._root.getMatrix(),this._adjustRotation),g.mat4.copy(this._lightNodeRoot.getMatrix(),this._root.getMatrix()),this._shadow&&this._shadow.requestRedraw()},setDiffuseSPH:function(e){for(var t=this.getUniforms().diffuseSPH.getInternalArray(),i=1/(2*Math.sqrt(Math.PI)),r=-.5*Math.sqrt(3/Math.PI),n=-r,a=r,o=.5*Math.sqrt(15/Math.PI),s=-o,u=.25*Math.sqrt(5/Math.PI),l=s,c=.25*Math.sqrt(15/Math.PI),h=[i,i,i,r,r,r,n,n,n,a,a,a,o,o,o,s,s,s,u,u,u,l,l,l,c,c,c],d=0;d<27;++d)t[d]=e[d]*h[d]},setSpecularTexture:function(e){this._textureSpecular=new c.a(e,"Specular"),this.updateTextureUnits(),this.getUniforms().textureSpecular.setInt(this._textureSpecularUnit)},setSpecularPBRTexture:function(e,t){this._textureSpecularPBR=new c.a(e,"SpecularPBR");var i="TextureCubeMap"===e.className();this._textureSpecularPBR.setIsCubemap(i),this._textureSpecularPBR.updateLodRange(t),this.updateTextureUnits(),this.getUniforms().textureSpecularPBR.setInt(this._textureSpecularPBRUnit)},setLightProbes:function(e){this._light&&this.activateLightsAndShadowsNumber(0),this._lightProbes=e,e&&0!==e.length&&this.setLightsAndShadowsNumber()},setIntegrateBRDFTexture:function(e){this._textureIntegrateBRDF=new c.a(e,"IntegrateBRDF"),this.updateTextureUnits(),this.getUniforms().textureIntegrateBRDF.setInt(this._textureIntegrateBRDFUnit)},updateTextureUnits:function(){this.setTexturesStateSet()},setIsPBR:function(e){this._isPBR=e}}),"osgSketchfab","Environment"),t.a=m},function(e,t,i){"use strict";var r=i(5),n=i(728),a=r.a.osg,o=function(e,t){this._texture=e,this._channel=t||"Specular",this._isCubemap=!1,this._commonUniforms=i.i(n.a)()};o.uniforms={},a.createPrototypeStateAttribute(o,a.objectInherit(a.Texture.prototype,{attributeType:"Texture",channelType:["Specular","SpecularPBR","IntegrateBRDF"],getUniformName:function(e){return"uTextureEnvironment"+this.getChannel()+e},getOrCreateUniforms:function(){var e=o.uniforms,t=this.getChannel();if(e[t])return e[t];var i=this._texture;return e[t]={size:a.Uniform.createFloat2([i.getWidth(),i.getHeight()],this.getUniformName("TextureSize"))},e[t]},setIsCubemap:function(e){this._isCubemap=e},getIsCubemap:function(){return this._isCubemap},getCommonUniforms:function(){return this._commonUniforms},getTexture:function(){return this._texture},getChannel:function(){return this._channel},cloneType:function(){return new o(new a.Texture)},getHash:function(){return"osgSketchfabTextureEnvironment"+this.getChannel()},updateLodRange:function(e){var t=this.getOrCreateUniforms(),i=Math.log(this._texture.getWidth())/Math.LN2,r=i-Math.log(e)/Math.LN2;if(t.lodRange){var n=t.lodRange.getInternalArray();n[0]=i,n[1]=r}else t.lodRange=a.Uniform.createFloat2([i,r],this.getUniformName("LodRange"))},apply:function(e,t){var i=this._texture;void 0!==i&&i.apply(e);var r=this.getOrCreateUniforms(t),n=r.size.getInternalArray();n[0]=i.getWidth(),n[1]=i.getHeight()}}),"osgSketchfab","TextureEnvironment"),t.a=o},function(e,t,i){"use strict";var r,n=i(5),a=n.a.osg,o=function(){return r||(r={ambient:a.Uniform.createInt1(0,"uAmbient"),texture0:a.Uniform.createInt1(0,"uTexture0"),backgroundExposure:a.Uniform.createFloat(1,"uBackgroundExposure"),size:a.Uniform.createFloat(1,"uSize"),color:a.Uniform.createFloat3(a.vec3.fromValues(0,0,1),"uBackgroundColor"),scale:a.Uniform.createFloat2(a.vec2.fromValues(1,1),"uFixedScale")})};t.a=o},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(70)),a=i.n(n),o=i(10),s=i.n(o),u=i(5),l=i(4),c=i(46),h=i(1007),d=i(92),p=i(537),f=i(346),g=i(31),m=i(53),v=u.a.osg,_=l.a.extend({initialize:function(){l.a.prototype.initialize.apply(this,arguments),this._viewer=this.options.context.getViewer(),this._nodeEnvironment=new h.a(this._viewer),this._nodeEnvironment.setName("Feature - Environment"),this._backgroundLoaded={},this.model.bind("change:enable",this.onEnableChanged,this),this.model.bind("change:exposure",this.onExposureChanged,this),this.model.bind("change:backgroundExposure",this.onExposureChanged,this),this.model.bind("change:rotation",this.onRotationChanged,this),this.model.bind("change:uid",this.onUIDChanged,this),this.model.bind("updateBackground",this.onBackgroundEnableChanged,this),this.model.bind("change:blur",this.onBlurChanged,this),f.a.bind("change:mask",this.onEnvironmentChanged,this),this.model.bind("change",m.a.draw),this._resourceDefer=s.a.defer(),this.options.context.getScene().addResourcePromise(this._resourceDefer.promise),this.model.bind("change:shadowEnable",this.onShadowEnable,this),this.model.bind("change:shadowBias",this.onShadowBiasChanged,this),this.model.bind("change:lightIntensity",this.onLightIntensityChanged,this),c.a.getMaterial().then(function(){this.initEnvironment(),this.initRotateEnvironment()}.bind(this))},getBackgroundEnableType:function(){var e=this._viewer.getFeatures().background;return e?e.getModel().getEnableType():"none"},isBackgroundEnvironment:function(){return"environment"===this.getBackgroundEnableType()},initEnvironment:function(){this.onRotationChanged(),this.onExposureChanged(),this.onEnableChanged()},initRotateEnvironment:function(){if(this._viewer.getViewerOSGJS()){this._mouseKeyboard=this._viewer.getViewerOSGJS().getEventProxy().StandardMouseKeyboard,this._rotEnv=!1,this.mx_=0;var e=this.options.context.getViewer().getCanvas();e.addEventListener("mousedown",this.onMouseDown.bind(this)),e.addEventListener("mouseup",this.onMouseUp.bind(this)),e.addEventListener("mouseout",this.onMouseUp.bind(this)),e.addEventListener("mousemove",this.onMouseMove.bind(this)),c.a.getModelDisplayed().then(this.initOnTriplePan.bind(this))}},initOnTriplePan:function(){var e=this._viewer.getViewerOSGJS().getEventProxy();if(e.Hammer&&e.Hammer._hammer){var t=e.Hammer._hammer,i=t.handlers.panstart,r=t.handlers.panmove,n=t.handlers.panend,a=t.handlers.pinchend;if(1===i.length&&1===r.length&&1===n.length&&1===a.length){var o=i[0],s=r[0],u=n[0],l=a[0];t.off("panstart",o),t.off("panmove",s),t.off("panmove",u),this._evProxy={altKey:!0,shiftKey:!1,ctrlKey:!1},t.on("panstart",this.onPanStart.bind(this,o)),t.on("panmove",this.onPanMove.bind(this,s,l)),t.on("panend",this.onPanEnd.bind(this,u))}}},onPanStart:function(e,t){if(t.pointers.length<3)return e(t);this._evProxy.pageX=t.center.x,this.onMouseDown(this._evProxy)},onPanMove:function(e,t,i){if(i.pointers.length<3)return e(i);this._evProxy.pageX=i.center.x,this._rotEnv||(this.onMouseDown(this._evProxy),t(i)),this.onMouseMove(this._evProxy)},onPanEnd:function(e,t){this.onMouseUp(),e(t)},onMouseDown:function(e){e.altKey&&(this._rotEnv=!0,this._mouseKeyboard.setEnable(!1),this.mx_=e.pageX)},onMouseMove:function(){var e=v.mat4.create(),t=v.mat4.create();return function(i){if(this._rotEnv){var r=!i.ctrlKey,n=!i.shiftKey;m.a.draw();var a=(i.pageX-this.mx_)/100;if(this.mx_=i.pageX,r){var o=(this.model.get("rotation")+a)%(2*Math.PI);this.model.set("rotation",o<0?o+2*Math.PI:o)}if(n){var s=this.options.context,u=s.getFeatures().lighting;if(!u)return;var l=s.getScene().getRoot().getMinimumBound().center();v.mat4.fromZRotation(e,-a%(2*Math.PI)),v.vec3.negate(l,l),v.mat4.multiply(e,e,v.mat4.fromTranslation(t,l)),v.vec3.negate(l,l),v.mat4.multiply(e,v.mat4.fromTranslation(t,l),e);for(var c=u.getModel().get("lights"),h=0,d=c.length;h<d;++h){var p=c[h];if(!p.isAttachedToCamera()){var f=p.get("matrix");v.mat4.multiply(f,e,f),p.dirty()}}}}}}(),onMouseUp:function(){this._rotEnv=!1},onUIDChanged:function(){this.model.updateEnvironmentConfig(),this.onEnvironmentChanged()},getNodeEnvironment:function(){return this._nodeEnvironment},getResourceManager:function(){return this._resourceManager||d.default.instance},onEnableChanged:function(){this.model.get("enable")?this._nodeEnvironment.enable(this.model.get("shadowEnable"),this.model.get("shadowBias"),this.model.get("lightIntensity")):this._nodeEnvironment.disable(),this.onEnvironmentChanged()},onShadowEnable:function(){var e=this.getEnvironment().get("lights");!this.model.get("shadowEnable")||void 0!==e&&0!==e.length||this.model.set("shadowEnable",!1),this._nodeEnvironment.setShadowEnabled(this.model.get("shadowEnable"))},onShadowBiasChanged:function(){this._nodeEnvironment.setShadowBias(this.model.get("shadowBias"))},onLightIntensityChanged:function(){this._nodeEnvironment.setLightIntensity(this.model.get("lightIntensity"))},onExposureChanged:function(){this._nodeEnvironment.setExposure(this.model.get("exposure")),this._nodeEnvironment.setBackgroundExposure(this.model.get("backgroundExposure"))},onRotationChanged:function(){this._nodeEnvironment.updateRotation(this.model.get("rotation"))},onBlurChanged:function(){this.abortLastDownloadEnv(),this.isBackgroundEnvironment()&&this.setBackgroundTexture()},onBackgroundEnableChanged:function(){var e=this.getBackgroundEnableType();"environment"===e?this.setBackgroundTexture():"ambient"===e&&this.setBackgroundAmbient()},resolvePreload:function(){this._resourceDefer&&(this._resourceDefer.resolve(),this._resourceDefer=void 0)},onEnvironmentChanged:function(){var e=this.getEnvironment();if(!e||!this.model.get("enable"))return void this.resolvePreload();this._onlyLowRes=!0,this.setEnvironment(e).then(function(){var t=e.get("uid")===this.model.get("uid");i.i(g.a)().preload&&t||this.resolvePreload(),t&&(this._onlyLowRes=!1,this.setEnvironment(e).finally(this.resolvePreload.bind(this)))}.bind(this))},getEnvironment:function(){return this.model.getEnvironment()},getName:function(){return"Environment3D"},abortLastDownloadEnv:function(){for(var e=this.model.get("uid"),t=this.model.get("blur"),i=this.getResourceManager()._resourceLoader._processing,r=0,n=i.length;r<n;++r){var a=i[r],o=a.getXHR();o&&(void 0!==a._envUID&&a._envUID!==e&&o.abort(),void 0!==a._envBlur&&a._envBlur!==t&&o.abort())}},setEnvironment:function(e){this.abortLastDownloadEnv();var t=[];if(f.a.get("mask")&f.a.LIT){var i=f.a.get("mask")&f.a.PBR;this._nodeEnvironment.setIsPBR(i),this._nodeEnvironment.setDiffuseSPH(e.get("diffuseSPH"));var r=e.get("lights");this._nodeEnvironment.setLightProbes(r,e.id),this.model.get("shadowEnable")&&this.model.set("shadowEnable",void 0!==r&&r.length>0),this._nodeEnvironment.setDefaultExposure(e.get("brightness")),i?this.setEnvironmentPBR(e,t):this.setEnvironmentOld(e,t)}return this.isBackgroundEnvironment()&&t.push(this.setBackgroundTexture()),0===t.length&&t.push(s.a.resolve()),this.wrapPromises(t)},setEnvironmentPBR:function(e,t){var n=this._nodeEnvironment,o=e.get("textures"),s=!1;v.WebGLCaps.instance().getWebGLExtension("EXT_shader_texture_lod")&&(s=!0),i.i(g.a)().panorama&&(s=!1);var u=i.i(r.find)(o,{encoding:"luv",type:"specular_ue4",format:s?"cubemap":"panorama"}),l=this.getImageRes(u),c={cubemap:s,panoramaLUV:!s,cubemapLUV:s,size:l.width,minFilter:s?v.Texture.LINEAR_MIPMAP_LINEAR:v.Texture.LINEAR,magFilter:v.Texture.LINEAR,wrapS:v.Texture.CLAMP_TO_EDGE,wrapT:v.Texture.CLAMP_TO_EDGE,transferToGPU:!0},h=this.getResourceManager().getOrCreateTexture(l.file,c);this.markLastXHR(this.model.get("uid")),h.texture.setFlipY(!s);var d=this.getPromiseTexture(h);if(d.then(n.setSpecularPBRTexture.bind(n,h.texture,u.limitSize)),t.push(d),!a.a.any){var p=i.i(r.find)(o,{type:"brdf_ue4"});c={integrateBRDFLUV:!0,minFilter:v.Texture.NEAREST,magFilter:v.Texture.NEAREST,wrapS:v.Texture.CLAMP_TO_EDGE,wrapT:v.Texture.CLAMP_TO_EDGE,transferToGPU:!0};var f=this.getResourceManager().getOrCreateTexture(this.getImageRes(p).file,c);this.markLastXHR(this.model.get("uid")),f.texture.setFlipY(!1);var m=this.getPromiseTexture(f);m.then(n.setIntegrateBRDFTexture.bind(n,f.texture)),t.push(m)}},getBackgroundResource:function(e,t,n){var a,o=i.i(r.find)(e,{encoding:"luv",type:"background",format:"cubemap"});return a=void 0!==n?this.getClosestBlur(o,n):this.getImageRes(o,512),t.cubemap=!0,t.cubemapLUV=!0,t.size=a.width,t.minFilter=v.Texture.LINEAR,t.magFilter=v.Texture.LINEAR,t.wrapS=v.Texture.CLAMP_TO_EDGE,t.wrapT=v.Texture.CLAMP_TO_EDGE,t.transferToGPU=!0,a},setEnvironmentOld:function(e,t){var i=this._nodeEnvironment,r={},n=this.getBackgroundResource(e.get("textures"),r),a=this.getResourceManager().getOrCreateTexture(n.file,r);this.markLastXHR(this.model.get("uid"));var o=this.getPromiseTexture(a);o.then(i.setSpecularTexture.bind(i,a.texture)),t.push(o)},setBackgroundTexture:function(){var e=this.getEnvironment();if(!e)return s.a.reject();var t={},i=this.getBackgroundResource(e.get("textures"),t,this.model.get("blur")),r=this._backgroundLoaded;if(this.getRequestLowRes()){if(r[i.file])return r[i.file];i=this.getBackgroundResource(e.get("textures"),t,1)}var n=this._nodeEnvironment,a=this.getResourceManager().getOrCreateTexture(i.file,t);this.markLastXHR(this.model.get("uid"),this.model.get("blur"));var o=this.getPromiseTexture(a);return o.then(function(){n.setBackgroundTexture(a.texture,i.width),r[i.file]=a}),c.a.getHighResLoaded().then(this._viewer.setFakeSecondaryProgress.bind(this._viewer,o,0)),o},setBackgroundAmbient:function(){var e=this.getEnvironment();return e?(this._nodeEnvironment.setDiffuseSPH(e.get("diffuseSPH")),s.a.resolve()):s.a.reject()},markLastXHR:function(e,t){var i=this.getResourceManager()._resourceLoader._processing;if(i.length>0){var r=i[i.length-1];r._envUID=e,void 0===t||this.getRequestLowRes()||(r._envBlur=t)}},wrapPromises:function(e){var t=s.a.settle(e);return c.a.getHighResLoaded().then(this._viewer.setFakeSecondaryProgress.bind(this._viewer,t,0)),t},getPromiseTexture:function(e){return this._onlyLowRes||i.i(g.a)().preload?e.promise:s.a.all([e.promise,c.a.getFirstCameraAnimation()])},getRequestLowRes:function(){return this._onlyLowRes&&!i.i(g.a)().preload},getImageRes:function(e,t){var i=new p.a(e);if(this.getRequestLowRes())return i.findImageSmallest();var r=void 0!==t?t:1/0;return i.findImageNearestPowerOfTwoUpToResolution(r,r)},getClosestBlur:function(e,t){for(var i=e.images,r=0,n=1/0,a=0,o=i.length;a<o;++a){var s=Math.abs(i[a].blur-t);s<n&&(r=a,n=s)}return i[r]}});t.a=_},function(e,t,i){"use strict";var r={"2e9c3708feb74137b0436f946b8b66b8":{rotation:1.6,environmentExposure:4.27,brightness:1.12},"5efd61a025f6400886ab975e2ac3d9c5":{rotation:3.15,environmentExposure:1.19,brightness:1.21},"80fba9759ab94307a782f38d359b8ea8":{rotation:1.57,environmentExposure:14.19,brightness:1},"268447ca0a954f44b06d1387863d114e":{rotation:6.25,environmentExposure:2.1,brightness:1},"003c1543cd754a19a0e14bc89726ccf5":{rotation:1.82,environmentExposure:1,brightness:1},"3e2ad3e1f1ea47679f045a7eb0e6af49":{rotation:.3,environmentExposure:.59,brightness:1},"2fa15e0b1cee45a5b02605a288934e1b ":{rotation:.68,environmentExposure:4,brightness:1},"9190e8da70694ef3b9d1d0c01541917e":{rotation:3.24,environmentExposure:2.5,brightness:.57},"749a0594343e4ff9a2875cb411d0ad1a":{rotation:4.73,environmentExposure:.5,brightness:1},f2dabeb04674446696486eea67028bd8:{rotation:4.71,environmentExposure:.76,brightness:1.5},df380da788ee444885722735039b0c09:{rotation:.27,environmentExposure:1.4,brightness:1.46},"16cdcddf277d423d99094f8db0c731e9":{rotation:3.73,environmentExposure:2.4,brightness:.53},c281dff366844cbc8b33179337037f42:{rotation:3.64,environmentExposure:7,brightness:.53}},n={substancepainter:r},a={},o=function(e){return n[e]||a};t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(10),a=i.n(n),o=i(46),s=i(86),u=i(156),l=i(346),c=i(603),h=i(31),d=i(388),p=i(1106),f=r.a.osg,g=r.a.osgAnimation,m=a.a.defer(),v=window.sketchfabViewerStats={promiseReady:m.promise,materialCountBefore:0,materialCountAfter:0,nodeCountBefore:0,nodeCountAfter:0,matrixTransformCountBefore:0,matrixTransformCountAfter:0,geometryCountBefore:0,geometryCountAfter:0,boneCountBefore:0,boneCountAfter:0,skeletonCountBefore:0,skeletonCountAfter:0,morphGeometryCountBefore:0,morphGeometryCountAfter:0,rigGeometryCountBefore:0,rigGeometryCountAfter:0},_={splitLimit:65535,limitMergePerMaterial:100,isTransparent:!1,isWireframe:!1,protectedGeometries:{},channelTargetNames:{},bakedGeometriesFromID:{},parentCountFromID:{},childrenCountFromID:{},multiParentPathFromGeometryID:{},animatedFromID:{},reports:v},b={};b[f.primitiveSet.POINTS]=!0,b[f.primitiveSet.LINES]=!0,b[f.primitiveSet.TRIANGLES]=!0;var x={};x[f.primitiveSet.POINTS]=!0,x[f.primitiveSet.LINES]=!0,x[f.primitiveSet.TRIANGLES]=!0,x[f.primitiveSet.TRIANGLE_STRIP]=!0;var S,y,C={Vertex:1,Normal:1,Tangent:1},T=function(e,t){var i=e[e.length-1];return t[t.length-1].getVertexAttributeList().Vertex.getElements().length-i.getVertexAttributeList().Vertex.getElements().length},M=function(e){return e===s.a.TRANSPARENT_BIN},w=function(e){return e.getVertexAttributeList().Vertex.getElements().length/3},A=function(e){return e[e.length-1].getVertexAttributeList().Vertex.getElements().length/3},E=function(e){var t=e.getStateSet();return t&&t.getAttribute("SketchfabMaterial")?t:void 0},P=function(e,t){for(var i=t||0,r=e.length-1;r>=i;--r){var n=E(e[r]);if(n)return n}},N=function(e){for(var t=0,i=e.length;t<i;++t)e[t].removeChildren()},F=function(e){for(var t=0,i=e.length-1;t<i;++t)e[t].addChild(e[t+1])},R=function(e){for(var t=e.length,i=0;i<t;++i)N(e[i])},I=function(e){var t=e[e.length-1].getInstanceID(),i=_.multiParentPathFromGeometryID;return Boolean(i[t])},O=function(e,t,i){var r=e.getElements(),n=t.getElements(),a=e.getItemSize(),o=t.getItemSize();if(a===o)return void r.set(n,i);for(var s=n.length/o,u=0;u<s;++u){var l=u*a,c=u*o;r[i+l]=n[c],r[i+l+1]=n[c+1],r[i+l+2]=n[c+2]}},L=function(e,t,i){var r=t.getVertexAttributeList().Vertex.getElements(),n=e.getVertexAttributeList().Vertex.getElements();t.getVertexAttributeList().Vertex.setElements(n.subarray(i,i+r.length)),e._boundingBox.copy(t.getBoundingBox()),e._boundingBoxComputed=!0;var a=t.getBoundingSphere(),o=e._boundingSphere;o.set(f.vec3.copy(o.center(),a.center()),a.radius()),e._boundingSphereComputed=!0,t.getVertexAttributeList().Vertex.setElements(r),t.dirtyBound()},D=function(e,t,i,r){var n=_.bakedGeometriesFromID[t.getInstanceID()];n||(_.bakedGeometriesFromID[i.getInstanceID()]=!0);var a=9===e.length,o=i.getElements();r&&(o=o.subarray(r));var s=t.getElements();if(n||(a?f.mat3.equals(f.mat3.IDENTITY,e):f.mat4.equals(f.mat4.IDENTITY,e)))return void(i!==t&&O(i,t,r||0));for(var u=a?f.vec3.transformMat3:f.vec3.transformMat4,l=t.getItemSize(),c=f.vec3.create(),h=Math.min(s.length,o.length),d=0;d<h;d+=l)c[0]=s[d],c[1]=s[d+1],c[2]=s[d+2],u(c,c,e),o[d]=c[0],o[d+1]=c[1],o[d+2]=c[2],4===l&&(o[d+3]=s[d+3])},k=function(e,t,i,r){var n=i.getIndices(),a=n.getElements(),o=a.length,s=0,u=i.getMode(),l=e[u],c=l.primitive,h=c.getIndices().getElements(),d=c.getCount(),p=x[u]&&!_.isTransparent,g=d;if(u===f.primitiveSet.TRIANGLE_STRIP&&p){var m=h[d-1],v=a[0]+r,b=m!==v&&0!==d?2:0,S=d%2;b&&(h[d]=m,h[d+1]=v),S&&(h[d+b]=v),g+=b+S,h.set(a,g)}else h.set(a,g);c.setCount(g+o);var y=g+o;for(s=g;s<y;++s)h[s]+=r;p||(i.setIndices(c.getIndices()),i.setCount(o),i.setFirst(g*h.BYTES_PER_ELEMENT),_.isTransparent||t.push(i))},B=function(e,t,i,r){for(var n=i.length,a=_.isTransparent,o=0;o<n;++o){var s=i[o],u=s.getMode();if(s instanceof f.DrawElements)k(e.DrawElements,t,s,r);else if(s instanceof f.DrawArrays){var l=e.DrawArrays[u];a?s.first+=r:l&&l.primitive.count===r&&0===s.getFirst()?l.primitive.count+=s.getCount():t.push(new f.DrawArrays(u,s.getFirst()+r,s.getCount()))}else s instanceof f.DrawArrayLengths&&(a?s.first+=r:t.push(new f.DrawArrayLengths(u,s.getFirst()+r,s.getArrayLengths().slice())))}},V=function(e){for(var t=[{nbVertex:A(e[0]),pathList:[e[0]]}],i=e.length,r=1;r<i;++r){var n=e[r],a=t[t.length-1],o=A(n);o+a.nbVertex>=_.splitLimit?t.push({nbVertex:o,pathList:[n]}):(a.nbVertex+=o,a.pathList.push(n))}return t},U=function(e,t,i){for(var r=I(e),n=0,a=i.length;n<a;++n){var o,s=i[n];if(r)if(s instanceof f.DrawElements){var u=s.getIndices(),l=u.getElements(),c=new l.constructor(l),h=new f.BufferArray(f.BufferArray.ELEMENT_ARRAY_BUFFER,c,u.getItemSize(),!0);o=new f.DrawElements(s.getMode(),h)}else s instanceof f.DrawArrays?o=new f.DrawArrays(s.getMode(),s.getFirst(),s.getCount()):s instanceof f.DrawArrayLengths&&(o=new f.DrawArrayLengths(s.getMode(),s.getFirst(),s.getArrayLengths().slice()));else o=s;t.push(o)}},G=function(e,t){var i=e.getElements(),r=i.BYTES_PER_ELEMENT;e.setNormalize(4!==r);var n=1;1===r?n=255:2===r&&(n=65535);for(var a=i.length,o=e.getItemSize(),s=t*o;s<a;++s)i[s]=n},z=function(e,t){var i=new f.Geometry;return i.setName(t.getName()),U(e,i.getPrimitiveSetList(),t.getPrimitiveSetList()),i},j=function(e,t){var i=t.getVertexAttributeList().Color;if(i&&4===i.getItemSize())return 4;for(var r=0,n=e.length;r<n;++r){var a=e[r],o=a[a.length-1],s=o.getVertexAttributeList().Color;if(s&&4===s.getItemSize())return 4}return 3},H=function(e,t,i){var r=e[e.length-1],n=z(e,r),a=f.computeLocalToWorld(e),o=f.mat3.create();f.mat3.normalFromMat4(o,a);var s=j(i,r),u=t!==w(r),l=I(e),c=n.getVertexAttributeList(),h=r.getVertexAttributeList();for(var d in h){var p,g=h[d],m=C[d],v="Color"===d,b=v?s:g.getItemSize();if(u){p=new(v?g.getElements().constructor:Float32Array)(t*b)}else m&&l?p=new Float32Array(g.getElements().length):c[d]=g;if(p){var x=new f.BufferArray(f.BufferArray.ARRAY_BUFFER,p,b,!0);v&&G(x,g.getElements().length/g.getItemSize()),c[d]=x,m||O(x,g,0)}if(m){D("Vertex"===d?a:o,g,c[d],0)}}return _.isTransparent&&L(n,r,0),n},W=function(e,t,i){var r=t[t.length-1],n=e.getVertexAttributeList(),a=r.getVertexAttributeList(),o=f.computeLocalToWorld(t),s=f.mat3.create();f.mat3.normalFromMat4(s,o);for(var u in a){var l=n[u],c=a[u],h=i*l.getItemSize();if(C[u]){D("Vertex"===u?o:s,c,l,h)}else O(l,c,h)}},q=function(e,t,i){for(var r in t)if(!e[r]){var n=t[r].getItemSize(),a="Color"===r,o=a?t[r].getElements().constructor:Float32Array,s=new o(i*n),u=new f.BufferArray(f.BufferArray.ARRAY_BUFFER,s,n,!0);e[r]=u,a&&G(u,0)}},Y=function(e,t,i,r){for(var n=t.DrawElements,a=t.DrawArrays,o=_.isTransparent,s=0,u=i.length;s<u;++s){var l=i[s],c=l.getMode();if(l instanceof f.DrawElements){var h=n[c];if(!h){var d=l.getIndices().getItemSize(),p=new f.BufferArray(f.BufferArray.ELEMENT_ARRAY_BUFFER,new Uint16Array,d,!0);h=n[c]={primitive:new f.DrawElements(c,p),lastElement:-1,initCount:0},o||e.push(h.primitive)}var g=h.primitive;if(c===f.primitiveSet.TRIANGLE_STRIP&&x[c]&&!o){var m=l.getIndices().getElements(),v=m[0]+r,S=h.lastElement!==v&&0!==g.getCount()?2:0,y=g.getCount()%2;g.setCount(g.getCount()+l.getCount()+S+y),h.lastElement=m[m.length-1]+r}else g.setCount(g.getCount()+l.getCount())}else l instanceof f.DrawArrays&&b[c]&&!o&&(a[c]||(a[c]={primitive:new f.DrawArrays(c,0,0),initCount:0},e.push(a[c].primitive)))}},X=function(e){for(var t={DrawElements:{},DrawArrays:{}},i=_.isTransparent,r=0,n=e.length;r<n;++r){var a=e[r],o=a.getMode();if(a instanceof f.DrawElements){var s=a.getIndices().getElements();t.DrawElements[o]={primitive:a,lastElement:s[s.length-1],initCount:a.getCount()}}else a instanceof f.DrawArrays&&b[o]&&!i&&(t.DrawArrays[o]={primitive:a,first:a.getFirst(),initCount:a.getCount()})}return t},K=function(e){for(var t in e){var i=e[t],r=i.primitive,n=r.getIndices(),a=n.getElements(),o=r.getCount()>=65535?Uint32Array:Uint16Array;n.setElements(new o(r.getCount())),n.getElements().set(a),r.setIndices(n),r.setCount(a.length)}},J=function(e,t,i,r){for(var n=e.getVertexAttributeList(),a=e.getPrimitiveSetList(),o=w(e),s=r,u=0,l=t.length;u<l;++u){var c=t[u],h=c[c.length-1];q(n,h.getVertexAttributeList(),o),Y(a,i,h.getPrimitiveSetList(),s),s+=A(c)}K(i.DrawElements)},Q=function(e){var t=e.DrawElements,i=_.isTransparent;for(var r in t){var n=t[r];!i&&x[r]||n.primitive.setCount(n.initCount)}},Z=function(e,t){var i=e.pathList,r=i.pop(),n=w(r[r.length-1]),a=H(r,e.nbVertex,i);if(t.addChild(a),0!==i.length){var o=a.getPrimitiveSetList(),s=X(o);J(a,i,s,n);for(var u=_.isTransparent,l=0,c=i.length;l<c;++l){var h=i[l];W(a,h,n);var d=h[h.length-1];if(u||I(h)){var p=z(h,d);u&&(p._attributes=a.getVertexAttributeList(),t.addChild(p),L(p,d,3*n)),d=p}var f=d.getPrimitiveSetList();B(s,o,f,n),n+=A(h)}Q(s)}},$=function(e){var t=e.localRoot;e.renderPathList.sort(T);for(var i=V(e.renderPathList),r=i.length,n=0;n<r;++n)Z(i[n],t)},ee=function(e,t){if(!_.isWireframe){var i=e.getAttribute("SketchfabMaterial").getMaterialModel(),r=i.get("geometryList");r.length=0;for(var n=t.getChildren(),a=0,o=n.length;a<o;++a)r.push(n[a]);i.getChannels().Displacement.updateGeometryOffsets()}},te=function(e){var t=e.localRoot,i=t.getStateSet();_.isTransparent=Boolean(i&&M(i.getBinNumber())),e.renderPathList.length>_.limitMergePerMaterial&&(_.isTransparent=!1),$(e),ee(i,t)},ie=function(e,t,i){var r;r=_.isWireframe?e[e.length-1].getStateSet():P(e);var n=r.getInstanceID(),a=t[n];a||(t[n]=a={localRoot:new f.Node,renderPathList:[]},a.localRoot.setStateSet(r),a.localRoot.setName(r.getName()),i.addChild(a.localRoot)),a.renderPathList.push(e),e[0]===i&&e.shift()},re=function(e,t){var i={},r=0,n=e.length;for(r=0;r<n;++r)ie(e[r],i,t);for(var a in i)te(i[a])},ne=function(e){for(var t=!1,i=_.channelTargetNames,r=0,n=e.length;r<n;++r){var a,o=e[r],s=!1;if(o instanceof g.Bone)a=g.UpdateBone;else{if(!(o instanceof f.MatrixTransform))continue;a=g.UpdateMatrixTransform,s=!0}for(var u=o.getUpdateCallbackList(),l=u.length-1;l>=0;--l){var c=u[l];c instanceof a!=!1&&(i[c.getName()]||!s?t=!0:(c.update(o),o.removeUpdateCallback(c)))}}var h=e[e.length-1];return t||h instanceof g.RigGeometry||h instanceof g.MorphGeometry},ae=function(){var e=[];return function(t){return e[0]=t,ne(e)}}();r.a.osgDB.Input.prototype.getJSON=function(){return y=this,this._json.Animations&&(S=this._json),this._json};var oe=function(e){var t=_.channelTargetNames;if(!S||!S.Animations||o.a.OSG_VERSION<8)return t;for(var i=e.getFeatures().animation.getModel(),r=S.Animations,n=0,a=r.length;n<a;++n){var s=r[n]["osgAnimation.Animation"],u=y.setJSON(s.UserDataContainer).readUserDataContainer(),l=d.a.convertUserDataToObject(u);if(i.getAnimationByUID(l.AnimationUID))for(var c=s.Channels,h=0,p=c.length;h<p;++h){var f=c[h];t[f[Object.keys(f)[0]].TargetName]=1}}return t},se=function(e,t){for(var i=_.protectedGeometries,r=e.length-1;r>=0;--r){var n=e[r],a=n.length,o=n[a-1],s=o._uniqueID;if(o.getVertexAttributeList&&(s=o.getVertexAttributeList().Vertex.getInstanceID()),i[o._uniqueID]||i[s])i[s]=!0,t.push(n),e.splice(r,1);else if(o instanceof f.Geometry||o instanceof g.Bone)ne(n)&&(t.push(n),e.splice(r,1));else{for(var u=a-2;u>=0;--u)if(n[u]instanceof g.Bone){t.push(n);break}e.splice(r,1)}}},ue=function(e,t,i){se(e.getPathList(),t),se(e.getNoGeometryPathList(),t),se(e.getWireframePathList(),i)},le=function(e){for(var t=_.parentCountFromID,i=_.childrenCountFromID,r=_.multiParentPathFromGeometryID,n=0,a=e.length;n<a;++n){for(var o=e[n],s=!1,u=0,l=o.length;u<l;++u){var c=o[u],h=c.getInstanceID();t[h]=c.getParents().length,i[h]=c.getChildren().length,s=s||c.getParents().length>1}r[o[o.length-1].getInstanceID()]=s}},ce=function(e){le(e.getPathList()),le(e.getNoGeometryPathList()),le(e.getWireframePathList())},he=function(e){R(e.getPathList()),R(e.getNoGeometryPathList()),R(e.getWireframePathList())},de=function(e,t,i,r){var n=0,a=e.length,o=i.length,s=!1;for(n=a-1;n>=0;--n){var u=e[n];F(u);var l=u[0]===t;P(u,l?1:0)||(s=!0),l||t.addChild(u[0])}for(n=o-1;n>=0;--n){var c=i[n];F(c),r.push(c[c.length-1]),c[0]!==t&&t.addChild(c[0])}s||t.setStateSet(void 0)},pe=function(e,t,i){_.isWireframe=!0;var r=e.getChildren(),n=r.length;re(t,e);for(var a=r.length,o=n;o<a;++o)i.push(r[o])},fe=function(e,t){var i=e.length;if(0!==i)for(var r=e[0].indexOf(t),n=t.getStateSet()?0:1,a=0;a<i;++a){var o=e[a];o.splice(0,r+n)}},ge=function(e){for(var t=e.getUpdateCallbackList(),i=0,r=t.length;i<r;++i){var n=t[i];if(n instanceof g.BasicAnimationManager)return e.removeUpdateCallback(n),n}},me=function(e){for(var t,i,r=e.getPathList(),n=r[0][0],a=n,o=[];;){t=E(a)||t,i=i||ge(a);var s=a.getChildren();if(1!==s.length)break;if(s[0]instanceof g.Skeleton)break;if(s[0]instanceof f.Geometry)break;if(ae(a))break;o.push(a),a=s[0]}if(n.removeChildren(),i&&n.addUpdateCallback(i),n===a)return a;for(var u=a.getParents(),l=0,c=u.length;l<c;++l)u[l].removeChild(a);a.removeChildren(),n.setStateSet(void 0),a.setStateSet(t);var h=f.computeLocalToWorld(o);if(f.mat4.equals(f.mat4.IDENTITY,h))n.addChild(a);else{var d=new f.MatrixTransform;d.setName("Optim - RootMatrix"),f.mat4.copy(d.getMatrix(),h),n.addChild(d),d.addChild(a)}return fe(r,a),fe(e.getWireframePathList(),a),fe(e.getNoGeometryPathList(),a),a},ve=function(e){var t=e.getFeatures().hotspot.getModel().get("hotspots"),i=t.length,r=_.protectedGeometries,n=0;for(n=0;n<i;++n){var a=t.at(n).get("geometryUid");a>=0&&(r[a]=!0)}var o=e.getFeatures().sound.getModel().get("soundtracks"),s=o.length;for(n=0;n<s;++n){var u=o.at(n).get("geometryUid");u>=0&&(r[u]=!0)}},_e=function(e){var t,i=e.getFeatures().material.getModel().attributes,r={},n=u.a.length;for(var a in i){var o=i[a];if(!o._unused){var s=[],l=o.getChannels();for(t=0;t<n;++t){var c=u.a[t],h=l[c];if(h.isEnableEffective()&&h.getTextureModel()){var d=h.getTexCoordUnit();-1===s.indexOf(d)&&s.push(d)}}var p=o.get("geometryList"),f=p.length;for(t=0;t<f;++t){var g=p[t],m=r[g.getInstanceID()];if(m)for(var v=s.length,_=0;_<v;++_)-1===m.uvList.indexOf(s[_])&&m.uvList.push(s[_]);else r[g.getInstanceID()]={geometry:g,uvList:s.slice()}}}}for(var b in r){var x=r[b],S=x.uvList,y=x.geometry.getVertexAttributeList();for(var C in y)-1!==C.indexOf("TexCoord")&&-1===S.indexOf(parseInt(C.substring(8)))&&delete y[C]}},be=function(e,t){_e(t);var i=t.getOrCreateScene().getWireframeNodes();i.length=0;var r=[],n=[],a=e.getPathList(),s=e.getWireframePathList();oe(t);var u=me(e);if(ce(e),he(e),ve(t),ue(e,r,n),re(a,u),de(r,u,n,i),s.length>0){var l=i.slice(0);o.a.getWireframe().then(function(){for(var e=i.length=l.length,t=0;t<e;++t)i[t]=l[t];f.time("optimizer - wireframe"),pe(u,s,i),f.timeEnd("optimizer - wireframe")})}},xe=function(e){var t=e.getFeatures().material.getModel().attributes,i={},r={},n=u.a.length;for(var a in t){var o=t[a],s=o.get("stateSet");if(!s)return;var c=o.getChannels(),h=l.a.get("mask"),d=[];d.push(o.get("cullFace")?1:0),d.push(o.hasOnlyPoints()?1:0),h&l.a.LIT&&d.push(o.get("shadeless")?1:0),h===l.a.CLASSIC_LIT&&d.push(o.get("reflection")),h!==l.a.MATCAP&&d.push(o.get("hasVertexColor")?1:0),c.Opacity.isEffective()&&d.push(o.get("hasVertexAlpha")?1:0);for(var p=0;p<n;++p){var g=u.a[p],m=c[g];m.isEnableEffective()&&d.push(g+(m.isEffective()?JSON.stringify(m.getJSON()):m.getFactor()))}d=d.join(" / "),i[d]?(r[s.getInstanceID()]=i[d],o._unused=!0):i[d]=s}var _=Object.keys(r).length,b=Object.keys(t).length;if(v.materialCountBefore=b,v.materialCountAfter=b-_,0!==_){var x=function(){f.NodeVisitor.call(this)};f.createPrototypeObject(x,f.objectInherit(f.NodeVisitor.prototype,{apply:function(e){var t=e.getStateSet();if(t){var i=r[t.getInstanceID()];i&&e.setStateSet(i)}this.traverse(e)}}));e.getRootModel().accept(new x)}},Se=function(e,t){var i=new p.a;e.accept(i);var r=i.getStats();v["nodeCount"+t]=r.nodeCount,v["matrixTransformCount"+t]=r.matrixTransformCount,v["geometryCount"+t]=r.geometryCount,v["boneCount"+t]=r.boneCount,v["skeletonCount"+t]=r.skeletonCount,v["morphGeometryCount"+t]=r.morphGeometryCount,v["rigGeometryCount"+t]=r.rigGeometryCount};_.optimize=function(e,t){if(m.resolve(v),i.i(h.a)().graphOptimizer||i.i(h.a)().mergeMaterials){f.time("optimizer");var r=t.getRootModel();if(Se(r,"Before"),i.i(h.a)().mergeMaterials&&(f.time("optimizer - materials"),xe(t),f.timeEnd("optimizer - materials")),i.i(h.a)().graphOptimizer&&(f.time("optimizer - nodes"),be(e,t),f.timeEnd("optimizer - nodes")),Se(r,"After"),i.i(h.a)().graphOptimizer){var n=v.geometryCountBefore+v.rigGeometryCountBefore+v.morphGeometryCountBefore,a=v.geometryCountAfter+v.rigGeometryCountAfter+v.morphGeometryCountAfter;c.a.logMessage("Geometry count : before "+n+", after "+a)}i.i(h.a)().mergeMaterials&&c.a.logMessage("Material count : before "+v.materialCountBefore+", after "+v.materialCountAfter),f.timeEnd("optimizer")}},t.a=_},function(e,t,i){"use strict";var r=i(89),n=i(1014),a=i(1015),o={FeatureName:"hotspot",ModelType:n.a,ViewListType:[a.a]},s=r.a.create(o);s.prototype.getNode=function(){return this._views[0].getNodeHotspot()},s.prototype.getWidgetNode=function(){return this._views[0].getNodeProxy()},t.a=s},function(e,t,i){"use strict";var r=i(19),n=i.n(r),a=i(5),o=i(0),s=(i.n(o),i(510)),u=i(168),l=i(163),c=i(92),h=i(31),d=i(513),p=i(465),f=a.a.osg,g=a.a.osgAnimation,m=function(e){var t=f.vec3.create(),r=f.vec3.create();e.getFeatures().camera.getModel().getCameraPosition(t,r),this.set("eye",t),this.set("target",r);var n=e.getScreenShot(128,128),a=n.toDataURL("image/jpeg");this.set("uidImage",void 0),this.set("imageFile",i.i(s.a)(a)),this.set("preview",a)},v=n.a.Model.extend({defaults:{webVR:!1,visible:i.i(h.a)().annotationsVisible,hotspots:new u.a([]),currentHotspotIndex:-1},getName:function(){return"Hotspot"},getResourceManager:function(){return this._resourceManager||c.default.instance},init:function(e){var t=this.get("hotspots");t.on("remove",this.onRemove,this);var r=this._viewer=e.getViewer();this.hotspotsToBeDeleted=[];var n=e.getModel().get("options"),a=n.hotspot,u=a&&a.hotspots&&i.i(o.keyBy)(a.hotspots,"uid");this.getResourceManager().getOrCreateHotspotCollection().resource.each(function(e){e.collection=null;var n=e.get("images")[0];n&&(e.set("uidImage",n.uid),e.set("imageFile",i.i(s.a)(n.url)),e.set("preview",n.url),e.set("refreshAction",m.bind(e,r)));var a=u&&u[e.get("uid")];a&&(e.set("geometryUid",a.geometryUid),e.set("indices",a.indices),e.set("barycentricWeights",a.barycentricWeights),e.set("localPosition",a.localPosition)),t.add(e)})},onRemove:function(e){e.isNew()||this.hotspotsToBeDeleted.push(e)},setUpdateCallback:function(e){this.callback=e},updateHotspotHit:function(e,t){this._viewer.getFeaturesManager().getScenePositionFromHit(t,e.get("position"));var r=t._nodePath[t._nodePath.length-1],n=void 0!==r._uniqueID?r._uniqueID:-1,a=r instanceof g.RigGeometry||r instanceof g.MorphGeometry,o=a||i.i(d.a)(t._nodePath);e.set("geometryUid",o?n:-1);var s=e.get("indices");s[0]=a?t._i1:-1,s[1]=a?t._i2:-1,s[2]=a?t._i3:-1;var u=e.get("barycentricWeights");u[0]=a?t._r1:0,u[1]=a?t._r2:0,u[2]=a?t._r3:0;var l=e.get("localPosition");l[0]=o?t._localIntersectionPoint[0]:0,l[1]=o?t._localIntersectionPoint[1]:0,l[2]=o?t._localIntersectionPoint[2]:0},createHotspot:function(e){var t=this.get("hotspots"),r=new l.a;return r.set("uid","tmp_"+i.i(o.uniqueId)()),i.i(p.b)(r,this._viewer.getFeaturesManager(),e),t.add(r,{sort:!1}),r.set("order",t.indexOf(r)),r.set("refreshAction",m.bind(r,this._viewer)),r.get("refreshAction")(),t.trigger("select",r),r},getJSON:function(){var e=[];return this.get("hotspots").each(function(t){e.push({uid:t.get("uid"),geometryUid:t.get("geometryUid"),indices:t.get("indices"),barycentricWeights:t.get("barycentricWeights"),localPosition:t.get("localPosition")})}),{hotspots:e}}});t.a=v},function(e,t,i){"use strict";var r=i(5),n=i(4),a=i(46),o=i(92),s=i(129),u=i(462),l=i(69),c=i(53),h=i(86),d=i(90),p=i(16),f=i(29),g=i(7),m=i(389),v=i(730),_=i(601),b=i(844),x=i.n(b),S=i(843),y=i.n(S),C=i(846),T=i.n(C),M=i(845),w=i.n(M),A=i(465),E=r.a.osg,P=n.a.extend({initialize:function(){n.a.prototype.initialize.apply(this,arguments),this._hotspots=this.model.get("hotspots"),this._hotspots.on("sort",c.a.draw),this._hotspots.on("remove",this.onHotspotRemoved,this),this._hotspots.on("add",this.onHotspotAdded,this),this._hotspots.on("select",this.onHotspotSelected,this),this._hotspots.on("inserted",this.onHotspotInserted,this),this.model.on("change:visible",this.onVisible,this),this._lastSuccessHit=void 0;var e=this.options.context;this._viewer=e.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._mouseKeyboard=this._viewerOSGJS.getEventProxy().StandardMouseKeyboard,this._idDragging=-1,this._dragHotspotStarted=!1,this._lastHoveredIndex=-1,this._dragCamera=!1,this._lastCoordNotDragging=E.vec2.create(),this._nodeHotspot=new E.Node,this._nodeHotspot.setName("Feature - Hotspot"),this._proxyHotspot=new E.Node,this._proxyHotspot.setName("Hotspot - Proxy"),this._proxyHotspot.setNodeMask(0),this._nodeHotspot.addChild(this._proxyHotspot),this.initHotspotProxy(),this.initEventHandlers(),this._hotspots.each(this.onHotspotAdded.bind(this)),m.a.setHotspot(this._hotspots.length>0),a.a.getModelDisplayed().then(this.hotspotReady.bind(this))},getNodeHotspot:function(){return this._nodeHotspot},getNodeProxy:function(){return this._proxyHotspot},getScreenThresholdHover:function(){return 20*this._viewerOSGJS.getCanvasPixelRatio()},onVisible:function(){this._proxyHotspot.setNodeMask(this.model.get("visible")?l.a.NO_SHADOW:0),c.a.draw()},initEventHandlers:function(){var e=this._viewer.getCanvas();i.i(d.a)()&&e.addEventListener("dblclick",this.onDoubleClick.bind(this)),e.addEventListener("mousemove",this.onPointerMove.bind(this)),e.addEventListener("touchmove",this.onPointerMove.bind(this)),e.addEventListener("mousedown",this.onPointerDown.bind(this)),e.addEventListener("touchstart",this.onPointerDown.bind(this)),e.addEventListener("touchend",this.onPointerUp.bind(this)),e.addEventListener("touchcancel",this.onPointerOut.bind(this)),e.addEventListener("mouseup",this.onPointerUp.bind(this)),e.addEventListener("mouseout",this.onPointerOut.bind(this))},hotspotReady:function(){this.onVisible();var e=this._viewer.getFeatures().postProcess.getCamera()._textureDepth;e&&this._proxyHotspot.getOrCreateStateSet().setTextureAttributeAndModes(0,e),c.a.draw()},onHotspotInserted:function(){for(var e=0;e<this._proxyHotspot.children.length;e++)this._proxyHotspot.children[e].initCard()},initHotspotProxy:function(){this._proxyHotspot.setCullCallback(this);var e=this._proxyHotspot.getOrCreateStateSet();e.setRenderBinDetails(h.a.HOTSPOT,"RenderBin"),e.setAttributeAndModes(new E.Depth(E.Depth.DISABLE)),e.setAttributeAndModes(new E.BlendFunc(E.BlendFunc.ONE,E.BlendFunc.ONE_MINUS_SRC_ALPHA));var t=o.default.instance.getOrCreateTexture(u.a.iconHotspot);e.addUniform(E.Uniform.createInt(0,"uTextureDepth")),e.addUniform(E.Uniform.createInt(1,"uTextureHotspot")),e.setTextureAttributeAndModes(1,t.texture),e.setAttributeAndModes(s.a.createShader(x.a,y.a,"hotspot","Hotspot")),e.setAttributeAndModes(new E.CullFace(E.CullFace.DISABLE)),v.a.initLineShader(s.a.createShader(T.a,w.a,"hotspotline","VRHotspotLine"))},onDoubleClick:function(e){if("annotations"===this._viewer.getOptions().widgetAPI.getTabbedWidget().get()){var t=f.a.maxHotspotsPerModel[g.a.me().get("account")];if(this._hotspots.length>=t){var i="You have reached the maximum number of annotations allowed by your plan ("+t+").";return g.a.me().canUpgradeToPro()&&(i+='<br><a class="button btn-medium btn-primary upgrade-link" href="/plans" data-title="maximum-annotation-upgrade" target="_blank">Upgrade to add more annotations</a>'),void this.model.trigger("hotspot-error",i)}var r=this._viewer.getFeaturesManager();if(r){var n=r.pickNearestSurface(e);n&&(this.model.createHotspot(n),p.a.annotationEditorCreateButtonClicked(this.options.context.getModel().get("uid")))}}},getColorHotspot:function(e){return this._proxyHotspot.getChildren()[e].getColor()},setHotspotHovered:function(e,t){t>=0&&E.vec3.copy(this.getColorHotspot(t),e?v.a.COLOR_HOVERED:v.a.COLOR_NORMAL)},updateCameraDragged:function(){var e=E.vec2.create();return function(t){this._dragCamera=this._dragCamera||E.vec2.dist(i.i(_.a)(t,e),this._lastCoordNotDragging)>5}}(),onPointerDown:function(e){this._idDragging=this.pickHotspot(e),this._dragHotspotStarted=!1,this._dragCamera=!1,i.i(_.a)(e,this._lastCoordNotDragging),i.i(d.a)()&&this._idDragging>=0&&this._mouseKeyboard.setEnable(!1)},onPointerOut:function(){this._dragCamera=!0,this.onPointerUp()},onPointerUp:function(){this._dragCamera?this._idDragging>=0&&(this._lastSuccessHit&&this.model.updateHotspotHit(this._hotspots.at(this._idDragging),this._lastSuccessHit),E.vec3.copy(this.getColorHotspot(this._idDragging),v.a.COLOR_NORMAL),c.a.draw(),p.a.annotationEditorPositionMoved(this.options.context.getModel().get("uid"))):this._hotspots.trigger("select",this._hotspots.at(this._idDragging)),this._dragHotspotStarted=!1,this._dragCamera=!1,this._idDragging=-1},onPointerMove:function(e){if(this.updateCameraDragged(e),i.i(d.a)()&&this._idDragging>=0)return void this.dragHotspot(e);var t=this.pickHotspot(e);i.i(_.a)(e,this._lastCoordNotDragging),this.setHotspotHovered(0,this._lastHoveredIndex),this.setHotspotHovered(1,t),this._lastHoveredIndex!==t&&(this._lastHoveredIndex=t,c.a.draw())},dragHotspot:function(e){this._dragHotspotStarted=!0;var t=this._viewer.getFeaturesManager();if(t){var r=t.pickNearestSurface(e),n=this._hotspots.at(this._idDragging);if(E.vec3.copy(this.getColorHotspot(this._idDragging),r?v.a.COLOR_DRAG_OK:v.a.COLOR_DRAG_FAIL),r)this._lastSuccessHit=r,this.model.updateHotspotHit(n,r);else{var a=i.i(_.a)(e),o=t.canvasCoordToGL(a[0],a[1],E.vec3.create());o[2]=t.getScreenPositionFromScenePoint(n.get("position"),E.vec3.create())[2],t.getScenePositionFromScreenPoint(o,n.get("position")),n.set("geometryUid",-1)}c.a.draw()}},onHotspotSelected:function(){var e=E.vec3.create(),t=E.vec3.create();return function(i){if(i){var r=this._viewer.getFeaturesManager();r&&(E.vec3.copy(e,i.get("eye")),E.vec3.copy(t,i.get("target")),r.applyAutospinToCamera(e,t),r.focusOnTargetAndEye(t,e,1.5),c.a.draw())}}}(),onHotspotAdded:function(e){var t=new v.a(this._hotspots.indexOf(e),this._viewer);t.setCardVisibilityListener(this._onCardVisibilityChange.bind(this)),this._proxyHotspot.addChild(t),c.a.draw()},_onCardVisibilityChange:function(e,t){t?this._viewer.trigger("annotationFocus",e.getIndex()):this._viewer.trigger("annotationBlur",e.getIndex())},onHotspotRemoved:function(){this.setHotspotHovered(0,this._lastHoveredIndex),this._lastHoveredIndex=-1;var e=this._proxyHotspot.getChildren();this._proxyHotspot.removeChild(e[e.length-1]),c.a.draw()},pickNearestSurface:function(e){var t=this._viewer.getFeaturesManager();if(t){var r=i.i(_.a)(e);return t.computeNearestIntersection2D(r[0],r[1],l.a.PICK_GEOMETRY_SLOW,this._viewer.getOrCreateScene().getRoot())}},screenDistanceToHotspot:function(){var e=E.vec3.create();return function(t,i){return this._viewer.getFeaturesManager().getScreenPositionFromScenePoint(this._hotspots.at(t).get("lastComputedScenePosition"),e),E.vec2.dist(e,i)}}(),pickHotspot:function(){var e=E.vec2.create();return function(t){var r=this._viewer.getFeaturesManager();if(!r||!this.model.get("visible"))return-1;i.i(_.a)(t,e),r.canvasCoordToGL(e[0],e[1],e);for(var n=1/0,a=this._hotspots.length,o=-1,s=this.getScreenThresholdHover(),u=0;u<a;++u){var l=this.screenDistanceToHotspot(u,e);l<s&&l<n&&(n=l,o=u)}return o}}(),cull:function(){var e=E.mat4.create(),t=E.quat.create(),r=E.vec3.create(),n=E.vec3.create(),a=E.vec3.create(),o=E.vec3.create(),s=E.mat4.create();return function(){this.model.callback&&this.model.callback();var u=this._viewer.getFeaturesManager();this._lastHoveredIndex>=0&&-1===this._idDragging&&(u.canvasCoordToGL(this._lastCoordNotDragging[0],this._lastCoordNotDragging[1],a),this.screenDistanceToHotspot(this._lastHoveredIndex,a)>=this.getScreenThresholdHover()&&this.setHotspotHovered(0,this._lastHoveredIndex));var l=this._hotspots,c=this._proxyHotspot.getChildren(),h=c.length,d=this._viewer.getFeatures(),p=d.webVR.getModel().get("worldFactor"),f=this.model.get("webVR");this._manipulator.getEyePosition(r);var g=this._viewer.getCamera(),m=.02*this._viewerOSGJS.getCanvasClientWidth()*E.mat4.getScale(o,g.getProjectionMatrix())[0];this._nodeHotspot.getWorldMatrix(void 0,s),E.mat4.invert(e,s),E.vec3.transformMat4(n,r,e);var v=E.mat4.multiply(e,g.getViewMatrix(),s);E.mat4.invert(v,v),E.mat4.fromQuat(v,E.mat4.getRotation(t,v));for(var _=0;_<h;++_){var b=c[_],x=l.at(_);i.i(A.a)(x,this._nodeHotspot),f?b.updatePositionVR(x,m,n,r,p,s):b.updatePosition(x,v,m,n)}return!0}}()});t.a=P},function(e,t,i){"use strict";var r=i(15),n=i(5),a=i(731),o=i(732),s=i(69),u=i(346),l=i(53),c=i(298),h=i(31),d=n.a.osg,p=n.a.osgUtil,f=r.a.extend({defaults:function(){return{type:"NONE",intensity:1,intensityGround:1,enable:!0,color:d.vec3.fromValues(1,1,1),ground:d.vec3.fromValues(.3,.2,.2),matrix:d.mat4.create(),matrixPrev:d.mat4.create(),falloff:-1,angle:45,hardness:.5,attachedToCamera:!1,castShadows:!0,shadowBias:.005,shadowNormalBias:i.i(h.a)().normalOffsetShadow?.075:void 0,shadowSize:i.i(h.a)().shadowTextureSize}},initialize:function(){r.a.prototype.initialize.apply(this,arguments),u.a.bind("change:mask",this.dirty,this),this.createNode(arguments[0])},createNode:function(e){this._mtLight=new d.MatrixTransform,this._mtLight.setName("Lighting - Mt");var t=a.a.createLight("Lighting",e);this._shadowMap=t.shadowMap,this._light=t.light,this._lightSource=t.lightSource,this._node=t.node,this._enableShadow=t.enableShadow,this._cameraShadows=i.i(h.a)().cameraShadows,this._mtQuad=new d.MatrixTransform,this._mtQuad.setName("Lighting - TransformIcon "+e),this._quadGeom=o.a.createIconGeometry(),this._quadGeom.setName("Lighting -  GeomIcon "+e),this._pointGeom=new o.a.createPointGeometry,this._dirGeom=new o.a.createDirectionalGeometry(5),this._spotGeom=new o.a.createSpotGeometry(5),this._hemiGeom=new o.a.createHemiGeometry(4),this._hemiGeom.getOrCreateStateSet().addUniform(d.Uniform.createFloat4(d.vec4.fromValues(0,0,1,1),"uGround")),this._scale=new d.MatrixTransform,this._scale.setName("Lighting - ScaleIcon "+e),this._mtEditLight=new d.MatrixTransform,this._mtEditLight.getOrCreateStateSet().setTextureAttributeAndModes(0,c.a.dummyTexture),this._mtEditLight.setName("Lighting - MtEditLight "+e);var r=this._mtEditLight.getOrCreateStateSet();r.addUniform(d.Uniform.createFloat4(d.vec4.fromValues(1,1,1,1),"uColor")),r.addUniform(d.Uniform.createInt(1,"uEnable")),r.addUniform(d.Uniform.createInt(0,"uAttachedToCamera")),r.addUniform(d.Uniform.createInt(0,"uTextureDepth")),this._node.addChild(this._mtLight),this._node.addChild(this._mtEditLight),this._mtLight.addChild(this._lightSource),this._mtEditLight.addChild(this._scale),this._mtEditLight.addChild(this._spotGeom),this._mtEditLight.addChild(this._pointGeom),this._scale.addChild(this._mtQuad),this._scale.addChild(this._dirGeom),this._scale.addChild(this._hemiGeom),this._mtQuad.addChild(this._quadGeom),this._dirty=!0,this._updateMatrixOnToggleCamera=!0,this._castShadows=!1,this._scene=null},setDepthTexture:function(e){e&&this._mtEditLight.getOrCreateStateSet().setTextureAttributeAndModes(0,e)},setScene:function(e){this._scene=e},getShadowMap:function(){return this._shadowMap},isCastingShadows:function(){return this._enableShadow&&this._castShadows},getLightSource:function(){return this._lightSource},getNodeScale:function(){return this._scale},getNodeQuad:function(){return this._mtQuad},getNode:function(){return this._node},getNodeLight:function(){return this._mtLight},getNodeEditLight:function(){return this._mtEditLight},dirty:function(){this._dirty=!0},isDirty:function(){return this._dirty},updateNode:function(){if(this._dirty){this._dirty=!1;var e=this._node,t=this._light,r=this.get("type");if("NONE"===r)return e.setNodeMask(0),t.setEnabled(!1),this._castShadows=!1,void(this._mtEditLight.editMask=0);e.setNodeMask(-1),this._mtEditLight.editMask="POINT"===r?p.NodeGizmo.PICK_ARROW|p.NodeGizmo.PICK_PLANE:p.NodeGizmo.PICK_GIZMO;var n="HEMI"===r&&u.a.get("mask")&u.a.PBR;n&&(r="DIRECTION");var a=this.get("enable"),o=this.get("falloff");t.setLightType(r),t.setSpotCutoff("SPOT"===r?this.get("angle"):180),t.setEnabled(a),t.setConstantAttenuation("DIRECTION"!==r?1:o),t.setQuadraticAttenuation("DIRECTION"!==r?o:0),t.setSpotBlend(this.get("hardness")),d.mat4.copy(this._mtLight.getMatrix(),this.get("matrix")),this._mtLight.dirtyBound(),this._mtEditLight.dirtyBound(),d.vec3.scale(t.getDiffuse(),this.get("color"),this.get("intensity")),d.vec3.copy(t.getSpecular(),t.getDiffuse()),d.vec3.scale(t.getGround(),this.get("ground"),this.get("intensityGround")),this._castShadows=this.get("castShadows")&&("DIRECTION"===r||"SPOT"===r)&&!n,this.getShadowMap().setTextureSize(this.get("shadowSize")),this.getShadowMap().setBias(this.get("shadowBias")),i.i(h.a)().normalOffsetShadow&&this.getShadowMap().setNormalBias(this.get("shadowNormalBias")),this.isAttachedToCamera()?(this._mtLight.setReferenceFrame(d.Transform.ABSOLUTE_RF),this._mtLight.setCullingActive(!1),this._cameraShadows||(this._castShadows=!1)):(this._mtLight.setReferenceFrame(d.Transform.RELATIVE_RF),this._mtLight.setCullingActive(!0));var l=this._scene.getMinimumBound(),c=l.radius(),f=this.multUI_?this.multUI_:l.radius2()/1e3,g=Math.pow(o*f,.125);g=Math.min(Math.max(g,0),1);var m=.05*c*g+.8*c*(1-g);"SPOT"===r&&this._spotGeom.updateCone(t.getSpotCutoff()*Math.PI/180,m),"POINT"===r&&this._pointGeom.updateRadius(m),this._dirGeom.setNodeMask(a&&"DIRECTION"===r?s.a.NO_PICK_NO_SHADOW:0),this._spotGeom.setNodeMask(a&&"SPOT"===r?s.a.NO_PICK_NO_SHADOW:0),this._hemiGeom.setNodeMask(a&&"HEMI"===r?s.a.NO_PICK_NO_SHADOW:0),this._pointGeom.setNodeMask(a&&"POINT"===r?s.a.NO_PICK_NO_SHADOW:0),d.vec3.copy(this._hemiGeom.getOrCreateStateSet().getUniform("uGround").getInternalArray(),t.getGround()),d.vec3.copy(this._mtEditLight.getOrCreateStateSet().getUniform("uColor").getInternalArray(),t.getDiffuse());var v=this._mtEditLight.getOrCreateStateSet();v.getUniform("uEnable").setInt(0|a),v.getUniform("uAttachedToCamera").setInt(0|this.isAttachedToCamera()),this._quadGeom.setLightType(r)}},setLightUnit:function(e){this._light.getLightNumber()!==e&&(this._light.setLightNumber(e),this._light.setName("skfb"+this._light.getTypeMember()),this._shadowMap.dirty())},setIconVisibility:function(e){this._forceHideIcon||this._mtEditLight.setNodeMask(e?s.a.PICK_GIZMO_LIGHT:0)},forceHideIcon:function(e){this._forceHideIcon=e,e&&this._mtEditLight.setNodeMask(0)},isAttachedToCamera:function(){var e=this.get("type");return("DIRECTION"===e||"HEMI"===e)&&this.get("attachedToCamera")},resetPosition:function(){d.mat4.identity(this._mtLight.getMatrix()),this._scene&&d.mat4.translate(this._mtLight.getMatrix(),this._mtLight.getMatrix(),this._scene.getMinimumBound().center()),l.a.draw()},updateAttachedToCamera:function(){var e=d.mat4.create(),t=d.vec3.create();return function(i){if(this._updateMatrixOnToggleCamera){var r=this.get("matrix");d.mat4.getTranslation(t,r),this.get("attachedToCamera")?d.mat4.copy(e,i.getViewMatrix()):d.mat4.invert(e,i.getViewMatrix()),d.mat4.multiply(r,e,r),d.mat4.setTranslation(r,t)}}}(),setUpdateMatrixOnToggleCamera:function(e){this._updateMatrixOnToggleCamera=e},getJSON:function(){var e={};return e.type=this.get("type"),e.enable=this.get("enable"),e.color=this.get("color"),e.intensity=this.get("intensity"),e.ground=this.get("ground"),e.intensityGround=this.get("intensityGround"),e.matrix=this.get("matrix"),e.falloff=this.get("falloff"),e.attachedToCamera=this.get("attachedToCamera"),e.angle=this.get("angle"),e.hardness=this.get("hardness"),e.castShadows=this.get("castShadows"),e.shadowBias=this.get("shadowBias"),e.shadowSize=this.get("shadowSize"),e}});t.a=f},function(e,t,i){"use strict";var r=i(89),n=i(1018),a=i(1020),o={FeatureName:"lighting",ModelType:n.a,ViewListType:[a.a]},s=r.a.create(o);s.prototype.getNode=function(){return this._views[0].getNode()},s.prototype.getNodeShadow=function(){return this._views[0].getNodeShadow()};var u=function(e,t){for(var i=e.get("lights"),r=0;r<i.length;++r)i[r].forceHideIcon(t)};s.prototype.prepareForScreenShot=function(){u(this._model,!0)},s.prototype.resetAfterScreenShot=function(){u(this._model,!1)},t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(46),a=i(15),o=i(1016),s=i(1019),u=i(299),l=i(139),c=i(337),h=r.a.osg,d=a.a.extend({defaults:function(){return{enable:!i.i(u.a)(),select:-1,lights:[new o.a(0),new o.a(1),new o.a(2)],webVR:!1,forceShadowRedraw:!1}},getName:function(){return"Lighting"},getDefaultFalloff:function(){var e=this._root.getMinimumBound().radius();return e<0?0:3.90625/(e*e)},setConfigAndDefaultFalloff:function(e){for(var t=this.get("lights"),i=0,r=t.length;i<r;++i){var n=t[i];n.setUpdateMatrixOnToggleCamera(!1),e&&e[i]&&n.set(e[i]),n.set("falloff",-1),n.setUpdateMatrixOnToggleCamera(!0)}this.dirtyScene()},initPresetThreePointLight:function(){this.setConfigAndDefaultFalloff(s.a.ThreePointLight())},initPresetFullMoonNight:function(){this.setConfigAndDefaultFalloff(s.a.FullMoonNight())},initPresetLowKeyLight:function(){this.setConfigAndDefaultFalloff(s.a.LowKeyLight())},initPresetEvilGenius:function(){this.setConfigAndDefaultFalloff(s.a.EvilGenius())},initPresetFairyCamp:function(){this.setConfigAndDefaultFalloff(s.a.FairyCamp())},initPreset2HeadLightV1:function(){this.setConfigAndDefaultFalloff(s.a.TwoHeadLightV1())},init:function(e){this._viewer=e.getViewer(),this._root=e.getScene().getRoot();var t=e.getModel().get("options"),i=t.lighting;if(i&&i.lights){this._ignoreSceneLights=!0;var r=this.get("lights");void 0!==i.enable&&this.set("enable",i.enable);for(var a=t.version,o=0;o<3;++o){var s=i.lights[o];(void 0===s.castShadows||a<1&&s.attachedToCamera)&&(s.castShadows=!1),r[o].set(s)}(r[0].get("falloff")<0||r[1].get("falloff")<0||r[2].get("falloff")<0)&&this.dirtyScene()}n.a.getModelDisplayed().then(this.initDepthTexture.bind(this))},initDepthTexture:function(){for(var e=this._viewer.getFeatures().postProcess.getCamera(),t=this.get("lights"),i=0;i<3;++i)t[i].setDepthTexture(e._textureDepth)},dirtyScene:function(){l.a.getModelBoxWithoutDisplacement()?this.recomputeLightsPositionAndFalloff():l.a.getBoxReady().then(this.recomputeLightsPositionAndFalloff.bind(this))},recomputeLightsPositionAndFalloff:function(){for(var e=l.a.getModelBoxWithoutDisplacement(),t=this.get("lights"),i=.8*e.radius(),r=this.getDefaultFalloff(),n=e.center(h.vec3.create()),a=h.vec3.fromValues(0,0,i),o=0;o<3;++o){var s=t[o],u=s.get("matrix");s.get("falloff")<0&&(s.set("falloff",r),u[12]=n[0],u[13]=n[1],u[14]=n[2],h.mat4.translate(u,u,a)),s.dirty()}},initLights:function(e){var t=0,r=this.get("lights");for(t=0;t<3;++t)r[t].setScene(this._root);if(this._ignoreSceneLights)return this.trigger("uiReady");var n=e.length;if(i.i(u.a)()){if(0===n)return this.initPresetThreePointLight(),this.trigger("uiReady");this.set("enable",!0)}else{for(t=0;t<3;++t)r[t].set("castShadows",!1);if(0===n)return this.initPreset2HeadLightV1(),this.trigger("uiReady");if(n>3)return this.initPresetThreePointLight(),this.trigger("uiReady")}e.sort(function(e,t){return h.vec3.len(e.getDiffuse())-h.vec3.len(t.getDiffuse())});var a=h.vec3.create();for(t=0;t<3;++t){var o=e[t],s=r[t];if(o){var l=o.getLightType();s.set("type",l),s.set("attachedToCamera",!1),"SPOT"===l&&(s.set("angle",Math.min(90,o.getSpotCutoff())),s.set("hardness",o.getSpotBlend()));var c=o.getDiffuse(),d=Math.max(c[0],c[1],c[2],1);s.set("intensity",d),h.vec3.scale(s.get("color"),c,1/d);var p=o.getGround(),f=Math.max(p[0],p[1],p[2],1);s.set("intensityGround",f),h.vec3.scale(s.get("ground"),p,1/f),s.set("falloff",o.getQuadraticAttenuation());var g=s.get("matrix");h.mat4.getScale(a,o._worldMatrix),h.mat4.fromScaling(g,a),h.mat4.invert(g,g),h.mat4.multiply(g,o._worldMatrix,g)}else s.set("falloff",this.getDefaultFalloff()),s.set("type","NONE")}return this.trigger("uiReady")},getJSON:function(){var e={},t=this.get("lights");return e.enable=this.get("enable"),e.lights=[t[0].getJSON(),t[1].getJSON(),t[2].getJSON()],e},editorGetJSON:function(){return this.getJSON()},validateJSON:function(e){var t=[];c.a.isBoolean(e.enable)||t.push("Lighting.editorSetJSON enable must be a boolean"),c.a.isArray(e.lights,3)||t.push("Lighting.editorSetJSON lights must be an array of 3 elements");for(var i=0;i<3;i++){var r=e.lights[i];c.a.isEnumString(r.type,["NONE","DIRECTION","SPOT","POINT","HEMI"])||t.push("Lighting.editorSetJSON light["+i.toString()+"] type must be an enum [NONE, DIRECTION, SPOT, POINT, HEMI]"),c.a.isBoolean(r.enable)||t.push("Lighting.editorSetJSON light["+i.toString()+"] enable must be a boolean"),c.a.isArrayNumber(r.color,3,0,1)||t.push("Lighting.editorSetJSON light["+i.toString()+"] color must be a vec3 with value in range [0,1]"),c.a.isNumber(r.intensity,0,100)||t.push("Lighting.editorSetJSON light["+i.toString()+"] intensity must be a number with value in range [0,100]"),c.a.isArrayNumber(r.ground,3,0,1)||t.push("Lighting.editorSetJSON light["+i.toString()+"] ground must be a vec3 with value in range [0,1]"),c.a.isNumber(r.intensityGround,0,100)||t.push("Lighting.editorSetJSON light["+i.toString()+"] intensityGround must be a number with value in range [0,100]"),c.a.isArrayNumber(r.matrix,16)||t.push("Lighting.editorSetJSON light["+i.toString()+"] matrix must be an mat4"),c.a.isNumber(r.falloff)||t.push("Lighting.editorSetJSON light["+i.toString()+"] falloff must be a number"),c.a.isBoolean(r.attachedToCamera)||t.push("Lighting.editorSetJSON light["+i.toString()+"] attachedToCamera must be a boolean"),c.a.isNumber(r.angle,0,90)||t.push("Lighting.editorSetJSON light["+i.toString()+"] angle must be a number with value in range [0,90]"),c.a.isNumber(r.hardness,0,1)||t.push("Lighting.editorSetJSON light["+i.toString()+"] hardness must be a number with value in range [0,1]"),c.a.isBoolean(r.castShadows,0,1)||t.push("Lighting.editorSetJSON light["+i.toString()+"] castShadows must be a boolean"),c.a.isNumber(r.shadowBias,0,1)||t.push("Lighting.editorSetJSON light["+i.toString()+"] shadowBias must be a number with value in range [0,1]"),c.a.isInteger(r.shadowSize)||t.push("Lighting.editorSetJSON light["+i.toString()+"] shadowSize must be an integer")}return t.join("\n")},editorSetJSON:function(e){var t=this.validateJSON(e);if(t)return t;for(var i=[],r=0;r<3;r++){var n={type:e.lights[r].type,enable:e.lights[r].enable,color:e.lights[r].color,ground:e.lights[r].ground,intensity:e.lights[r].intensity,intensityGround:e.lights[r].intensityGround,matrix:e.lights[r].matrix,falloff:e.lights[r].falloff,attachedToCamera:e.lights[r].attachedToCamera,angle:e.lights[r].angle,hardness:e.lights[r].hardness,castShadows:e.lights[r].castShadows,shadowBias:e.lights[r].shadowBias,shadowSize:e.lights[r].shadowSize};i.push(n)}return this.set("enable",e.enable),this.setConfigAndDefaultFalloff(i),t}});t.a=d},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a={};a.ThreePointLight=function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(-.9815804500275482,.1909922167095499,-.004668327333101102,0,.13548347102422797,.7131126062169096,.6878332937084056,0,.13469984856318096,.6745312327912614,-.7258536813891331,0,0,0,0,1),color:n.vec3.fromValues(.7806122448979592,.7985214493960848,1),intensity:.96},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(.7755211495104662,-.0666602860002539,.6277924441503967,0,.2690483737361956,.9344846523281437,-.233133882464682,0,-.5711216326246741,.3497067926613838,.7426474533145686,0,0,0,0,1),color:n.vec3.fromValues(1,.8783319450229073,.7091836734693877),intensity:1},{type:"HEMI",enable:!0,attachedToCamera:!1,matrix:n.mat4.fromValues(.6903299131022926,-.7076363669144057,-.15064986988498263,0,-.011089698239978026,.19785137301620165,-.9801692980238416,0,.7234097246160907,.6783108479272498,.12873524736872857,0,0,0,0,1),color:n.vec3.fromValues(.423469387755102,.7352665556018328,1),intensity:.12,ground:n.vec3.fromValues(.9642857142857143,.6484128636877489,.2607507288629738),intensityGround:.06}]},a.FullMoonNight=function(){return[{type:"HEMI",enable:!0,attachedToCamera:!1,matrix:n.mat4.fromValues(.9997395789367833,.0037284998571004493,-.02251383121813605,0,-.003172416108909601,.9996902441347245,.024685047253076783,0,.02259889562202194,-.024607195505995896,.9994417320914686,0,0,0,0,1),color:n.vec3.fromValues(.14431486880466474,.20264621883738915,.3928571428571429),intensity:1.5400000000000005,ground:n.vec3.fromValues(.9744897959183674,.6276245973191442,.3331164098292378),intensityGround:.06},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(.9321120105125691,.3015730438836578,-.2005514873067817,0,.11902736304545063,-.7780729183457072,-.6167941476566071,0,-.34205216956578893,.5510501183556175,-.7611465564236605,0,0,0,0,1),color:n.vec3.fromValues(1,.613390254060806,.19387755102040816),intensity:2.9799999999999995},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(.5165535747993983,-.2459126458378022,-.8201825254045677,0,-.40819067915319995,.771302442076031,-.48833688402577136,0,.7526970000035951,.5870430252243886,.29803978378898704,0,0,0,0,1),color:n.vec3.fromValues(1,1,1),intensity:.38}]},a.LowKeyLight=function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(.022621146436927503,-.2660807408393079,-.9636852821789301,0,-.18898982664775527,.9454138725983617,-.26547213586781604,0,.9817184571747294,.1881319984823789,-.02890020742997683,0,0,0,0,1),color:n.vec3.fromValues(1,1,1),intensity:1},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(-.9330760233019924,.058913139300351657,.35482161258401,0,.19787524547993016,.9078715652207372,.36961413432105955,0,-.30035732380815566,.4150885003001482,-.8587706416461712,0,0,0,0,1),color:n.vec3.fromValues(1,1,1),intensity:.22},{type:"NONE",enable:!0}]},a.EvilGenius=function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!1,matrix:n.mat4.fromValues(.9967621126545051,.025235816589958687,.07634424888336766,0,.000702423157861877,-.9521689363972996,.3055713061819492,0,.08040396369728874,-.3045282747481311,-.9491036468693457,0,0,0,0,1),color:n.vec3.fromValues(1,.3450645564348185,.056122448979591844),intensity:1.5400000000000005},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(-.7932202797763206,.039941473670798935,.6076234577701727,0,.16089796285361985,.9761307284151629,.14587887644631273,0,-.5872933111326324,.21347945972549276,-.780713191238742,0,0,0,0,1),color:n.vec3.fromValues(.15368596418159094,.7346938775510203,.20111518159950362),intensity:1.9000000000000008},{type:"HEMI",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(.9998681367204546,.01574007797565349,.003994886292083951,0,0,.24600379421877677,-.9692688652948499,0,-.016239124704439348,.9691410543235108,.24597135535169048,0,0,0,0,1),color:n.vec3.fromValues(.9897959183673469,.674842115105101,.02524989587671801),intensity:.02,ground:n.vec3.fromValues(.3,.2,.2),intensityGround:.98}]},a.FairyCamp=function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(.7285122591021403,-.5166704810444328,-.44980162555865727,0,.2899427624247639,.827461680647148,-.4808745798834604,0,.6206473095530125,.21990630067806594,.752620844826062,0,0,0,0,1),color:n.vec3.fromValues(.8476936693044566,.8957603762037927,.9948979591836735),intensity:.9},{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(.08433618912371937,-.8568665398386119,-.5085932953835439,0,-.8584235966554874,-.3216498975444721,.39956260099599905,0,-.5059608047162799,.40289089877364465,-.7626811835729392,0,0,0,0,1),color:n.vec3.fromValues(.37244897959183676,.538942107455227,1),intensity:1.7200000000000006},{type:"HEMI",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(.9766324883850551,-.001534767629049323,.21491074221438983,0,.14494434684687327,-.7336231034872216,-.6639188793421307,0,.15868244688039193,.6795548443783637,-.7162577012039377,0,0,0,0,1),color:n.vec3.fromValues(.3389212827988338,.7142857142857143,.346581781400607),intensity:.5,ground:n.vec3.fromValues(.9947417742607245,.48469387755102045,1),intensityGround:.14}]},a.TwoHeadLightV1=function(){return[{type:"DIRECTION",enable:!0,attachedToCamera:!0,matrix:n.mat4.fromValues(Math.SQRT1_2,0,Math.SQRT1_2,0,-0,1,0,0,-Math.SQRT1_2,-0,Math.SQRT1_2,0,0,0,0,1),color:n.vec3.fromValues(.6,.48,.3),intensity:1},{enable:!0,attachedToCamera:!0,type:"DIRECTION",matrix:n.mat4.fromValues(Math.SQRT1_2,0,-Math.SQRT1_2,0,0,1,0,0,Math.SQRT1_2,0,Math.SQRT1_2,0,0,0,0,1),color:n.vec3.fromValues(.42,.42,.6),intensity:1},{type:"NONE",enable:!0}]},t.a=a},function(e,t,i){"use strict";var r=i(5),n=i(46),a=i(4),o=i(69),s=i(53),u=i(86),l=r.a.osg,c=a.a.extend({initialize:function(e){a.a.prototype.initialize.apply(this,arguments),this.model.bind("change:select",this.onSelectChanged,this),this.model.bind("change:enable",this.onEnableChanged,this),this.model.bind("change",s.a.draw),this._viewer=e.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._hasAnimation=!1,n.a.getHasAnimation().then(function(e){e&&(this._hasAnimation=e)}.bind(this)),this._nodeFeature=new l.Node,this._nodeFeature.setName("Feature - Lighting");var t=new r.a.osgShadow.ShadowSettings;t.setCastsShadowDrawTraversalMask(o.a.SHADOW),t.setCastsShadowBoundsTraversalMask(o.a.SHADOW_BOUNDS),t.userShadowCasterVisitor=!1,this._shadowNode=new r.a.osgShadow.ShadowedScene(t),this._shadowNode.setName("Shadowed scene"),this._lightNode=new l.Camera,this._lightNode.setName("Lighting - Camera"),this._lightNode.setNearFarRatio(5e-5),this._lightNode.getOrCreateStateSet().setRenderBinDetails(u.a.EDITOR_GIZMO,"RenderBin"),this._lightNode.setNodeMask(o.a.NO_SHADOW),this.initLightNode(),this.onEnableChanged(),this._nodeFeature.addChild(this._lightNode),n.a.getMaterial().then(this.handleDirtyShadows.bind(this))},getNode:function(){return this._nodeFeature},getNodeLight:function(){return this._lightNode},getNodeShadow:function(){return this._shadowNode},handleDirtyShadows:function(){var e=this._viewer.getFeatures().material;if(e){var t=e.getModel().attributes,i=this.model.get("lights"),r=i.length;for(var n in t)for(var a=t[n],o=a.getChannels().Opacity,s=a.getChannels().Displacement,u=0;u<r;++u){var l=i[u];o.bind("change",l.dirty,l),s.bind("change",l.dirty,l)}}},onEnableChanged:function(){var e=this.model.get("enable");if(this._lightNode.setNodeMask(e?o.a.NO_SHADOW:0),!e){var t=this.getGizmo();t&&t.attachToGeometry(null)}for(var i=this.model.get("lights"),r=0,n=i.length;r<n;++r){var a=i[r].get("enable");i[r].getLightSource().getLight().setEnabled(a&&e)}this.update()},initLightNode:function(){this._lightNode.addUpdateCallback(this);for(var e=this.model.get("lights"),t=0,i=e.length;t<i;++t){var r=e[t];r.setLightUnit(t),r.bind("change",r.dirty,r),r.bind("change:attachedToCamera",r.updateAttachedToCamera.bind(r,this._viewer.getCamera()),r),r.bind("change",s.a.draw),this._lightNode.addChild(r.getNode())}},getGizmo:function(){var e=this._viewer.getFeaturesManager();return e?e.getNodeGizmo():null},onSelectChanged:function(){var e=this.getGizmo();if(e){var t=this.model.get("select");if(-1===t)return void e.attachToGeometry(null);e.attachToMatrixTransform(this.model.get("lights")[t].getNodeEditLight())}},updateSelection:function(){var e=this.getGizmo();if(e&&!e._isEditing){var t=e._attachedNode;if(-1!==this.model.get("select")||t){for(var i=-1,r=this.model.get("lights"),n=0;n<3;++n)if(r[n].getNodeEditLight()===t){e.updateGizmoMask(),i=n;break}this.model.set("select",i)}}},updateLightIcons:function(){var e=l.vec4.create(),t=l.vec3.create(),i=l.vec3.create(),r=l.quat.create();return function(){var n=this.model.get("lights"),a=this._viewer.getCamera(),o=.02*this._viewerOSGJS.getCanvasClientWidth()*l.mat4.getScale(e,a.getProjectionMatrix())[0];this._manipulator.getEyePosition(i);for(var s=this.getGizmo(),u=0;u<3;++u){var c=n[u];if("NONE"!==c.get("type")){var h=c.getNodeEditLight(),d=c.getNodeLight(),p=c.getNodeQuad(),f=c.getNodeScale(),g=s._isEditing&&s._attachedNode===h,m=p.getMatrix(),v=h.getMatrix(),_=d.getMatrix();c.isAttachedToCamera()?g?(l.mat4.getTranslation(t,v),l.mat4.multiply(_,a.getViewMatrix(),v),l.mat4.setTranslation(_,t)):(l.mat4.getTranslation(t,_),l.mat4.invert(v,a.getViewMatrix()),l.mat4.multiply(v,v,_),l.mat4.setTranslation(v,t)):g?l.mat4.copy(_,v):l.mat4.copy(v,_),l.mat4.copy(c.get("matrix"),_),h.getWorldMatrix(void 0,m),l.mat4.getTranslation(t,m);var b=l.vec3.dist(i,t)/o;l.mat4.fromScaling(f.getMatrix(),l.vec3.set(e,b,b,b)),l.mat4.multiply(m,a.getViewMatrix(),m),l.mat4.invert(m,m),l.mat4.fromQuat(m,l.mat4.getRotation(r,m)),p.dirtyBound(),d.dirtyBound(),f.dirtyBound()}}}}(),update:function(){var e=this._shadowNode;if(0===e.getChildren().length)return!0;for(var t=this._viewer.getOptions().widgetAPI,i=t&&"lighting"===t.getTabbedWidget().get()&&this.model.get("enable"),r=this._viewer.getFeaturesManager().getShadowForcedUpdate(),n="lit"===this._viewer.getFeatures().shadingStyle.getModel().get("style"),a=this.model.get("webVR"),o=this.model.get("lights"),s=0;s<3;++s){var u=o[s],c=r||u.isDirty();u.updateNode();var h=u.getShadowMap(),d=a&&u.isAttachedToCamera();if(!d&&n&&u.get("enable")&&u.isCastingShadows()){if(!(c=c||u.isAttachedToCamera()||r)){for(var p=u.get("matrix"),f=u.get("matrixPrev"),g=0;g<16;g++)if(p[g]!==f[g]){c=!0;break}l.mat4.copy(f,p)}c&&h.requestRedraw(),e.addShadowTechnique(h)}else(c||d)&&e.removeShadowTechnique(h);u.setIconVisibility(i)}return!i||(this.updateLightIcons(),this.updateSelection(),!0)}});t.a=c},function(e,t,i){"use strict";var r=i(89),n=i(1022),a=i(597),o=a.a.extend({_textureTrashbin:[],_matcapTrashbin:[],getName:function(){return"Material"}}),s={FeatureName:"material",ModelType:o,ViewListType:[n.a]},u=r.a.create(s);u.prototype.getSceneLights=function(){return this._views[0].getSceneLights()},t.a=u},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(0),o=(i.n(a),i(5)),s=i(4),u=i(46),l=i(31),c=i(92),h=i(1025),d=i(1037),p=i(1036),f=i(298),g=i(156),m=i(346),v=i(736),_=i(1012),b=o.a.osg,x=s.a.extend({getName:function(){return"MaterialManagerView3D"},initialize:function(){s.a.prototype.initialize.apply(this,arguments),this.model.bind("change",this.render,this),m.a.bind("change:mask",this.cleanAndApplyMaterials,this),this._sceneLights=[],this._defaultStateSet=void 0,this._defaultMaterial=void 0,this._renderingPaths=new d.a,this.model.setImageCollection(this.createImageCollection().resource),this.model.setMatcapCollection(this.createMatcapCollection().resource),this.init()},init:function(){var e=this.options.context,t=e.getScene();this._viewer=e.getViewer(),this._resourceDefer=n.a.defer(),t.addResourcePromise(this._resourceDefer.promise),u.a.getPolygon().then(this.initSceneGraph.bind(this))},createImageCollection:function(){return this.getResourceManager().getOrCreateImageCollection()},createMatcapCollection:function(){return this.getResourceManager().getOrCreateMatcapCollection()},getResourceManager:function(){return this._resourceManager||c.default.instance},getOrCreateDefaultStateSet:function(){return void 0===this._defaultStateSet&&(this._defaultStateSet=new b.StateSet,this._defaultStateSet._uniqueID=0),this._defaultStateSet},getOrCreateDefaultMaterial:function(e,t){var i=this.getOrCreateDefaultStateSet();if(void 0===this._defaultMaterial){if(this._defaultMaterial=t.getMaterialByStateSet(i),this._defaultMaterial){var r=t.getUniqueMaterialName(i.getAttributeMap().Material,i,e);this._defaultMaterial.set("name",r)}else this._defaultMaterial=t.createMaterial(e,i);this._defaultMaterial.setStateSet(i)}return e.setStateSet(i),this._defaultMaterial},processSceneGraph:function(e,t){var i=new h.a(t),r=i.apply(e);return e.accept(this._renderingPaths),this.fixWrongRootEditUser(e,this._renderingPaths),this.pruneSceneGraph(this._renderingPaths),0===r.getMaterials().length&&this.getOrCreateDefaultMaterial(e,t),this._renderingPaths.getPathList().forEach(function(e){if(!e.some(function(e){var t=e.getStateSet();return t&&t.getAttribute("SketchfabMaterial")})){var i=e[e.length-1];this.getOrCreateDefaultMaterial(i,t)}}.bind(this)),this._sceneLights=r.getLights(),r},getSceneLights:function(){return this._sceneLights},fixWrongRootEditUser:function(e,t){var r=this.model,n=this.hasWrongRootEditUser(r);if(n){n.rootMaterialToKeep=!0;var o={};if(i.i(a.each)(r.attributes,function(e){o[e.get("stateSetID")]=e}),2===i.i(a.size)(r.attributes)){var s=i.i(a.filter)(r.attributes,function(e){return e.get("stateSet")!==n.get("stateSet")})[0],u=n.getChannels(),l=s.getChannels();for(var c in u)u[c].get("textureModel")&&l[c].setTextureModel(u[c].get("textureModel"))}else for(var h=n,d=t.getStateSetPathList(),f=0,g=d.length;f<g;f++){var m=d[f];if(m[0]===h.attributes.stateSet)for(var v=m.length-1;v--;){var _=m[v];r.removeMaterialByStateSetID(_._uniqueID)}}var b=new p.a(o);e.accept(b),0!==b.removedStateSet.length&&(b.removedStateSet=b.removedStateSet.filter(function(e,t,i){return i.lastIndexOf(e)===t&&-1===b.keepedStateSet.indexOf(e)}),i.i(a.each)(b.removedStateSet,function(e){r.removeMaterialByStateSetID(e)}))}},initSceneGraph:function(){var e=this.options.context,t=this.model,r=e.getScene(),n=r.getRoot(),a=this._viewer.getFeatures();if(b.time("initSceneGraph - create saved materials"),!1===i.i(l.a)().processMaterial){var o=e.getModel().get("options").materials;for(var s in o)t.addMaterial(o[s])}b.timeEnd("initSceneGraph - create saved materials"),b.time("initSceneGraph - processSceneGraph");var c=this.processSceneGraph(n,t);b.timeEnd("initSceneGraph - processSceneGraph"),b.time("initSceneGraph - apply materials"),t.removeUnboundMaterial();var h=!1;if(a.shadingStyle){var d=a.shadingStyle.getModel();h=d.get("vertexColorEnable")&&d.get("vertexAlphaEnable")}t.tagMaterialWithGeometryInfo(n,h),this._requestTextures(),t._style=c.getStyle();var p=c.hasMetallicWorkflow();void 0!==p&&t.setWorkFlowMetalSpec(p,!1),t.overrideMaterialChannels(i.i(l.a)()),t.updateTexCoordUnitList(),this.applyMaterials(),this.setWireframeStateSets(),b.timeEnd("initSceneGraph - apply materials"),_.a.optimize(this._renderingPaths,this._viewer),a.quality&&a.quality.getModel().trigger("updateTexelPolicy"),u.a.resolveMaterial()},setWireframeStateSets:function(){var e=0,t=this.model,r=!i.i(l.a)().mergeMaterials,n={},a={},o=this._renderingPaths.getPathList(),s=o.length;for(e=0;e<s;++e){var u=o[e],c=u[u.length-1];if(c instanceof b.Geometry!=!1){var h=c.getVertexAttributeList().Vertex;h&&(a[h.getInstanceID()]=u)}}var d=this._renderingPaths.getWireframePathList(),p=this.options.context.getScene().getWireframeNodes(),f=p.length;for(e=0;e<f;++e){var g=p[e],m=g.getVertexAttributeList(),_=a[m.Vertex.getInstanceID()];if(_){var x,S=_[_.length-1],y=t.findFirstMaterial(_),C=y.getChannels().Displacement,T=y&&y.get("stateSet"),M=S.getVertexAttributeList();if(r){x=new v.a,M.Normal&&(m.Normal=M.Normal);for(var w in M)-1!==w.indexOf("TexCoord")&&(m[w]=M[w]);x._textureAttributeArrayList=T._textureAttributeArrayList,x._activeTextureAttributeUnit=T._activeTextureAttributeUnit,x._activeTextureAttribute=T._activeTextureAttribute,x.setAttributeAndModes(T.getAttribute("SketchfabMaterial"))}else if(C.isEffective()){var A=JSON.stringify(C.getJSON());x=n[A];var E="TexCoord"+C.getTexCoordUnit();M[E]&&(m[E]=M[E]),M.Normal&&(m.Normal=M.Normal),x||(x=n[A]=new v.a,x._textureAttributeArrayList=T._textureAttributeArrayList,x._activeTextureAttributeUnit=T._activeTextureAttributeUnit,x._activeTextureAttribute=T._activeTextureAttribute,x.setAttributeAndModes(T.getAttribute("SketchfabMaterial")))}else x=n.static=n.static||new v.a;g.setStateSet(x)}else{p.splice(e,1),e--,f--;for(var P=g.getParents(),N=0,F=P.length;N<F;++N)P[N].removeChild(g);for(var R=0;R<d.length;++R){var I=d[R];I[I.length-1]===g&&(d.splice(R,1),R--)}}}},pruneSceneGraph:function(e){for(var t=e.getStateSetMapNodes(),i=e.getStateSetPathList(),r=e.getStateSetMap(),n={},a=0,o=i.length;a<o;a++){var s=i[a];if(s.length>0){var u=s.length-1,l=s[u];n[l._uniqueID]=l}}for(var c in t)if(void 0===n[c]){this.model.removeMaterialByStateSet(r[c]);for(var h=0,d=t[c].length;h<d;h++){var p=t[c][h];p.setStateSet(void 0)}}},hasWrongRootEditUser:function(e){var t=e.getMaterials(),i=Object.keys(t);if(!(0===i.length||t[i[0]].get("version")>=2))for(var r=0;r<i.length;++r){var n=t[i[r]],a=n.get("name").toLowerCase();if(-1!==a.indexOf("root")||-1!==a.indexOf("ollada visual")){var o=n.getChannels();for(var s in o)if(o[s].getTextureModel())return n}}},cleanAndApplyMaterials:function(){i.i(a.each)(this.model.attributes,function(e){e.get("stateSet")&&e.trigger("change:stateSet")}),this.applyMaterials()},applyMaterials:function(){i.i(a.each)(this.model.attributes,function(e){e.trigger("apply")})},_requestTexture:function(e,t,i){if(e){var r=e.getChannels()[t],n=r.getTextureModel();if(n&&r.isEffective()){var a=n.getMultiresTexture();if(a){if(0===a.getImageCount())return void r.setColor(b.vec3.fromValues(.9,.9,.9));return(i?a.getImageSmallest():a.getImageMaxSupported()).promise}}}},_requestAllTextures:function(e,t){var r=this,n=[],o=new window.Set;return g.a.forEach(function(s){i.i(a.each)(e,function(e){var i=r._requestTexture(e,s,t);i&&!o.has(i)&&(o.add(i),n.push(i))})}),n},_resolvePromiseTextures:function(e,t,i){for(var r=(new Date).getTime()-t,n=0,a=0,o=e.length;a<o;++a)!0!==e[a]&&n++;(i?u.a.resolveLowResLoaded:u.a.resolveHighResLoaded)({time:n>0?r:0,count:n})},requestAllLowResTextures:function(e){return this._requestAllTextures(e,!0)},requestAllHighResTextures:function(e){return this._requestAllTextures(e,!1)},_resolvePromiseLowResTextures:function(e,t){return this._resolvePromiseTextures(e,t,!0)},_resolvePromiseHighResTextures:function(e,t){return this._resolvePromiseTextures(e,t,!1)},_requestTextures:function(){var e=this,t=this.options.context,r=t.getViewer(),a=i.i(l.a)(),o=a.preload;f.a.WAIT_ANIMATION=!o;var s=this.model.toJSON(),u=this.requestAllLowResTextures(s),c=(new Date).getTime();o||r.setFakePrimaryProgress(u),n.a.settle(u).then(function(){e._resolvePromiseLowResTextures(u,c);var t=(new Date).getTime(),i=e.requestAllHighResTextures(s);r.setFakeProgress(i,!o),n.a.settle(i).then(function(){e._resolvePromiseHighResTextures(i,t),o&&e._resourceDefer.resolve()}),o||e._resourceDefer.resolve()})},_getUniqueTextures:function(){var e={},t=this.model.attributes,r=[];return i.i(a.each)(t,function(t){for(var i=t.get("stateSet"),n=i.getNumTextureAttributeLists(),a=0;a<n;++a){var o=i.getTextureAttribute(a,"Texture");o&&o.getChannelPacking&&(e[o.getInstanceID()]||(e[o.getInstanceID()]=!0,r.push(o)))}}),r},getOrCreateTexelInfos:function(){if(this._infoTex)return this._infoTex;for(var e=this._infoTex={missingResolution:0,missingTextures:[],count:0,pixelCount:0,min:1/0,max:-1/0},t={width:0,height:0,missingResolution:0,missingTextures:e.missingTextures},i=this._getUniqueTextures(),r=i.length,n=0;n<r;++n){t=i[n].getMaxTextureSizePacked(t),e.count++,e.pixelCount+=t.width*t.height,e.missingResolution+=t.missingResolution;var a=Math.max(t.width,t.height);e.min=Math.min(a,e.min),e.max=Math.max(a,e.max)}return e}});t.a=x},function(e,t,i){"use strict";var r=i(5),n=i(0),a=(i.n(n),i(15)),o=i(598),s=i(299),u=i(156),l=i(337),c=r.a.osg,h=i.i(n.invert)(c.CullFace),d=function(e,t){return e-t},p=function(e){var t={};return[{name:"Matcap",displayName:"Matcap",factor:1},{name:"DiffuseColor",displayName:"Diffuse",color:i.i(s.a)()?c.vec3.fromValues(1,1,1):c.vec3.fromValues(.5,.5,.5),factor:1,enable:!0},{name:"DiffuseIntensity",displayName:"Lightmap",color:c.vec3.fromValues(1,1,1),factor:1,enable:!0},{name:"SpecularColor",displayName:"Specular Color",color:c.vec3.fromValues(.5,.5,.5),factor:0,enable:!0},{name:"SpecularHardness",displayName:"Glossiness",factor:12.5,enable:!0},{name:"Displacement",displayName:"Displacement",factor:0,enable:!0},{name:"NormalMap",displayName:"Normal map",factor:1,enable:!1,flipY:!0},{name:"BumpMap",displayName:"Bump map",factor:1,enable:!1},{name:"Opacity",displayName:"Transparency",factor:1,type:"alphaBlend",enable:!0},{name:"EmitColor",displayName:"Emission",color:c.vec3.fromValues(1,1,1),factor:0,enable:!0,type:"additive"},{name:"DiffusePBR",displayName:"Albedo",color:c.vec3.fromValues(1,1,1),factor:1,enable:!1},{name:"AlbedoPBR",displayName:"Base Color",color:c.vec3.fromValues(1,1,1),factor:1,enable:!0},{name:"SpecularPBR",displayName:"Specular",color:c.vec3.fromValues(1,1,1),factor:.05,enable:!1},{name:"GlossinessPBR",displayName:"Glossiness",factor:.4,enable:!1},{name:"RoughnessPBR",displayName:"Roughness",factor:.6,enable:!0},{name:"MetalnessPBR",displayName:"Metalness",factor:0,enable:!0},{name:"SpecularF0",displayName:"Specular F0",factor:.5,enable:!0},{name:"AOPBR",displayName:"Ambient Occlusion",factor:1,enable:!1,occludeSpecular:!1},{name:"CavityPBR",displayName:"Cavity",factor:1,enable:!1}].forEach(function(i){var r=i.name;i.material=e,t[r]=new o.default[r].model(i)},t),t},f=a.a.extend({defaults:function(){return{version:3,shadeless:!1,id:"0",stateSetID:0,name:"noname",channels:p(this),geometryList:[],texCoordUnitList:[],cullFace:c.CullFace.DISABLE,reflection:i.i(s.a)()?.1:.3,vertexColorColorSpace:"srgb",vertexColorEnable:!1,vertexAlphaEnable:!1,hasVertexColor:!1,hasVertexAlpha:!1,hasTriangles:!1,hasPoints:!1,hasLines:!1}},setMaterial:function(e){this.set(e),i.i(n.each)(e.channels,function(e,t){this.getChannels()[t].set(e)},this)},setMaterialJSON:function(e,t){void 0!==e.version&&this.set("version",e.version),void 0!==e.shadeless&&this.set("shadeless",e.shadeless),void 0!==e.id&&this.set("id",e.id),void 0!==e.stateSetID&&this.set("stateSetID",e.stateSetID),void 0!==e.name&&this.set("name",e.name),void 0!==e.reflection&&this.set("reflection",e.reflection),void 0!==e.cullFace&&this.set("cullFace",c.CullFace[e.cullFace]);var i=e.channels;if(i)for(var r=this.getChannels(),n=u.a.length,a=0;a<n;++a){var o=u.a[a],s=i[o];if(s){var l=r[o];l&&l.setChannelJSON(s,t)}}},getChannels:function(){return this.get("channels")},setStateSet:function(e){return this.set("stateSet",e),this},setChannelEnable:function(e,t){var i=this.get("channels");return i[e]?(i[e].setEnable(t),this):this},setChannelColor:function(e,t){var i=this.get("channels");return i[e]?(i[e].setColor(t),this):this},setChannelTexture:function(e,t){var i=this.get("channels");return i[e]?(i[e].setTextureModel(t),this):this},setChannelFactor:function(e,t){var i=this.get("channels");return i[e]?(i[e].setFactor(t),this):this},getJSON:function(){var e={};e.version=3,e.stateSetID=this.get("stateSetID"),e.shadeless=this.get("shadeless"),e.id=this.get("id"),e.name=this.get("name"),e.cullFace=h[this.get("cullFace")],e.reflection=this.get("reflection");var t={};return i.i(n.each)(this.get("channels"),function(e,i){t[i]=e.getJSON()}),e.channels=t,e},copyDualChannel:function(e,t){var i=this.getChannels(),r=i[e],n=i[t],a=n.getTextureModel(),o="MetalnessPBR"===e||"SpecularPBR"===e,s="NormalMap"===e||"BumpMap"===e;a?(a=a.clone(),(o||s)&&(a.setImageModel(a.getImageModel()),a.set("internalFormat","NormalMap"===e||"SpecularPBR"===e?c.Texture.RGB:c.Texture.LUMINANCE),a.updateMultiresTexture()),r.setTextureModel(a)):o||r.setColor(n.getColor()),s||r.setFactor(n.getFactor())},getWorkFlowPBRMetalSpec:function(){return this.getChannels().MetalnessPBR.getEnable()},getWorkFlowPBRRoughGloss:function(){return this.getChannels().RougnessPBR.getEnable()},setWorkFlowRoughGloss:function(e,t){var i=e?"GlossinessPBR":"RoughnessPBR",r=e?"RoughnessPBR":"GlossinessPBR",n=this.getChannels();n[i].setEnable(!1),n[r].setEnable(!0),t&&this.copyDualChannel(r,i,n)},setWorkFlowMetalSpec:function(e,t){var i=e?"DiffusePBR":"AlbedoPBR",r=e?"SpecularPBR":"MetalnessPBR",n=e?"AlbedoPBR":"DiffusePBR",a=e?"MetalnessPBR":"SpecularPBR",o=this.getChannels();o[i].setEnable(!1),o[r].setEnable(!1),o.SpecularF0.setEnable(e),o[n].setEnable(!0),o[a].setEnable(!0),t&&(this.copyDualChannel(n,i),this.copyDualChannel(a,r))},hasOnlyPoints:function(){return this.get("hasPoints")&&!this.get("hasTriangles")&&!this.get("hasLines")},updateTexCoordUnitList:function(){var e=this.get("texCoordUnitList");e.length=0;for(var t,i,r=this.get("geometryList"),n=r.length,a=[],o=[],s=0;s<n;++s){var l=r[s].getVertexAttributeList();o.length=0;for(var c in l)-1!==c.indexOf("TexCoord")&&o.push(parseInt(c.substring(8)));for(o.sort(d),t=o.length-1;t>=0;--t){var h=o[t],p=l["TexCoord"+h];for(i=0;i<t;++i){var f=o[i];if(p===l["TexCoord"+f]){var g=a[h];void 0!==g&&g!==f?-1===e.indexOf(h)&&e.push(h):a[h]=f;break}}var m=o[i];-1===e.indexOf(m)&&e.push(m)}}if(e.sort(d),0!==a.length){var v=e.length;for(t=0;t<v;++t)a[e[t]]=e[t];var _=this.getChannels(),b=u.a.length;for(t=0;t<b;++t){var x=_[u.a[t]];x.setTexCoordUnit(a[x.getTexCoordUnit()])}}}});f.validateJSON=function(e,t){var i=[];l.a.isBoolean(e.shadeless)||i.push("Material shadeless must be a boolean"),l.a.isString(e.name)||i.push("Material name must be a string"),l.a.isEnumString(e.cullFace,["DISABLE","BACK"])||i.push("Material cullFace must be an integer enum [ DISABLE, BACK ]"),l.a.isNumber(e.reflection,0,1)||i.push("Material reflection must be a number in range [ 0.0, 1.0 ]"),void 0===e.channels&&i.push("Material channels must be an {} but is undefined");for(var r=e.channels,n=u.a,a=0;a<n.length;a++){var s=n[a],c=r[s];if(c){var h=o.default[s].model.validateJSON(s,c,t);h&&i.push(h)}}return i.join("\n")},t.a=f},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(4)),a=i(598),o=i(733),s=i(53),u=i(156),l=n.a.extend({initialize:function(){n.a.prototype.initialize.apply(this,arguments),this.model.bind("change:stateSet",this.stateSet,this),this.model.bind("change:cullFace",this.onCullFace,this),this.model.bind("change:shadeless",this.onDirty,this),this.model.bind("change:vertexColorEnable",this.onDirty,this),this.model.bind("change:vertexColorColorSpace",this.onDirty,this),this.model.bind("change:vertexAlphaEnable",this.onDirty,this),this.model.bind("change:hasPoints",this.onPrimitive,this),this.model.bind("change:hasTriangles",this.onPrimitive,this),this.model.bind("change:hasLines",this.onPrimitive,this),this.model.bind("apply",this.apply,this),this.model.bind("change",s.a.draw),this._context=new o.a(this.model),this._views={};for(var e=this.model.get("channels"),t=u.a.length,i=0;i<t;++i){var r=u.a[i],l=e[r];this._views[r]=new a.default[r].view({model:l,stateSetContext:this._context}),l.bind("change:enable",this.onEnableChanged,this)}},getStateSetContext:function(){return this._context},stateSet:function(){var e=this.model.get("stateSet");return e.setName(this.model.get("name")),this.getStateSetContext().setStateSet(e),this},apply:function(){i.i(r.each)(this._views,function(e){e.apply()},this),this.onCullFace(),this.onDirty()},onDirty:function(){this.getStateSetContext().dirtyMaterial()},onCullFace:function(){this.getStateSetContext().setCullface(this.model.get("cullFace"))},onPrimitive:function(){this.getStateSetContext().setPointCircle(this.model.hasOnlyPoints())},onEnableChanged:function(e,t){if(!0===t){var i=e.getName(),r=this.model.getChannels();"BumpMap"===i?r.NormalMap.setEnable(!1):"NormalMap"===i&&r.BumpMap.setEnable(!1),"GlossinessPBR"===i?r.RoughnessPBR.setEnable(!1):"RoughnessPBR"===i&&r.GlossinessPBR.setEnable(!1),"AlbedoPBR"===i||"MetalnessPBR"===i?(r.DiffusePBR.setEnable(!1),r.SpecularPBR.setEnable(!1)):"DiffusePBR"!==i&&"SpecularPBR"!==i||(r.AlbedoPBR.setEnable(!1),r.MetalnessPBR.setEnable(!1))}return this}});t.a=l},function(e,t,i){"use strict";var r=i(1032),n=i(1027),a=i(388),o=function(e){this._materialManager=e};o.prototype={apply:function(e){var t=new r.a;e.accept(t);var i=t.getSource(),o=t.getAuthoringTool();i=i?i.toLowerCase():"default";var s=n.a[i]?n.a[i]:n.a.default,u=new s(this._materialManager,o);e.accept(u),u.postApply(e),"q3d"!==i&&(a.a.hasTriangles||a.a.hasVertexNormals)||(u._style="shadeless");var l=e.getUserData()||[];return l.push({Name:"source",Value:i},{Name:"authoringTool",Value:o}),e.setUserData(l),e.userDataMap=a.a.convertUserDataToObject(l),u}},t.a=o},function(e,t,i){"use strict";t.a=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},function(e,t,i){"use strict";var r=i(1028),n=i(1029),a=i(1030),o=i(1031),s=i(1034),u=i(1035),l=i(734),c=i(1033);t.a={default:a.a,wavefront:l.a,blender:r.a,ksp:r.a,lightwave:s.a,minecraft:u.a,collada:n.a,fbx:o.a,substancepainter:n.a,mineways:u.a,gltf:c.a}},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=i(366),o=i(436),s=n.a.osg,u=function(){a.a.apply(this,arguments)};s.createPrototypeObject(u,s.objectInherit(a.a.prototype,{cyclesNodeToMaterial:function(e,t,i,r,n,a,o,u){var l=e.nodes[n];if(void 0!==l){void 0===u&&(u=n);var c="setChannel"+r;if(void 0===t[c])return void s.warn("material has not method "+c);if(!(o&&a&&l.inputs)&&l.value)return void t[c](u,l.value);for(var h=0;h<l.inputs.length;h++){var d=l.inputs[h];if(d.name===a){var p=d.default_value;if(void 0!==p)if(Array.isArray(p))if("Opacity"===u||"Transparent BSDF"===u||"Glass BSDF"===u)if("Color"===a){var f=p[0]*p[1]*p[2]*p[3];1===f&&(f=.15),t[c](u,f)}else t[c](u,p);else"SpecularPBR"===u?"Color"===a?t[c](u,p):(p=p[0]*p[1]*p[2]*p[3],t[c](u,p)):"Color"===a&&"NormalMap"===u||t[c](u,p);else"setChannelColor"!==u&&"Color"!==r&&("Strength"===a&&"Emission"===n&&(p/=10),t[c](u,p));if(d.links&&"SpecularPBR"!==u){for(var g=0;g<d.links.length;g++){var m=d.links[g];if(m.from_node){var v=e.nodes[m.from_node];if(v){var _=v.texture_slot;if(p=i.getTextureAttribute(_,"Texture")){t.setChannelTexture(u,this.createTextureModelFromTextureOSG(p));var b=t.getChannels()[u];b.resetTextureFormat(),b.setTexCoordUnit(_),b.setEnable(!0),this._texturesAssigned.push(p)}}void 0!==v&&void 0!==p||s.warn("Missing Texture linked in "+n+" node destined to "+u)}}return}}}l=this.findNodeByValueCyclesMetadata(e.nodes,n),l&&l.value&&t[c](u,l.value)}},findNodeByValueCyclesMetadata:function(e,t){for(var i in e){var r=e[i];if(r instanceof Object){var n=this.findNodeByValueCyclesMetadata(r,t);if(void 0!==n)return n}else if(r===t)return e}},metaDataToMaterial:function(e,t,i,r,n,a){if(void 0!==e[r]){void 0===n&&(n=r);var o="setChannel"+i;if(void 0===t[o])return void s.warn("material has not method "+o);void 0===a||!0===a?t[o](n,JSON.parse(e[r])):t[o](n,e[r])}},setTextureFromBlender:function(e,t,i,r,n){var a=e.getChannels()[t];a.setFactor(n);var o=this.createTextureModelFromTextureOSG(r);a.setTextureModel(o),a.resetTextureFormat(),a.setTexCoordUnit(i),a.setEnable(!0)},processDefaultMaterial:function(e,t){t.removeAttribute("Material");for(var i=0,r=t.getNumTextureAttributeLists();i<r;i++)t.removeTextureAttribute(i,"Texture");e.setStateSet(void 0)},processLightSource:function(e){var t=e.getLight();if(t&&void 0!==t.getUserData()&&t.typeID!==o.a.typeID){var i=t.getUserData(),r=this.convertUserDataToObject(i),n=new o.a;"AREA"!==r.Type&&"SUN"!==r.Type&&"HEMI"!==r.Type||(r.Type="DIRECTION"),n.setLightType(r.Type),void 0!==r.SpotSize&&n.setSpotCutoff(90*JSON.parse(r.SpotSize)/Math.PI),void 0!==r.SpotBlend&&n.setSpotBlend(JSON.parse(r.SpotBlend)),s.vec3.scale(n.getDiffuse(),JSON.parse(r.Color),JSON.parse(r.Energy));var a=1/JSON.parse(r.Distance);n.setQuadraticAttenuation(Math.abs(a)===1/0?0:a),this.pushLight(n)}},processCyclesGraph:function(e,t,i){var r;try{r=JSON.parse(i.NodeTree)}catch(e){return s.warn("error in blender cycle graph json "+e),!0}if(void 0===r)return!0;this._texturesAssigned=[],this.cyclesNodeToMaterial(r,e,t,"Color","Diffuse BSDF","Color",!0,"DiffusePBR"),this.cyclesNodeToMaterial(r,e,t,"Factor","Diffuse BSDF","Roughness",!0,"RoughnessPBR"),this.cyclesNodeToMaterial(r,e,t,"Color","Diffuse BSDF","Normal",!0,"NormalMap"),this.cyclesNodeToMaterial(r,e,t,"Color","Glossy BSDF","Color",!0,"SpecularPBR"),e.setChannelFactor("SpecularPBR",1),this.cyclesNodeToMaterial(r,e,t,"Factor","Glossy BSDF","Roughness",!0,"RoughnessPBR"),this.cyclesNodeToMaterial(r,e,t,"Color","Glossy BSDF","Normal",!0,"NormalMap"),this.cyclesNodeToMaterial(r,e,t,"Color","Bump","Height",!0,"NormalMap"),this.cyclesNodeToMaterial(r,e,t,"Factor","Bump","Strength",!0,"NormalMap"),this.cyclesNodeToMaterial(r,e,t,"Color","Emission","Color",!0,"EmitColor"),this.cyclesNodeToMaterial(r,e,t,"Factor","Emission","Strength",!0,"EmitColor"),this.cyclesNodeToMaterial(r,e,t,"Color","Ambient Occlusion","Color",!0,"AOPBR"),this.cyclesNodeToMaterial(r,e,t,"Factor","Ambient Occlusion","Strength",!0,"AOPBR"),this.cyclesNodeToMaterial(r,e,t,"Factor","Transparency","Strength",!0,"Opacity"),this.cyclesNodeToMaterial(r,e,t,"Factor","Transparent BSDF","Color",!0,"Opacity"),this.cyclesNodeToMaterial(r,e,t,"Factor","Glass BSDF","Color",!0,"Opacity");for(var n=[],a=0,o=t.getNumTextureAttributeLists();a<o;a++){var u=t.getTextureAttribute(a,"Texture");u&&-1===this._texturesAssigned.indexOf(u)&&n.push(u)}return this.assignPBRTextureFromFilenames(n,e),e.setWorkFlowMetalSpec(!1,!1),e.setWorkFlowRoughGloss(!0,!1),!1},processMaterial:function(e,t,n){var a=this.createMaterial(e,t),o=t.getAttribute("Material"),u=this.convertUserDataToObject(o?o.getUserData():void 0),l=!0;u.NodeTree&&(l=this.processCyclesGraph(a,t,u)),l&&(this.metaDataToMaterial(u,a,"Color","DiffuseColor"),this.metaDataToMaterial(u,a,"Factor","DiffuseIntensity","DiffuseColor"),a.setChannelEnable("DiffuseColor",!0),this.metaDataToMaterial(u,a,"Color","SpecularColor"),this.metaDataToMaterial(u,a,"Factor","SpecularIntensity","SpecularColor"),a.setChannelEnable("SpecularColor",!0),this.metaDataToMaterial(u,a,"Factor","Emit","EmitColor"),a.setChannelEnable("EmitColor",!0),this.metaDataToMaterial(u,a,"Factor","SpecularHardness"),a.setChannelEnable("SpecularHardness",!0),void 0!==u.Translucency&&(a.setChannelFactor("Opacity",1-JSON.parse(u.Translucency)),a.setChannelEnable("Opacity",!0)),void 0!==n.Shadeless&&a.set("shadeless",n.Shadeless));var c=i.i(r.chain)(t.getUserData()).map(function(e){var t=e.Name.substr(0,2),i=parseInt(t,10);if(!isNaN(i))return i}).without(void 0).uniq().sortBy(function(e){return e}).value();t.removeAttribute("Material");var h={},d=["DiffuseColor","DiffuseIntensity","SpecularColor","Normal","Bump","Translucency","Alpha","EmitColor","SpecularHardness"],p=this;i.i(r.each)(c,function(e){var n=i.i(r.chain)(t.getUserData()).filter(function(t){var i=t.Name.substr(0,2);return parseInt(i,10)===e}).value();i.i(r.each)(n,function(e){var n=e.Name.substr(0,2),o=parseInt(n,10),u=t.getTextureAttribute(o,"Texture");if(void 0===u)return void s.warn("missing texture");h[o]=u;var l=e.Name.substr(3);if(!0===i.i(r.includes)(d,l)){var c=parseFloat(e.Value);"DiffuseColor"===l?void 0!==a.getChannels().DiffuseColor.getTextureModel()&&void 0===a.getChannels().DiffuseIntensity.getTextureModel()&&(l="DiffuseIntensity"):"Alpha"===l?l="Opacity":"Translucency"===l?(l="Opacity",c=1-c):"Normal"===l?l="NormalMap":"Bump"===l&&(l="BumpMap"),p.setTextureFromBlender(a,l,o,u,c)}else"UsePremultiplyAlpha"===l?s.warn("UsePremultiplyAlpha not supported"):"UseAlpha"===l?s.warn("UseAlpha not supported"):s.warn("channel "+l+" not supported")})});for(var f in h)t.removeTextureAttribute(parseInt(f,10),"Texture");"ksp"===u.source&&(-1===a.attributes.name.toLowerCase().indexOf("wheel")?a.getChannels().MetalnessPBR.setFactor(1):a.getChannels().SpecularF0.setFactor(0),-1!==a.attributes.name.toLowerCase().indexOf("fairing")&&a.getChannels().Opacity.setFactor(.25)),a.setStateSet(t)}})),t.a=u},function(e,t,i){"use strict";var r=i(5),n=i(366),a=r.a.osg,o=function(){n.a.apply(this,arguments)};a.createPrototypeObject(o,a.objectInherit(n.a.prototype,{processMaterial:function(e,t,i){var r,n=this.createMaterial(e,t),a=["lambert","blinn","phong"],o=function(e,t,r){for(var n=a.length,o="_"+e+"_"+t;n--;)if(void 0!==i[a[n]+o]){var s=i[a[n]+o];return r?s:JSON.parse(s)}},s="color";r=o("emission",s),void 0!==r&&(n.setChannelColor("EmitColor",r),n.setChannelEnable("EmitColor",!0)),r=o("diffuse",s),void 0!==r&&(n.setChannelColor("DiffuseColor",r),n.setChannelEnable("DiffuseColor",!0)),void 0!==(r=o("specular",s))&&(n.setChannelColor("SpecularColor",r),n.setChannelEnable("SpecularColor",!0),n.setChannelFactor("SpecularColor",1));var u=o("specular",s)?o("specular",s):[0,0,0];if(s="amount",void 0!==(r=o("shininess",s))){var l=128*r;n.setChannelFactor("SpecularHardness",l),n.setChannelEnable("SpecularHardness",!0),this.setGlossinessPBRFromSpecularGlossiness(n,u,l)}var c=1;r=o("transparency","amount"),void 0!==r&&(c=r),r=o("transparency","color"),void 0!==r&&4===r.length&&(c=r[3]),n.setChannelFactor("Opacity",c),n.setChannelEnable("Opacity",!0),t.removeAttribute("Material");var h,d,p=[];!function(){for(var e=0;e<t.getNumTextureAttributeLists();e++){var i=t.getTextureAttribute(e,"Texture");void 0!==i&&("PackedMaterialTexture"===i.className()&&(i=i.getTexture()),p[e]=i)}}();var f=function(e,i,r){t.removeTextureAttribute(e,"Texture");var a=n.getChannels()[r];a.setTextureModel(this.createTextureModelFromTextureOSG(i)),a.resetTextureFormat(),a.setTexCoordUnit(e),a.setEnable(!0)}.bind(this);if(s="unit",r=o("emissive",s),void 0!==r&&(h=r,void 0!==(d=p[h])&&f(h,d,"EmitColor")),r=o("diffuse",s),void 0!==r&&(h=r,void 0!==(d=p[h])&&f(h,d,"DiffuseColor")),r=o("specular",s),void 0!==r&&(h=r,void 0!==(d=p[h])&&f(h,d,"SpecularColor")),void 0!==i.extra_shininess_unit&&(h=JSON.parse(i.extra_shininess_unit),void 0!==(d=p[h])&&f(h,d,"SpecularColor")),void 0!==(r=o("transparency",s))&&(h=r,void 0!==(d=p[h]))){o("transparency","alphamask")?(f(h,d,"Opacity"),d=n.getChannels().Opacity.getTextureModel(),n.getChannels().Opacity.setTransparency("alphaMask")):(f(h,d,"Opacity"),d=n.getChannels().Opacity.getTextureModel(),n.getChannels().Opacity.setTransparency("alphaBlend"))}void 0!==i.extra_bump_unit&&(h=JSON.parse(i.extra_bump_unit),d=p[h],void 0!==d&&f(h,d,"BumpMap"),i.extra_bump_amount&&(r=JSON.parse(i.extra_bump_amount),n.setChannelFactor("BumpMap",r))),void 0!==i.extra_normal_unit&&(h=JSON.parse(i.extra_normal_unit),d=p[h],void 0!==d&&f(h,d,"NormalMap"),i.extra_normal_amount&&(r=JSON.parse(i.extra_normal_amount),n.setChannelFactor("NormalMap",r))),t.removeAttribute("Material"),n.setStateSet(t)}})),t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(366),a=r.a.osg,o=function(){n.a.apply(this,arguments)};a.createPrototypeObject(o,a.objectInherit(n.a.prototype,{processMaterial:function(e,t){return this.processDefaultMaterial(e,t)},processDefaultMaterial:function(e,t){var i=this.createMaterial(e,t),r=t.getAttribute("Material");return void 0!==r&&(i.setChannelColor("EmitColor",r.getAmbient()),i.setChannelColor("DiffuseColor",r.getDiffuse()),i.setChannelColor("SpecularColor",r.getSpecular()),i.setChannelFactor("SpecularHardness",r.getShininess()),i.setChannelFactor("Opacity",r.getDiffuse()[3]),i.setChannelEnable("EmitColor",!0),i.setChannelEnable("DiffuseColor",!0),i.setChannelEnable("SpecularColor",!0),i.setChannelEnable("SpecularHardness",!0),i.setChannelEnable("Opacity",!0),t.removeAttribute("Material")),this.mapTexturesOnMaterial(t,i),i.setStateSet(t),i}})),t.a=o},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=i(366),o=i(436),s=n.a.osg,u=function(){a.a.apply(this,arguments)};s.createPrototypeObject(u,s.objectInherit(a.a.prototype,{setChannelsFromMetaData:function(e,t,n,a){i.i(r.each)(a,function(i,r){if(void 0!==e[r]){var a=JSON.parse(e[r]);if(t[n](i,a),t.setChannelEnable(i,!0),"SpecularHardness"===i){var o=e.PhongSpecularColor?JSON.parse(e.PhongSpecularColor):[0,0,0];this.setGlossinessPBRFromSpecularGlossiness(t,o,a)}}}.bind(this))},setMaterialChannelTexture:function(e,t,i,r,n){e.removeTextureAttribute(i,"Texture");var a=t.getChannels()[n];a.setTextureModel(this.createTextureModelFromTextureOSG(r)),a.resetTextureFormat(),a.setTexCoordUnit(i),a.setFactor(1),a.setEnable(!0)},getReferencedTextures:function(e){for(var t=[],i=0;i<e.getNumTextureAttributeLists();i++){var r=e.getTextureAttribute(i,"Texture");void 0!==r&&("PackedMaterialTexture"===r.className()&&(r=r.getTexture()),t[i]=r)}return t},processLightSource:function(e){var t=e.getLight();if(t){var i=t.getUserData();if(void 0!==i&&t.typeID!==o.a.typeID){var r=this.convertUserDataToObject(i),n=new o.a;if("directional"===r.Type)n.setLightType("DIRECTION");else if("point"===r.Type)n.setLightType("POINT");else{if("spot"!==r.Type)return;n.setLightType("SPOT")}if("spot"===r.Type){n.setSpotCutoff(JSON.parse(r.OuterAngle)/2);var a=JSON.parse(r.InnerAngle)/JSON.parse(r.OuterAngle);n.setSpotBlend(a!==a||Math.abs(a)===1/0?.5:Math.min(a,1))}s.vec3.scale(n.getDiffuse(),JSON.parse(r.Color),JSON.parse(r.Intensity)/100);var u=1/JSON.parse(r.DecayStart);n.setQuadraticAttenuation(Math.abs(u)===1/0?0:u),this.pushLight(n)}}},processMaterial:function(e,t,n){var a=this.createMaterial(e,t),o={LambertDiffuseColor:"DiffuseColor",LambertEmissiveColor:"EmitColor",PhongSpecularColor:"SpecularColor"},u={sDiffuse:"DiffuseColor",sNormalMap:"NormalMap",sBump:"BumpMap",sEmissive:"EmitColor",sSpecular:"SpecularColor",sOpacity:"Opacity",sAo:"AOPBR",sRoughness:"RoughnessPBR",sMetallic:"MetalnessPBR"},l={LambertDiffuseFactor:"DiffuseColor",LambertBumpFactor:"BumpMap",LambertEmissiveFactor:"EmitColor",PhongSpecularFactor:"SpecularColor",PhongShininess:"SpecularHardness"};this.setChannelsFromMetaData(n,a,"setChannelColor",o),this.setChannelsFromMetaData(n,a,"setChannelFactor",l),t.removeAttribute("Material");var c=this.getReferencedTextures(t);if(i.i(r.each)(u,function(e,i){if(void 0!==n[i]){var r=JSON.parse(n[i]),o=c[r];void 0!==o&&this.setMaterialChannelTexture(t,a,r,o,e)}}.bind(this)),n.LambertBumpFactor&&!n.sBump&&a.getChannels().BumpMap.setEnable(!1),"Tilt Brush"===this._authoringTool){var h=a.getChannels(),d=h.EmitColor;d.set("type","multiplicative"),d.getTextureModel()||0===d.getColor()[0]&&0===d.getColor()[1]&&0===d.getColor()[2]&&d.setColor(s.vec3.fromValues(1,1,1)),h.SpecularF0.setFactor(0),h.RoughnessPBR.setFactor(1);var p=n.BlendMode;"AlphaMask"===p?(h.Opacity.setFactor(JSON.parse(n.LambertTransparencyFactor||0)),h.Opacity.setTransparency("alphaMask")):"AdditiveBlend"===p?(h.Opacity.setFactor(1-JSON.parse(n.LambertTransparencyFactor||0)),h.Opacity.setTransparency("additive")):h.Opacity.setEnable(!1)}a.setStateSet(t)}})),t.a=u},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=n.a.osg,o=function(){a.NodeVisitor.call(this,a.NodeVisitor.TRAVERSE_ALL_CHILDREN)};a.createPrototypeObject(o,a.objectInherit(a.NodeVisitor.prototype,{getSource:function(){return this._source},getAuthoringTool:function(){return this._authoringTool},extractSource:function(e){var t=i.i(r.find)(e,function(e){return"source"===e.Name});if(t)return t.Value},checkStateSet:function(e){e&&e.getUserData()&&(this._source=this.extractSource(e.getUserData()))},checkNode:function(e){var t=e.getUserData();if(!t&&"LightSource"===e.className()){var n=e.getLight();n&&(t=n.getUserData())}var a=this;t&&i.i(r.each)(t,function(e){"source"===e.Name?a._source=e.Value:"authoring_tool"===e.Name&&(a._authoringTool=e.Value)})},apply:function(e){this.checkNode(e),this._source||this.checkStateSet(e.getStateSet()),this._source||this.traverse(e)}})),t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(0),a=(i.n(n),i(366)),o=r.a.osg,s=function(){a.a.apply(this,arguments)};o.createPrototypeObject(s,o.objectInherit(a.a.prototype,{setChannelsFromMetaData:function(e,t,r,a){i.i(n.each)(a,function(i,n){if(void 0!==e[n]){var a=JSON.parse(e[n]);t[r](i,a),t.setChannelEnable(i,!0),"MetalnessPBR"===i&&(this._hasMetal=!0),"SpecularPBR"===i&&void 0===this._hasMetal?(t.setChannelFactor(i,1),this._hasMetal=!1):"EmitColor"===i?t.setChannelFactor(i,1):"GlossinessPBR"===i&&void 0===this._globalEnforceRoughness?this._globalEnforceRoughness=!1:"RoughnessPBR"===i&&(this._globalEnforceRoughness=!0)}}.bind(this))},setMaterialChannelTexture:function(e,t,i,r,n){e.removeTextureAttribute(i,"Texture");var a=t.getChannels()[n],o=this.createTextureModelFromTextureOSG(r);a.setTextureModel(o),a.resetTextureFormat(),a.setTexCoordUnit(i),a.setFactor(1),a.setEnable(!0),"AOPBR"===n&&(a.set("occludeSpecular",!0),a=t.getChannels().CavityPBR,a.setTextureModel(this.createTextureModelFromTextureOSG(r)),a.resetTextureFormat(),a.setTexCoordUnit(i),a.setFactor(1),a.setEnable(!0))},getReferencedTextures:function(e){for(var t=[],i=0;i<e.getNumTextureAttributeLists();i++){var r=e.getTextureAttribute(i,"Texture");void 0!==r&&("PackedMaterialTexture"===r.className()&&(r=r.getTexture()),t[i]=r)}return t},processMaterial:function(e,t,r){var a=this.createMaterial(e,t);t.removeAttribute("Material");var s={DiffuseFactor:"DiffuseColor",SpecularPBRFactor:"SpecularPBR",EmissiveFactor:"EmitColor"},u={MetallicFactor:"MetalnessPBR",RoughnessFactor:"RoughnessPBR",GlossinessPBRFactor:"GlossinessPBR",AOFactor:"AOPBR",NormalFactor:"NormalMap"},l={sDiffuse:"DiffuseColor",sMetallic:"MetalnessPBR",sRoughness:"RoughnessPBR",sSpecularPBR:"SpecularPBR",sGlossinessPBR:"GlossinessPBR",sNormalMap:"NormalMap",sBump:"BumpMap",sEmissive:"EmitColor",sOpacity:"Opacity",sAO:"AOPBR"},c=this.getReferencedTextures(t);this.setChannelsFromMetaData(r,a,"setChannelColor",s),i.i(n.each)(l,function(e,i){if(void 0!==r[i]){var n=JSON.parse(r[i]),o=c[n];void 0!==o&&this.setMaterialChannelTexture(t,a,n,o,e)}}.bind(this)),this.setChannelsFromMetaData(r,a,"setChannelFactor",u),void 0!==r.EmissiveFactor&&void 0!==r.EmissiveFactor[0]&&this.hasTextureChannel(a,"EmitColor")?a.setChannelFactor("EmitColor",JSON.parse(r.EmissiveFactor)[0]):a.setChannelFactor("EmitColor",1);var h=a.getChannels().Opacity;if(this.hasTextureChannel(a,"DiffuseColor")){var d=a.getChannels().DiffuseColor,p=d.getTextureModel().getImageModel();if(void 0!==p&&!0===p.get("alpha")){var f=d.getTextureModel().clone();f.set("internalFormat",o.Texture.ALPHA),f.updateMultiresTexture(),h.setTextureModel(f),h.setTexCoordUnit(d.getTexCoordUnit())}}"BLEND"===r.alphaMode?this.hasTextureChannel(a,"Opacity")||void 0===r.DiffuseFactor||4!==JSON.parse(r.DiffuseFactor).length||h.setFactor(JSON.parse(r.DiffuseFactor)[3]):"MASK"===r.alphaMode&&(h.setTransparency("alphaMask"),h.setFactor(JSON.parse(r.alphaCutoff||0))),a.getChannels().NormalMap.set("flipY",void 0!==r.yUp&&!1===JSON.parse(r.yUp)),void 0!==r.doubleSided&&!1!==JSON.parse(r.doubleSided)||a.set("cullFace",o.CullFace.BACK),this.copyDiffuse(a),a.setStateSet(t)}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(366),a=r.a.osg,o=function(){n.a.apply(this,arguments)};a.createPrototypeObject(o,a.objectInherit(n.a.prototype,{processMaterial:function(e,t,i){var r,n,o=this.createMaterial(e,t),s=function(e){for(var t=[],i=0;i<e.getNumTextureAttributeLists();i++){var r=e.getTextureAttribute(i,"Texture");void 0!==r&&("PackedMaterialTexture"===r.className()&&(r=r.getTexture()),t[i]=r)}return t}(t),u=function(e,t,i,r){e.removeTextureAttribute(t,"Texture");var n=o.getChannels()[r];n.setTextureModel(this.createTextureModelFromTextureOSG(i)),n.resetTextureFormat(),n.setTexCoordUnit(0),n.setEnable(!0)}.bind(this);void 0!==i.diffuse&&(r=JSON.parse(i.diffuse),void 0!==(n=s[r])&&u(t,r,n,"DiffuseColor")),void 0!==i.specular&&(r=JSON.parse(i.specular),void 0!==(n=s[r])&&u(t,r,n,"SpecularColor")),void 0!==i.transparency&&(r=JSON.parse(i.transparency),void 0!==(n=s[r])&&(u(t,r,n,"Opacity"),t.setRenderingHint("TRANSPARENT_BIN"),t.setTextureAttributeAndModes(r,n),t.setAttributeAndModes(new a.BlendFunc("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")))),t.removeAttribute("Material"),o.setStateSet(t)}})),t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(366),a=i(734),o=i(436),s=r.a.osg,u=function(){n.a.apply(this,arguments)};s.createPrototypeObject(u,s.objectInherit(a.a.prototype,{isSelfIlluminationSurface:function(e){if(!e.length)return!1;var t=e[0],i=t.getImage().getURL().split("/").pop().split(".").shift();return!!(i.match("carrot_crop_(.*)")||i.match("crops_(.*)")||"fern"===i||"dead_shrub"===i||"flower_red"===i||"flower_yellow"===i||"lilypad"===i||"mushroom_brown"===i||"mushroom_red"===i||i.match("netherwart_(.*)")||i.match("potato_crop_(.*)")||i.match("sapling_(.*)")||"tall_grass"===i||"torch"===i||"torch_flame"===i)},getReferencedTextures:function(e){for(var t=[],i=0;i<e.getNumTextureAttributeLists();i++){var r=e.getTextureAttribute(i,"Texture");void 0!==r&&("PackedMaterialTexture"===r.className()&&(r=r.getTexture()),t[i]=r)}return t},setMaterialChannelTexture:function(e,t,i,r,n,a,o){e.removeTextureAttribute(i,"Texture");var u=t.getChannels()[n],l=this.createTextureModelFromTextureOSG(r);l.set("wrapT",s.Texture[a]),l.set("wrapS",s.Texture[a]),o&&(l.set("minFilter",s.Texture.NEAREST_MIPMAP_LINEAR),l.set("magFilter",s.Texture.NEAREST),l.updateMultiresTexture()),u.setTextureModel(l),u.resetTextureFormat(),u.setTexCoordUnit(0),u.setEnable(!0)},processMaterial:function(e,t,i){var r=this.createMaterial(e,t),n={kd:"DiffuseColor"},a={tr:"Opacity",d:"Opacity"};this.setChannelsFromMetaData(i,r,"setChannelColor",n),this.setChannelsFromMetaData(i,r,"setChannelFactor",a),void 0!==i.ka&&(r.setChannelFactor("EmitColor",.1),r.setChannelEnable("EmitColor",!0)),r.setChannelColor("SpecularColor",s.vec3.create()),r.setChannelEnable("SpecularColor",!0),r.setChannelFactor("SpecularHardness",1),r.setChannelEnable("SpecularHardness",!0),this.verifyOpacity(r),t.removeAttribute("Material");var u,l,c="mineways"===i.source,h=this.getReferencedTextures(t),d=this.isSelfIlluminationSurface(h),p=d?"CLAMP_TO_EDGE":"REPEAT";if(void 0!==i.map_kd&&(u=JSON.parse(i.map_kd),void 0!==(l=h[u])&&this.setMaterialChannelTexture(t,r,u,l,"DiffuseColor",p,c)),d||(void 0!==i.map_ke?(u=JSON.parse(i.map_ke),void 0!==(l=h[u])&&(this.setMaterialChannelTexture(t,r,u,l,"EmitColor",p,c),r.setChannelFactor("EmitColor",1))):void 0!==i.map_ka?(u=JSON.parse(i.map_ka),void 0!==(l=h[u])&&this.setMaterialChannelTexture(t,r,u,l,"EmitColor",p,c)):(u=JSON.parse(i.map_kd),void 0!==(l=h[u])&&(this.setMaterialChannelTexture(t,r,u,l,"EmitColor",p,c),r.setChannelFactor("EmitColor",.1)))),d&&(r.set("shadeless",!0),r.setChannelFactor("EmitColor",0),r.setChannelEnable("EmitColor",!0)),void 0!==i.map_d&&(u=JSON.parse(i.map_d),void 0!==(l=h[u]))){this.setMaterialChannelTexture(t,r,u,l,"Opacity",p,c);var f=r.getChannels().Opacity;c?(f.getTextureModel().set("internalFormat",s.Texture.ALPHA),-1!==r.attributes.name.toLowerCase().indexOf("leaves")&&(f.setTransparency("alphaMask"),r.setChannelFactor("Opacity",.2))):(f.getTextureModel().set("internalFormat",s.Texture.LUMINANCE),f.setTransparency("alphaBlend")),r.set("cullFace",s.CullFace.BACK)}if(r.setChannelFactor("RoughnessPBR",1),r.setChannelFactor("SpecularF0",0),t.removeAttribute("Material"),r.setStateSet(t),!this._lights.length){var g=new o.a;g.setLightType("DIRECTION"),s.vec3.set(g.getDiffuse(),1,1,1),this._lights.push(g),g._worldMatrix=s.mat4.fromRotation(s.mat4.create(),Math.PI/6,s.vec3.fromValues(1,1,0))}}})),t.a=u},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=function(e){n.NodeVisitor.call(this,n.NodeVisitor.TRAVERSE_ALL_CHILDREN),this.stateSetStack=[],this.countGeometryStack={},this.removedStateSet=[],this.keepedStateSet=[],this.deep=0,this.materialRootList=e||{}};n.createPrototypeObject(a,n.objectInherit(n.NodeVisitor.prototype,{getCurrentStateSet:function(){return this.stateSetStack[this.stateSetStack.length-1]},getCurrentGeometryCount:function(){return void 0===this.countGeometryStack[this.getCurrentStateSet().getInstanceID()]&&(this.countGeometryStack[this.getCurrentStateSet().getInstanceID()]=0),this.countGeometryStack[this.getCurrentStateSet().getInstanceID()]},setCurrentGeometryCount:function(e){this.countGeometryStack[this.getCurrentStateSet().getInstanceID()]=e},updateStateSetGeometryCount:function(e){var t=this.getCurrentGeometryCount();t+=e,this.setCurrentGeometryCount(t)},logTree:function(e,t){for(var i="";e--;)i+="    ";n.debug(i+t)},apply:function(e){var t=e.getStateSet();if(t&&(this.stateSetStack.push(t),this.deep++,this.logTree(this.deep,t._uniqueID+" >>>")),this.traverse(e),e instanceof n.Geometry&&(this.updateStateSetGeometryCount(1),this.logTree(this.deep," Geom")),t){if(this.logTree(this.deep,t._uniqueID+" <<< geom children num "+this.getCurrentGeometryCount()),0===this.getCurrentGeometryCount())this.removedStateSet.push(t._uniqueID);else{var i=!0,r=t._uniqueID,a=this.stateSetStack.length;if(a-- >1)for(;a-- >0;){var o=this.stateSetStack[a],s=this.materialRootList[o._uniqueID];if(s&&s.rootMaterialToKeep)if(2===Object.keys(this.materialRootList).length){var u=this.materialRootList[r];if(u){var l=s.getChannels(),c=u.getChannels();for(var h in l)l[h].get("textureModel")&&c[h].setTextureModel(l[h].get("textureModel"))}}else s.rootMaterialDidOverride=!0,t._uniqueID=s.attributes.stateSetID,i=!1,this.keepedStateSet.push(s.attributes.stateSetID)}i?this.keepedStateSet.push(r):this.removedStateSet.push(r)}this.stateSetStack.pop(),this.deep--}}})),t.a=a},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=function(){n.NodeVisitor.call(this,n.NodeVisitor.TRAVERSE_ALL_CHILDREN),this._paths=[],this._pathsStateSet=[],this._currentStateSet=[],this._stateSetMap={},this._stateSetMapNodes={},this._wireframePaths=[],this._noGeometryPaths=[],this.nodeMaskOverride=-1};n.createPrototypeObject(a,n.objectInherit(n.NodeVisitor.prototype,{getPathList:function(){return this._paths},getStateSetMap:function(){return this._stateSetMap},getStateSetMapNodes:function(){return this._stateSetMapNodes},getStateSetPathList:function(){return this._pathsStateSet},getWireframePathList:function(){return this._wireframePaths},getNoGeometryPathList:function(){return this._noGeometryPaths},apply:function(e){var t=e.getStateSet();if(t){var i=t._uniqueID;this._stateSetMap[i]?this._stateSetMapNodes[i].push(e):(this._stateSetMap[i]=t,this._stateSetMapNodes[i]=[]),this._currentStateSet.push(t)}e instanceof n.Geometry?e.userDataMap&&e.userDataMap.wireframe?this._wireframePaths.push(this.nodePath.slice(0)):(this._pathsStateSet.push(this._currentStateSet.slice(0)),this._paths.push(this.nodePath.slice(0))):(this.traverse(e),0===e.getChildren().length&&this._noGeometryPaths.push(this.nodePath.slice(0))),t&&this._currentStateSet.pop()}})),t.a=a},,function(e,t,i){"use strict";var r=i(19),n=i.n(r),a=i(5),o=i(337),s=a.a.osg,u=n.a.Model.extend({defaults:{matrix:s.mat4.create(),showGizmo:!1},getName:function(){return"Orientation"},init:function(e){var t=e.getModel().get("options").orientation.matrix;t&&this.set("matrix",t)},getJSON:function(){return{matrix:this.get("matrix")}},editorGetJSON:function(){return this.getJSON()},validateJSON:function(e){return o.a.isArrayNumber(e.matrix,16)?"":"Orientation.editorSetJSON matrix must be a mat4"},editorSetJSON:function(e){var t=this.validateJSON(e);return t||(this.set("matrix",e.matrix),t)}});t.a=u},function(e,t,i){"use strict";var r=i(5),n=i(737),a=i(129),o=i(852),s=i.n(o),u=i(851),l=i.n(u),c=i(850),h=i.n(c),d=i(849),p=i.n(d),f=i(69),g=i(86),m=r.a.osg,v=function(e){m.MatrixTransform.call(this),this._colorUniform=m.Uniform.createFloat4(m.vec4.fromValues(.5,.5,.5,0),"uColor"),e&&m.vec4.copy(this._colorUniform.get(),e),this._callbackColor=new n.a(this._colorUniform,1),this._timeGrid=0,this.init()};m.createPrototypeNode(v,m.objectInherit(m.MatrixTransform.prototype,{init:function(){this._visible=!1,this.addChild(m.createGridGeometry(-1,-1,0,2,0,0,0,2,0,10,10)),this.addChild(m.createAxisGeometry(1)),this._boundingSphereComputed=!0,this._boundingBoxComputed=!0;var e=this.getOrCreateStateSet();e.setAttributeAndModes(new m.Depth(m.Depth.LEQUAL)),e.setAttributeAndModes(new m.BlendFunc(m.BlendFunc.ONE,m.BlendFunc.ONE_MINUS_SRC_ALPHA)),e.setRenderBinDetails(g.a.GRID,"RenderBin"),e.addUniform(this._colorUniform),e.setAttributeAndModes(a.a.createShader(s.a,l.a,"orientation-grid","Grid")),this.getChildren()[1].getOrCreateStateSet().setAttributeAndModes(a.a.createShader(h.a,p.a,"orientation-axis","OrientationAxis")),this.addUpdateCallback(this._callbackColor),this.setNodeMask(0)},showGridTemporary:function(e){this._visible=!0,this.setNodeMask(f.a.NO_PICK_NO_SHADOW),this._callbackColor.show(),window.clearTimeout(this._timeGrid),e&&(this._timeGrid=window.setTimeout(this.hideGrid.bind(this),1e3*e))},isVisible:function(){return this._visible},hideGrid:function(){this._timeGrid=0,this._visible=!1,this._callbackColor.hide()}}),"osgSketchfab","Grid"),t.a=v},function(e,t,i){"use strict";var r=i(89),n=i(1039),a=i(1043),o={FeatureName:"orientation",ModelType:n.a,ViewListType:[a.a]},s=r.a.create(o);s.prototype.getNode=function(){return this._views[0].getNodeOrientation()},s.prototype.getWidgetNode=function(){return this._views[0].getNodeGrid()},t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(512),a=i(53),o=r.a.osg,s=function(e,t,i,r){this._model=i.model,this._manipulator=e,this._applyWithoutTranslation=!1,this._quatCurrent=o.mat4.getRotation(o.quat.create(),this._model.get("matrix")),this._quatTarget=o.quat.create(),this._quatStart=o.quat.create(),this._nodeGrid=i._nodeGrid,n.a.call(this,t),this._finished=!0,this._nodeGizmo=i._nodeGizmo,this._gizmoTra=i._gizmoTra,this._gizmoMode=!1,this._rootModel=r,this._features=i.options.context.getFeatures()};o.createPrototypeObject(s,o.objectInherit(n.a.prototype,{setQuatTarget:function(e){o.quat.copy(this._quatStart,this._quatCurrent),o.quat.copy(this._quatTarget,e),this.reset(),this._gizmoMode=!1},setGizmoMode:function(e){this._gizmoMode=e},getQuatTarget:function(){return this._quatTarget},getQuatStart:function(){return this._quatStart},update:function(e,t){if(this._gizmoMode)return o.mat4.getRotation(this._quatCurrent,this._nodeGizmo.getMatrix()),this.rotateNode(e),!0;if(this._finished)return!0;a.a.draw();var i=t.getFrameStamp().getSimulationTime(),r=this.interpolate(i,e,t);return r=o.smoothStep(0,1,r),o.quat.slerp(this._quatCurrent,this._quatStart,this._quatTarget,r),this.rotateNode(e),this._finished&&(o.mat4.fromQuat(this._nodeGizmo.getMatrix(),this._quatCurrent),this._gizmoMode=this._model.get("showGizmo")),!0},rotateNode:function(){var e=o.mat4.create(),t=o.vec3.create();return function(i){var r=i.getMatrix();o.mat4.fromQuat(r,this._quatCurrent);var n=this._gizmoTra.getMatrix(),a=this._rootModel.getMinimumBound(),s=a.center();if(o.vec3.negate(s,s),o.mat4.fromTranslation(n,s),o.mat4.multiply(r,r,n),o.vec3.negate(s,s),o.mat4.fromTranslation(n,s),o.mat4.multiply(r,n,r),this._nodeGrid){o.mat4.invert(e,r);var u=this._nodeGrid.getMatrix(),l=o.mat4.create(),c=a.radius();o.mat4.fromScaling(l,o.vec3.set(t,c,c,c)),o.mat4.fromTranslation(u,s),o.mat4.multiply(u,u,l),o.mat4.multiply(u,e,u)}this.updateShadows(),i.dirtyBound()}}(),updateShadows:function(){var e=this._features.lighting;if(e)for(var t=e.getModel().get("lights"),i=0,r=t.length;i<r;++i)t[i].dirty()}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(4),a=i(1042),o=i(1040),s=r.a.osg,u=r.a.osgUtil,l=n.a.extend({initialize:function(){n.a.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:matrix",this.onMatrixChanged,this),e.bind("change:showGizmo",this.onGizmoShowChanged,this),e.bind("turn",this.onTurn,this),e.bind("reset",this.onReset,this);var t=this.options.context;this._viewer=t.getViewer();var i=this._viewer.getViewerOSGJS().getManipulator();this._nodeGrid=new o.a,this._nodeGrid.setName("Node grid"),this._nodeOrientation=new s.MatrixTransform,this._nodeOrientation.setName("Feature - Orientation"),this._nodeOrientation.addChild(this._nodeGrid),this._nodeGizmo=new s.MatrixTransform,this._nodeGizmo.setCullingActive(!1),this._nodeGizmo.editMask=u.NodeGizmo.PICK_ARC,this._gizmoTra=new s.MatrixTransform,this._gizmoTra.setReferenceFrame(s.Transform.ABSOLUTE_RF),this._gizmoTra.addChild(this._nodeGizmo),this._callbackOrientation=new a.a(i,.5,this,t.getScene().getRoot()),this._nodeOrientation.addUpdateCallback(this._callbackOrientation),this._callbackOrientation.rotateNode(this._nodeOrientation);var r=this.model.get("matrix");this._nodeOrientation.setMatrix(r),s.mat4.fromQuat(this._nodeGizmo.getMatrix(),s.mat4.getRotation(s.quat.create(),r))},onReset:function(){var e=s.mat4.getTranslation(s.vec3.create(),this.model.get("matrix"));s.mat4.fromTranslation(this.model.get("matrix"),e),this.onMatrixChanged()},onTurn:function(e,t){var i="right"===t?1:-1,r="x"===e?i:0,n="y"===e?i:0,a="z"===e?i:0,o=s.mat4.fromRotation(s.mat4.create(),-Math.PI/2,s.vec3.fromValues(r,n,a)),u=this.model.get("matrix");s.mat4.multiply(u,o,u),this.onMatrixChanged()},onGizmoShowChanged:function(){var e=this.model.get("showGizmo"),t=this._viewer.getFeaturesManager();if(t){var i=t.getNodeGizmo();i&&(s.mat4.fromQuat(this._nodeGizmo.getMatrix(),s.mat4.getRotation(s.quat.create(),this.model.get("matrix"))),i.setForcePicking(e),i.setRotateInLocal(!e),i.setTranslateInLocal(!e),i.attachToMatrixTransform(e?this._nodeGizmo:null),this._nodeGrid.showGridTemporary(e?0:5),this._callbackOrientation.setGizmoMode(e))}},onMatrixChanged:function(){this.model.get("showGizmo")||this._nodeGrid.showGridTemporary(5),this._callbackOrientation.setQuatTarget(s.mat4.getRotation(s.quat.create(),this.model.get("matrix")))},getNodeGrid:function(){return this._nodeGrid},getNodeOrientation:function(){return this._nodeOrientation}});t.a=l},function(e,t,i){"use strict";var r=i(5),n=i(19),a=i.n(n),o=r.a.osg,s=a.a.Model.extend({defaults:{color:o.vec3.fromValues(1,0,1)},getName:function(){return"Outline"}});t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(69),a=i(86),o=i(513),s=i(53),u=r.a.osg,l=r.a.osgUtil,c=function(e,t){u.Node.call(this),this._viewer=e,this._color=void 0!==t?t:u.vec3.fromValues(1,0,1),this._timeoutDuration=1e4,this._nodeProxy=new u.Node,this._outlineScene=new u.Node,this._timer=void 0,this._sobel=void 0,this._paths=void 0,this._width=e.getCanvasWidth(),this._height=e.getCanvasHeight(),this.init()};u.createPrototypeNode(c,u.objectInherit(u.Node.prototype,{setColor:function(e){this._color=e},clearOutlineScene:function(){for(var e=this._outlineScene,t=e.getChildren(),i=0,r=t.length;i<r;++i)t[i].removeChildren();e.removeChildren()},setScene:function(){var e=function(e){this._path=e};return u.createPrototypeObject(e,{update:function(t){return t.setMatrix(u.computeLocalToWorld(this._path)),e}}),function(t){this.clearOutlineScene();for(var r=this._outlineScene,n=0,a=t.length;n<a;++n){var s=t[n],l=new u.MatrixTransform;r.addChild(l),l.addChild(s[s.length-1]),i.i(o.a)(s)?l.addUpdateCallback(new e(s)):l.setMatrix(u.computeLocalToWorld(s))}}}(),hideOutline:function(){this._nodeProxy.setNodeMask(0),void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)},showOutline:function(){this._nodeProxy.setNodeMask(n.a.NO_PICK_NO_SHADOW),void 0!==this._timer&&clearTimeout(this._timer);var e=this;this._timer=setTimeout(function(){e._timer=void 0,e._nodeProxy.setNodeMask(0),s.a.draw()},this._timeoutDuration)},getOrCreateTextureRTT:function(){var e=this._viewer,t=e.getCanvasWidth(),i=e.getCanvasHeight();if(this.textureRTT)return this.textureRTT.setTextureSize(t,i),this.textureRTT;var r=this.textureRTT=new u.Texture;return r.setTextureSize(t,i),r.setInternalFormat(u.Texture.RGBA),r.setMinFilter(u.Texture.NEAREST),r.setMagFilter(u.Texture.NEAREST),r},createCamera:function(e){var t=this.createSubGraphRTT(e);return t.getOrCreateStateSet().setShaderGeneratorName("outline",u.StateAttribute.OVERRIDE|u.StateAttribute.ON),t.setName("Outline Camera"),t},createSubGraphRTT:function(e){var t=this.getOrCreateTextureRTT(),i=new u.Camera;return i.setViewport(new u.Viewport(0,0,t.getWidth(),t.getHeight())),i.setClearColor(u.vec4.create()),i.setRenderOrder(u.Camera.PRE_RENDER,0),i.attachTexture(u.FrameBufferObject.COLOR_ATTACHMENT0,t),i.attachRenderBuffer(u.FrameBufferObject.DEPTH_ATTACHMENT,u.FrameBufferObject.DEPTH_COMPONENT16),i.addChild(e),i},createComposer:function(e){var t=new l.Composer;return t.addPass(new l.Composer.Filter.InputTexture(this.getOrCreateTextureRTT())),t.addPass(e),t.renderToScreen(this._viewer.getCanvasWidth(),this._viewer.getCanvasHeight()),t.build(),t},createRttAndComposer:function(e){var t=this.createCamera(this._outlineScene);this._nodeProxy.addChild(t),this._nodeProxy.addChild(this.createComposer(e))},init:function(){this.addChild(this._nodeProxy),this._nodeProxy.setNodeMask(0);var e=new u.CullFace(u.CullFace.DISABLE);this._outlineScene.getOrCreateStateSet().setAttributeAndModes(e,u.StateAttribute.OVERRIDE|u.StateAttribute.ON);var t=this._sobel=new l.Composer.Filter.SobelFilter;t.setColor(this._color),t.setFactor(.25),t.getOrCreateStateSet().setAttributeAndModes(new u.BlendFunc(u.BlendFunc.ONE,u.BlendFunc.ONE_MINUS_SRC_ALPHA)),t.getOrCreateStateSet().setRenderBinDetails(a.a.OUTLINE,"RenderBin"),this.createRttAndComposer(t),this._nodeProxy.addUpdateCallback(this)},update:function(e){var t=this._viewer;if(t.getCanvasWidth()===this._width&&t.getCanvasHeight()===this._height)return!0;this._width=t.getCanvasWidth(),this._height=t.getCanvasHeight();var i=e.getChildren(),r=i[0],n=this.getOrCreateTextureRTT();return r.setViewport(new u.Viewport(0,0,n.getWidth(),n.getHeight())),r.attachTexture(u.FrameBufferObject.COLOR_ATTACHMENT0,n),e.removeChild(i[1]),e.addChild(this.createComposer(this._sobel)),!0}}),"osgSketchfab","Outline"),t.a=c},function(e,t,i){"use strict";var r=i(89),n=i(1044),a=i(1047),o={FeatureName:"outline",ModelType:n.a,ViewListType:[a.a]},s=r.a.create(o);s.prototype.getNode=function(){return this._views[0].getNodeOutline()},s.prototype.prepareForScreenShot=function(){return this.getNode().hideOutline(),!1},t.a=s},function(e,t,i){"use strict";var r=i(4),n=i(1045),a=i(1088),o=r.a.extend({initialize:function(){r.a.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:color",this.onColorChanged,this);var t=this.options.context.getViewer().getViewerOSGJS();t.getState().getShaderGeneratorProxy().addShaderGenerator("outline",new a.a),this._nodeOutline=new n.a(t,e.get("color")),this._nodeOutline.setName("Feature - Outline")},onColorChanged:function(){this._nodeOutline.setColor(this.model.get("color"))},getNodeOutline:function(){return this._nodeOutline}});t.a=o},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=r.a.osgShader,o=a.node.NodeFunctions,s=a.utils,u=function(){o.apply(this)};n.createPrototypeObject(u,n.objectInherit(o.prototype,{globalFunctionDeclaration:function(){return'#pragma include "sketchfabFunctions.glsl"'}}));var l=a.node.LinearTosRGB,c=function(){l.apply(this)};n.createPrototypeObject(c,n.objectInherit(l.prototype,{type:"LinearTosRGBWithTest",validInputs:["color","keepLinear"],validOutputs:["color"],computeShader:function(){var e=this._outputs.color,t=this._inputs.color,i=this._inputs.keepLinear,r=e.getType()!==t.getType()?".rgb":"";return["if("+i.getVariable()+" == 1 ) {",e.getVariable()+r+"= "+t.getVariable()+r+";","} else {",l.prototype.computeShader.call(this)+"}"].join("\n")}}));var h=function(){u.apply(this)};n.createPrototypeObject(h,n.objectInherit(u.prototype,{type:"NormalTangentSpace",validInputs:["tangent","normal","texNormal"],validOutputs:["normal"],computeShader:function(){var e=this._inputs;return s.callFunction("mtexNspaceTangent",this._outputs.normal,[e.tangent,e.normal,e.texNormal])}}));var d=function(){u.apply(this)};n.createPrototypeObject(d,n.objectInherit(u.prototype,{type:"Bumpmap",validInputs:["tangent","normal","gradient"],validOutputs:["normal"],computeShader:function(){var e=this._inputs;return s.callFunction("bumpMap",this._outputs.normal,[e.tangent,e.normal,e.gradient])}}));var p=function(){u.apply(this)};n.createPrototypeObject(p,n.objectInherit(u.prototype,{type:"NormalMatcap",validInputs:["normal","eye"],validOutputs:["uv"],computeShader:function(){return s.callFunction("normalMatcap",this._outputs.uv,[this._inputs.normal,this._inputs.eye])}}));var f=function(){u.apply(this)};n.createPrototypeObject(f,n.objectInherit(u.prototype,{type:"RGBToNormal",validInputs:["normal","flipY"],validOutputs:["normal"],computeShader:function(){return s.callFunction("rgbToNormal",this._outputs.normal,[this._inputs.normal,this._inputs.flipY])}}));var g=function(){u.apply(this)};n.createPrototypeObject(g,n.objectInherit(u.prototype,{type:"AdjustSpecular",validInputs:["specular","normal"],validOutputs:["specular"],computeShader:function(){return s.callFunction("adjustSpecular",this._outputs.specular,[this._inputs.specular,this._inputs.normal.getVariable()+".rgb"])}}));var m=function(){u.apply(this)};m.prototype=n.objectInherit(u.prototype,{type:"ApplyCurvature",validInputs:["normal","color","factor"],validOutputs:["color"],computeShader:function(){var e=this._inputs;return s.callFunction("applyCurvature",this._outputs.color,[e.normal,e.color,e.factor])},globalFunctionDeclaration:function(){return'#pragma include "curvature.glsl"'},getExtensions:function(){return["#extension GL_OES_standard_derivatives : enable"]}}),t.a={LinearTosRGBWithTest:c,NormalTangentSpace:h,Bumpmap:d,NormalMatcap:p,AdjustSpecular:g,RGBToNormal:f,ApplyCurvature:m}},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=r.a.osgShader,o=a.node.NodeFunctions,s=a.utils,u=function(){o.apply(this)};n.createPrototypeObject(u,n.objectInherit(o.prototype,{validOutputs:["color","lighted"],globalFunctionDeclaration:function(){return'#pragma include "lightsPBR.glsl"'}}));var l=function(e){return"vec4"===e.getType()?e.getVariable()+".rgb":e},c=function(){u.apply(this)};n.createPrototypeObject(c,n.objectInherit(u.prototype,{type:"PointLightPBR",validInputs:["normal","eyeVector","materialalbedopbr","prepSpec","materialspecularpbr","lightdiffuse","lightposition","lightattenuation","lightmatrix"],computeShader:function(){return s.callFunction("computePointLightPBRShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,this._inputs.materialalbedopbr,this._inputs.prepSpec,this._inputs.materialspecularpbr,l(this._inputs.lightdiffuse),this._inputs.lightposition,this._inputs.lightattenuation,this._inputs.lightmatrix,this._outputs.lighted])}}));var h=function(){u.apply(this)};n.createPrototypeObject(h,n.objectInherit(u.prototype,{type:"SpotLightPBR",validInputs:["normal","eyeVector","materialalbedopbr","prepSpec","materialspecularpbr","lightdiffuse","lightdirection","lightattenuation","lightposition","lightspotCutOff","lightspotBlend","lightmatrix","lightinvMatrix"],computeShader:function(){return s.callFunction("computeSpotLightPBRShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,this._inputs.materialalbedopbr,this._inputs.prepSpec,this._inputs.materialspecularpbr,l(this._inputs.lightdiffuse),this._inputs.lightdirection,this._inputs.lightattenuation,this._inputs.lightposition,this._inputs.lightspotCutOff,this._inputs.lightspotBlend,this._inputs.lightmatrix,this._inputs.lightinvMatrix,this._outputs.lighted])}}));var d=function(){u.apply(this)};n.createPrototypeObject(d,n.objectInherit(u.prototype,{type:"SunLightPBR",validInputs:["normal","eyeVector","materialalbedopbr","prepSpec","materialspecularpbr","lightdiffuse","lightposition","lightmatrix"],computeShader:function(){return s.callFunction("computeSunLightPBRShading",this._outputs.color,[this._inputs.normal,this._inputs.eyeVector,this._inputs.materialalbedopbr,this._inputs.prepSpec,this._inputs.materialspecularpbr,l(this._inputs.lightdiffuse),this._inputs.lightposition,this._inputs.lightmatrix,this._outputs.lighted])}}));var p=function(){u.apply(this)};n.createPrototypeObject(p,n.objectInherit(u.prototype,{type:"ComputeLight",validInputs:["normal","lightColor","albedo","prepSpec","viewDir","lightDir","specular","dotNL"],validOutputs:["color"],computeShader:function(){return s.callFunction("computeLight",this._outputs.color,[this._inputs.lightColor,this._inputs.albedo,this._inputs.normal,this._inputs.viewDir,this._inputs.lightDir,this._inputs.specular,this._inputs.prepSpec,this._inputs.dotNL])}}));var f=function(){o.apply(this)};n.createPrototypeObject(f,n.objectInherit(o.prototype,{type:"prepSpecLightPBR",validInputs:["normal","eyeVector","materialroughnesspbr"],validOutputs:["prepSpec"],globalFunctionDeclaration:function(){return'#pragma include "lightsPBR.glsl"'},computeShader:function(){return s.callFunction("LightingFuncPrep",this._outputs.prepSpec,[this._inputs.normal,this._inputs.eyeVector,this._inputs.materialroughnesspbr])}})),t.a={PrepSpecLightPBR:f,PointLightPBR:c,SpotLightPBR:h,SunLightPBR:d,ComputeLight:p}},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=r.a.osgShader,o=a.node.BaseOperator,s=function(){o.apply(this),this._mode="MIX"};n.createPrototypeObject(s,n.objectInherit(o.prototype,{type:"Blend",mode:function(e){return this._mode=e,this},computeShader:function(){return this[void 0===this._mode?"MIX":this._mode]()},ADD:function(){return this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+" + ("+this._inputs[1].getVariable()+" * "+this._inputs[2].getVariable()+");"},MIX:function(){return this._outputs.getVariable()+" = mix("+this._inputs[0].getVariable()+", "+this._inputs[1].getVariable()+", "+this._inputs[2].getVariable()+");"},MULTIPLY:function(){return this._outputs.getVariable()+" = "+this._inputs[0].getVariable()+" * mix( "+this._inputs[0].getType()+"(1.0), "+this._inputs[1].getVariable()+", "+this._inputs[2].getVariable()+");"}})),t.a={Blend:s}},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=r.a.osgShader,o=a.node.NodeFunctions,s=a.utils,u=function(){o.apply(this)};n.createPrototypeObject(u,n.objectInherit(o.prototype,{type:"DiffuseUE4v1",validInputs:["normal","albedo","envTransform","sphCoef"],validOutputs:["color"],computeShader:function(){var e=this._inputs;return s.callFunction("computeIBLDiffuseUE4",this._outputs.color,[e.normal,e.albedo,e.envTransform,e.sphCoef])},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}}));var l=function(){o.apply(this)};n.createPrototypeObject(l,n.objectInherit(o.prototype,{type:"SpecularUE4v1Panorama",validInputs:["normal","eye","roughness","specular","envTransform","texSpec","lodRange","texSize","frontNormal"],validOutputs:["color"],computeShader:function(){var e=this._inputs,t=[e.normal,e.eye,e.roughness,e.specular,e.envTransform,e.texSpec,e.lodRange,e.texSize,e.frontNormal];return e.integrateBRDF&&t.push(e.integrateBRDF),s.callFunction("computeIBLSpecularUE4",this._outputs.color,t)},isMobileString:function(){return this._inputs.integrateBRDF?"":"#define MOBILE"},getDefines:function(){return[this.isMobileString(),"#define PANORAMA"]},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}}));var c=function(){l.apply(this)};n.createPrototypeObject(c,n.objectInherit(l.prototype,{type:"SpecularUE4v1Cubemap",getDefines:function(){return[this.isMobileString(),"#define CUBEMAP"]},getExtensions:function(){return["#extension GL_EXT_shader_texture_lod : require"]}}));var h=function(){o.apply(this)};n.createPrototypeObject(h,n.objectInherit(o.prototype,{type:"EnvironmentTransformPBR",validInputs:["inTransform"],validOutputs:["outTransform"],computeShader:function(){return s.callFunction("environmentTransformPBR",this._outputs.outTransform,[this._inputs.inTransform])},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}}));var d=function(){o.apply(this)};n.createPrototypeObject(d,n.objectInherit(o.prototype,{type:"AdjustRoughnessNmap",validInputs:["roughness","normal"],validOutputs:["roughness"],computeShader:function(){return s.callFunction("adjustRoughnessNormalMap",this._outputs.roughness,[this._inputs.roughness,this._inputs.normal])},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}}));var p=function(){o.apply(this)};n.createPrototypeObject(p,n.objectInherit(o.prototype,{type:"AdjustRoughnessGeometry",validInputs:["roughness","normal"],validOutputs:["roughness"],computeShader:function(){return s.callFunction("adjustRoughnessGeometry",this._outputs.roughness,[this._inputs.roughness,this._inputs.normal])},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}}));var f=function(){o.apply(this)};n.createPrototypeObject(f,n.objectInherit(o.prototype,{type:"SpecularOcclusion",validInputs:["occlude","ao","normal","eye"],validOutputs:["ao"],computeShader:function(){var e=this._inputs;return s.callFunction("specularOcclusion",this._outputs.ao,[e.occlude,e.ao,e.normal,e.eye])},globalFunctionDeclaration:function(){return'#pragma include "pbrUE4.glsl"'}})),t.a={DiffuseUE4v1:u,SpecularUE4v1Panorama:l,SpecularUE4v1Cubemap:c,EnvironmentTransformPBR:h,AdjustRoughnessNmap:d,AdjustRoughnessGeometry:p,SpecularOcclusion:f}},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=r.a.osgShader,o=a.node.NodeTextures,s=a.utils,u=function(){o.apply(this)};n.createPrototypeObject(u,n.objectInherit(o.prototype,{globalFunctionDeclaration:function(){return'#pragma include "sketchfabTextures.glsl"'}}));var l=function(){u.apply(this),this._isSRGB=!1,this._packingRead="r"};n.createPrototypeObject(l,n.objectInherit(u.prototype,{type:"TextureGradient",validInputs:["sampler","texSize","uv"],setSRGB:function(e){return this._isSRGB=e,this},setPackingRead:function(e){return this._packingRead=e,this},globalFunctionDeclaration:function(){return'#pragma include "sketchfabTextures.glsl"'},computeShader:function(){var e=this._inputs;return s.callFunction("textureGradient",this._outputs.color,[e.sampler,e.uv.getVariable()+".xy",e.texSize])},getDefines:function(){var e="texture2D(tex, uv)."+this._packingRead;return this._isSRGB&&(e="sRGBToLinear("+e+")"),["#define TEX_BUMP(tex, uv) "+e]}}));var c=function(){u.apply(this)};n.createPrototypeObject(c,n.objectInherit(u.prototype,{type:"TextureEnvironmentCube",validInputs:["sampler","envTransform","normal","eye","texSize"],computeShader:function(){var e=this._inputs;return s.callFunction("textureEnvironmentCube",this._outputs.color,[e.sampler,e.envTransform,e.normal,e.eye,e.texSize])}})),t.a={TextureGradient:l,TextureEnvironmentCube:c}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(495),n=i.n(r),a=n.a.osg,o=a.DrawElements.prototype.setIndices;a.DrawElements.prototype.setIndices=function(e){var t=e.getElements();a.WebGLCaps.instance().isWebGL2()&&(1===t.BYTES_PER_ELEMENT?-1!==t.indexOf(255)&&e.setElements(new Uint16Array(t)):2===t.BYTES_PER_ELEMENT&&-1!==t.indexOf(65535)&&e.setElements(new Uint32Array(t))),o.call(this,e)},t.default=a.DrawElements},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(495),n=i.n(r),a=n.a.osg,o=a.Geometry.prototype.computeBoundingBox;a.Geometry.prototype.computeBoundingBox=function(e){o.call(this,e);var t=this._displacementFactor=this._displacementFactor||0;if(t){var i=e.getMin(),r=e.getMax();i[0]-=t,i[1]-=t,i[2]-=t,r[0]+=t,r[1]+=t,r[2]+=t}return e};var s=a.Geometry.prototype.computeBoundingSphere;a.Geometry.prototype.computeBoundingSphere=function(e){s.call(this,e);var t=this._displacementFactor=this._displacementFactor||0;return t&&e.set(e.center(),e.radius()+t),e},t.default=a.Geometry},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(495),n=i.n(r),a=n.a.osg,o=new a.BoundingSphere;a.Node.prototype.getMinimumBound=function(e){e||(e=o),e.init();var t=this.getBoundingBox();t.valid()&&e.expandByBoundingBox(t);var i=this.getBound();return i.radius()<e.radius()?i:e},t.default=a.Node},function(e,t,i){"use strict";var r=i(5),n=i(298),a=i(725),o=i(156),s=i(31),u=r.a.osg,l="rgba",c={};c[u.Texture.LUMINANCE]="r",c[u.Texture.ALPHA]="a",c[u.Texture.RGB]="rgb";var h=function(e){u.Texture.call(this),this._texture=e,this._isColorAtlas=!1,this._channels=[],this._packTextures={}};u.createPrototypeStateAttribute(h,u.objectInherit(u.Texture.prototype,{attributeType:"Texture",setIsColorAtlas:function(e){this._isColorAtlas=e},getChannelPacking:function(e){return this._packTextures[e].pack},getTexture:function(){return this._texture||(this._texture=a.a.viewerInstance.packTextures(this._packTextures,this._channels)),this._texture},setTexture:function(e){this._texture=e},getChannelCount:function(){return this._channels.length},addChannel:function(e,t,i){this._packTextures[e]||(this._packTextures[e]={texture:t,pack:"rgb"},i||this._channels.push(e),this._isColorAtlas||(this._texture=void 0,this.updatePacking()))},removeChannel:function(e){this._packTextures[e]&&(delete this._packTextures[e],this._channels.splice(this._channels.indexOf(e),1),this._isColorAtlas||(this._texture=void 0,this.updatePacking()))},packChannelIfPossible:function(e,t){if(this._isColorAtlas||!i.i(s.a)().materialPacking||t.isVideo())return!1;var r=this._channels,n=r.length;if(0===n)return!1;for(var a=4,u=0;u<n;++u)a-=this._packTextures[r[u]].pack.length;if(0===a)return!1;var l=o.a.getDefaultStringFormat(e).length;return!(3===l&&a<3)&&(!!this.isFilteringFriendly(t,this._packTextures[r[0]].texture)&&(3===l?r.unshift(e):r.push(e),this.addChannel(e,t,!0),this.updatePacking(),!0))},isFilteringFriendly:function(e,t){return e.getMinFilter()===t.getMinFilter()&&(e.getMagFilter()===t.getMagFilter()&&(e.getWrapS()===t.getWrapS()&&e.getWrapT()===t.getWrapT()))},getSinglePacking:function(e,t){if("Opacity"===e){var i=t.getInternalFormat(),r=i&&c[t.getInternalFormat()];return r&&1===r.length?r:"r"}return o.a.getDefaultStringFormat(e)},updatePacking:function(){var e=this._channels,t=0,i=e.length;if(1===i){var r=this._packTextures[e[0]];return void(r.pack=this.getSinglePacking(e[0],r.texture))}for(var n=0;n<i;++n){var a=e[n],s=this._packTextures[a];if(s){var u=o.a.getDefaultStringFormat(a).length;s.pack=l.substr(t,u),t+=u}}},getMaxTextureSizePacked:function(e){e.width=e.height=e.missingResolution=0;for(var t=this._channels,i=t.length,r=0;r<i;++r){var n=t[r],a=this._packTextures[n];if(a){var o=a.texture;if(o.getImageJSONMaxSupported){var s=o.getImageJSONMaxSupported();if(e.width=Math.max(e.width,s.width),e.height=Math.max(e.height,s.height),s.width>512||s.height>512){var u=o.getImageJSONMaxSupported(512);512!==u.width&&512!==u.height&&(e.missingResolution++,e.missingTextures.push(s.uid))}}}}return e},isProtectedTexture:function(){return!!this._packTextures.Opacity||!!this._packTextures.Displacement},getImage:function(){return this.getTexture().getImage()},cloneType:function(){return new h(new n.a)},isTextureNull:function(){return!(!this._isColorAtlas||0!==this._channels.length)||this.getTexture().isTextureNull()},apply:function(e){this.getTexture().apply(e)},getHash:function(){for(var e="osgTex",t=this._channels,i=0,r=t.length;i<r;++i)e+=o.a.indexOf(t[i])+"";return e}}),"osgSketchfab","PackedMaterialTexture"),t.a=h},function(e,t,i){"use strict";var r=i(15),n=i(5),a=i(46),o=i(31),s=i(299),u=i(337),l=i(139),c=i(70),h=i.n(c),d=n.a.osg,p=r.a.extend({defaults:{postProcessReady:!1,enable:i.i(o.a)().postProcess,rgbmDefault:7,rgbmBloom:1,taaEnable:!0,taaTransparent:!0,grainEnable:!1,grainAnimated:!1,grainFactor:.15,sharpenEnable:!1,sharpenFactor:.2,chromaticAberrationEnable:!1,chromaticAberrationFactor:.05,vignetteEnable:!1,vignetteLens:d.vec2.fromValues(.8,.25),bloomEnable:!1,bloomThreshold:0,bloomFactor:.5,bloomRadius:.7,toneMappingEnable:!1,toneMappingMethod:"default",toneMappingExposure:1,toneMappingBrightness:0,toneMappingContrast:0,toneMappingSaturation:1,colorBalanceEnable:!1,colorBalanceLow:d.vec3.create(),colorBalanceMid:d.vec3.create(),colorBalanceHigh:d.vec3.create(),dofEnable:!1,dofBlurNear:.5,dofBlurFar:.5,dofFocusPoint:d.vec3.create(),dofQuality:0,ssaoEnable:!1,ssaoBias:-1,ssaoRadius:-1,ssaoIntensity:.5,webVR:!1,veilFactor:1,doDistortionVR:!1,distortion:d.vec2.fromValues(.441,.156),projectionLeft:d.vec4.fromValues(1,1,-.5,-.5),unprojectionLeft:d.vec4.fromValues(1,1,-.5,-.5),vrFadeLength:i.i(o.a)().vrFade/1e3/2,vrStartFade:!1,vrFadeStartTime:0,vrFadeCallback:void 0,vrFading:!1},getName:function(){return"PostProcess"},getViewer:function(){return this._viewer},_getBoundRadius:function(){return l.a.getModelBoxWithDisplacement().radius()},getMinimumSsaoRadius:function(){return.01*this._getBoundRadius()},getMaximumSsaoRadius:function(){return.1*this._getBoundRadius()},getMinimumSsaoBias:function(){return.002*this._getBoundRadius()},getMaximumSsaoBias:function(){return.01*this._getBoundRadius()},_makeValidOption:function(e,t,i,r){var n=this.get(e);n<t*l.a.BIAS_MIN||n>i*l.a.BIAS_MAX?this.set(e,r):this.set(e,Math.min(Math.max(n,t),i))},_makeValidSsaoRadius:function(){this._makeValidOption("ssaoRadius",this.getMinimumSsaoRadius(),this.getMaximumSsaoRadius(),.025*this._getBoundRadius())},_makeValidSsaoBias:function(){this._makeValidOption("ssaoBias",this.getMinimumSsaoBias(),this.getMaximumSsaoBias(),.005*this._getBoundRadius())},isEffectiveGrain:function(){return!this.get("webVR")&&this.get("grainEnable")&&this.get("grainFactor")>=5e-4},isEffectiveSharpen:function(){return!this.get("webVR")&&this.get("sharpenEnable")&&this.get("sharpenFactor")>=5e-4},isEffectiveChromaticAberration:function(){return!this.get("webVR")&&this.get("chromaticAberrationEnable")&&this.get("chromaticAberrationFactor")>=.001},isEffectiveVignette:function(){return!this.get("webVR")&&this.get("vignetteEnable")&&this.get("vignetteLens")[1]<=.5*Math.sqrt(2)},isEffectiveBloom:function(){return(!this.get("webVR")||!h.a.any)&&this.get("bloomEnable")&&this.get("bloomFactor")>=.01},isEffectiveToneMapping:function(){return this.get("toneMappingEnable")},isEffectiveColorBalance:function(){return this.get("colorBalanceEnable")},isEffectiveDof:function(){return!this.get("webVR")&&this.get("dofEnable")&&(this.get("dofBlurNear")>=.01||this.get("dofBlurFar")>=.01)},isEffectiveSsao:function(){return!this.get("webVR")&&this.get("ssaoEnable")&&this.get("ssaoIntensity")>=.01},initAfterFirstFrame:function(){this._makeValidSsaoRadius(),this._makeValidSsaoBias(),this.trigger("uiReady"),this.set("postProcessReady",!0)},init:function(e){this._viewer=e.getViewer();var t=e.getModel().get("options");if(t.scene&&t.scene.postProcess){var r=t.scene.postProcess;void 0!==r.enable&&i.i(o.a)().postProcess&&this.set("enable",r.enable),r.grain&&(this.set("grainEnable",r.grain.enable),this.set("grainAnimated",r.grain.animated),this.set("grainFactor",r.grain.factor)),r.sharpen&&(this.set("sharpenEnable",r.sharpen.enable),this.set("sharpenFactor",r.sharpen.factor)),r.chromaticAberration&&(this.set("chromaticAberrationEnable",r.chromaticAberration.enable),this.set("chromaticAberrationFactor",r.chromaticAberration.factor)),r.vignette&&(this.set("vignetteEnable",r.vignette.enable),this.set("vignetteLens",r.vignette.lens)),r.bloom&&(this.set("bloomEnable",r.bloom.enable),this.set("bloomFactor",r.bloom.factor),this.set("bloomThreshold",r.bloom.threshold),r.bloom.radius&&this.set("bloomRadius",r.bloom.radius)),r.toneMapping&&(this.set("toneMappingEnable",r.toneMapping.enable),this.set("toneMappingExposure",r.toneMapping.exposure),this.set("toneMappingBrightness",r.toneMapping.brightness),this.set("toneMappingContrast",r.toneMapping.contrast),this.set("toneMappingSaturation",r.toneMapping.saturation),this.set("toneMappingMethod",r.toneMapping.method)),r.colorBalance&&(this.set("colorBalanceEnable",r.colorBalance.enable),r.colorBalance.low&&this.set("colorBalanceLow",r.colorBalance.low),r.colorBalance.mid&&this.set("colorBalanceMid",r.colorBalance.mid),r.colorBalance.high&&this.set("colorBalanceHigh",r.colorBalance.high)),r.dof&&(this.set("dofEnable",r.dof.enable),this.set("dofBlurNear",r.dof.blurNear),this.set("dofBlurFar",r.dof.blurFar),this.set("dofFocusPoint",r.dof.focusPoint)),r.ssao&&(this.set("ssaoEnable",r.ssao.enable),this.set("ssaoRadius",r.ssao.radius),this.set("ssaoIntensity",r.ssao.intensity),this.set("ssaoBias",r.ssao.bias)),r.taa&&(this.set("taaEnable",void 0!==i.i(o.a)().taa?i.i(o.a)().taa:r.taa.enable),this.set("taaTransparent",void 0!==i.i(o.a)().taaTransparent?i.i(o.a)().taaTransparent:r.taa.transparent))}if(i.i(s.a)()){var n=e.getViewer();a.a.getMaterial().then(function(){"Tilt Brush"===n.getRootUserData().authoringTool&&(this.set("bloomEnable",!0),this.set("bloomThreshold",.6),this.set("bloomFactor",1.6),this.set("bloomRadius",.2),this.set("toneMappingEnable",!0),this.set("toneMappingMethod","filmic"))}.bind(this))}},fadeForTeleportVR:function(e){this.set("vrStartFade",!0),this.set("vrFadeCallback",e)},getJSON:function(){return{enable:this.get("enable"),grain:{enable:this.get("grainEnable"),animated:this.get("grainAnimated"),factor:this.get("grainFactor")},sharpen:{enable:this.get("sharpenEnable"),factor:this.get("sharpenFactor")},chromaticAberration:{enable:this.get("chromaticAberrationEnable"),factor:this.get("chromaticAberrationFactor")},vignette:{enable:this.get("vignetteEnable"),lens:this.get("vignetteLens")},bloom:{enable:this.get("bloomEnable"),factor:this.get("bloomFactor"),threshold:this.get("bloomThreshold"),radius:this.get("bloomRadius")},toneMapping:{enable:this.get("toneMappingEnable"),method:this.get("toneMappingMethod"),exposure:this.get("toneMappingExposure"),brightness:this.get("toneMappingBrightness"),contrast:this.get("toneMappingContrast"),saturation:this.get("toneMappingSaturation")},colorBalance:{enable:this.get("colorBalanceEnable"),low:this.get("colorBalanceLow"),mid:this.get("colorBalanceMid"),high:this.get("colorBalanceHigh")},dof:{enable:this.get("dofEnable"),blurNear:this.get("dofBlurNear"),blurFar:this.get("dofBlurFar"),focusPoint:this.get("dofFocusPoint")},ssao:{enable:this.get("ssaoEnable"),bias:this.get("ssaoBias"),intensity:this.get("ssaoIntensity"),radius:this.get("ssaoRadius")},taa:{enable:this.get("taaEnable"),transparent:this.get("taaTransparent")}}},editorGetJSON:function(){return this.getJSON()},validateJSON:function(e){var t=[];return e.grain&&(u.a.isBoolean(e.grain.enable)||t.push("PostProcess.editorSetJSON grain.enable must be a boolean"),u.a.isBoolean(e.grain.animated)||t.push("PostProcess.editorSetJSON grain.animated must be a boolean"),u.a.isNumber(e.grain.factor,0,.5)||t.push("PostProcess.editorSetJSON grain.factor must be a number in range [0,0.5]")),e.sharpen&&(u.a.isBoolean(e.sharpen.enable)||t.push("PostProcess.editorSetJSON sharpen.enable must be a boolean"),u.a.isNumber(e.sharpen.factor,0,5)||t.push("PostProcess.editorSetJSON sharpen.factor must be a number in range [0,5]")),e.chromaticAberration&&(u.a.isBoolean(e.chromaticAberration.enable)||t.push("PostProcess.editorSetJSON chromaticAberration.enable must be a boolean"),u.a.isNumber(e.chromaticAberration.factor,0,.1)||t.push("PostProcess.editorSetJSON chromaticAberration.factor must be a number in range [0.0,0.1]")),e.vignette&&(u.a.isBoolean(e.vignette.enable)||t.push("PostProcess.editorSetJSON vignette.enable must be a boolean"),u.a.isArrayNumber(e.vignette.lens,2,-1,1)||t.push("PostProcess.editorSetJSON vignette.lens must be a vec2 in range [-1,1]")),e.bloom&&(u.a.isBoolean(e.bloom.enable)||t.push("PostProcess.editorSetJSON bloom.enable must be a boolean"),u.a.isNumber(e.bloom.factor,0,2)||t.push("PostProcess.editorSetJSON bloom.factor must be a number in range [0,2]"),u.a.isNumber(e.bloom.threshold,0,1)||t.push("PostProcess.editorSetJSON bloom.threshold must be a number in range [0,1]"),u.a.isNumber(e.bloom.radius,0,1)||t.push("PostProcess.editorSetJSON bloom.radius must be a number in range [0,1]")),e.toneMapping&&(u.a.isBoolean(e.toneMapping.enable)||t.push("PostProcess.editorSetJSON toneMapping.enable must be a boolean"),u.a.isEnumString(e.toneMapping.method,["default","filmic","reinhard"])||t.push("PostProcess.editorSetJSON toneMapping.method must be a enum with values [default, filmic, reinhard]"),u.a.isNumber(e.toneMapping.exposure,0,2)||t.push("PostProcess.editorSetJSON toneMapping.exposure must be a number in range [ 0,2]"),u.a.isNumber(e.toneMapping.brightness,-1,1)||t.push("PostProcess.editorSetJSON toneMapping.brightness must be a number in range [-1,1]"),u.a.isNumber(e.toneMapping.contrast,-1,1)||t.push("PostProcess.editorSetJSON toneMapping.contrast must be a number in range [-1,1]"),u.a.isNumber(e.toneMapping.saturation,0,2)||t.push("PostProcess.editorSetJSON toneMapping.saturation must be a number in range [0,2]")),e.colorBalance&&(u.a.isBoolean(e.colorBalance.enable)||t.push("PostProcess.editorSetJSON colorBalance.enable must be a boolean"),u.a.isArrayNumber(e.colorBalance.low,3,-1,1)||t.push("PostProcess.editorSetJSON colorBalance.low must be a vec3 in range [-1,1]"),u.a.isArrayNumber(e.colorBalance.mid,3,-1,1)||t.push("PostProcess.editorSetJSON colorBalance.mid must be a vec3 in range [-1,1]"),u.a.isArrayNumber(e.colorBalance.high,3,-1,1)||t.push("PostProcess.editorSetJSON colorBalance.high must be a vec3 in range [-1,1]")),e.dof&&(u.a.isBoolean(e.dof.enable)||t.push("PostProcess.editorSetJSON dof.enable must be a boolean"),u.a.isNumber(e.dof.blurNear,0,1)||t.push("PostProcess.editorSetJSON dof.blurNear must be a number in range [0,1]"),u.a.isNumber(e.dof.blurFar,0,1)||t.push("PostProcess.editorSetJSON dof.blurFar must be a number in range [0,1]"),u.a.isArrayNumber(e.dof.focusPoint,3)||t.push("PostProcess.editorSetJSON dof.focusPoint must be a vec3")),e.ssao&&(u.a.isBoolean(e.ssao.enable)||t.push("PostProcess.editorSetJSON ssao.enable must be a boolean"),u.a.isNumber(e.ssao.bias)||t.push("PostProcess.editorSetJSON ssao.bias must be a number"),u.a.isNumber(e.ssao.radius)||t.push("PostProcess.editorSetJSON ssao.radius must be a number"),u.a.isNumber(e.ssao.intensity)||t.push("PostProcess.editorSetJSON ssao.intensity must be a number")),t.join("\n")},editorSetJSON:function(e){var t=this.validateJSON(e);if(t)return t;var i={enable:e.enable};return e.grain&&(i.grainEnable=e.grain.enable,i.grainAnimated=e.grain.animated,i.grainFactor=e.grain.factor),e.sharpen&&(i.sharpenEnable=e.sharpen.enable,i.sharpenFactor=e.sharpen.factor),e.chromaticAberration&&(i.chromaticAberrationEnable=e.chromaticAberration.enable,i.chromaticAberrationFactor=e.chromaticAberration.factor),e.vignette&&(i.vignetteEnable=e.vignette.enable,i.vignetteLens=e.vignette.lens),e.bloom&&(i.bloomEnable=e.bloom.enable,i.bloomFactor=e.bloom.factor,i.bloomThreshold=e.bloom.threshold,i.bloomRadius=e.bloom.radius),e.toneMapping&&(i.toneMappingEnable=e.toneMapping.enable,i.toneMappingMethod=e.toneMapping.method,i.toneMappingExposure=e.toneMapping.exposure,i.toneMappingBrightness=e.toneMapping.brightness,i.toneMappingContrast=e.toneMapping.contrast,i.toneMappingSaturation=e.toneMapping.saturation),e.colorBalance&&(i.colorBalanceEnable=e.colorBalance.enable,i.colorBalanceLow=e.colorBalance.low,i.colorBalanceMid=e.colorBalance.mid,i.colorBalanceHigh=e.colorBalance.high),e.dof&&(i.dofEnable=e.dof.enable,i.dofBlurNear=e.dof.blurNear,i.dofBlurFar=e.dof.blurFar,i.dofFocusPoint=e.dof.focusPoint),e.ssao&&(i.ssaoEnable=e.ssao.enable,i.ssaoBias=e.ssao.bias,i.ssaoRadius=e.ssao.radius,i.ssaoIntensity=e.ssao.intensity),this.set(i),t}});t.a=p},function(e,t,i){"use strict";var r=i(5),n=i(31),a=i(69),o=i(389),s=i(1062),u=i(600),l=i(90),c=i(721),h=i(298),d=i(70),p=i.n(d),f=i(46),g=i(129),m=r.a.osg,v=r.a.osgUtil,_=g.a.getShaderProcessor(),b=function(e){m.Node.call(this),this.setName("PostProcess - node In"),this._uniforms=e._uniforms,this._camera=e._camera,this._effectiveConfig=e._effectiveConfig,this._viewer=e._viewer,this._viewerOSGJS=e._viewerOSGJS,this._model=e.model,this._stateSetCompositeBG=void 0,this._stateSetFinalPass=void 0,this._texturesRTT={},this._rttAA0=void 0,this._rttAA1=void 0,this._isOnMobile=!1,this._hasTriangles=this._viewer.getOrCreateScene().getJSON().faceCount>0,u.a.setHasTriangles(this._hasTriangles),this._viewer.getCamera().getRenderer().setRenderStage(new u.a),this.initStateSet(),this._model.on("pingPongTexture0",this.onPingPongTexture0,this),f.a.getMaterial().then(function(){var e=this.getBackgroundModel();e.bind("backgroundUpdated",this.onBackgroundUpdated,this),e.bind("change:color",this.onBackgroundColor,this)}.bind(this))};m.createPrototypeNode(b,m.objectInherit(m.Node.prototype,{initStateSet:function(){var e=this._uniforms,t=this.getOrCreateStateSet();t.addUniform(e.uOutputLinear),t.addUniform(e.uRGBMRange),t.addUniform(e.uPixelRatio),t.addUniform(u.a.getDrawOpaqueUniform()),t.addUniform(e.uNearFar),t.addUniform(e.uDofBlurNearFarFocal),t.addUniform(e.uTime),t.addUniform(e.uTimeDithering)},getNodeBackground:function(){return this._viewer.getFeatures().environment.getNode().getBackground()},getBackgroundModel:function(){return this._viewer.getFeatures().background.getModel()},getBackgroundType:function(){return this.getBackgroundModel().getEnableType()},onPingPongTexture0:function(e){if(this._stateSetFinalPass){var t=e?this._rttAA0:this._rttAA1;this._stateSetFinalPass.setTextureAttributeAndModes(0,t)}this._antialiasFilter&&(this._antialiasFilter._cameraRtt0.setNodeMask(e?-1:0),this._antialiasFilter._cameraRtt1.setNodeMask(e?0:-1))},onBackgroundUpdated:function(e){var t=this._stateSetCompositeBG&&this._stateSetCompositeBG.getUniform("TextureFixed");t&&(e.divisor=-1,this._stateSetCompositeBG.setTextureAttributeAndModes(t.getInternalArray()[0],e))},onBackgroundColor:function(){var e=u.a.getClearColor();if("color"!==this.getBackgroundType())return void m.vec4.set(e,0,0,0,0);m.vec3.copy(e,this.getBackgroundModel().getColor()),e[3]=1,1===this._uniforms.uOutputLinear.getInternalArray()[0]&&c.a.srgbToLinear(e,e);var t=this._uniforms.uRGBMRange.getInternalArray()[0];t>0&&c.a.encodeRGBM(e,t,e)},getSupportedFloatTexture:function(){var e=m.WebGLCaps.instance();return 0===i.i(n.a)().floatRtt?m.Texture.UNSIGNED_BYTE:e.hasLinearHalfFloatRTT()?m.Texture.HALF_FLOAT:e.hasHalfFloatRTT()?m.Texture.HALF_FLOAT:p.a.any&&this._model.get("webVR")&&2===i.i(n.a)().floatRtt?m.Texture.UNSIGNED_BYTE:e.hasLinearFloatRTT()?m.Texture.FLOAT:e.hasFloatRTT()?m.Texture.FLOAT:m.Texture.UNSIGNED_BYTE},getOrCreateTextureRTT:function(e,t,i,r){t=t||"default",e=e||1,r=r||m.Texture.UNSIGNED_BYTE,i=i||m.Texture.NEAREST;var n=Math.max(1,Math.round(this._viewerOSGJS.getCanvasWidth()/e)),a=Math.max(1,Math.round(this._viewerOSGJS.getCanvasHeight()/e)),o=t+e+"_"+r+"_"+i,s=this._texturesRTT[o];return s?(s.setTextureSize(n,a),s):(s=this._texturesRTT[o]=new m.Texture,s.setInternalFormatType(r),s.setTextureSize(n,a),s.setInternalFormat(m.Texture.RGBA),s.setMinFilter(i),s.setMagFilter(i),s.setName(o),s.divisor=e,s)},getOrCreateTextureOpaque:function(e){return this.getOrCreateTextureRTT(1,"opaque",e)},getOrCreateTextureTransparent:function(){return this.getOrCreateTextureRTT(1,"transparent",m.Texture.NEAREST,this.getSupportedFloatTexture())},getOrCreateTextureDepth:function(){return this.getOrCreateTextureRTT(1,"depth",m.Texture.NEAREST)},getOrCreateTextureExtra:function(){return this.getOrCreateTextureRTT(1,"extra")},createCameraAA:function(e,t){var i=new m.Camera;return i.setName(e),i.setRenderOrder(m.Camera.PRE_RENDER,0),i.attachTexture(m.FrameBufferObject.COLOR_ATTACHMENT0,t),i.setClearMask(0),i},createFilter:function(e,t){e=e||{};var i=new s.a([],[],_);i.setPostProcessConfiguration(e);var r=new v.Composer.Filter.Custom(i.createFragmentShader(),t);return r.setVertexName(i.getVertexShaderName()),r},addCompositeBackground:function(e,t){"fixed"===this.getBackgroundType()&&(e.useComposeBackground=!0,t.TextureFixed=this.getNodeBackground().getBackground()||h.a.dummyTexture,t.TextureFixed.divisor=-1,t.uFixedScale=this.getNodeBackground().getUniforms().scale,t.TextureDepth=this._camera._textureDepth)},addMergeOpacityPass:function(e,t){var i={isPassMergeOpacity:!0,RGBMTexture0:this._model.get("rgbmDefault"),RGBMTextureTransparent:void 0,encodeRGBM:t.outputInSRGB?null:this._model.get("rgbmDefault"),composeExtra:t.composeExtra},r={uOutputLinear:m.Uniform.createInt(t.outputInSRGB?0:1,"uOutputLinear"),Texture0:t.inputTexture,TextureTransparent:this._camera._textureTransparent};t.composeBackground&&this.addCompositeBackground(i,r);var n=this.getOrCreateTextureRTT(1,"mergeableOpacity",t.outputFiltering);this.configureVeilAndExtra(i,r);var a=e.addPass(this.createFilter(i,r),n);return a.setFragmentName("MergeOpacity"),t.composeBackground&&(this._stateSetCompositeBG=a.getStateSet()),n},buildMipmapPasses:function(e,t){for(var i=this._camera._textureDepth,r={isPassDepthMipmap:!0},n=1;n<=5;++n){var a={Texture0:i};i=this.getOrCreateTextureRTT(1<<n+1,"depth_"+n,m.Texture.LINEAR,m.Texture.UNSIGNED_BYTE),t["TextureDepth"+n]=i;var o=this.createFilter(r,a);o.setFragmentName("DepthMipmap"+n),e.addPass(o,i)}},addSsao:function(e,t){var i={isPassSsaoExtract:!0},r={TextureDepth:this._camera._textureDepth,uSsaoRadius:this._uniforms.uSsaoRadius,uSsaoBias:this._uniforms.uSsaoBias,uSsaoIntensity:this._uniforms.uSsaoIntensity,uSsaoProjectionInfo:this._uniforms.uSsaoProjectionInfo,uSsaoProjectionScale:this._uniforms.uSsaoProjectionScale,uNearFar:this._uniforms.uNearFar,uTime:this._uniforms.uTime};this.buildMipmapPasses(e,r);var n=this.getOrCreateTextureRTT(1,"texSsao",t.outputFiltering),a=e.addPass(this.createFilter(i,r),n);a.setFragmentName("SsaoExtract"),i={isPassSsaoBlurH:!0},r={TextureSsao:n};var o=this.getOrCreateTextureRTT(1,"ssaoBlur",m.Texture.NEAREST);a=e.addPass(this.createFilter(i,r),o),a.setFragmentName("SsaoBlurH"),i={isPassSsaoBlurV:!0,RGBMTexture0:this._model.get("rgbmDefault"),encodeRGBM:t.outputInSRGB?null:this._model.get("rgbmDefault")},r={uOutputLinear:m.Uniform.createInt(t.outputInSRGB?0:1,"uOutputLinear"),Texture0:t.inputTexture,TextureSsao:o},t.composeBackground&&this.addCompositeBackground(i,r);var s=n;return a=e.addPass(this.createFilter(i,r),s),a.setFragmentName("SsaoBlurV"),t.composeBackground&&(this._stateSetCompositeBG=a.getStateSet()),s},getPackFunc:function(e){return["vec4 pack( const in vec4 col ) {","    vec4 rgbm;","    vec3 color = col.rgb / "+e+";","    rgbm.a = clamp( max( max( color.r, color.g ), max( color.b, 1e-6 ) ), 0.0, 1.0 );","    rgbm.a = ceil( rgbm.a * 255.0 ) / 255.0;","    rgbm.rgb = color / rgbm.a;","    return rgbm;","}"].join("\n")},getUnpackFunc:function(e){return["vec4 unpack( const in sampler2D tex, const in vec2 uv ) {","    vec4 col = texture2D(tex, uv);","    return vec4("+e+" * col.rgb * col.a, 1.0);","}"].join("\n")},addDofPass:function(e,t){var r=this.getSupportedFloatTexture()===m.Texture.HALF_FLOAT,a=i.i(n.a)().dofRes||2*this._viewerOSGJS.getCanvasPixelRatio(),o=this._uniforms.uDofScale,s={isPassDofDownsampleCoC:!0},u={TextureDepth:this._camera._textureDepth,uDofScale:o},l=this.getOrCreateTextureRTT(a,"dofCoC",m.Texture.NEAREST),c=e.addPass(this.createFilter(s,u),l);c.setFragmentName("DofDownsampleCoC"),s={isPassDofDilateNearH:!0},u={TextureCoC:l,TextureDepth:this._camera._textureDepth,uDofScale:o};var h=this.getOrCreateTextureRTT(a,"dofTmpCoCOrBlurred",m.Texture.LINEAR);c=e.addPass(this.createFilter(s,u),h),c.setFragmentName("DofNearDilateH"),s={isPassDofDilateNearV:!0},u={TextureCoC:h,TextureDepth:this._camera._textureDepth,uDofScale:o};var d=l;c=e.addPass(this.createFilter(s,u),d),c.setFragmentName("DofNearDilateV");var p;s={isPassDofDownsampleColor:!0,colorWithCoC:r},u={TextureColor:t.inputTexture},r&&(u.TextureCoC=d),p=this.getOrCreateTextureRTT(a,"dofDownsampleColor",m.Texture.NEAREST,r?m.Texture.HALF_FLOAT:m.Texture.UNSIGNED_BYTE),c=e.addPass(this.createFilter(s,u),p),c.setFragmentName("DofDownsampleColor"),s={isPassDofBlurCircular:!0,colorWithCoC:r},u={TextureColor:p,uDofScale:o},r||(u.TextureCoC=d);var f=h;c=e.addPass(this.createFilter(s,u),f),c.setFragmentName("DofBlurCircular"),s={isPassDofCombine:!0,RGBMTexture0:this._model.get("rgbmDefault"),RGBMTexture1:this._model.get("rgbmDefault"),RGBMTexture2:this._model.get("rgbmDefault"),encodeRGBM:t.outputInSRGB?null:this._model.get("rgbmDefault")},u={uOutputLinear:m.Uniform.createInt(t.outputInSRGB?0:1,"uOutputLinear"),Texture0:t.inputTexture,TextureBlurred:f,TextureCoCDilated:d,TextureDepth:this._camera._textureDepth,uDofScale:o,uBlurDiv:a},t.composeBackground&&this.addCompositeBackground(s,u);var g=this.getOrCreateTextureRTT(1,"dof",t.outputFiltering);return c=e.addPass(this.createFilter(s,u),g),c.setFragmentName("DofCombine"),t.composeBackground&&(this._stateSetCompositeBG=c.getStateSet()),g},addBloomPass:function(e,t){var i=this.getPackFunc(this._model.get("rgbmBloom").toExponential()),r=this.getUnpackFunc(this._model.get("rgbmBloom").toExponential()),n=m.Texture.LINEAR,a="none"!==this.getBackgroundType(),o={isPassBright:!0,RGBMTexture0:this._model.get("rgbmDefault"),encodeRGBM:this._model.get("rgbmBloom"),testDepthBloom:a},s={uBloomThreshold:this._uniforms.uBloomThreshold,uOutputLinear:m.Uniform.createInt(1,"uOutputLinear"),Texture0:t.inputTexture};o.testDepthBloom&&(s.TextureDepth=this._camera._textureDepth);var u=e.addPass(this.createFilter(o,s),this.getOrCreateTextureRTT(1,"bloom",n));u.setFragmentName("BloomExtractBright");var l=2*this._viewerOSGJS.getCanvasPixelRatio(),c=2*l,h=2*c,d=2*h,p=2*d,f=this._isOnMobile?void 0:this.getOrCreateTextureRTT(l,"blurH",n),g=this.getOrCreateTextureRTT(c,"blurH",n),_=this.getOrCreateTextureRTT(h,"blurH",n),b=this.getOrCreateTextureRTT(d,"blurH",n),x=this._isOnMobile?void 0:this.getOrCreateTextureRTT(p,"blurH",n);this._isOnMobile||(e.addPass(new v.Composer.Filter.VBlur(3,!0,r,i),this.getOrCreateTextureRTT(l,"blurV",n)),e.addPass(new v.Composer.Filter.HBlur(3,!0,r,i),f)),e.addPass(new v.Composer.Filter.VBlur(5,!0,r,i),this.getOrCreateTextureRTT(c,"blurV",n)),e.addPass(new v.Composer.Filter.HBlur(5,!0,r,i),g),e.addPass(new v.Composer.Filter.VBlur(7,!0,r,i),this.getOrCreateTextureRTT(h,"blurV",n)),e.addPass(new v.Composer.Filter.HBlur(7,!0,r,i),_),e.addPass(new v.Composer.Filter.VBlur(9,!0,r,i),this.getOrCreateTextureRTT(d,"blurV",n)),e.addPass(new v.Composer.Filter.HBlur(9,!0,r,i),b),this._isOnMobile||(e.addPass(new v.Composer.Filter.VBlur(11,!0,r,i),this.getOrCreateTextureRTT(p,"blurV",n)),e.addPass(new v.Composer.Filter.HBlur(11,!0,r,i),x));var S={isPassAdditive:!0,isOnMobile:this._isOnMobile,RGBMTexture0:this._model.get("rgbmDefault"),RGBMTexture1:this._model.get("rgbmBloom"),RGBMTexture2:this._model.get("rgbmBloom"),RGBMTexture3:this._model.get("rgbmBloom"),RGBMTexture4:this._model.get("rgbmBloom"),RGBMTexture5:this._model.get("rgbmBloom"),encodeRGBM:t.outputInSRGB?null:this._model.get("rgbmDefault"),composeExtra:t.composeExtra},y={uBloomFactor:this._uniforms.uBloomFactor,uBloomRadius:this._uniforms.uBloomRadius,uOutputLinear:m.Uniform.createInt(t.outputInSRGB?0:1,"uOutputLinear"),Texture0:t.inputTexture,Texture1:f,Texture2:g,Texture3:_,Texture4:b,Texture5:x};t.composeBackground&&this.addCompositeBackground(S,y),this.configureVeilAndExtra(S,y);var C=this.getOrCreateTextureRTT(1,"bloom",t.outputFiltering);return u=e.addPass(this.createFilter(S,y),C),u.setFragmentName("BloomMergeAdditive"),t.composeBackground&&(this._stateSetCompositeBG=u.getStateSet()),C},addMergeablePass:function(e,t){var i=this._effectiveConfig,r={isPassMergeable:!0,useChromaticAberration:i.useChromaticAberration,useVignetteMergeable:i.useVignetteMergeable,useToneMapping:i.useToneMapping,useColorBalance:i.useColorBalance,RGBMTexture0:this._model.get("rgbmDefault"),composeExtra:t.composeExtra},n={uOutputLinear:m.Uniform.createInt(t.outputInSRGB?0:1,"uOutputLinear"),Texture0:t.inputTexture};t.composeBackground&&this.addCompositeBackground(r,n),r.useChromaticAberration&&(n.uChromaFactor=this._uniforms.uChromaFactor),r.useVignetteMergeable&&(n.uLensRadius=this._uniforms.uLensRadius),r.useToneMapping&&(n.uToneExposure=this._uniforms.uToneExposure,n.uToneBrightness=this._uniforms.uToneBrightness,n.uToneContrast=this._uniforms.uToneContrast,n.uToneSaturation=this._uniforms.uToneSaturation,n.uToneMethod=this._uniforms.uToneMethod),r.useColorBalance&&(n.uColorBalanceLow=this._uniforms.uColorBalanceLow,n.uColorBalanceMid=this._uniforms.uColorBalanceMid,n.uColorBalanceHigh=this._uniforms.uColorBalanceHigh),this.configureVeilAndExtra(r,n);var a=this.getOrCreateTextureRTT(1,"mergeable",t.outputFiltering),o=e.addPass(this.createFilter(r,n),a);return o.setFragmentName("PostProcessMergeable"),t.composeBackground&&(this._stateSetCompositeBG=o.getStateSet()),a},configureVeilAndExtra:function(e,t){e.useVeil=this._model.get("webVR")&&e.composeExtra,e.linearize=this._model.get("webVR")&&e.composeExtra,e.composeExtra=e.composeExtra&&!!this._camera._textureExtra,e.useVeil&&(t.uVrVeilFactor=this._uniforms.uVrVeilFactor),e.composeExtra&&(t.TextureExtra=this._camera._textureExtra)},addSuperSampleTaaPass:function(e){var t=this._camera,i=this.getBackgroundType(),r="none"!==i,n={isPassSuperSample:!0,useTaa:this._effectiveConfig.useTaa,useTaaTransparent:this._effectiveConfig.useTaaTransparent,uNearFar:this._uniforms.uNearFar,RGBMTexture0:null,encodeRGBM:null,webVR:this._model.get("webVR")};this._rttAA1=this.getOrCreateTextureRTT(1,"Antialias1",m.Texture.LINEAR);var a=this.createCameraAA("Antialias1",this._rttAA1);this._rttAA0=this.getOrCreateTextureRTT(1,"Antialias0",m.Texture.LINEAR);var o=this.createCameraAA("Antialias0",this._rttAA0),u={uOutputLinear:m.Uniform.createInt(1,"uOutputLinear")};n.useTaa&&(u.uNearFar=this._uniforms.uNearFar,u.uTaaEnabled=this._uniforms.uTaaEnabled,u.uTaaInvViewMatrixLeft=this._uniforms.uTaaInvViewMatrixLeft,u.uTaaCurrentFramePVLeft=this._uniforms.uTaaCurrentFramePVLeft,u.uTaaLastFramePVLeft=this._uniforms.uTaaLastFramePVLeft,u.uTaaCornersCSLeft=this._uniforms.uTaaCornersCSLeft,n.webVR&&(u.uTaaInvViewMatrixRight=this._uniforms.uTaaInvViewMatrixRight,u.uTaaCurrentFramePVRight=this._uniforms.uTaaCurrentFramePVRight,u.uTaaLastFramePVRight=this._uniforms.uTaaLastFramePVRight,u.uTaaCornersCSRight=this._uniforms.uTaaCornersCSRight));var l=o.getOrCreateStateSet(),c=a.getOrCreateStateSet(),h=2;r&&!n.useTaa||this.addTextureToPingPong(l,c,h++,"TextureDepth",t._textureDepth),this._viewer.getSuperSample().setCanBeEnabled(r);var d=new s.a([],[],_);d.setPostProcessConfiguration(n),this._antialiasFilter=new v.Composer.Filter.PingPong(o,this._rttAA0,a,this._rttAA1,d.createFragmentShader(),u),this._antialiasFilter.setFragmentName("Antialias"),e.addPass(this._antialiasFilter)},addTextureToPingPong:function(e,t,i,r,n){e.addUniform(m.Uniform.createInt(i,r)),t.addUniform(m.Uniform.createInt(i,r)),e.setTextureAttributeAndModes(i,n),t.setTextureAttributeAndModes(i,n)},addFinalPass:function(e,t){var i=this._camera,r=this.getBackgroundType(),n="none"!==r,a=this._effectiveConfig.useSharpen,o=this._effectiveConfig.useVignetteSuperSample,s={isPassFinalPass:!0,background:r,useSharpen:a,testDepthSharpen:a&&n,useVignetteSuperSample:o,useGrain:this._effectiveConfig.useGrain,useDof:this._effectiveConfig.useDof,composeExtra:t.composeExtra,fxaa:n&&this._hasTriangles},u={uOutputLinear:m.Uniform.createInt(1,"uOutputLinear"),Texture0:this._rttAA0};this.configureVeilAndExtra(s,u),s.useGrain&&(u.uTimeGrain=this._uniforms.uTimeGrain,u.uGrainFactor=this._uniforms.uGrainFactor),a&&(u.uSharpFactor=this._uniforms.uSharpFactor),o&&(u.uLensRadius=this._uniforms.uLensRadius),s.useDof&&(u.uDofCross=this._uniforms.uDofCross),!s.testDepthSharpen&&n||(u.TextureDepth=i._textureDepth);var l=e.addPass(this.createFilter(s,u));l.setFragmentName("FinalPass"),this._stateSetFinalPass=l.getStateSet()},addFinalPassVR:function(e){var t={isPassFinalPassVR:!0,background:this.getBackgroundType(),hasBackground:!0,RGBMTexture0:null,encodeRGBM:null,doDistortionVR:this._model.get("doDistortionVR")&&i.i(n.a)().vrStereo},r={uOutputLinear:m.Uniform.createInt(1,"uOutputLinear"),Texture0:this._rttAA0,TextureDepth:this._camera._textureDepth,uVrFadeFactor:this._uniforms.uVrFadeFactor};t.doDistortionVR&&(r.uDistortion=this._uniforms.uDistortion,r.uProjectionLeft=this._uniforms.uProjectionLeft,r.uUnprojectionLeft=this._uniforms.uUnprojectionLeft);var a=e.addPass(this.createFilter(t,r));a.setFragmentName("FinalPassVR"),this._stateSetFinalPass=a.getStateSet()},updateEffectiveConfig:function(){var e=this._effectiveConfig,t=this._model.get("enable");e.useTransparency=o.a.get("hasTransparency")||this._model.get("webVR")||i.i(l.a)(),e.useSsao=t&&this._model.isEffectiveSsao(),e.useDof=t&&this._model.isEffectiveDof(),e.useBloom=t&&this._model.isEffectiveBloom(),e.useGrain=t&&this._model.isEffectiveGrain(),e.useSharpen=t&&this._model.isEffectiveSharpen();var r=this.getBackgroundType();e.useTaa=this._model.get("taaEnable")&&"none"!==r,e.useTaaTransparent=e.useTaa&&this._model.get("taaTransparent"),e.useChromaticAberration=t&&this._model.isEffectiveChromaticAberration(),e.useToneMapping=t&&this._model.isEffectiveToneMapping(),e.useColorBalance=t&&this._model.isEffectiveColorBalance(),e.usePassMergeable=e.useChromaticAberration||e.useToneMapping||e.useColorBalance,"fixed"!==r||e.usePassMergeable||e.useBloom||e.hasTransparency||(e.usePassMergeable=!0),e.useVignette=t&&this._model.isEffectiveVignette();var n=e.usePassMergeable&&("environment"===r||"color"===r);return e.useVignetteMergeable=n&&e.useVignette,e.useVignetteSuperSample=!n&&e.useVignette,this._effectiveConfig},needDepthTexture:function(){if(i.i(l.a)())return!0;var e=this._effectiveConfig;if(e.useDof||e.useBloom||e.useSharpen||e.useSsao||e.useTaa)return!0;if(this._viewer.getFeatures().hotspot.getModel().get("hotspots").length>0)return!0;var t=this.getBackgroundType();return"none"===t||"fixed"===t||this._model.get("webVR")},needExtraTexture:function(){return o.a.get("hasExtra")||this._model.get("webVR")},orderFilteringRequirement:function(){var e=this._effectiveConfig,t=[];return e.useSsao&&t.push(m.Texture.LINEAR),e.useTransparency&&t.push(m.Texture.NEAREST),e.useDof&&t.push(m.Texture.LINEAR),e.useBloom&&t.push(m.Texture.NEAREST),e.usePassMergeable&&t.push(m.Texture.NEAREST),t.push(m.Texture.LINEAR),t},updatePassConfig:function(e){var t=e.formatPasses;e.outputInSRGB=e.composeBackground=e.currentPass>=t.length-1,e.composeExtra=e.currentPass===(this._model.get("webVR")?t.length-1:t.length),e.outputFiltering=t[e.currentPass++]},createComposer:function(){var e=this.updateEffectiveConfig(),t=this.orderFilteringRequirement(),i=1===t.length,r=this._camera,n=r._textureOpaque=this.getOrCreateTextureOpaque(t[0]);r._textureExtra=this.needExtraTexture()?this.getOrCreateTextureExtra():void 0,r._textureTransparent=e.useTransparency?this.getOrCreateTextureTransparent():void 0,r._textureDepth=this.needDepthTexture()?this.getOrCreateTextureDepth():void 0;var a=new v.Composer;a.addPass(new v.Composer.Filter.InputTexture(n)).setFragmentName("InputTexture");var o={currentPass:1,formatPasses:t,outputFiltering:m.Texture.LINEAR,inputTexture:n,inputInSRGB:i,outputInSRGB:!0};return this._uniforms.uOutputLinear.setInt(i?0:1),this._uniforms.uRGBMRange.setFloat(i?-1:this._model.get("rgbmDefault")),this.onBackgroundColor(),i||(e.useSsao&&(this.updatePassConfig(o),o.inputTexture=this.addSsao(a,o)),e.useTransparency&&(this.updatePassConfig(o),o.inputTexture=this.addMergeOpacityPass(a,o)),e.useDof&&(this.updatePassConfig(o),o.inputTexture=this.addDofPass(a,o)),e.useBloom&&(this.updatePassConfig(o),o.inputTexture=this.addBloomPass(a,o)),e.usePassMergeable&&(this.updatePassConfig(o),o.inputTexture=this.addMergeablePass(a,o))),this.updatePassConfig(o),this.addSuperSampleTaaPass(a),this._model.get("webVR")?this.addFinalPassVR(a):this.addFinalPass(a,o),a.renderToScreen(this._viewerOSGJS.getCanvasWidth(),this._viewerOSGJS.getCanvasHeight()),a.build(),a},resetCameraAttachments:function(){var e=this._camera;e.resetAttachments(),e.frameBufferObjectOpaque&&(e.frameBufferObjectOpaque.reset(),e.frameBufferObjectOpaque=void 0),e.frameBufferObjectTransparent&&(e.frameBufferObjectTransparent.reset(),e.frameBufferObjectTransparent=void 0),e.frameBufferObjectDepth&&(e.frameBufferObjectDepth.reset(),e.frameBufferObjectDepth=void 0),e.frameBufferObjectExtra&&(e.frameBufferObjectExtra.reset(),e.frameBufferObjectExtra=void 0),e.attachRenderBuffer(m.FrameBufferObject.DEPTH_ATTACHMENT,m.FrameBufferObject.DEPTH_COMPONENT16)},createPathStandard:function(){var e=this.createComposer();if(e.setNodeMask(a.a.NO_PICK_NO_SHADOW),e.setName("PostProcess - Composer"),this.resetCameraAttachments(),2===this.getChildren().length&&this.removeChild(this.getChildren()[1]),this.addChild(e),i.i(n.a)().stats){for(var t=!this._model.get("webVR"),r=u.a.getTimerGPU(),o=e.getChildren(),s=o.length,l=0;l<s;++l){var c=o[l],h=c.getName();!t||l!==s-3&&l!==s-2||(h="Antialias"),c.setInitialDrawCallback(r.start.bind(r,h)),c.setFinalDrawCallback(r.end.bind(r,h))}o[s-1].setRenderOrder(m.Camera.POST_RENDER,0),this._camera.setFinalDrawCallback(function(){r.start("PostProcess")});var d=this._viewerOSGJS.getCamera();d.setInitialDrawCallback(r.start.bind(r,"Total GL")),d.setFinalDrawCallback(function(){r.end("PostProcess"),r.end("Total GL")})}}}),"osgSketchfab","PostProcess"),t.a=b},function(e,t,i){"use strict";var r=i(89),n=i(1057),a=i(1061),o={FeatureName:"postProcess",ModelType:n.a,ViewListType:[a.a]},s=r.a.create(o);s.prototype.getNodeIn=function(){return this._views[0]._nodeIn},s.prototype.getNodeOut=function(){return this._views[0]._nodeOut},s.prototype.getCamera=function(){return this._views[0]._camera},t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(53),a=i(139),o=i(31),s=i(46),u=i(69),l=i(389),c=i(511),h=i(90),d=r.a.osg,p=r.a.osgUtil,f=!1,g=!1,m=function(e){this._dirty=!0,this._view3d=e,this._uniforms=e._uniforms,this._effectiveConfig=e._effectiveConfig,this._viewer=e._viewer,this._viewerOSGJS=e._viewerOSGJS,this._model=e.model;var t=i.i(o.a)().dofTransition;this._interpolatorDofFocal=new p.DelayInterpolator(1,t?.15:1),this._interpolatorDofBlurNear=new p.DelayInterpolator(1,t?.15:1),this._interpolatorDofBlurFar=new p.DelayInterpolator(1,t?.15:1),this._interpolatorDofCross=new p.DelayInterpolator(1,t?.08:1),this._interpolatorDofCross._epsilon=-.01,this._dofInitialized=!1,this._dofAutoFocus=!1,this._tmpVec3=d.vec3.create(),this._eyePos=d.vec3.create(),this._dofLastPos=d.vec3.create(),this._dofLastFocal=0,this._firstFrame=!0,this._cullConfig=c.a.vrConfig,this._lastUpdateTime=this._viewerOSGJS.getFrameStamp().getSimulationTime();var r=this.dirty.bind(this);l.a.bind("change:hasTransparency",r),l.a.bind("change:hasExtra",r),s.a.getMaterial().then(function(){var e=this.getBackgroundModel();e.bind("change:enable",r),e.bind("change:enableVR",r)}.bind(this)),this._hookViewerCheckNeedToDoFrame(),this._hookViewerFrame(),this._hookViewerUpdateViewport()};d.createPrototypeObject(m,{dirty:function(){this._dirty=!0},getMainCamera:function(){return this._view3d._camera},getNodeIn:function(){return this._view3d._nodeIn},getBackgroundModel:function(){return this._viewer.getFeatures().background.getModel()},updateTargetDofBlurNear:function(){this._interpolatorDofBlurNear.setTarget(this._model.get("dofBlurNear"))},updateTargetDofBlurFar:function(){this._interpolatorDofBlurFar.setTarget(this._model.get("dofBlurFar"))},onEffectChanged:function(){return n.a.draw(),this.updateSizeUniforms(),this.updateDofScaleUniform(),this.getNodeIn().createPathStandard()},_hookViewerCheckNeedToDoFrame:function(){var e=this.getMainCamera(),t=this._viewerOSGJS,i=t.checkNeedToDoFrame.bind(t),r=this._viewer.getSuperSample();t.checkNeedToDoFrame=function(){var t=i(),n=f;return f=!1,t||!n?(r.setSwitch(!0),e.setNodeMask(-1),t):(r.setSwitch(!1),e.setNodeMask(0),!0)}},_hookViewerFrame:function(){var e=this.getMainCamera(),t=this._viewerOSGJS,i=this._viewer.getSuperSample(),r=t.frame.bind(t);t.frame=function(){r(),g&&(r(),g=!1),e.setNodeMask(-1),this._hmd&&this._hmd.isPresenting&&this._hmd.capabilities.hasExternalDisplay&&(i.setSwitch(!1),e.setNodeMask(0),this.getCamera().getRenderer().draw())}},_hookViewerUpdateViewport:function(){var e=this._viewerOSGJS,t=!0,r=-1,a=function(){t=!0},s=function(e){window.clearTimeout(r),t=!1,r=window.setTimeout(a,e)};this._viewer.on("freezeResize",s);var u=i.i(o.a)().resizeRate,l=e.updateViewport.bind(e);e.updateViewport=function(){return!!t&&(t=0===u,r=window.setTimeout(a,u),l())};var c=-1,h=-1,d=function(e,i){t=!0,c=e,h=i,n.a.draw()};this._viewer.on("resize",d);var p=e.computeCanvasSize.bind(e);e.computeCanvasSize=function(e){if(c<0)return p(e);var t=!1;return this._canvasWidth!==c&&(e.width=c,this._canvasWidth=c,t=!0),this._canvasHeight!==h&&(e.height=h,this._canvasHeight=h,t=!0),t}},showDofCross:function(){this._interpolatorDofCross.getCurrent()[0]=1,this._interpolatorDofCross.setTarget(0),d.vec3.copy(this._dofLastPos,this._model.get("dofFocusPoint")),this._dofLastFocal=this._interpolatorDofFocal.getCurrent()[0],n.a.draw()},computeFocalDistance:function(){var e=d.vec4.create();return function(){var t=this._model.get("dofFocusPoint");d.vec3.copy(e,t)[3]=1;var i=this._viewer.getCamera();d.vec4.transformMat4(e,e,i.getViewMatrix()),d.vec4.transformMat4(e,e,i.getProjectionMatrix());var r=this._uniforms.uNearFar.getInternalArray();return(e[3]-r[0])/(r[1]-r[0])}}(),updateDofFocusPoint:function(){this._interpolatorDofFocal.setTarget(this.computeFocalDistance()),this.showDofCross(),this._dofAutoFocus=!1},updateSizeUniforms:function(){var e=this._uniforms.uRenderSize.getInternalArray();e[0]=this._viewerOSGJS.getCanvasWidth(),e[1]=this._viewerOSGJS.getCanvasHeight(),this._uniforms.uPixelRatio.setFloat(this._viewerOSGJS.getCanvasPixelRatio())},updateGrain:function(e){if(this._effectiveConfig.useGrain&&this._model.get("grainAnimated")){f=!0;var t=e.getSimulationTime(),r=i.i(o.a)().grainSpeed/1e3;r>0&&t-this._lastUpdateTime>=r&&(this._uniforms.uTimeGrain.setFloat(t/1e3),this._lastUpdateTime=t)}},dofPickFocusPoint:function(){if(!i.i(o.a)().dofSticky){var e=this._viewer.getFeaturesManager(),t=this._viewerOSGJS.getCanvasClientWidth(),r=this._viewerOSGJS.getCanvasClientHeight(),n=this._dofAutoFocus?u.a.PICK_GEOMETRY_FIXED:u.a.PICK_GEOMETRY_SLOW,a=e.computeNearestIntersection2D(.5*t,.5*r,n);if(!a){var s=this._uniforms.uDofCross.getInternalArray();a=e.computeNearestIntersection2D(t*s[0],r*s[1],n)}a&&e.getWorldPositionFromHit(a,this._model.get("dofFocusPoint")),this._interpolatorDofFocal.setTarget(this.computeFocalDistance())}},dofUpdateShowCross:function(e,t){if(this._dofAutoFocus)this._interpolatorDofCross.getCurrent()[0]=0;else{var i=d.vec3.dist(this._dofLastPos,this._model.get("dofFocusPoint")),r=this._interpolatorDofFocal.getCurrent()[0];i>.1*e&&Math.abs(r-this._dofLastFocal)>.075&&t>.1&&this.showDofCross()}},dofUpdateInterpolators:function(e,t){this._interpolatorDofBlurNear.setTarget(this._model.get("dofBlurNear")*t),this._interpolatorDofBlurFar.setTarget(this._model.get("dofBlurFar")*t);var i=this._viewer.getFeaturesManager(),r=this._uniforms.uDofCross.getInternalArray();i.getScreenPositionFromWorldPoint(this._model.get("dofFocusPoint"),r),r[0]/=this._viewerOSGJS.getCanvasWidth(),r[1]/=this._viewerOSGJS.getCanvasHeight();var n=e.getDeltaTime();this._interpolatorDofBlurNear.update(n),this._interpolatorDofBlurFar.update(n),this._interpolatorDofFocal.update(n),this._interpolatorDofCross.update(n);var a=this._uniforms.uDofBlurNearFarFocal.getInternalArray();a[0]=this._interpolatorDofBlurNear.getCurrent()[0],a[1]=this._interpolatorDofBlurFar.getCurrent()[0],a[2]=this._interpolatorDofFocal.getCurrent()[0],a[3]=this._model.get("dofQuality")?1:0,this._uniforms.uDofCross.getInternalArray()[2]=this._interpolatorDofCross.getCurrent()[0],this._interpolatorDofCross.isDone()||(f=!0)},updateDof:function(e){if(this._model.isEffectiveDof()){var t=this._uniforms.uNearFar.getInternalArray();if(!(t[0]>t[1])){var r=this._viewerOSGJS.getManipulator();r.getEyePosition(this._tmpVec3);var n=r.getHomeBound(),a=n.radius(),u=d.vec3.dist(this._eyePos,this._tmpVec3)/a,l=u>=.01&&i.i(o.a)().dofAttenuateSpeed?0:1,c=r.getHomeDistance(r.getHomeBound());if(i.i(o.a)().dofAttenuateDistance){var h=(d.vec3.dist(n.center(),this._tmpVec3)-a)/(c-a);l*=Math.max(0,Math.min(1,1-h))}this._dofInitialized?this._dofAutoFocus||u>.01?(d.vec3.copy(this._eyePos,this._tmpVec3),this._dofAutoFocus=u>1e-5,this.dofPickFocusPoint(),this.dofUpdateShowCross(a,l)):this._interpolatorDofFocal.setTarget(this.computeFocalDistance()):(d.vec3.copy(this._eyePos,this._tmpVec3),this._interpolatorDofFocal.setTarget(this.computeFocalDistance()),s.a.getFirstCameraAnimation().isFulfilled()&&(this._dofInitialized=!0)),this.dofUpdateInterpolators(e,l)}}},getNewSize:function(e,t){return Math.max(1,Math.round(t/e))},updateDofScaleUniform:function(){var e=i.i(o.a)().dofRes||2*this._viewerOSGJS.getCanvasPixelRatio();this._uniforms.uDofScale.getInternalArray()[0]=.0015*this._viewerOSGJS._canvasHeight/e},resizePostProcess:function(e,t,i,r){for(var a=this.getNodeIn().getChildren()[1],o=a.getChildren(),s=0,u=o.length;s<u;++s){var l=o[s],c=1;l.isRenderToTextureCamera()&&((c=l.getAttachments()[d.FrameBufferObject.COLOR_ATTACHMENT0].texture.divisor)||(d.warn("missing divisor for texture, the rtt texture wasn't created by the postprocess feature!"),c=1));var h=this.getNewSize(c,i),p=this.getNewSize(c,r),f=l.getStateSet(),g=f.getUniform("RenderSize");if(g){var m=g.getInternalArray();m[0]=h,m[1]=p}var v=l.getViewport();v&&v.setViewport(0,0,h,p);for(var _=0;_<f.getNumTextureAttributeLists();_++){var b=f.getTextureAttribute(_,"Texture");b&&(b.divisor||d.warn("missing divisor for texture, the rtt texture wasn't created by the postprocess feature!"),b.divisor>0&&b.setTextureSize(this.getNewSize(b.divisor,i),this.getNewSize(b.divisor,r)))}}this.updateSizeUniforms(),this.updateDofScaleUniform(),n.a.draw(),this.getNodeIn().resetCameraAttachments()},updateDirtyEffect:function(){var e=this._viewerOSGJS.getCanvasWidth(),t=this._viewerOSGJS.getCanvasHeight();if(this._width&&this._height||(this._width=this._height=-1),e!==this._width||t!==this._height){this._dirty||this.resizePostProcess(this._width,this._height,e,t);var i=this.getMainCamera();i._textureOpaque&&i._textureOpaque.setTextureSize(e,t),i._textureTransparent&&i._textureTransparent.setTextureSize(e,t),i._textureDepth&&i._textureDepth.setTextureSize(e,t),i._textureExtra&&i._textureExtra.setTextureSize(e,t),this._width=e,this._height=t,this._dirty||(g=!0)}this._dirty&&(this.onEffectChanged(),this._dirty=!1)},updateFade:function(e){var t=this._model.get("vrFading");if(this._model.get("vrStartFade")&&!t&&(this._model.set("vrStartFade",!1),t=!0,this._model.set("vrFading",!0),this._model.set("vrFadeStartTime",e.getSimulationTime())),t){var i=this._model.get("vrFadeStartTime"),r=this._model.get("vrFadeLength"),n=e.getSimulationTime(),a=(n-i)/r,o=this._model.get("vrFadeCallback");n>i+r&&(a=1-(a-1),o&&(o(),this._model.set("vrFadeCallback",void 0)));var s=this._uniforms.uVrFadeFactor.getInternalArray();a>=0?s[0]=a:(s[0]=0,this._model.set("vrFading",!1))}},updateVeil:function(){this._uniforms.uVrVeilFactor.getInternalArray()[0]=this._model.get("veilFactor")},updateSsao:function(){if(this._model.isEffectiveSsao()){var e=this._uniforms.uNearFar.getInternalArray();if(!(e[0]>e[1])){var t=this._viewer.getCamera().getProjectionMatrix(),i=1===t[15]?1:2/t[5],r=-2*Math.tan(.5*i);this._uniforms.uSsaoProjectionScale.setFloat(this._height/r);var n=this._uniforms.uSsaoProjectionInfo.getInternalArray();n[0]=-2/(this._viewerOSGJS.getCanvasWidth()*t[0]),n[1]=-2/(this._viewerOSGJS.getCanvasHeight()*t[5]),n[2]=(1-t[8])/t[0],n[3]=(1-t[9])/t[5]}}},updateViewSpaceCorners:function(){var e=[d.vec4.fromValues(-1,-1,0,1),d.vec4.fromValues(1,-1,0,1),d.vec4.fromValues(-1,1,0,1),d.vec4.fromValues(1,1,0,1)],t=d.mat4.create(),i=d.vec3.create();return function(r,n){d.mat4.invert(t,r);for(var a=0;a<4;a++)d.vec3.transformMat4(i,e[a],t),d.vec3.scale(i,i,1/i[2]),n[3*a]=i[0],n[3*a+1]=i[1],n[3*a+2]=i[2]}}(),updateTaaMatrices:function(e,t,i){d.mat4.invert(i.invViewMatrix.getInternalArray(),e);var r=i.lastFrame.getInternalArray(),n=i.currentFrame.getInternalArray();d.mat4.copy(r,n),d.mat4.multiply(n,t,e),this._firstFrame&&d.mat4.copy(r,n),this.updateViewSpaceCorners(t,i.corners.getInternalArray())},updateTAA:function(){var e=d.mat4.create();return function(){var t=this._uniforms.uNearFar.getInternalArray();if(!(t[0]>t[1])&&this._model.get("taaEnable")){var r,n=this._viewer.getCamera().getViewMatrix(),a=this._model.get("webVR")&&!i.i(h.a)();a?(d.mat4.multiply(e,this._cullConfig.leftOffsetView,n),r=this._cullConfig.leftProjection):(e=n,r=this._viewer.getCamera().getProjectionMatrix());var o=this._uniforms;this.updateTaaMatrices(e,r,{invViewMatrix:o.uTaaInvViewMatrixLeft,lastFrame:o.uTaaLastFramePVLeft,currentFrame:o.uTaaCurrentFramePVLeft,corners:o.uTaaCornersCSLeft}),a&&(d.mat4.multiply(e,this._cullConfig.rightOffsetView,n),this.updateTaaMatrices(e,this._cullConfig.rightProjection,{invViewMatrix:o.uTaaInvViewMatrixRight,lastFrame:o.uTaaLastFramePVRight,currentFrame:o.uTaaCurrentFramePVRight,corners:o.uTaaCornersCSRight})),this._firstFrame&&(this._firstFrame=!1);var s=this._viewer.getFeatures().animation.getModel(),u=s.get("animations").length&&s.get("playing")&&"-1"!==s.get("currentUID");this._uniforms.uTaaEnabled.setFloat(u?0:1)}}}(),updateNearFarRatio:function(){var e;if(this._model.get("webVR")){var t=this._viewer.getFeatures().webVR.getModel(),i=t.get("worldFactor")/a.a.getModelBoxWithDisplacement().radius();e=i>0?.005*Math.max(.1,i):.005}else e=this._viewer.getFeatures().camera.getModel().get("nearFarRatio");this.getMainCamera().setNearFarRatio(e)},update:function(e,t){if(!this._model.get("postProcessReady"))return!0;var i=t.getFrameStamp();return this._viewer.getSuperSample().isEnabled()&&this._uniforms.uTime.setFloat(i.getSimulationTime()/1e3),this._uniforms.uTimeDithering.setFloat(i.getSimulationTime()/1e3),this.updateNearFarRatio(),this.updateTAA(i),this.updateSsao(i),this.updateGrain(i),this.updateDof(i),this.updateFade(i),this.updateVeil(i),this.updateDirtyEffect(),m}}),t.a=m},function(e,t,i){"use strict";var r=i(5),n=i(4),a=i(129),o=i(53),s=i(1058),u=i(1060),l=i(863),c=i.n(l),h=i(860),d=i.n(h),p=i(861),f=i.n(p),g=i(862),m=i.n(g),v=i(864),_=i.n(v),b=r.a.osg,x=a.a.getShaderProcessor(),S=n.a.extend({initialize:function(){n.a.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:webVR",this.onVR,this),e.bind("change:distortVR",this.dirty,this),e.bind("change:enable",this.dirty,this),e.bind("change:grainEnable",this.checkGrainEnable,this),e.bind("change:sharpenEnable",this.checkSharpenEnable,this),e.bind("change:chromaticAberrationEnable",this.checkChromaticAberrationEnable,this),e.bind("change:vignetteEnable",this.checkVignetteEnable,this),e.bind("change:bloomEnable",this.checkBloomEnable,this),e.bind("change:dofEnable",this.checkDofEnable,this),e.bind("change:toneMappingEnable",this.dirty,this),e.bind("change:colorBalanceEnable",this.dirty,this),e.bind("change:ssaoEnable",this.dirty,this),e.bind("change:taaEnable",this.checkTaaEnable,this),e.bind("change:taaTransparent",this.checkTaaTransparentEnable,this),e.bind("change:distortion",this.onDistortionChanged,this),e.bind("change:projectionLeft",this.onProjectionLeftChanged,this),e.bind("change:unprojectionLeft",this.onUnprojectionLeftChanged,this),e.bind("change:grainFactor",this.onGrainFactor,this),e.bind("change:sharpenFactor",this.onSharpenFactor,this),e.bind("change:chromaticAberrationFactor",this.onChromaticAberrationFactor,this),e.bind("change:vignetteLens",this.onVignetteLensChanged,this),e.bind("change:bloomFactor",this.onBloomFactorChanged,this),e.bind("change:bloomThreshold",this.onBloomThresholdChanged,this),e.bind("change:bloomRadius",this.onBloomRadiusChanged,this),e.bind("change:toneMappingExposure",this.onToneMappingExposureChanged,this),e.bind("change:toneMappingBrightness",this.onToneMappingBrightnessChanged,this),e.bind("change:toneMappingContrast",this.onToneMappingContrastChanged,this),e.bind("change:toneMappingSaturation",this.onToneMappingSaturationChanged,this),e.bind("change:toneMappingMethod",this.onToneMappingMethodChanged,this),e.bind("change:colorBalanceLow",this.onColorBalanceShiftChanged,this),e.bind("change:colorBalanceMid",this.onColorBalanceShiftChanged,this),e.bind("change:colorBalanceHigh",this.onColorBalanceShiftChanged,this),e.bind("change:dofFocusPoint",this.onDofFocusPoint,this),e.bind("change:dofBlurNear",this.onDofBlurNear,this),e.bind("change:dofBlurFar",this.onDofBlurFar,this),e.bind("change:ssaoIntensity",this.onSsaoIntensity,this),e.bind("change:ssaoRadius",this.onSsaoRadius,this),e.bind("change:ssaoBias",this.onSsaoBias,this),e.bind("change",o.a.draw),this.addShaders(),this._effectiveConfig={},this._viewer=this.model._viewer,this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._uniforms=this.createUniforms(),this._camera=this.createMainCamera(),this._nodeIn=new s.a(this),this._nodeOut=this.createNodeOut(),this._nodeIn.addChild(this._camera),this._camera.addChild(this._nodeOut),this._updatePostProcess=new u.a(this),this._nodeIn.addUpdateCallback(this._updatePostProcess)},dirty:function(){this._updatePostProcess.dirty()},addShaders:function(){var e={"postProcess.glsl":c.a,"postProcess-antiAlias.glsl":d.a,"postProcess-distortion.glsl":f.a,"dof.glsl":m.a,"ssao.glsl":_.a};x.addShaders(e)},createNodeOut:function(){var e=new b.Node;return e.setName("PostProcess - node Out"),e},createMainCamera:function(){var e=new b.Camera;return e.setName("PostProcess - MainCamera"),e.setRenderOrder(b.Camera.PRE_RENDER,0),e.getOrCreateStateSet().addUniform(this._uniforms.uRenderSize),e.attachRenderBuffer(b.FrameBufferObject.DEPTH_ATTACHMENT,b.FrameBufferObject.DEPTH_COMPONENT16),e},createUniforms:function(){var e=this.model,t=this._viewerOSGJS.getFrameStamp().getSimulationTime();return{uDistortion:b.Uniform.createFloat2(e.get("distortion"),"uDistortion"),uProjectionLeft:b.Uniform.createFloat4(e.get("projectionLeft"),"uProjectionLeft"),uUnprojectionLeft:b.Uniform.createFloat4(e.get("unprojectionLeft"),"uUnprojectionLeft"),uTimeGrain:b.Uniform.createFloat(t,"uTimeGrain"),uGrainFactor:b.Uniform.createFloat(e.get("grainFactor"),"uGrainFactor"),uSharpFactor:b.Uniform.createFloat(e.get("sharpenFactor"),"uSharpFactor"),uChromaFactor:b.Uniform.createFloat(e.get("chromaticAberrationFactor"),"uChromaFactor"),uLensRadius:b.Uniform.createFloat2(e.get("vignetteLens"),"uLensRadius"),uBloomFactor:b.Uniform.createFloat(e.get("bloomFactor"),"uBloomFactor"),uBloomThreshold:b.Uniform.createFloat(e.get("bloomThreshold"),"uBloomThreshold"),uBloomRadius:b.Uniform.createFloat(e.get("bloomRadius"),"uBloomRadius"),uToneExposure:b.Uniform.createFloat(e.get("toneMappingExposure"),"uToneExposure"),uToneBrightness:b.Uniform.createFloat(e.get("toneMappingBrightness"),"uToneBrightness"),uToneContrast:b.Uniform.createFloat(e.get("toneMappingContrast"),"uToneContrast"),uToneSaturation:b.Uniform.createFloat(e.get("toneMappingSaturation"),"uToneSaturation"),uToneMethod:b.Uniform.createInt(this.methodToInt(e.get("toneMappingMethod")),"uToneMethod"),uColorBalanceLow:b.Uniform.createFloat3(e.get("colorBalanceLow"),"uColorBalanceLow"),uColorBalanceMid:b.Uniform.createFloat3(e.get("colorBalanceMid"),"uColorBalanceMid"),uColorBalanceHigh:b.Uniform.createFloat3(e.get("colorBalanceHigh"),"uColorBalanceHigh"),uDofBlurNearFarFocal:b.Uniform.createFloat4(b.vec4.fromValues(e.get("dofBlurNear"),e.get("dofBlurFar"),.5,0),"uDofBlurNearFarFocal"),uDofCross:b.Uniform.createFloat3(b.vec3.create(),"uDofCross"),uDofScale:b.Uniform.createFloat(1,"uDofScale"),uSsaoRadius:b.Uniform.createFloat(e.get("ssaoRadius"),"uSsaoRadius"),uSsaoIntensity:b.Uniform.createFloat(e.get("ssaoIntensity"),"uSsaoIntensity"),uSsaoBias:b.Uniform.createFloat(e.get("ssaoBias"),"uSsaoBias"),uSsaoProjectionInfo:b.Uniform.createFloat4("uSsaoProjectionInfo"),uSsaoProjectionScale:b.Uniform.createFloat(1,"uSsaoProjectionScale"),uVrFadeFactor:b.Uniform.createFloat(0,"uVrFadeFactor"),uVrVeilFactor:b.Uniform.createFloat(1,"uVrVeilFactor"),uTaaInvViewMatrixLeft:b.Uniform.createMatrix4("uTaaInvViewMatrixLeft"),uTaaCurrentFramePVLeft:b.Uniform.createMatrix4("uTaaCurrentFramePVLeft"),uTaaLastFramePVLeft:b.Uniform.createMatrix4("uTaaLastFramePVLeft"),uTaaCornersCSLeft:b.Uniform.createFloat3Array("uTaaCornersCSLeft",4),uTaaEnabled:b.Uniform.createFloat(1,"uTaaEnabled"),uTaaInvViewMatrixRight:b.Uniform.createMatrix4("uTaaInvViewMatrixRight"),uTaaCurrentFramePVRight:b.Uniform.createMatrix4("uTaaCurrentFramePVRight"),uTaaLastFramePVRight:b.Uniform.createMatrix4("uTaaLastFramePVRight"),uTaaCornersCSRight:b.Uniform.createFloat3Array("uTaaCornersCSRight",4),uNearFar:this._viewer.getCamera().getRenderer().getCullVisitor().getNearFarUniform(),uRenderSize:b.Uniform.createFloat2("RenderSize"),uOutputLinear:b.Uniform.createInt(1,"uOutputLinear"),uRGBMRange:b.Uniform.createFloat(e.get("rgbmDefault"),"uRGBMRange"),uPixelRatio:b.Uniform.createFloat(1,"uPixelRatio"),uTime:b.Uniform.createFloat(t,"uTime"),uTimeDithering:b.Uniform.createFloat(t,"uTimeDithering")}},methodToInt:function(e){return"reinhard"===e?1:"filmic"===e?2:0},onVR:function(){var e=this._viewer.getSuperSample();e.setSwitch(!0),e.reset(),e.setCanBeEnabled(!0),this.dirty()},checkGrainEnable:function(){this._effectiveConfig.useGrain!==this.model.isEffectiveGrain()&&this.dirty()},checkSharpenEnable:function(){this._effectiveConfig.useSharpen!==this.model.isEffectiveSharpen()&&this.dirty()},checkChromaticAberrationEnable:function(){this._effectiveConfig.useChromaticAberration!==this.model.isEffectiveChromaticAberration()&&this.dirty()},checkVignetteEnable:function(){this._effectiveConfig.useVignette!==this.model.isEffectiveVignette()&&this.dirty()},checkBloomEnable:function(){this._effectiveConfig.useBloom!==this.model.isEffectiveBloom()&&this.dirty()},checkDofEnable:function(){this._effectiveConfig.useDof!==this.model.isEffectiveDof()&&this.dirty()},checkSsaoEnable:function(){this._effectiveConfig.useSsao!==this.model.isEffectiveSsao()&&this.dirty()},checkTaaEnable:function(){this._effectiveConfig.useTaa!==this.model.get("taaEnable")&&this.dirty()},checkTaaTransparentEnable:function(){this._effectiveConfig.useTaaTransparent!==(this.model.get("taaEnable")&&this.model.get("taaTransparent"))&&this.dirty()},onDistortionChanged:function(){this._uniforms.uDistortion.setFloat2(this.model.get("distortion"))},onProjectionLeftChanged:function(){this._uniforms.uProjectionLeft.setFloat4(this.model.get("projectionLeft"))},onUnprojectionLeftChanged:function(){this._uniforms.uUnprojectionLeft.setFloat4(this.model.get("unprojectionLeft"))},onGrainFactor:function(){this._uniforms.uGrainFactor.setFloat(this.model.get("grainFactor")),this.checkGrainEnable()},onSharpenFactor:function(){this._uniforms.uSharpFactor.setFloat(this.model.get("sharpenFactor")),this.checkSharpenEnable()},onChromaticAberrationFactor:function(){this._uniforms.uChromaFactor.setFloat(this.model.get("chromaticAberrationFactor")),this.checkChromaticAberrationEnable()},onVignetteLensChanged:function(){this._uniforms.uLensRadius.setFloat2(this.model.get("vignetteLens")),this.checkVignetteEnable()},onBloomFactorChanged:function(){this._uniforms.uBloomFactor.setFloat(this.model.get("bloomFactor")),this.checkBloomEnable()},onBloomThresholdChanged:function(){this._uniforms.uBloomThreshold.setFloat(this.model.get("bloomThreshold")),this.checkBloomEnable()},onBloomRadiusChanged:function(){this._uniforms.uBloomRadius.setFloat(this.model.get("bloomRadius")),this.checkBloomEnable()},onColorBalanceShiftChanged:function(){this._uniforms.uColorBalanceLow.setFloat3(this.model.get("colorBalanceLow")),this._uniforms.uColorBalanceMid.setFloat3(this.model.get("colorBalanceMid")),this._uniforms.uColorBalanceHigh.setFloat3(this.model.get("colorBalanceHigh"))},onToneMappingExposureChanged:function(){this._uniforms.uToneExposure.setFloat(this.model.get("toneMappingExposure"))},onToneMappingBrightnessChanged:function(){this._uniforms.uToneBrightness.setFloat(this.model.get("toneMappingBrightness"))},onToneMappingContrastChanged:function(){this._uniforms.uToneContrast.setFloat(this.model.get("toneMappingContrast"))},onToneMappingSaturationChanged:function(){this._uniforms.uToneSaturation.setFloat(this.model.get("toneMappingSaturation"))},onToneMappingMethodChanged:function(){this._uniforms.uToneMethod.setInt(this.methodToInt(this.model.get("toneMappingMethod")))},onDofFocusPoint:function(){this._updatePostProcess.updateDofFocusPoint()},onDofBlurNear:function(){this._updatePostProcess.updateTargetDofBlurNear(),this.checkDofEnable()},onDofBlurFar:function(){this._updatePostProcess.updateTargetDofBlurFar(),this.checkDofEnable()},onSsaoRadius:function(){this._uniforms.uSsaoRadius.setFloat(this.model.get("ssaoRadius")),this.checkSsaoEnable()},onSsaoIntensity:function(){this._uniforms.uSsaoIntensity.setFloat(this.model.get("ssaoIntensity")),this.checkSsaoEnable()},onSsaoBias:function(){this._uniforms.uSsaoBias.setFloat(this.model.get("ssaoBias"))}});t.a=S},function(e,t,i){"use strict";var r=i(5),n=i(387),a=i(1063),o=r.a.osg,s=r.a.osgShader;s.nodeFactory.registerNodes(a.a);var u=function(){n.a.apply(this,arguments),this.config={}};s.Compiler.setStateAttributeConfig(u,s.Compiler.cloneStateAttributeConfig(n.a)),o.createPrototypeObject(u,o.objectInherit(n.a.prototype,{getFragmentShaderName:function(){return""},setPostProcessConfiguration:function(e){this.config=e,this._customVertexShader=!0},createFragmentShaderGraph:function(){var e=this.config,t=[];return e.isPassMergeable?this.createFragmentMergeable(t):e.isPassMergeOpacity?this.createMergeOpacity(t):e.isPassDepthMipmap?this.createDepthMipmap(t):e.isPassDofDownsampleCoC?this.createFragmentDofDownsampleCoC(t):e.isPassDofDownsampleColor?this.createFragmentDofDownsampleColor(t):e.isPassDofDilateNearH||e.isPassDofDilateNearV?this.createFragmentDofDilateNear(t):e.isPassDofBlurCircular?this.createFragmentDofBlurCircular(t):e.isPassDofCombine?this.createFragmentDofCombine(t):e.isPassSsaoExtract?this.createFragmentSsaoExtract(t):e.isPassSsaoBlurV||e.isPassSsaoBlurH?this.createFragmentSsaoBlur(t):e.isPassBright?this.createFragmentBright(t):e.isPassAdditive?this.createFragmentAdditive(t):e.isPassSuperSample?e.useTaa?this.createFragmentSuperSampleTaa(t):this.createFragmentSuperSample(t):e.isPassFinalPassVR?this.createFragmentFinalPassVR(t):e.isPassFinalPass?this.createFragmentFinalPass(t):t},getFetch0x0y0:function(){return this._fetch0x0y0?this._fetch0x0y0:(this._fetch0x0y0=this.textureFetch(this.getOrCreateSampler("sampler2D","Texture0"),this.getUv()),this._fetch0x0y0)},getUv:function(){return this.config.doDistortionVR?this.getOrCreateDistortion():this.getOrCreateVarying("vec2","vTexCoord0")},createFragmentFinalPassVR:function(e){var t=this.getFetch0x0y0(),i="none"===this.config.background?this.getOrCreateAlpha():this.createVariable("float").setValue("1.0");return t=this.createFade(t),e.push(this.getFragColor(t,i)),e},createFade:function(e){var t=this.createVariable(e.getType());return this.getNode("InlineCode").code("%outColor = mix( %inColor, %black, clamp(%fadeFactor, 0.0, 1.0) );").inputs({inColor:e,fadeFactor:this.getOrCreateUniform("float","uVrFadeFactor"),black:this.getOrCreateConstantZero(e.getType())}).outputs({outColor:t}),t},createMergeOpacity:function(e){var t=this.createVariable("vec3"),i=this.textureFetch(this.getOrCreateSampler("sampler2D","TextureTransparent"),this.getUv());return this.getNode("InlineCode").code("%outcolor = %opaque.rgb * (1.0 - %transparent.a) + %transparent.rgb;").inputs({opaque:this.getFetch0x0y0(),transparent:i}).outputs({outcolor:t}),e.push(this.getFragColor(t)),e},createDepthMipmap:function(e){var t=this.getNode("glFragColor"),i=["float depth = dot(%depthPacked.rgb, vec3(1.0, 1.0/255.0, 1.0/65025.0));","%frag.rgb = vec3(1.0, 255.0, 65025.0) * depth;","%frag.gb = fract(%frag.gb);","%frag.rg -= %frag.gb * (1.0/256.0);"].join("\n");return this.getNode("InlineCode").code(i).inputs({depthPacked:this.getFetch0x0y0()}).outputs({frag:t}),e.push(t),e},createFragmentSuperSample:function(e){var t=this.config,i=this.createSuperSample(),r="none"===t.background?this.getOrCreateAlpha():this.createVariable("float").setValue("1.0");return e.push(this.getFragColor(i,r)),e},createFragmentSuperSampleTaa:function(e){var t=this.getOrCreateAlpha(),i=this.createSuperSampleTaa(t);return e.push(this.getFragColor(i)),e},getOrCreateProjectionMatrix:function(){return this.getOrCreateUniform("mat4","uProjectionMatrix")},createFragmentFinalPass:function(e){var t=this.config,i=t.fxaa?this.createAntiAlias():this.getFetch0x0y0();t.useSharpen&&(i=this.createSharpen(i));var r="none"===t.background?this.getOrCreateAlpha():this.createVariable("float").setValue("1.0");return t.useVignetteSuperSample&&(r=i=this.createVignette(i,r)),t.useGrain&&(i=this.createGrain(i)),t.useDof&&(i=this.createDofCross(i)),e.push(this.getFragColor(i,r)),e},createGrain:function(e){return this.getNode("Grain").inputs({color:e,uv:this.getUv(),time:this.getOrCreateUniform("float","uTimeGrain"),factor:this.getOrCreateUniform("float","uGrainFactor")}).outputs({color:e}),e},createDofCross:function(e){return this.getNode("DofCross").inputs({color:e,uv:this.getUv(),renderSize:this.getOrCreateUniform("vec2","RenderSize"),pixelRatio:this.getOrCreateUniform("float","uPixelRatio"),dofCross:this.getOrCreateUniform("vec3","uDofCross")}).outputs({color:e}),e},createFragmentDofDownsampleCoC:function(e){var t=this.getNode("glFragColor");return this.getNode("DofDownsampleCoC").inputs({samplerDepth:this.getOrCreateSampler("sampler2D","TextureDepth"),uv:this.getUv(),dofBlurNearFarFocal:this.getOrCreateUniform("vec4","uDofBlurNearFarFocal")}).outputs({color:t}),e.push(t),e},createFragmentDofDownsampleColor:function(e){var t=this.getNode("glFragColor");return this.getNode("DofDownsampleColor").inputs({samplerColor:this.getOrCreateSampler("sampler2D","TextureColor"),samplerCoC:this.config.colorWithCoC?this.getOrCreateSampler("sampler2D","TextureCoC"):void 0,uv:this.getUv()}).outputs({color:t}),e.push(t),e},createFragmentDofDilateNear:function(e){var t=this.getNode("glFragColor");return this.getNode("DofDilateNear").setVertical(!!this.config.isPassDofDilateNearV).inputs({samplerCoC:this.getOrCreateSampler("sampler2D","TextureCoC"),samplerDepth:this.getOrCreateSampler("sampler2D","TextureDepth"),uv:this.getUv(),texSize:this.getOrCreateUniform("vec2","RenderSize"),dofScale:this.getOrCreateUniform("float","uDofScale"),dofBlurNearFarFocal:this.getOrCreateUniform("vec4","uDofBlurNearFarFocal")}).outputs({color:t}),e.push(t),e},createFragmentDofBlurCircular:function(e){var t=this.getNode("glFragColor");return this.getNode("DofBlurCircular").inputs({samplerColor:this.getOrCreateSampler("sampler2D","TextureColor"),samplerCoC:this.getOrCreateSampler("sampler2D",this.config.colorWithCoC?"TextureColor":"TextureCoC"),uv:this.getUv(),texSize:this.getOrCreateUniform("vec2","RenderSize"),time:this.getOrCreateUniform("float","uTime"),dofScale:this.getOrCreateUniform("float","uDofScale"),dofBlurNearFarFocal:this.getOrCreateUniform("vec4","uDofBlurNearFarFocal")}).outputs({color:t}),e.push(t),e},createFragmentDofCombine:function(e){var t=this.createVariable("vec3");return this.getNode("DofCombine").inputs({color:this.getFetch0x0y0(),samplerBlur:this.getOrCreateSampler("sampler2D","TextureBlurred"),samplerCoC:this.getOrCreateSampler("sampler2D","TextureCoCDilated"),samplerDepth:this.getOrCreateSampler("sampler2D","TextureDepth"),range:this.getOrCreateUniform("float","uRGBMRange"),uv:this.getUv(),texSize:this.getOrCreateUniform("vec2","RenderSize"),dofScale:this.getOrCreateUniform("float","uDofScale"),dofBlurNearFarFocal:this.getOrCreateUniform("vec4","uDofBlurNearFarFocal"),blurDiv:this.getOrCreateUniform("float","uBlurDiv")}).outputs({color:t}),e.push(this.getFragColor(t)),e},createFragmentSsaoExtract:function(e){var t=this.getNode("glFragColor");return this.getNode("SsaoExtract").inputs({samplerDepth:this.getOrCreateSampler("sampler2D","TextureDepth"),samplerDepth1:this.getOrCreateSampler("sampler2D","TextureDepth1"),samplerDepth2:this.getOrCreateSampler("sampler2D","TextureDepth2"),samplerDepth3:this.getOrCreateSampler("sampler2D","TextureDepth3"),samplerDepth4:this.getOrCreateSampler("sampler2D","TextureDepth4"),samplerDepth5:this.getOrCreateSampler("sampler2D","TextureDepth5"),uv:this.getUv(),nearFar:this.getOrCreateUniform("vec2","uNearFar"),radius:this.getOrCreateUniform("float","uSsaoRadius"),intensity:this.getOrCreateUniform("float","uSsaoIntensity"),bias:this.getOrCreateUniform("float","uSsaoBias"),projectionInfo:this.getOrCreateUniform("vec4","uSsaoProjectionInfo"),projectionScale:this.getOrCreateUniform("float","uSsaoProjectionScale"),texSize:this.getOrCreateUniform("vec2","RenderSize"),time:this.getOrCreateUniform("float","uTime")}).outputs({color:t}),e.push(t),e},createFragmentSsaoBlur:function(e){var t=this.config.isPassSsaoBlurV?this.createVariable("vec3"):this.getNode("glFragColor");return this.getNode("SsaoBlur").setVertical(!!this.config.isPassSsaoBlurV).inputs({samplerSsao:this.getOrCreateSampler("sampler2D","TextureSsao"),color:this.config.isPassSsaoBlurV?this.getFetch0x0y0():void 0,uv:this.getUv(),nearFar:this.getOrCreateUniform("vec2","uNearFar"),texSize:this.getOrCreateUniform("vec2","RenderSize")}).outputs({color:t}),this.config.isPassSsaoBlurV?e.push(this.getFragColor(t)):e.push(t),e},createFragmentBright:function(e){var t=this.createVariable("vec3");return this.getNode("ExtractBright").inputs({color:this.getFetch0x0y0(),threshold:this.getOrCreateUniform("float","uBloomThreshold"),alpha:this.config.testDepthBloom?this.getOrCreateAlpha():void 0}).outputs({color:t}),e.push(this.getFragColor(t)),e},getFactoredTex:function(e,t,i){var r=this.textureFetch(this.getOrCreateSampler("sampler2D","Texture"+e),t),n=this.createVariable("vec4");return this.getNode("Mult").inputs(r,i||this.createVariable("float").setValue("1.0")).outputs(n),n},getRadiusFactored:function(e,t){var i=this.createVariable("float").setValue(e.toExponential()),r=this.createVariable("float").setValue((2*t-e).toExponential()),n=this.createVariable("float");return this.getNode("Blend").mode("MIX").inputs(i,r,this.getOrCreateUniform("float","uBloomRadius")).outputs(n),n},createFragmentAdditive:function(e){var t=this.getUv(),i=this.config.isOnMobile,r=[],n=i?1:.6;i||r.push(this.getFactoredTex(1,t,this.getRadiusFactored(1.1,n))),r.push(this.getFactoredTex(2,t,this.getRadiusFactored(i?1.5:.9,n))),r.push(this.getFactoredTex(3,t,this.getRadiusFactored(i?1:.6,n))),r.push(this.getFactoredTex(4,t,this.getRadiusFactored(i?.5:.3,n))),i||r.push(this.getFactoredTex(5,t,this.getRadiusFactored(.1,n)));var a=this.createVariable("vec4");this.getNode("Add").inputs(r).outputs(a);var o=this.createVariable("vec4");return this.getNode("Blend").mode("ADD").inputs(this.getFetch0x0y0(),a,this.getOrCreateUniform("float","uBloomFactor")).outputs(o),e.push(this.getFragColor(o)),e},createFragmentMergeable:function(e){var t,i=this.config;return i.useChromaticAberration?t=this.createChromaticAberration():(t=this.createVariable("vec3"),this.getNode("SetFromNode").inputs(this.getFetch0x0y0()).outputs(t)),i.useVignetteMergeable&&(t=this.createVignette(t)),i.useColorBalance&&(t=this.createColorBalance(t)),i.useToneMapping&&(t=this.createToneMapping(t)),e.push(this.getFragColor(t)),e},createVeil:function(e){var t=this.createVariable(e.getType());return this.getNode("Mult").inputs(e,this.getOrCreateUniform("float","uVrVeilFactor")).outputs(t),t},getFragColor:function(e,t){var i=this.getNode("glFragColor");this.config.useVeil&&(e=this.createVeil(e)),this.config.composeExtra&&(t||(t="none"===this.config.background?this.getOrCreateAlpha():this.createVariable("float").setValue("1.0")),t=e=this.createComposeExtra(e,t)),this.config.useComposeBackground&&(e=this.createComposeBackgroundFixed(e,this.getOrCreateAlpha()));var r=this.getSrgbColor(e);return this.config.encodeRGBM?this.getNode("EncodeRGBM").inputs({color:r,range:this.createVariable("float").setValue(this.config.encodeRGBM.toExponential())}).outputs({color:i}):this.getNode("SetAlpha").inputs({color:r,alpha:t||this.getFetch0x0y0()}).outputs({color:i}),i},createSuperSample:function(e){var t=this.createVariable("vec3");return this.getNode("SuperSample").inputs({color:e,currentTex:this.getOrCreateSampler("sampler2D","Texture0"),prevTex:this.getOrCreateSampler("sampler2D","Texture1"),uv:this.getUv(),texSize:this.getOrCreateUniform("vec2","RenderSize"),halton:this.getOrCreateUniform("vec4","uHalton")}).outputs({color:t}),t},createSuperSampleTaa:function(e){var t=this.createVariable("vec3"),i=this.getOrCreateUniform("vec3","uTaaCornersCSLeft");i.globalDeclaration=function(){return"uniform vec3 "+i.getVariable()+"[4];"};var r={currentTex:this.getOrCreateSampler("sampler2D","Texture0"),prevTex:this.getOrCreateSampler("sampler2D","Texture1"),uv:this.getUv(),texSize:this.getOrCreateUniform("vec2","RenderSize"),halton:this.getOrCreateUniform("vec4","uHalton"),depth:this.getOrCreateSampler("sampler2D","TextureDepth"),nearFar:this.getOrCreateUniform("vec2","uNearFar"),enableTaa:this.getOrCreateUniform("float","uTaaEnabled"),alpha:e,invViewLeft:this.getOrCreateUniform("mat4","uTaaInvViewMatrixLeft"),currentFrameProjViewLeft:this.getOrCreateUniform("mat4","uTaaCurrentFramePVLeft"),lastFrameProjViewLeft:this.getOrCreateUniform("mat4","uTaaLastFramePVLeft"),cornersLeft:i};if(this.config.webVR){r.invViewRight=this.getOrCreateUniform("mat4","uTaaInvViewMatrixRight"),r.currentFrameProjViewRight=this.getOrCreateUniform("mat4","uTaaCurrentFramePVRight"),r.lastFrameProjViewRight=this.getOrCreateUniform("mat4","uTaaLastFramePVRight");var n=this.getOrCreateUniform("vec3","uTaaCornersCSRight");n.globalDeclaration=function(){return"uniform vec3 "+n.getVariable()+"[4];"},r.cornersRight=n}return this.getNode("SuperSampleTaa").setTransparent(this.config.useTaaTransparent).inputs(r).outputs({color:t}),t},createComposeExtra:function(e,t){var i=this.textureFetch(this.getOrCreateSampler("sampler2D","TextureExtra"),this.getUv());return this.config.linearize&&this.getNode("sRGBToLinear").inputs({color:i}).outputs({color:i}),this.getNode("ComposeExtra").inputs({color:e,alpha:t,extra:i}).outputs({color:i}),i},createComposeBackgroundColor:function(e,t,i){var r=this.createVariable("vec3");return this.getNode("ComposeBackgroundColor").inputs({color:e,backgroundColor:i||this.getOrCreateUniform("vec3","uBackgroundColor"),alpha:t}).outputs({color:r}),r},createComposeBackgroundFixed:function(e,t){var i=this.createVariable("vec3"),r=["vec2 jitter = vec2(1.0) / %texSize;","jitter *= 0.5 * %halton.xy;","%color = texture2D(%tex, ((%uv - 0.5 + jitter) * %scale + 0.5)).rgb;"];this.getNode("InlineCode").code(r.join("\n")).inputs({tex:this.getOrCreateSampler("sampler2D","TextureFixed"),uv:this.getUv(),scale:this.getOrCreateUniform("vec2","uFixedScale"),halton:this.getOrCreateUniform("vec4","uHalton"),texSize:this.getOrCreateUniform("vec2","RenderSize")}).outputs({color:i});var n=this.createVariable("vec3");return this.getNode("sRGBToLinear").inputs({color:i}).outputs({color:n}),this.createComposeBackgroundColor(e,t,n)},createAntiAlias:function(){var e=this.createVariable("vec3");return this.getNode("AntiAlias").inputs({sampler:this.getOrCreateSampler("sampler2D","Texture0"),uv:this.getUv(),texSize:this.getOrCreateUniform("vec2","RenderSize")}).outputs({color:e}),e},getOrCreateDistortion:function(){var e=this.getVariable("distortUvs");return e||(e=this.createVariable("vec2","distortUvs"),this.getNode("Distortion").inputs({uv:this.getOrCreateVarying("vec2","vTexCoord0"),distortion:this.getOrCreateUniform("vec2","uDistortion"),projectionLeft:this.getOrCreateUniform("vec4","uProjectionLeft"),unprojectionLeft:this.getOrCreateUniform("vec4","uUnprojectionLeft")}).outputs({distortUvs:e}),e)},createSharpen:function(e){var t=this.createVariable("vec3");return this.getNode("Sharpen").inputs({color:e,sampler:this.getOrCreateSampler("sampler2D","Texture0"),uv:this.getUv(),texSize:this.getOrCreateUniform("vec2","RenderSize"),factor:this.getOrCreateUniform("float","uSharpFactor"),pixelRatio:this.getOrCreateUniform("float","uPixelRatio"),alpha:this.config.testDepthSharpen?this.getOrCreateAlpha():void 0}).outputs({color:t}),t},createToneMapping:function(e){var t=this.createVariable("vec3");return this.getNode("ToneMapping").inputs({color:e,exposure:this.getOrCreateUniform("float","uToneExposure"),brightness:this.getOrCreateUniform("float","uToneBrightness"),contrast:this.getOrCreateUniform("float","uToneContrast"),saturation:this.getOrCreateUniform("float","uToneSaturation"),method:this.getOrCreateUniform("int","uToneMethod")}).outputs({color:t}),t},createColorBalance:function(e){var t=this.createVariable("vec3");return this.getNode("ColorBalance").inputs({color:e,lowRGB:this.getOrCreateUniform("vec3","uColorBalanceLow"),midRGB:this.getOrCreateUniform("vec3","uColorBalanceMid"),highRGB:this.getOrCreateUniform("vec3","uColorBalanceHigh")}).outputs({color:t}),t},createVignette:function(e,t){var i=e;if(t){var r=this.createVariable("vec4");this.getNode("SetAlpha").inputs({color:e,alpha:t}).outputs({color:r}),i=r}var n=this.createVariable(i.getType());return this.getNode("Vignette").inputs({color:i,uv:this.getUv(),lens:this.getOrCreateUniform("vec2","uLensRadius")}).outputs({color:n}),n},createChromaticAberration:function(){var e=this.createVariable("vec3");return this.getNode("ChromaticAberration").inputs({sampler:this.getOrCreateSampler("sampler2D","Texture0"),uv:this.getUv(),factor:this.getOrCreateUniform("float","uChromaFactor"),range:this.getOrCreateUniform("float","uRGBMRange")}).outputs({color:e}),e},getOrCreateAlpha:function(){var e=this.getVariable("alpha");return e||(e=this.createVariable("float","alpha"),this.getNode("TextureAlpha").inputs({sampler:this.getOrCreateSampler("sampler2D","TextureDepth"),uv:this.getUv()}).outputs({color:e}),e)},textureFetch:function(e,t){var i=e.getVariable(),r=this.createVariable("vec4");this.getNode("TextureRGBA").inputs({sampler:e,uv:t}).outputs({color:r});var n=r,a=this.config["RGBM"+i];if(a){var o=this.createVariable("vec3");this.getNode("DecodeRGBM").inputs({color:r,range:this.createVariable("float").setValue(a.toExponential())}).outputs({color:o}),n=this.createVariable("vec4"),this.getNode("SetAlpha").inputs({color:o,alpha:this.createVariable("float").setValue("1.0")}).outputs({color:n})}return n}})),t.a=u},function(e,t,i){"use strict";var r=i(5),n=i(31),a=i(70),o=i.n(a),s=i(90),u=r.a.osg,l=r.a.osgShader,c=l.node.BaseOperator,h=l.utils,d=function(){c.apply(this)};u.createPrototypeObject(d,u.objectInherit(c.prototype,{validOutputs:["color"],globalFunctionDeclaration:function(){return'#pragma include "postProcess.glsl"'}}));var p=function(e){return e.getType&&"vec4"===e.getType()?e.getVariable()+".rgb":e},f=function(e){return e.getType&&"vec4"===e.getType()?e.getVariable()+".a":e},g=function(){d.apply(this)};u.createPrototypeObject(g,u.objectInherit(d.prototype,{type:"AntiAlias",validInputs:["sampler","uv","texSize"],computeShader:function(){var e=this._inputs;return h.callFunction("fxaa",p(this._outputs.color),[e.sampler,e.uv,e.texSize])},globalFunctionDeclaration:function(){return'#pragma include "postProcess-antiAlias.glsl"'}}));var m=function(){d.apply(this)};m.prototype=u.objectInherit(d.prototype,{type:"SuperSample",validInputs:["currentTex","prevTex","uv","texSize","halton"],computeShader:function(){var e=this._inputs;return h.callFunction("supersample",this._outputs.color,[e.currentTex,e.prevTex,e.uv,e.texSize,e.halton])},globalFunctionDeclaration:function(){return'#pragma include "postProcess-antiAlias.glsl"'}});var v=function(){d.apply(this),this._transparent=!0};u.createPrototypeObject(v,u.objectInherit(d.prototype,{type:"SuperSampleTaa",validInputs:["currentTex","prevTex","uv","texSize","halton","depth","nearFar","enableTaa","alpha","invViewLeft","currentFrameProjViewLeft","lastFrameProjViewLeft","cornersLeft"],setTransparent:function(e){return this._transparent=e,this},computeShader:function(){var e=this._inputs,t=[e.currentTex,e.prevTex,e.uv,e.texSize,e.halton,e.depth,e.nearFar,e.enableTaa,e.alpha,e.invViewLeft,e.currentFrameProjViewLeft,e.lastFrameProjViewLeft,e.cornersLeft];return void 0===e.invViewRight||i.i(s.a)()||(t.push(e.invViewRight),t.push(e.currentFrameProjViewRight),t.push(e.lastFrameProjViewRight),t.push(e.cornersRight)),h.callFunction("supersampleTaa",this._outputs.color,t)},globalFunctionDeclaration:function(){return'#pragma include "postProcess-antiAlias.glsl"'},getDefines:function(){var e=[];return i.i(n.a)().taaSplit&&e.push("#define TAA_SPLIT_SCREEN"),i.i(n.a)().taaAccum&&e.push("#define TAA_ACCUM"),this._transparent&&e.push("#define TAA_TRANSPARENT"),e.push("#define FEEDBACK_MIN "+i.i(n.a)().taaFeedbackMin),e.push("#define FEEDBACK_MAX "+i.i(n.a)().taaFeedbackMax),void 0===this._inputs.invViewRight||i.i(s.a)()||(e.push("#define VR_ENABLED"),i.i(n.a)().taaVrfxaa&&e.push("#define TAA_VR_FXAA")),e}}));var _=function(){d.apply(this)};u.createPrototypeObject(_,u.objectInherit(d.prototype,{type:"ToneMapping",validInputs:["color","exposure","brightness","contrast","saturation","method"],computeShader:function(){var e=this._inputs;return h.callFunction("toneMapping",this._outputs.color,[p(e.color),e.exposure,e.brightness,e.contrast,e.saturation,e.method])}}));var b=function(){d.apply(this)};u.createPrototypeObject(b,u.objectInherit(d.prototype,{type:"ColorBalance",validInputs:["color","lowRGB","midRGB","highRGB"],computeShader:function(){var e=this._inputs;return h.callFunction("colorBalance",this._outputs.color,[p(e.color),e.lowRGB,e.midRGB,e.highRGB])}}));var x=function(){d.apply(this)};u.createPrototypeObject(x,u.objectInherit(d.prototype,{type:"ExtractBright",validInputs:["color","threshold"],computeShader:function(){var e=this._inputs,t=[p(e.color),e.threshold];return e.alpha&&t.push(e.alpha),h.callFunction("extractBright",this._outputs.color,t)}}));var S=function(){d.apply(this)};u.createPrototypeObject(S,u.objectInherit(d.prototype,{type:"Vignette",validInputs:["color","uv","lens"],computeShader:function(){var e=this._inputs;return h.callFunction("vignette",this._outputs.color,[e.color,e.uv,e.lens])}}));var y=function(){d.apply(this)};u.createPrototypeObject(y,u.objectInherit(d.prototype,{type:"ChromaticAberration",validInputs:["sampler","uv","factor","range"],computeShader:function(){var e=this._inputs;return h.callFunction("chromaticAberration",p(this._outputs.color),[e.sampler,e.uv,e.factor,e.range])}}));var C=function(){d.apply(this)};u.createPrototypeObject(C,u.objectInherit(d.prototype,{type:"Sharpen",validInputs:["color","sampler","uv","texSize","factor","pixelRatio"],computeShader:function(){var e=this._inputs,t=[p(e.color),e.sampler,e.uv,e.texSize,e.factor,e.pixelRatio];return e.alpha&&t.push(e.alpha),h.callFunction("sharpen",p(this._outputs.color),t)}}));var T=function(){d.apply(this)};u.createPrototypeObject(T,u.objectInherit(d.prototype,{type:"ComposeExtra",validInputs:["color","alpha","extra"],validOutputs:["color"],computeShader:function(){var e=this._inputs;return h.callFunction("composeExtra",this._outputs.color,[p(e.color),f(e.alpha),e.extra])}}));var M=function(){d.apply(this)};u.createPrototypeObject(M,u.objectInherit(d.prototype,{type:"ComposeBackgroundColor",validInputs:["color","alpha","backgroundColor"],validOutputs:["color"],computeShader:function(){var e=this._inputs;return h.callFunction("composeBackgroundColor",this._outputs.color,[p(e.color),f(e.alpha),e.backgroundColor])}}));var w=function(){d.apply(this)};u.createPrototypeObject(w,u.objectInherit(d.prototype,{type:"Distortion",validInputs:["uv","distortion","projectionLeft","unprojectionLeft"],validOutputs:["distortUvs"],computeShader:function(){var e=this._inputs,t=[e.uv,e.distortion,e.projectionLeft,e.unprojectionLeft];return h.callFunction("distortion",this._outputs.distortUvs,t)},globalFunctionDeclaration:function(){return'#pragma include "postProcess-distortion.glsl"'}}));var A=function(){d.apply(this)};u.createPrototypeObject(A,u.objectInherit(d.prototype,{type:"DofDownsampleCoC",validInputs:["samplerDepth","uv","dofBlurNearFarFocal"],computeShader:function(){var e=this._inputs;return h.callFunction("dofDownsampleCoC",this._outputs.color,[e.samplerDepth,e.uv,e.dofBlurNearFarFocal])},globalFunctionDeclaration:function(){return'#pragma include "dof.glsl"'}}));var E=function(){d.apply(this)};u.createPrototypeObject(E,u.objectInherit(d.prototype,{type:"DofDownsampleColor",validInputs:["samplerColor","uv"],computeShader:function(){var e=this._inputs,t=[e.samplerColor,e.uv];return e.samplerCoC&&t.push(e.samplerCoC),h.callFunction("dofDownsampleColor",this._outputs.color,t)},globalFunctionDeclaration:function(){return'#pragma include "dof.glsl"'}}));var P=function(){d.apply(this),this._vertical=!1};u.createPrototypeObject(P,u.objectInherit(d.prototype,{type:"DofDilateNear",validInputs:["samplerCoC","samplerDepth","uv","texSize","dofScale","dofBlurNearFarFocal"],setVertical:function(e){return this._vertical=e,this},computeShader:function(){var e=this._inputs,t=this._vertical?"V":"H";return h.callFunction("dofDilateNear"+t,this._outputs.color,[e.samplerCoC,e.samplerDepth,e.uv,e.texSize,e.dofScale,e.dofBlurNearFarFocal])},globalFunctionDeclaration:function(){return'#pragma include "dof.glsl"'}}));var N=function(){d.apply(this)};u.createPrototypeObject(N,u.objectInherit(d.prototype,{type:"DofBlurCircular",validInputs:["samplerColor","samplerCoC","uv","texSize","time","dofScale","dofBlurNearFarFocal"],computeShader:function(){var e=this._inputs;return h.callFunction("dofBlurCircular",this._outputs.color,[e.samplerColor,e.samplerCoC,e.uv,e.texSize,e.time,e.dofScale,e.dofBlurNearFarFocal])},getDefines:function(){var e=["#define DOF_TAP(id) ","ofs = fTaps_Poisson[id];","ofs = uv + blurDist * vec2(dot(ofs, basis.xy), dot(ofs, basis.zw) );"];return this._inputs.samplerColor===this._inputs.samplerCoC?(e.push("sampleTex = texture2D(texColor, ofs);"),e.push("cocWeight = abs(sampleTex.a * 2.0 - 1.0);"),e.push("cocWeight *= cocWeight * cocWeight;"),e.push("sumcol.rgb += sampleTex.rgb * cocWeight;"),e.push("sumcol.a += cocWeight;")):(e.push("cocWeight = abs(texture2D(texCoC, ofs).a * 2.0 - 1.0);"),e.push("cocWeight *= cocWeight * cocWeight;"),e.push("sumcol.rgb += decodeRGBM(texture2D(texColor, ofs), 7.0) * cocWeight;"),e.push("sumcol.a += cocWeight;")),[e.join("")]},globalFunctionDeclaration:function(){return'#pragma include "dof.glsl"'}}));var F=function(){d.apply(this)};u.createPrototypeObject(F,u.objectInherit(d.prototype,{type:"DofCombine",validInputs:["color","samplerBlur","samplerCoC","samplerDepth","uv","range","texSize","dofScale","dofBlurNearFarFocal","blurDiv"],computeShader:function(){var e=this._inputs;return h.callFunction("dofCombine",p(this._outputs.color),[p(e.color),e.samplerBlur,e.samplerCoC,e.samplerDepth,e.uv,e.range,e.texSize,e.dofScale,e.dofBlurNearFarFocal,e.blurDiv])},globalFunctionDeclaration:function(){return'#pragma include "dof.glsl"'}}));var R=function(){d.apply(this)};u.createPrototypeObject(R,u.objectInherit(d.prototype,{type:"SsaoExtract",validInputs:["samplerDepth","uv","nearFar","radius","intensity","bias","projectionInfo","projectionScale","texSize","time","samplerDepth1","samplerDepth2","samplerDepth3","samplerDepth4","samplerDepth5"],computeShader:function(){var e=this._inputs;return h.callFunction("ssaoExtract",this._outputs.color,[e.samplerDepth,e.uv,e.nearFar,e.radius,e.intensity,e.bias,e.projectionInfo,e.projectionScale,e.texSize,e.time,e.samplerDepth1,e.samplerDepth2,e.samplerDepth3,e.samplerDepth4,e.samplerDepth5])},getDefines:function(){var e=["#define SSAO_TAP_EXTRACT(id) ","screenSpaceRadius = (float(id) + 0.5) * (1.0 / float(NB_SAMPLES));","angle = screenSpaceRadius * (NB_SPIRAL_TURNS * 6.28) + randomAngle;","screenSpaceRadius = max(0.75, screenSpaceRadius * ssRadius);","offsetUnitVec = vec2(cos(angle), sin(angle));","occludingPoint = getOffsetedPixelPos(texDepth, texDepth1, texDepth2, texDepth3, texDepth4, texDepth5, uv, offsetUnitVec, screenSpaceRadius, projInfo, texSize, nearFar);","occludingPoint -= cameraSpacePosition;","vv = dot(occludingPoint, occludingPoint);","vn = dot(occludingPoint, normal);","contrib += max(1.0 - vv * invRadius2, 0.0) * max((vn - bias) * inversesqrt(vv), 0.0);"];return e=[e.join("")],i.i(n.a)().ssaoNormal&&e.push("#define SSAO_NORMAL"),o.a.any&&e.push("#define MOBILE"),e},getExtensions:function(){return["#extension GL_OES_standard_derivatives : enable"]},globalFunctionDeclaration:function(){return'#pragma include "ssao.glsl"'}}));var I=function(){d.apply(this),this._vertical=!1};u.createPrototypeObject(I,u.objectInherit(d.prototype,{type:"SsaoBlur",validInputs:["samplerSsao","uv","texSize","nearFar"],setVertical:function(e){return this._vertical=e,this},computeShader:function(){var e=this._inputs,t=this._vertical?"V":"H",i=[e.samplerSsao,e.uv,e.texSize,e.nearFar];return this._vertical&&i.push(p(e.color)),h.callFunction("ssaoBlur"+t,this._outputs.color,i)},getDefines:function(){return[["#define SSAO_TAP_BLUR(id, absid) ","sampleTex = texture2D(texSsao, uv + axis * float(id) * 2.0);","z = dot(sampleTex.gba, vec3( 1.0, 1.0 / 255.0, 1.0 / 65025.0));","weight = max(0.0, 1.0 - sharpnessFactor * abs(z - initialZ)) * (0.3 + gaussian[absid]);","sum += weight * sampleTex.r;","totalWeight += weight;"].join("")]},getExtensions:function(){return["#extension GL_OES_standard_derivatives : enable"]},globalFunctionDeclaration:function(){return'#pragma include "ssao.glsl"'}}));var O=function(){d.apply(this)};u.createPrototypeObject(O,u.objectInherit(d.prototype,{type:"Grain",validInputs:["color","uv","time","factor"],computeShader:function(){var e=this._inputs;return h.callFunction("grain",p(this._outputs.color),[p(e.color),e.uv,e.time,e.factor])}}));var L=function(){d.apply(this)};u.createPrototypeObject(L,u.objectInherit(d.prototype,{type:"DofCross",validInputs:["color","uv","renderSize","pixelRatio","dofCross"],computeShader:function(){var e=this._inputs;return h.callFunction("dofCross",p(this._outputs.color),[p(e.color),e.uv,e.renderSize,e.pixelRatio,e.dofCross])}})),t.a={AntiAlias:g,SuperSample:m,SuperSampleTaa:v,ToneMapping:_,ColorBalance:b,ExtractBright:x,Vignette:S,Sharpen:C,ChromaticAberration:y,ComposeExtra:T,ComposeBackgroundColor:M,Distortion:w,DofDownsampleCoC:A,DofDownsampleColor:E,DofDilateNear:P,DofBlurCircular:N,DofCombine:F,SsaoExtract:R,SsaoBlur:I,Grain:O,DofCross:L}},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(70),o=i.n(a),s=i(15),u=i(31),l=i(90),c=s.a.extend({defaults:function(){var e=1;return o.a.any?e=0:i.i(l.a)()&&(e=2),this._deferReady=n.a.defer(),{promiseReady:this._deferReady.promise,level:e}},getBudget:function(){var e=i.i(u.a)();return void 0!==e.pixelBudget?0===e.pixelBudget?1/0:e.pixelBudget:this.getBudgetFromLevel(this.get("level"))},getBudgetFromLevel:function(e){return 0===e?6144:1===e?12288:1/0},getName:function(){return"Quality"}});t.a=c},function(e,t,i){"use strict";var r=i(89),n=i(1064),a=i(1066),o={FeatureName:"quality",ModelType:n.a,ViewListType:[a.a]};t.a=r.a.create(o)},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(4),o=i(46),s=i(31),u=i(602),l=i(5),c=i(90),h=l.a.osg,d=function(e){return 0==(e&e-1)},p=function(e){return 1<<Math.floor(Math.log2(e))},f=function(e){return 1<<Math.ceil(Math.log2(e))},g=function(e){if(d(e))return e;var t=p(e);return e/t-1>.75?f(e):t},m=h.Timer.instance(),v=["glframe"],_=a.a.extend({initialize:function(){a.a.prototype.initialize.apply(this,arguments);var e=this.options.context;this._viewer=e.getViewer(),this._fMaterial=e.getFeatures().material,this._version=e.getModel().get("options").version,this.model.bind("change:level",this.onLevelChanged,this),this.model.bind("updateTexelPolicy",this.updateTexelPolicy,this),this._maxSize=i.i(u.a)(),this._timers={};var t=[o.a.getHighResBound(),o.a.getFirstCameraAnimation()];n.a.all(t).then(this.initTimers.bind(this))},initTimers:function(){for(var e=0,t=v.length;e<t;++e)this._timers[v[e]]={accumValue:0,accumSamples:0,accumStart:m.tick(),averageValue:0};var i=h.TimerGPU.instance();i.setFrameAverageCount(20),i.setCallback(this.callbackGPU.bind(this))},callbackGPU:function(e,t){if(this._viewer.getViewerOSGJS().callbackTimerGPU(e,t),"glframe"===t){var i=this._timers[t];i.accumValue+=e/1e6,i.accumSamples++;var r=m.tick();if(r-i.accumStart>=2e3){i.averageValue=i.accumValue/i.accumSamples,i.accumValue=0,i.accumStart=r,i.accumSamples=0;var n=this._viewer.getFeatures().postProcess.getModel();i.averageValue<10?n.set("dofQuality",3):i.averageValue<12?n.set("dofQuality",Math.max(n.get("dofQuality"),2)):i.averageValue<14?n.set("dofQuality",Math.max(n.get("dofQuality"),1)):i.averageValue>17&&n.set("dofQuality",0)}}},getMaterials:function(){return this._fMaterial.getModel().attributes},onLevelChanged:function(){this.updateTexelPolicy();var e=this._fMaterial._views[0];this._viewer.setFakeSecondaryProgress(e.requestAllHighResTextures(this._fMaterial.getModel().attributes),0),this._fMaterial._views[0].cleanAndApplyMaterials()},getOrCreateTexelInfos:function(){return this._fMaterial._views[0].getOrCreateTexelInfos()},getMaxSizeFromBudget:function(e){var t=e*e,i=this.getOrCreateTexelInfos();if(0===i.count||i.pixelCount<=t)return this._maxSize;var r=Math.min(this._maxSize,Math.sqrt(t/i.count));return r=g(r),this._version<2&&(r<1024?r=512:r>=1024&&r<2048&&(r=2048)),i.max<=r||i.pixelCount<=r*r?this._maxSize:r},updateTexelPolicy:function(){var e=this.getOrCreateTexelInfos();0===e.count||e.missingResolution>=e.count||(e.missingResolution>0&&!i.i(c.a)()&&console.error("Multi-resolution textures missing : "+e.missingResolution+"\n"+e.missingTextures.join("\n")),this.model.get("promiseReady").isPending()&&this.initAvailableQuality(),i.i(s.a)().maxTextureSize=this.getMaxSizeFromBudget(this.model.getBudget()))},initAvailableQuality:function(){var e=this.getMaxSizeFromBudget(this.model.getBudgetFromLevel(0)),t=this.getMaxSizeFromBudget(this.model.getBudgetFromLevel(1)),i={low:!0,mid:t!==e,high:t!==this._maxSize},r=this.model.get("level");i.high||2!==r||(r=1),i.mid||1!==r||(r=0),1===r&&(i.low=!1),this.model.off(null,this.onLevelChanged,this),this.model.set("level",r),this.model.on("change:level",this.onLevelChanged,this),this.model._deferReady.resolve(i)}});t.a=_},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(514)),a=function(e,t){n.a.call(this,e,"arraybuffer",t)};a.prototype=i.i(r.extend)({},n.a.prototype,{load:function(){var e=this.getXHR().response;this._defer.resolve(e)}}),t.a=a},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=i(508),o=i(514),s=i(31),u=i(826),l=i.n(u),c=i(825),h=i.n(c),d=n.a.osg,p={},f={},g=parseInt((/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[0,0])[1],10),m=i.i(s.a)().asyncImage;m&&(m=window.Worker&&window.fetch&&window.createImageBitmap&&g>=52);var v=[];window.closeBitmaps=function(){v.forEach(function(e){e.close()})};var _=function(e){var t=0,i=Math.max(2,Math.min(4,navigator.hardwareConcurrency||2)),r=[],n=URL.createObjectURL(new Blob([e],{type:"text/javascript"}));return function(){var e=r[t];return e||(e=r[t]=new Worker(n),e.onmessage=function(e){var t=e.data,i=t.uid,r=f[i];t.bitmap?(r.setImage(t.bitmap),v.push(t.bitmap)):(r.setImage(t.img),r.setWidth(t.width),r.setHeight(t.height)),p[i]()}),t=(t+1)%i,e}},b=_(l.a),x=_(h.a),S=function(e,t){o.a.call(this,e,"blob",t),this._responseType="arraybuffer"};S.prototype=i.i(r.extend)({},o.a.prototype,{isVideo:function(e){return a.a.isVideoURL(e)},createVideo:function(){var e=document.createElement("video");return document.body.appendChild(e),e.style.display="none",e},start:function(){var e=this.getURL();if(this.isVideo(e)){var t=this.createVideo();this._image=new d.ImageStream(t),window.video=this._image,t.preload="auto",t.crossOrigin="anonymous",t.src=e,this._image.whenReady().then(function(e){e.play(),this._defer.resolve(this._image)}.bind(this))}else{this._image=new d.Image;var i=this._options;i.panoramaLUV||i.integrateBRDFLUV||i.cubemapLUV?o.a.prototype.start.call(this):".astc.gz"===this._url.substr(-8)?(i.astc=!0,o.a.prototype.start.call(this)):i.decodeAsync&&m?this.loadImageAsync():this.loadImage()}},load:function(){var e=this._options;e.panoramaLUV||e.integrateBRDFLUV?this.loadLUV():e.cubemapLUV?this.loadCubemapLUV():e.astc&&this.loadAstc()},loadImageAsync:function(){p[this._url]=this._defer.resolve.bind(this._defer,this._image),f[this._url]=this._image,x().postMessage({uid:this._url,url:this._url})},loadAstc:function(){var e=this._xhr.response;p[this._url]=this._defer.resolve.bind(this._defer,this._image),f[this._url]=this._image,b().postMessage({uid:this._url,buffer:e,swizzle:!0,nbComponents:3},[e])},loadImage:function(){var e=new Image;this._options.crossOrigin&&(e.crossOrigin=this._options.crossOrigin),this._image.setImage(e),e.onload=this._defer.resolve.bind(this._defer,this._image),e.onerror=this._defer.reject.bind(this._defer,this._image),this._imgHtmlTag=e,e.src=this._url},abortImage:function(){this._imgHtmlTag&&(this._imgHtmlTag.src="")},loadLUV:function(){var e,t=this._xhr.response,i=Math.sqrt(t.byteLength/4);e=this._options.integrateBRDFLUV?new Uint8Array(t):this.deinterleaveImage4(i,new Uint8Array(t),new Uint8Array(t.byteLength));var r=this._image;r.setImage(e),r.setWidth(i),r.setHeight(i),this._defer.resolve(this._image)},loadCubemapLUV:function(){for(var e=this._xhr.response,t=Math.log(this._options.size)/Math.LN2,i=0,r={},n=0;n<=t&&!(i>=e.byteLength);n++)for(var a=Math.pow(2,t-n),o=0;o<6;o++){r[d.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+o]||(r[d.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+o]=[]);var s=a*a*4,u=new Uint8Array(s);this.deinterleaveImage4(a,new Uint8Array(e,i,s),u);var l=new d.Image;l.setImage(u),l.setWidth(a),l.setHeight(a),r[d.Texture.TEXTURE_CUBE_MAP_POSITIVE_X+o].push(l),i+=s}this._defer.resolve(r)},deinterleaveImage4:function(e,t,i){for(var r=e*e,n=2*e*e,a=3*e*e,o=0,s=0;s<r;s++)i[o++]=t[s],i[o++]=t[s+r],i[o++]=t[s+n],i[o++]=t[s+a];return i},getImage:function(){return this._image}}),t.a=S},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(514)),a=function(){n.a.apply(this,arguments)};a.prototype=i.i(r.extend)({},n.a.prototype,{load:function(){this._model=this._xhr.response,this._defer.resolve(this._model)},getModel:function(){return this._model}}),t.a=a},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=i(2),o=i.n(a),s=i(0),u=(i.n(s),i(29)),l=i(7),c=i(5),h=i(537),d=i(4),p=i(23),f=i(510),g=i(353),m=c.a.osg;t.a=d.a.extend({savingEnabled:!1,constructor:function(){this.onSave=i.i(s.throttle)(this.onSave,1e3),d.a.apply(this,arguments)},initialize:function(){d.a.prototype.initialize.apply(this,arguments),o()(".save-model").click(this.onSave.bind(this));var e=this.options.context.getModel();e&&!this.maintenance&&this.listenTo(e,"status:loaded",this.enableSaving.bind(this))},onSave:function(e){e.preventDefault(),g.a.isMaintenance()?g.a.showPopup():this.save()},save:function(){if(!this.savingEnabled)return n.a.reject();if(o()(".save-model").hasClass("progress"))return n.a.reject();o()(".save-model").addClass("progress");var e=this.options.context.getModel().get("uid"),t=this.options.context.getModel().get("user").uid,i={modelUID:e,userUID:t},r=this,a=[];return this.cancelSave=!1,n.a.settle([this.saveBackgroundImages(i,a),this.saveMaterialImages(i,a),this.saveTexturesColorspace(i,a),this.saveHotspots(i,a),this.saveAnimations(i,a),this.saveSounds(i,a)]).then(function(){return a.length>0||this.cancelSave?n.a.reject():r.saveOptions()}.bind(this)).then(function(){return a.length>0?n.a.reject():n.a.settle([r.deleteTextures(a),r.deleteMatcaps(a),r.deleteBackgroundImages(a),r.deleteAnimations(a),r.deleteEnvironments(a)])}).then(function(){if(a.length>0)return n.a.reject();o()(".save-model").removeClass("progress"),o()(".save-model").addClass("success"),setTimeout(function(){o()(".save-model").removeClass("success")},4e3)}.bind(this)).catch(function(e){if(o()(".save-model").removeClass("progress"),event.target&&503===event.target.status)g.a.showPopup();else{if(this.cancelSave)return;var t="";if(a.length)t=a.join("<br/>");else{if(t="An unexpected error happened while saving the following settings : <br/><ul>",e&&e.responseJSON&&e.responseJSON.detail){var i=e.responseJSON.detail;m.error(i);for(var r="string"==typeof i?[i]:Object.keys(i),n=0;n<r.length;++n)t+="<li>&bullet; "+r[n]+"</li>"}t+="</ul>"}t+="<br/>Contact the support team at support@sketchfab.com if you need help.";var s=new p.default({title:"Error",text:t,buttons:{ok:!0},safe:!0});s.open().then(s.close.bind(s))}}.bind(this))},deleteUnusedResources:function(e,t,r){if(0===e.length)return n.a.resolve();var a="Errors while deleting the following "+t+" :<br/><ul>",o=!1,u=i.i(s.map)(e,function(e){return n.a.resolve(e.destroy()).catch(function(t){var i=t&&t.responseJSON&&t.responseJSON.detail;a+="<li>&bullet; "+e.get("name")+" : "+i+"</li>",e.trigger("restore",e),o=!0})});return e.length=0,n.a.all(u).then(function(){if(o)return r.push(a+"</ul>"),n.a.reject()})},deleteTextures:function(e){var t=this.options.context.getViewer().getFeatures().material.getModel()._textureTrashbin,r=i.i(s.map)(t,function(e){return new h.a({uid:e})});return t.length=0,this.deleteUnusedResources(r,"material textures",e)},deleteMatcaps:function(e){var t=this.options.context.getViewer().getFeatures().material.getModel()._matcapTrashbin;return this.deleteUnusedResources(t,"matcap textures",e)},deleteAnimations:function(e){return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().animation.getModel().get("animations")._trashbin,"animations",e)},deleteEnvironments:function(e){return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().environment.getModel()._trashbin,"environments",e)},deleteBackgroundImages:function(e){return this.deleteUnusedResources(this.options.context.getViewer().getFeatures().background.getModel()._trashbin,"backgrounds",e)},saveBackgroundImages:function(e,t){var i=this,r=[];return this.options.context.getViewer().getFeatures().background.getModel().backgroundCollection.each(function(n){if(n.isNew()){var a=i.saveImage(n,e);a&&(a.catch(function(e){var i=0;if(e.responseJSON.detail.imageFile)for(i=0;i<e.responseJSON.detail.imageFile.length;i++)e.responseJSON.detail.imageFile[i].match("The image should be less than 4mb")&&t.push("Background image is too big (max: 4MB)")}),r.push(a))}}),n.a.all(r)},saveImage:function(e,t){return n.a.resolve(e.save(t).then(function(t){e.set("uid",t.uid)}))},_saveImageToBlob:function(e,t,r,n){var a,o=e.getImageModel(),s=e.getMultiresTexture().getImage().getImage();if(s.toBlob){var u=this;return void s.toBlob(function(e){e.name=t.name,o.set("imageFile",e),r(u.saveImage(o,n))},t.type,.95)}if(s.toDataURL)a=i.i(f.a)(s.toDataURL(t.type,.95)),a.name=t.name,o.set("imageFile",a),r(this.saveImage(o,n));else{var l=s;s=document.createElement("canvas"),s.width=l.width,s.height=l.height,s.getContext("2d").drawImage(l,0,0)}a=i.i(f.a)(s.toDataURL(t.type,.95)),a.name=t.name,o.set("imageFile",a),r(this.saveImage(o,n))},saveMaterialImages:function(e,t){var r=this,a=[],o={},u=this.options.context.getViewer().getFeatures().material,l="Errors while saving the following texture materials :<br/><ul>",c=!1;return i.i(s.each)(u.getModel().attributes,function(t){var u=t.getChannels();i.i(s.each)(u,function(t){var s=t.getTextureModel();if(s){var u=s.getImageModel();if(u&&u.isNew()){var h=u.getUID();if(1!==o[h]){o[h]=1;var d=new n.a(function(t){var n=u.get("imageFile");if(void 0===n){var a=u.findImageNearestToResolution(16384,16384),o=i.i(f.a)(a.url);return u.set("imageFile",o),void t(r.saveImage(u,e))}if(0===n.size)r._saveImageToBlob(s,n,t,e);else if(window.File){var l=new FileReader;l.onload=function(){this.readyState===FileReader.DONE?t(r.saveImage(u,e)):r._saveImageToBlob(s,n,t,e)},l.onerror=function(){r._saveImageToBlob(s,n,t,e)},l.readAsArrayBuffer(n)}});a.push(d.catch(function(e){var t=e&&e.responseJSON&&e.responseJSON.detail;l+="<li>&bullet; "+u.getName()+" : "+t+"</li>",c=!0}))}}}})}),n.a.all(a).then(function(){if(c)return t.push(l+"</ul>"),n.a.reject()})},saveOptions:function(){var e=this.options.context,t=e.getViewer(),i=t.getOptionsJSON();if(t.getFeaturesManager().registerOptionsJSON(i),i.animation)for(var r=t.getFeatures().animation.getModel().get("animations")._trashbin,a=0;a<r.length;a++)r[a]&&i.animation.order.splice(a,0,r[a].get("uid"));return n.a.resolve(e.getModel().save({options:i},{patch:!0}))},saveHotspot:function(e,t,i){return e.save(t).catch(function(t){if(i.push("Annotation #"+(+e.get("order")+1)+" could not be saved."),t.responseJSON&&t.responseJSON.detail){var r=0;if(t.responseJSON.detail.name)for(r=0;r<t.responseJSON.detail.name.length;r++)t.responseJSON.detail.name[r].match("This field is required.")&&i.push("Title is required."),t.responseJSON.detail.name[r].match("Ensure this value has at most 64 characters")&&i.push("Title is too long (64 characters max).");if(t.responseJSON.detail.content)for(r=0;r<t.responseJSON.detail.content.length;r++)t.responseJSON.detail.content[r].match("Ensure this value has at most 1024 characters")&&i.push("Description is too long (1024 characters max).")}})},deleteHotspot:function(e,t,i,r){return e.remove(t).catch(function(){r.push(e),i.push("An annotation could not be deleted. Please try saving your settings again.")})},saveHotspots:function(e,t){var r=this.options.context.getViewer().getFeatures().hotspot,a=r.getModel(),o=a.get("hotspots"),c=u.a.maxHotspotsPerModel[l.a.me().get("account")],h=o.length-c;if(o.length>c){var d="You have reached the maximum number of annotations allowed by your plan ("+c+").";return l.a.me().canUpgradeToPro()&&(d+=1===h?'<br>Delete the last annotation you created or <a class="upgrade-link underlined" href="/plans" data-title="maximum-annotation-upgrade" target="_blank">upgrade your account</a>.':"<br>Delete the "+h+' last annotations you created or <a class="upgrade-link underlined" href="/plans" data-title="maximum-annotation-upgrade" target="_blank">upgrade your account</a>.'),a.trigger("hotspot-error",d),void(this.cancelSave=!0)}var p=!1;if(o.each(function(e){e.get("name")||(p=!0)}),p)return a.trigger("hotspot-error","All your annotations must have a title"),void(this.cancelSave=!0);var f=[],g=[],m=this;return i.i(s.each)(a.hotspotsToBeDeleted,function(i){f.push(m.deleteHotspot(i,e,t,g))}),a.hotspotsToBeDeleted=g,n.a.all(f).then(function(){var i=[];return o.each(function(r){r.set("order",o.indexOf(r)),i.push(m.saveHotspot(r,e,t))}),n.a.all(i)})},saveTexturesColorspace:function(e,t){var i="Errors while changing the following texture colorspace :<br/><ul>",r=!1,a=[];return this.model.getImageCollection().each(function(e){!e.isNew()&&e.hasChanged("colorSpace")&&a.push(e.saveColorspace().catch(function(t){var n=t&&t.responseJSON&&t.responseJSON.detail;i+="<li>&bullet; "+e.get("name")+" : "+n+"</li>",r=!0}))}),n.a.all(a).then(function(){if(r)return t.push(i+"</ul>"),n.a.reject()})},saveAnimations:function(e,t){var i=this.options.context.getViewer().getFeatures().animation,r=i.getModel(),a="Errors while saving the following animations :<br/><ul>",o=!1,s=r.get("animations").map(function(t){return t.save(e).catch(function(e){var i=e&&e.responseJSON&&e.responseJSON.detail;a+="<li>&bullet; "+t.get("name")+" : "+i+"</li>",o=!0})});return n.a.all(s).then(function(){if(o)return t.push(a+"</ul>"),n.a.reject()})},saveSounds:function(e,t){var i,r=this.options.context.getViewer().getFeatures().sound,a=r.getModel(),o=a.get("soundtracks"),s=u.a.maxSoundtracksPerModel[l.a.me().get("account")];if(o.length>s){var c=o.length-s;return i=["You have reached the maximum number of sounds allowed by your plan ("+s+").","<br>Delete "+c+' sounds or <a class="upgrade-link underlined" href="/plans" target="_blank">upgrade your account</a>.'].join("\n"),a.trigger("sound-error",i),void(this.cancelSave=!0)}var h=!1;i="Errors while saving the following sounds :<br/><ul>";var d=a.get("soundtracks").map(function(t){return t.save(e).catch(function(e){var r=e&&e.responseJSON&&e.responseJSON.detail;i+="<li>&bullet; "+t.get("name")+" : "+r+"</li>",h=!0})});return n.a.all(d).then(function(){if(h)return t.push(i+"</ul>"),n.a.reject()})},enableSaving:function(){this.savingEnabled=!0,o()(".save-model").removeClass("btn-disabled")}})},function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(0),o=(i.n(a),i(4)),s=i(723),u=i(961),l=o.a.extend({_isLoaded:!1,_context:null,isMoving:!1,startX:0,sensitivity:20,sprite:{current:0,steps:15,ratio:null,width:0},size:1,autospinTimer:null,events:{mousedown:"onMouseDown",mouseup:"onMouseUp","mousemove ":"onMouseMove",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove"},constructor:function(){this._boundResizeEvent=this.onWindowResize.bind(this),o.a.prototype.constructor.apply(this,arguments)},initialize:function(){o.a.prototype.initialize.apply(this,arguments),this.$viewport=n()(),this.$image=n()()},delegateEvents:function(){o.a.prototype.delegateEvents.apply(this,arguments),n()(window).on("resize",this._boundResizeEvent)},undelegateEvents:function(){o.a.prototype.undelegateEvents.apply(this,arguments),n()(window).off("resize",this._boundResizeEvent),this.autospinTimer&&clearInterval(this.autospinTimer)},isViewerReady:function(){return this._isLoaded},run:function(){var e=new s.a;this._context=e,this.$el.show(),this.$el.siblings(".webgl").hide(),this.$el.siblings(".osd").hide();var t=this.model.get("uid"),i=this._fallbackCollection=new u.a([],{uid:t});return i.fetch().then(function(){i.length>0?this.displayFallback():this.displayNoFallbackError()}.bind(this)).fail(function(){this.displayNoFallbackError()}.bind(this)),this._isLoaded=!0,!0},getContext:function(){return this._context},getFeatures:function(){return{}},findBestImage:function(){for(var e,t=this._fallbackCollection.at(0).get("images"),i=this.$el.height(),r=1/0,n=0,a=t.length;n<a;++n){var o=t[n],s=Math.abs(i-o.height);s<r&&(r=s,e=o)}return e},displayFallback:function(){this.$viewport=n()(".fallback-viewport"),this.$image=this.$viewport.find("img.fallback-sprite");var e=this.findBestImage(),t=e.url;this._currentHeight=e.height,this.$image.on("load",function(e){var t=e.target.naturalHeight,i=e.target.naturalWidth/this.sprite.steps;this.sprite.ratio=t?i/t:0,n()(e.target).css("display","block"),this.trigger("secondary-progress",{progress:1}),this.trigger("success"),this.displayFallbackWarning(),this.onWindowResize()}.bind(this)),this.$image.on("error",function(e){console.error("Fallback loading failed. URL : "+t+" ERROR : "+e.toString()),this.trigger("fail"),this.displayFallbackLoadingError()}.bind(this)),this.$image.attr("src",t)},displayFallbackLoadingError:function(){this.$el.find(".fallback-error-loading").show()},displayNoFallbackError:function(){this.$el.find(".fallback-error-nofallback").show()},displayFallbackWarning:function(){this._warningDisplayed||(this._warningDisplayed=!0,this.$el.find(".fallback-warning").show(),this.fallbackWarning=setTimeout(function(){this.$el.find(".fallback-warning").fadeOut()}.bind(this),5e3))},onWindowResize:function(){var e,t,i=this.$el.width(),r=this.$el.height(),n=i/r;this.findBestImage().height>this._currentHeight&&this.displayFallback(),2===this.size?n<this.sprite.ratio?(e=i,t=Math.floor(e/this.sprite.ratio)):(t=r,e=Math.floor(t*this.sprite.ratio)):n<this.sprite.ratio?(t=r,e=Math.floor(t*this.sprite.ratio)):(e=i,t=Math.floor(e/this.sprite.ratio)),this.$viewport.width(e).height(t).css({"margin-top":Math.round(-1*t/2),"margin-left":Math.round(-1*e/2)}),this.sprite.width=Math.round(this.$image.prop("scrollHeight")*this.sprite.ratio),this.$viewport.scrollLeft(this.sprite.width*this.sprite.current)},onMouseDown:function(e){e.preventDefault(),this.isMoving=!0,this.startX=e.clientX},onMouseMove:function(e){e.preventDefault(),this.move(e.clientX)},onMouseUp:function(e){e.preventDefault(),this.isMoving=!1},onTouchStart:function(e){e.preventDefault(),this.isMoving=!0;var t=e.originalEvent.touches[0];this.startX=t.clientX},onTouchMove:function(e){e.preventDefault(),this.move(e.originalEvent.touches[0].clientX)},onTouchEnd:function(e){e.preventDefault(),this.isMoving=!1},move:function(e){this.isMoving&&(this.autospinTimer&&this.stopAutospin(),e>this.startX+this.sensitivity&&(this.startX=e,this.moveRight()),e<this.startX-this.sensitivity&&(this.startX=e,this.moveLeft()))},moveRight:function(){0===this.sprite.current?this.sprite.current=this.sprite.steps-1:this.sprite.current=this.sprite.current-1,this.$viewport.scrollLeft(this.sprite.width*this.sprite.current)},moveLeft:function(){this.sprite.current=(this.sprite.current+1)%this.sprite.steps,this.$viewport.scrollLeft(this.sprite.width*this.sprite.current)},startAutospin:function(){this.autospinTimer=setInterval(i.i(a.bind)(function(){this.moveLeft()},this),500)},stopAutospin:function(){clearInterval(this.autospinTimer),this.autospinTimer=null},toggleAutospin:function(){this.autospinTimer?this.stopAutospin():this.startAutospin()}});t.a=l},function(e,t,i){"use strict";var r=i(15),n=i(46),a=i(299),o=i(31),s=i(337),u=r.a.extend({defaults:function(){return{renderer:"classic",style:"lit",hasWireframe:!0,wireframeEnable:!1,wireframeColor:"000000FF",hasVertexColor:!1,hasVertexAlpha:!1,vertexColorEnable:!0,vertexAlphaEnable:!!i.i(a.a)(),vertexColorColorSpace:i.i(a.a)()?"srgb":"linear",blendingEasingDuration:1,blendingPauseDuration:2.5,hasPoints:!1,hasLines:!1,hasTriangles:!1,pointSize:i.i(a.a)()?2:0,webVR:!1}},getName:function(){return"ShadingStyle"},init:function(e){this.set("hasWireframe",!!e.getScene().getWireframeSize());var t=e.getModel().get("options"),r=t.shading;r&&r.type&&this.set("style",r.type),r&&r.renderer&&this.set("renderer",r.renderer);var s=t.wireframe;s&&(void 0!==s.enable&&this.set("wireframeEnable",s.enable),s.color&&s.enable&&this.set("wireframeColor",s.color));var u=r&&r.pointSize;u&&this.set("pointSize",u);var l=r&&r.vertexColor;l&&(this.set("vertexColorEnable",l.enable),this.set("vertexColorColorSpace",l.colorSpace),void 0!==l.useAlpha&&this.set("vertexAlphaEnable",l.useAlpha));var c=i.i(o.a)().blending;void 0!==c&&(this.set("style","blending"),this.set("blendingPauseDuration",Math.abs(c))),i.i(a.a)()&&n.a.getMaterial().then(function(){var t=e.getFeatures().material.getModel();this.set("renderer","pbr",{copyChannel:!0,overrideTexture:!1}),t._style&&this.set("style",t._style)}.bind(this))},setWireframeColorSmooth:function(e){this.trigger("setWireframeColorSmooth",e)},getJSON:function(){return{shading:{pointSize:this.get("pointSize"),type:this.get("style"),renderer:this.get("renderer"),vertexColor:{enable:this.get("vertexColorEnable"),useAlpha:this.get("vertexAlphaEnable"),colorSpace:this.get("vertexColorColorSpace")}},wireframe:{enable:this.get("wireframeEnable"),color:this.get("wireframeColor")}}},editorGetJSON:function(){return this.getJSON()},validateJSON:function(e){var t=[];return e.shading&&(s.a.isEnumString(e.shading.type,["lit","shadeless","matcap","blending"])||t.push("ShadingStyle.editorSetJSON shading.style must be an enum in [lit, shadeless,matcap]"),s.a.isEnumString(e.shading.renderer,["classic","pbr"])||t.push("ShadingStyle.editorSetJSON shading.renderer must be an enum in [classic, pbr]"),e.shading.vertexColor&&(s.a.isBoolean(e.shading.vertexColor.enable)||t.push("ShadingStyle.editorSetJSON shading.vertexColor.enable must be boolean"),s.a.isBoolean(e.shading.vertexColor.useAlpha)||t.push("ShadingStyle.editorSetJSON shading.vertexColor.useAlpha must be boolean"),s.a.isEnumString(e.shading.vertexColor.colorSpace,["srgb","linear"])||t.push("ShadingStyle.editorSetJSON shading.vertexColor.colorSpace must be an enum with value in [ srgb, linear ]"))),e.wireframe&&(s.a.isBoolean(e.wireframe.enable)||t.push("ShadingStyle.editorSetJSON wireframe.enable must be boolean"),s.a.isString(e.wireframe.color)||t.push("ShadingStyle.editorSetJSON wireframe.color must be a string like 000000FF")),t.join("\n")},editorSetJSON:function(e){var t=this.validateJSON(e);if(t)return t;var i={};return e.shading&&(e.shading.type&&(i.style=e.shading.type),e.shading.renderer&&(i.renderer=e.shading.renderer),e.shading.vertexColor&&(i.vertexColorEnable=e.shading.vertexColor.enable,i.vertexAlphaEnable=e.shading.vertexColor.useAlpha,i.vertexColorColorSpace=e.shading.vertexColor.colorSpace)),e.wireframe&&(i.wireframeEnable=e.wireframe.enable,i.wireframeColor=e.wireframe.color),this.set(i),t}});t.a=u},function(e,t,i){"use strict";var r=i(5),n=i(512),a=i(53),o=r.a.osg,s=function(e,t,i){n.a.call(this,i),this._pauseDuration=void 0===t?2.5:t,this._blendUniform=e,this._finishCallback=void 0,this._finished=!0,this._inPause=!1};o.createPrototypeObject(s,o.objectInherit(n.a.prototype,{setPauseDuration:function(e){this._pauseDuration=e},setFinishCallback:function(e){this._finishCallback=e},changeBlend:function(){this._inPause=!1,this.reset(),this._finishCallback()},update:function(e,t){if(!0===this._finished)return!0;a.a.draw();var i=t.getFrameStamp().getSimulationTime();if(!0===this._inPause){if(i<this._startTime+this._pauseDuration+this._duration)return!0;this.changeBlend()}var r=this.interpolate(i,e,t);return!0===this._finished&&(this._finished=!1,this._inPause=!0,this._finishCallback(!0)),r=o.smoothStep(0,1,r),this._blendUniform.getInternalArray()[0]=r,!0}}));var u=function(e,t){o.Node.call(this),this._blendUniform=o.Uniform.createFloat1(0,"uBlend"),this._callbackUpdate=new s(this._blendUniform,e,t),this.init()};o.createPrototypeNode(u,o.objectInherit(o.Node.prototype,{setPauseDuration:function(e){this._callbackUpdate.setPauseDuration(e)},setTransitionDuration:function(e){this._callbackUpdate.setDuration(e)},setEnable:function(e){this._callbackUpdate._finished=!e},setFinishCallback:function(e){this._callbackUpdate.setFinishCallback(e)},init:function(){this.getOrCreateStateSet().addUniform(this._blendUniform),this.addUpdateCallback(this._callbackUpdate)}}),"osgSketchfab","Blending"),t.a=u},function(e,t,i){"use strict";var r=i(89),n=i(1072),a=i(1075),o={FeatureName:"shadingStyle",ModelType:n.a,ViewListType:[a.a]},s=r.a.create(o);s.prototype.getNode=function(){return this._views[0]._nodeBlending},t.a=s},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(10)),a=i.n(n),o=i(5),s=i(46),u=i(4),l=i(736),c=i(1073),h=i(515),d=i(69),p=i(297),f=i(1089),g=i(738),m=i(517),v=i(1090),_=i(1085),b=i(1087),x=i(1093),S=i(346),y=i(53),C=i(389),T=i(336),M=i(388),w=i(733),A=i(139),E=o.a.osg,P=u.a.extend({initialize:function(e){u.a.prototype.initialize.apply(this,arguments);var t=this.model;t.bind("change:webVR",this.onWebVRChanged,this),t.bind("change:renderer",this.onRendererChanged,this),t.bind("change:style",this.onShadingChanged,this),t.bind("change:pointSize",this.onPointSizeChanged,this),t.bind("change:wireframeEnable",this.onWireframeEnableChanged,this),t.bind("change:wireframeColor",this.onWireframeColorChanged,this),t.bind("change:vertexColorEnable",this.onVertexColorChanged,this),t.bind("change:vertexAlphaEnable",this.onVertexColorChanged,this),t.bind("change:vertexColorColorSpace",this.onVertexColorChanged,this),t.bind("change:blendingPauseDuration",this.onBlendingPauseDurationChanged,this),t.bind("change:blendingTransitionDuration",this.onBlendingTransitionDurationChanged,this),t.bind("setWireframeColorSmooth",this.onSetWireframeColorSmooth,this),this._viewer=e.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS();var i=this._generatorProxy=this._viewerOSGJS.getState().getShaderGeneratorProxy();i.addShaderGenerator("classic-lit",new p.a),i.addShaderGenerator("classic-shadeless",new f.a),i.addShaderGenerator("classic-blending",new g.a),i.addShaderGenerator("pbr-lit",new m.a),i.addShaderGenerator("pbr-shadeless",new v.a),i.addShaderGenerator("pbr-blending",new _.a),i.addShaderGenerator("classic-matcap",new b.a),i.addShaderGenerator("pbr-matcap",new b.a),i.addShaderGenerator("wireframe",new x.a),this._rootStateSet=this._viewerOSGJS.getSceneData().getOrCreateStateSet(),this._rootStateSet.setShaderGeneratorName(this.getCompilerName()),this.updateShadingGlobal(),this._nodeBlending=new c.a(t.get("blendingDuration")),this._nodeBlending.setName("ShadingStyle - Node Blending"),this.initBlendingPreset(e.context,"classic"),this.initBlendingPreset(e.context,"pbr"),this.initNodeBlending();var r=e.context.getScene();this._hasWireframe=!!r.getWireframeSize(),this._wireframeNodes=r.getWireframeNodes(),s.a.getPolygon().then(function(){this.model.set("hasVertexColor",T.a.hasVertexColor),this.model.set("hasVertexAlpha",T.a.hasVertexAlpha),!1===T.a.hasVertexColor&&this.model.set("vertexColorEnable",!1),!1===T.a.hasVertexAlpha&&this.model.set("vertexAlphaEnable",!1),this.onVertexColorChanged(),this.model.set("hasPoints",M.a.hasPoints),this.model.set("hasTriangles",M.a.hasTriangles),this.model.set("hasLines",M.a.hasLines)}.bind(this)),A.a.getBoxReady().then(this.onPointSizeChanged.bind(this)),a.a.all([s.a.getMaterial(),s.a.getWireframe()]).then(this.initWireframe.bind(this))},onWebVRChanged:function(){for(var e=this._wireframeNodes,t=0,i=e.length;t<i;++t)e[t].getStateSet().setRenderBinVR(this.model.get("webVR"))},onPointSizeChanged:function(){var e=A.a.getModelBoxWithDisplacement().radius();e*=this._viewerOSGJS.getCanvasPixelRatio()*this.model.get("pointSize"),w.a.cachedSquarePoint.setPointSize(e),w.a.cachedCirclePoint.setPointSize(e),y.a.draw()},initBlending:function(e,t){var i=this._generatorProxy.getShaderGenerator(t+"-blending");i.setGraphicContext(this._viewerOSGJS.getGraphicContext()),i.addShader(h.a.DEFAULT),i.addShader(h.a.MATCAP|h.a.WIREFRAME),i.addShader(h.a.MATCAP|h.a.GEOMETRY|h.a.WIREFRAME),i.addShader(h.a.DEFAULT&~h.a.DIFFUSE),i.addShader(h.a.DEFAULT)},initNodeBlending:function(){var e=this,t=function(t){if("matcap"!==e.model.get("style")){var i=e._generatorProxy.getShaderGenerator(e.model.get("renderer")+"-blending");!0===t?i.onSameShader():(i.toNextShader(),e.onBlendingShader())}};this._nodeBlending.setFinishCallback(t);var i=this.model.get("style");this._nodeBlending.setEnable("blending"===i)},initBlendingPreset:function(e,t){var i=this._generatorProxy.getShaderGenerator(t+"-blending");i.setGraphicContext(this._viewerOSGJS.getGraphicContext()),i.addShader(h.a.DEFAULT),i.addShader(h.a.MATCAP|h.a.WIREFRAME),i.addShader(h.a.MATCAP|h.a.GEOMETRY|h.a.WIREFRAME),i.addShader(h.a.DEFAULT&~h.a.DIFFUSE),i.addShader(h.a.DEFAULT)},initWireframe:function(){for(var e=this._wireframeNodes,t=e.length,i=!0===this.model.get("wireframeEnable")?d.a.NO_PICK_NO_SHADOW:0,r=0;r<t;++r){e[r].setNodeMask(i)}if(t>0){var n=e[0].getStateSet();n||(n=new l.a,e[0].setStateSet(n)),n.getUpdateCallbackList()[0].setFinishCallback(this.setWireframeNodesMask.bind(this,0))}this.onWireframeColorChanged(),!0===this.model.get("wireframeEnable")&&this.onWireframeEnableChanged()},onBlendingPauseDurationChanged:function(){this._nodeBlending.setPauseDuration(this.model.get("blendingPauseDuration"))},onBlendingTransitionDurationChanged:function(){this._nodeBlending.setTransitionDuration(this.model.get("blendingTransitionDuration"))},onBlendingShader:function(){var e=this._generatorProxy.getShaderGenerator(this.getCompilerName()).getNextShader(),t=0!=(e&h.a.WIREFRAME);this.model.set("wireframeEnable",t),t&&this.model.set("wireframeColor","ffffff66"),this.model.trigger("nextBlendingShader",e)},getCompilerName:function(){return this.model.get("renderer")+"-"+this.model.get("style")},updateShadingGlobal:function(){var e,t=this.model.get("style"),i=this.model.get("renderer"),r="lit"===t||"blending"===t;e="matcap"===t?S.a.MATCAP:"pbr"===i&&r?S.a.PBR_LIT:"pbr"===i&&"shadeless"===t?S.a.PBR_SHADELESS:"classic"===i&&r?S.a.CLASSIC_LIT:S.a.CLASSIC_SHADELESS,S.a.set("mask",e)},copyChannels:function(e,t,n){var a={DiffusePBR:"DiffuseColor",AlbedoPBR:"DiffuseColor",AOPBR:"DiffuseIntensity"};i.i(r.each)(a,function(i,r){var a=t.getChannels(),o=a[r],s=a[i];"pbr"===e?s.getTextureModel()?o.getTextureModel()&&!n||o.setTextureModel(s.getTextureModel().clone()):o.getTextureModel()||o.setColor(s.getColor()):(t.getWorkFlowPBRMetalSpec()&&"DiffusePBR"!==r||!t.getWorkFlowPBRMetalSpec()&&"AlbedoPBR"!==r)&&(o.getTextureModel()?o.getTextureModel()&&!n||s.setTextureModel(o.getTextureModel().clone()):s.getTextureModel()||s.setColor(o.getColor()))})},onRendererChanged:function(e,t,n){this.onShadingChanged();var a=this.model.get("renderer"),o=void 0===n.copyChannel||n.copyChannel,s=void 0===n.overrideTexture||n.overrideTexture,u=this._viewer.getFeatures().material;if(!u)return void E.error("The renderer has been changed before the material feature is initialized");var l=u.getModel().attributes,c=this;o&&i.i(r.each)(l,function(e){c.copyChannels(a,e,s)}),y.a.draw()},onShadingChanged:function(){this.updateShadingGlobal();var e=this.model.get("style");this.model.set("hasWireframe",this._hasWireframe&&"blending"!==e),this._nodeBlending.setEnable("blending"===e),this._rootStateSet.setShaderGeneratorName(this.getCompilerName()),"blending"!==e&&(this._wireEnable=void 0),"blending"===e?(this._wireEnable=this.model.get("wireframeEnable"),this._wireColor=this.model.get("wireframeColor"),this.onBlendingShader()):void 0!==this._wireEnable&&(this.model.set("wireframeEnable",this._wireEnable),this._wireEnable&&this.model.set("wireframeColor",this._wireColor)),y.a.draw()},onWireframeColorChanged:function(){for(var e=this._wireframeNodes,t=0,i=e.length;t<i;++t)e[t].getStateSet().setWireframeColor(this.getRGBA())},onSetWireframeColorSmooth:function(e){var t=this.model;t.off("change:wireframeColor",this.onWireframeColorChanged,this),t.set("wireframeColor",e),t.bind("change:wireframeColor",this.onWireframeColorChanged,this);for(var i=this._wireframeNodes,r=0,n=i.length;r<n;++r)i[r].getStateSet().setWireframeColorSmooth(this.getRGBA());t.off("change:wireframeColor",this.onWireframeColorChanged,this),t.set("wireframeColor",e),t.on("change:wireframeColor",this.onWireframeColorChanged,this)},setWireframeNodesMask:function(e){for(var t=this._wireframeNodes,i=0,r=t.length;i<r;++i)t[i].setNodeMask(e);C.a.setWireframe(0!==e)},onWireframeEnableChanged:function(){this.setWireframeNodesMask(d.a.NO_PICK_NO_SHADOW);for(var e=this._wireframeNodes,t=0,i=e.length;t<i;++t)e[t].getStateSet().setWireframeEnable(this.model.get("wireframeEnable"),this.getRGBA())},getRGBA:function(){var e=E.vec4.create();return function(t){var i=t||this.model.get("wireframeColor");return e[0]=parseInt(i.substr(0,2),16)/255,e[1]=parseInt(i.substr(2,2),16)/255,e[2]=parseInt(i.substr(4,2),16)/255,e[3]=parseInt(i.substr(6,2),16)/255,e}}(),onVertexColorChanged:function(){var e=this.model.get("vertexColorEnable"),t=e&&this.model.get("vertexAlphaEnable"),i=this.model.get("vertexColorColorSpace"),r=this._viewer.getFeatures().material;if(r){var n=r.getModel().attributes;for(var a in n){var o=n[a];o.set("vertexColorEnable",e&&o.get("hasVertexColor")),o.set("vertexColorColorSpace",i);var s=t&&o.get("hasVertexAlpha");o.set("vertexAlphaEnable",s),o.getChannels().Opacity.set("vertexAlphaEnable",s)}y.a.draw()}}});t.a=P},function(e,t,i){"use strict";var r=i(5),n=i(515),a=i(463),o=r.a.osg,s=n.a,u=s.prototype,l=a.a.prototype,c=r.a.osgShader,h=function(){a.a.apply(this,arguments),this._outputs=[],this._index=s.DEFAULT};c.Compiler.setStateAttributeConfig(h,c.Compiler.cloneStateAttributeConfig(a.a)),o.createPrototypeObject(h,o.objectInherit(a.a.prototype,{getCompilerName:function(){return"BlendingPBR"},getOrCreateMaterialAlbedo:function(){return this._index&s.DIFFUSE?l.getOrCreateMaterialAlbedo.call(this):this.getOrCreateConstantZero("vec3")},getOrCreateMaterialDiffusePBR:function(){return this._index&s.DIFFUSE?l.getOrCreateMaterialDiffusePBR.call(this):this.getOrCreateConstantZero("vec3")},getOrCreateMaterialRoughness:function(){return this._index&s.ROUGHNESS?l.getOrCreateMaterialRoughness.call(this):this.getOrCreateConstant("float","defRough").setValue("0.2")},getOrCreateMaterialSpecularPBR:function(){return this._index&s.SPECULAR?l.getOrCreateMaterialSpecularPBR.call(this):this.getOrCreateConstantZero("vec3")},getOrCreateMaterialSpecularF0:function(){return this._index&s.SPECULAR?l.getOrCreateMaterialSpecularF0.call(this):this.getOrCreateConstant("float","defF0").setValue("0.04")},setOutputs:u.setOutputs,computeShader:u.computeShader,createFragmentShaderGraph:u.createFragmentShaderGraph,getDefaultFragment:u.getDefaultFragment,getMatcapFragment:u.getMatcapFragment,getOrCreateMaterialNormal:u.getOrCreateMaterialNormal})),t.a=h},function(e,t,i){"use strict";var r=i(5),n=i(387),a=r.a.osg,o=r.a.osgShader,s=function(){n.a.apply(this,arguments),this._isLighted=!1,this._isVertexAlpha=!!this._material&&this._material.getVertexAlphaEnable(),this._isVertexColored=this._isVertexAlpha};o.Compiler.setStateAttributeConfig(s,o.Compiler.cloneStateAttributeConfig(n.a)),a.createPrototypeObject(s,a.objectInherit(n.a.prototype,{getCompilerName:function(){return"Matcap"},getOrCreateChannel:function(e){switch(e){case"Opacity":case"NormalMap":case"BumpMap":case"Displacement":case"Matcap":return n.a.prototype.getOrCreateChannel.call(this,e)}},registerTextureEnvironment:function(){},registerTextureShadow:function(){},applyCurvature:function(e){var t=this.createVariable("float");this.getNode("InlineCode").code("%factor = %curvature / (length(%vertex.xyz) * atan(-1.0 / %projection[2][3]));").inputs({projection:this.getOrCreateUniform("mat4","uProjectionMatrix"),curvature:this.getOrCreateUniform("float","uMatcapCurvature"),vertex:this.getOrCreateUniform("vec4","vViewVertex")}).outputs({factor:t});var i=this.createVariable("vec3");return this.getNode("ApplyCurvature").inputs({normal:this.getOrCreateMaterialNormal(),color:e,factor:t}).outputs({color:i}),i},createFragmentShaderGraph:function(){var e=this.getOrCreateChannel("Matcap"),t=this.createVariable("vec3"),i=this.getOrCreateUniform("vec3","uMatcapColor");this.getNode("Mult").inputs(e,i).outputs(t),t=this.applyCurvature(t);var r=this.multiplyDiffuseWithVertexColor(t);return[this.getFinalFrag(r)]}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(516),a=r.a.osg,o=r.a.osgShader,s=function(){n.a.apply(this,arguments)};o.Compiler.setStateAttributeConfig(s,o.Compiler.cloneStateAttributeConfig(n.a)),a.createPrototypeObject(s,a.objectInherit(n.a.prototype,{getCompilerName:function(){return"Outline"},getOrCreateChannel:function(e){switch(e){case"Displacement":return n.a.prototype.getOrCreateChannel.call(this,e)}},getOrCreateProjectionMatrix:function(){return this.getOrCreateUniform("mat4","uProjectionMatrix")},registerTextureEnvironment:function(){},registerTextureShadow:function(){},createFragmentShaderGraph:function(){var e=this.createVariable("vec4").setValue("vec4(1.0, 0.0, 1.0, 1.0)"),t=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(e).outputs(t),[t]}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(387),a=r.a.osg,o=r.a.osgShader,s=function(){n.a.apply(this,arguments),this._isLighted=!1};o.Compiler.setStateAttributeConfig(s,o.Compiler.cloneStateAttributeConfig(n.a)),a.createPrototypeObject(s,a.objectInherit(n.a.prototype,{getCompilerName:function(){return"Shadeless"},getOrCreateChannel:function(e){switch(e){case"Opacity":case"DiffuseColor":case"EmitColor":case"DiffuseIntensity":case"Displacement":return n.a.prototype.getOrCreateChannel.call(this,e)}},registerTextureEnvironment:function(){},registerTextureShadow:function(){}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(463),a=r.a.osg,o=r.a.osgShader,s=function(){n.a.apply(this,arguments),this._isLighted=!1};o.Compiler.setStateAttributeConfig(s,o.Compiler.cloneStateAttributeConfig(n.a)),a.createPrototypeObject(s,a.objectInherit(n.a.prototype,{getCompilerName:function(){return"ShadelessPBR"},getOrCreateChannel:function(e){switch(e){case"Opacity":case"EmitColor":case"DiffusePBR":case"AlbedoPBR":case"CavityPBR":case"AOPBR":case"Displacement":return n.a.prototype.getOrCreateChannel.call(this,e)}},registerTextureEnvironment:function(){},registerTextureShadow:function(){}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(463),a=r.a.osg,o=r.a.osgShader,s=function(){n.a.apply(this,arguments)};o.Compiler.setStateAttributeConfig(s,o.Compiler.cloneStateAttributeConfig(n.a)),a.createPrototypeObject(s,a.objectInherit(n.a.prototype,{getCompilerName:function(){return"ShadingVr"},createFragmentShaderGraph:function(){var e=this.getOrCreateMaterialNormal(),t=this.createVariable("vec3").setValue("normalize(vec3(0.0, 0.3, 0.9))"),i=this.createVariable("float");this.getNode("InlineCode").code("%out = dot(%lightDir, %normal);").inputs({lightDir:t,normal:e}).outputs({out:i});var r=this.createVariable("vec3");return this.getNode("ComputeLight").inputs({normal:e,lightColor:this.createVariable("vec3").setValue("vec3(0.7, 0.7, 0.9)"),albedo:this.getOrCreateMaterialDiffusePBR(),prepSpec:this.getOrCreatePrepSpec(),viewDir:this.getOrCreateNormalizedViewEyeDirection(),lightDir:t,specular:this.getOrCreateMaterialSpecularPBR(),dotNL:i}).outputs({color:r}),r=this.applyEmissive(r),[this.getFinalFrag(r)]},multiplyDiffuseWithVertexColor:function(e){if(void 0!==e){var t=this.createVariable("vec4");return this.getNode("InlineCode").code("%color.rgb = %diffuse.rgb * %vertexColor.r;").inputs({diffuse:e,vertexColor:this.getOrCreateVarying("vec4","vVertexColor")}).outputs({color:t}),t}},registerTextureEnvironment:function(){},registerTextureShadow:function(){}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(516),a=r.a.osg,o=r.a.osgShader,s=r.a.osgShadow,u=s.ShadowCastCompiler,l=function(){n.a.apply(this,arguments)},c=o.Compiler.cloneStateAttributeConfig(n.a);o.Compiler.setStateAttributeConfig(l,c),a.createPrototypeObject(l,a.objectInherit(n.a.prototype,{getCompilerName:function(){return"ShadowCastSkfb"},getOrCreateProjectionMatrix:function(){return n.a.prototype.getOrCreateProjectionMatrix.call(this,!0)},getFragmentShaderName:function(){return this.getCompilerName()},initAttributes:function(){for(var e=this._attributes,t=0,i=e.length;t<i;t++){var r=e[t].className();"Material"===r?this._material=e[t]:"ShadowCastAttribute"===r?this._shadowCastAttribute=e[t]:"Billboard"===r?this._isBillboard=!!e[t]:"SkinningAttribute"===r?this._skinningAttribute=e[t]:"MorphAttribute"===r&&(this._morphAttribute=e[t])}},applyAlphaBlendMasking:function(e){return this.isAlphaBlendedMaterial()?(this.getNode("InlineCode").code("if(%alpha < 1.0) discard;").inputs({alpha:this.getOrCreateChannel("Opacity")}).outputs({out:e}),e):e},createFragmentShaderGraph:function(){var e=this.getNode("glFragColor");return this.applyPointSizeCircle(e),this.applyAlphaMask(e),this.applyAlphaBlendMasking(e),u.prototype.createShadowCastDepth.call(this,e),[e]}})),t.a=l},function(e,t,i){"use strict";var r=i(5),n=i(516),a=r.a.osg,o=r.a.osgShader,s=function(){n.a.apply(this,arguments),this._isVertexColored=!1};o.Compiler.setStateAttributeConfig(s,o.Compiler.cloneStateAttributeConfig(n.a)),a.createPrototypeObject(s,a.objectInherit(n.a.prototype,{getCompilerName:function(){return"Skeleton"},initTextureAttributes:function(){},createFragmentShaderGraph:function(){var e=this.getNode("glFragColor");return this.getNode("SetFromNode").inputs(this.getOrCreateUniform("vec4","uColor")).outputs(e),[e]}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(387),a=r.a.osg,o=r.a.osgShader,s=function(){n.a.apply(this,arguments),this._isVertexColored=!1};o.Compiler.setStateAttributeConfig(s,o.Compiler.cloneStateAttributeConfig(n.a)),a.createPrototypeObject(s,a.objectInherit(n.a.prototype,{getCompilerName:function(){return"Wireframe"},getOrCreateChannel:function(e){switch(e){case"Displacement":return n.a.prototype.getOrCreateChannel.call(this,e)}},registerTextureEnvironment:function(){},registerTextureShadow:function(){},createFragmentShaderGraph:function(){var e=this.getNode("glFragColor");return this.getNode("InlineCode").code("%out = vec4( %color.rgb * %color.a, %color.a);").inputs({color:this.getOrCreateUniform("vec4","uColor")}).outputs({out:e}),[e]},declareScreenVertex:function(e){var t=this.getOrCreateViewVertex(),i=this.createVariable("vec4");return this.getNode("InlineCode").code("%out = %pos; %out[3] += 0.02 / %proj[1][1];").inputs({proj:this.getOrCreateUniform("mat4","uProjectionMatrix"),pos:t}).outputs({out:i}),this.getNode("MatrixMultPosition").inputs({matrix:this.getOrCreateUniform("mat4","uProjectionMatrix"),vec:i}).outputs({vec:e}),e}})),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(517),a=i(738),o=i(1076),s=r.a.osg,u=function(){n.a.apply(this,arguments),this._CompilerBlending=o.a,this._stackShader=[],this._indexShader=0,this._onSameShader=!0,this._gl=null},l=a.a.prototype;s.createPrototypeObject(u,s.objectInherit(n.a.prototype,{setGraphicContext:l.setGraphicContext,getNextIndexShader:l.getNextIndexShader,onSameShader:l.onSameShader,toNextShader:l.toNextShader,getNextShader:l.getNextShader,getCurrentShader:l.getCurrentShader,addShader:l.addShader,compileAllShaders:l.compileAllShaders,getOrCreateProgram:l.getOrCreateProgram})),t.a=u},function(e,t,i){"use strict";var r=i(5),n=i(336),a=i(297),o=i(516),s=r.a.osg,u=function(){a.a.apply(this,arguments),this.setShaderCompiler(o.a),this._idCompiler=n.a.EARLYZ_COMPILER};s.createPrototypeObject(u,a.a.prototype),t.a=u},function(e,t,i){"use strict";var r=i(5),n=i(297),a=i(1077),o=r.a.osg,s=function(){n.a.apply(this,arguments),this.setShaderCompiler(a.a)};o.createPrototypeObject(s,n.a.prototype),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(336),a=i(297),o=i(1078),s=r.a.osg,u=function(){a.a.apply(this,arguments),this.setShaderCompiler(o.a),this._idCompiler=n.a.EARLYZ_COMPILER};s.createPrototypeObject(u,a.a.prototype),t.a=u},function(e,t,i){"use strict";var r=i(5),n=i(297),a=i(1079),o=r.a.osg,s=function(){n.a.apply(this,arguments),this.setShaderCompiler(a.a)};o.createPrototypeObject(s,n.a.prototype),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(517),a=i(1080),o=r.a.osg,s=function(){n.a.apply(this,arguments),this.setShaderCompiler(a.a)};o.createPrototypeObject(s,n.a.prototype),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(517),a=i(1081),o=r.a.osg,s=function(){n.a.apply(this,arguments),this.setShaderCompiler(a.a)};o.createPrototypeObject(s,n.a.prototype),t.a=s},function(e,t,i){"use strict";var r=i(5),n=i(336),a=i(1082),o=i(297),s=r.a.osgShadow,u=r.a.osg,l=function(){s.ShadowCastShaderGenerator.apply(this,arguments),this.setShaderCompiler(a.a),this._idCompiler=n.a.EARLYZ_COMPILER};u.createPrototypeObject(l,o.a.prototype),t.a=l},function(e,t,i){"use strict";var r=i(5),n=i(297),a=i(1084),o=i(336),s=r.a.osg,u=function(){n.a.apply(this,arguments),this.setShaderCompiler(a.a),this._idCompiler=o.a.WIREFRAME_COMPILER};s.createPrototypeObject(u,n.a.prototype),t.a=u},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(15)),a=i(31),o=i(592),s=i(963),u=i(476);t.a=n.a.extend({defaults:{currentSoundIndex:-1,visible:i.i(a.a)().uiSound,autoplay:!0,playing:!1,volume:void 0,select:void 0},getName:function(){return"Sound"},init:function(e){this._viewer=e.getViewer(),this.set("volume",u.a.getVolume());var t=new s.a([],{modelUID:this._viewer.model.get("uid")}),n=e.getModel().get("options").sound;if(!n||!n.soundtracks||!n.soundtracks.length)return void this.set("soundtracks",t);var a,l=[];n.soundtracks.forEach(function(e){a=t.findWhere({uid:e.uid}),a&&l.push(e),t.add(new o.a(e))}),t.fetch(),l&&i.i(r.each)(l,function(e){a=t.findWhere({uid:e.uid}).duplicate(),Object.keys(e).forEach(function(t){"uid"!==t&&a.set(t,e[t])}),t.add(a)}),this.set("soundtracks",t)},getJSON:function(){var e=[];return this.get("soundtracks").each(function(t){e.push(t.getJSON())}),{soundtracks:e}}})},function(e,t,i){"use strict";var r=i(89),n=i(1094),a=i(1097),o={FeatureName:"sound",ModelType:n.a,ViewListType:[a.a]},s=r.a.create(o);s.prototype.getNode=function(){return this._views[0].getNode()},s.prototype.getWidgetNode=function(){return this._views[0].getNodeEditor()},s.prototype.prepareForScreenShot=function(){var e=r.a.prototype.prepareForScreenShot.call(this);return e&&this._views[0].setPauseUpdate(!0),e},s.prototype.resetAfterScreenShot=function(){r.a.prototype.resetAfterScreenShot.call(this),this._views[0].setPauseUpdate(!1)},t.a=s},function(e,t,i){"use strict";var r=i(10),n=i.n(r),a=function(e,t,i){var r=i.isNew()?i.get("url"):i.get("files")[0].url;this._src=r,t&&this.setMediaElement(t),this._manager=e,this._model=i,this._mediaElementSource=void 0,this._gain=void 0,this._panner=void 0,this._canPlayDefered=void 0,this._isPlaying=!1,this._seeking=!1,this._isPlayerPendingToPlay=!1,this._doPausePlayerWhenPendingToPlayFinished=void 0,this.pendingToPlayResolvedBinded=this.pendingToPlayResolved.bind(this),this.releasePlayerBinded=this.releasePlayer.bind(this)};a.prototype={setMediaElement:function(e){this._player=e,this._player.setAttribute("src",this._src),this._player.load(),this._player.addEventListener("play",this.onPlay.bind(this)),this._player.addEventListener("ended",this.onEnded.bind(this)),this._model&&(this._player.loop=this._model.get("loop"))},isPlayerPlaying:function(){return!!this._player&&(!!this._isPlayerPendingToPlay||!!(this._player.currentTime>0&&!this._player.paused&&!this._player.ended&&this._player.readyState>2))},playerPlay:function(){if(this._player&&!this.isPlayerPlaying()){this._managerContextVersion=this._manager._releaseSafeCounter;var e=this._player.play();this._isPlayerPendingToPlay=!0,e&&e.then(this.pendingToPlayResolvedBinded).catch(function(e){if("The element has no supported sources."!==e.message)return this._doPausePlayerWhenPendingToPlayFinished||this._managerContextVersion!==this._manager._releaseSafeCounter||this._manager.releasePending?void this.pendingToPlayResolved():(this._isPlayerPendingToPlay=!1,void window.setTimeout(this.playerPlay.bind(this),1e3))}.bind(this))}},playerPause:function(){return this._gain&&0!==this._gain.gain.value&&(this._gain.gain.value=0),this._doPausePlayerWhenPendingToPlayFinished?this._doPausePlayerWhenPendingToPlayFinished.promise:this._isPlayerPendingToPlay?(this._doPausePlayerWhenPendingToPlayFinished=n.a.defer(),this._doPausePlayerWhenPendingToPlayFinished.promise):(this.isPlayerPlaying()&&(this._player&&this._player.pause(),this._managerContextVersion=-1),n.a.resolve())},pendingToPlayResolved:function(){this._isPlayerPendingToPlay=!1,this._doPausePlayerWhenPendingToPlayFinished&&(this._player&&this._player.pause(),this._doPausePlayerWhenPendingToPlayFinished.resolve(),this._doPausePlayerWhenPendingToPlayFinished=void 0),this._gain&&(this._gain.gain.value=this._volumeReal)},releasePlayer:function(){this._player=void 0,this._mediaElementSource=void 0},onPlay:function(){this.pendingToPlayResolved(),this._isPlaying&&this.updateVolume()},onEnded:function(){if(this._gain)return this.isSoundAsync()?void(this._model.get("loop")||(this._isPlaying=!1,this._gain.gain.value=0,this.playerPause())):void(this._gain.gain.value=0)},play:function(){this._isPlaying=!0,this.updateVolume()},pause:function(){this._isPlaying=!1,this.updateVolume()},getModel:function(){return this._model},zeroVolume:function(){this._gain&&(this._gain.gain.value=0)},updateVolume:function(){if(void 0!==this._model.get("volume")){if(this._volumeReal=this._model.get("volume")*this._manager.getVolume(),!this._gain)return;this._isPlaying?this._gain.gain.value=this._volumeReal:this._gain.gain.value=0}},updatePosition:function(e){if(this._panner){var t=this._manager.getRadius();this._panner.setPosition(e[0]/t,e[1]/t,e[2]/t)}},getTime:function(){return this._player.currentTime+this._model.startTime},setTime:function(e,t){if(this._manager.canPlay()){if(this.isSoundAsync())return void this.updateVolume();if(this._gain){t&&this.play();var i=this._model.get("loop"),r=e-this._model.get("startTime"),n=r<0,a=!n;return a&&(i?r%=this._player.duration:this._player.duration+this._model.get("startTime")<=e&&(a=!1)),a?(this._isPlaying?this.playerPlay():this.playerPause(),Math.abs(this._player.currentTime-r)>.2?this._player.seeking?(this._seeking=!0,!1):(this._gain.gain.value=0,this._player.currentTime=r,this._seeking=!0,!1):(this._seeking&&!this._player.seeking&&(this._gain.gain.value=this._volumeReal,this._seeking=!1),!1)):(this.playerPause(),i&&0!==this._player.currentTime&&!this._player.seeking&&(this._player.currentTime=0),!0)}}},isSoundAsync:function(){return!1===this._manager._hasAnim||!this._model.get("sync")},setRefDistance:function(e){if(this._panner&&0!==e){var t=e/this._manager.getRadius();this._panner.refDistance=t}},setMaxDistance:function(e){this._panner&&(-1===e?(e=2*this._panner.refDistance,this._model.set("distanceMax",e*this._manager.getRadius())):e/=this._manager.getRadius(),this._panner.maxDistance=e)},updateFromModel:function(){if(!this._player){var e=this._manager._createAudio(this._model);e&&this.setMediaElement(e)}var t=this._model.get("ambient");t||this._panner?!t||!this._panner&&this._gain?this._panner&&(this.setRefDistance(this._model.get("distance")),this._panner.distanceModel=this._model.get("distanceModel"),this.setMaxDistance(this._model.get("distanceMax"))):(this._manager.disconnectSound(this),this._manager.connectAmbientSound(this)):(this._manager.disconnectSound(this),this._manager.connect3DSound(this)),this.isSoundAsync()&&this._manager.getPlayedOnceFromMobileGesture()&&(this.playerPlay(),this._isPlaying=!0),this.updateVolume()},whenReady:function(){return this._canPlayDefered||(this._canPlayDefered=n.a.defer(),this._player.addEventListener("canplaythrough",this._canPlayDefered.resolve.bind(this._canPlayDefered,this),!0)),this._canPlayDefered.promise}},t.a=a},function(e,t,i){"use strict";var r=i(139),n=i(5),a=i(10),o=i.n(a),s=i(4),u=i(46),l=i(31),c=i(90),h=i(70),d=i.n(h),p=i(53),f=i(1098),g=i(476),m=i(465),v=n.a.osg;t.a=s.a.extend({initialize:function(e){s.a.prototype.initialize.apply(this,arguments),this._currentFrame=0,this._currentSimulationTime=0,this._soundPromises=[],this._soundObjects=[],this._context=e.context,this._viewer=this._context.getViewer(),this.model.set("enable",!i.i(l.a)().soundEnable),i.i(l.a)().soundMute&&this.model.set("volume",0),this._nodeFeature=new v.Node,this._nodeFeature.setName("Feature - Sound"),this._nodeFeature.setCullCallback(this),i.i(c.a)()&&f.a.init(this.model,this._context,this._nodeFeature),this.listenTo(this.model,"change:playing",this.onPlayingChange.bind(this)),this.listenTo(this.model,"change:enable",this.onEnableChange.bind(this)),this.listenTo(this.model,"change:volume",this.updateVolume.bind(this));var t=this.model.get("soundtracks");this.listenTo(t,"add",this.onAdd.bind(this)),this.listenTo(t,"remove",this.onRemove.bind(this)),this.listenTo(t,"select",this.onSelectChanged.bind(this)),t.each(this.onAdd.bind(this)),u.a.resolveHasSound(t.length>0),i.i(l.a)().soundPreload?o.a.all(this._soundPromises).then(function(){u.a.resolveSoundsCanPlayTrough(!0),this.handleAnimLoadPromise(),this.updateVolume(this.model)}.bind(this)):(this.handleAnimLoadPromise(),this.updateVolume(this.model)),i.i(c.a)()&&(f.a.setListeners(),u.a.getModelDisplayed().then(function(){this.initDepthTexture()}.bind(this))),["hidden","mozHidden","msHidden","webkitHidden"].forEach(function(e){document&&void 0!==document[e]&&(this._hidden=e,this._visibilityChangeEvent=e.toLowerCase().split("hidden").shift()+"visibilitychange")}.bind(this)),this._visibilityChangeEvent&&(this.tabChange(),document.addEventListener(this._visibilityChangeEvent,this.tabChange.bind(this)))},tabChange:function(){document[this._hidden]?g.a.setEnabled(!1):g.a.setEnabled(!0)},handleAnimLoadPromise:function(){u.a.getHasAnimation().then(function(e){this._hasAnim=e,g.a.setHasAnim(e),u.a.getModelDisplayed().then(function(){if(this.play(),e){var t=this._viewer.getFeatures().animation.getModel();this._featureAnimationModel=t,this.animationTimeSync(),t.bind("change:playing",this.onAnimationPlaying,this),t.bind("change:speed",this.onAnimationSpeedChange,this),t.bind("seek",this.onAnimationTimeSeek,this),t.bind("change:currentUID",this.onUidChange,this)}}.bind(this))}.bind(this))},animationTimeSync:function(){if(1===this._featureAnimationModel.get("speed")){var e=this._featureAnimationModel.getFirstEnabledAnimation();if(void 0!==e){var t=e.get("duration"),i=this._featureAnimationModel.get("progress")*t/100;i!==this._currentSimulationTime&&(this._currentSimulationTime=i,this.updatePositionAndTime())}}},updatePositionAndTime:function(e){if(g.a.canPlay())for(var t=this._currentSimulationTime,r=0,n=this._soundObjects.length;r<n;r++){var a=this._soundObjects[r];a.setTime(t,e),a.updatePosition(i.i(m.a)(a.getModel(),this._nodeFeature))}},onAnimationPlaying:function(e){var t=e.get("playing");this.model.set("playing",t),t?this.play():this.pause()},onUidChange:function(e){"-1"===e.get("currentUID")?this.pause():e.get("playing")&&this.play()},onAnimationTimeSeek:function(e){this._currentSimulationTime=e},onAnimationSpeedChange:function(e){1!==e.get("speed")?this.pause():this.play()},onSoundChange:function(e){e.get("soundObject").updateFromModel(e),e===this.model.get("select")&&f.a.updateGizmo(e),p.a.draw()},cull:function(){return this._hasAnim&&this._featureAnimationModel&&this.animationTimeSync(),i.i(c.a)()&&!this._pauseUpdate&&f.a.updateVisibility(),!0},setPauseUpdate:function(e){this._pauseUpdate=e},getNode:function(){return this._nodeFeature},getNodeEditor:function(){return f.a.getNodeCamera()},onSelectChanged:function(e){this.model.get("select")!==e&&(this.model.set("select",e),this.model.get("soundtracks").trigger("select",e),f.a.updateGizmo(e),p.a.draw())},onAdd:function(e){var t=g.a.createSound(e,this.model.get("playing"));if(-1===e.get("distance")){var n=r.a.getModelBoxWithDisplacement();e.set("distance",n.radius()),e.set("position",n.center(v.vec3.create())),this.onSelectChanged(e),this._hasAnim&&e.set("sync",!0)}e.set("lastComputedScenePosition",v.vec3.create()),e.set("soundObject",t),e.on("change",this.onSoundChange.bind(this)),i.i(m.a)(e,this._nodeFeature),u.a.getModelDisplayed().then(function(){g.a.canPlay()&&(t.updateFromModel(),g.a.forcePlay()),t.updatePosition(i.i(m.a)(t.getModel(),this._nodeFeature))}.bind(this)),this._soundObjects.push(t),i.i(c.a)()&&!e.get("ambient")&&f.a.addIcon(e);var a=o.a.defer();this._soundPromises.push(a),i.i(l.a)().soundPreload?t.whenReady().then(function(){a.resolve(t)}):a.resolve(t)},initDepthTexture:function(){f.a.initDepthTexture()},onRemove:function(e){e===this.model.get("select")&&this.onSelectChanged(),c.a&&f.a.removeIcon(e);var t=e.get("soundObject");g.a.removeSound(t),this._soundObjects.splice(this._soundObjects.indexOf(t),1)},onEnableChange:function(){this.model.set("playing",this.model.get("enable"))},onPlayingChange:function(){this.model.get("enable")&&(this.model.get("playing")?this.onPlay():this.onPause())},onPlay:function(){if("-1"!==this._viewer.getFeatures().animation.getModel().get("currentUID")){if(!this.model.get("enable"))return this.model.set("playing",!1),void this.pause();for(var e=0,t=this._soundObjects.length;e<t;e++)this._soundObjects[e].play();this.updatePositionAndTime(!0)}},onPause:function(){for(var e=0,t=this._soundObjects.length;e<t;e++){this._soundObjects[e].pause()}this.updatePositionAndTime()},play:function(){this.model.get("enable")&&(this.model.set("playing",!0),this.onPlay())},pause:function(){this.model.get("enable")&&(this.model.set("playing",!1),this.onPause())},updateVolume:function(e){var t=e.get("volume");if(d.a.apple.device&&t>0)return void e.set("volume",0);g.a.setVolume(t)}})},function(e,t,i){"use strict";var r,n,a=i(5),o=i(92),s=i(129),u=i(643),l=i.n(u),c=i(642),h=i.n(c),d=i(298),p=i(86),f=i(69),g=i(53),m=i(46),v=i(465),_=i(90),b=i(87),x=i(139),S=i(462),y=a.a.osg,C=a.a.osgUtil,T=new y.BlendFunc(y.BlendFunc.ONE,y.BlendFunc.ONE_MINUS_SRC_ALPHA),M=new y.Depth(y.Depth.DISABLE),w=y.StateAttribute.ON,A=y.vec4.fromValues(.109375,.6640625,.84765625,1),E=y.vec4.fromValues(1,1,0,1),P=y.vec4.fromValues(.8,.8,.8,1),N=y.vec4.fromValues(1,1,0,1),F=function(){return n||(n=y.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0)),n},R={init:function(e,t,i){this.model=e,this._context=t,this._viewer=this._context.getViewer(),this._nodeFeature=i,this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._icons=[],this._nodeCamera=new y.Camera,this._nodeCamera.setNearFarRatio(5e-4),this._nodeCamera.setName("Sound - Camera"),this._nodeCamera.getOrCreateStateSet().setRenderBinDetails(p.a.EDITOR_GIZMO,"RenderBin"),this._nodeCamera.setNodeMask(0),this._nodeIcons=new y.MatrixTransform,this._nodeFeature.addChild(this._nodeCamera),this._nodeCamera.addChild(this._nodeIcons),this._nodeGizmos=new y.MatrixTransform,this._nodeGizmos._forceEnterIntersection=!0,this._nodeCamera.addChild(this._nodeGizmos),this._prepareGeometriesGizmo(),this._gizmoRefDistance=this._makeGizmo(this._geomHandleDistance),this._nodeGizmos.addChild(this._gizmoRefDistance._nodeGizmo),this._gizmoFalloff=this._makeGizmo(this._geomHandleFalloff),this._nodeGizmos.addChild(this._gizmoFalloff._nodeGizmo),this.initStateset()},_prepareGeometriesGizmo:function(){this._geomHandleFalloff=new y.createTexturedBoxGeometry(0,0,0,.5,.5,.5),this._geomHandleDistance=new y.createTexturedBoxGeometry(0,0,0,.5,.5,.5),this._arc=C.GizmoGeometry.createCircleGeometry(64,1,3.2*Math.PI),this.setGizmoStateset(this._arc,A),this.setGizmoStateset(this._geomHandleDistance,A),this.setGizmoStateset(this._geomHandleFalloff,A)},_makeGizmo:function(e){var t={};return t._nodeGizmo=new y.MatrixTransform,t._arcScale=new y.MatrixTransform,this._arcScale=new y.MatrixTransform,t._arcX=this._makeArc(t._arcScale,"arcX"),t._arcY=this._makeArc(t._arcScale,"arcY",.5*-Math.PI,y.vec3.fromValues(1,0,0)),t._arcZ=this._makeArc(t._arcScale,"arcZ",.5*Math.PI,y.vec3.fromValues(0,1,0)),t._handleX=this._makeHandle(t._nodeGizmo,"handleX",y.vec3.fromValues(1,0,0),e),t._handleY=this._makeHandle(t._nodeGizmo,"handleY",y.vec3.fromValues(0,1,0),e),t._handleZ=this._makeHandle(t._nodeGizmo,"handleZ",y.vec3.fromValues(0,0,1),e),t._handleXNeg=this._makeHandle(t._nodeGizmo,"handleXNeg",y.vec3.fromValues(-1,0,0),e),t._handleYNeg=this._makeHandle(t._nodeGizmo,"handleYNeg",y.vec3.fromValues(0,-1,0),e),t._handleZNeg=this._makeHandle(t._nodeGizmo,"handleZNeg",y.vec3.fromValues(0,0,-1),e),t._nodeGizmo.editMask=C.NodeGizmo.PICK_ARROW|C.NodeGizmo.PICK_PLANE,t._nodeGizmo.setCullingActive(!1),t._nodeGizmo.setCullCallback(this),t._nodeGizmo.addChild(t._arcScale),t},_makeHandle:function(e,t,i,r){var n=new y.MatrixTransform;return n.setName(t),e.addChild(n),n.addChild(r),y.mat4.fromTranslation(n.getMatrix(),i),n},_makeArc:function(e,t,i,r){var n=new y.MatrixTransform;return n.setName(t),e.addChild(n),n.addChild(this._arc),i&&r&&y.mat4.fromRotation(n.getMatrix(),i,r),n},initStateset:function(){this._nodeCamera.getOrCreateStateSet().setTextureAttributeAndModes(0,d.a.dummyTexture,w),this._nodeCamera.getOrCreateStateSet().addUniform(y.Uniform.createInt(0,"uTextureDepth"))},setGizmoStateset:function(e,t){var i=e.getOrCreateStateSet();i.setAttributeAndModes(s.a.createShader(l.a,h.a,"line","Handle3D","LINE"),w),i.setAttributeAndModes(T,w),i.setAttributeAndModes(M,w),i.addUniform(y.Uniform.createFloat4(t,"uColor"))},setListeners:function(){var e=this._viewer.getCanvas();e.addEventListener("dblclick",this.onDoubleClick.bind(this)),e.addEventListener("mousedown",this.onDragStart.bind(this)),e.addEventListener("mouseleave",this.onDragEnd.bind(this)),e.addEventListener("mouseup",this.onDragEnd.bind(this)),e.addEventListener("mousemove",this.onDragMove.bind(this))},updateDragHandle:function(e,t){var i=e.getMatrix();y.mat4.fromTranslation(i,t);var r=e.getWorldMatrices()[0];y.mat4.getTranslation(t,r);var n=this.getIconSize(t);y.mat4.scale(i,i,n),e.dirtyBound()},updateArcScale:function(){var e=y.vec3.create();return function(t,i){var r=t._arcScale.getMatrix();y.mat4.scale(r,y.mat4.IDENTITY,y.vec3.set(e,i,i,i)),t._arcScale.dirtyBound(),this.updateDragHandle(t._handleX,y.vec3.set(e,i,0,0)),this.updateDragHandle(t._handleY,y.vec3.set(e,0,i,0)),this.updateDragHandle(t._handleZ,y.vec3.set(e,0,0,i)),this.updateDragHandle(t._handleXNeg,y.vec3.set(e,-i,0,0)),this.updateDragHandle(t._handleYNeg,y.vec3.set(e,0,-i,0)),this.updateDragHandle(t._handleZNeg,y.vec3.set(e,0,0,-i))}}(),cull:function(){var e=y.vec3.create();return function(){if(!i.i(_.a)())return!0;var t=this.model.get("select");if(!t)return!0;if(t!==this._select&&(this._select=t,this._isSnapped=t.get("snap")),this._dragging&&g.a.draw(),t.get("ambient"))return!0;var r=t.get("soundObject"),n=t.get("distance");this.updateArcScale(this._gizmoRefDistance,n),"linear"===t.get("distanceModel")?(this._gizmoFalloff._nodeGizmo.setNodeMask(f.a.NO_SHADOW),this.updateArcScale(this._gizmoFalloff,t.get("distanceMax"))):this._gizmoFalloff._nodeGizmo.setNodeMask(0);var a=this.getGizmo(),o=t.get("lastComputedScenePosition"),s=t.get("snap");if(a&&(a.isEditing()||this._isSnapped!==s)){if(this._isSnapped=s,y.vec3.copy(e,o),y.mat4.getTranslation(o,a.getMatrix()),s?(this.snapCheck(t,o),r.updatePosition(i.i(v.a)(t,this._nodeFeature)),this._displaySnapHelp()):t.set("geometryUid",-1),y.vec3.equals(e,o))return!0;r.updatePosition(o),y.vec3.copy(t.get("position"),o)}return!0}}(),getNodeCamera:function(){return this._nodeCamera},getGizmo:function(){var e=this._viewer.getFeaturesManager();return e?e.getNodeGizmo():null},_displaySnapHelp:function(){new b.a({content:"Double-click to snap the sound on the object surface.",class:"info",delay:2e3})},updateGizmo:function(e){var t=this.getGizmo();if(t){if(void 0===e||e.get("ambient"))return t.attachToGeometry(null),t.attachToMatrixTransform(null),this._nodeGizmos.setNodeMask(0),void this.hideIcon(e);e.get("ambient")||this.addIcon(e),t.attachToMatrixTransform(this._nodeGizmos),this._nodeGizmos.setNodeMask(-1),e.get("snap")?this._nodeGizmos.editMask=C.NodeGizmo.NO_PICK:this._nodeGizmos.editMask=C.NodeGizmo.PICK_ARROW|C.NodeGizmo.PICK_PLANE;var i=e.get("lastComputedScenePosition");y.mat4.setTranslation(this._nodeGizmos.getMatrix(),i),"linear"===e.get("distanceModel")?(this._gizmoFalloff._nodeGizmo.setNodeMask(f.a.NO_SHADOW),this.updateArcScale(this._gizmoFalloff,e.get("distanceMax"))):this._gizmoFalloff._nodeGizmo.setNodeMask(0),this._nodeGizmos.dirtyBound()}},initDepthTexture:function(){var e=this._viewer.getFeatures().postProcess.getCamera()._textureDepth;this._nodeCamera.getStateSet().setTextureAttributeAndModes(0,e,w);for(var t=0,i=this._icons.length;t<i;t++)this._icons[t].getStateSet().setTextureAttributeAndModes(0,e,w)},getIconSize:function(){var e=y.vec4.create(),t=y.vec3.create(),i=y.vec3.create();return function(r){var n=this._viewer.getCamera(),a=.02*this._viewerOSGJS.getCanvasClientWidth()*y.mat4.getScale(e,n.getProjectionMatrix())[0];this._manipulator.getEyePosition(t);var o=y.vec3.dist(t,r||y.vec3.ZERO)/a;return y.vec3.set(i,o,o,o)}}(),updateIcons:function(){var e=y.quat.create(),t=y.mat4.create(),r=y.vec4.create(),n=y.vec3.create();return function(){if(i.i(_.a)()&&this.isSoundTabOpen()){var a=this.model.get("select"),o=this._viewer.getCamera(),s=.02*this._viewerOSGJS.getCanvasClientWidth()*y.mat4.getScale(r,o.getProjectionMatrix())[0];this._manipulator.getEyePosition(n);var u,l,c;y.mat4.invert(t,o.getViewMatrix()),y.mat4.getRotation(e,t);for(var h=0,d=this._icons.length;h<d;h++){l=this._icons[h];c=l.getUserData().get("soundObject").getModel(),l!==this._hovered&&this.setIconSelected(l,a===c),u=l.getMatrix();var p=c.get("lastComputedScenePosition"),f=y.vec3.dist(n,p)/s;y.vec3.set(r,f,f,f),y.mat4.fromRotationTranslationScale(u,e,p,r),l.dirtyBound()}}}}(),addIcon:function(e){var t,i;if(i=this._findIcon(e))return i.setNodeMask(-1),i;t=F(),i=new y.MatrixTransform,i.addChild(t);var n=o.default.instance,a=n.getOrCreateTexture(S.a.iconSound);this.setGizmoStateset(i,P);var u=i.getOrCreateStateSet();u.setTextureAttributeAndModes(1,a.texture,w),u.addUniform(y.Uniform.createInt(1,"uTextureIcon")),u.addUniform(y.Uniform.createInt(0,"uAttachedToCamera")),u.addUniform(y.Uniform.createInt(1,"uEnable")),r||(r=s.a.createShader(l.a,h.a,"icon","LightingIcon","ICON")),u.setAttributeAndModes(r),m.a.getModelDisplayed().then(this.initDepthTexture.bind(this));var c=this._icons.length;i.setName("SOUNDIconMT_"+c);var d=i.getMatrix();y.mat4.fromTranslation(d,e.get("lastComputedScenePosition")),y.mat4.scale(d,d,this.getIconSize()),this._icons.push(i),this._nodeIcons.addChild(i),i.setUserData(e),i.dirtyBound()},hideIcon:function(e){var t=this._findIcon(e);t&&t.setNodeMask(0)},_findIcon:function(e){for(var t=0;t<this._icons.length;t++)if(this._icons[t].getUserData()===e)return this._icons[t];return null},snapCheck:function(){var e=new C.SphereIntersector,t=new C.IntersectionVisitor;return function(r,n){var a=x.a.getModelBoxWithDisplacement().radius(),o=10*a;t.setTraversalMask(f.a.PICK_GEOMETRY_SLOW),e.set(n,o),t.setIntersector(e),this._context.getScene().getPolygonNode().accept(t);var s=e.getIntersections();s.length&&(s.sort(function(e,t){return e._ratio-t._ratio}),i.i(v.b)(r,this._viewer.getFeaturesManager(),s[0]))}}(),onDragStart:function(e){if(this.isSoundTabOpen()){var t=this._viewer.getFeaturesManager();if(t){var i=void 0===e.offsetX?e.layerX:e.offsetX,r=void 0===e.offsetY?e.layerY:e.offsetY,n=t.computeNearestIntersection2D(i,r,f.a.PICK_GEOMETRY,this._nodeCamera);if(this._dragging=!1,n){var a=n._nodePath[n._nodePath.length-1];if(a===F()){var o=n._nodePath[n._nodePath.length-2].getUserData();o&&this.model.get("soundtracks").trigger("select",o)}else if(a===this._geomHandleDistance||a===this._geomHandleFalloff){var s=this.model.get("select");if(void 0===s)return;var u=this.getGizmo();if(!u||u.isEditing())return;this._viewer._viewer._eventProxy.StandardMouseKeyboard.mouseup(e),this._viewer._viewer._eventProxy.StandardMouseKeyboard._enable=!1,this._dragging=!0,this.model.set("dragging",!0);var l=u.getWorldMatrices()[0],c=y.vec3.create();y.vec3.transformMat4(c,c,l),u.getCanvasPositionFromWorldPoint(c,c),this._draggingStartGizmoCenterX=c[0],this._draggingStartGizmoCenterY=c[1],this._draggingStartX=void 0===e.offsetX?e.layerX:e.offsetX,this._draggingStartY=void 0===e.offsetY?e.layerY:e.offsetY,i=(this._draggingStartX-this._draggingStartGizmoCenterX)/this._viewer.getWidth(),r=(this._draggingStartY-this._draggingStartGizmoCenterY)/this._viewer.getHeight(),this._draggingStartScreenDistance=Math.sqrt(i*i+r*r),n._nodePath[n._nodePath.length-3]===this._gizmoFalloff._nodeGizmo?(this.draggingFallofGizmo=!0,this._draggingStartDistance=s.get("distanceMax")):(this.draggingRefDistanceGizmo=!0,this._draggingStartDistance=s.get("distance"))}}}}},onHover:function(e,t,i){var r=this._viewer.getFeaturesManager();if(r){var n,a=r.computeNearestIntersection2D(e,t,f.a.PICK_GEOMETRY,this._nodeCamera);if(a){var o=a._nodePath[a._nodePath.length-1];if(o===this._hovered||a._nodePath.length>2&&a._nodePath[a._nodePath.length-2]===this._hovered)return;o===F()?(this._hovered=a._nodePath[a._nodePath.length-2],this.setIconSelected(this._hovered,!0),g.a.draw()):o!==this._geomHandleDistance&&o!==this._geomHandleFalloff||(this._hovered=o,n=o.getStateSet().getUniform("uColor").getInternalArray(),y.vec4.copy(n,E),g.a.draw())}else this._hovered&&(this._hovered===this._geomHandleDistance||this._hovered===this._geomHandleFalloff?(n=this._hovered.getStateSet().getUniform("uColor").getInternalArray(),y.vec4.copy(n,A)):this._hovered.getUserData()!==i&&this.setIconSelected(this._hovered,!1),g.a.draw(),this._hovered=!1)}},setIconSelected:function(e,t){var i=e.getStateSet().getUniformList(),r=i.uColor.getAttribute().getInternalArray();t?y.vec4.copy(r,N):y.vec4.copy(r,P)},onDragMove:function(e){if(this.isSoundTabOpen()){var t=void 0===e.offsetX?e.layerX:e.offsetX,i=void 0===e.offsetY?e.layerY:e.offsetY,r=this.model.get("select");if(!this._dragging)return void this.onHover(t,i,r);if(void 0!==r){var n=this.getGizmo();if(n){if(n.isEditing())return void this.onDragEnd();t=(t-this._draggingStartGizmoCenterX)/this._viewer.getWidth(),i=(i-this._draggingStartGizmoCenterY)/this._viewer.getHeight();var a=Math.sqrt(t*t+i*i);a=a*this._draggingStartDistance/this._draggingStartScreenDistance,this.draggingRefDistanceGizmo?(r.set("distance",a),a>r.get("distanceMax")&&r.set("distanceMax",a)):(r.set("distanceMax",a),a<r.get("distance")&&r.set("distance",a)),g.a.draw()}}}},onDragEnd:function(){if(this._dragging&&this.isSoundTabOpen()){void 0!==this.model.get("select")&&(this._viewer._viewer._eventProxy.StandardMouseKeyboard._enable=!0,this.draggingFallofGizmo=!1,this.draggingRefDistanceGizmo=!1,this._dragging=!1,this.model.set("dragging",!1),g.a.draw())}},onDoubleClick:function(e){if(this.isSoundTabOpen()){var t=this.model.get("select");if(void 0!==t&&!t.get("ambient")){var r=this._viewer.getFeaturesManager();if(r){var n=r.pickNearestSurface(e);if(n){i.i(v.b)(t,r,n),t.get("snap")||t.set("geometryUid",-1);t.get("soundObject").updatePosition(i.i(v.a)(t,this._nodeFeature))}}}}},isSoundTabOpen:function(){var e=this._viewer.getOptions().widgetAPI;return e&&"sound"===e.getTabbedWidget().get()},removeIcon:function(e){for(var t=0,i=this._icons.length;t<i;t++){var r=this._icons[t];if(r.getUserData()===e){r.getParents()[0].removeChild(r);break}}},updateVisibility:function(){this.isSoundTabOpen()?(this._nodeCamera.setNodeMask(f.a.NO_SHADOW),this.updateGizmo(this.model.get("select")),this.updateIcons()):this._nodeCamera.setNodeMask(0)}};t.a=R},function(e,t,i){"use strict";var r=function(e,t){for(var i=t||1,r=1,n=e.length/i;r<n;++r)for(var a=(r-1)*i,o=r*i,s=0;s<i;++s)e[o+s]+=e[a+s];return e};t.a=r},function(e,t,i){"use strict";var r=function(e){for(var t=1,i=e.length/4;t<i;++t){var r=4*(t-1),n=4*t,a=e[r],o=e[r+1],s=e[r+2],u=e[r+3],l=e[n],c=e[n+1],h=e[n+2],d=e[n+3];e[n]=a*d+o*h-s*c+u*l,e[n+1]=-a*h+o*d+s*l+u*c,e[n+2]=a*c-o*l+s*d+u*h,e[n+3]=-a*l-o*c-s*h+u*d}return e};t.a=r},function(e,t,i){"use strict";var r=function(e,t){for(var i=t||0,r=e.length,n=e[i],a=i+1;a<r;++a){var o=e[a];n=e[a]=n+(o>>1^-(1&o))}return e};t.a=r},function(e,t,i){"use strict";var r=function(e,t,i,n){for(var a=e[r.IMPLICIT_HEADER_EXPECTED_INDEX],o=e[r.IMPLICIT_HEADER_MASK_LENGTH],s=new Uint32Array(e.subarray(r.IMPLICIT_HEADER_LENGTH,o+r.IMPLICIT_HEADER_LENGTH)),u=32*o-t.length,l=0;l<o;++l)for(var c=s[l],h=32*l,d=l===o-1?u:0,p=d;p<32;++p,++h)t[h]=c&1<<31>>>p?e[i++]:n?a:a++;return t};r.IMPLICIT_HEADER_PRIMITIVE_LENGTH=0,r.IMPLICIT_HEADER_MASK_LENGTH=1,r.IMPLICIT_HEADER_EXPECTED_INDEX=2,r.IMPLICIT_HEADER_LENGTH=3,t.a=r},function(e,t,i){"use strict";var r=function(e,t,i){for(var r=e.length/i,n=0;n<r;++n)for(var a=n*i,o=0;o<i;++o)t[a+o]=e[n+r*o];return t};t.a=r},function(e,t,i){"use strict";var r=function(e,t,i){var r=e.length/t,n=new Uint8Array(r),a=i.length-1;n[i[0]]=1,n[i[1]]=1,n[i[2]]=1;for(var o=2;o<a;++o){var s=o-2,u=i[s],l=i[s+1],c=i[s+2],h=i[s+3];if(1!==n[h]){n[h]=1,u*=t,l*=t,c*=t,h*=t;for(var d=0;d<t;++d)e[h+d]=e[h+d]+e[l+d]+e[c+d]-e[u+d]}}return e};t.a=r},function(e,t,i){"use strict";var r=function(e,t,i){for(var r=i[0],n=e.length,a=0;a<n;++a){var o=r-e[a];t[a]=o,r<=o&&(r=o+1)}return i[0]=r,t};t.a=r},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=r.a.osgAnimation,o=function(){n.NodeVisitor.call(this),this._stats={nodeCount:0,matrixTransformCount:0,geometryCount:0,boneCount:0,skeletonCount:0,morphGeometryCount:0,rigGeometryCount:0}};o.NodeCount=0,o.MatrixTransformCount=0,o.BoneCount=0,o.MorphGeometryCount=0,o.RigGeometryCount=0,o.GeometryCount=0,o.SkeletonCount=0;var s=n.Node.typeID,u=n.MatrixTransform.typeID,l=a.Bone.typeID,c=a.Skeleton.typeID,h=n.Geometry.typeID,d=a.MorphGeometry.typeID,p=a.RigGeometry.typeID;n.createPrototypeObject(o,n.objectInherit(n.NodeVisitor.prototype,{getStats:function(){return this._stats},apply:function(e){var t=this._stats,i=e.typeID;e.userDataMap&&e.userDataMap.wireframe||(i===s?t.nodeCount++:i===u?t.matrixTransformCount++:i===h?t.geometryCount++:i===l?t.boneCount++:i===c?t.skeletonCount++:i===d?t.morphGeometryCount++:i===p?(t.rigGeometryCount++,e.getSourceGeometry().typeID===d&&t.morphGeometryCount++):console.error("Unknown node type ID : "+i+" "+e.className()),this.traverse(e))}})),t.a=o},function(e,t,i){"use strict";var r=i(5),n=i(31),a=i(53),o=r.a.osg,s=[[.263385,-.0252475],[-.38545,.054485],[-.139795,-.5379925],[-.2793775,.6875475],[.7139025,.4710925],[.90044,-.16422],[.4481775,-.82799],[-.9253375,-.2910625],[.3468025,1.02292],[-1.13742,.33522],[-.7676225,-.9123175],[-.2005775,-1.1774125],[-.926525,.96876],[1.12909,-.7500325],[.9603,1.14625]],u=function(e){return u.instance?u.instance:(this._canBeEnabled=i.i(n.a)().supersample,this._viewer=e,this._sampleCount=15,this._isSupersampling=!1,this._frameNum=1,this._frameNumTaa=0,this._switch=!0,u.instance=this,this)};o.createPrototypeObject(u,{getSampleCount:function(){return this._sampleCount},setCanBeEnabled:function(e){this._canBeEnabled=i.i(n.a)().supersample&&e},canBeEnabled:function(){return this._canBeEnabled},getOrCreateJitterUniform:function(){return this._jitterUniform?this._jitterUniform:(this._jitterUniform=o.Uniform.createFloat4("uHalton"),this._jitter=this._jitterUniform.getInternalArray(),this._jitter[2]=1,this._jitterUniform)},getSortedJitterTable:function(){return s},updateUniforms:function(e){var t=this.getSortedJitterTable()[e-1];this._jitter[0]=t[0],this._jitter[1]=t[1]},setSwitch:function(e){this._switch=e},isTaaJitter:function(){var e=this._postProcess.getModel(),t=e.get("taaEnable"),r="none"!==this._viewer.getFeatures().background.getModel().get("enable"),a=void 0!==i.i(n.a)().taaJitter?i.i(n.a)().taaJitter:r,o=this._viewer.getFeatures().animation.getModel(),s=o.get("animations").length&&o.get("playing")&&"-1"!==o.get("currentUID"),u=e.get("webVR");return t&&a&&!s&&!u},updateFrame:function(){return this._jitter[2]=-this._jitter[2],this._postProcess.getModel().trigger("pingPongTexture0",this._jitter[2]>0),this._isSupersampling?(a.a._doJitter=!0,this._jitter[3]=this._frameNum,this.updateUniforms(this._frameNum),this._frameNum++,this.isSupersampled()&&(this._isSupersampling=!1),this._isSupersampling):(this._jitter[2]=Math.sign(this._jitter[2]),this.isTaaJitter()&&a.a._doJitter?(this.updateUniforms(this._frameNumTaa%this._sampleCount+1),this._frameNumTaa++):(this._jitter[0]=0,this._jitter[1]=0,this._frameNum=1,this._frameNumTaa=0),a.a._doJitter=!0,!1)},update:function(e,t){if(!this._switch)return!0;var i=t.getFrameStamp().getFrameNumber();return this._lastUpdateFrame===i||(this._lastUpdateFrame=i,!this._postProcess&&(this._postProcess=this._viewer.getFeatures().postProcess,!this._postProcess)||(this.updateFrame()&&a.a.drawSameFrame(),!0))},isSupersampled:function(){return this._frameNum>this._sampleCount},isEnabled:function(){return this._isSupersampling},forceEnable:function(){this._isSupersampling=!0,this._jitter[0]=0,this._jitter[1]=0,this._jitter[2]=2*Math.sign(this._jitter[2]),this._jitter[3]=0,this._frameNum=1,a.a.drawSameFrame()},enable:function(){this.canBeEnabled()&&1===this._frameNum&&this.forceEnable()},reset:function(){this._jitter[2]=Math.sign(this._jitter[2]),this._frameNum=1,this._isSupersampling=!1},setRoot:function(e){e.getOrCreateStateSet().addUniform(this.getOrCreateJitterUniform());var t=new o.Node("supersampleUpdateInterceptor");e.addChild(t),t.addUpdateCallback(u.instance)}}),t.a=u},function(e,t,i){"use strict";var r=i(5),n=i(19),a=i.n(n),o=i(31),s=i(1118),u=i(1121),l=i(139),c=i(46),h=r.a.osg;i.i(o.a)().vrForceRaf&&(r.a.osgViewer.Viewer.prototype.setVRDisplay=function(e){this._hmd=e,this._requestAnimationFrame=e.requestAnimationFrame.bind(e)});var d=a.a.Model.extend({defaults:{enable:!1,worldFactor:-1,deviceInfo:void 0,hasNativeHMD:!!navigator.getVRDisplays,modeLauncher:!1,hit:void 0,floorHeight:0,humanMatrix:h.mat4.create(),humanInAir:!1},init:function(e){navigator.getVRDisplays?navigator.getVRDisplays().then(function(e){this.set("hasNativeHMD",e.length>0),c.a.resolveVrDisplayReady()}.bind(this)):(this.set("hasNativeHMD",!1),c.a.resolveVrDisplayReady()),this._context=e,this._scene=e.getScene(),this._viewer=e.getViewer()},initAfterFirstFrame:function(){this.set("deviceInfo",this._initDeviceInfo());var e=this._context.getModel().get("options").vr;if(e&&e.scale>0){this.set("worldFactor",e.scale),this.set("floorHeight",e.floorHeight);var t=this.get("humanMatrix"),r=e.initialCamera;h.mat4.fromQuat(t,r.rotation),h.mat4.setTranslation(t,r.position)}this.initBoundAndWorldFactor(),this.onVrDisplayReady(this.set.bind(this,"enable",i.i(o.a)().cardboard>0))},onVrDisplayReady:function(e){c.a.getVrDisplayReady().isFulfilled()?e():c.a.getVrDisplayReady().then(function(){e()})},_getBoundRadius:function(){return l.a.getModelBoxWithDisplacement().radius()},isDiorama:function(){return this._getBoundRadius()<2*this.get("worldFactor")},getMinimumWorldFactor:function(){return.001*this._getBoundRadius()},getMaximumWorldFactor:function(){return 10*this._getBoundRadius()},_makeValidWorldFactor:function(){var e=this.get("worldFactor"),t=this.getMinimumWorldFactor(),i=this.getMaximumWorldFactor();if(e<t*l.a.BIAS_MIN||e>i*l.a.BIAS_MAX){var r=l.a.getModelBoxWithDisplacement(),n=r.getMin()[2],a=r.radius();this.set("worldFactor",.5*a),this.set("floorHeight",n);var o=r.center(h.vec3.create());o[1]-=1.2*a,o[2]=n,h.mat4.fromTranslation(this.get("humanMatrix"),o)}else this.set("worldFactor",Math.min(Math.max(e,t),i))},initBoundAndWorldFactor:function(){this._makeValidWorldFactor(),this.trigger("uiReady")},_initDeviceInfo:function(){var e=new u.a(!1),t=new s.a(e.getDeviceParams());return i.i(o.a)().cardboard>1&&t.setViewer(s.a.Viewers.CardboardV2),t},getName:function(){return"WebVR"},getJSON:function(){var e=h.mat4.copy(h.mat4.create(),this.get("humanMatrix")),t=h.mat4.getScale(h.vec3.create(),e);h.vec3.set(t,1/t[0],1/t[1],1/t[2]);var i=h.mat4.scale(e,e,t),r=h.quat.create();return h.quat.normalize(r,h.mat4.getRotation(r,i)),{scale:this.get("worldFactor"),initialCamera:{position:h.mat4.getTranslation(h.vec3.create(),i),rotation:r},floorHeight:this.get("floorHeight")}}});t.a=d},function(e,t,i){"use strict";var r=i(5),n=i(129),a=i(69),o=i(86),s=i(402),u=i(70),l=i.n(u),c=i(874),h=i.n(c),d=i(873),p=i.n(d),f=i(597),g=i(31),m=r.a.osg,v={SCALE_THRESHOLD:.3,CIRCULAR_BUTTON:0,TRIGGER:1,MENU:3},_={SCALE_THRESHOLD:.7,STICK:0,TRIGGER_UP:1,TRIGGER_SIDE:2,AX:3,BY:4,HOME:5},b={CIRCULAR_BUTTON:0,HOME:1,CIRCULAR_UP:5,CIRCULAR_DOWN:4},x={SCALE_THRESHOLD:.7,CIRCULAR_BUTTON:0},S={TOUCHPAD_BUTTON:0},y=function(e,t){m.MatrixTransform.call(this),this.setName("WebVR - Controller"),this.setNodeMask(a.a.NO_PICK),this._pointerMT=new m.MatrixTransform,this._proxyControllerMT=new m.MatrixTransform,this._geomPointer=m.createTexturedQuadGeometry(-.5,0,0,1,0,0,0,1,0),this._geomController=new m.createTexturedBoxGeometry(0,-.1,0,.1,.2,.1),this.addChild(this._proxyControllerMT),this.addChild(this._pointerMT),this._pointerMT.addChild(this._geomPointer),this._proxyControllerMT.addChild(this._geomController),this._activeController=void 0,this._model=e,this._postMultRotate=e._viewer.getViewerOSGJS().getManipulator().getFirstPersonManipulator().getPostMultRotate(),this._uPointerAlpha=m.Uniform.createFloat1(1,"uAlpha"),this._hitScaleOffset=20,this._canvas=t,this._controllerMeshDisplay=void 0,this._pressedButtons=[],this._gamepadType=void 0,this._pointerClicked=!1,this._timeSinceLastPointerClick=0,this._menuPressed=!1,this._clickPressed=!1,this._teleportPressed=!1,this._menuPressedFrame=!1,this._clickPressedFrame=!1,this._teleportPressedFrame=!1,this._scaleValueChange=0,this._cbPointerDown=this.onPointerDown.bind(this),this._cbPointerUp=this.onPointerUp.bind(this),this._cbMouseDown=this.onMouseDown.bind(this),this._cbClick=this.onClick.bind(this),this._canvasX=0,this._canvasY=0,this._preferLeftHand=!1,this.init()};m.createPrototypeNode(y,m.objectInherit(m.MatrixTransform.prototype,{init:function(){var e=this._proxyControllerMT.getOrCreateStateSet();this._createMaterialWithColor(e,m.vec3.fromValues(.8481,.8481,.8481));var t=this._geomPointer.getOrCreateStateSet();t.addUniform(this._uPointerAlpha),t.setRenderBinDetails(o.a.VR_CURSOR,"RenderBin"),t.setAttributeAndModes(new m.BlendFunc(m.BlendFunc.ONE,m.BlendFunc.ONE_MINUS_SRC_ALPHA)),t.setAttributeAndModes(n.a.createShader(h.a,p.a,"webVR-laser","VRLaser"))},_createMaterialWithColor:function(e,t){e.setShaderGeneratorName("shading-vr");var i=f.a.createMaterialModel(e);i.set("name","NodeController"),i.set("hasVertexColor",!0),i.set("vertexColorEnable",!0),i.set("vertexColorColorSpace","linear");var r=i.getChannels();r.AlbedoPBR.setColor(t),r.AlbedoPBR.setEnable(!0),r.MetalnessPBR.setFactor(0),r.MetalnessPBR.setEnable(!0),r.RoughnessPBR.setFactor(.4),r.RoughnessPBR.setEnable(!0),i.trigger("apply"),e.setAttributeAndModes(e.getAttribute("SketchfabMaterial"))},setEventListeners:function(){this._model.get("hasNativeHMD")?window.addEventListener("click",this._cbClick):(this._canvas.addEventListener("touchstart",this._cbPointerDown),this._canvas.addEventListener("touchend",this._cbPointerUp),this._canvas.addEventListener("mousedown",this._cbMouseDown),this._canvas.addEventListener("mouseup",this._cbPointerUp))},removeEventListeners:function(){this._model.get("hasNativeHMD")?window.addEventListener("click",this._cbClick):(this._canvas.removeEventListener("touchstart",this._cbPointerDown),this._canvas.removeEventListener("touchend",this._cbPointerUp),this._canvas.removeEventListener("mousedown",this._cbMouseDown),this._canvas.removeEventListener("mouseup",this._cbPointerUp))},onClick:function(){this._teleportPressed=!0,this._clickPressed=!0},setListenToEvents:function(e){e?this.setEventListeners():this.removeEventListeners()},isPosedController:function(){var e=this._activeController;return!!(e&&e.pose&&e.pose.hasOrientation)},replaceControllerMesh:function(e){var t=this._geomController;this._proxyControllerMT.removeChild(t);var i=e.BODY;this._geomController=new m.Geometry,this._geomController.getAttributes().Vertex=new m.BufferArray(m.BufferArray.ARRAY_BUFFER,i.VERTEX,3),this._geomController.getAttributes().Normal=new m.BufferArray(m.BufferArray.ARRAY_BUFFER,i.NORMAL,3),this._geomController.getAttributes().Color=new m.BufferArray(m.BufferArray.ARRAY_BUFFER,i.COLOR,1),this._geomController.getPrimitives().push(new m.DrawElements(m.primitiveSet.TRIANGLES,new m.BufferArray(m.BufferArray.ELEMENT_ARRAY_BUFFER,i.TRIANGLES,1))),this._geomController.getPrimitives().push(new m.DrawElements(m.primitiveSet.TRIANGLE_STRIP,new m.BufferArray(m.BufferArray.ELEMENT_ARRAY_BUFFER,i.STRIP,1))),this._proxyControllerMT.addChild(this._geomController);var r=e.BUTTON;this._geomControllerButtons=new m.Geometry,this._geomControllerButtons.getAttributes().Vertex=new m.BufferArray(m.BufferArray.ARRAY_BUFFER,r.VERTEX,3),this._geomControllerButtons.getAttributes().Normal=new m.BufferArray(m.BufferArray.ARRAY_BUFFER,r.NORMAL,3),this._geomControllerButtons.getAttributes().Color=new m.BufferArray(m.BufferArray.ARRAY_BUFFER,r.COLOR,1),this._geomControllerButtons.getPrimitives().push(new m.DrawElements(m.primitiveSet.TRIANGLES,new m.BufferArray(m.BufferArray.ELEMENT_ARRAY_BUFFER,r.TRIANGLES,1))),this._geomControllerButtons.getPrimitives().push(new m.DrawElements(m.primitiveSet.TRIANGLE_STRIP,new m.BufferArray(m.BufferArray.ELEMENT_ARRAY_BUFFER,r.STRIP,1))),this._proxyControllerMT.addChild(this._geomControllerButtons),this._createMaterialWithColor(this._geomControllerButtons.getOrCreateStateSet(),m.vec3.fromValues(.00237,.30699,.57048)),this._updateCorrectionMatrix()},_updateCorrectionMatrix:function(){var e=this._proxyControllerMT.getMatrix();if(this._gamepadType===_){var t=m.vec3.create();m.mat4.fromTranslation(e,m.vec3.set(t,0,.03262643,.031930979)),m.mat4.rotateX(e,e,.22*Math.PI),this._activeController&&"left"===this._activeController.hand&&m.mat4.scale(e,e,m.vec3.set(t,-1,1,1))}else m.mat4.identity(e)},onPointerDown:function(){l.a.any&&!this._activeController&&(this._pointerClicked=!0)},onPointerUp:function(e){this._pointerClicked=!1,l.a.any||(2===e.button?this._menuPressed=!0:Math.abs(e.pageX-this._canvasX)<5&&Math.abs(e.pageY-this._canvasY)<5&&(this._clickPressed=!0,this._teleportPressed=!0))},onMouseDown:function(e){l.a.any&&!this._activeController&&this._model.get("hasNativeHMD")&&(this._teleportPressed=!0),l.a.any||(this._canvasX=e.pageX,this._canvasY=e.pageY)},updateButtonsPressed:function(){if(this._activeController)for(var e=this._pressedButtons.length,t=0;t<e;++t){var i=this._activeController.buttons[t].pressed;i!==this._pressedButtons[t]&&(this._pressedButtons[t]=i,i?this.onButtonDown(t):this.onButtonUp(t))}},updateHoverAxes:function(){this._gamepadType===_&&(this._scaleValueChange=0,this.updateScaleChangeFromXAxis(_.SCALE_THRESHOLD))},updateScaleChangeFromXAxis:function(e){var t=this._activeController.axes[0];t>e?this._scaleValueChange=1:t<-e&&(this._scaleValueChange=-1)},updatePointerClick:function(e){if(this._pointerClicked){if(this._timeSinceLastPointerClick>1.2)return this._menuPressed=!0,this._pointerClicked=!1,void(this._timeSinceLastPointerClick=0);this._timeSinceLastPointerClick+=e}else this._timeSinceLastPointerClick>0&&this._timeSinceLastPointerClick<1.2&&(l.a.any&&(this._clickPressed=!0,this._teleportPressed=!0),this._timeSinceLastPointerClick=0)},onButtonUp:function(e){if(this._gamepadType===v)switch(e){case v.TRIGGER:this._clickPressed=!0,this._teleportPressed=!0;break;case v.CIRCULAR_BUTTON:this._scaleValueChange=0;break;case v.MENU:this._menuPressed=!0}else if(this._gamepadType===_)switch(e){case _.TRIGGER_UP:this._clickPressed=!0,this._teleportPressed=!0;break;case _.BY:this._menuPressed=!0}else if(this._gamepadType===b)switch(e){case b.CIRCULAR_BUTTON:this._clickPressed=!0,this._teleportPressed=!0;break;case b.HOME:this._menuPressed=!0;break;case b.CIRCULAR_UP:case b.CIRCULAR_DOWN:this._scaleValueChange=0}else if(this._gamepadType===x)switch(e){case x.CIRCULAR_BUTTON:0!==this._scaleValueChange&&(this._menuPressed=!1,this._pointerClicked=!1,this._teleportPressed=!1),this._pointerClicked=!1,this._scaleValueChange=0}else if(this._gamepadType===S)switch(e){case S.TOUCHPAD_BUTTON:this._pointerClicked=!1}},onButtonDown:function(e){if(this._gamepadType===v)switch(e){case v.CIRCULAR_BUTTON:this.updateScaleChangeFromXAxis(v.SCALE_THRESHOLD)}else if(this._gamepadType===b)switch(e){case b.CIRCULAR_UP:this._scaleValueChange=1;break;case b.CIRCULAR_DOWN:this._scaleValueChange=-1}else if(this._gamepadType===x)switch(e){case x.CIRCULAR_BUTTON:this.updateScaleChangeFromXAxis(x.SCALE_THRESHOLD),this._pointerClicked=0===this._scaleValueChange}else if(this._gamepadType===S)switch(e){case S.TOUCHPAD_BUTTON:this._pointerClicked=!0}},getAndSetActiveController:function(){if(navigator.getGamepads){var e=navigator;try{if(!(e=window.parent.navigator))throw new Error("Host is not defined")}catch(t){e=navigator}var t=e.getGamepads(),i=this._activeController;if(this._activeController=this._getControllerWithPressedButtons(t),this._activeController||(this._hasController(t,i)?this._activeController=i:this._activeController=this._getControllerWithOrientationAndPreferredHand(t)),this._activeController||(this._pressedButtons.length=0),this._activeController&&i!==this._activeController){for(var r=this._pressedButtons.length=this._activeController.buttons.length,n=0;n<r;++n)this._pressedButtons[n]=!1;this._gamepadType=this._getGamepadType(this._activeController),this._updateCorrectionMatrix()}}},_hasController:function(e,t){if(!t)return!1;for(var i=0,r=e.length;i<r;++i)if(e[i]===t)return!0;return!1},_getControllerWithPressedButtons:function(e){for(var t=0,i=e.length;t<i;++t){var r=e[t];if(r){if(!(r.pose&&r.pose.hasOrientation)||r.pose.orientation)for(var n=r.buttons.length,a=0;a<n;++a)if(r.buttons[a].pressed)return r}}},setPreferLeftHand:function(e){this._preferLeftHand!==e&&(this._preferLeftHand=e,this.getAndSetActiveController(),this._updateCorrectionMatrix())},_getControllerWithOrientationAndPreferredHand:function(e){for(var t,i=this._preferLeftHand?"left":"right",r=0,n=e.length;r<n;++r){var a=e[r];if(a){var o=a.pose&&a.pose.hasOrientation;if(!o||a.pose.orientation){if(o&&a.hand===i)return a;!o&&t||(t=a)}}}return t},_getGamepadType:function(e){var t=e&&e.id;if(t)return t=t.toLowerCase(),-1!==t.indexOf("oculus")?-1!==t.indexOf("touch")?_:b:-1!==t.indexOf("daydream")?x:-1!==t.indexOf("vive")||-1!==t.indexOf("openvr")?v:-1!==t.indexOf("gear vr")?S:void 0},applyPoseMatrix:function(){var e=m.quat.create(),t=m.vec3.create(),i=m.mat4.create();return function(r,n,a,o){if(n){var s=a.stageParameters&&a.stageParameters.sittingToStandingTransform,u=n.orientation;n.hasOrientation&&u&&(s&&(u=m.mat4.getRotation(e,s),m.quat.multiply(u,u,n.orientation)),u=m.quat.set(e,u[0],-u[2],u[1],u[3]),m.quat.multiply(u,this._postMultRotate,u),m.mat4.multiply(r,r,m.mat4.fromQuat(i,u)));var l=this._model.get("worldFactor"),c=n.position;if(n.hasPosition&&c)s&&(c=m.vec3.transformMat4(t,c,s)),c=m.vec3.set(t,c[0]*l,-c[2]*l,c[1]*l),m.vec3.transformQuat(c,c,this._postMultRotate),m.vec3.add(c,c,o),m.mat4.setTranslation(r,c);else if(!n.hasPosition){t[0]=.2*l*("left"===a.hand?-1:1),t[1]=.2*l,t[2]=0,m.vec3.transformQuat(t,t,e),t[2]-=.5*l,m.vec3.add(t,t,o),m.mat4.setTranslation(r,t)}}}}(),updatePointerScaleFromHit:function(e){var t=m.mat4.getTranslation(m.vec3.create(),this.getMatrix()),i=m.vec3.dist(t,e);this._hitScaleOffset=i/this._model.get("worldFactor")},resetPointerScale:function(){this._hitScaleOffset=20},isMenuPressed:function(){return this._menuPressedFrame},isTeleportPressed:function(){return this._teleportPressedFrame},isClickPressed:function(){return this._clickPressedFrame},checkScaleChangeValue:function(){return this._scaleValueChange},checkDownloadController:function(){var e=i.i(g.a)().forceController,t=this._gamepadType;if(e)t="daydream"===e?x:"oculus"===e?_:v;else if(!this.isPosedController())return;t===x?this._controllerMeshDisplay!==x&&(this._controllerMeshDisplay=x,s.a.getControllerDaydream(this.replaceControllerMesh.bind(this))):t===_?this._controllerMeshDisplay!==_&&(this._controllerMeshDisplay=_,s.a.getControllerOculusTouch(this.replaceControllerMesh.bind(this))):this._controllerMeshDisplay!==v&&(this._controllerMeshDisplay=v,s.a.getControllerVive(this.replaceControllerMesh.bind(this)))},updateNodeVR:function(){var e=m.vec3.create();return function(t,r,n){var o=this._model.get("worldFactor");this.getAndSetActiveController(),this.checkDownloadController(),this.updatePointerClick(r),this.updateButtonsPressed(),this.updateHoverAxes();var s=this.getMatrix();m.mat4.fromScaling(this._pointerMT.getMatrix(),m.vec3.set(e,.05,this._hitScaleOffset,1)),m.mat4.fromScaling(s,m.vec3.set(e,o,o,o)),i.i(g.a)().forceController?(this.setNodeMask(a.a.NO_PICK),m.mat4.copy(s,this._model.get("humanMatrix")),s[14]+=2*o):this.isPosedController()?(this.setNodeMask(a.a.NO_PICK),this.applyPoseMatrix(s,this._activeController.pose,t,n)):this.setNodeMask(0),this._menuPressedFrame=this._menuPressed,this._clickPressedFrame=this._clickPressed,this._teleportPressedFrame=this._teleportPressed,this._clickPressed=!1,this._menuPressed=!1,this._teleportPressed=!1,this.dirtyBound()}}(),raycastFromController:function(){var e=m.vec3.fromValues(0,20,0);return function(t,i,r,n,o){m.mat4.getTranslation(n,this.getMatrix()),m.vec3.set(o,0,r/this._model.get("worldFactor"),0),m.vec3.transformMat4(o,o,this.getMatrix());var s=i.computeNearestIntersection3DHotspotFirst(n,o,a.a.PICK_GEOMETRY_FAST,t);return s||m.vec3.transformMat4(o,e,this.getMatrix()),s}}()}),"osgSketchfab","Controller"),t.a=y},function(e,t,i){"use strict";var r=i(5),n=i(129),a=i(69),o=i(86),s=i(868),u=i.n(s),l=i(867),c=i.n(l),h=r.a.osg,d=function(){h.MatrixTransform.call(this),this.setName("WebVR - Cursor"),this.setVisible(!0),this._geom=h.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._uAlpha=h.Uniform.createFloat(1,"uAlpha"),this._uColor=h.Uniform.createFloat3(h.vec3.fromValues(.7,.7,.7),"uCursorColor"),this.addChild(this._geom),this.init()};h.createPrototypeNode(d,h.objectInherit(h.MatrixTransform.prototype,{init:function(){var e=h.StateAttribute.OVERRIDE|h.StateAttribute.ON,t=this.getOrCreateStateSet();t.setAttributeAndModes(n.a.createShader(u.a,c.a,"webVR-cursor","VRCursor"),e),t.setRenderBinDetails(o.a.VR_CURSOR,"RenderBin"),t.setAttributeAndModes(new h.BlendFunc(h.BlendFunc.ONE,h.BlendFunc.ONE_MINUS_SRC_ALPHA)),t.addUniform(this._uColor),t.addUniform(this._uAlpha)},setVisible:function(e){this.setNodeMask(e?a.a.NO_PICK:0)},setColor:function(e){h.vec3.copy(this._uColor.getInternalArray(),e)},updateNodeVR:function(){var e=h.vec3.create(),t=h.quat.create();return function(i,r,n,a){var o=this.getMatrix();h.mat4.invert(o,r.getViewMatrix()),h.mat4.fromQuat(o,h.mat4.getRotation(t,o)),h.mat4.scale(o,o,h.vec3.set(e,a,a,a)),h.mat4.setTranslation(o,n),this._uAlpha.setFloat(i),this.dirtyBound()}}()}),"osgSketchfab","Cursor"),t.a=d},function(e,t,i){"use strict";var r=i(5),n=i(129),a=i(92),o=i(86),s=i(90),u=i(402),l=i(298),c=i(139),h=i(870),d=i.n(h),p=i(869),f=i.n(p),g=r.a.osg,m=function(e){g.MatrixTransform.call(this),this._model=e,this._postMultRotate=e._viewer.getViewerOSGJS().getManipulator().getFirstPersonManipulator().getPostMultRotate(),this.setName("WebVR - Floor"),this.setNodeMask(-1),this._cam=new g.Camera,this._cam.setNearFarRatio(5e-5),this._geom=g.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._uScaleToMeter=g.Uniform.createFloat(1,"uScaleToMeter"),this._cam.addChild(this._geom),this.addChild(this._cam),this.init()};g.createPrototypeNode(m,g.objectInherit(g.MatrixTransform.prototype,{init:function(){var e=this.getOrCreateStateSet();e.setAttributeAndModes(n.a.createShader(d.a,f.a,"webVR-floor","VRFloor")),e.addUniform(g.Uniform.createInt(0,"uTextureFloor")),e.setTextureAttributeAndModes(0,l.a.dummyTexture),e.addUniform(this._uScaleToMeter),e.addUniform(g.Uniform.createInt(1,"uTextureDepth")),e.setTextureAttributeAndModes(1,l.a.dummyTexture),e.setRenderBinDetails(o.a.TRANSPARENT_BIN_NO_EARLYZ_PRE,"RenderBin"),e.setAttributeAndModes(new g.Depth(g.Depth.DISABLE)),e.setAttributeAndModes(new g.CullFace(g.CullFace.BACK)),i.i(s.a)()&&this.initTextureFloor()},initTextureFloor:function(){u.a.getBaseVR(this.replaceTextureFloor.bind(this))},replaceTextureFloor:function(e){this.getOrCreateStateSet().setTextureAttributeAndModes(0,a.default.instance.getOrCreateTexture(e.FLOOR).texture)},setVisible:function(e){if(this.setNodeMask(e?-1:0),e&&!this._depthInitialized){var t=this.getOrCreateStateSet(),i=this._model._viewer.getFeatures().postProcess.getCamera()._textureDepth;i&&(t.setTextureAttributeAndModes(1,i),this._depthInitialized=!0)}},updateNodeVR:function(){var e=g.vec3.create(),t=g.vec3.create();return function(){var i=this.getMatrix(),r=c.a.getModelBoxWithDisplacement();r.center(t);var n=15*r.radius();g.mat4.fromQuat(i,this._postMultRotate),g.mat4.scale(i,i,g.vec3.set(e,n,n,n)),i[12]=t[0],i[13]=t[1],i[14]=this._model.get("floorHeight"),this._uScaleToMeter.setFloat(n/this._model.get("worldFactor")),this.dirtyBound()}}()}),"osgSketchfab","Floor"),t.a=m},function(e,t,i){"use strict";var r=i(5),n=i(129),a=i(86),o=i(69),s=i(90),u=i(402),l=i(597),c=i(645),h=i.n(c),d=i(644),p=i.n(d),f=i(872),g=i.n(f),m=i(871),v=i.n(m),_=r.a.osg,b=r.a.osgUtil,x=_.vec3.fromValues(.1,.4,.8),S=_.vec3.fromValues(1,.7,.1),y=_.vec3.fromValues(1,0,0),C=_.vec3.fromValues(0,0,.9),T=function(e){_.MatrixTransform.call(this),this._model=e,this.setMatrix(e.get("humanMatrix")),this.setName("WebVR - Human"),this.setNodeMask(0),this.editMask=b.NodeGizmo.NO_FULL_CIRCLE|b.NodeGizmo.PICK_PLANE_Z|b.NodeGizmo.PICK_ARROW|b.NodeGizmo.PICK_ARC_Z,this._humanMT=new _.MatrixTransform,_.mat4.fromZRotation(this._humanMT.getMatrix(),Math.PI),this._geoHuman=new _.Geometry,this._humanMT.addChild(this._geoHuman),this._uColorCylinder=_.Uniform.createFloat3(_.vec3.copy(_.vec3.create(),x),"uColor"),this._uColorHint=_.Uniform.createFloat3(_.vec3.copy(_.vec3.create(),S),"uColor"),this._hintToFloorMT=new _.MatrixTransform,this._geoHintToFloor=_.createTexturedBoxGeometry(0,0,-.5,.02,.02,1),this._hintToFloorMT.addChild(this._geoHintToFloor),this._hintToFloorMT.setNodeMask(o.a.NO_PICK),this._geoCylinder=b.GizmoGeometry.createCylinderGeometry(1,1,1,50,1,!1,!1),this._geoCylinder.setNodeMask(o.a.NO_PICK);for(var t=0,i=this._geoCylinder.getAttributes().Vertex.getElements(),r=i.length/3;t<r;++t)i[3*t+2]+=.5;this._cylinderMT=new _.MatrixTransform,_.mat4.fromScaling(this._cylinderMT.getMatrix(),_.vec3.fromValues(1,1,.5)),this._cylinderMT.addChild(this._geoCylinder),this.addChild(this._humanMT),this.addChild(this._cylinderMT),this.addChild(this._hintToFloorMT),this._boundingBoxComputed=!0,this._boundingSphereComputed=!0,this.init()};_.createPrototypeNode(T,_.objectInherit(_.MatrixTransform.prototype,{init:function(){this.getOrCreateStateSet().setAttributeAndModes(new _.CullFace(_.CullFace.BACK));var e=this._humanMT.getOrCreateStateSet();e.setShaderGeneratorName("pbr-shadeless"),e.setName("vrHuman");var t=l.a.createMaterialModel(e);t.set("name","NodeHuman"),t.set("hasVertexColor",!0),t.set("vertexColorEnable",!0),t.set("vertexColorColorSpace","linear"),t.trigger("apply"),e.setAttributeAndModes(e.getAttribute("SketchfabMaterial")),i.i(s.a)()&&u.a.getHuman(this.initHumanMesh.bind(this));var r=this._geoHintToFloor.getOrCreateStateSet();r.setAttributeAndModes(n.a.createShader(g.a,v.a,"webVR-hintToFloor","VRHintToFloor")),r.addUniform(this._uColorHint),r.setRenderBinDetails(a.a.TRANSPARENT_BIN_NO_EARLYZ_POST,"RenderBin");var o=this._geoCylinder.getOrCreateStateSet();o.setAttributeAndModes(n.a.createShader(h.a,p.a,"webVR-humanCylinder","VRHumanCylinder")),o.addUniform(this._uColorCylinder),o.addUniform(_.Uniform.createFloat(1,"uAlpha")),o.setRenderBinDetails(a.a.TRANSPARENT_BIN_NO_EARLYZ_POST,"RenderBin")},initHumanMesh:function(e){var t=this._geoHuman;t.getAttributes().Vertex=new _.BufferArray(_.BufferArray.ARRAY_BUFFER,e.VERTEX,3),t.getAttributes().Color=new _.BufferArray(_.BufferArray.ARRAY_BUFFER,e.COLOR,4),t.getPrimitives().push(new _.DrawElements(_.primitiveSet.TRIANGLES,new _.BufferArray(_.BufferArray.ELEMENT_ARRAY_BUFFER,e.TRIANGLES,1))),t.getPrimitives().push(new _.DrawElements(_.primitiveSet.TRIANGLE_STRIP,new _.BufferArray(_.BufferArray.ELEMENT_ARRAY_BUFFER,e.STRIP,1)))},setVisible:function(e){if(this._visible!==e){this._visible=e,this.setNodeMask(e?-1:0);var t=this._model._viewer.getFeaturesManager().getNodeGizmo();e?(t.attachToGeometry(this._humanMT),this._initView()):this._restoreView()}},_initView:function(){var e=_.vec3.create(),t=_.vec3.create(),i=_.vec3.create(),r=_.quat.create(),n=_.vec3.create(),a=_.vec3.create(),o=_.vec3.fromValues(0,0,-1);return function(){var s=this._model._viewer.getFeaturesManager(),u=this._model.get("worldFactor"),l=this._model._viewer.getViewerOSGJS().getManipulator();this._eyePos||(this._eyePos=_.vec3.create(),this._eyeTarget=_.vec3.create()),l.getEyePosition(this._eyePos),l.getTarget(this._eyeTarget),_.mat4.getTranslation(e,this.getMatrix()),_.mat4.getRotation(r,this.getMatrix()),_.vec3.set(t,0,1,0),_.vec3.transformQuat(t,t,r),_.vec3.copy(n,C),_.vec3.scale(n,n,u),_.vec3.add(e,e,n),_.vec3.scale(n,t,-1),_.vec3.normalize(n,n),_.vec3.cross(a,n,o),_.vec3.copy(i,e),_.vec3.scale(n,n,3*u),_.vec3.scale(a,a,.5*u),_.vec3.add(n,n,a),_.vec3.add(i,i,n),s.focusOnTargetAndEye(e,i,1)}}(),_restoreView:function(){if(this._eyePos){this._model._viewer.getFeaturesManager().focusOnTargetAndEye(this._eyeTarget,this._eyePos)}},computeDistanceToFloor:function(){var e=_.vec3.create(),t=_.vec3.create();return function(){var i=this.getMatrix(),r=this._model,n=r._viewer.getFeaturesManager(),a=r.get("worldFactor"),s=r.get("floorHeight");_.mat4.getTranslation(e,i),_.vec3.copy(t,e);var u=.1*a;e[2]+=u,t[2]-=100*a,this.setNodeMask(o.a.NO_PICK);var l=n.computeNearestIntersection3D(e,t,o.a.PICK_GEOMETRY_SLOW);return this.setNodeMask(-1),u=l?_.vec3.dist(n.getWorldPositionFromHit(l,t),e):e[2]-s,Math.max(0,u-.1*a)}}(),updateNodeVR:function(){var e=_.vec3.create();return function(t,i){if(0!==this.getNodeMask()){var r=this.getMatrix(),n=this._model,a=n._viewer.getFeaturesManager(),o=n.get("worldFactor"),s=n.get("floorHeight");_.vec3.lerp(this._uColorHint.getInternalArray(),S,y,.5*Math.sin(10*i)+.5),_.mat4.getScale(e,r),_.vec3.set(e,o/e[0],o/e[1],o/e[2]),_.mat4.scale(r,r,e),r[14]=Math.max(r[14],s);var u=a._nodeGizmo._attachedNode===this||t&&-1!==t._nodePath.indexOf(this._humanMT);_.vec3.copy(this._uColorCylinder.getInternalArray(),u?S:x);var l=this.computeDistanceToFloor()/o,c=l>.05;_.mat4.fromScaling(this._hintToFloorMT.getMatrix(),_.vec3.set(e,1,1,c?l:1e-7)),this._model.set("humanInAir",c),this.dirtyBound()}}}()}),"osgSketchfab","Human"),t.a=T},function(e,t,i){"use strict";var r=i(402),n=i(1123),a=i(466),o=i(519),s=i(5),u=i(92),l=i(631),c=(i.n(l),s.a.osgAnimation),h=s.a.osg,d=c.easeOutCubic,p=function(e){h.Node.call(this),this._menuPanel=new a.a(.9,2.5,o.a.AXIS_BOTH,.2,10,10),this._menuPanel.setUseCache(!0),this._menuPanel.setClickAction("vrHelpButton",this.displayHelp.bind(this)),this._menuPanel.setClickAction("vrExitButton",this.hide.bind(this)),this._menuPanel.setVisible(!1);var t=new n.a(h.vec3.fromValues(0,0,-.05),.15,d,this._menuPanel,e);this._menuPanel.setAnimation(t),this.addChild(this._menuPanel),this._helpPanel=new o.a(2,2,o.a.AXIS_BOTH,.2,10,10),this._helpPanel.setPanelClickAction(this.hideHelp.bind(this)),this._helpPanel.setVisible(!1);var i=new n.a(h.vec3.fromValues(0,0,0),.3,d,this._helpPanel,e);this._helpPanel.setAnimation(i),this.addChild(this._helpPanel),this._model=e};h.createPrototypeNode(p,h.objectInherit(h.Node.prototype,{initialize:function(e){var t=e.hotspot._views[0]._hotspots;this._menuPanel.initialize("skfb_front/macros/vr/vr-menu",{hasHotspotsNavigation:t.length&&t.length>1}),r.a.getBaseVR(function(e){var t=u.default.instance.getOrCreateTexture(e.MENU_HELP).texture;this._helpPanel.initialize(t,{width:1e3,height:500})}.bind(this))},display:function(e,t){this._menuPanel.displayInView(e,t,this._model.get("worldFactor"))},hide:function(){this._menuPanel.setVisible(!1),this._helpPanel.isVisible()&&this._helpPanel.setVisible(!1)},setHomeAction:function(e){this._menuPanel.setClickAction("vrHomeButton",e)},setNextAction:function(e){this._menuPanel.setClickAction("vrNextButton",e)},setPrevAction:function(e){this._menuPanel.setClickAction("vrPrevButton",e)},displayHelp:function(){h.mat4.copy(this._helpPanel.getMatrix(),h.mat4.create()),h.mat4.setTranslation(this._helpPanel.getMatrix(),h.vec3.fromValues(0,0,.2)),h.mat4.multiply(this._helpPanel.getMatrix(),this._menuPanel.getMatrix(),this._helpPanel.getMatrix()),this._helpPanel.setVisible(!0)},hideHelp:function(){this._helpPanel.isVisible()&&this._helpPanel.setVisible(!1)},isVisible:function(){return this._menuPanel.isVisible()},isHelpVisible:function(){return this._helpPanel.isVisible()},updateHit:function(e){return this._helpPanel.isVisible()?this._helpPanel.updateHit(e):this._menuPanel.isVisible()?this._menuPanel.updateHit(e):void 0},click:function(){this._helpPanel.isVisible()?this._helpPanel.click():this._menuPanel.isVisible()&&this._menuPanel.click()}}),"osgSketchfab","Menu"),t.a=p},function(e,t,i){"use strict";var r=i(5),n=i(129),a=i(69),o=i(92),s=i(402),u=i(298),l=i(876),c=i.n(l),h=i(875),d=i.n(h),p=i(645),f=i.n(p),g=i(644),m=i.n(g),v=r.a.osg,_=r.a.osgUtil,b=function(){v.Node.call(this),this.setName("WebVR - Teleport"),this.setVisible(!0),this._interpolatorNormal=new _.DelayInterpolator(3),this._interpolatorNormal.setDelay(.08),this._geoCircle1=v.createTexturedQuadGeometry(-.5,-.5,0,1,0,0,0,1,0),this._geoCircle2=v.createTexturedQuadGeometry(-.5,-.5,.15,1,0,0,0,1,0),this._geoCircle3=v.createTexturedQuadGeometry(-.5,-.5,.15,1,0,0,0,1,0),this._uAlpha1=v.Uniform.createFloat(1,"uAlpha"),this._uAlpha2=v.Uniform.createFloat(1,"uAlpha"),this._uAlpha3=v.Uniform.createFloat(1,"uAlpha"),this._uScale1=v.Uniform.createFloat(1,"uScale"),this._uScale2=v.Uniform.createFloat(.99,"uScale"),this._uScale3=v.Uniform.createFloat(.99,"uScale"),this._geoCylinder=_.GizmoGeometry.createCylinderGeometry(1,1,1,50,1,!1,!1);for(var e=0,t=this._geoCylinder.getAttributes().Vertex.getElements(),i=t.length/3;e<i;++e)t[3*e+2]+=.5;this._cylinderMT=new v.MatrixTransform,v.mat4.fromScaling(this._cylinderMT.getMatrix(),v.vec3.fromValues(.38,.38,.125)),this._cylinderMT.addChild(this._geoCylinder),this._hotspotHintMT=new v.MatrixTransform,this._hotspotHintMT.addChild(this._geoCylinder),this._hotspotHintMT.setNodeMask(0),this._teleportMT=new v.MatrixTransform,this._teleportMT.addChild(this._geoCircle1),this._teleportMT.addChild(this._geoCircle2),this._teleportMT.addChild(this._geoCircle3),this._teleportMT.addChild(this._cylinderMT),this.addChild(this._teleportMT),this.addChild(this._hotspotHintMT),this.init()};v.createPrototypeNode(b,v.objectInherit(v.Node.prototype,{init:function(){var e=this.getOrCreateStateSet();e.setAttributeAndModes(n.a.createShader(c.a,d.a,"webVR-teleportCircle","VRTeleportCircle")),e.addUniform(v.Uniform.createInt(0,"uTextureTeleportCircle")),e.setTextureAttributeAndModes(0,u.a.dummyTexture),this._geoCircle1.getOrCreateStateSet().addUniform(this._uScale1),this._geoCircle2.getOrCreateStateSet().addUniform(this._uScale2),this._geoCircle3.getOrCreateStateSet().addUniform(this._uScale3),this._geoCircle1.getOrCreateStateSet().addUniform(this._uAlpha1),this._geoCircle2.getOrCreateStateSet().addUniform(this._uAlpha2),this._geoCircle3.getOrCreateStateSet().addUniform(this._uAlpha3);var t=this._cylinderMT.getOrCreateStateSet();t.addUniform(v.Uniform.createFloat3(v.vec3.fromValues(.7,.7,.3),"uColor")),t.addUniform(this._uAlpha1);var i=this._hotspotHintMT.getOrCreateStateSet();i.addUniform(v.Uniform.createFloat3(v.vec3.fromValues(.1,.66,.85),"uColor")),i.addUniform(this._uAlpha1),this._geoCylinder.getOrCreateStateSet().setAttributeAndModes(n.a.createShader(f.a,m.a,"webVR-teleportCylinder","VRTeleportCylinder"))},initTextureTeleport:function(){s.a.getBaseVR(this.replaceTextureTeleport.bind(this))},replaceTextureTeleport:function(e){this.getOrCreateStateSet().setTextureAttributeAndModes(0,o.default.instance.getOrCreateTexture(e.TELEPORT_CIRCLE).texture)},setVisible:function(e){this.setNodeMask(e?a.a.NO_PICK:0)},setHotspotHint:function(){var e=v.vec3.create(),t=v.vec3.fromValues(0,0,1),i=v.quat.create();return function(r,n,a,o){if(this._hotspotHintMT.setNodeMask(r?-1:0),n){v.vec3.sub(e,a,n);var s=v.vec3.len(e);v.vec3.normalize(e,e),v.quat.rotationTo(i,t,e);var u=this._hotspotHintMT.getMatrix();v.mat4.fromQuat(u,i);v.mat4.scale(u,u,v.vec3.set(e,.02*o,.02*o,s)),v.mat4.setTranslation(u,n)}}}(),updateWorldNormal:function(e,t){this._interpolatorNormal.setTarget(t[0],t[1],t[2]),this._interpolatorNormal.update(e.getDeltaTime()),v.vec3.normalize(t,this._interpolatorNormal.getCurrent())},updateNodeVR:function(){var e=v.vec3.fromValues(0,0,1),t=v.vec3.create();return function(i,r,n,o,s,u,l){var c=this._teleportMT.getMatrix();if(this.getNodeMask()){var h=Math.acos(v.vec3.dot(e,l));v.vec3.cross(t,l,e),v.mat4.fromRotation(c,-h,t);var d=Math.min(Math.max(s,u),50*u);v.mat4.scale(c,c,v.vec3.set(t,d,d,d)),v.vec3.set(t,o[0],o[1],o[2]+.05*s),v.mat4.setTranslation(c,t),this.setNodeMask(a.a.NO_PICK)}var p=n.getSimulationTime(),f=p%.99,g=(p+.2)%.99;this._uScale2.setFloat(f),this._uScale3.setFloat(g),this._uAlpha1.setFloat(i),this._uAlpha2.setFloat(i*(1-f*f)),this._uAlpha3.setFloat(i*(1-g*g)),this._teleportMT.dirtyBound()}}()}),"osgSketchfab","Teleport"),t.a=b},function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=function(){n.ComputeBoundsVisitor.call(this),this._minBox=new n.BoundingBox,this._visitedBuffers={}};n.createPrototypeObject(a,n.objectInherit(n.ComputeBoundsVisitor.prototype,{getPreciseBox:function(){return this._minBox},apply:function(e){if(e instanceof n.Transform)return void this.applyTransform(e);if(e instanceof n.Geometry){var t=this._matrixStack.length,i=t>0?this._matrixStack[t-1]:n.mat4.IDENTITY,r=e.getVertexAttributeList().Vertex,a=this._visitedBuffers[r.getInstanceID()];if(a&&n.mat4.exactEquals(a.matrix,i))return;var o=e.computeTransformedVertices?e.computeTransformedVertices():r.getElements();this._visitedBuffers[r.getInstanceID()]={buffer:o,matrix:n.mat4.copy(n.mat4.create(),i)};for(var s=i[0],u=i[1],l=i[2],c=i[3],h=i[4],d=i[5],p=i[6],f=i[7],g=i[8],m=i[9],v=i[10],_=i[11],b=i[12],x=i[13],S=i[14],y=i[15],C=1/0,T=1/0,M=1/0,w=-1/0,A=-1/0,E=-1/0,P=0,N=o.length;P<N;P+=3){var F=o[P],R=o[P+1],I=o[P+2],O=c*F+f*R+_*I+y||1,L=(s*F+h*R+g*I+b)/O,D=(u*F+d*R+m*I+x)/O,k=(l*F+p*R+v*I+S)/O;L<C&&(C=L),D<T&&(T=D),k<M&&(M=k),L>w&&(w=L),D>A&&(A=D),k>E&&(E=k)}var B=this._minBox.getMin(),V=this._minBox.getMax();return C<B[0]&&(B[0]=C),T<B[1]&&(B[1]=T),M<B[2]&&(B[2]=M),w>V[0]&&(V[0]=w),A>V[1]&&(V[1]=A),void(E>V[2]&&(V[2]=E))}this.traverse(e)}})),t.a=a},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(5)),a=i(4),o=i(46),s=i(511),u=i(53),l=i(604),c=i(86),h=i(69),d=i(90),p=i(31),f=i(419),g=i.n(f),m=i(730),v=i(70),_=i.n(v),b=i(1112),x=i(1114),S=i(1110),y=i(1111),C=i(1109),T=i(1113),M=n.a.osg,w=n.a.osgUtil,A=new g.a({device:"VWR",listen:!0}),E=a.a.extend({initialize:function(){a.a.prototype.initialize.apply(this,arguments);var e=this.model;e.bind("change:enable",this.onEnable,this),e.bind("change:worldFactor",this.onWorldFactor,this),e.bind("change:floorHeight",this.onFloorHeight,this),e.bind("doubleTap",this.onDoubleTap,this),e.bind("snapHumanOnFloor",this.snapHumanOnFloor,this),this._standaloneViewer=!i.i(p.a)().messaging,A.on("message:requestPresent",this.onRequestPresent,this),this._viewer=this.options.context.getViewer(),this._viewerOSGJS=this._viewer.getViewerOSGJS(),this._manipulator=this._viewerOSGJS.getManipulator(),this._cullConfig=s.a.vrConfig,this._lastSelectedHotspot=void 0,this._lastHoveredHotspot=void 0,this._lastFloorHeight=0,this._lastTime=0,this._lastWorldFactor=-1,this._lastMouse=M.vec2.create(),this._interpolatorAlpha=new w.DelayInterpolator(1),this._interpolatorAlpha.setDelay(.1),this._webvrMaxHeight=this.getWebVRMaxHeight(),this._nodeWebVR=new M.Node,this._nodeWebVR.setName("Feature - WebVR"),this._proxyVR=new M.Node,this._proxyVR.setName("WebVR - Proxy"),this._proxyVR.setNodeMask(0),this._floorMT=new y.a(e),this._humanMT=new b.a(e),this._teleportNode=new x.a,this._cursorMT=new S.a,this._controllerMT=new C.a(e,this._viewer.getCanvas()),this._nodeMenu=new T.a(e),this._nodeMenu.setHomeAction(this._exitVR.bind(this)),this._nodeMenu.setNextAction(this.goToNextHotspot.bind(this)),this._nodeMenu.setPrevAction(this.goToPrevHotspot.bind(this)),this._dataDownloaded=!1,this._scaleControlEnabled=!0,this._frameData=void 0,this.onFloorHeight(),this.initGraphNodes(),this.hookComputeCanvasSize();var t=this._viewer.getCanvas();window.addEventListener("keydown",this.onKeyDown.bind(this)),i.i(d.a)()&&t.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("vrdisplayactivate",function(){o.a.getModelDisplayed().isFulfilled()?this.model.onVrDisplayReady(this.model.set.bind(this.model,"enable",!0)):o.a.getModelDisplayed().then(function(){this.model.onVrDisplayReady(this.model.set.bind(this.model,"enable",!0))}),this.getConfigWebVR().isPresenting||this._viewerOSGJS.setPresentVR(!0).then(this.notifyPresentVR.bind(this))}.bind(this)),window.addEventListener("vrdisplaydeactivate",function(){this._standaloneViewer&&!this.model.get("modeLauncher")&&this.model.onVrDisplayReady(this.model.set.bind(this.model,"enable",!1))}.bind(this)),window.addEventListener("vrdisplaypresentchange",function(e){e.display.isPresenting||!this._standaloneViewer||this.model.get("modeLauncher")||this.model.onVrDisplayReady(this.model.set.bind(this.model,"enable",!1))}.bind(this)),o.a.getModelDisplayed().then(this.initWebVR.bind(this))},getNodeWebVR:function(){return this._nodeWebVR},getProxyWebVR:function(){return this._proxyVR},getWebVRMaxHeight:function(){return _.a.any?Math.min(window.screen.width,window.screen.height)*Math.min(2.5,window.devicePixelRatio):-1},onRequestPresent:function(e){this._standaloneViewer?M.log("Launcher onRequestPresent"):M.log("Viewer onRequestPresent"),this.startEnable(!0,!0),e.removeFromHash()},initWebVR:function(){this._nodeWebVR.addUpdateCallback(this)},setProxyVisible:function(e){this._proxyVR.setNodeMask(e?h.a.NO_SHADOW:0)},onDoubleTap:function(e){if(!this.model.get("enable")&&-1===e._nodePath.indexOf(this._humanMT)){var t=this._viewer.getFeaturesManager(),i=M.vec3.create();t.getWorldPositionFromHit(e,i),M.mat4.setTranslation(this._humanMT.getMatrix(),i),u.a.draw()}},onKeyDown:function(e){var t=this.model.get("worldFactor");if(!(t<=0)){var i=1;if(79===e.which)i=1.2;else{if(80!==e.which)return;i=1/1.2}this.model.set("worldFactor",t*i)}},onMouseMove:function(e){this._lastMouse[0]=void 0===e.offsetX?e.layerX:e.offsetX,this._lastMouse[1]=void 0===e.offsetY?e.layerY:e.offsetY},onFloorHeight:function(){var e=this.model.get("floorHeight"),t=.05*this.model.get("worldFactor");Math.abs(this._humanMT.getMatrix()[14]-this._lastFloorHeight)<=t&&(this._humanMT.getMatrix()[14]=e),this._floorMT.getMatrix()[14]=e,this._lastFloorHeight=e},initGraphNodes:function(){this._nodeWebVR.addChild(this._proxyVR),this._proxyVR.addChild(this._floorMT),this._proxyVR.addChild(this._humanMT),this._proxyVR.addChild(this._teleportNode),this._proxyVR.addChild(this._cursorMT),this._proxyVR.addChild(this._controllerMT),this._proxyVR.addChild(this._nodeMenu);var e=this._proxyVR.getOrCreateStateSet();e.setRenderBinDetails(c.a.TRANSPARENT_BIN_NO_EARLYZ_POST,"RenderBin"),e.setAttributeAndModes(new M.Depth(M.Depth.LESS,0,1,!1)),e.setAttributeAndModes(new M.CullFace(M.CullFace.DISABLE))},resetCameraToHuman:function(){var e=M.vec3.create(),t=M.vec3.create(),i=M.mat4.create(),r=M.vec3.create();return function(){var n=this.getConfigWebVR(),a=n.capabilities.hasPosition&&n.stageParameters,o=M.mat4.copy(i,this._humanMT.getMatrix());M.mat4.getScale(e,o),M.vec3.set(e,1/e[0],1/e[1],1/e[2]),M.mat4.scale(o,o,e);var s=this._manipulator.getFirstPersonManipulator(),u=s.getPostMultRotate();M.quat.normalize(u,M.mat4.getRotation(u,o)),n.displayName.toLowerCase().indexOf("oculus")>=0?(this._cb&&window.removeEventListener("vrdisplayactivate",this._cb),this._cb=this._cb||function(){s.setResetInitialRotationVR(!0),window.removeEventListener("vrdisplayactivate",this._cb)}.bind(this),window.addEventListener("vrdisplayactivate",this._cb)):s.setResetInitialRotationVR(!0),M.mat4.getTranslation(t,o),a&&M.mat4.equals(M.mat4.IDENTITY,a.sittingToStandingTransform)&&this.handleBuggyStandingTransform(n,3),t[2]+=this.getEyeLevel(),M.vec3.set(r,0,1,0),M.vec3.transformQuat(r,r,u),M.vec3.add(r,t,r),this._viewer.getFeaturesManager().focusOnTargetAndEye(r,t)}}(),requestData:function(e,t){var i=this.model.get("modeLauncher");!e||i||this._dataDownloaded||(this._dataDownloaded=!0,this._teleportNode.initTextureTeleport(),this._floorMT.initTextureFloor(),this._nodeMenu.initialize(t))},notifyPresentVR:function(){var e=this.model.get("enable"),t=this.model.get("modeLauncher");t&&(this._scaleControlEnabled=!1);var i;this._standaloneViewer?!e&&t&&(M.log("Launcher sending requestPresent"),i=A.createMessage({data:"requestPresent"}),i.appendToHash(),M.log("Launcher sent requestPresent")):(M.log("Viewer enable after Promise"+e),e||(M.log("Viewer SendingExit"),i=A.createMessage({data:"exit"}),i.appendToHash(),M.log("Viewer SentExit")))},_exitVR:function(){if(i.i(p.a)().isApp){A.createMessage({data:"exit"}).appendToHash()}else this.model.set("enable",!1)},startEnable:function(e,t){var r=this._viewer.getFeatures();this.setProxyVisible(e),this.requestData(e,r),this.updateDistortion(),r.background.getModel().set("webVR",e&&!i.i(p.a)().vrAr),r.camera.getModel().set("webVR",e),r.hotspot.getModel().set("webVR",e),r.shadingStyle.getModel().set("webVR",e),r.lighting.getModel().set("webVR",e),r.postProcess.getModel().set("webVR",e),i.i(p.a)().vrStereo?this._cullConfig.doVR=e:this._cullConfig.doVR=!1,this._controllerMT.setListenToEvents(e),e?(this._floorMT.updateNodeVR(),this.resetCameraToHuman()):this._viewer.getFeaturesManager().focusOnHomePosition(),this._standaloneViewer?M.log("Launcher StartEnable: enabled:"+e+" doPresentVR: "+t):M.log("Viewer StartEnable: enabled:"+e+" doPresentVR: "+t);var n=this.getConfigWebVR();e&&!t||n.isPresenting===e||(this.model.get("hasNativeHMD")?this._viewerOSGJS.setPresentVR(e).then(this.notifyPresentVR.bind(this),this.notifyPresentVR.bind(this)):(n.isPresenting=e,this.notifyPresentVR()));var a=e&&!i.i(p.a)().vrAr?1:0;this._viewer.getCamera().getClearColor()[3]=a},onEnable:function(){var e=this.model.get("enable");this.startEnable(e,this._standaloneViewer)},handleBuggyStandingTransform:function(e,t){0!==t&&(M.warn("VR: Handling buggy standing transform Vive"),navigator.getVRDisplays().then(function(i){for(var r=0;r<i.length;++r)if(i[r].displayName===e.displayName){e=i[r];break}var n=e.capabilities.hasPosition&&e.stageParameters;if(n&&M.mat4.equals(M.mat4.IDENTITY,n.sittingToStandingTransform))return void setTimeout(this.handleBuggyStandingTransform.bind(this,e,--t),5e3)}.bind(this)))},updateDistortion:function(){if(!this.model.get("hasNativeHMD")&&!i.i(p.a)().vrAr){var e=this._viewer.getFeatures().postProcess.getModel();e.set("doDistortionVR",!0);var t=this.model.get("deviceInfo"),r=t.getProjectionMatrixLeftEye(),n=t.getProjectionMatrixLeftEye(!0),a=t.getUndistortedViewportLeftEye(),o=t.device,s={xScale:a.width/(o.width/2),yScale:a.height/o.height,xTrans:2*(a.x+a.width/2)/(o.width/2)-1,yTrans:2*(a.y+a.height/2)/o.height-1};e.set("distortion",t.viewer.distortionCoefficients),e.set("projectionLeft",l.a.projectionMatrixToVector_(r)),e.set("unprojectionLeft",l.a.projectionMatrixToVector_(n,s))}},snapHumanOnFloor:function(){this._humanMT.getMatrix()[14]-=this._humanMT.computeDistanceToFloor()},getEyeLevel:function(){var e=this.getConfigWebVR();return e.capabilities.hasPosition&&e.stageParameters?this.getPosVR()[2]:1.65*this.model.get("worldFactor")},snapOnFloor:function(){var e=this.model.get("worldFactor"),t=this._manipulator.getEyePosition(M.vec3.create()),i=M.vec3.copy(M.vec3.create(),t);i[2]-=5*e;var r=this._viewer.getFeaturesManager(),n=r.computeNearestIntersection3D(t,i,h.a.PICK_GEOMETRY_FAST,this._nodeWebVR);if(n){var a=M.vec3.create();r.getWorldPositionFromHit(n,a),a[2]+=this.getEyeLevel(),r.focusOnTargetAndEye(void 0,a)}},onWorldFactor:function(){var e=M.vec3.create();return function(){var t=this.model.get("worldFactor");this._lastWorldFactor>0&&this._lastWorldFactor!==t&&(M.vec3.scale(this.getPosVR(),this.getPosVR(),t/this._lastWorldFactor),this.model.get("enable")&&this.snapOnFloor()),this._lastWorldFactor=t;var r=this.getConfigWebVR(),n=this._cullConfig,a=r.getEyeParameters("left"),o=r.getEyeParameters("right"),s=r.getFrameData(this._frameData),l=1;i.i(p.a)().vrScaleRTT>0?l=i.i(p.a)().vrScaleRTT:this._webvrMaxHeight>0&&(l=Math.min(1,this._webvrMaxHeight/(a.renderHeight||512))),n.leftRenderWidth=Math.floor(a.renderWidth*l)||512,n.leftRenderHeight=Math.floor(a.renderHeight*l)||512,n.rightRenderWidth=Math.floor(o.renderWidth*l)||512,n.rightRenderHeight=Math.floor(o.renderHeight*l)||512,s&&(M.mat4.copy(n.leftProjection,this._frameData.leftProjectionMatrix),M.mat4.copy(n.rightProjection,this._frameData.rightProjectionMatrix)),M.mat4.fromTranslation(n.leftOffsetView,M.vec3.set(e,-t*a.offset[0],-t*a.offset[1],-t*a.offset[2])),M.mat4.fromTranslation(n.rightOffsetView,M.vec3.set(e,-t*o.offset[0],-t*o.offset[1],-t*o.offset[2])),this._viewerOSGJS.getEventProxy().WebVR.setWorldScale(t),u.a.draw()}}(),perspectiveMatrixFromVRFieldOfView:function(e,t,i,r){var n=r||M.mat4.create(),a=Math.PI/180,o=Math.tan(e.upDegrees*a)*t,s=Math.tan(e.downDegrees*a)*t,u=Math.tan(e.leftDegrees*a)*t,l=Math.tan(e.rightDegrees*a)*t;return M.mat4.frustum(n,-u,l,-s,o,t,i),n},hookComputeCanvasSize:function(){var e=this._viewerOSGJS,t=e.computeCanvasSize,i=this,r=this._cullConfig;e.computeCanvasSize=function(n){var a=i.model.get("enable");if(!a)return t.call(e,n);i.model.get("hasNativeHMD")&&i.onWorldFactor();var o=Math.floor(r.leftRenderWidth+r.rightRenderWidth),s=Math.floor(Math.max(r.leftRenderHeight,r.rightRenderHeight)),u=Math.max(o,s);if(!a&&u>4096){var l=4096/u;o=Math.floor(o*l),s=Math.floor(s*l)}var c=!1;return this._canvasWidth!==o&&(n.width=o,this._canvasWidth=o,c=!0),this._canvasHeight!==s&&(n.height=s,this._canvasHeight=s,c=!0),c}},getConfigWebVR:function(){var e=this._viewerOSGJS,t=e.getVRDisplay();if(t)return this._frameData instanceof window.VRFrameData==!1&&(this._frameData=new window.VRFrameData),t;if(this._defaultHMD)return this._defaultHMD;var i=this.model.get("deviceInfo"),r=.5*i.viewer.interLensDistance,n=i.getUndistortedViewportLeftEye();this._frameData={leftProjectionMatrix:this.perspectiveMatrixFromVRFieldOfView(i.getFieldOfViewLeftEye(!1),.1,1e3,M.mat4.create()),rightProjectionMatrix:this.perspectiveMatrixFromVRFieldOfView(i.getFieldOfViewRightEye(!1),.1,1e3,M.mat4.create())};var a={left:{offset:M.vec3.fromValues(-r,0,0),renderWidth:n.width,renderHeight:n.height},right:{offset:M.vec3.fromValues(r,0,0),renderWidth:n.width,renderHeight:n.height}};return this._defaultHMD={displayName:"fake-cardboard",isPresenting:!1,getFrameData:function(e){return e},getEyeParameters:function(e){return a[e]},capabilities:{hasPosition:!1,hasRotation:!1,hasExternalDisplay:!1}},this._defaultHMD},getPosVR:function(){var e=M.vec3.create();return function(){return this._manipulator.getCurrentManipulator()._vrPos||M.vec3.set(e,0,0,0)}}(),getTeleportPosFromHotspot:function(){var e=M.vec3.create(),t=M.vec3.create(),i=M.vec3.create(),r=M.vec3.create();return function(n,a,o,s){var u=this._viewer.getFeaturesManager(),l=this.model.get("worldFactor");u.getWorldPositionFromScenePoint(M.mat4.getTranslation(e,n.getHotspotMatrix()),t);var c=2.5*l;M.vec3.sub(e,t,a);var d=M.vec3.length(e);e[2]=0,M.vec3.normalize(e,e),M.vec3.scale(e,e,c),M.vec3.sub(i,t,e),i[2]=t[2]+l,d<c+.1*c&&M.vec3.copy(i,a),M.vec3.copy(r,i),r[2]-=3.5*l;var p=u.computeNearestIntersection3D(i,r,h.a.PICK_GEOMETRY_FAST,this._nodeWebVR);p?(u.getWorldPositionFromHit(p,o,s),p.backface&&M.vec3.negate(s,s)):(M.vec3.copy(o,i),o[2]-=this.getEyeLevel(),M.vec3.set(s,0,0,1)),this._teleportNode.setHotspotHint(n.canTeleport(),o,t,l),n.setWorldTeleportPosition(t,o,l)}}(),updateHitHotspot:function(){var e=function(e){return e instanceof m.a};return function(t,n,a,o,s){var u=this._viewer.getFeatures().hotspot.getWidgetNode(),l=t&&-1!==t._nodePath.indexOf(u);if(this._lastHoveredHotspot&&this._lastHoveredHotspot.setHovered(!1),!l)return this._lastHoveredHotspot&&this._lastHoveredHotspot.updateCardHit(),this._lastHoveredHotspot=void 0,void this._teleportNode.setHotspotHint(!1);var c=this._lastHoveredHotspot=i.i(r.find)(t._nodePath,e);return c.updateCardHit(t),c.setHovered(!0),c.isFullyVisibleCard()?c:(this.getTeleportPosFromHotspot(c,n,o,s),this._viewer.getFeatures().hotspot.getModel().set("currentHotspotIndex",c.getIndex()),c)}}(),handleHitPicking:function(e,t,i,r,n,a,o){var s,u=this._viewer.getFeaturesManager(),l=this.model.get("worldFactor"),c=this._floorMT.getBoundingSphere(),d=M.vec3.dist(c.center(),t)+c.radius();return e?s=u.computeNearestIntersection2D(this._lastMouse[0],this._lastMouse[1],h.a.PICK_GEOMETRY_FAST):this._controllerMT.isPosedController()?(s=this._controllerMT.raycastFromController(this._nodeWebVR,u,d,a,o),s?(u.getWorldPositionFromHit(s,r,n),s._backface&&M.vec3.negate(n,n),this._controllerMT.updatePointerScaleFromHit(r),this._cursorMT.setColor(M.vec3.fromValues(.1,.66,.85))):(this._controllerMT.resetPointerScale(),M.vec3.copy(r,o))):(M.vec3.copy(a,t),M.vec3.copy(o,i),M.vec3.scale(o,i,d),M.vec3.add(o,a,o),s=u.computeNearestIntersection3DHotspotFirst(a,o,h.a.PICK_GEOMETRY_FAST,this._nodeWebVR),s?(u.getWorldPositionFromHit(s,r,n),s._backface&&M.vec3.negate(n,n)):(M.vec3.scale(r,i,3*l),M.vec3.add(r,t,r))),s},goToNextHotspot:function(){this._viewer.getFeatures().postProcess.getModel().fadeForTeleportVR(this.doTeleportToHotspot.bind(this,1))},doTeleportToHotspot:function(e){this._nodeMenu&&this._nodeMenu.isVisible()&&this._nodeMenu.hide();var t=this.computeHotspotIndex(e);-1!==t&&(this.moveToHotspotWithIndex(t),this.displayHotspotCardForIndex(t))},goToPrevHotspot:function(){this._viewer.getFeatures().postProcess.getModel().fadeForTeleportVR(this.doTeleportToHotspot.bind(this,-1))},displayHotspotCardForIndex:function(e){var t=this._viewer.getFeatures().hotspot.getWidgetNode().children[e];this.toggleHotspotCard(t)},computeHotspotIndex:function(e){var t=this._viewer.getFeatures().hotspot.getModel(),i=t.get("hotspots");if(0===i.length)return-1;if(1!==e&&-1!==e)return console.error("computeHotspotIndex was called with an invalid direction argument. Valid values are 1 for foward -1 for backward."),0;var r=t.get("currentHotspotIndex"),n=i.length;return r+=e,r<0&&(r=-1),r=(r%n+n)%n,t.set("currentHotspotIndex",r),r},moveToHotspotWithIndex:function(){var e=M.vec3.create(),t=M.vec3.create(),i=M.vec3.create();return function(r){var n=this._viewer.getFeaturesManager(),a=this._viewer.getFeatures().hotspot.getWidgetNode(),o=a.children[r],s=this._viewer.getFeatures().hotspot.getModel().get("hotspots").at(r);n.getWorldPositionFromScenePoint(s.get("eye"),t),n.getWorldPositionFromScenePoint(s.get("position"),e),this.getTeleportPosFromHotspot(o,t,t,i),t[2]+=this.getEyeLevel(),this._manipulator.getFirstPersonManipulator().setInitialPoseVR(t,e)}}(),doTeleport:function(e,t,i){var r=this._viewer.getFeaturesManager();e[2]+=this.getEyeLevel(),t[2]+=this.getEyeLevel(),r.focusOnTargetAndEye(t,e),this.toggleHotspotCard(i)},toggleHotspotCard:function(e){e&&(e.isFullyVisibleCard()?e.onCardHit(this):(this._lastSelectedHotspot&&this._lastSelectedHotspot.setVisibleCard(!1),this._lastSelectedHotspot=e,e&&e.setVisibleCard(!0)))},setPauseUpdate:function(e){this._pauseUpdate=e},update:function(){var e=M.vec3.create(),t=M.vec3.create(),r=M.vec3.create(),n=M.vec3.create(),a=M.vec3.create(),o=M.vec3.create(),s=M.vec3.create(),l=M.vec3.create(),c=M.vec3.create(),h=M.vec3.create();return function(d,f){var g=this._viewer.getFeatures(),m=this.model.get("enable"),v=this.model.get("modeLauncher"),_=this._viewer.getOptions().widgetAPI,b=!!_&&"virtual reality"===_.getTabbedWidget().get()&&!this._pauseUpdate,x=m||b;this.setProxyVisible(x);var S=g.background.getModel();S.get("webVR")!==x&&S.set("webVR",x);var y=g.postProcess.getModel();if(y.get("webVR")!==x&&y.set("webVR",x),this._humanMT.setVisible(b),!m&&!b)return!0;var C=this.model.get("worldFactor"),T=f.getFrameStamp(),w=T.getSimulationTime(),A=T.getDeltaTime(),E=this.getConfigWebVR();this._manipulator.getEyePosition(r),this._manipulator.getTarget(n),M.vec3.sub(n,n,r),M.vec3.normalize(n,n);var P=this._viewer.getCamera(),N=.02*this._viewerOSGJS.getCanvasClientWidth()*M.mat4.getScale(l,this._cullConfig.leftProjection)[0];this._controllerMT.updateNodeVR(E,A,M.vec3.sub(l,r,this.getPosVR()));var F=this.handleHitPicking(!m&&b,r,n,t,e,a,o);this.model.set("hit",F),M.vec3.copy(s,t);var R=m&&!v&&this._controllerMT.isTeleportPressed(),I=!v&&this._controllerMT.isClickPressed(),O=this._nodeMenu&&this._controllerMT.isMenuPressed(this._nodeMenu.isVisible()),L=F&&-1===F._nodePath.indexOf(this._nodeMenu)&&(R||I)&&this._nodeMenu.isVisible(),D=m&&(O||L);D&&(this._manipulator.getTarget(l),this._nodeMenu.isVisible()?this._nodeMenu.hide():this._nodeMenu.display(r,l));var k,B;if(m&&!v){B=this._nodeMenu.updateHit(F),k=this.updateHitHotspot(F,a,o,s,e),this._teleportNode.updateWorldNormal(T,e);var V=F&&e[2]>.5,U=k?k.canTeleport():V,G=F&&-1!==F._nodePath.indexOf(this._floorMT),z=k?k.canTeleport():V&&(!this.model.isDiorama()||G);if(R&&w-this._lastTime>.5){if(U){M.vec3.add(h,s,n),M.vec3.copy(c,s);this._viewer.getFeatures().postProcess.getModel().fadeForTeleportVR(this.doTeleport.bind(this,c,h,k)),this._lastTime=w}U||this.toggleHotspotCard(k),B&&B.click()}this._interpolatorAlpha.setTarget(z?1:0),this._interpolatorAlpha.update(T.getDeltaTime())}var j=M.vec3.dist(t,r)/N,H=D?0:this._interpolatorAlpha.getCurrent()[0];this._cursorMT.setVisible(m),this._teleportNode.setVisible(F&&!v&&m&&!O),this._floorMT.setVisible(!v&&!i.i(p.a)().vrAr),this._floorMT.updateNodeVR(),this._humanMT.updateNodeVR(F,w),this._teleportNode.updateNodeVR(H,F,T,s,C,j,e),this._cursorMT.updateNodeVR(v||k?1:1-H,P,t,j),this._nodeMenu&&this._lastSelectedHotspot&&this._nodeMenu.isVisible()&&this._lastSelectedHotspot.isFullyVisibleCard()&&this._lastSelectedHotspot.setVisibleCard(!1);var W=this._controllerMT.checkScaleChangeValue();return this._scaleControlEnabled&&0!==W&&(W=C*Math.abs(W)*(W>0?1.02:1/1.02),this.model.set("worldFactor",W)),u.a.draw(),!0}}()});t.a=E},function(e,t,i){"use strict";var r=i(89),n=i(1108),a=i(1116),o={FeatureName:"webVR",ModelType:n.a,ViewListType:[a.a]},s=r.a.create(o);s.prototype.getNode=function(){return this._views[0].getNodeWebVR()},s.prototype.getWidgetNode=function(){return this._views[0].getProxyWebVR()},s.prototype.prepareForScreenShot=function(){var e=r.a.prototype.prepareForScreenShot.call(this);return e&&this._views[0].setPauseUpdate(!0),e},s.prototype.resetAfterScreenShot=function(){r.a.prototype.resetAfterScreenShot.call(this),this._views[0].setPauseUpdate(!1)},t.a=s},function(e,t,i){"use strict";function r(e){this.viewer=f.CardboardV1,this.updateDeviceParams(e)}var n=i(5),a=i(1119),o=i(604),s=n.a.osg,u=180/Math.PI,l=Math.PI/180,c=function(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients},h=function(e){this.width=e.width||o.a.getScreenWidth(),this.height=e.height||o.a.getScreenHeight(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters},d=new h({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),p=new h({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),f={CardboardV1:new c({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new c({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-16981803e-13]})};r.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},r.prototype.getDevice=function(){return this.device},r.prototype.setViewer=function(e){this.viewer=e},r.prototype.determineDevice_=function(e){if(!e)return o.a.isIOS()?p:d;var t=.0254/e.xdpi,i=.0254/e.ydpi,r=o.a.getScreenWidth(),n=o.a.getScreenHeight();return new h({widthMeters:t*r,heightMeters:i*n,bevelMeters:.001*e.bevelMm})},r.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,t=this.device,i=new a.a(e.distortionCoefficients),r=e.screenLensDistance,n=(t.widthMeters-e.interLensDistance)/2,o=e.interLensDistance/2,s=e.baselineLensDistance-t.bevelMeters,l=t.heightMeters-s,c=u*Math.atan(i.distort(n/r)),h=u*Math.atan(i.distort(o/r)),d=u*Math.atan(i.distort(s/r)),p=u*Math.atan(i.distort(l/r));return{leftDegrees:Math.min(c,e.fov),rightDegrees:Math.min(h,e.fov),downDegrees:Math.min(d,e.fov),upDegrees:Math.min(p,e.fov)}},r.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},r.prototype.getFieldOfViewRightEye=function(e){var t=this.getFieldOfViewLeftEye(e);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,downDegrees:t.downDegrees}},r.prototype.getProjectionMatrixLeftEye=function(e){var t=this.getFieldOfViewLeftEye(e),i=s.mat4.create(),r=.1*Math.tan(l*t.leftDegrees),n=.1*Math.tan(l*t.rightDegrees),a=.1*Math.tan(l*t.downDegrees),o=.1*Math.tan(l*t.upDegrees);return s.mat4.frustum(i,-r,n,-a,o,.1,1e3),i},r.prototype.getUndistortedViewportLeftEye=function(){var e=this.getUndistortedParams_(),t=this.viewer,i=this.device,r=t.screenLensDistance,n=i.widthMeters/r,a=i.heightMeters/r,o=i.width/n,s=i.height/a,u=Math.round((e.eyePosX-e.outerDist)*o),l=Math.round((e.eyePosY-e.bottomDist)*s);return{x:u,y:l,width:Math.round((e.eyePosX+e.innerDist)*o)-u,height:Math.round((e.eyePosY+e.topDist)*s)-l}},r.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:u*Math.atan(e.outerDist),rightDegrees:u*Math.atan(e.innerDist),downDegrees:u*Math.atan(e.bottomDist),upDegrees:u*Math.atan(e.topDist)}},r.prototype.getUndistortedParams_=function(){var e=this.viewer,t=this.device,i=new a.a(e.distortionCoefficients),r=e.screenLensDistance,n=e.interLensDistance/2/r,o=t.widthMeters/r,s=t.heightMeters/r,u=o/2-n,c=(e.baselineLensDistance-t.bevelMeters)/r,h=e.fov,d=i.distortInverse(Math.tan(l*h)),p=Math.min(u,d),f=Math.min(n,d),g=Math.min(c,d);return{outerDist:p,innerDist:f,topDist:Math.min(s-c,d),bottomDist:g,eyePosX:u,eyePosY:c}},r.Viewers=f,t.a=r},function(e,t,i){"use strict";var r=function(e){this.coefficients=e};r.prototype.distortInverse=function(e){for(var t=e/.9,i=.9*e,r=e-this.distort(t);Math.abs(i-t)>1e-4;){var n=e-this.distort(i),a=i-n*((i-t)/(n-r));t=i,i=a,r=n}return i},r.prototype.distort=function(e){return e*this.distortionFactor_(e)},r.prototype.distortionFactor_=function(e){for(var t=1,i=1,r=e*e,n=0;n<this.coefficients.length;n++){var a=this.coefficients[n];i*=r,t+=a*i}return t},t.a=r},function(e,t,i){"use strict";var r={format:1,last_updated:"2016-01-26T23:11:18Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3}]};t.a=r},function(e,t,i){"use strict";var r=i(1120),n=i(604),a=function(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm},o=function(e,t){if(this.dpdb=r.a,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=t;var i=new XMLHttpRequest,n=this;i.open("GET","https://storage.googleapis.com/cardboard-dpdb/dpdb.json",!0),i.addEventListener("load",function(){n.loading=!1,i.status>=200&&i.status<=299&&(n.dpdb=JSON.parse(i.response),n.recalculateDeviceParams_())}),i.send()}};o.prototype.getDeviceParams=function(){return this.deviceParams},o.prototype.recalculateDeviceParams_=function(){var e=this.calcDeviceParams_();e&&(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams))},o.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return null;if(1!==e.format)return null;if(!e.devices||!e.devices.length)return null;var t=navigator.userAgent||navigator.vendor||window.opera,i=n.a.getScreenWidth(),r=n.a.getScreenHeight();if(!e.devices)return null;for(var o=0;o<e.devices.length;o++){var s=e.devices[o];if(s.rules&&(("ios"===s.type||"android"===s.type)&&n.a.isIOS()===("ios"===s.type))){for(var u=!1,l=0;l<s.rules.length;l++){var c=s.rules[l];if(this.matchRule_(c,t,i,r)){u=!0;break}}if(u){var h=s.dpi[0]||s.dpi,d=s.dpi[1]||s.dpi;return new a({xdpi:h,ydpi:d,bevelMm:s.bw})}}}return null},o.prototype.matchRule_=function(e,t,i,r){if(!e.ua&&!e.res)return!1;if(e.ua&&t.indexOf(e.ua)<0)return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var n=e.res[0],a=e.res[1];if(Math.min(i,r)!==Math.min(n,a)||Math.max(i,r)!==Math.max(n,a))return!1}return!0},t.a=o},,function(e,t,i){"use strict";var r=i(5),n=r.a.osg,a=function(e,t,i,r,a){this._startPosOffset=e,this._startPos=n.vec3.create(),this._targetPos=n.vec3.create(),this._duration=t,this._easingFunc=i,this._result=n.vec3.create(),this._hasStarted=!1,this._reverse=!1,this._finished=!0,this._node=r,this._model=a};a.prototype={isFinished:function(){return this._finished},_reverseAnim:function(){this._reverse=!this._reverse},start:function(){var e=n.vec3.create();return function(t){this._started=.05*-t,this._hasStarted=!1,this._finished=!1,n.vec3.scale(e,this._startPosOffset,this._model.get("worldFactor")),this._reverse?(n.mat4.getTranslation(this._startPos,this._node.getMatrix()),n.vec3.add(this._targetPos,this._startPos,e),this._node.setOpacity(1)):(n.mat4.getTranslation(this._targetPos,this._node.getMatrix()),n.vec3.add(this._startPos,this._targetPos,e),this._node.setOpacity(0)),n.mat4.setTranslation(this._node.getMatrix(),this._startPos)}}(),update:function(e,t){if(!this._finished){var i=t.getFrameStamp().getSimulationTime();if(this._started<0)return this._started+=t.getFrameStamp().getDeltaTime(),!0;this._hasStarted||(this._started=i,this._hasStarted=!0);var r=(i-this._started)/this._duration;return r>1&&(this._finished=!0,r=1),this._easingFunc&&(r=this._easingFunc(r)),this.interpolate(r,e),this._finished&&(this._reverseAnim(),this._onFinishCallback&&this._onFinishCallback(),this._node.dirtyBound()),!0}},interpolate:function(e,t){n.vec3.lerp(this._result,this._startPos,this._targetPos,e),n.mat4.setTranslation(t.getMatrix(),this._result),this._reverse?this._node.setOpacity(1-e):this._node.setOpacity(e)},setOnFinishCallback:function(e){this._onFinishCallback=e}},t.a=a},function(e,t,i){"use strict";var r=i(466),n=i(69),a=i(5),o=a.a.osg,s=function(e,t){r.a.call(this,e,t),this._round=.005};s.prototype=o.objectInherit(r.a.prototype,{initialize:function(e,t){r.a.prototype.initialize.call(this,e,t,function(){this.setClickAction("nextPage",function(){this.setPage(this._currentPage+1)}.bind(this)),this.setClickAction("prevPage",function(){this.setPage(this._currentPage-1)}.bind(this))}.bind(this)),this._nbColumns=t.column,this._currentPage=0},setHinted:function(e){this._hinted=e,this.setNodeMask(e?n.a.NO_PICK:0),this._uAlpha&&(this._uAlpha[0]=.1)},isHinted:function(){return this._hinted},getNbPage:function(){return this._nbColumns},getCurrentPage:function(){return this._currentPage},setPage:function(e){if(this._currentPage!==e){var t=this.getNbPage(),i=Math.min(t-1,Math.max(0,e));this.setPageForCell("column"+i,"default"),this._currentPage=i}}}),t.a=s},,,,function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(174),o=i(16);t.a=a.a.extend({VIEWER_MODE_ORBIT:0,VIEWER_MODE_FPS:1,HOTSPOT_CYCLE_PAUSE:1e4,events:{"click .has-menu":"toggleMenu","touchstart .has-menu":"toggleMenuTouch",keydown:"onKeydown",mousewheel:"onMousewheel","mousedown  .webgl .canvas":"cameraMoveStart","touchstart .webgl .canvas":"cameraMoveStart","mousedown  .webgl":"mouseDownEvent","mouseup    .webgl":"mouseUpEvent","touchstart .webgl":"mouseDownEvent","touchend   .webgl":"mouseUpEvent","mousedown  .fallback":"mouseDownEvent","touchstart .fallback":"mouseDownEvent","click      .watermark":"onWatermarkClick","touchend   .watermark":"onWatermarkClick"},constructor:function(){this.globalCloseEvent=this.globalCloseEvent.bind(this),this.globalMouseUpEvent=this.globalMouseUpEvent.bind(this),this.onKeydown=this.onKeydown.bind(this),a.a.prototype.constructor.apply(this,arguments)},delegateEvents:function(){a.a.prototype.delegateEvents.apply(this,arguments);var e=n()(document);e.on("keydown",this.onKeydown),e.on("mousedown",this.globalCloseEvent),e.on("mouseup",this.globalMouseUpEvent),e.on("mousewheel.delegateEvents"+this.cid,".annotation",this.preventScroll)},undelegateEvents:function(){a.a.prototype.undelegateEvents.apply(this,arguments);var e=n()(document);e.off("keydown",this.onKeydown),e.off("mousedown",this.globalCloseEvent),e.off("mouseup",this.globalMouseUpEvent),e.off("mousewheel.delegateEvents"+this.cid,".annotation",this.preventScroll)},enable:function(){this.$(".gui").addClass("enabled")},disable:function(){this.$(".gui").removeClass("enabled")},closeMenus:function(){this.$(".gui").find(".has-menu").removeClass("active"),this.viewer.subviews.generalControls&&this.viewer.subviews.generalControls.settings&&this.viewer.subviews.generalControls.settings.togglePane(!1)},cameraMoveStart:function(){this.viewer.$(".webgl").addClass("camera-moving"),this.viewer.subviews.hotspots&&this.viewer.subviews.hotspots.pauseHotspotCycleInterval()},cameraMoveEnd:function(){this.viewer.$(".webgl").removeClass("camera-moving"),this.viewer.subviews.hotspots&&this.viewer.subviews.hotspots._hotspotCycleIntervalPaused&&this.viewer.subviews.hotspots.beginHotspotCycleInterval(this.HOTSPOT_CYCLE_PAUSE)},onMousewheel:function(){var e;if(this.viewer.scene){var t=this.viewer.scene.getFeatures();t.hasOwnProperty("camera")&&(e=t.camera.getModel().get("indexManipulator"))}if(e===this.VIEWER_MODE_FPS){var i=this.viewer.scene.getViewerOSGJS().getManipulator().getCurrentManipulator()._stepFactor,r=Math.round(i/4*100);this.viewer.subviews.osd.show("Walking speed: "+r,{duration:1e3})}},onKeydown:function(e){var t=document.activeElement,i="",r=["BODY","CANVAS"];32===e.which&&t&&(i=t.tagName,-1!==r.indexOf(i)&&(this.recenter(),e.preventDefault())),e.which>=96&&e.which<=105&&this.timeline&&this.timeline.setCurrentAnimation(e.which-96),27===e.which&&(this.viewer.subviews.hotspots&&this.viewer.subviews.hotspots._hotspots.length&&(this.viewer.subviews.hotspots.currentHotspot=-1,this.viewer.subviews.hotspots.applyCurrentHotspot(),this.viewer.subviews.hotspots.unrevealHotspots(),this.viewer.subviews.hotspots.stopHotspotCycleInterval()),this.closeMenus(),this.viewer.subviews.helpOverlay.hide())},preventParentScroll:function(e,t){var i=n()(".hotspot-controls .list"),r=i.height(),a=i.children()[0].scrollHeight,o=i.children()[0].scrollTop;(o===a-r&&t<0||0===o&&t>0)&&e.preventDefault()},preventScroll:function(e){e.preventDefault()},globalMouseUpEvent:function(){this.cameraMoveEnd()},globalCloseEvent:function(e){n()(e.target).hasClass("has-menu")||n()(e.target).parents(".has-menu").length||this.closeMenus(e)},toggleMenu:function(e){e.preventDefault(),e.stopPropagation();var t=n()(e.currentTarget);t.hasClass("active")?e.currentTarget===e.target&&t.attr("data-title",t.attr("title")).removeClass("active"):(this.closeMenus(),t.attr("title",t.attr("data-title")).removeAttr("data-title").addClass("active"))},toggleMenuTouch:function(e){e.preventDefault(),e.stopPropagation(),this.toggleMenu(e)},renderSetting:function(e,t){this.viewer.$('[data-setting="'+e+'"]').removeClass("active"),"wireframeColor"===e&&!1===this.viewer.proxySettings.get("wireframeEnable")||this.viewer.$('[data-setting="'+e+'"][data-value="'+t+'"]').addClass("active")},getPointerPosition:function(e){var t,i=e.originalEvent?e.originalEvent:e,r={};return i.touches&&i.touches.length||i.changedTouches&&i.changedTouches.length?(t=i.touches&&i.touches.length?i.touches:i.changedTouches,t=t[0],r.x=t.pageX,r.y=t.pageY,r.type="Touch"):(r.x=e.pageX,r.y=e.pageY,r.type="Mouse"),r},mouseDownEvent:function(e){this.mouseDownPosition=this.getPointerPosition(e),this.viewer.subviews.hint.hide(),"touchstart"===e.type&&(e.target===e.currentTarget||this.scene&&this.scene.getCanvas&&e.target===this.viewer.scene.getCanvas())&&e.preventDefault()},mouseUpEvent:function(e){if(this.mouseDownPosition){var t=this.getPointerPosition(e);if(this.viewer.$el.hasClass("started")){if(Math.abs(this.mouseDownPosition.x-t.x)>20||Math.abs(this.mouseDownPosition.y-t.y)>20){var i=this.viewer._currentModel?this.viewer._currentModel.get("uid"):this.viewer._currentUid;o.a.modelEmbedModelInteraction(i,t.type)}this.mouseDownPosition=null}}},recenter:function(){this.viewer.scene&&this.viewer.scene.getViewerOSGJS().getManipulator().computeHomePosition()},onWatermarkClick:function(){var e=n()(".watermark").find("a").attr("href"),t=e.split("models/").pop().split("/")[0];o.a.modelEmbedWatermarkClicked(t)}})},function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(0),o=(i.n(a),i(70)),s=i.n(o),u=i(296),l=i(16),c=i(493),h=i(85),d=i(809),p=i(1136),f=i(21),g=i(29),m=g.a.shortcuts,v=new c.a(m.viewerRendering),_=function(e){var t=[{title:"Off",className:"colors-none",dataSetting:"wireframeEnable",dataValue:"0"},{title:"Black",className:"colors-black",dataSetting:"wireframeColor",dataValue:"00000099"},{title:"White",className:"colors-white",dataSetting:"wireframeColor",dataValue:"ffffff99"},{title:"Red",className:"colors-red",dataSetting:"wireframeColor",dataValue:"ff507f99"},{title:"Blue",className:"colors-blue",dataSetting:"wireframeColor",dataValue:"4d9cff99"},{title:"Green",className:"colors-green",dataSetting:"wireframeColor",dataValue:"2d9e8499"},{title:"Yellow",className:"colors-yellow",dataSetting:"wireframeColor",dataValue:"ebc71299"}],r=i.i(a.template)(["<a",'   class="<%= className %> <% if (isActive) { %>active<% } %>"','   data-setting="<%= dataSetting %>"','   data-value="<%= dataValue %>"','   title="<%= title %>">',"</a>"].join(""));return i.i(a.template)(['<p class="wireframe-title">',"Wireframe ",'<span class="shortcut" title="Keyboard shortcut">',"   <%= shortcut %>","</span>","</p>",'<div class="wireframe-colors">',"   <%= colorItems %>","</div>"].join(""))({shortcut:v.getShortDescriptionById("toggleWireframe"),colorItems:t.map(function(t){return r(i.i(a.extend)({},t,{isActive:e.wireframeColor===t.dataValue}))}).join("")})},b=function(e){var t=i.i(a.template)(['    <div class="setting-list-header">','       <a class="back control-menu-back">Back</a>','       <span class="setting-list-header-help">Key</span>',"   </div>",'    <ul class="setting-list" data-setting="<%= name %>">',"        <%= listItems %>","    </ul>","   <%= wireframe %>"].join("")),r=e.viewerSettings.hasWireframe,n=e.viewerSettings.wireframeColor;return t(i.i(a.extend)({},e,{wireframe:r?_({wireframeColor:n}):""}))},x={shadingStyle:{label:"Rendering",settings:[{label:"Lit",value:"lit",shortcut:v.getShortDescriptionById("defaultRenderingMode")},{label:"Shadeless",value:"shadeless",shortcut:v.getShortDescriptionById("shadelessRenderingMode")},{label:"MatCap",value:"matcap",shortcut:v.getShortDescriptionById("matcapRenderingMode")}],paneTemplate:b,order:2},annotationsVisible:{label:"Annotations",type:"bool",group:"annotation",settings:[{label:"Visible",value:!0},{label:"Hidden",value:!1}]},speed:{label:"Anim. Speed",group:"animation",type:"number",settings:[{label:"x0.1",value:"0.1"},{label:"x0.5",value:"0.5"},{label:"x1",value:"1"},{label:"x2",value:"2"}],order:3},viewerMode:{label:"Navigation",settings:[{label:"Orbit",value:"0"},{label:"First Person",value:"1"}],order:4}};t.a=d.a.extend({events:{"click .help":"onHelpClick","click .vr":"onVrClick","click .fullscreen":"onFullscreenClick","click .theatre":"onTheatreClick","touchend .control.tooltip":"replaceDOMElement"},constructor:function(){this.fullScreenChange=this.fullScreenChange.bind(this),this.onVrClick=this.onVrClick.bind(this),this.onFullscreenClick=this.onFullscreenClick.bind(this),this.onTheatreClick=this.onTheatreClick.bind(this),d.a.prototype.constructor.apply(this,arguments)},initialize:function(){d.a.prototype.initialize.apply(this,arguments),this.enableVR=!1,!this.hasFullscreen()&&i.i(u.default)()&&window.self===window.top&&(this.viewer.$el.addClass("no-fullscreen"),this.viewer.$el.find(".controls .settings").addClass("shift-menu-left")),this.initializeTheatreMode(),this.viewer.on("model-loaded",function(){var e,t=this.viewer.scene,r=t.getFeatures().animation.getModel();e=r.get("animations").length>1?[{label:"One",value:"one"},{label:"All",value:"all"},{label:"None",value:"none"}]:"none"===r.get("cycleMode")?[{label:"All",value:"all"},{label:"None",value:"none"}]:[{label:i.i(a.capitalize)(r.get("cycleMode")),value:r.get("cycleMode")},{label:"None",value:"none"}],x.cycleMode={label:"Anim. Cycle",group:"animation",settings:e,order:3},this.renderSettings()}.bind(this))},delegateEvents:function(){d.a.prototype.delegateEvents.apply(this,arguments),this.onFullScreenChange(this.fullScreenChange),this.viewer.proxySettings.on("change",this.renderSettings,this),this.viewer.on("model-loaded",function(){var e=this.viewer.scene.getFeatures().animation.getModel();e.on("change:cycleMode",this.renderSettings,this),e.get("animations").on("add remove reset",this.renderSettings,this)}.bind(this))},undelegateEvents:function(){if(d.a.prototype.undelegateEvents.apply(this,arguments),!this.$el)return this;this.offFullScreenChange(this.fullScreenChange),this.viewer.proxySettings.off("change",this.renderSettings,this)},setHasAnimations:function(e){this.hasAnimations=e},getSettingLabelForValue:function(e,t){return x[e].settings.find(function(e){return e.value===t}).label},getDisplayedSettings:function(){var e=this.viewer.scene,t=e.model;return i.i(a.mapValues)(x,function(r){return i.i(a.extend)({},r,{settings:r.settings.filter(function(i){return!i.isDisplayed||i.isDisplayed(t,e)})})})},getEmbedUrl:function(e){var t=f.a.craft(i.i(a.extend)({},f.a.parse(location.search),e||{}));return this.viewer._currentModel.get("embedUrl")+"?"+t},onHelpClick:function(e){e.preventDefault(),e.stopPropagation(),l.a.modelViewerHelpButtonCliked(),this.viewer.subviews.helpOverlay.show()},generateTextureQualitySettings:function(e){x.textureQuality={label:"Textures",group:"textureQuality",settings:[{label:"LD",value:"0"},{label:"SD",value:"1"},{label:"HD",value:"2"}],order:5};var t=["low","mid","high"],r=0;t.forEach(function(t,i){if(!e[t]){x.textureQuality.settings.splice(i-r,1),r++}}.bind(this)),i.i(a.last)(x.textureQuality.settings).label="HD",this.renderSettings()},renderSettings:function(){this.settings||(this.settings=new p.a({el:this.$(".settings-menu"),viewer:this.viewer,settings:this.getDisplayedSettings()})),this.settings.settings=this.getDisplayedSettings(),this.settings.render()},onVrClick:function(e){e.stopPropagation(),this.widgets.hotspots&&(this.widgets.hotspots.hideTooltips(),this.widgets.hotspots.currentHotspot=-1,this.widgets.hotspots.renderControl());var t=this.viewer.scene.getFeatures().webVR.getModel();t.onVrDisplayReady(function(){t.get("hasNativeHMD")?(t.set("enable",!t.get("enable")),l.a.modelViewerVrButtonClicked("nativeVR")):s.a.any?(this.fullscreenVR(e),l.a.modelViewerVrButtonClicked("mobile")):(this.openVrInstructions(),l.a.modelViewerVrButtonClicked("desktop"))}.bind(this))},openVrWindow:function(){this.viewer._currentModel&&window.open(this.getEmbedUrl({cardboard:1,autostart:1}),"skfbCardboard","menubar=no,toolbar=no")},openVrInstructions:function(){this.viewer._currentModel.sharing().then(function(){var e=this.viewer._currentModel.get("sharing").shortUrl;this.viewer.subviews.helperVrOverlay.setUrl(e),this.viewer.subviews.helperVrOverlay.show()}.bind(this))},initializeTheatreMode:function(){this._theatreActive="false"!==h.a.get("theatre_mode","false")},isTheatreActive:function(){return this._theatreActive},onTheatreClick:function(e){e.stopPropagation(),e.preventDefault();var t=this.isTheatreActive();return this.viewer.trigger(t?"leaveTheatreMode":"enterTheatreMode"),h.a.set("theatre_mode",!t),this._theatreActive=!t,!1},onFullscreenClick:function(e,t){e.stopPropagation(),this.hasFullscreen()?this.isFullscreen()?this.exitFullscreen():this.requestFullscreen():t?this.openVrWindow():this.openFakeFullscreen()},openFakeFullscreen:function(){this.viewer._currentModel&&(s.a.any?window.open(this.getEmbedUrl()):window.open(this.getEmbedUrl(),"skfbFullscreenFallback","menubar=no,toolbar=no"))},onFullScreenChange:function(e){var t=n()(document);t.on("fullscreenchange",e),t.on("webkitfullscreenchange",e),t.on("msfullscreenchange",e),t.on("mozfullscreenchange",e)},offFullScreenChange:function(e){var t=n()(document);t.off("fullscreenchange",e),t.off("webkitfullscreenchange",e),t.off("msfullscreenchange",e),t.off("mozfullscreenchange",e)},fullScreenChange:function(){n()('[data-action="fullscreen"] > .icon').toggleClass("icon-fullscreen-icon").toggleClass("icon-fullscreen-off-icon"),this.viewer.$el.toggleClass("fullscreen",this.isFullscreen());var e=this.viewer.scene.getFeatures().webVR;if(e){var t=e.getModel();this.isFullscreen()?!0===this.enableVR&&t.set("enable",!0):!0===this.enableVR&&(t.set("enable",!1),this.enableVR=!1)}},fullscreenVR:function(e){return this.enableVR=!0,this.onFullscreenClick(e,!0)},hasFullscreen:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled},isFullscreen:function(){return document.mozFullScreen||document.webkitIsFullScreen},requestFullscreen:function(){this.viewer.el.requestFullscreen?this.viewer.el.requestFullscreen():this.viewer.el.webkitRequestFullscreen?this.viewer.el.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):this.viewer.el.msRequestFullscreen?this.viewer.el.msRequestFullscreen():this.viewer.el.mozRequestFullScreen&&this.viewer.el.mozRequestFullScreen()},exitFullscreen:function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen()},replaceDOMElement:i.i(a.debounce)(function(e){var t=e.target.parentElement,r=e.target.nextSibling;t&&(t.removeChild(e.target),i.i(a.defer)(function(){t.insertBefore(e.target,r)}))},2e3)})},function(e,t,i){"use strict";var r=i(174);t.a=r.a.extend({events:{"click .close":"close"},close:function(e){e&&e.preventDefault&&e.preventDefault()}})},function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(0),o=(i.n(a),i(16)),s=i(493),u=i(29),l=i(558),c=u.a.shortcuts;t.a=l.a.extend({events:{"click .tabs a":"onTabClick","touchstart .tabs a":"onTabClick",'click [data-action="reset-camera"]':"onResetCameraClick",'touchstart [data-action="reset-camera"]':"onResetCameraClick"},initialize:function(){l.a.prototype.initialize.apply(this,arguments),this.renderingShortcuts=new s.a(c.viewerRendering),this.annotationShortcuts=new s.a(c.annotationControl),this.animationShortcuts=new s.a(c.animationControl),this.render()},onResetCameraClick:function(e){e.preventDefault(),o.a.modelViewerResetCameraButtonClicked(),this.hide(),this.viewer.scene.getFeaturesManager().focusOnSavedCamera(2),i.i(a.defer)(function(e){e.target.blur()},e)},render:function(){var e=this.renderingShortcuts.generateHelpSection(),t=this.annotationShortcuts.generateHelpSection(),i=this.animationShortcuts.generateHelpSection();this.$(".rendering-shortcuts").html(e),this.$(".annotation-shortcuts").html(t),this.$(".animation-shortcuts").html(i)},onTabClick:function(e){e.preventDefault();var t=n()(e.currentTarget),i=t.attr("data-target"),r=this.$("[data-tab].active"),a=this.$('[data-tab="'+i+'"]');o.a.modelViewerHelpTabClicked(i),this.$(".tabs li").removeClass("active"),t.parent().addClass("active"),r.removeClass("active"),a.addClass("active")}})},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(174)),a=i(85),o=i(31);t.a=n.a.extend({initialize:function(){n.a.prototype.initialize.apply(this,arguments),this.$hint=this.$(".viewer-hint"),this.options.fallback&&this.$hint.addClass("fallback-position")},show:function(e){e=i.i(r.defaults)(i.i(r.extend)({},e),{force:!1});var t=1===a.a.get("show_viewer_hint",1),n=i.i(o.a)().uiHint;2===n&&(e.force=!0),(e.force||1===n&&t)&&this.$hint.addClass("active")},hide:function(e){e=i.i(r.defaults)(i.i(r.extend)({},e),{remember:!0}),this.$hint.removeClass("active"),e.remember&&a.a.set("show_viewer_hint",0,{expires:15552e6,path:"/"})}})},function(e,t,i){"use strict";var r=i(161),n=i(558),a=n.a.extend({mixins:[r.a],events:{"click .tabs a":"onTabClick",'click [data-action="reset-camera"]':"onResetCameraClick"},setModel:function(e){this.model=e,this.render()},render:function(){this.model&&(this.$(".hotspot-title").html(this.model.get("name")),this.$(".hotspot-content").html(this.model.get("content").rendered),this.handleLazyLoading())}});t.a=a},function(e,t,i){"use strict";var r=i(5),n=i(174),a=i(419),o=i.n(a),s=i(31),u=r.a.osg,l=new o.a({device:"VWR"});t.a=n.a.extend({reset:function(){this._primaryProgress=0,this._secondaryProgress=0,this._lowerSecondaryProgress=0,this._actualSecondaryProgress=0},handleLoading:function(e){e.scene.on("primary-progress",function(e){if(this.setPrimaryProgress(e.progress),i.i(s.a)().isApp){var t=l.createMessage({data:{progress:e.progress+""}});this.previousMessage&&this.previousMessage.removeFromHash(),t.appendToHash(),this.previousMessage=t}}.bind(this)),e.scene.on("secondary-progress",function(e){this.setSecondaryProgress(e.progress)}.bind(this)),e.scene.on("success",function(){this.viewer.$el.removeClass("model-loading").addClass("model-loaded"),e.model.trigger("status:loaded"),this.trigger("loaded")}.bind(this)),e.scene.on("fail",function(){u.error("Viewer instanciation failed")}.bind(this))},setPrimaryProgress:function(e){var t=Math.min(Math.max(0,e),1);this._primaryProgress=t,this.updateMainProgressBar(this._primaryProgress),1===this._primaryProgress&&(this._lowerSecondaryProgress=this._actualSecondaryProgress,this.setSecondaryProgress(this._secondaryProgress))},setSecondaryProgress:function(e){var t=Math.min(Math.max(0,e),1);this._actualSecondaryProgress=t,this._secondaryProgress=(this._actualSecondaryProgress-this._lowerSecondaryProgress)/(1-this._lowerSecondaryProgress),1===this._lowerSecondaryProgress&&(this._secondaryProgress=1),this.updateSecondaryProgressBar(this._secondaryProgress)},updateMainProgressBar:function(e){var t=1===this._primaryProgress;e=Math.max(e,this._previousPrimaryValue||0),this._previousPrimaryValue=e,this.$(".main-progress").toggleClass("loading",!t),this.$(".main-progress-display").attr("value",e),this.$(".main-progress-percentage").text(Math.floor(100*e)+" %")},updateSecondaryProgressBar:function(e){e=Math.max(e,0),this.$(".secondary-progress-percentage").text(Math.floor(100*e)+" %"),this.$(".secondary-progress-display").css("width",100*e+"%");var t=1===this._primaryProgress,i=1===this._secondaryProgress;this.$(".secondary-progress").toggleClass("visible",t&&!i)}})},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(94)),a=i(174);t.a=a.a.extend({events:{"click .osd":"hide"},show:function(e,t){t=i.i(r.extend)({duration:1/0,position:"center",style:"default"},t),t.duration=Math.max(0,t.duration),window.clearTimeout(this.osdTimeout),this.$(".osd .osd-content").html(e);var n=this.$(".osd");n.removeClass("osd-default"),n.removeClass("osd-compact"),n.addClass("osd-"+t.style),n.removeClass("osd-top"),n.removeClass("osd-center"),n.removeClass("osd-bottom"),n.addClass("osd-"+t.position),t.duration>0&&t.duration<1/0&&(n.addClass("hud"),this.osdTimeout=setTimeout(this.hide.bind(this),t.duration)),n.hasClass("active")||(n.removeClass("hidden"),n.addClass("active"))},hide:function(){var e=this.$(".osd");e.removeClass("active"),i.i(n.a)(e[0],function(){e.addClass("hidden"),e.removeClass("hud"),this.$(".osd .osd-content").empty()}.bind(this))}})},function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(0),o=(i.n(a),i(94)),s=i(16),u=i(174),l=i.i(a.template)(['<div class="setting" data-setting="<%= name %>" data-setting-group="<%= group %>">','   <p class="setting-label"><%= label %></p>',"</div>"].join("")),c=i.i(a.template)(['<div class="setting" data-setting="<%= name %>" data-setting-group="<%= group %>" data-setting-type="<%= type %>">','   <p class="setting-label"><%= label %></p>','   <p class="setting-value" data-value="<%= value %>" ><%= prettyValue %></p>',"</div>"].join("")),h=i.i(a.template)(['   <a class="control-menu-back back">Back</a>','   <ul class="setting-list" data-setting="<%= name %>" data-setting-type="<%= type %>">',"       <%= listItems %>","   </ul>"].join("")),d=i.i(a.template)(['<li class="setting-item <% if (selected) { %>selected<% } %>" data-value="<%= value %>">',"   <%= prettyValue %>",'   <span class="shortcut" title="Keyboard shortcut"><%= shortcut %></span>',"</li>"].join(""));t.a=u.a.extend({initialize:function(e){this.settings=e.settings,this.viewer=e.viewer,this.settings||console.warn("No settings object given to SettingsMenu"),u.a.prototype.initialize.apply(this,arguments),this.$list=this.$(".control-menu-list"),this.$pane=this.$(".control-menu-pane"),this.$el.on("click touchend",".setting",this.onSettingClick.bind(this)),this.$el.on("click touchend",".back",this.togglePane.bind(this,!1)),this.$el.on("click touchend",".setting-item",this.onSettingValueClick.bind(this)),this.$el.on("click touchend",'[data-setting="viewerMode"] li',this.onViewerModeChange.bind(this)),this.$el.on("click touchend",'.wireframe-colors a[data-setting="wireframeColor"]:not(.active)',this.onWireframeColorClick.bind(this)),this.$el.on("click touchend",'.wireframe-colors a[data-setting="wireframeColor"].active',this.onDisableWireframeClick.bind(this)),this.$el.on("click touchend",'.wireframe-colors a[data-setting="wireframeEnable"]',this.onDisableWireframeClick.bind(this)),this.viewer.proxySettings.on("change",this.render.bind(this))},onViewerModeChange:function(e){e&&"touchend"===e.type&&e.preventDefault(),"0"===this.viewer.proxySettings.get("viewerMode")?this.viewer.subviews.osd.show("Click and hold to rotate",{position:"top",duration:3e3}):this.viewer.subviews.osd.show("Mouse to look around, keyboard to move",{position:"top",duration:3e3})},onDisableWireframeClick:function(e){e&&"touchend"===e.type&&e.preventDefault();var t=this.$('.wireframe-colors [data-setting="wireframeEnable"]');this.viewer.proxySettings.set("wireframeEnable",!1),t.parent().find(".active").removeClass("active"),t.addClass("active")},onWireframeColorClick:function(e){e&&"touchend"===e.type&&e.preventDefault();var t=n()(e.currentTarget),i=t.attr("data-value");this.viewer.proxySettings.set("wireframeColor",i),this.viewer.proxySettings.set("wireframeEnable",!0),t.parent().find(".active").removeClass("active"),t.addClass("active"),s.a.modelViewerWireframeColorSelected(i)},onSettingClick:function(e){e&&"touchend"===e.type&&e.preventDefault&&e.preventDefault();var t=n()(e.currentTarget).attr("data-setting"),i=this.settings[t];if(i.name=t,i.isButton)return this[i.action]&&this[i.action](e);this.renderSettingPane(i),this.togglePane(!0)},onSettingValueClick:function(e){e.preventDefault(),e.stopPropagation();var t=n()(e.currentTarget),i=t.attr("data-value"),r=t.closest("[data-setting]").attr("data-setting"),a=t.closest("[data-setting]").attr("data-setting-type")||"string",o=this.settings[r];switch("shadingStyle"===r?s.a.modelViewerShadingSelected(i):"cycleMode"===r?s.a.modelViewerAnimationRepeatModeSelected(i):"annotationsVisible"===r?s.a.modelViewerAnnotationsToggled(this.viewer._currentModel.get("uid"),"false"!==i):"viewerMode"===r&&s.a.modelViewerViewerModeSelected(i),this.viewer.proxySettings.once("change",function(){o.value=i,this.renderSettingPane(o),this.updateSetting(o),"shadingStyle"!==r&&this.togglePane()}.bind(this)),a){case"number":i=parseFloat(i);break;case"bool":i="true"===i}this.viewer.proxySettings.set(r,i)},onSettingChangeWhileOpen:function(){this.renderSettingPane(this._currentSetting)},renderSettingPane:function(e){var t="",r="",n=this.viewer.proxySettings.get(e.name),o=this.getSettingFromValue(e.name,n),s=this.viewer._currentModel.get("options").shading.type;this._currentSetting&&this.viewer.proxySettings.off("change:"+this._currentSetting.name,this.onSettingChangeWhileOpen,this),this._currentSetting=e,this._currentSetting&&this.viewer.proxySettings.on("change:"+this._currentSetting.name,this.onSettingChangeWhileOpen,this),"shadingStyle"===e.name&&"lit"!==s||i.i(a.each)(e.settings,function(e){t+=d({value:e.value,type:e.type||"string",prettyValue:e.label,selected:o===e,shortcut:e.shortcut||""})}),r=(e.paneTemplate||h)({listItems:t,name:e.name,type:e.type||"string",viewerSettings:this.viewer.proxySettings.toJSON()}),this.$pane.html(r);var u=this.viewer.scene.getFeatures().webVR.getModel();"viewerMode"!==this._currentSetting.name||u.get("hasNativeHMD")?this.$('[data-value="2"]').show():this.$('[data-value="2"]').hide()},updateSetting:function(e){var t=(this.getSettingFromValue(e.name,e.value)||{}).label||"Unknown Value";this.$list.find('[data-setting="'+e.name+'"]').find(".setting-value").html(t)},getSettingFromValue:function(e,t){var i;return(this.settings[e].settings||[]).forEach(function(e){e.value!==t&&e.value+""!=t+""||(i=e)}),i},togglePane:function(e,t){t&&"touchend"===t.type&&t.preventDefault(),this.$el.toggleClass("detail",e),i.i(o.a)(this.$(".control-menu-wrapper"),function(){this.$el.hasClass("detail")||this.clearPane()}.bind(this))},clearPane:function(){this.$pane.html("")},render:function(){var e="",t=this.viewer.scene.getFeatures().quality.getModel(),r=this.viewer.scene.getFeatures().camera.getModel(),n=this.viewer.scene.getFeatures().hotspot.getModel(),o=this.viewer.scene.getFeatures().animation.getModel(),s=[];i.i(a.each)(this.settings,function(e,t){var r=i.i(a.clone)(e);r.name=t,s.push(r)}),s=i.i(a.sortBy)(s,"order"),i.i(a.each)(s,function(t){var i,r=t.name;if(t.isButton)i=l({name:r,label:t.label,group:t.group});else{var n=this.getSettingFromValue(r,this.viewer.proxySettings.get(r))||t.settings[0];i=c({name:r,label:t.label,value:n.value,prettyValue:n.label,group:t.group,type:n.type})}e+=i}.bind(this)),this.$list.html(e),u.a.prototype.render.apply(this,arguments),o&&o.get("animations").length?this.$('[data-setting-group="animation"]').show():this.$('[data-setting-group="animation"]').hide(),t&&t.get("promiseReady").isFulfilled()?this.$('[data-setting-group="textureQuality"]').show():this.$('[data-setting-group="textureQuality"]').hide(),n&&n.get("hotspots").length?this.$('[data-setting-group="annotation"]').show():this.$('[data-setting-group="annotation"]').hide();var h=this.getSettingFromValue("viewerMode",r.get("indexManipulator"));if(this.$('[data-setting="viewerMode"] .setting-value').attr("data-value",h.value).text(h.label),r.get("useCameraConstraints")?this.$('[data-setting="viewerMode"]').hide():this.$('[data-setting="viewerMode"]').show(),o){var d=this.getSettingFromValue("speed",o.get("speed"));this.$('[data-setting="speed"] .setting-value').attr("data-value",d.value).text(d.label);var p=this.getSettingFromValue("cycleMode",o.get("cycleMode"));this.$('[data-setting="cycleMode"] .setting-value').attr("data-value",p.value).text(p.label)}t&&t.get("promiseReady").isFulfilled()&&window.requestAnimationFrame(function(){var e=this.getSettingFromValue("textureQuality",t.get("level"));this.$('[data-setting="textureQuality"] .setting-value').attr("data-value",e.value).text(e.label)}.bind(this))},onTextureQualityReady:function(e){var t=this.viewer.scene.getFeatures().quality;if(t){if(!e.low&&!e.mid&&!e.high)return void this.$('[data-setting="textureQuality"]').remove();var i=t.getModel(),r=i.get("level");this.viewer.proxySettings.set("textureQuality",r),this.render()}}})},function(e,t,i){"use strict";var r=i(0),n=(i.n(r),i(10)),a=i.n(n),o=i(5),s=i(174),u=i(766),l=i(769),c=i(23),h=i(510),d=o.a.osg;t.a=s.a.extend({events:{"mouseover .snapshot .button":"showGuides","mouseout .snapshot .button":"hideGuides"},initialize:function(){s.a.prototype.initialize.apply(this,arguments),this.$el.find(".snapshot .button").on("click",this.onSnapshot.bind(this))},onSnapshot:function(e){var t=this.viewer.scene;e.preventDefault();var i=this.$el.find(".snapshot"),r=this.$el.find(".snapshot-flash"),n=this.$el.find(".img-container");if(!i.hasClass("progress")){i.addClass("progress"),r.addClass("active"),setTimeout(function(){r.removeClass("active")},2e3);var o=!0,s=t.getFeatures();if(s.camera){s.camera.getModel().saveCameraPosition();var u=t.getFeatures().saveUI;u||(u=new l.a,u.init(t.getFeaturesManager()._context),u._views[0].enableSaving()),o=u._views[0].save(e)}a.a.all([t.getScreenShot(1920,1080),o]).then(this.onTakeScreenshot.bind(this,i,n))}},onTakeScreenshot:function(e,t,r){var n=r[0],a=i.i(h.a)(n.toDataURL("image/jpeg")),o=new u.a({imageFile:a}),s=this.viewer._currentModel,l=o.save({modelUID:s.get("uid")}),p=t.find("img");p&&(p.remove(),null!==this.previewTimeout&&(window.clearTimeout(this.previewTimeout),this.previewTimeout=null));var f=new Image;f.src=n.toDataURL("image/jpeg"),t.prepend(f),t.removeClass("invisible"),this.previewTimeout=setTimeout(function(){t.addClass("invisible")},4e3),l.done(function(){e.removeClass("progress"),e.addClass("success"),setTimeout(function(){e.removeClass("success")},2e3)}).fail(function(){var t=new c.default({title:"Save settings error",text:"An unexpected error happened. The thumbnail has NOT been saved.",buttons:{ok:!0}});t.open().then(function(){t.close()}),d.error("Error while saving snapshot"),e.removeClass("progress")})},showGuides:i.i(r.debounce)(function(){this.$(".snapshot-guides").addClass("active")},100),hideGuides:i.i(r.debounce)(function(){this.$(".snapshot-guides").removeClass("active")},100)})},function(e,t,i){"use strict";var r=i(2),n=i.n(r),a=i(0),o=(i.n(a),i(762)),s=i(174),u=i(29),l=i(493);t.a=s.a.extend({events:i.i(a.extend)({},s.a.prototype.events,{touchstart:"onTouchStart",mousedown:"onClick",mouseover:"onMouseover",mouseout:"onMouseout"}),initialize:function(){s.a.prototype.initialize.apply(this,arguments),this.previousValue=null,this._touched=!1,this.$icon=this.$(".fa"),this.listenTo(this.model,"change:volume",this.render.bind(this)),this.render(),this.$volumeMenu=this.$(".volume-menu"),this.slider=new o.a(void 0,{model:this.model,global:!0,orientation:"vertical"}),this.$volumeMenu.append(this.slider.$el),this.initializeShortcuts()},initializeShortcuts:function(){this.soundControlShortcuts=new l.a(u.a.shortcuts.sound),this.soundControlShortcuts.on("mute",this.toggleMute.bind(this)),this.soundControlShortcuts.listen()},onTouchStart:function(){this._touched=!0},onClick:function(e){e.preventDefault();var t=n()(e.target);t.is(".volume-menu")||t.parents(".volume-menu").length||this.toggleMute()},toggleMute:function(){this.slider.onoff()},render:function(){var e=this.model.get("volume");return this.$icon.toggleClass("fa-volume-up",e>0),this.$icon.toggleClass("fa-volume-off",0===e),this},togglePane:function(e){this.$volumeMenu.toggleClass("--active",e)},onMouseover:function(){if(this._touched)return void(this._touched=!1);this.togglePane(!0)},onMouseout:function(){this.togglePane(!1)},show:function(){this.viewer.$el.addClass("sound-enabled")},hide:function(){this.viewer.$el.removeClass("sound-enabled")}})},function(e,t,i){"use strict";var r=i(174);t.a=r.a.extend({events:{"click .close":"close","touchstart .close":"close"},initialize:function(){r.a.prototype.initialize.apply(this,arguments),this.toggle(),this.model.on("change:notSupported",this.toggle,this)},toggle:function(){var e=this.model.get("notSupported");this.$el.toggleClass("hidden",!e)},close:function(e){e&&e.preventDefault&&e.preventDefault(),this.$el.addClass("hidden"),setTimeout(function(){this.$el.remove()}.bind(this),300)}})},function(e,t){e.exports={}},function(e,t){e.exports={animation_autoplay:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"Automatically play animations when the viewer starts."},anisotropy:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"If we activate anisotropy when trilinear is chosen."},annotation:{type:"number",defaultValue:0,values:"[1 - 50]",share:"public",help:"Setting to [1 - 50] will automatically load that annotation when the viewer starts."},annotation_cycle:{type:"number",defaultValue:null,values:"+X",share:"public",help:"Setting to any number will start the Autopilot cycle with that duration, in seconds, at each annotation."},annotations_visible:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",help:"Setting to 0 will hide annotations by default."},api_id:{type:"string",defaultValue:null,values:"string",share:"private",help:"The id of the viewer API."},api_version:{type:"string",defaultValue:null,values:"string",share:"private",help:"The version of the viewer API."},async_image:{type:"bool",defaultValue:!1,values:"0, 1",share:"shared",help:"Loads png and jpg in asynchronous (memory overhead for now so disabled by default)."},autospin:{type:"number",defaultValue:0,values:"+/-X",share:"public",help:"Setting to any number will cause the model to automatically spin around the z-axis after loading. The greater the number, the faster the spin. A negative number will reverse the spin direction."},autostart:{type:"bool",defaultValue:!1,values:"0, 1",share:"public",help:"Setting to 1 will make the model load immediately once the page is ready, rather than waiting for a user to click the Play button."},blending:{type:"number",defaultValue:null,values:"+/-X",share:"private",help:"Uses the blending mode that cycle between material channel (will be deprecated with model inspector). Value indicates cycle times."},camera:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",help:"Setting to 0 will skip the initial animation that occurs when a model is loaded, and immediately show the model in its default position."},camera_constraints:{type:"bool",defaultValue:!0,values:"0, 1",share:"shared",help:"Enable / Disable camera constraints"},camera_easing:{type:"number",defaultValue:null,values:"0..1",share:"private",help:"0 means no easing."},camera_eye:{type:"vec3",defaultValue:null,values:"X,Y,Z",share:"private",help:"Forces position of the camera."},camera_follow_bones:{type:"number",defaultValue:0,values:"0, 1, 2",share:"private",help:"1: translate eye 2: focus eye. You need to double-click the model on an animated part first."},camera_shadows:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"Enable shadows on the camera."},camera_target:{type:"vec3",defaultValue:null,values:"0, 1",share:"private",help:"Forces the target of the camera."},cardboard:{type:"number",defaultValue:0,values:"0, 1, 2",share:"public",help:"Start in VR Mode automatically."},carmel:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"If we are in the carmel context."},continuous_render:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Redraw continuously."},convert_vertex_color_8bit:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"Converts vertex color in 8bit."},debug3d:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Open a dat.gui panel to debug 3d stuffs."},debug_env_shadow:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Debug shadow environment."},dof_attenuate_distance:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"Attenuates dof effect when we unzoom."},dof_attenuate_speed:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Attenuates dof effect when we move the camera."},dof_res:{type:"number",defaultValue:2,values:"+X",share:"private",help:"Resolution divider of dof postprocess (2 means half resolution)."},dof_sticky:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"If the dof focus point sticks on the same place."},dof_transition:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"If there is a transition when changing the dof focus point."},double_click:{type:"bool",defaultValue:!0,values:"0, 1",share:"shared",help:"If we allow double-click (focus constraint)."},download_picture:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Download the thumbnail on Save View."},epsilon_alpha:{type:"number",defaultValue:1e-5,values:"0..1",share:"private",help:"GPU workaround bug with epsilon alpha discard threshold."},float_rtt:{type:"number",defaultValue:2,values:"0, 1, 2",share:"private",help:"0 : force 8bit, 1 force float if supported, 2 : depends (dynamic)."},force_controller:{type:"string",defaultValue:"",values:"vive, daydream, oculus",share:"private",help:"Force display of controller (debug)."},fps_speed:{type:"number",defaultValue:5,values:"+X",share:"public",help:"Set the default walk speed in First-Person."},grain_speed:{type:"number",defaultValue:64,values:"+X",share:"private",help:"Grain animation speed, in ms."},graph_optimizer:{type:"bool",defaultValue:null,values:"+X",share:"private",help:"Optimizes mesh (merge and bake geometries, etc), disabled by default in some cases (editor, api, processing)."},image_compression:{type:"bool",defaultValue:!0,values:"0, 1",share:"shared",help:"Use the full resolution, original textures."},internal:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Allows us to use limited parameters on whitelisted domains (e.g. hide the watermark on sketchfab.com)."},is_app:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"If we are in the mobile app context."},keep_empty_geometries:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"If we want to keep the empty geometries in the scene graph instead of removing them."},material_ao:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override ao channel for material given by material_names option."},material_cavity:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override cavity channel for material given by material_names option."},material_diffuse:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override diffuse channel for material given by material_names option."},material_displacement:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override displacement channel for material given by material_names option."},material_displacement_factor:{type:"number",defaultValue:null,values:"0, 1",share:"private",help:"override displacement factor channel for material given by material_names option."},material_emissive:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override emissive channel for material given by material_names option."},material_f0:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override f0 channel for material given by material_names option."},material_glossiness:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override glossiness channel for material given by material_names option."},material_metalness:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override metalness channel for material given by material_names option."},material_names:{type:"string",defaultValue:"main_material",values:"0, 1",share:"private",help:"Multiple names are separated with ; For example material_names=mat1;mat2."},material_normal:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override normal channel for material given by material_names option."},material_packing:{type:"bool",defaultValue:null,values:"0, 1",share:"private",help:"Pack texture materials."},material_roughness:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override roughness channel for material given by material_names option."},material_showcase:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Enables material showcase."},material_specular:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override specular channel for material given by material_names option."},material_transparency:{type:"string",defaultValue:null,values:"0, 1",share:"private",help:"override opacity channel for material given by material_names option."},max_texture_size:{type:"number",defaultValue:8192,values:"+X",share:"private",help:"All texture capped at that texture size."},merge_materials:{type:"bool",defaultValue:null,values:"0, 1",share:"private",help:"Merge similar materials."},messaging:{type:"bool",defaultValue:null,values:"0, 1",share:"private"},model:{type:"string",defaultValue:null,values:"uid",share:"UID of model to hook."},model_optimization:{defaultValue:null,help:"Use the unoptimized editor build.",share:"private",type:"bool",values:"0, 1"},navigation:{type:"string",defaultValue:"orbit",values:"orbit, fps",share:"public",help:"Choose between fps and orbit mode."},normal_compression:{type:"string",defaultValue:"percep",values:"percep, jpg",share:"private",help:"In case of astc normalmap, choose between astc and jpg."},normal_offset_shadow:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"If we use normal offset shadow bias."},orbit_constraint_pan:{type:"bool",defaultValue:null,values:"0, 1",share:"shared",help:"Disable panning"},orbit_constraint_pitch_down:{type:"number",defaultValue:null,values:"[-PI/2, PI/2]",share:"shared",help:"Pitch down limit."},orbit_constraint_pitch_up:{type:"number",defaultValue:null,values:"[-PI/2, PI/2]",share:"shared",help:"Pitch up limit."},orbit_constraint_yaw_left:{type:"number",defaultValue:null,values:"[-PI, PI]",share:"shared",help:"Yaw left limit."},orbit_constraint_yaw_right:{type:"number",defaultValue:null,values:"[-PI, PI]",share:"shared",help:"Yaw right limit."},orbit_constraint_zoom_in:{type:"number",defaultValue:null,values:"+X",share:"shared",help:"Zoom in limit."},orbit_constraint_zoom_out:{type:"number",defaultValue:null,values:"+X",share:"shared",help:"Zoom out limit."},panorama:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Uses panorama hdr instead of cubemap."},pixel_budget:{type:"number",defaultValue:null,values:"+X",share:"private",help:"0 is infinite, x is nb of pixel (e.g 4096)."},post_process:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"If postprocess filters are enabled."},power_preference:{type:"string",defaultValue:"default",values:"default|low-power|high-performance",share:"private",help:"Hint for gpu (power battery vs performance). Setting high-performance might be unsafe (context lost), so be wary."},preload:{type:"bool",defaultValue:!1,values:"0, 1",share:"public",help:"Download all textures before displaying the model."},preserve_drawing_buffer:{type:"bool",defaultValue:!1,values:"0, 1",share:"public",help:"WebGL canvas option."},process_material:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Reprocess materials."},process_options:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Reprocess all the options (same as a reupload without backend reprocessing)."},resize_rate:{type:"number",defaultValue:100,values:"+X",share:"shared",help:"Resize rate of canvas (in ms)."},scrollwheel:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",help:"Disable zooming with scrollwheel (Ctrl+Click/drag still zooms)."},shadow_env:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",help:"Activates shadow directional light environment feature."},shadow_PCF:{type:"string",defaultValue:"1Tap(4texFetch)",values:"1Band(1texFetch), 4Band(4texFetch), 9Band(9texFetch), 16Band(16texFetch), 1Tap(4texFetch), 4Tap(16texFetch), 9Tap(36texFetch), 16Tap(64texFetch), 4Poisson(16texFetch), 8Poisson(32texFetch), 16Poisson(64texFetch), 25Poisson(100texFetch), 32Poisson(128texFetch)",share:"private",help:"Shadow attempt to fight aliasing complex settings."},shadow_texture_size:{type:"number",defaultValue:1024,values:"+X",share:"private",help:"Size of shadowmaps."},share:{type:"bool",defaultValue:!1},show_bones:{type:"number",defaultValue:0,values:"0, 1, 2, 3",share:"private",help:"1: Skeleton only, 2: Skeleton + Mesh, 3: Bounding boxes"},snap_keyframe:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Snap on keyframes."},sound_enable:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Enables the sound feature"},sound_mute:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Mute any sound"},sound_preload:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Preloads the sounds"},ssao_normal:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"DEBUG ONLY! otherwise needs mrt."},stats:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"OSGJS option to display stats"},substance_displacement:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Moves vertices in y dimension only (displacement map)."},supersample:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"If accumulation supersample is enabled or not."},tracking:{type:"bool",defaultValue:!0,limited_to:"staff"},taa:{type:"bool",defaultValue:null,values:"0, 1",share:"private",help:"Enables Temporal Anti-Aliasing."},taa_accum:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"Supersample will accumulate with a Taa'ed texture image"},taa_feedback_max:{type:"number",defaultValue:.97,values:"[0, 1]",share:"private",help:"Feedback controls how much the current and the previous frames are blended together. The blending is done within the [min,max] range."},taa_feedback_min:{type:"number",defaultValue:.88,values:"[0, 1]",share:"private",help:"Feedback controls how much the current and the previous frames are blended together. The blending is done within the [min,max] range."},taa_vr_fxaa:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"Enable/Disable FXAA for background and widgets in VR."},taa_jitter:{type:"bool",defaultValue:null,values:"0, 1",share:"private",help:"Enable/Disable jittering when not supersampling."},taa_split:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Allows to compare the scene with/without Temporal Anti-Aliasing."},taa_transparent:{type:"bool",defaultValue:null,values:"0, 1",share:"private",help:"Enables taa on transparent objects."},transparent:{type:"bool",defaultValue:!1,values:"0, 1",share:"public",help:"Makes the background transparent."},ui_animations:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",limited_to:"biz",help:"Hide Animation menu / timeline."},ui_annotations:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",limited_to:"biz",help:"Hide Annotation menu / controls."},ui_fadeout:{type:"bool",defaultValue:!0,limited_to:"biz"},ui_sound:{type:"bool",defaultValue:!0,limited_to:"staff"},ui_theatre:{type:"bool",defaultValue:!1,limited_to:"biz"},ui_watermark:{type:"bool",defaultValue:!0,alias:["watermark"],limited_to:"staff"},ui_controls:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",limited_to:"biz",help:"Hide help, Settings, VR, Fullscreen."},ui_fullscreen:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",limited_to:"biz",help:"Hide Fullscreen button."},ui_general_controls:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",limited_to:"biz",help:"Hide all viewer controls."},ui_help:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",limited_to:"biz",help:"Hide help button."},ui_hint:{type:"number",defaultValue:1,values:"0, 1, 2",share:"private",help:"Hide viewer hint."},ui_infos:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",limited_to:"biz",alias:["desc_button"],help:"Hide top info bar."},ui_related:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",limited_to:"pro",help:"Hide related models."},ui_settings:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",limited_to:"biz",help:"Hide Settings button."},ui_snapshots:{type:"bool",defaultValue:!1,values:"0, 1",share:"public",help:"Show Save View button."},ui_stop:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",alias:["stop_button"],help:"Hide Stop Viewer button. "},ui_vr:{type:"bool",defaultValue:!0,values:"0, 1",share:"public",limited_to:"biz",help:"Hide View in VR button."},ui_matcap:{type:"bool",defaultValue:null,values:"0, 1",share:"private",help:"Enables the matcap ui."},unit_render_local:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Uses for unit render test."},unit_render_screenshot:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Uses for unit render test."},unit_render_uid:{type:"string",defaultValue:null,values:"uid",share:"private",help:"To run 1 uid in /tests/screenshot"},use_vao:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"If we use the VAO gl extension."},varying_sorting:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"Hack because of earlyz (bug gpu)."},vr_ar:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"transparent background and no floor (to test)"},vr_browser_env:{type:"string",defaultValue:null,values:"uid",share:"private",help:"Model UID of the environment model for the vr browse."},vr_fade:{type:"number",defaultValue:200,values:"+X",share:"private",help:"Fade time of the black transition in vr."},vr_launcher_alpha_card_factor:{type:"number",defaultValue:1,values:"+X",share:"private",help:"Alpha card factor."},vr_generate_ui_textures:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"Set to false to disable the UI texture generation in VR (fallback for ios app)"},vr_force_raf:{type:"bool",defaultValue:!1,values:"0, 1",share:"private",help:"Debug only (force replacement of native raf with hmd raf)."},vr_stereo:{type:"bool",defaultValue:!0,values:"0, 1",share:"private",help:"Mostly for debugging vr on desktop: disable stereo view in vr context."},vr_scale_rtt:{type:"number",defaultValue:0,values:"+X",share:"private",help:"If not 0, it will scale the size of te recommended vr renderTarget."},webgl2:{type:"bool",defaultValue:null,values:"0, 1",share:"shared",help:"Uses webgl2 instead of webgl1 if provided."}}}]);
//# sourceMappingURL=viewer-759394839211e6655926.js.map
